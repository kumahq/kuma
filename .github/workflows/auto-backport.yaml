name: Auto backport label
on:
  pull_request:
    types: [opened, synchronize]
env:
  PREDEFINED_GLOBS: ".github/**/*,.circleci/**/*,mk/**/*,tools/ci/**/*"
  LABEL_TO_ADD: backport
jobs:
  backport_label:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Check diff and add label
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: tools/ci/needs_backporting.sh "${{ github.repository }}" "${{ github.event.pull_request.number }}" "${{ github.base_ref }}" "${{ github.head_ref }}" "$PREDEFINED_GLOBS" "$LABEL_TO_ADD"
