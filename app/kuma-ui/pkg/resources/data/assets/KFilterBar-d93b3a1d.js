var ce=Object.defineProperty;var de=(s,o,t)=>o in s?ce(s,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[o]=t;var O=(s,o,t)=>(de(s,typeof o!="symbol"?o+"":o,t),t);import{d as oe,g as pe,f as me,r as fe,o as c,i as $,w as f,S as ie,j as I,n as p,H as y,l as h,F as N,k as r,a8 as ge,p as S,I as le,m as V,v as ve,K as q,as as ye,W as he,at as be,au as ke,t as re,y as A,h as G,ah as ae,av as _e,aw as Se,ax as we,B as ne,ay as Te,az as Ce,z as xe,U as Ie,D as ze,G as De}from"./index-28451437.js";import{A as Le}from"./AppCollection-b6258a04.js";import{S as Ae}from"./StatusBadge-fcc954b7.js";import{d as Ne,a as Fe,c as Ee,C as Be}from"./dataplane-0a086c06.js";const Ue={key:0},Me=oe({__name:"DataPlaneList",props:{total:{default:0},pageNumber:{},pageSize:{},items:{},error:{},gateways:{type:Boolean,default:!1}},emits:["load-data","change"],setup(s,{emit:o}){const{t,formatIsoDate:w}=pe(),b=me(),a=s,i=o,T=b("use zones");function k(g){return g.map(u=>{var R,E,D,H,e,l,d,L,X,ee;const v=u.mesh,n=u.name,_=((R=u.dataplane.networking.gateway)==null?void 0:R.type)||"STANDARD",C=["kuma.io/protocol","kuma.io/service","kuma.io/zone"],F=Ne(u.dataplane).filter(m=>C.includes(m.label)),B=(E=F.find(m=>m.label==="kuma.io/service"))==null?void 0:E.value,W=(D=F.find(m=>m.label==="kuma.io/protocol"))==null?void 0:D.value,U=(H=F.find(m=>m.label==="kuma.io/zone"))==null?void 0:H.value;let M;B!==void 0&&(M={name:"service-detail-view",params:{mesh:v,service:B}});let j;U!==void 0&&(j={name:"zone-cp-detail-view",params:{zone:U}});const{status:Z}=Fe(u.dataplane,u.dataplaneInsight),K=((e=u.dataplaneInsight)==null?void 0:e.subscriptions)??[],J={dpVersion:null,selectedUpdateTime:NaN,version:null},x=K.reduce((m,P)=>{var te;const Y=Date.parse(P.status.lastUpdateTime);return Y&&(!m.selectedUpdateTime||Y>m.selectedUpdateTime)&&(m.selectedUpdateTime=Y),{dpVersion:((te=P.version)==null?void 0:te.kumaDp.version)||m.dpVersion,selectedUpdateTime:m.selectedUpdateTime,version:P.version||m.version}},J),z={name:n,type:_,zone:{title:U??t("common.collection.none"),route:j},service:{title:B??t("common.collection.none"),route:M},protocol:W??t("common.collection.none"),status:Z,warnings:{version_mismatch:!1,cert_expired:!1},lastUpdated:x.selectedUpdateTime?w(new Date(x.selectedUpdateTime).toUTCString()):t("common.collection.none"),isGateway:((d=(l=u.dataplane)==null?void 0:l.networking)==null?void 0:d.gateway)!==void 0};if(x.version){const{kind:m}=Ee(x.version);m!==Be&&(z.warnings.version_mismatch=!0)}T&&x.dpVersion&&F.find(P=>P.label==="kuma.io/zone")&&typeof((L=x.version)==null?void 0:L.kumaDp.kumaCpCompatible)=="boolean"&&!x.version.kumaDp.kumaCpCompatible&&(z.warnings.version_mismatch=!0);const Q=(ee=(X=u.dataplaneInsight)==null?void 0:X.mTLS)==null?void 0:ee.certificateExpirationTime;return Q&&Date.now()>new Date(Q).getTime()&&(z.warnings.cert_expired=!0),z})}return(g,u)=>{const v=fe("RouterLink");return c(),$(Le,{"empty-state-message":r(t)("common.emptyState.message",{type:a.gateways?"Gateways":"Data Plane Proxies"}),"empty-state-cta-to":r(t)(`data-planes.href.docs.${a.gateways?"gateway":"data_plane_proxy"}`),"empty-state-cta-text":r(t)("common.documentation"),headers:[{label:"Name",key:"name"},...a.gateways?[{label:"Type",key:"type"}]:[],{label:"Service",key:"service"},...a.gateways?[]:[{label:"Protocol",key:"protocol"}],...r(T)?[{label:"Zone",key:"zone"}]:[],{label:"Last Updated",key:"lastUpdated"},{label:"Certificate Info",key:"certificate"},{label:"Status",key:"status"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Actions",key:"actions",hideLabel:!0}],"page-number":a.pageNumber,"page-size":a.pageSize,total:a.total,items:a.items?k(a.items):void 0,error:a.error,onChange:u[0]||(u[0]=n=>i("change",n))},{toolbar:f(()=>[ie(g.$slots,"toolbar",{},void 0,!0)]),name:f(({row:n})=>[I(v,{to:{name:n.isGateway?"gateway-detail-view":"data-plane-detail-view",params:{dataPlane:n.name}},"data-testid":"detail-view-link"},{default:f(()=>[p(y(n.name),1)]),_:2},1032,["to"])]),service:f(({rowValue:n})=>[n.route?(c(),$(v,{key:0,to:n.route},{default:f(()=>[p(y(n.title),1)]),_:2},1032,["to"])):(c(),h(N,{key:1},[p(y(n.title),1)],64))]),zone:f(({rowValue:n})=>[n.route?(c(),$(v,{key:0,to:n.route},{default:f(()=>[p(y(n.title),1)]),_:2},1032,["to"])):(c(),h(N,{key:1},[p(y(n.title),1)],64))]),status:f(({rowValue:n})=>[n?(c(),$(Ae,{key:0,status:n},null,8,["status"])):(c(),h(N,{key:1},[p(y(r(t)("common.collection.none")),1)],64))]),warnings:f(({row:n})=>[Object.values(n.warnings).some(_=>_)?(c(),$(r(ge),{key:0},{content:f(()=>[S("ul",null,[(c(!0),h(N,null,le(n.warnings,(_,C)=>(c(),h(N,{key:C},[_?(c(),h("li",Ue,y(r(t)(`data-planes.components.data-plane-list.${C}`)),1)):V("",!0)],64))),128))])]),default:f(()=>[p(),I(ve,{class:"mr-1",size:r(q),"hide-title":""},null,8,["size"])]),_:2},1024)):(c(),h(N,{key:1},[p(y(r(t)("common.collection.none")),1)],64))]),certificate:f(({row:n})=>{var _,C;return[p(y((C=(_=n.dataplaneInsight)==null?void 0:_.mTLS)!=null&&C.certificateExpirationTime?r(w)(new Date(n.dataplaneInsight.mTLS.certificateExpirationTime).toUTCString()):r(t)("data-planes.components.data-plane-list.certificate.none")),1)]}),actions:f(({row:n})=>[I(r(ye),{class:"actions-dropdown","kpop-attributes":{placement:"bottomEnd",popoverClasses:"mt-5 more-actions-popover"},width:"150"},{default:f(()=>[I(r(he),{class:"non-visual-button",appearance:"secondary",size:"small"},{default:f(()=>[I(r(be),{size:r(q)},null,8,["size"])]),_:1})]),items:f(()=>[I(r(ke),{item:{to:{name:n.isGateway?"gateway-detail-view":"data-plane-detail-view",params:{dataPlane:n.name}},label:r(t)("common.collection.actions.view")}},null,8,["item"])]),_:2},1024)]),_:3},8,["empty-state-message","empty-state-cta-to","empty-state-cta-text","headers","page-number","page-size","total","items","error"])}}});const ut=re(Me,[["__scopeId","data-v-be733e47"]]);function Pe(s,o,t){return Math.max(o,Math.min(s,t))}const $e=["ControlLeft","ControlRight","ShiftLeft","ShiftRight","AltLeft"];class qe{constructor(o,t){O(this,"commands");O(this,"keyMap");O(this,"boundTriggerShortcuts");this.commands=t,this.keyMap=Object.fromEntries(Object.entries(o).map(([w,b])=>[w.toLowerCase(),b])),this.boundTriggerShortcuts=this.triggerShortcuts.bind(this)}registerListener(){document.addEventListener("keydown",this.boundTriggerShortcuts)}unRegisterListener(){document.removeEventListener("keydown",this.boundTriggerShortcuts)}triggerShortcuts(o){je(o,this.keyMap,this.commands)}}function je(s,o,t){const w=Ke(s.code),b=[s.ctrlKey?"ctrl":"",s.shiftKey?"shift":"",s.altKey?"alt":"",w].filter(T=>T!=="").join("+"),a=o[b];if(!a)return;const i=t[a];i.isAllowedContext&&!i.isAllowedContext(s)||(i.shouldPreventDefaultAction&&s.preventDefault(),!(i.isDisabled&&i.isDisabled())&&i.trigger(s))}function Ke(s){return $e.includes(s)?"":s.replace(/^Key/,"").toLowerCase()}function Qe(s,o){const t=" "+s,w=t.matchAll(/ ([-\s\w]+):\s*/g),b=[];for(const a of Array.from(w)){if(a.index===void 0)continue;const i=Re(a[1]);if(o.length>0&&!o.includes(i))throw new Error(`Unknown field “${i}”. Known fields: ${o.join(", ")}`);const T=a.index+a[0].length,k=t.substring(T);let g;if(/^\s*["']/.test(k)){const v=k.match(/['"](.*?)['"]/);if(v!==null)g=v[1];else throw new Error(`Quote mismatch for field “${i}”.`)}else{const v=k.indexOf(" "),n=v===-1?k.length:v;g=k.substring(0,n)}g!==""&&b.push([i,g])}return b}function Re(s){return s.trim().replace(/\s+/g,"-").replace(/-[a-z]/g,(o,t)=>t===0?o:o.substring(1).toUpperCase())}let se=0;const He=(s="unique")=>(se++,`${s}-${se}`),ue=s=>(ze("data-v-9e2bf5f8"),s=s(),De(),s),Oe=ue(()=>S("span",{class:"visually-hidden"},"Focus filter",-1)),Ge={class:"k-filter-icon"},Ve=["for"],We=["id","placeholder"],Ze={key:0,class:"k-suggestion-box","data-testid":"k-filter-bar-suggestion-box"},Je={class:"k-suggestion-list"},Ye={key:0,class:"k-filter-bar-error"},Xe={key:0},et=["title","data-filter-field"],tt={class:"visually-hidden"},at=ue(()=>S("span",{class:"visually-hidden"},"Clear query",-1)),nt=oe({__name:"KFilterBar",props:{id:{type:String,required:!1,default:()=>He("k-filter-bar")},fields:{type:Object,required:!0},placeholder:{type:String,required:!1,default:null},query:{type:String,required:!1,default:""}},emits:["fields-change"],setup(s,{emit:o}){const t=s,w=o,b=A(null),a=A(null),i=A(t.query),T=A([]),k=A(null),g=A(!1),u=A(-1),v=G(()=>Object.keys(t.fields)),n=G(()=>Object.entries(t.fields).slice(0,5).map(([e,l])=>({fieldName:e,...l}))),_=G(()=>v.value.length>0?`Filter by ${v.value.join(", ")}`:"Filter"),C=G(()=>t.placeholder??_.value);ae(()=>T.value,function(e,l){H(e,l)||(k.value=null,w("fields-change",{fields:e,query:i.value}))}),ae(()=>i.value,function(){i.value===""&&(k.value=null),g.value=!0});const F={Enter:"submitQuery",Escape:"closeSuggestionBox",ArrowDown:"jumpToNextSuggestion",ArrowUp:"jumpToPreviousSuggestion"},B={submitQuery:{trigger:M,isAllowedContext(e){return a.value!==null&&e.composedPath().includes(a.value)},shouldPreventDefaultAction:!0},jumpToNextSuggestion:{trigger:j,isAllowedContext(e){return a.value!==null&&e.composedPath().includes(a.value)},shouldPreventDefaultAction:!0},jumpToPreviousSuggestion:{trigger:Z,isAllowedContext(e){return a.value!==null&&e.composedPath().includes(a.value)},shouldPreventDefaultAction:!0},closeSuggestionBox:{trigger:E,isAllowedContext(e){return b.value!==null&&e.composedPath().includes(b.value)}}};function W(){const e=new qe(F,B);xe(function(){e.registerListener()}),Ie(function(){e.unRegisterListener()}),D(i.value)}W();function U(e){const l=e.target;D(l.value)}function M(){if(a.value instanceof HTMLInputElement)if(u.value===-1)D(a.value.value),g.value=!1;else{const e=n.value[u.value].fieldName;e&&z(a.value,e)}}function j(){K(1)}function Z(){K(-1)}function K(e){u.value=Pe(u.value+e,-1,n.value.length-1)}function J(){a.value instanceof HTMLInputElement&&a.value.focus()}function x(e){const d=e.currentTarget.getAttribute("data-filter-field");d&&a.value instanceof HTMLInputElement&&z(a.value,d)}function z(e,l){const d=i.value===""||i.value.endsWith(" ")?"":" ";i.value+=d+l+":",e.focus(),u.value=-1}function Q(){i.value="",a.value instanceof HTMLInputElement&&(a.value.value="",a.value.focus(),D(""))}function R(e){e.relatedTarget===null&&E(),b.value instanceof HTMLElement&&e.relatedTarget instanceof Node&&!b.value.contains(e.relatedTarget)&&E()}function E(){g.value=!1}function D(e){k.value=null;try{const l=Qe(e,v.value);l.sort((d,L)=>d[0].localeCompare(L[0])),T.value=l}catch(l){if(l instanceof Error)k.value=l,g.value=!0;else throw l}}function H(e,l){return JSON.stringify(e)===JSON.stringify(l)}return(e,l)=>(c(),h("div",{ref_key:"filterBar",ref:b,class:"k-filter-bar","data-testid":"k-filter-bar"},[S("button",{class:"k-focus-filter-input-button",title:"Focus filter",type:"button","data-testid":"k-filter-bar-focus-filter-input-button",onClick:J},[Oe,p(),S("span",Ge,[I(r(_e),{decorative:"","data-testid":"k-filter-bar-filter-icon","hide-title":"",size:r(q)},null,8,["size"])])]),p(),S("label",{for:`${t.id}-filter-bar-input`,class:"visually-hidden"},[ie(e.$slots,"default",{},()=>[p(y(_.value),1)],!0)],8,Ve),p(),Se(S("input",{id:`${t.id}-filter-bar-input`,ref_key:"filterInput",ref:a,"onUpdate:modelValue":l[0]||(l[0]=d=>i.value=d),class:"k-filter-bar-input",type:"text",placeholder:C.value,"data-testid":"k-filter-bar-filter-input",onFocus:l[1]||(l[1]=d=>g.value=!0),onBlur:R,onChange:U},null,40,We),[[we,i.value]]),p(),g.value?(c(),h("div",Ze,[S("div",Je,[k.value!==null?(c(),h("p",Ye,y(k.value.message),1)):(c(),h("button",{key:1,class:ne(["k-submit-query-button",{"k-submit-query-button-is-selected":u.value===-1}]),title:"Submit query",type:"button","data-testid":"k-filter-bar-submit-query-button",onClick:M},`
          Submit `+y(i.value),3)),p(),(c(!0),h(N,null,le(n.value,(d,L)=>(c(),h("div",{key:`${t.id}-${L}`,class:ne(["k-suggestion-list-item",{"k-suggestion-list-item-is-selected":u.value===L}])},[S("b",null,y(d.fieldName),1),d.description!==""?(c(),h("span",Xe,": "+y(d.description),1)):V("",!0),p(),S("button",{class:"k-apply-suggestion-button",title:`Add ${d.fieldName}:`,type:"button","data-filter-field":d.fieldName,"data-testid":"k-filter-bar-apply-suggestion-button",onClick:x},[S("span",tt,"Add "+y(d.fieldName)+":",1),p(),I(r(Te),{decorative:"","hide-title":"",size:r(q)},null,8,["size"])],8,et)],2))),128))])])):V("",!0),p(),i.value!==""?(c(),h("button",{key:1,class:"k-clear-query-button",title:"Clear query",type:"button","data-testid":"k-filter-bar-clear-query-button",onClick:Q},[at,p(),I(r(Ce),{decorative:"","hide-title":"",size:r(q)},null,8,["size"])])):V("",!0)],512))}});const ct=re(nt,[["__scopeId","data-v-9e2bf5f8"]]);export{ut as D,ct as K};
