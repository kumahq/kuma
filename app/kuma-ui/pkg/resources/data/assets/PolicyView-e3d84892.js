import{b as ee,u as ae}from"./vue-router-d4f1d759.js";import{m as te,P as W,T as le,U as se}from"./kongponents.es-3d29ea72.js";import{k as V,i as ne,p as oe,u as re}from"./store-7145e9ff.js";import{b as Q}from"./constants-31fdaf55.js";import{Q as H}from"./QueryParameter-70743f73.js";import{D as ie}from"./DataOverview-96f057f4.js";import{d as z,o as m,a as q,w as r,e as g,u as a,f as i,r as t,c as F,y as R,n as ue,l as ce,h as k,g as n,V as pe,a4 as me,F as G,v as Y,t as N,b as C,x as K,p as de,m as ye}from"./runtime-dom.esm-bundler-0365b489.js";import{F as ve}from"./FrameSkeleton-17f38737.js";import{_ as Z}from"./LabelList.vue_vue_type_style_index_0_lang-d3934d9f.js";import{T as fe}from"./TabsWidget-4f98888c.js";import{_ as he}from"./YamlView.vue_vue_type_script_setup_true_lang-c9d24769.js";import{u as _e}from"./index-abf8e944.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";import"./vuex.esm-bundler-ef854cbe.js";import"./datadogLogEvents-4578cfa7.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-b223fa2a.js";import"./ErrorBlock-1804efed.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-3a5c7d6f.js";import"./StatusBadge-b461111f.js";import"./TagList-6bfcfe3b.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-31aad61a.js";import"./_commonjsHelpers-edff4021.js";import"./toYaml-4e00099e.js";const be=z({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(d){const l=d;return(E,S)=>(m(),q(a(W),{class:"docs-link",appearance:"outline",target:"_blank",to:l.href},{default:r(()=>[g(a(te),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),i(`

    Documentation
  `)]),_:1},8,["to"]))}}),Pe=n("h4",null,"Dataplanes",-1),we=z({__name:"PolicyConnections",props:{mesh:{type:String,required:!0},policyType:{type:String,required:!0},policyName:{type:String,required:!0}},setup(d){const l=d,E=t(!1),S=t(!0),L=t(!1),y=t([]),P=t(""),b=F(()=>{const u=P.value.toLowerCase();return y.value.filter(({dataplane:s})=>s.name.toLowerCase().includes(u))});R(()=>l.policyName,function(){v()}),ue(function(){v()});async function v(){L.value=!1,S.value=!0;try{const{items:u,total:s}=await V.getPolicyConnections({mesh:l.mesh,policyType:l.policyType,policyName:l.policyName});E.value=s>0,y.value=u??[]}catch{L.value=!0}finally{S.value=!1}}return(u,s)=>{const f=ce("router-link");return m(),k("div",null,[g(Z,{"has-error":L.value,"is-loading":S.value,"is-empty":!E.value},{default:r(()=>[n("ul",null,[n("li",null,[Pe,i(),pe(n("input",{id:"dataplane-search","onUpdate:modelValue":s[0]||(s[0]=c=>P.value=c),type:"text",class:"k-input mb-4",placeholder:"Filter by name",required:"","data-testid":"dataplane-search-input"},null,512),[[me,P.value]]),i(),(m(!0),k(G,null,Y(a(b),(c,w)=>(m(),k("p",{key:w,class:"my-1","data-testid":"dataplane-name"},[g(f,{to:{name:"data-plane-detail-view",params:{mesh:c.dataplane.mesh,dataPlane:c.dataplane.name}}},{default:r(()=>[i(N(c.dataplane.name),1)]),_:2},1032,["to"])]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])])}}}),ke=d=>(de("data-v-9387bba4"),d=d(),ye(),d),Ee={key:0,class:"mb-4"},Se=ke(()=>n("p",null,[n("strong",null,"Warning"),i(` This policy is experimental. If you encountered any problem please open an
            `),n("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),xe={class:"entity-heading","data-testid":"policy-single-entity"},De={"data-testid":"policy-overview-tab"},Te={class:"config-wrapper"},Ce=z({__name:"PolicyView",props:{selectedPolicyName:{type:String,required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(d){const l=d,E=_e(),S=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],L=ee(),y=ae(),P=re(),b=t(!0),v=t(!1),u=t(null),s=t(!0),f=t(!1),c=t(!1),w=t(!1),x=t({}),D=t(null),$=t(null),B=t(l.offset),M=t({headers:[{label:"Actions",key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Type",key:"type"}],data:[]}),h=F(()=>P.state.policyTypesByPath[l.policyPath]),j=F(()=>P.state.policyTypes.map(e=>({length:P.state.sidebar.insights.mesh.policies[e.name]??0,label:e.name,value:e.path,selected:e.path===l.policyPath})));R(()=>y.params.mesh,function(){y.name===l.policyPath&&(b.value=!0,v.value=!1,s.value=!0,f.value=!1,c.value=!1,w.value=!1,u.value=null,A(0))}),R(()=>y.query.ns,function(){b.value=!0,v.value=!1,s.value=!0,f.value=!1,c.value=!1,w.value=!1,u.value=null,A(0)}),A(l.offset);async function A(e){B.value=e,H.set("offset",e>0?e:null),b.value=!0,u.value=null;const p=y.query.ns||null,o=y.params.mesh,T=h.value.path;try{let _;if(o!==null&&p!==null)_=[await V.getSinglePolicyEntity({mesh:o,path:T,name:p})],$.value=null;else{const I={size:Q,offset:e},U=await V.getAllPolicyEntitiesFromMesh({mesh:o,path:T},I);_=U.items??[],$.value=U.next}if(_.length>0){M.value.data=_.map(U=>X(U)),w.value=!1,v.value=!1;const I=l.selectedPolicyName??_[0].name;await O({name:I,mesh:o,path:T})}else M.value.data=[],w.value=!0,v.value=!0,f.value=!0}catch(_){_ instanceof Error?u.value=_:console.error(_),v.value=!0}finally{b.value=!1,s.value=!1}}function J(e){L.push({name:"policy",params:{...y.params,policyPath:e.value}})}function X(e){if(!e.mesh)return e;const p=e,o={name:"mesh-detail-view",params:{mesh:e.mesh}};return p.meshRoute=o,p}async function O(e){c.value=!1,s.value=!0,f.value=!1;try{const p=await V.getSinglePolicyEntity({mesh:e.mesh,path:h.value.path,name:e.name});if(p){const o=["type","name","mesh"];x.value=ne(p,o),H.set("policy",x.value.name),D.value=oe(p)}else x.value={},f.value=!0}catch(p){c.value=!0,console.error(p)}finally{s.value=!1}}return(e,p)=>a(h)?(m(),k("div",{key:0,class:K(["relative",a(h).path])},[a(h).isExperimental?(m(),k("div",Ee,[g(a(le),{appearance:"warning"},{alertMessage:r(()=>[Se]),_:1})])):C("",!0),i(),g(ve,null,{default:r(()=>[g(ie,{"selected-entity-name":x.value.name,"page-size":a(Q),error:u.value,"is-loading":b.value,"empty-state":{title:"No Data",message:`There are no ${a(h).name} policies present.`},"table-data":M.value,"table-data-is-empty":w.value,next:$.value,"page-offset":B.value,onTableAction:O,onLoadData:A},{additionalControls:r(()=>[g(a(se),{label:"Policies",items:a(j),"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:J},{"item-template":r(({item:o})=>[n("span",{class:K({"policy-type-empty":o.length===0})},N(o.label),3)]),_:1},8,["items"]),i(),g(be,{href:`${a(E)("KUMA_DOCS_URL")}/policies/${a(h).path}/?${a(E)("KUMA_UTM_QUERY_PARAMS")}`,"data-testid":"policy-documentation-link"},null,8,["href"]),i(),e.$route.query.ns?(m(),q(a(W),{key:0,class:"back-button",appearance:"primary",icon:"arrowLeft",to:{name:"policy",params:{policyPath:l.policyPath}}},{default:r(()=>[i(`
            View all
          `)]),_:1},8,["to"])):C("",!0)]),default:r(()=>[i(`
        >
        `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"]),i(),v.value===!1?(m(),q(fe,{key:0,"has-error":u.value!==null,error:u.value,"is-loading":b.value,tabs:S},{tabHeader:r(()=>[n("h1",xe,N(a(h).name)+": "+N(x.value.name),1)]),overview:r(()=>[g(Z,{"has-error":c.value,"is-loading":s.value,"is-empty":f.value},{default:r(()=>[n("div",De,[n("ul",null,[(m(!0),k(G,null,Y(x.value,(o,T)=>(m(),k("li",{key:T},[n("h4",null,N(T),1),i(),n("p",null,N(o),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"]),i(),n("div",Te,[D.value!==null?(m(),q(he,{key:0,id:"code-block-policy","has-error":c.value,"is-loading":s.value,"is-empty":f.value,content:D.value,"is-searchable":""},null,8,["has-error","is-loading","is-empty","content"])):C("",!0)])]),"affected-dpps":r(()=>[D.value!==null?(m(),q(we,{key:0,mesh:D.value.mesh,"policy-name":D.value.name,"policy-type":a(h).path},null,8,["mesh","policy-name","policy-type"])):C("",!0)]),_:1},8,["has-error","error","is-loading"])):C("",!0)]),_:1})],2)):C("",!0)}});const Xe=ge(Ce,[["__scopeId","data-v-9387bba4"]]);export{Xe as default};
