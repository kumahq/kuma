import{d as A,f as c,g as F,o as l,j as i,a as d,u as t,q as Y,D as j,p as q,r as k,x as z,cu as P,k as R,c as V,w as v,l as u,F as b,n as D,t as h,U as S,b as N,z as $}from"./index.7fb3bbf1.js";import{_ as L,a as T,M as W}from"./MeshResources.9bafc77c.js";import{_ as O}from"./LabelList.vue_vue_type_style_index_0_lang.11b0110d.js";import{T as G}from"./TabsWidget.6dc62ce9.js";import{Y as H}from"./YamlView.77c21317.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.4c2c295a.js";import"./ErrorBlock.ea8501b0.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.489330d0.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.69d70663.js";import"./_commonjsHelpers.f037b798.js";const J={class:"chart-container mt-16"},Q=A({__name:"MeshCharts",setup(K){const s=Y(),f=c(()=>s.getters.getServiceResourcesFetching),y=c(()=>s.getters.getMeshInsightsFetching),m=c(()=>s.getters.getChart("services")),p=c(()=>s.getters.getChart("dataplanes")),g=c(()=>s.getters.getChart("kumaDPVersions")),o=c(()=>s.getters.getChart("envoyVersions"));F(()=>s.state.selectedMesh,function(){C()}),C();function C(){s.dispatch("fetchMeshInsights",s.state.selectedMesh),s.dispatch("fetchServices",s.state.selectedMesh)}return(B,x)=>(l(),i("div",J,[d(L,{class:"chart chart-1/4",title:{singular:"SERVICE",plural:"SERVICES"},data:t(m).data,"is-loading":t(f),"save-chart":""},null,8,["data","is-loading"]),d(L,{class:"chart chart-1/4",title:{singular:"DP PROXY",plural:"DP PROXIES"},data:t(p).data,url:{name:"data-plane-list-view",params:{mesh:t(s).state.selectedMesh}},"is-loading":t(y)},null,8,["data","url","is-loading"]),d(T,{class:"chart chart-1/4",title:"KUMA DP",data:t(g).data,"is-loading":t(y)},null,8,["data","is-loading"]),d(T,{class:"chart chart-1/4",title:"ENVOY",data:t(o).data,"is-loading":t(y),"display-am-charts-logo":""},null,8,["data","is-loading"])]))}});const Z=j(Q,[["__scopeId","data-v-da78099c"]]),ee={key:1},ae={key:1},te={key:1,class:"mt-8"},pe=A({__name:"MeshOverviewView",setup(K){const s=q(),f=Y(),y=[{hash:"#overview",title:"Overview"},{hash:"#resources",title:"Resources"}],m=k(!0),p=k(!1),g=k(!1),o=k(null),C=k(null),B=c(()=>o.value!==null?z(o.value):null),x=c(()=>{if(o.value===null)return null;const{name:n,type:r,creationTime:e,modificationTime:a}=o.value;return{name:n,type:r,created:P(e),modified:P(a)}}),U=c(()=>{var M;if(o.value===null)return null;const n=w(o.value,"mtls"),r=w(o.value,"logging"),e=w(o.value,"metrics"),a=w(o.value,"tracing"),_=Boolean((M=o.value.routing)==null?void 0:M.localityAwareLoadBalancing);return{mtls:n,logging:r,metrics:e,tracing:a,localityAwareLoadBalancing:_}}),E=c(()=>{const n=f.state.policies.map(r=>{var e,a;return{title:r.pluralDisplayName,value:(a=(e=f.state.meshInsight.policies[r.name])==null?void 0:e.total)!=null?a:0}});return[{title:"Data Plane Proxies",value:f.state.meshInsight.dataplanes.total},...n]});F(()=>s.params.mesh,function(){s.name==="single-mesh-overview"&&(m.value=!0,g.value=!1,p.value=!1,I())}),I();async function I(){m.value=!0,g.value=!1;const n=s.params.mesh;try{o.value=await R.getMesh({name:n}),C.value=await R.getMeshInsights({name:n})}catch(r){p.value=!0,g.value=!0,console.error(r)}finally{m.value=!1}}function w(n,r){var _,M;if(n===null||n[r]===void 0)return!1;const e=(M=(_=n[r].enabledBackend)!=null?_:n[r].defaultBackend)!=null?M:n[r].backends[0].name,a=n[r].backends.find(X=>X.name===e);return`${a.type} / ${a.name}`}return(n,r)=>(l(),i(b,null,[d(Z),d(W,{class:"mt-8"}),o.value!==null?(l(),V(G,{key:0,class:"mt-8","has-error":p.value,"is-loading":m.value,tabs:y,"initial-tab-override":"overview"},{overview:v(()=>[d(O,null,{default:v(()=>[u("div",null,[u("ul",null,[(l(!0),i(b,null,D(t(x),(e,a)=>(l(),i("li",{key:a},[u("h4",null,h(a),1),typeof e=="boolean"?(l(),V(t(S),{key:0,appearance:e?"success":"danger"},{default:v(()=>[N(h(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),i("p",ee,h(e),1))]))),128))])]),u("div",null,[u("ul",null,[(l(!0),i(b,null,D(t(U),(e,a)=>(l(),i("li",{key:a},[u("h4",null,h(a),1),typeof e=="boolean"?(l(),V(t(S),{key:0,appearance:e?"success":"danger"},{default:v(()=>[N(h(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),i("p",ae,h(e),1))]))),128))])])]),_:1})]),resources:v(()=>[d(O,{"has-error":p.value,"is-loading":m.value,"is-empty":g.value},{default:v(()=>[(l(!0),i(b,null,D(Math.ceil(t(E).length/3),e=>(l(),i("div",{key:e},[u("ul",null,[(l(!0),i(b,null,D(t(E).slice((e-1)*3,e*3),(a,_)=>(l(),i("li",{key:_},[u("h4",null,h(a.title),1),u("p",null,h(a.value),1)]))),128))])]))),128))]),_:1},8,["has-error","is-loading","is-empty"])]),_:1},8,["has-error","is-loading"])):$("",!0),t(B)!==null?(l(),i("div",te,[d(H,{id:"code-block-mesh",content:t(B)},null,8,["content"])])):$("",!0)],64))}});export{pe as default};
