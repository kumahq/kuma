import{_ as N,r as B,p as _,o as d,w as m,l as r,e as s,a as p,d as M,k as P,q as b,t as i,c as f,M as S,L as g,m as a,n as L,b as D}from"./index-D382J87O.js";import{T as G}from"./TagList-DnKAc7wy.js";const Y=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],F=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],U=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Z=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],q=(o,t,e)=>{let c=o;return typeof t=="string"||Array.isArray(t)?c=o.toLocaleString(t,e):(t===!0||e!==void 0)&&(c=o.toLocaleString(void 0,e)),c},I=o=>{if(typeof o=="number")return Math.log10(o);const t=o.toString(10);return t.length+Math.log10(`0.${t.slice(0,15)}`)},V=o=>typeof o=="number"?Math.log(o):I(o)*Math.log(10),A=(o,t)=>{if(typeof o=="number")return o/t;const e=o/BigInt(t),c=o%BigInt(t);return Number(e)+Number(c)/t},E=(o,t)=>{if(t===void 0)return o;if(typeof t!="number"||!Number.isSafeInteger(t)||t<0)throw new TypeError(`Expected fixedWidth to be a non-negative integer, got ${typeof t}: ${t}`);return t===0?o:o.length<t?o.padStart(t," "):o},j=o=>{const{minimumFractionDigits:t,maximumFractionDigits:e}=o;if(!(t===void 0&&e===void 0))return{...t!==void 0&&{minimumFractionDigits:t},...e!==void 0&&{maximumFractionDigits:e},roundingMode:"trunc"}};function C(o,t){if(typeof o!="bigint"&&!Number.isFinite(o))throw new TypeError(`Expected a finite number, got ${typeof o}: ${o}`);t={bits:!1,binary:!1,space:!0,nonBreakingSpace:!1,...t};const e=t.bits?t.binary?Z:U:t.binary?F:Y,c=t.space?t.nonBreakingSpace?"Â ":" ":"",n=typeof o=="number"?o===0:o===0n;if(t.signed&&n){const u=` 0${c}${e[0]}`;return E(u,t.fixedWidth)}const k=o<0,v=k?"-":t.signed?"+":"";k&&(o=-o);const x=j(t);let l;if(o<1){const u=q(o,t.locale,x);l=v+u+c+e[0]}else{const u=Math.min(Math.floor(t.binary?V(o)/Math.log(1024):I(o)/3),e.length-1);if(o=A(o,(t.binary?1024:1e3)**u),!x){const $=Math.max(3,Math.floor(o).toString().length);o=o.toPrecision($)}const T=q(Number(o),t.locale,x),y=e[u];l=v+T+c+y}return E(l,t.fixedWidth)}const z={},K={class:"card"},H={class:"title"},J={class:"body"};function Q(o,t){const e=B("XCard");return d(),_(e,{class:"data-card"},{default:m(()=>[r("dl",null,[r("div",K,[r("dt",H,[p(o.$slots,"title",{},void 0,!0)]),t[0]||(t[0]=s()),r("dd",J,[p(o.$slots,"default",{},void 0,!0)])])])]),_:3})}const X=N(z,[["render",Q],["__scopeId","data-v-feea784e"]]),R={class:"aside"},W={class:"title"},O={"data-testid":"grpc-success"},h={"data-testid":"grpc-failure"},tt={"data-testid":"rq-2xx"},et={"data-testid":"rq-4xx"},nt={"data-testid":"rq-5xx"},ot={"data-testid":"connections-total"},rt={key:0,"data-testid":"bytes-received"},st={key:1,"data-testid":"bytes-sent"},it=M({__name:"ConnectionCard",props:{protocol:{},service:{default:""},traffic:{default:void 0},direction:{default:"downstream"},portName:{default:void 0}},setup(o){const{t}=P(),e=o;return(c,n)=>{const k=B("XBadge"),v=B("XDl"),x=B("XProgress");return d(),_(X,{class:"service-traffic-card"},{title:m(()=>[r("div",R,[p(c.$slots,"aside",{},()=>[e.service.length>0?(d(),_(G,{key:0,tags:[{label:"kuma.io/service",value:e.service}]},null,8,["tags"])):b("",!0)],!0)]),n[2]||(n[2]=s()),r("div",W,[p(c.$slots,"state",{},void 0,!0),n[0]||(n[0]=s()),e.protocol!==""?(d(),_(k,{key:0,class:"protocol",appearance:e.protocol==="passthrough"?"success":"info"},{default:m(()=>[s(i(a(t)(`data-planes.components.service_traffic_card.protocol.${e.protocol}`,{},{defaultMessage:a(t)(`http.api.value.${e.protocol}`)})),1)]),_:1},8,["appearance"])):b("",!0),n[1]||(n[1]=s()),p(c.$slots,"default",{},void 0,!0)])]),default:m(()=>[n[25]||(n[25]=s()),e.portName?(d(),_(v,{key:0},{default:m(()=>[r("div",null,[n[3]||(n[3]=r("dt",null,"Name",-1)),n[4]||(n[4]=s()),r("dd",null,i(e.portName),1)])]),_:1})):b("",!0),n[26]||(n[26]=s()),p(c.$slots,"body",{},void 0,!0),n[27]||(n[27]=s()),e.traffic?(d(),_(v,{key:1},{default:m(()=>[e.protocol==="passthrough"?(d(!0),f(g,{key:0},S([["http","tcp"].reduce((l,u)=>{const T=e.direction;return Object.entries(e.traffic?.[u]||{}).reduce((y,[$,w])=>[`${T}_cx_tx_bytes_total`,`${T}_cx_rx_bytes_total`].includes($)?{...y,[$]:w+(y[$]??0)}:y,l)},{})],(l,u)=>(d(),f(g,{key:u},[r("div",null,[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.tx")),1),n[5]||(n[5]=s()),r("dd",null,i(a(C)(l.downstream_cx_rx_bytes_total??0)),1)]),n[7]||(n[7]=s()),r("div",null,[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.rx")),1),n[6]||(n[6]=s()),r("dd",null,i(a(C)(l.downstream_cx_tx_bytes_total??0)),1)])],64))),128)):e.protocol==="grpc"?(d(),f(g,{key:1},[r("div",O,[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.grpc_success")),1),n[8]||(n[8]=s()),r("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.grpc?.success})),1)]),n[10]||(n[10]=s()),r("div",h,[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.grpc_failure")),1),n[9]||(n[9]=s()),r("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.grpc?.failure})),1)])],64)):e.protocol.startsWith("http")?(d(),f(g,{key:2},[(d(!0),f(g,null,S([e.traffic.http?.[`${e.direction}_rq_1xx`]??0].filter(l=>l!==0),l=>(d(),f("div",{key:l,"data-testid":"rq-1xx"},[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.1xx")),1),n[11]||(n[11]=s()),r("dd",null,i(a(t)("common.formats.integer",{value:l})),1)]))),128)),n[16]||(n[16]=s()),r("div",tt,[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.2xx")),1),n[12]||(n[12]=s()),r("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.http?.[`${e.direction}_rq_2xx`]})),1)]),n[17]||(n[17]=s()),(d(!0),f(g,null,S([e.traffic.http?.[`${e.direction}_rq_3xx`]??0].filter(l=>l!==0),l=>(d(),f("div",{key:l,"data-testid":"rq-3xx"},[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.3xx")),1),n[13]||(n[13]=s()),r("dd",null,i(a(t)("common.formats.integer",{value:l})),1)]))),128)),n[18]||(n[18]=s()),r("div",et,[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.4xx")),1),n[14]||(n[14]=s()),r("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.http?.[`${e.direction}_rq_4xx`]})),1)]),n[19]||(n[19]=s()),r("div",nt,[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.5xx")),1),n[15]||(n[15]=s()),r("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.http?.[`${e.direction}_rq_5xx`]})),1)])],64)):(d(),f(g,{key:3},[r("div",ot,[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.cx")),1),n[20]||(n[20]=s()),r("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.tcp?.[`${e.direction}_cx_total`]})),1)]),n[23]||(n[23]=s()),typeof e.traffic.tcp?.[`${e.direction}_cx_tx_bytes_total`]<"u"?(d(),f("div",rt,[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.rx")),1),n[21]||(n[21]=s()),r("dd",null,i(a(C)(e.traffic.tcp?.[`${e.direction}_cx_tx_bytes_total`])),1)])):b("",!0),n[24]||(n[24]=s()),typeof e.traffic.tcp?.[`${e.direction}_cx_rx_bytes_total`]<"u"?(d(),f("div",st,[r("dt",null,i(a(t)("data-planes.components.service_traffic_card.tx")),1),n[22]||(n[22]=s()),r("dd",null,i(a(C)(e.traffic.tcp?.[`${e.direction}_cx_rx_bytes_total`])),1)])):b("",!0)],64))]),_:1})):(d(),_(x,{key:2,variant:"line"}))]),_:3})}}}),_t=N(it,[["__scopeId","data-v-9435d286"]]),at={class:"body"},dt=M({__name:"ConnectionGroup",props:{type:{}},setup(o){const t=o;return(e,c)=>{const n=B("XCard");return d(),_(n,{class:L(["service-traffic-group",`type-${t.type}`])},{default:m(()=>[r("div",at,[p(e.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}}),mt=N(dt,[["__scopeId","data-v-25c74403"]]),lt={class:"service-traffic"},ct={class:"actions"},ft=M({__name:"ConnectionTraffic",setup(o){return(t,e)=>(d(),f("div",lt,[r("div",ct,[p(t.$slots,"actions",{},void 0,!0)]),e[0]||(e[0]=s()),D(X,{class:"header"},{title:m(()=>[p(t.$slots,"title",{},void 0,!0)]),_:3}),e[1]||(e[1]=s()),p(t.$slots,"default",{},void 0,!0)]))}}),gt=N(ft,[["__scopeId","data-v-e6bd176c"]]);export{gt as C,mt as a,_t as b};
