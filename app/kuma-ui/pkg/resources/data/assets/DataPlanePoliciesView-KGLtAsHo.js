import{A as K,a as O}from"./AccordionList-HIMftai2.js";import{d as S,a as k,o as e,c as t,m as r,f as l,F as p,H as g,t as d,e as u,w as a,q as N,b as m,X as Y,x as F,y as G,_ as j,p as B,l as z,n as J,a2 as Q}from"./index-vkXoigSS.js";import{C as H}from"./CodeBlock-JU5bOA4o.js";import{P as q}from"./PolicyTypeTag-OjJz7ODY.js";import{T as D}from"./TagList-pQR4JK-P.js";import{t as X}from"./toYaml-sPaYOD3i.js";import{A as U}from"./AppCollection-2pDS0G7A.js";const R=_=>(F("data-v-f3e7afbb"),_=_(),G(),_),W={class:"policies-list"},Z={class:"mesh-gateway-policy-list"},M=R(()=>r("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),E={key:0},ee=R(()=>r("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),te=R(()=>r("b",null,"Host",-1)),ae=R(()=>r("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),se={class:"dataplane-policy-header"},le=R(()=>r("b",null,"Route",-1)),ne=R(()=>r("b",null,"Service",-1)),oe={key:0,class:"badge-list"},ie={class:"mt-1"},ce=S({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},policyTypesByName:{}},setup(_){const h=_;return(f,L)=>{const w=k("RouterLink"),b=k("KBadge");return e(),t("div",W,[r("div",Z,[M,l(),f.gatewayDataplane.routePolicies.length>0?(e(),t("ul",E,[(e(!0),t(p,null,g(f.gatewayDataplane.routePolicies,(c,s)=>(e(),t("li",{key:s},[r("span",null,d(c.type),1),l(`:

          `),u(w,{to:{name:"policy-detail-view",params:{mesh:c.mesh,policyPath:h.policyTypesByName[c.type].path,policy:c.name}}},{default:a(()=>[l(d(c.name),1)]),_:2},1032,["to"])]))),128))])):N("",!0),l(),ee,l(),r("div",null,[(e(!0),t(p,null,g(f.gatewayDataplane.listenerEntries,(c,s)=>(e(),t("div",{key:s},[r("div",null,[r("div",null,[te,l(": "+d(c.hostName)+":"+d(c.port)+" ("+d(c.protocol)+`)
            `,1)]),l(),c.routeEntries.length>0?(e(),t(p,{key:0},[ae,l(),u(O,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),t(p,null,g(c.routeEntries,(o,n)=>(e(),m(K,{key:n},Y({"accordion-header":a(()=>[r("div",se,[r("div",null,[r("div",null,[le,l(": "),u(w,{to:{name:"policy-detail-view",params:{mesh:o.route.mesh,policyPath:h.policyTypesByName[o.route.type].path,policy:o.route.name}}},{default:a(()=>[l(d(o.route.name),1)]),_:2},1032,["to"])]),l(),r("div",null,[ne,l(": "+d(o.service),1)])]),l(),o.origins.length>0?(e(),t("div",oe,[(e(!0),t(p,null,g(o.origins,(i,y)=>(e(),m(b,{key:`${s}-${y}`},{default:a(()=>[l(d(i.type),1)]),_:2},1024))),128))])):N("",!0)])]),_:2},[o.origins.length>0?{name:"accordion-content",fn:a(()=>[r("ul",ie,[(e(!0),t(p,null,g(o.origins,(i,y)=>(e(),t("li",{key:`${s}-${y}`},[l(d(i.type)+`:

                        `,1),u(w,{to:{name:"policy-detail-view",params:{mesh:i.mesh,policyPath:h.policyTypesByName[i.type].path,policy:i.name}}},{default:a(()=>[l(d(i.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):N("",!0)])]))),128))])])])}}}),re=j(ce,[["__scopeId","data-v-f3e7afbb"]]),pe={class:"policy-type-heading"},ue={class:"policy-list"},de={key:0},me=S({__name:"PolicyTypeEntryList",props:{items:{},types:{}},setup(_){const h=_;function f({headerKey:L}){return{class:`cell-${L}`}}return(L,w)=>{const b=k("RouterLink"),c=k("KTable");return e(),m(O,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),t(p,null,g(L.items,(s,o)=>(e(),m(K,{key:o},{"accordion-header":a(()=>[r("h3",pe,[u(q,{"policy-type":s.type},{default:a(()=>[l(d(s.type)+" ("+d(s.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[r("div",ue,[u(c,{class:"policy-type-table",fetcher:()=>({data:s.connections,total:s.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":f,"disable-pagination":"","is-clickable":""},{sourceTags:a(({row:n})=>[n.sourceTags.length>0?(e(),m(D,{key:0,class:"tag-list","should-truncate":"",tags:n.sourceTags},null,8,["tags"])):(e(),t(p,{key:1},[l(`
                —
              `)],64))]),destinationTags:a(({row:n})=>[n.destinationTags.length>0?(e(),m(D,{key:0,class:"tag-list","should-truncate":"",tags:n.destinationTags},null,8,["tags"])):(e(),t(p,{key:1},[l(`
                —
              `)],64))]),name:a(({row:n})=>[n.name!==null?(e(),t(p,{key:0},[l(d(n.name),1)],64)):(e(),t(p,{key:1},[l(`
                —
              `)],64))]),origins:a(({row:n})=>[n.origins.length>0?(e(),t("ul",de,[(e(!0),t(p,null,g(n.origins,(i,y)=>(e(),t("li",{key:`${o}-${y}`},[u(b,{to:{name:"policy-detail-view",params:{mesh:i.mesh,policyPath:h.types[i.type].path,policy:i.name}}},{default:a(()=>[l(d(i.name),1)]),_:2},1032,["to"])]))),128))])):(e(),t(p,{key:1},[l(`
                —
              `)],64))]),config:a(({row:n})=>[n.config?(e(),m(H,{key:0,code:B(X)(n.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),t(p,{key:1},[l(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}}),_e=j(me,[["__scopeId","data-v-e683f129"]]),ye=_=>(F("data-v-cdc04375"),_=_(),G(),_),he={class:"policy-type-heading"},fe={key:0,class:"matcher"},ge={key:0,class:"matcher__and"},ke=ye(()=>r("br",null,null,-1)),be={key:1,class:"matcher__not"},$e={class:"matcher__term"},ve={key:1},Te={key:0},Ce=S({__name:"RuleEntryList",props:{rules:{},policyTypesByName:{}},setup(_){const{t:h}=z(),f=_;return(L,w)=>{const b=k("RouterLink");return e(),m(O,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),t(p,null,g([f.rules.reduce((c,s)=>(typeof c[s.type]>"u"&&(c[s.type]=[]),c[s.type].push(s),c),{})],c=>(e(),t(p,{key:c},[(e(!0),t(p,null,g(c,(s,o)=>(e(),m(K,{key:o},{"accordion-header":a(()=>[r("h3",he,[u(q,{"policy-type":o},{default:a(()=>[l(d(o),1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[(e(!0),t(p,null,g([s.some(n=>n.matchers.length>0)],n=>(e(),t("div",{key:n,class:"policy-list"},[u(U,{class:J(["policy-type-table",{"has-matchers":n}]),total:s.length,items:s,headers:[...n?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:a(({row:i})=>[i.matchers.length>0?(e(),t("span",fe,[(e(!0),t(p,null,g(i.matchers,({key:y,value:T,not:V},C)=>(e(),t(p,{key:C},[C>0?(e(),t("span",ge,[l(" and"),ke])):N("",!0),V?(e(),t("span",be,"!")):N("",!0),r("span",$e,d(`${y}:${T}`),1)],64))),128))])):(e(),t("i",ve,d(B(h)("data-planes.routes.item.matches_everything")),1))]),origins:a(({row:i})=>[i.origins.length>0?(e(),t("ul",Te,[(e(!0),t(p,null,g(i.origins,(y,T)=>(e(),t("li",{key:`${o}-${T}`},[u(b,{to:{name:"policy-detail-view",params:{mesh:y.mesh,policyPath:f.policyTypesByName[y.type].path,policy:y.name}}},{default:a(()=>[l(d(y.name),1)]),_:2},1032,["to"])]))),128))])):(e(),t(p,{key:1},[l(d(B(h)("common.collection.none")),1)],64))]),config:a(({row:i})=>[i.config?(e(),m(H,{key:0,code:B(X)(i.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),t(p,{key:1},[l(d(B(h)("common.collection.none")),1)],64))]),_:2},1032,["class","total","items","headers"])]))),128))]),_:2},1024))),128))],64))),128))]),_:1})}}}),I=j(Ce,[["__scopeId","data-v-cdc04375"]]),Pe={class:"stack"},Be={class:"mb-2"},we=S({__name:"StandardDataplanePolicies",props:{rules:{},policyTypesByName:{}},setup(_){const{t:h}=z(),f=_;return(L,w)=>{const b=k("KCard"),c=k("DataCollection");return e(),t("div",Pe,[u(c,{items:f.rules,predicate:s=>s.ruleType==="proxy",comparator:(s,o)=>s.type.localeCompare(o.type),empty:!1},{default:a(({items:s})=>[u(b,null,{default:a(()=>[r("h3",null,d(B(h)("data-planes.routes.item.proxy_rule")),1),l(),u(I,{class:"mt-2",rules:s,"policy-types-by-name":f.policyTypesByName,"data-testid":"proxy-rule-list"},null,8,["rules","policy-types-by-name"])]),_:2},1024)]),_:1},8,["items","predicate","comparator"]),l(),u(c,{items:f.rules,predicate:s=>s.ruleType==="to",comparator:(s,o)=>s.type.localeCompare(o.type),empty:!1},{default:a(({items:s})=>[u(b,null,{default:a(()=>[r("h3",null,d(B(h)("data-planes.routes.item.to_rules")),1),l(),u(I,{class:"mt-2",rules:s,"policy-types-by-name":f.policyTypesByName,"data-testid":"to-rule-list"},null,8,["rules","policy-types-by-name"])]),_:2},1024)]),_:1},8,["items","predicate","comparator"]),l(),u(c,{items:f.rules,predicate:s=>s.ruleType==="from",comparator:(s,o)=>s.type.localeCompare(o.type),empty:!1},{default:a(({items:s})=>[u(b,null,{default:a(()=>[r("h3",Be,d(B(h)("data-planes.routes.item.from_rules")),1),l(),(e(!0),t(p,null,g([s.reduce((o,n)=>{var i;return typeof((i=n.inbound)==null?void 0:i.port)<"u"&&(typeof o[n.inbound.port]>"u"&&(o[n.inbound.port]=[]),o[n.inbound.port].push(n)),o},{})],o=>(e(),t(p,{key:o},[(e(!0),t(p,null,g(Object.entries(o).sort(([n],[i])=>Number(i)-Number(n)),([n,i],y)=>(e(),t("div",{key:y},[r("h4",null,d(B(h)("data-planes.routes.item.port",{port:n})),1),l(),u(I,{class:"mt-2",rules:i,"policy-types-by-name":f.policyTypesByName,"data-testid":`from-rule-list-${y}`},null,8,["rules","policy-types-by-name","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:1},8,["items","predicate","comparator"])])}}}),Ne={class:"stack"},Le={key:0},je=S({__name:"DataPlanePoliciesView",props:{data:{}},setup(_){const h=_;return(f,L)=>{const w=k("RouteTitle"),b=k("DataCollection"),c=k("DataLoader"),s=k("KCard"),o=k("DataSource"),n=k("AppView"),i=k("RouteView");return e(),m(i,{name:"data-plane-policies-view",params:{mesh:"",dataPlane:""}},{default:a(({can:y,route:T,t:V})=>[u(n,null,{title:a(()=>[r("h2",null,[u(w,{title:V("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"])])]),default:a(()=>[l(),r("div",Ne,[u(o,{src:"/*/policy-types"},{default:a(({data:C,error:A})=>[u(c,{src:`/meshes/${T.params.mesh}/dataplanes/${T.params.dataPlane}/rules`,data:[C],errors:[A]},{default:a(({data:P})=>[P&&C?(e(),m(b,{key:0,items:P.rules},{default:a(()=>[u(we,{"policy-types-by-name":C.policies.reduce(($,v)=>Object.assign($,{[v.name]:v}),{}),rules:P.rules,"data-testid":"rules-based-policies"},null,8,["policy-types-by-name","rules"])]),_:2},1032,["items"])):N("",!0)]),_:2},1032,["src","data","errors"]),l(),y("use zones")?N("",!0):(e(),t("div",Le,[r("h3",null,d(V("data-planes.routes.item.legacy_policies")),1),l(),h.data.dataplaneType==="builtin"?(e(),m(c,{key:0,src:`/meshes/${T.params.mesh}/dataplanes/${T.params.dataPlane}/gateway-dataplane-policies`,data:[C],errors:[A]},{default:a(({data:P})=>[(e(!0),t(p,null,g([C.policies.reduce(($,v)=>Object.assign($,{[v.name]:v}),{})],$=>(e(),m(s,{key:$,class:"mt-4"},{default:a(()=>[P?(e(),m(b,{key:0,items:P.routePolicies},{default:a(()=>[P.listenerEntries.length===0?(e(),m(Q,{key:0})):(e(),m(re,{key:1,"policy-types-by-name":$,"gateway-dataplane":P,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["policy-types-by-name","gateway-dataplane"]))]),_:2},1032,["items"])):N("",!0)]),_:2},1024))),128))]),_:2},1032,["src","data","errors"])):(e(),m(c,{key:1,src:`/meshes/${T.params.mesh}/dataplanes/${T.params.dataPlane}/sidecar-dataplane-policies`,data:[C],errors:[A]},{default:a(({data:P})=>[(e(!0),t(p,null,g([C.policies.reduce(($,v)=>Object.assign($,{[v.name]:v}),{})],$=>(e(),m(s,{key:$,class:"mt-4"},{default:a(()=>[u(b,{predicate:v=>{var x;return((x=$[v.type])==null?void 0:x.isTargetRefBased)===!1},items:P.policyTypeEntries},{default:a(({items:v})=>[u(_e,{items:v,types:$,"data-testid":"sidecar-dataplane-policies"},null,8,["items","types"])]),_:2},1032,["predicate","items"])]),_:2},1024))),128))]),_:2},1032,["src","data","errors"]))]))]),_:2},1024)])]),_:2},1024)]),_:1})}}});export{je as default};
