import{L as A}from"./LoadingBox-1492158c.js";import{O,a as T,b as B}from"./OnboardingPage-c55a09e0.js";import{d as P,P as R,v as k,S,r as d,o as s,g,w as t,h as o,l as c,j as p,G as V,D as h,m as f,F as x,U as F,q as N}from"./index-ba2f01fe.js";import{g as E}from"./dataplane-0a086c06.js";const I={key:0,class:"status-loading-box mb-4"},L={key:1},C={class:"mb-4"},K=P({__name:"DataplanesOverview",setup($){const b=R(),D=[{label:"Mesh",key:"mesh"},{label:"Name",key:"name"},{label:"Status",key:"status"}],a=k({total:0,data:[]}),_=k(null);S(function(){w()}),y();function w(){_.value!==null&&window.clearTimeout(_.value)}async function y(){let i=!1;const v=[];try{const{items:n}=await b.getAllDataplanes({size:10});if(Array.isArray(n)&&n.length>0)for(const m of n){const{name:r,mesh:u}=m,l=await b.getDataplaneOverviewFromMesh({mesh:u,name:r}),e=E(l.dataplaneInsight);e==="offline"&&(i=!0),v.push({status:e,name:r,mesh:u})}else i=!0}catch(n){console.error(n)}a.value.data=v,a.value.total=a.value.data.length,i&&(w(),_.value=window.setTimeout(y,1e3))}return(i,v)=>{const n=d("RouteTitle"),m=d("KTable"),r=d("AppView"),u=d("RouteView");return s(),g(u,{name:"onboarding-dataplanes-overview"},{default:t(({t:l})=>[o(n,{title:l("onboarding.routes.dataplanes-overview.title")},null,8,["title"]),c(),o(r,null,{default:t(()=>[o(O,null,{header:t(()=>[(s(!0),p(x,null,V([a.value.data.length>0?"success":"waiting"],e=>(s(),g(T,{key:e,"data-testid":`state-${e}`},{title:t(()=>[c(h(l(`onboarding.routes.dataplanes-overview.header.${e}.title`)),1)]),description:t(()=>[f("p",null,h(l(`onboarding.routes.dataplanes-overview.header.${e}.description`)),1)]),_:2},1032,["data-testid"]))),128))]),content:t(()=>[a.value.data.length===0?(s(),p("div",I,[o(A)])):(s(),p("div",L,[f("p",C,[f("b",null,"Found "+h(a.value.data.length)+" DPPs:",1)]),c(),o(m,{class:"mb-4",fetcher:()=>a.value,headers:D,"disable-pagination":""},{status:t(({rowValue:e})=>[e?(s(),g(F,{key:0,status:e},null,8,["status"])):(s(),p(x,{key:1},[c(`
                  â€”
                `)],64))]),_:1},8,["fetcher"])]))]),navigation:t(()=>[o(B,{"next-step":"onboarding-completed","previous-step":"onboarding-add-services-code","should-allow-next":a.value.data.length>0},null,8,["should-allow-next"])]),_:2},1024)]),_:2},1024)]),_:1})}}});const q=N(K,[["__scopeId","data-v-87fb4342"]]);export{q as default};
