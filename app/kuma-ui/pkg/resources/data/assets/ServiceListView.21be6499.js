import{d as P,p as C,r as l,f as E,k as N,cB as z,o as S,c as T,w as x,a as L,z as R}from"./index.b0409b43.js";import{C as V}from"./ContentWrapper.84ef6907.js";import{p as B,D as M}from"./patchQueryParam.cab76542.js";import{S as O}from"./ServiceDetails.83249d52.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.6093e09e.js";import"./ErrorBlock.2d64b0cd.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.5ea0e82e.js";import"./TagList.94a6fc3d.js";import"./YamlView.ea929241.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.b9ac744a.js";import"./_commonjsHelpers.f037b798.js";const K=P({__name:"ServiceListView",props:{offset:{type:Number,required:!1,default:0}},setup(k){const d=k,w=[{label:"Service",key:"name"},{label:"Type",key:"serviceType"},{label:"Address",key:"address"},{label:"Status",key:"status"},{label:"DP proxies (online / total)",key:"dpProxiesStatus"}],f=50,A={title:"No Data",message:"There are no service insights present."},m=C(),c=l(!0),p=l(null),y=l(null),h=l(d.offset),t=l(null),o=l({headers:w,data:[]});E(()=>m.params.mesh,function(){m.name==="service-list-view"&&v(0)}),v(d.offset);async function v(e){h.value=e,B("offset",e>0?e:null),c.value=!0,p.value=null;const i=m.params.mesh,s=f;try{const{items:a=[],next:u}=await N.getAllServiceInsightsFromMesh({mesh:i},{size:s,offset:e});y.value=u,Array.isArray(a)&&a.length>0?(a.sort((r,n)=>r.name>n.name?1:r.name<n.name?-1:0),b(a[0]),o.value.data=a.map(r=>_(r))):(t.value=null,o.value.data=[])}catch(a){t.value=null,a instanceof Error?p.value=a:console.error(a)}finally{c.value=!1}}function _(e){var n;const i={name:e.serviceType==="external"?"external-service-detail-view":"service-insight-detail-view",params:{mesh:e.mesh,service:e.name}},s={name:"mesh-detail-view",params:{mesh:e.mesh}};let a="\u2014";if(e.dataplanes){const{online:D=0,total:g=0}=e.dataplanes;a=`${D} / ${g}`}let u="\u2014";e.status&&(u=z[e.status].title);const r=(n=e.serviceType)!=null?n:"internal";return{...e,serviceType:r,nameRoute:i,meshRoute:s,dpProxiesStatus:a,status:u}}function b(e){t.value=e}return(e,i)=>(S(),T(V,null,{content:x(()=>{var s;return[L(M,{"selected-entity-name":(s=t.value)==null?void 0:s.name,"page-size":f,error:p.value,"is-loading":c.value,"empty-state":A,"table-data":o.value,"table-data-is-empty":o.value.data.length===0,next:y.value,"page-offset":h.value,onTableAction:b,onLoadData:v},null,8,["selected-entity-name","error","is-loading","table-data","table-data-is-empty","next","page-offset"])]}),sidebar:x(()=>[t.value!==null?(S(),T(O,{key:0,name:t.value.name,mesh:t.value.mesh,"service-type":t.value.serviceType},null,8,["name","mesh","service-type"])):R("",!0)]),_:1}))}});export{K as default};
