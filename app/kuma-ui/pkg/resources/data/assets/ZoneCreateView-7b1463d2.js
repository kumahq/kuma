import{d as T,t as v,v as ae,V as re,o as f,j as $,m as t,h as i,w as r,g as h,i as e,H as U,aw as le,at as F,aA as ie,aB as ce,l as n,U as w,a3 as ue,L as O,e as H,f as E,D as o,z as j,B as W,q as J,R as de,aa as me,aC as q,r as X,A as pe,C as ve,a1 as Z,aD as fe,aE as _e,E as be,X as ze,k as A,F as x,N as M,aF as G,aG as ge,_ as ke}from"./index-cf0727dc.js";import{_ as y}from"./CodeBlock.vue_vue_type_style_index_0_lang-ca4abdee.js";import{g as he}from"./dataplane-30467516.js";const ye=["data-test-state"],Ee={class:"scanner-content"},Ce={class:"mr-1"},Ie=T({__name:"EntityScanner",props:{interval:{type:Number,required:!1,default:1e3},retries:{type:Number,required:!1,default:3600},hasError:{type:Boolean,default:!1},loaderFunction:{type:Function,required:!0},canComplete:{type:Boolean,default:!1}},emits:["hide-siblings"],setup(u,{emit:s}){const a=u,k=v(0),z=v(!1),_=v(!1),d=v(null);ae(function(){C()}),re(function(){m()});function C(){z.value=!0,_.value=!1,m(),d.value=window.setInterval(async()=>{k.value++,await a.loaderFunction(),(k.value===a.retries||a.canComplete===!0)&&(m(),z.value=!1,_.value=!0,s("hide-siblings",!0))},a.interval)}function m(){d.value!==null&&window.clearInterval(d.value)}return(g,S)=>(f(),$("div",{class:"scanner","data-test-state":z.value?"waiting":u.hasError?"error":"success"},[t("div",Ee,[i(e(ue),{"cta-is-hidden":""},{title:r(()=>[t("span",Ce,[z.value?(f(),h(e(U),{key:0,icon:"spinner",color:e(le),size:e(F)},null,8,["color","size"])):u.hasError?(f(),h(e(U),{key:1,icon:"errorFilled",color:e(ie),size:e(F)},null,8,["color","size"])):(f(),h(e(U),{key:2,icon:"circleCheck",color:e(ce),size:e(F)},null,8,["color","size"]))]),n(),z.value?w(g.$slots,"loading-title",{key:0}):u.hasError?w(g.$slots,"error-title",{key:1}):w(g.$slots,"complete-title",{key:2})]),message:r(()=>[z.value?w(g.$slots,"loading-content",{key:0}):u.hasError?w(g.$slots,"error-content",{key:1}):w(g.$slots,"complete-content",{key:2})]),_:3})])],8,ye))}}),V=u=>(j("data-v-c508bc46"),u=u(),W(),u),we=V(()=>t("span",{class:"step-number"},"1",-1)),$e={href:"https://helm.sh/docs/intro/install/"},Se=V(()=>t("span",{class:"step-number"},"2",-1)),Ne=V(()=>t("p",null,"On your local machine, create a namespace in your Kubernetes cluster and pull down the kong Helm repo.",-1)),Ze=V(()=>t("span",{class:"step-number"},"3",-1)),Ve=V(()=>t("span",{class:"step-number"},"4",-1)),qe={class:"k-input-label mt-4"},Ae={class:"mt-4"},Te=T({__name:"ZoneCreateKubernetesInstructions",props:{zoneName:{type:String,required:!0},globalKdsAddress:{type:String,required:!0},zoneIngressEnabled:{type:Boolean,required:!0},zoneEgressEnabled:{type:Boolean,required:!0},token:{type:String,required:!0},base64EncodedToken:{type:String,required:!0}},setup(u){const s=u,a=O(),k=H(),z=E(()=>a.t("zones.form.kubernetes.secret.createSecretCommand",{token:s.base64EncodedToken}).trim()),_=E(()=>{const d={zoneName:s.zoneName,globalKdsAddress:s.globalKdsAddress,zoneIngressEnabled:String(s.zoneIngressEnabled),zoneEgressEnabled:String(s.zoneEgressEnabled)};return typeof k.params.virtualControlPlaneId=="string"&&(d.controlPlaneId=k.params.virtualControlPlaneId),a.t("zones.form.kubernetes.connectZone.config",d).trim()});return(d,C)=>(f(),$("div",null,[t("h3",null,[we,n(" "+o(e(a).t("zones.form.kubernetes.prerequisites.title")),1)]),n(),t("ul",null,[t("li",null,[t("b",null,o(e(a).t("zones.form.kubernetes.prerequisites.step1Label"))+o(s.zoneIngressEnabled?" "+e(a).t("zones.form.kubernetes.prerequisites.step1LabelAddendum"):""),1),n(`:
        `+o(e(a).t("zones.form.kubernetes.prerequisites.step1Description",{productName:e(a).t("common.product.name")})),1)]),n(),t("li",null,[t("b",null,o(e(a).t("zones.form.kubernetes.prerequisites.step2Label")),1),n(`:
        `+o(e(a).t("zones.form.kubernetes.prerequisites.step2Description")),1)]),n(),t("li",null,[t("a",$e,o(e(a).t("zones.form.kubernetes.prerequisites.step3LinkTitle")),1),n(" "+o(e(a).t("zones.form.kubernetes.prerequisites.step3Tail")),1)])]),n(),t("h3",null,[Se,n(" "+o(e(a).t("zones.form.kubernetes.helm.title")),1)]),n(),Ne,n(),t("ol",null,[t("li",null,[n(o(e(a).t("zones.form.kubernetes.helm.step1Description"))+" ",1),i(y,{id:"zone-kubernetes-create-namespace",class:"mt-4",code:e(a).t("zones.form.kubernetes.helm.step1Command"),language:"bash"},null,8,["code"])]),n(),t("li",null,[n(o(e(a).t("zones.form.kubernetes.helm.step2Description"))+" ",1),i(y,{id:"zone-kubernetes-add-charts-repo",class:"mt-4",code:e(a).t("zones.form.kubernetes.helm.step2Command"),language:"bash"},null,8,["code"])]),n(),t("li",null,[n(o(e(a).t("zones.form.kubernetes.helm.step3Description"))+" ",1),i(y,{id:"zone-kubernetes-repo-update",class:"mt-4",code:e(a).t("zones.form.kubernetes.helm.step3Command"),language:"bash"},null,8,["code"])])]),n(),t("h3",null,[Ze,n(" "+o(e(a).t("zones.form.kubernetes.secret.title")),1)]),n(),t("p",null,o(e(a).t("zones.form.kubernetes.secret.createSecretDescription")),1),n(),i(y,{id:"zone-kubernetes-create-secret",class:"mt-4",code:z.value,language:"bash"},null,8,["code"]),n(),t("h3",null,[Ve,n(" "+o(e(a).t("zones.form.kubernetes.connectZone.title")),1)]),n(),t("p",null,o(e(a).t("zones.form.kubernetes.connectZone.configDescription")),1),n(),t("span",qe,o(e(a).t("zones.form.kubernetes.connectZone.configFileName")),1),n(),i(y,{id:"zone-kubernetes-config-code-block","data-testid":"zone-kubernetes-config",code:_.value,language:"yaml"},null,8,["code"]),n(),t("p",Ae,o(e(a).t("zones.form.kubernetes.connectZone.connectDescription")),1),n(),i(y,{id:"zone-kubernetes-command-code-block",class:"mt-4",code:e(a).t("zones.form.kubernetes.connectZone.connectCommand").trim(),language:"bash"},null,8,["code"])]))}});const De=J(Te,[["__scopeId","data-v-c508bc46"]]),Q=u=>(j("data-v-7b3b73f1"),u=u(),W(),u),Le=Q(()=>t("span",{class:"step-number"},"1",-1)),Ke=Q(()=>t("span",{class:"step-number"},"2",-1)),Be={class:"k-input-label mt-4"},Ue={class:"mt-4"},Fe=T({__name:"ZoneCreateUniversalInstructions",props:{zoneName:{type:String,required:!0},globalKdsAddress:{type:String,required:!0},token:{type:String,required:!0}},setup(u){const s=u,a=O(),k=H(),z=E(()=>a.t("zones.form.universal.saveToken.saveTokenCommand",{token:s.token}).trim()),_=E(()=>{const d={zoneName:s.zoneName,globalKdsAddress:s.globalKdsAddress};return typeof k.params.virtualControlPlaneId=="string"&&(d.controlPlaneId=k.params.virtualControlPlaneId),a.t("zones.form.universal.connectZone.config",d).trim()});return(d,C)=>(f(),$("div",null,[t("h3",null,[Le,n(" "+o(e(a).t("zones.form.universal.saveToken.title")),1)]),n(),t("p",null,o(e(a).t("zones.form.universal.saveToken.saveTokenDescription")),1),n(),i(y,{id:"zone-kubernetes-token",class:"mt-4",code:z.value,language:"bash"},null,8,["code"]),n(),t("h3",null,[Ke,n(" "+o(e(a).t("zones.form.universal.connectZone.title")),1)]),n(),t("p",null,o(e(a).t("zones.form.universal.connectZone.configDescription")),1),n(),t("span",Be,o(e(a).t("zones.form.universal.connectZone.configFileName")),1),n(),i(y,{id:"zone-universal-config-code-block","data-testid":"zone-universal-config",class:"mt-4",code:_.value,language:"yaml"},null,8,["code"]),n(),t("p",Ue,o(e(a).t("zones.form.universal.connectZone.connectDescription")),1),n(),i(y,{id:"zone-universal-connect-command-code-block",class:"mt-4",code:e(a).t("zones.form.universal.connectZone.connectCommand").trim(),language:"bash"},null,8,["code"])]))}});const xe=J(Fe,[["__scopeId","data-v-7b3b73f1"]]),Oe={class:"form-wrapper"},Re={class:"form"},Pe={class:"form-title"},Xe={class:"form-section"},Me={class:"form-section__header"},Ge={class:"form-section-title"},He={class:"form-section__content"},je={class:"form-section","data-testid":"connect-zone-instructions"},We={class:"form-section__header"},Je={class:"form-section-title"},Qe={class:"form-section__content"},Ye={class:"k-input-label"},en={class:"radio-button-group"},nn={class:"mt-4"},tn={class:"k-input-label"},on={class:"radio-button-group"},sn={class:"mt-4"},an={class:"k-input-label"},rn={class:"radio-button-group"},ln={class:"form-section"},cn={class:"form-section__header"},un={class:"form-section-title"},dn={class:"form-section__content"},mn={class:"form-section"},pn={class:"form-section__header"},vn={class:"form-section-title"},fn={class:"form-section__content"},_n={class:"mt-2"},kn=T({__name:"ZoneCreateView",setup(u){const{t:s}=O(),a=de(),k=me(),z=/^(?![-0-9])[a-z0-9-]{1,63}$/,_=v(null),d=v(!1),C=v(!1),m=v({error:null,title:null,icon:"warning",badgeAppearance:"warning"}),g=v(null),S=v(!1),D=v(null),b=v(""),I=v("kubernetes"),L=v(!0),K=v(!0),N=E(()=>_.value!==null&&_.value.token?_.value.token:""),Y=E(()=>N.value!==""?window.btoa(N.value):""),ee=E(()=>b.value===""||d.value||_.value!==null),B=E(()=>{if(g.value!==null)return g.value;if(m.value.error instanceof q){const l=m.value.error.invalidParameters.find(c=>c.field==="name");if(l!==void 0)return l.reason}return null});async function ne(){d.value=!0,m.value={error:null,title:null,icon:"warning",badgeAppearance:"warning"};try{if(!R(b.value))return;_.value=await a.createZone({name:b.value})}catch(l){l instanceof q&&[409,500].includes(l.status)?m.value={error:l,title:s(`zones.create.statusError.${l.status}.title`,{zoneName:b.value}),description:s(`zones.create.statusError.${l.status}.description`).trim(),icon:l.status===500?"warning":"errorFilled",badgeAppearance:l.status===500?"warning":"danger"}:l instanceof Error?m.value={error:l,title:l instanceof q?l.title:s("zones.create.generalError.title"),description:l instanceof q&&l.detail?l.detail:void 0,icon:"errorFilled",badgeAppearance:"danger"}:console.error(l)}finally{d.value=!1}}function R(l){const c=z.test(l);return c?g.value=null:g.value=s("zones.create.invalidNameError"),c}async function te(){S.value=!1,D.value=null;try{const l=await a.getZoneOverview({name:b.value}),c=he(l.zoneInsight);S.value=c==="online"}catch(l){l instanceof Error?D.value=l:console.error(l)}}function P(){C.value=!C.value}return(l,c)=>{const oe=X("DataSource"),se=X("KCard");return f(),h(ke,{attrs:{class:"is-fullscreen"}},{default:r(()=>[i(pe,{fullscreen:!0,breadcrumbs:[]},{title:r(()=>[t("h1",null,[i(ve,{title:e(s)("zones.routes.create.title"),render:!0},null,8,["title"])])]),actions:r(()=>[N.value===""||S.value?(f(),h(e(Z),{key:0,appearance:"outline","data-testid":"exit-button",to:{name:"zone-cp-list-view"}},{default:r(()=>[n(o(e(s)("zones.form.exit")),1)]),_:1})):(f(),h(e(Z),{key:1,appearance:"outline","data-testid":"exit-button",onClick:P},{default:r(()=>[n(o(e(s)("zones.form.exit")),1)]),_:1}))]),default:r(()=>[n(),n(),t("div",Oe,[i(se,null,{body:r(()=>[t("div",Re,[t("div",null,[t("h1",Pe,o(e(s)("zones.routes.create.title")),1)]),n(),t("div",Xe,[t("div",Me,[t("h2",Ge,o(e(s)("zones.form.section.name.title")),1)]),n(),t("div",He,[t("div",null,[i(e(fe),{for:"zone-name",required:"","tooltip-attributes":{placement:"right"}},{tooltip:r(()=>[n(o(e(s)("zones.form.name_tooltip")),1)]),default:r(()=>[n(o(e(s)("zones.form.nameLabel"))+" ",1)]),_:1}),n(),i(e(_e),{id:"zone-name",modelValue:b.value,"onUpdate:modelValue":c[0]||(c[0]=p=>b.value=p),type:"text",name:"zone-name","data-testid":"name-input","data-test-error-type":B.value!==null?"invalid-dns-name":void 0,"has-error":B.value!==null,"error-message":B.value??void 0,disabled:_.value!==null,onBlur:c[1]||(c[1]=p=>R(b.value))},null,8,["modelValue","data-test-error-type","has-error","error-message","disabled"])]),n(),i(e(Z),{appearance:"primary",class:"mt-4",icon:d.value?"spinner":"plus",disabled:ee.value,"data-testid":"create-zone-button",onClick:ne},{default:r(()=>[n(o(e(s)("zones.form.createZoneButtonLabel")),1)]),_:1},8,["icon","disabled"]),n(),m.value.error!==null?(f(),h(be,{key:0,class:"mt-4",error:m.value.error,"badge-appearance":m.value.badgeAppearance,icon:m.value.icon,"data-testid":"create-zone-error"},ze({default:r(()=>[t("p",null,o(m.value.title),1),n()]),_:2},[m.value.description?{name:"message",fn:r(()=>[t("p",null,o(m.value.description),1)]),key:"0"}:void 0]),1032,["error","badge-appearance","icon"])):A("",!0)])]),n(),_.value!==null?(f(),$(x,{key:0},[t("div",je,[t("div",We,[t("h2",Je,o(e(s)("zones.form.section.configuration.title")),1)]),n(),t("div",Qe,[t("div",null,[t("span",Ye,o(e(s)("zones.form.environmentLabel"))+` *
                      `,1),n(),t("div",en,[i(e(M),{id:"zone-environment-universal",modelValue:I.value,"onUpdate:modelValue":c[2]||(c[2]=p=>I.value=p),"selected-value":"universal",name:"zone-environment","data-testid":"environment-universal-radio-button"},{default:r(()=>[n(o(e(s)("zones.form.universalLabel")),1)]),_:1},8,["modelValue"]),n(),i(e(M),{id:"zone-environment-kubernetes",modelValue:I.value,"onUpdate:modelValue":c[3]||(c[3]=p=>I.value=p),"selected-value":"kubernetes",name:"zone-environment","data-testid":"environment-kubernetes-radio-button"},{default:r(()=>[n(o(e(s)("zones.form.kubernetesLabel")),1)]),_:1},8,["modelValue"])])]),n(),I.value==="kubernetes"?(f(),$(x,{key:0},[t("div",nn,[t("span",tn,o(e(s)("zones.form.zoneIngressLabel"))+` *
                        `,1),n(),t("div",on,[i(e(G),{id:"zone-ingress-enabled",modelValue:L.value,"onUpdate:modelValue":c[4]||(c[4]=p=>L.value=p),"data-testid":"ingress-input-switch"},{label:r(()=>[n(o(e(s)("zones.form.zoneIngressEnabledLabel")),1)]),_:1},8,["modelValue"])])]),n(),t("div",sn,[t("span",an,o(e(s)("zones.form.zoneEgressLabel"))+` *
                        `,1),n(),t("div",rn,[i(e(G),{id:"zone-egress-enabled",modelValue:K.value,"onUpdate:modelValue":c[5]||(c[5]=p=>K.value=p),"data-testid":"egress-input-switch"},{label:r(()=>[n(o(e(s)("zones.form.zoneEgressEnabledLabel")),1)]),_:1},8,["modelValue"])])])],64)):A("",!0)])]),n(),t("div",ln,[t("div",cn,[t("h2",un,o(e(s)("zones.form.section.connect_zone.title")),1)]),n(),t("div",dn,[i(oe,{src:"/control-plane/addresses"},{default:r(({data:p})=>[typeof p<"u"?(f(),$(x,{key:0},[I.value==="universal"?(f(),h(xe,{key:0,"zone-name":b.value,token:N.value,"global-kds-address":p.kds},null,8,["zone-name","token","global-kds-address"])):(f(),h(De,{key:1,"zone-name":b.value,"zone-ingress-enabled":L.value,"zone-egress-enabled":K.value,token:N.value,"base64-encoded-token":Y.value,"global-kds-address":p.kds},null,8,["zone-name","zone-ingress-enabled","zone-egress-enabled","token","base64-encoded-token","global-kds-address"]))],64)):A("",!0)]),_:1})])]),n(),t("div",mn,[t("div",pn,[t("h2",vn,o(e(s)("zones.form.section.scanner.title")),1)]),n(),t("div",fn,[i(Ie,{"loader-function":te,"has-error":D.value!==null,"can-complete":S.value,"data-testid":"zone-connected-scanner"},{"loading-title":r(()=>[n(o(e(s)("zones.form.scan.waitTitle")),1)]),"complete-title":r(()=>[n(o(e(s)("zones.form.scan.completeTitle")),1)]),"complete-content":r(()=>[t("p",null,o(e(s)("zones.form.scan.completeDescription",{name:b.value})),1),n(),t("p",_n,[i(e(Z),{appearance:"primary",to:{name:"zone-cp-detail-view",params:{zone:b.value}}},{default:r(()=>[n(o(e(s)("zones.form.scan.completeButtonLabel",{name:b.value})),1)]),_:1},8,["to"])])]),"error-title":r(()=>[t("h3",null,o(e(s)("zones.form.scan.errorTitle")),1)]),"error-content":r(()=>[t("p",null,o(e(s)("zones.form.scan.errorDescription")),1)]),_:1},8,["has-error","can-complete"])])])],64)):A("",!0)])]),_:1})]),n(),i(e(ge),{"is-visible":C.value,title:e(s)("zones.form.confirm_modal.title"),"data-testid":"confirm-exit-modal",onCanceled:P,onProceed:c[6]||(c[6]=p=>e(k).push({name:"zone-cp-list-view"}))},{"header-content":r(()=>[n(o(e(s)("zones.form.confirm_modal.title")),1)]),"body-content":r(()=>[n(o(e(s)("zones.form.confirm_modal.body")),1)]),"action-buttons":r(()=>[i(e(Z),{appearance:"primary",to:{name:"zone-cp-list-view"},"data-testid":"confirm-exit-button"},{default:r(()=>[n(o(e(s)("zones.form.confirm_modal.action_button")),1)]),_:1})]),_:1},8,["is-visible","title"])]),_:1})]),_:1})}}});export{kn as default};
