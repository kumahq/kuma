import{_ as T,r as q,p as y,o as l,w as $,l as o,e as n,a as g,d as w,k as J,c,q as b,t as i,N as p,L as x,m as a,n as Q,b as R}from"./index-CVAY3lZR.js";import{T as O}from"./TagList-D7QxCkyA.js";const h=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],tt=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],et=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],rt=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],z=(s,e,r)=>{let m=s;return typeof e=="string"||Array.isArray(e)?m=s.toLocaleString(e,r):(e===!0||r!==void 0)&&(m=s.toLocaleString(void 0,r)),m},K=s=>{if(typeof s=="number")return Math.log10(s);const e=s.toString(10);return e.length+Math.log10("0."+e.slice(0,15))},ot=s=>typeof s=="number"?Math.log(s):K(s)*Math.log(10),st=(s,e)=>{if(typeof s=="number")return s/e;const r=s/BigInt(e),m=s%BigInt(e);return Number(r)+Number(m)/e};function N(s,e){if(typeof s!="bigint"&&!Number.isFinite(s))throw new TypeError(`Expected a finite number, got ${typeof s}: ${s}`);e={bits:!1,binary:!1,space:!0,...e};const r=e.bits?e.binary?rt:et:e.binary?tt:h,m=e.space?" ":"";if(e.signed&&(typeof s=="number"?s===0:s===0n))return` 0${m}${r[0]}`;const _=s<0,t=_?"-":e.signed?"+":"";_&&(s=-s);let u;if(e.minimumFractionDigits!==void 0&&(u={minimumFractionDigits:e.minimumFractionDigits}),e.maximumFractionDigits!==void 0&&(u={maximumFractionDigits:e.maximumFractionDigits,...u}),s<1){const C=z(s,e.locale,u);return t+C+m+r[0]}const v=Math.min(Math.floor(e.binary?ot(s)/Math.log(1024):K(s)/3),r.length-1);s=st(s,(e.binary?1024:1e3)**v),u||(s=s.toPrecision(3));const k=z(Number(s),e.locale,u),B=r[v];return t+k+m+B}const nt={},it={class:"card"},at={class:"title"},dt={class:"body"};function lt(s,e){const r=q("XCard");return l(),y(r,{class:"data-card"},{default:$(()=>[o("dl",null,[o("div",it,[o("dt",at,[g(s.$slots,"title",{},void 0,!0)]),e[0]||(e[0]=n()),o("dd",dt,[g(s.$slots,"default",{},void 0,!0)])])])]),_:3})}const W=T(nt,[["render",lt],["__scopeId","data-v-719ec237"]]),ct={class:"title"},ft={key:0},ut={key:1},pt={"data-testid":"grpc-success"},mt={"data-testid":"grpc-failure"},_t={"data-testid":"rq-mtls"},vt={"data-testid":"rq-no-mtls"},gt={"data-testid":"rq-2xx"},xt={"data-testid":"rq-4xx"},yt={"data-testid":"rq-5xx"},$t={"data-testid":"rq-mtls"},bt={"data-testid":"rq-no-mtls"},kt={"data-testid":"connections-total"},Bt={key:0,"data-testid":"bytes-received"},Ct={key:1,"data-testid":"bytes-sent"},Nt={"data-testid":"rq-mtls"},qt={"data-testid":"rq-no-mtls"},Tt=w({__name:"ConnectionCard",props:{protocol:{},service:{default:""},traffic:{default:void 0},direction:{default:"downstream"},portName:{default:void 0}},setup(s){const{t:e}=J(),r=s,m=_=>{const t=_.target;if(_.isTrusted&&t.nodeName.toLowerCase()!=="a"){const u=t.closest(".service-traffic-card, a");if(u){const v=u.nodeName.toLowerCase()==="a"?u:u.querySelector("[data-action]");v!==null&&"click"in v&&typeof v.click=="function"&&v.click()}}};return(_,t)=>{const u=q("XBadge"),v=q("XProgress");return l(),y(W,{class:"service-traffic-card",onClick:m},{title:$(()=>[r.service.length>0?(l(),y(O,{key:0,tags:[{label:"kuma.io/service",value:r.service}]},null,8,["tags"])):b("",!0),t[1]||(t[1]=n()),o("div",ct,[r.protocol!==""?(l(),y(u,{key:0,class:"protocol",appearance:r.protocol==="passthrough"?"success":"info"},{default:$(()=>[n(i(a(e)(`data-planes.components.service_traffic_card.protocol.${r.protocol}`,{},{defaultMessage:a(e)(`http.api.value.${r.protocol}`)})),1)]),_:1},8,["appearance"])):b("",!0),t[0]||(t[0]=n()),g(_.$slots,"default",{},void 0,!0)])]),default:$(()=>{var k,B,C,E,I,D,F,L,P,X,G,Y,U,j,V;return[t[36]||(t[36]=n()),r.portName?(l(),c("dl",ft,[o("div",null,[t[2]||(t[2]=o("dt",null,"Name",-1)),t[3]||(t[3]=n()),o("dd",null,i(r.portName),1)])])):b("",!0),t[37]||(t[37]=n()),r.traffic?(l(),c("dl",ut,[r.protocol==="passthrough"?(l(!0),c(p,{key:0},x([["http","tcp"].reduce((d,f)=>{var A;const Z=r.direction;return Object.entries(((A=r.traffic)==null?void 0:A[f])||{}).reduce((S,[M,H])=>[`${Z}_cx_tx_bytes_total`,`${Z}_cx_rx_bytes_total`].includes(M)?{...S,[M]:H+(S[M]??0)}:S,d)},{})],(d,f)=>(l(),c(p,{key:f},[o("div",null,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.tx")),1),t[4]||(t[4]=n()),o("dd",null,i(a(N)(d.downstream_cx_rx_bytes_total??0)),1)]),t[6]||(t[6]=n()),o("div",null,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.rx")),1),t[5]||(t[5]=n()),o("dd",null,i(a(N)(d.downstream_cx_tx_bytes_total??0)),1)])],64))),128)):r.protocol==="grpc"?(l(),c(p,{key:1},[o("div",pt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.grpc_success")),1),t[7]||(t[7]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:(k=r.traffic.grpc)==null?void 0:k.success})),1)]),t[12]||(t[12]=n()),o("div",mt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.grpc_failure")),1),t[8]||(t[8]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:(B=r.traffic.grpc)==null?void 0:B.failure})),1)]),t[13]||(t[13]=n()),(l(!0),c(p,null,x([Object.values(((C=r.traffic.http)==null?void 0:C.rbac)??{}).reduce((d,f)=>d+f,0)],d=>{var f;return l(),c(p,{key:typeof d},[o("div",_t,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.mtls")),1),t[9]||(t[9]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:d})),1)]),t[11]||(t[11]=n()),o("div",vt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.no-mtls")),1),t[10]||(t[10]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:(((f=r.traffic.http)==null?void 0:f.rq_total)??0)-d})),1)])],64)}),128))],64)):r.protocol.startsWith("http")?(l(),c(p,{key:2},[(l(!0),c(p,null,x([((E=r.traffic.http)==null?void 0:E[`${r.direction}_rq_1xx`])??0].filter(d=>d!==0),d=>(l(),c("div",{key:d,"data-testid":"rq-1xx"},[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.1xx")),1),t[14]||(t[14]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:d})),1)]))),128)),t[22]||(t[22]=n()),o("div",gt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.2xx")),1),t[15]||(t[15]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:(I=r.traffic.http)==null?void 0:I[`${r.direction}_rq_2xx`]})),1)]),t[23]||(t[23]=n()),(l(!0),c(p,null,x([((D=r.traffic.http)==null?void 0:D[`${r.direction}_rq_3xx`])??0].filter(d=>d!==0),d=>(l(),c("div",{key:d,"data-testid":"rq-3xx"},[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.3xx")),1),t[16]||(t[16]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:d})),1)]))),128)),t[24]||(t[24]=n()),o("div",xt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.4xx")),1),t[17]||(t[17]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:(F=r.traffic.http)==null?void 0:F[`${r.direction}_rq_4xx`]})),1)]),t[25]||(t[25]=n()),o("div",yt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.5xx")),1),t[18]||(t[18]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:(L=r.traffic.http)==null?void 0:L[`${r.direction}_rq_5xx`]})),1)]),t[26]||(t[26]=n()),(l(!0),c(p,null,x([Object.values(((P=r.traffic.http)==null?void 0:P.rbac)??{}).reduce((d,f)=>d+f,0)],d=>{var f;return l(),c(p,{key:typeof d},[o("div",$t,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.mtls")),1),t[19]||(t[19]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:d})),1)]),t[21]||(t[21]=n()),o("div",bt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.no-mtls")),1),t[20]||(t[20]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:(((f=r.traffic.http)==null?void 0:f.rq_total)??0)-d})),1)])],64)}),128))],64)):(l(),c(p,{key:3},[o("div",kt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.cx")),1),t[27]||(t[27]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:(X=r.traffic.tcp)==null?void 0:X[`${r.direction}_cx_total`]})),1)]),t[33]||(t[33]=n()),typeof((G=r.traffic.tcp)==null?void 0:G[`${r.direction}_cx_tx_bytes_total`])<"u"?(l(),c("div",Bt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.rx")),1),t[28]||(t[28]=n()),o("dd",null,i(a(N)((Y=r.traffic.tcp)==null?void 0:Y[`${r.direction}_cx_tx_bytes_total`])),1)])):b("",!0),t[34]||(t[34]=n()),typeof((U=r.traffic.tcp)==null?void 0:U[`${r.direction}_cx_rx_bytes_total`])<"u"?(l(),c("div",Ct,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.tx")),1),t[29]||(t[29]=n()),o("dd",null,i(a(N)((j=r.traffic.tcp)==null?void 0:j[`${r.direction}_cx_rx_bytes_total`])),1)])):b("",!0),t[35]||(t[35]=n()),(l(!0),c(p,null,x([Object.values(((V=r.traffic.tcp)==null?void 0:V.rbac)??{}).reduce((d,f)=>d+f,0)],d=>{var f;return l(),c(p,{key:typeof d},[o("div",Nt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.mtls")),1),t[30]||(t[30]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:d})),1)]),t[32]||(t[32]=n()),o("div",qt,[o("dt",null,i(a(e)("data-planes.components.service_traffic_card.no-mtls")),1),t[31]||(t[31]=n()),o("dd",null,i(a(e)("common.formats.integer",{value:(((f=r.traffic.tcp)==null?void 0:f[`${r.direction}_cx_total`])??0)-d})),1)])],64)}),128))],64))])):(l(),y(v,{key:2,variant:"line"}))]}),_:3,__:[36,37]})}}}),Lt=T(Tt,[["__scopeId","data-v-603c7f95"]]),St={class:"body"},Mt=w({__name:"ConnectionGroup",props:{type:{}},setup(s){const e=s;return(r,m)=>{const _=q("XCard");return l(),y(_,{class:Q(["service-traffic-group",`type-${e.type}`])},{default:$(()=>[o("div",St,[g(r.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}}),Pt=T(Mt,[["__scopeId","data-v-25c74403"]]),wt={class:"service-traffic"},Et={class:"actions"},It=w({__name:"ConnectionTraffic",setup(s){return(e,r)=>(l(),c("div",wt,[o("div",Et,[g(e.$slots,"actions",{},void 0,!0)]),r[0]||(r[0]=n()),R(W,{class:"header"},{title:$(()=>[g(e.$slots,"title",{},void 0,!0)]),_:3}),r[1]||(r[1]=n()),g(e.$slots,"default",{},void 0,!0)]))}}),Xt=T(It,[["__scopeId","data-v-e6bd176c"]]);export{Xt as C,Pt as a,Lt as b};
