import{d as H,o as c,k as T,w as n,a as f,u as a,b as Y,e as o,E as K,l as Z,C as ee,ai as ae,m as te,i as se,r as l,j as R,n as F,P as M,t as le,J as ne,c as q,X as oe,x as E,aj as re,g as p,y as x,a9 as O,F as ie,z as ue,N as ce,O as pe,H as me}from"./index-e096fb01.js";import{_ as ye}from"./PolicyConnections.vue_vue_type_script_setup_true_lang-94808375.js";import{D as de}from"./DataOverview-8ec2eb8a.js";import{F as ve}from"./FrameSkeleton-f310b9e4.js";import{_ as fe}from"./LabelList.vue_vue_type_style_index_0_lang-4dec2f30.js";import{T as he}from"./TabsWidget-760376e0.js";import{_ as _e}from"./YamlView.vue_vue_type_script_setup_true_lang-8340ad04.js";import{Q as B}from"./QueryParameter-70743f73.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-467e5ff3.js";import"./ErrorBlock-e347ad5a.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-7adf9901.js";import"./TagList-91f2b0bd.js";import"./StatusBadge-79f7109b.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-25903ab0.js";import"./toYaml-4e00099e.js";const ge=H({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(m){const r=m;return(D,$)=>(c(),T(a(K),{class:"docs-link",appearance:"outline",target:"_blank",to:r.href},{default:n(()=>[f(a(Y),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),o(`

    Documentation
  `)]),_:1},8,["to"]))}}),be=m=>(ce("data-v-c8381067"),m=m(),pe(),m),Pe={key:0,class:"mb-4"},ke=be(()=>p("p",null,[p("strong",null,"Warning"),o(` This policy is experimental. If you encountered any problem please open an
            `),p("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),we={class:"entity-heading","data-testid":"policy-single-entity"},Ee={"data-testid":"policy-overview-tab"},Se=H({__name:"PolicyListView",props:{selectedPolicyName:{type:String,required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(m){const r=m,D=Z(),$=ee(),Q=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],W=ae(),h=te(),N=se(),_=l(!0),g=l(!1),y=l(null),d=l(!0),v=l(!1),b=l(!1),S=l(!1),P=l({}),k=l(null),C=l(null),U=l(r.offset),V=l({headers:[{label:"Name",key:"name"},{label:"Type",key:"type"}],data:[]}),i=R(()=>N.state.policyTypesByPath[r.policyPath]),j=R(()=>N.state.policyTypes.map(e=>({label:e.name,value:e.path,selected:e.path===r.policyPath}))),G=R(()=>N.state.policyTypes.filter(e=>(N.state.sidebar.insights.mesh.policies[e.name]??0)===0).map(e=>e.name));F(()=>h.params.mesh,function(){h.name===r.policyPath&&(_.value=!0,g.value=!1,d.value=!0,v.value=!1,b.value=!1,S.value=!1,y.value=null,L(0))}),F(()=>h.query.ns,function(){_.value=!0,g.value=!1,d.value=!0,v.value=!1,b.value=!1,S.value=!1,y.value=null,L(0)}),L(r.offset);async function L(e){U.value=e,B.set("offset",e>0?e:null),_.value=!0,y.value=null;const s=h.query.ns||null,t=h.params.mesh,w=i.value.path;try{let u;if(t!==null&&s!==null)u=[await D.getSinglePolicyEntity({mesh:t,path:w,name:s})],C.value=null;else{const A={size:M,offset:e},I=await D.getAllPolicyEntitiesFromMesh({mesh:t,path:w},A);u=I.items??[],C.value=I.next}if(u.length>0){V.value.data=u.map(I=>X(I)),S.value=!1,g.value=!1;const A=r.selectedPolicyName??u[0].name;await z({name:A,mesh:t,path:w})}else V.value.data=[],S.value=!0,g.value=!0,v.value=!0}catch(u){u instanceof Error?y.value=u:console.error(u),g.value=!0}finally{_.value=!1,d.value=!1}}function J(e){W.push({name:"policy",params:{...h.params,policyPath:e.value}})}function X(e){if(!e.mesh)return e;const s=e,t={name:"mesh-detail-view",params:{mesh:e.mesh}};return s.meshRoute=t,s}async function z(e){b.value=!1,d.value=!0,v.value=!1;try{const s=await D.getSinglePolicyEntity({mesh:e.mesh,path:i.value.path,name:e.name});if(s){const t=["type","name","mesh"];P.value=le(s,t),B.set("policy",P.value.name),k.value=ne(s)}else P.value={},v.value=!0}catch(s){b.value=!0,console.error(s)}finally{d.value=!1}}return(e,s)=>a(i)?(c(),q("div",{key:0,class:O(["relative",a(i).path])},[a(i).isExperimental?(c(),q("div",Pe,[f(a(oe),{appearance:"warning"},{alertMessage:n(()=>[ke]),_:1})])):E("",!0),o(),f(ve,null,{default:n(()=>[f(de,{"selected-entity-name":P.value.name,"page-size":a(M),error:y.value,"is-loading":_.value,"empty-state":{title:"No Data",message:`There are no ${a(i).name} policies present.`},"table-data":V.value,"table-data-is-empty":S.value,next:C.value,"page-offset":U.value,onTableAction:z,onLoadData:L},{additionalControls:n(()=>[f(a(re),{label:"Policies",items:a(j),"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:J},{"item-template":n(({item:t})=>[p("span",{class:O({"policy-type-empty":a(G).includes(t.label)})},x(t.label),3)]),_:1},8,["items"]),o(),f(ge,{href:`${a($)("KUMA_DOCS_URL")}/policies/${a(i).path}/?${a($)("KUMA_UTM_QUERY_PARAMS")}`,"data-testid":"policy-documentation-link"},null,8,["href"]),o(),e.$route.query.ns?(c(),T(a(K),{key:0,class:"back-button",appearance:"primary",icon:"arrowLeft",to:{name:"policy",params:{policyPath:r.policyPath}}},{default:n(()=>[o(`
            View all
          `)]),_:1},8,["to"])):E("",!0)]),default:n(()=>[o(`
        >
        `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"]),o(),g.value===!1?(c(),T(he,{key:0,"has-error":y.value!==null,error:y.value,"is-loading":_.value,tabs:Q},{tabHeader:n(()=>[p("h1",we,x(a(i).name)+": "+x(P.value.name),1)]),overview:n(()=>[f(fe,{"has-error":b.value,"is-loading":d.value,"is-empty":v.value},{default:n(()=>[p("div",Ee,[p("ul",null,[(c(!0),q(ie,null,ue(P.value,(t,w)=>(c(),q("li",{key:w},[p("h4",null,x(w),1),o(),p("p",null,x(t),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"]),o(),k.value!==null?(c(),T(_e,{key:0,id:"code-block-policy",class:"mt-4","has-error":b.value,"is-loading":d.value,"is-empty":v.value,content:k.value,"is-searchable":""},null,8,["has-error","is-loading","is-empty","content"])):E("",!0)]),"affected-dpps":n(()=>[k.value!==null?(c(),T(ye,{key:0,mesh:k.value.mesh,"policy-name":k.value.name,"policy-type":a(i).path},null,8,["mesh","policy-name","policy-type"])):E("",!0)]),_:1},8,["has-error","error","is-loading"])):E("",!0)]),_:1})],2)):E("",!0)}});const Me=me(Se,[["__scopeId","data-v-c8381067"]]);export{Me as default};
