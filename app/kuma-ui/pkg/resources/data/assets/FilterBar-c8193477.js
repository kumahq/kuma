var ne=Object.defineProperty;var ie=(s,o,t)=>o in s?ne(s,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[o]=t;var P=(s,o,t)=>(ie(s,typeof o!="symbol"?o+"":o,t),t);import{K as w}from"./index-fce48c05.js";import{d as K,l as oe,a as E,o as d,b as q,W as le,w as v,r as O,e as S,f as c,t as m,q as u,c as g,F as T,E as R,p as b,s as I,R as re,_ as Q,m as C,K as z,a8 as $,ap as ue,aq as ce,ar as de,n as j,as as fe,at as pe,au as me,av as ge,y as ve,z as he}from"./index-e5aa0c15.js";import{A as ye}from"./AppCollection-f39e374e.js";import{S as be}from"./StatusBadge-e24d822f.js";import{T as _e}from"./TextWithCopyButton-a30e2023.js";import{_ as ke}from"./WarningIcon.vue_vue_type_script_setup_true_lang-1f206a29.js";import{u as Se}from"./uniqueId-90cc9b93.js";const xe={key:0},Ce={key:1},Te=K({__name:"DataPlaneList",props:{total:{default:0},pageNumber:{},pageSize:{},items:{},error:{},isSelectedRow:{type:[Function,null],default:null},summaryRouteName:{}},emits:["change"],setup(s,{emit:o}){const{t,formatIsoDate:x}=oe(),r=s,n=o;return(i,_)=>{const f=E("RouterLink"),h=E("KTruncate"),k=E("KTooltip");return d(),q(ye,{class:"data-plane-collection","empty-state-message":u(t)("common.emptyState.message",{type:"Data Plane Proxies"}),"empty-state-cta-to":u(t)("data-planes.href.docs.data_plane_proxy"),"empty-state-cta-text":u(t)("common.documentation"),headers:[{label:"Name",key:"name"},{label:"Type",key:"type"},{label:"Services",key:"services"},{label:"Certificate Info",key:"certificate"},{label:"Status",key:"status"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Details",key:"details",hideLabel:!0}],"page-number":r.pageNumber,"page-size":r.pageSize,total:r.total,items:r.items,error:r.error,"is-selected-row":r.isSelectedRow,onChange:_[0]||(_[0]=a=>n("change",a))},le({name:v(({row:a})=>[S(f,{class:"name-link",title:a.name,to:{name:r.summaryRouteName,params:{mesh:a.mesh,dataPlane:a.name},query:{page:r.pageNumber,size:r.pageSize}}},{default:v(()=>[c(m(a.name),1)]),_:2},1032,["title","to"])]),type:v(({row:a})=>[c(m(u(t)(`data-planes.type.${a.dataplaneType}`)),1)]),services:v(({row:a})=>[a.services.length>0?(d(),q(h,{key:0,width:"auto"},{default:v(()=>[(d(!0),g(T,null,R(a.services,(y,L)=>(d(),g("div",{key:L},[S(_e,{text:y},{default:v(()=>[S(f,{to:{name:"service-detail-view",params:{service:y}}},{default:v(()=>[c(m(y),1)]),_:2},1032,["to"])]),_:2},1032,["text"])]))),128))]),_:2},1024)):(d(),g(T,{key:1},[c(m(u(t)("common.collection.none")),1)],64))]),certificate:v(({row:a})=>{var y;return[(y=a.dataplaneInsight.mTLS)!=null&&y.certificateExpirationTime?(d(),g(T,{key:0},[c(m(u(x)(a.dataplaneInsight.mTLS.certificateExpirationTime)),1)],64)):(d(),g(T,{key:1},[c(m(u(t)("data-planes.components.data-plane-list.certificate.none")),1)],64))]}),status:v(({row:a})=>[S(be,{status:a.status},null,8,["status"])]),warnings:v(({row:a})=>[a.isCertExpired||a.warnings.length>0?(d(),q(k,{key:0},{content:v(()=>[b("ul",null,[a.warnings.length>0?(d(),g("li",xe,m(u(t)("data-planes.components.data-plane-list.version_mismatch")),1)):I("",!0),c(),a.isCertExpired?(d(),g("li",Ce,m(u(t)("data-planes.components.data-plane-list.cert_expired")),1)):I("",!0)])]),default:v(()=>[c(),S(ke,{class:"mr-1",size:u(w),"hide-title":""},null,8,["size"])]),_:2},1024)):(d(),g(T,{key:1},[c(m(u(t)("common.collection.none")),1)],64))]),details:v(({row:a})=>[S(f,{class:"details-link","data-testid":"details-link",to:{name:"data-plane-detail-view",params:{dataPlane:a.name}}},{default:v(()=>[c(m(u(t)("common.collection.details_link"))+" ",1),S(u(re),{display:"inline-block",decorative:"",size:u(w)},null,8,["size"])]),_:2},1032,["to"])]),_:2},[i.$slots.toolbar?{name:"toolbar",fn:v(()=>[O(i.$slots,"toolbar",{},void 0,!0)]),key:"0"}:void 0]),1032,["empty-state-message","empty-state-cta-to","empty-state-cta-text","page-number","page-size","total","items","error","is-selected-row"])}}});const Xe=Q(Te,[["__scopeId","data-v-30b7e9ba"]]);function we(s,o,t){return Math.max(o,Math.min(s,t))}const Ie=["ControlLeft","ControlRight","ShiftLeft","ShiftRight","AltLeft"];class Le{constructor(o,t){P(this,"commands");P(this,"keyMap");P(this,"boundTriggerShortcuts");this.commands=t,this.keyMap=Object.fromEntries(Object.entries(o).map(([x,r])=>[x.toLowerCase(),r])),this.boundTriggerShortcuts=this.triggerShortcuts.bind(this)}registerListener(){document.addEventListener("keydown",this.boundTriggerShortcuts)}unRegisterListener(){document.removeEventListener("keydown",this.boundTriggerShortcuts)}triggerShortcuts(o){Fe(o,this.keyMap,this.commands)}}function Fe(s,o,t){const x=Ne(s.code),r=[s.ctrlKey?"ctrl":"",s.shiftKey?"shift":"",s.altKey?"alt":"",x].filter(_=>_!=="").join("+"),n=o[r];if(!n)return;const i=t[n];i.isAllowedContext&&!i.isAllowedContext(s)||(i.shouldPreventDefaultAction&&s.preventDefault(),!(i.isDisabled&&i.isDisabled())&&i.trigger(s))}function Ne(s){return Ie.includes(s)?"":s.replace(/^Key/,"").toLowerCase()}function Pe(s,o){const t=" "+s,x=t.matchAll(/ ([-\s\w]+):\s*/g),r=[];for(const n of Array.from(x)){if(n.index===void 0)continue;const i=ze(n[1]);if(o.length>0&&!o.includes(i))throw new Error(`Unknown field “${i}”. Known fields: ${o.join(", ")}`);const _=n.index+n[0].length,f=t.substring(_);let h;if(/^\s*["']/.test(f)){const a=f.match(/['"](.*?)['"]/);if(a!==null)h=a[1];else throw new Error(`Quote mismatch for field “${i}”.`)}else{const a=f.indexOf(" "),y=a===-1?f.length:a;h=f.substring(0,y)}h!==""&&r.push([i,h])}return r}function ze(s){return s.trim().replace(/\s+/g,"-").replace(/-[a-z]/g,(o,t)=>t===0?o:o.substring(1).toUpperCase())}const V=s=>(ve("data-v-349996e3"),s=s(),he(),s),Ae=V(()=>b("span",{class:"visually-hidden"},"Focus filter",-1)),Ee={class:"k-filter-icon"},qe=["for"],Be=["id","placeholder"],De={key:0,class:"k-suggestion-box","data-testid":"k-filter-bar-suggestion-box"},Me={class:"k-suggestion-list"},$e={key:0,class:"k-filter-bar-error"},je={key:0},Ke=["title","data-filter-field"],Oe={class:"visually-hidden"},Re=V(()=>b("span",{class:"visually-hidden"},"Clear query",-1)),Qe=K({__name:"FilterBar",props:{id:{type:String,required:!1,default:()=>Se("k-filter-bar")},fields:{type:Object,required:!0},placeholder:{type:String,required:!1,default:null},query:{type:String,required:!1,default:""}},emits:["fields-change"],setup(s,{emit:o}){const t=s,x=o,r=C(null),n=C(null),i=C(t.query),_=C([]),f=C(null),h=C(!1),k=C(-1),a=z(()=>Object.keys(t.fields)),y=z(()=>Object.entries(t.fields).slice(0,5).map(([e,l])=>({fieldName:e,...l}))),L=z(()=>a.value.length>0?`Filter by ${a.value.join(", ")}`:"Filter"),U=z(()=>t.placeholder??L.value);$(()=>_.value,function(e,l){se(e,l)||(f.value=null,x("fields-change",{fields:e,query:i.value}))}),$(()=>i.value,function(){i.value===""&&(f.value=null),h.value=!0});const H={Enter:"submitQuery",Escape:"closeSuggestionBox",ArrowDown:"jumpToNextSuggestion",ArrowUp:"jumpToPreviousSuggestion"},W={submitQuery:{trigger:B,isAllowedContext(e){return n.value!==null&&e.composedPath().includes(n.value)},shouldPreventDefaultAction:!0},jumpToNextSuggestion:{trigger:Z,isAllowedContext(e){return n.value!==null&&e.composedPath().includes(n.value)},shouldPreventDefaultAction:!0},jumpToPreviousSuggestion:{trigger:G,isAllowedContext(e){return n.value!==null&&e.composedPath().includes(n.value)},shouldPreventDefaultAction:!0},closeSuggestionBox:{trigger:A,isAllowedContext(e){return r.value!==null&&e.composedPath().includes(r.value)}}};function J(){const e=new Le(H,W);me(function(){e.registerListener()}),ge(function(){e.unRegisterListener()}),F(i.value)}J();function Y(e){const l=e.target;F(l.value)}function B(){if(n.value instanceof HTMLInputElement)if(k.value===-1)F(n.value.value),h.value=!1;else{const e=y.value[k.value].fieldName;e&&M(n.value,e)}}function Z(){D(1)}function G(){D(-1)}function D(e){k.value=we(k.value+e,-1,y.value.length-1)}function X(){n.value instanceof HTMLInputElement&&n.value.focus()}function ee(e){const p=e.currentTarget.getAttribute("data-filter-field");p&&n.value instanceof HTMLInputElement&&M(n.value,p)}function M(e,l){const p=i.value===""||i.value.endsWith(" ")?"":" ";i.value+=p+l+":",e.focus(),k.value=-1}function te(){i.value="",n.value instanceof HTMLInputElement&&(n.value.value="",n.value.focus(),F(""))}function ae(e){e.relatedTarget===null&&A(),r.value instanceof HTMLElement&&e.relatedTarget instanceof Node&&!r.value.contains(e.relatedTarget)&&A()}function A(){h.value=!1}function F(e){f.value=null;try{const l=Pe(e,a.value);l.sort((p,N)=>p[0].localeCompare(N[0])),_.value=l}catch(l){if(l instanceof Error)f.value=l,h.value=!0;else throw l}}function se(e,l){return JSON.stringify(e)===JSON.stringify(l)}return(e,l)=>(d(),g("div",{ref_key:"filterBar",ref:r,class:"k-filter-bar","data-testid":"k-filter-bar"},[b("button",{class:"k-focus-filter-input-button",title:"Focus filter",type:"button","data-testid":"k-filter-bar-focus-filter-input-button",onClick:X},[Ae,c(),b("span",Ee,[S(u(ue),{decorative:"","data-testid":"k-filter-bar-filter-icon","hide-title":"",size:u(w)},null,8,["size"])])]),c(),b("label",{for:`${t.id}-filter-bar-input`,class:"visually-hidden"},[O(e.$slots,"default",{},()=>[c(m(L.value),1)],!0)],8,qe),c(),ce(b("input",{id:`${t.id}-filter-bar-input`,ref_key:"filterInput",ref:n,"onUpdate:modelValue":l[0]||(l[0]=p=>i.value=p),class:"k-filter-bar-input",type:"text",placeholder:U.value,"data-testid":"k-filter-bar-filter-input",onFocus:l[1]||(l[1]=p=>h.value=!0),onBlur:ae,onChange:Y},null,40,Be),[[de,i.value]]),c(),h.value?(d(),g("div",De,[b("div",Me,[f.value!==null?(d(),g("p",$e,m(f.value.message),1)):(d(),g("button",{key:1,class:j(["k-submit-query-button",{"k-submit-query-button-is-selected":k.value===-1}]),title:"Submit query",type:"button","data-testid":"k-filter-bar-submit-query-button",onClick:B},`
          Submit `+m(i.value),3)),c(),(d(!0),g(T,null,R(y.value,(p,N)=>(d(),g("div",{key:`${t.id}-${N}`,class:j(["k-suggestion-list-item",{"k-suggestion-list-item-is-selected":k.value===N}])},[b("b",null,m(p.fieldName),1),p.description!==""?(d(),g("span",je,": "+m(p.description),1)):I("",!0),c(),b("button",{class:"k-apply-suggestion-button",title:`Add ${p.fieldName}:`,type:"button","data-filter-field":p.fieldName,"data-testid":"k-filter-bar-apply-suggestion-button",onClick:ee},[b("span",Oe,"Add "+m(p.fieldName)+":",1),c(),S(u(fe),{decorative:"","hide-title":"",size:u(w)},null,8,["size"])],8,Ke)],2))),128))])])):I("",!0),c(),i.value!==""?(d(),g("button",{key:1,class:"k-clear-query-button",title:"Clear query",type:"button","data-testid":"k-filter-bar-clear-query-button",onClick:te},[Re,c(),S(u(pe),{decorative:"","hide-title":"",size:u(w)},null,8,["size"])])):I("",!0)],512))}});const et=Q(Qe,[["__scopeId","data-v-349996e3"]]);export{Xe as D,et as F};
