import{d as B,S as N,W as T,K as A,k as R}from"./kongponents.es-3b173a09.js";import{d as $,q as P,s as z,A as F,o as l,e as E,n as W,g as h,F as I,k as _,a as d,w as n,h as c,b as a,u as j,L as K,j as M,f as L,P as U,x as D,t as C,p as G,m as O}from"./index-80b7a6e0.js";import{_ as Z}from"./PolicyDetails.vue_vue_type_script_setup_true_lang-0e823156.js";import{M as H,j as J,i as Q,f as X,_ as Y,g as ee}from"./RouteView.vue_vue_type_script_setup_true_lang-2491099c.js";import{_ as ae}from"./RouteTitle.vue_vue_type_script_setup_true_lang-c7b2a4c2.js";import{D as te}from"./DataOverview-c8f5aded.js";import{_ as oe}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-ebc08bf9.js";import{E as se}from"./ErrorBlock-fd25899f.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-5800a8a4.js";import"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-e1406b82.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-f208272e.js";import"./TextWithCopyButton-8001c012.js";import"./TabsWidget-44f1e6d4.js";import"./QueryParameter-70743f73.js";import"./TagList-c90e3aa7.js";import"./StatusBadge-a52e278c.js";const re=_("span",null,null,-1),q=$({__name:"DataSource",props:{src:{type:String,required:!0}},emits:["change","error"],setup(m,{emit:s}){const u=m,v=H(),g=P(void 0),y=P(void 0);let t={};const i=Symbol(""),f=async e=>{if(t=k(t),t.src=e,e==="")return;t.controller=new AbortController;const r=v.source(e,i);r.addEventListener("message",b=>{g.value=b.data,y.value=void 0,s("change",g.value)},{signal:t.controller.signal}),r.addEventListener("error",b=>{y.value=b.error,s("error",y.value)},{signal:t.controller.signal})},k=e=>(typeof e.controller<"u"&&e.controller.abort(),typeof e.src<"u"&&v.close(e.src,i),{});z(()=>u.src,e=>f(e),{immediate:!0}),F(()=>{t=k(t)});const w=()=>{f(u.src)};return(e,r)=>(l(),E(I,null,[W(e.$slots,"default",{data:g.value,error:y.value,refresh:w}),h(),re],64))}}),ne=$({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(m){const s=m;return(u,v)=>(l(),d(a(N),{class:"docs-link",appearance:"outline",target:"_blank",to:s.href},{default:n(()=>[c(a(B),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),h(`

    Documentation
  `)]),_:1},8,["to"]))}}),le=m=>(G("data-v-efee80b2"),m=m(),O(),m),ie={class:"kcard-stack"},pe={class:"kcard-border"},ce=le(()=>_("p",null,[_("strong",null,"Warning"),h(` This policy is experimental. If you encountered any problem please open an
                              `),_("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),me=$({__name:"PolicyListView",setup(m){const s=j(),u=K(),{t:v}=J(),g=function(y){y.items.length>0&&!s.query.policy&&u.push({name:"policies-list-view",query:{policy:y.items[0].name}})};return(y,t)=>(l(),d(Y,null,{default:n(({route:i})=>[c(q,{src:"/*/policy-types"},{default:n(({data:f,error:k,refresh:w})=>[k?(l(),d(se,{key:0,error:k},null,8,["error"])):f===void 0?(l(),d(Q,{key:1})):f.policies.length===0?(l(),d(oe,{key:2})):(l(!0),E(I,{key:3},M([f.policies.find(e=>e.path===i.params.policyPath)??f.policies[0]],e=>(l(),d(q,{key:e.path,src:`/${i.params.mesh}/policy-type/${e.path}?offset=${a(s).query.offset||"0"}`,onChange:g},{default:n(({data:r,error:b,refresh:V})=>[c(ae,{title:a(v)("policies.routes.items.title",{name:e.name})},null,8,["title"]),h(),c(X,null,{default:n(()=>[_("div",{class:D(["relative",e.path])},[_("div",ie,[_("div",pe,[e.isExperimental?(l(),d(a(T),{key:0,"border-variant":"noBorder",class:"mb-4"},{body:n(()=>[c(a(A),{appearance:"warning"},{alertMessage:n(()=>[ce]),_:1})]),_:1})):L("",!0),h(),c(te,{"selected-entity-name":a(s).query.policy??void 0,"page-size":a(U),error:b,"is-loading":typeof r>"u"&&typeof b>"u","empty-state":{title:"No Data",message:`There are no ${e.name} policies present.`},"table-data":{headers:[{label:"Name",key:"entity"},{label:"Type",key:"type"}],data:((r==null?void 0:r.items)||[]).map(o=>({entity:o,type:o.type,detailViewRoute:{name:"policy-detail-view",params:{mesh:o.mesh,policyPath:i.params.policyPath,policy:o.name}}}))},"table-data-is-empty":r&&r.items.length===0,next:r==null?void 0:r.next,"page-offset":a(s).query.offset?parseInt(a(s).query.offset):0,onTableAction:t[1]||(t[1]=o=>{a(u).push({name:"policies-list-view",query:{policy:o.name}})}),onRefresh:()=>{V(),w()},onLoadData:t[2]||(t[2]=o=>{a(u).push({name:"policies-list-view",query:{policy:a(s).query.policy,offset:o}})})},{additionalControls:n(()=>[c(q,{src:`/${i.params.mesh}/insights`},{default:n(({data:o})=>[c(a(R),{label:"Policies",items:f.policies.map(p=>({label:p.name,value:p.path,selected:p.path===i.params.policyPath})),"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:t[0]||(t[0]=p=>a(u).push({name:"policies-list-view",params:{...a(s).params,policyPath:p.value}}))},{"item-template":n(({item:p})=>{var x,S;return[_("span",{class:D({"policy-type-empty":!((x=o==null?void 0:o.policies[p.label])!=null&&x.total)})},C(p.label)+" ("+C(((S=o==null?void 0:o.policies[p.label])==null?void 0:S.total)||"0")+`)
                              `,3)]}),_:2},1032,["items"])]),_:2},1032,["src"]),h(),c(ne,{href:a(v)("policies.href.docs",{name:e.name}),"data-testid":"policy-documentation-link"},null,8,["href"])]),_:2},1032,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset","onRefresh"])]),h(),a(s).query.policy?(l(),d(Z,{key:0,name:a(s).query.policy,mesh:i.params.mesh,path:e.path,type:e.name},null,8,["name","mesh","path","type"])):L("",!0)])],2)]),_:2},1024)]),_:2},1032,["src"]))),128))]),_:2},1024)]),_:1}))}});const Le=ee(me,[["__scopeId","data-v-efee80b2"]]);export{Le as default};
