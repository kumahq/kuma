import{c as Z,E as G,Z as j,z as H,f as Y}from"./kongponents.es-1cc3ed6f.js";import{d as U,o as r,b as g,w as l,g as b,e as c,h as p,a as J,u as X,r as v,c as N,v as ee,V as ae,G as te,j as I,i as u,f as T,y as z,t as D,N as C,F as se,q as le,p as oe,m as ie}from"./index-e478965d.js";import{_ as ne}from"./PolicyConnections.vue_vue_type_script_setup_true_lang-e3e577b7.js";import{D as re}from"./DataOverview-dbd5e142.js";import{a as ce,D as pe}from"./DefinitionListItem-ca3ec68a.js";import{T as ue}from"./TabsWidget-c1bbe8d0.js";import{_ as me}from"./YamlView.vue_vue_type_script_setup_true_lang-77c6b524.js";import{u as de}from"./store-c19d7d31.js";import{u as ye,a as he}from"./index-577ac57c.js";import{Q as A}from"./QueryParameter-70743f73.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-c9c60794.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-aa58fa3f.js";import"./ErrorBlock-5cdd9eb9.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-23b40a77.js";import"./datadogLogEvents-302eea7b.js";import"./TagList-b1e9a035.js";import"./StatusBadge-ffc1afa7.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-b442850f.js";import"./toYaml-4e00099e.js";const ve=U({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(m){const o=m;return(S,x)=>(r(),g(c(G),{class:"docs-link",appearance:"outline",target:"_blank",to:o.href},{default:l(()=>[b(c(Z),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),p(`

    Documentation
  `)]),_:1},8,["to"]))}}),_e=m=>(oe("data-v-05a37728"),m=m(),ie(),m),ge={class:"kcard-stack"},be={class:"kcard-border"},Pe=_e(()=>u("p",null,[u("strong",null,"Warning"),p(` This policy is experimental. If you encountered any problem please open an
                  `),u("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),ke={class:"kcard-border"},Te={class:"entity-heading","data-testid":"policy-single-entity"},we=U({__name:"PolicyListView",props:{selectedPolicyName:{type:[String,null],required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(m){const o=m,S=ye(),x=he(),$=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],q=J(),_=X(),i=de(),w=v(!0),P=v(null),d=v(null),y=v(null),L=v(null),V=v(o.offset),k=v({headers:[{label:"Name",key:"entity"},{label:"Type",key:"type"}],data:[]}),h=N(()=>i.state.policyTypesByPath[o.policyPath]),M=N(()=>i.state.policyTypes.map(e=>({label:e.name,value:e.path,selected:e.path===o.policyPath}))),R=N(()=>i.state.policyTypes.filter(e=>(i.state.sidebar.insights.mesh.policies[e.name]??0)===0).map(e=>e.name));ee(()=>_.params.mesh,function(){_.name===o.policyPath&&E(0)}),F();async function F(){const e=i.state.policyTypesByPath[o.policyPath];e!==void 0&&(await i.dispatch("updatePageTitle",""),await i.dispatch("updatePageTitle",e.name)),E(o.offset)}async function E(e){var n;V.value=e,A.set("offset",e>0?e:null),w.value=!0,P.value=null;const t=_.params.mesh,s=_.params.policyPath,a=C;try{const{items:f,next:W}=await S.getAllPolicyEntitiesFromMesh({mesh:t,path:s},{size:a,offset:e});L.value=W,k.value.data=O(f??[]),await B({name:o.selectedPolicyName??((n=k.value.data[0])==null?void 0:n.entity.name),mesh:t,path:s})}catch(f){k.value.data=[],d.value=null,f instanceof Error?P.value=f:console.error(f)}finally{w.value=!1}}function O(e){return e.map(t=>{const{type:s,name:a}=t,n={name:"policy-detail-view",params:{mesh:t.mesh,policyPath:_.params.policyPath,policy:a}};return{entity:t,detailViewRoute:n,type:s}})}async function K(e){const{name:t,mesh:s,type:a}=e,f=i.state.policyTypesByName[a].path;await B({name:t,mesh:s,path:f})}async function B({name:e,mesh:t,path:s}){if(e===void 0){d.value=null,y.value=null,A.set("policy",null);return}try{const a=await S.getSinglePolicyEntity({mesh:t,path:s,name:e});d.value=ae(a,["type","name","mesh"]),A.set("policy",a.name),y.value=te(a)}catch(a){console.error(a)}}function Q(e){q.push({name:"policies-list-view",params:{..._.params,policyPath:e.value}})}return(e,t)=>{var s;return h.value?(r(),I("div",{key:0,class:z(["relative",h.value.path])},[u("div",ge,[u("div",be,[h.value.isExperimental?(r(),g(c(H),{key:0,"border-variant":"noBorder",class:"mb-4"},{body:l(()=>[b(c(j),{appearance:"warning"},{alertMessage:l(()=>[Pe]),_:1})]),_:1})):T("",!0),p(),b(re,{"selected-entity-name":(s=d.value)==null?void 0:s.name,"page-size":c(C),error:P.value,"is-loading":w.value,"empty-state":{title:"No Data",message:`There are no ${h.value.name} policies present.`},"table-data":k.value,"table-data-is-empty":k.value.data.length===0,next:L.value,"page-offset":V.value,onTableAction:K,onLoadData:E},{additionalControls:l(()=>[b(c(Y),{label:"Policies",items:M.value,"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:Q},{"item-template":l(({item:a})=>[u("span",{class:z({"policy-type-empty":R.value.includes(a.label)})},D(a.label),3)]),_:1},8,["items"]),p(),b(ve,{href:`${c(x)("KUMA_DOCS_URL")}/policies/${h.value.path}/?${c(x)("KUMA_UTM_QUERY_PARAMS")}`,"data-testid":"policy-documentation-link"},null,8,["href"])]),default:l(()=>[p(`
          >
          `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"])]),p(),u("div",ke,[d.value!==null?(r(),g(ue,{key:0,"has-error":P.value!==null,error:P.value,"is-loading":w.value,tabs:$},{tabHeader:l(()=>[u("h1",Te,D(h.value.name)+": "+D(d.value.name),1)]),overview:l(()=>[b(pe,{"data-testid":"policy-detail-label-list"},{default:l(()=>[(r(!0),I(se,null,le(d.value,(a,n)=>(r(),g(ce,{key:n,term:n},{default:l(()=>[p(D(a),1)]),_:2},1032,["term"]))),128))]),_:1}),p(),y.value!==null?(r(),g(me,{key:0,id:"code-block-policy",class:"mt-4",content:y.value,"is-searchable":""},null,8,["content"])):T("",!0)]),"affected-dpps":l(()=>[y.value!==null?(r(),g(ne,{key:0,mesh:y.value.mesh,"policy-name":y.value.name,"policy-path":h.value.path},null,8,["mesh","policy-name","policy-path"])):T("",!0)]),_:1},8,["has-error","error","is-loading"])):T("",!0)])])],2)):T("",!0)}}});const Qe=fe(we,[["__scopeId","data-v-05a37728"]]);export{Qe as default};
