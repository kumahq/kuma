var oe=Object.defineProperty;var ie=(s,n,t)=>n in s?oe(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t;var B=(s,n,t)=>(ie(s,typeof n!="symbol"?n+"":n,t),t);import{K as N}from"./index-fce48c05.js";import{d as Z,l as le,a as K,o as c,b as R,Z as re,w as h,r as J,e as x,f as p,t as k,c as g,F as I,I as Q,q as m,p as S,s as q,U as ue,_ as Y,m as w,M as D,aa as O,as as ce,at as de,au as fe,n as H,av as pe,aw as me,E as ge,S as ve,y as he,z as ye}from"./index-364a2367.js";import{d as be,e as _e,g as ke,b as Se,c as xe}from"./index-3d038f44.js";import{A as Te}from"./AppCollection-0c18020e.js";import{S as Ce}from"./StatusBadge-639d9a83.js";import{T as we}from"./TextWithCopyButton-331646e6.js";import{_ as Ie}from"./WarningIcon.vue_vue_type_script_setup_true_lang-0e53d9b2.js";const Le={key:0},Fe=Z({__name:"DataPlaneList",props:{total:{default:0},pageNumber:{},pageSize:{},items:{},error:{},isSelectedRow:{type:[Function,null],default:null},summaryRouteName:{},canUseZones:{type:Boolean}},emits:["change"],setup(s,{emit:n}){const{t,formatIsoDate:T}=le(),i=s,a=n;function o(y){return y.map(l=>{var A,F;const{mesh:d,name:b}=l,v=t(`data-planes.type.${be(l)}`),_=_e(l).filter(P=>P.label==="kuma.io/service"),{status:C}=ke(l);let L;(F=(A=l.dataplaneInsight)==null?void 0:A.mTLS)!=null&&F.certificateExpirationTime?L=T(l.dataplaneInsight.mTLS.certificateExpirationTime):L=t("data-planes.components.data-plane-list.certificate.none");const $=Se(l,i.canUseZones),M=xe(l);return{name:b,type:v,mesh:d,services:_,status:C,warnings:{version_mismatch:$.length>0,cert_expired:M},certificate:L}})}return(y,l)=>{const d=K("RouterLink"),b=K("KTruncate"),v=K("KTooltip");return c(),R(Te,{class:"data-plane-collection","empty-state-message":m(t)("common.emptyState.message",{type:"Data Plane Proxies"}),"empty-state-cta-to":m(t)("data-planes.href.docs.data_plane_proxy"),"empty-state-cta-text":m(t)("common.documentation"),headers:[{label:"Name",key:"name"},{label:"Type",key:"type"},{label:"Services",key:"services"},{label:"Certificate Info",key:"certificate"},{label:"Status",key:"status"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Details",key:"details",hideLabel:!0}],"page-number":i.pageNumber,"page-size":i.pageSize,total:i.total,items:i.items?o(i.items):void 0,error:i.error,"is-selected-row":i.isSelectedRow,onChange:l[0]||(l[0]=r=>a("change",r))},re({name:h(({row:r})=>[x(d,{class:"name-link",title:r.name,to:{name:i.summaryRouteName,params:{mesh:r.mesh,dataPlane:r.name},query:{page:i.pageNumber,size:i.pageSize}}},{default:h(()=>[p(k(r.name),1)]),_:2},1032,["title","to"])]),services:h(({row:r})=>[r.services.length>0?(c(),R(b,{key:0,width:"auto"},{default:h(()=>[(c(!0),g(I,null,Q(r.services,(_,C)=>(c(),g("div",{key:C},[x(we,{text:_.value},{default:h(()=>[x(d,{to:{name:"service-detail-view",params:{service:_.value}}},{default:h(()=>[p(k(_.value),1)]),_:2},1032,["to"])]),_:2},1032,["text"])]))),128))]),_:2},1024)):(c(),g(I,{key:1},[p(k(m(t)("common.collection.none")),1)],64))]),status:h(({row:r})=>[x(Ce,{status:r.status},null,8,["status"])]),warnings:h(({row:r})=>[Object.values(r.warnings).some(_=>_)?(c(),R(v,{key:0},{content:h(()=>[S("ul",null,[(c(!0),g(I,null,Q(r.warnings,(_,C)=>(c(),g(I,{key:C},[_?(c(),g("li",Le,k(m(t)(`data-planes.components.data-plane-list.${C}`)),1)):q("",!0)],64))),128))])]),default:h(()=>[p(),x(Ie,{class:"mr-1",size:m(N),"hide-title":""},null,8,["size"])]),_:2},1024)):(c(),g(I,{key:1},[p(k(m(t)("common.collection.none")),1)],64))]),details:h(({row:r})=>[x(d,{class:"details-link","data-testid":"details-link",to:{name:"data-plane-detail-view",params:{dataPlane:r.name}}},{default:h(()=>[p(k(m(t)("common.collection.details_link"))+" ",1),x(m(ue),{display:"inline-block",decorative:"",size:m(N)},null,8,["size"])]),_:2},1032,["to"])]),_:2},[y.$slots.toolbar?{name:"toolbar",fn:h(()=>[J(y.$slots,"toolbar",{},void 0,!0)]),key:"0"}:void 0]),1032,["empty-state-message","empty-state-cta-to","empty-state-cta-text","page-number","page-size","total","items","error","is-selected-row"])}}});const nt=Y(Fe,[["__scopeId","data-v-a8c088b9"]]);function Ne(s,n,t){return Math.max(n,Math.min(s,t))}const Ae=["ControlLeft","ControlRight","ShiftLeft","ShiftRight","AltLeft"];class ze{constructor(n,t){B(this,"commands");B(this,"keyMap");B(this,"boundTriggerShortcuts");this.commands=t,this.keyMap=Object.fromEntries(Object.entries(n).map(([T,i])=>[T.toLowerCase(),i])),this.boundTriggerShortcuts=this.triggerShortcuts.bind(this)}registerListener(){document.addEventListener("keydown",this.boundTriggerShortcuts)}unRegisterListener(){document.removeEventListener("keydown",this.boundTriggerShortcuts)}triggerShortcuts(n){Ee(n,this.keyMap,this.commands)}}function Ee(s,n,t){const T=Be(s.code),i=[s.ctrlKey?"ctrl":"",s.shiftKey?"shift":"",s.altKey?"alt":"",T].filter(y=>y!=="").join("+"),a=n[i];if(!a)return;const o=t[a];o.isAllowedContext&&!o.isAllowedContext(s)||(o.shouldPreventDefaultAction&&s.preventDefault(),!(o.isDisabled&&o.isDisabled())&&o.trigger(s))}function Be(s){return Ae.includes(s)?"":s.replace(/^Key/,"").toLowerCase()}function De(s,n){const t=" "+s,T=t.matchAll(/ ([-\s\w]+):\s*/g),i=[];for(const a of Array.from(T)){if(a.index===void 0)continue;const o=qe(a[1]);if(n.length>0&&!n.includes(o))throw new Error(`Unknown field “${o}”. Known fields: ${n.join(", ")}`);const y=a.index+a[0].length,l=t.substring(y);let d;if(/^\s*["']/.test(l)){const v=l.match(/['"](.*?)['"]/);if(v!==null)d=v[1];else throw new Error(`Quote mismatch for field “${o}”.`)}else{const v=l.indexOf(" "),r=v===-1?l.length:v;d=l.substring(0,r)}d!==""&&i.push([o,d])}return i}function qe(s){return s.trim().replace(/\s+/g,"-").replace(/-[a-z]/g,(n,t)=>t===0?n:n.substring(1).toUpperCase())}let W=0;const $e=(s="unique")=>(W++,`${s}-${W}`),G=s=>(he("data-v-349996e3"),s=s(),ye(),s),Me=G(()=>S("span",{class:"visually-hidden"},"Focus filter",-1)),Pe={class:"k-filter-icon"},je=["for"],Ke=["id","placeholder"],Re={key:0,class:"k-suggestion-box","data-testid":"k-filter-bar-suggestion-box"},Qe={class:"k-suggestion-list"},Ue={key:0,class:"k-filter-bar-error"},Ve={key:0},Oe=["title","data-filter-field"],He={class:"visually-hidden"},We=G(()=>S("span",{class:"visually-hidden"},"Clear query",-1)),Ze=Z({__name:"FilterBar",props:{id:{type:String,required:!1,default:()=>$e("k-filter-bar")},fields:{type:Object,required:!0},placeholder:{type:String,required:!1,default:null},query:{type:String,required:!1,default:""}},emits:["fields-change"],setup(s,{emit:n}){const t=s,T=n,i=w(null),a=w(null),o=w(t.query),y=w([]),l=w(null),d=w(!1),b=w(-1),v=D(()=>Object.keys(t.fields)),r=D(()=>Object.entries(t.fields).slice(0,5).map(([e,u])=>({fieldName:e,...u}))),_=D(()=>v.value.length>0?`Filter by ${v.value.join(", ")}`:"Filter"),C=D(()=>t.placeholder??_.value);O(()=>y.value,function(e,u){ne(e,u)||(l.value=null,T("fields-change",{fields:e,query:o.value}))}),O(()=>o.value,function(){o.value===""&&(l.value=null),d.value=!0});const L={Enter:"submitQuery",Escape:"closeSuggestionBox",ArrowDown:"jumpToNextSuggestion",ArrowUp:"jumpToPreviousSuggestion"},$={submitQuery:{trigger:F,isAllowedContext(e){return a.value!==null&&e.composedPath().includes(a.value)},shouldPreventDefaultAction:!0},jumpToNextSuggestion:{trigger:P,isAllowedContext(e){return a.value!==null&&e.composedPath().includes(a.value)},shouldPreventDefaultAction:!0},jumpToPreviousSuggestion:{trigger:X,isAllowedContext(e){return a.value!==null&&e.composedPath().includes(a.value)},shouldPreventDefaultAction:!0},closeSuggestionBox:{trigger:j,isAllowedContext(e){return i.value!==null&&e.composedPath().includes(i.value)}}};function M(){const e=new ze(L,$);ge(function(){e.registerListener()}),ve(function(){e.unRegisterListener()}),z(o.value)}M();function A(e){const u=e.target;z(u.value)}function F(){if(a.value instanceof HTMLInputElement)if(b.value===-1)z(a.value.value),d.value=!1;else{const e=r.value[b.value].fieldName;e&&V(a.value,e)}}function P(){U(1)}function X(){U(-1)}function U(e){b.value=Ne(b.value+e,-1,r.value.length-1)}function ee(){a.value instanceof HTMLInputElement&&a.value.focus()}function te(e){const f=e.currentTarget.getAttribute("data-filter-field");f&&a.value instanceof HTMLInputElement&&V(a.value,f)}function V(e,u){const f=o.value===""||o.value.endsWith(" ")?"":" ";o.value+=f+u+":",e.focus(),b.value=-1}function se(){o.value="",a.value instanceof HTMLInputElement&&(a.value.value="",a.value.focus(),z(""))}function ae(e){e.relatedTarget===null&&j(),i.value instanceof HTMLElement&&e.relatedTarget instanceof Node&&!i.value.contains(e.relatedTarget)&&j()}function j(){d.value=!1}function z(e){l.value=null;try{const u=De(e,v.value);u.sort((f,E)=>f[0].localeCompare(E[0])),y.value=u}catch(u){if(u instanceof Error)l.value=u,d.value=!0;else throw u}}function ne(e,u){return JSON.stringify(e)===JSON.stringify(u)}return(e,u)=>(c(),g("div",{ref_key:"filterBar",ref:i,class:"k-filter-bar","data-testid":"k-filter-bar"},[S("button",{class:"k-focus-filter-input-button",title:"Focus filter",type:"button","data-testid":"k-filter-bar-focus-filter-input-button",onClick:ee},[Me,p(),S("span",Pe,[x(m(ce),{decorative:"","data-testid":"k-filter-bar-filter-icon","hide-title":"",size:m(N)},null,8,["size"])])]),p(),S("label",{for:`${t.id}-filter-bar-input`,class:"visually-hidden"},[J(e.$slots,"default",{},()=>[p(k(_.value),1)],!0)],8,je),p(),de(S("input",{id:`${t.id}-filter-bar-input`,ref_key:"filterInput",ref:a,"onUpdate:modelValue":u[0]||(u[0]=f=>o.value=f),class:"k-filter-bar-input",type:"text",placeholder:C.value,"data-testid":"k-filter-bar-filter-input",onFocus:u[1]||(u[1]=f=>d.value=!0),onBlur:ae,onChange:A},null,40,Ke),[[fe,o.value]]),p(),d.value?(c(),g("div",Re,[S("div",Qe,[l.value!==null?(c(),g("p",Ue,k(l.value.message),1)):(c(),g("button",{key:1,class:H(["k-submit-query-button",{"k-submit-query-button-is-selected":b.value===-1}]),title:"Submit query",type:"button","data-testid":"k-filter-bar-submit-query-button",onClick:F},`
          Submit `+k(o.value),3)),p(),(c(!0),g(I,null,Q(r.value,(f,E)=>(c(),g("div",{key:`${t.id}-${E}`,class:H(["k-suggestion-list-item",{"k-suggestion-list-item-is-selected":b.value===E}])},[S("b",null,k(f.fieldName),1),f.description!==""?(c(),g("span",Ve,": "+k(f.description),1)):q("",!0),p(),S("button",{class:"k-apply-suggestion-button",title:`Add ${f.fieldName}:`,type:"button","data-filter-field":f.fieldName,"data-testid":"k-filter-bar-apply-suggestion-button",onClick:te},[S("span",He,"Add "+k(f.fieldName)+":",1),p(),x(m(pe),{decorative:"","hide-title":"",size:m(N)},null,8,["size"])],8,Oe)],2))),128))])])):q("",!0),p(),o.value!==""?(c(),g("button",{key:1,class:"k-clear-query-button",title:"Clear query",type:"button","data-testid":"k-filter-bar-clear-query-button",onClick:se},[We,p(),x(m(me),{decorative:"","hide-title":"",size:m(N)},null,8,["size"])])):q("",!0)],512))}});const ot=Y(Ze,[["__scopeId","data-v-349996e3"]]);export{nt as D,ot as F};
