import{d as F,f as T,g as d,h as Y,o as l,c,a as h,u as a,b as o,k as X,cu as K,bP as M,cv as U,cl as O,c9 as R,cd as W,w as k,e as u,F as b,bX as P,bV as m,i as $,c4 as N,j as S,bY as Z,bZ as q}from"./index.2d238a59.js";import{C as z}from"./ContentWrapper.6f82fa9b.js";import{_ as B,a as A,M as G}from"./MeshResources.af10325f.js";import{_ as H}from"./LabelList.vue_vue_type_style_index_0_lang.066e77d8.js";import{_ as J}from"./YamlView.vue_vue_type_script_setup_true_lang.196883ed.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.a51bf735.js";import"./ErrorBlock.6d694e33.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.ccaabdfd.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.f5cf526a.js";import"./_commonjsHelpers.f037b798.js";const Q={class:"chart-container mt-24"},ee=F({__name:"MeshCharts",setup(v){const t=T(),f=d(()=>t.getters.getServiceResourcesFetching),_=d(()=>t.getters.getMeshInsightsFetching),y=d(()=>t.getters.getChart("services")),g=d(()=>t.getters.getChart("dataplanes")),r=d(()=>t.getters.getChart("policies")),D=d(()=>t.getters.getChart("kumaDPVersions")),I=d(()=>t.getters.getChart("envoyVersions"));Y(()=>t.state.selectedMesh,function(){w()}),w();function w(){t.dispatch("fetchMeshInsights",t.state.selectedMesh),t.dispatch("fetchServices",t.state.selectedMesh)}return(E,x)=>(l(),c("div",Q,[h(B,{class:"chart",title:{singular:"SERVICE",plural:"SERVICES"},data:a(y).data,"is-loading":a(f),"save-chart":""},null,8,["data","is-loading"]),o(),h(B,{class:"chart",title:{singular:"DP PROXY",plural:"DP PROXIES"},data:a(g).data,url:{name:"data-plane-list-view",params:{mesh:a(t).state.selectedMesh}},"is-loading":a(_)},null,8,["data","url","is-loading"]),o(),h(B,{class:"chart",title:{singular:"POLICY",plural:"POLICIES"},data:a(r).data,url:{name:"policies",params:{mesh:a(t).state.selectedMesh}},"is-loading":a(_)},null,8,["data","url","is-loading"]),o(),h(A,{class:"chart",title:"KUMA DP",data:a(D).data,"is-loading":a(_)},null,8,["data","is-loading"]),o(),h(A,{class:"chart",title:"ENVOY",data:a(I).data,"is-loading":a(_),"display-am-charts-logo":""},null,8,["data","is-loading"])]))}});const ae=X(ee,[["__scopeId","data-v-2a02347c"]]),te=v=>(Z("data-v-35629297"),v=v(),q(),v),se={key:0},ne={key:1},le={key:1},oe={class:"policy-counts"},re=te(()=>u("h4",null,`
                  Policies
                `,-1)),ce={key:0},ie={key:0,class:"mt-4"},ue=F({__name:"MeshOverviewView",setup(v){const t=K(),f=T(),_=M(!0),y=M(!1),g=M(!1),r=M(null),D=M(null),I=d(()=>r.value!==null?U(r.value):null),w=d(()=>{if(r.value===null)return null;const{name:s,type:n,creationTime:p,modificationTime:e}=r.value;return{name:s,type:n,created:O(p),modified:O(e),"Data Plane Proxies":f.state.meshInsight.dataplanes.total}}),E=d(()=>{var C;if(r.value===null)return null;const s=V(r.value,"mtls"),n=V(r.value,"logging"),p=V(r.value,"metrics"),e=V(r.value,"tracing"),i=Boolean((C=r.value.routing)==null?void 0:C.localityAwareLoadBalancing);return{mtls:s,logging:n,metrics:p,tracing:e,localityAwareLoadBalancing:i}}),x=d(()=>f.state.policies.map(s=>{var n,p;return{...s,length:(p=(n=f.state.meshInsight.policies[s.name])==null?void 0:n.total)!=null?p:0}}));Y(()=>t.params.mesh,function(){t.name==="single-mesh-overview"&&(_.value=!0,g.value=!1,y.value=!1,L())}),L();async function L(){_.value=!0,g.value=!1;const s=t.params.mesh;try{r.value=await R.getMesh({name:s}),D.value=await R.getMeshInsights({name:s})}catch(n){y.value=!0,g.value=!0,console.error(n)}finally{_.value=!1}}function V(s,n){var i,C;if(s===null||s[n]===void 0)return!1;const p=(C=(i=s[n].enabledBackend)!=null?i:s[n].defaultBackend)!=null?C:s[n].backends[0].name,e=s[n].backends.find(j=>j.name===p);return`${e.type} / ${e.name}`}return(s,n)=>{const p=W("router-link");return l(),c(b,null,[h(ae),o(),h(z,{class:"mt-8"},{content:k(()=>[r.value!==null?(l(),c("div",se,[h(H,{"has-error":y.value,"is-loading":_.value,"is-empty":g.value},{default:k(()=>[u("div",null,[u("ul",null,[(l(!0),c(b,null,P(a(w),(e,i)=>(l(),c("li",{key:i},[u("h4",null,m(i),1),o(),typeof e=="boolean"?(l(),$(a(N),{key:0,appearance:e?"success":"danger"},{default:k(()=>[o(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),c("p",ne,m(e),1))]))),128))])]),o(),u("div",null,[u("ul",null,[(l(!0),c(b,null,P(a(E),(e,i)=>(l(),c("li",{key:i},[u("h4",null,m(i),1),o(),typeof e=="boolean"?(l(),$(a(N),{key:0,appearance:e?"success":"danger"},{default:k(()=>[o(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),c("p",le,m(e),1))]))),128))])]),o(),u("div",null,[u("ul",oe,[u("li",null,[re,o(),u("ul",null,[(l(!0),c(b,null,P(a(x),(e,i)=>(l(),c(b,{key:i},[e.length!==0?(l(),c("li",ce,[h(p,{to:{name:e.path}},{default:k(()=>[o(m(e.pluralDisplayName)+": "+m(e.length),1)]),_:2},1032,["to"])])):S("",!0)],64))),128))])])])])]),_:1},8,["has-error","is-loading","is-empty"])])):S("",!0)]),_:1}),o(),a(I)!==null?(l(),c("div",ie,[h(J,{id:"code-block-mesh",content:a(I)},null,8,["content"])])):S("",!0),o(),h(G,{class:"mt-6"})],64)}}});const ke=X(ue,[["__scopeId","data-v-35629297"]]);export{ke as default};
