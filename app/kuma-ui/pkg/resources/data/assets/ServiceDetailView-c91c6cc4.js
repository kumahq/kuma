import{d as L,c as v,r as I,o as s,a as o,w as t,q as z,h as i,b as p,f as _,g as a,t as h,e as k,F as B,G as V,s as N,U as E}from"./index-840bc7ec.js";import{D as K,a as d}from"./DefinitionListItem-4f46bfa4.js";import{_ as R}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-40ea73ad.js";import{m as O,g as A,S as G,f as P,A as J,o as q,q as U,E as W,r as j,_ as H}from"./RouteView.vue_vue_type_script_setup_true_lang-3639338c.js";import{T as M}from"./TagList-656584ef.js";import{T as Q}from"./TextWithCopyButton-989adcfd.js";import{_ as X}from"./RouteTitle.vue_vue_type_script_setup_true_lang-6980b8ac.js";import{D as Y,K as Z}from"./KFilterBar-c934793c.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-d059b5be.js";import"./CopyButton-6a8a0e66.js";import"./AppCollection-c6def7d9.js";import"./dataplane-30467516.js";import"./notEmpty-7f452b20.js";const D={class:"entity-section-list"},ee=L({__name:"ServiceSummary",props:{service:{},externalService:{default:null}},setup(S){const e=S,f=O(),{t:w}=A(),C=v(()=>({name:"service-detail-view",params:{service:e.service.name,mesh:e.service.mesh}})),l=v(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.networking.address:e.service.addressPort??null),m=v(()=>{var n;return e.service.serviceType==="external"&&e.externalService!==null?(n=e.externalService.networking.tls)!=null&&n.enabled?"Enabled":"Disabled":null}),x=v(()=>{var n,r;if(e.service.serviceType==="external")return null;{const u=((n=e.service.dataplanes)==null?void 0:n.online)??0,b=((r=e.service.dataplanes)==null?void 0:r.total)??0;return`${u} online / ${b} total`}}),y=v(()=>e.service.serviceType==="external"?null:e.service.status??null),g=v(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.tags:null);async function T(n){if(e.service.serviceType==="external"&&e.externalService!==null){const{mesh:r,name:u}=e.externalService;return await f.getExternalService({mesh:r,name:u},n)}else{const{mesh:r,name:u}=e.service;return await f.getServiceInsight({mesh:r,name:u},n)}}return(n,r)=>{const u=I("RouterLink");return s(),o(p(V),null,{body:t(()=>[z("div",D,[z("section",null,[i(K,null,{default:t(()=>[y.value?(s(),o(d,{key:0,term:p(w)("http.api.property.status")},{default:t(()=>[i(G,{status:y.value},null,8,["status"])]),_:1},8,["term"])):_("",!0),a(),i(d,{term:p(w)("http.api.property.name")},{default:t(()=>[i(Q,{text:e.service.name},{default:t(()=>[i(u,{to:C.value},{default:t(()=>[a(h(e.service.name),1)]),_:1},8,["to"])]),_:1},8,["text"])]),_:1},8,["term"]),a(),i(d,{term:"Address"},{default:t(()=>[l.value!==null?(s(),k(B,{key:0},[a(h(l.value),1)],64)):(s(),k(B,{key:1},[a(`
                —
              `)],64))]),_:1}),a(),m.value!==null?(s(),o(d,{key:1,term:"TLS"},{default:t(()=>[a(h(m.value),1)]),_:1})):_("",!0),a(),x.value!==null?(s(),o(d,{key:2,term:"Data Plane Proxies"},{default:t(()=>[a(h(x.value),1)]),_:1})):_("",!0),a(),g.value!==null?(s(),o(d,{key:3,term:"Tags"},{default:t(()=>[i(M,{tags:g.value},null,8,["tags"])]),_:1})):_("",!0)]),_:1})]),a(),i(R,{id:"code-block-service",resource:e.service,"resource-fetcher":T,"is-searchable":"","show-copy-as-kubernetes-button":e.service.serviceType==="external"&&e.externalService!==null,"code-max-height":"250px"},null,8,["resource","show-copy-as-kubernetes-button"])])]),_:1})}}});const te=P(ee,[["__scopeId","data-v-9908cfda"]]),re={key:3,class:"stack"},se=L({__name:"ServiceDetailView",props:{page:{},size:{},search:{},query:{},gatewayType:{},mesh:{},service:{}},setup(S){const e=S,{t:f}=A();return(w,C)=>(s(),o(H,{name:"service-detail-view","data-testid":"service-detail-view"},{default:t(({route:l})=>[i(J,{breadcrumbs:[{to:{name:"services-list-view",params:{mesh:l.params.mesh}},text:p(f)("services.routes.item.breadcrumbs")}]},{title:t(()=>[z("h2",null,[i(X,{title:p(f)("services.routes.item.title",{name:l.params.service}),render:!0},null,8,["title"])])]),default:t(()=>[a(),i(q,{src:`/meshes/${l.params.mesh}/service-insights/${l.params.service}`},{default:t(({data:m,isLoading:x,error:y})=>[i(q,{src:`/meshes/${l.params.mesh}/external-services/${l.params.service}`},{default:t(({data:g,isLoading:T,error:n})=>[x||T?(s(),o(U,{key:0})):y??n?(s(),o(W,{key:1,error:y??n},null,8,["error"])):m===void 0||g===void 0?(s(),o(j,{key:2})):(s(),k("div",re,[i(te,{service:m,"external-service":g},null,8,["service","external-service"]),a(),(m==null?void 0:m.serviceType)!=="external"?(s(),o(q,{key:0,src:`/meshes/${l.params.mesh}/dataplanes/for/${l.params.service}/of/${e.gatewayType}?page=${e.page}&size=${e.size}&search=${e.search}`},{default:t(({data:r,error:u})=>{var b;return[(s(!0),k(B,null,N([typeof((b=r==null?void 0:r.items)==null?void 0:b[0].dataplane.networking.gateway)>"u"],$=>(s(),o(p(V),{key:$},{body:t(()=>[i(Y,{"data-testid":"data-plane-collection",class:"data-plane-collection","page-number":e.page,"page-size":e.size,total:r==null?void 0:r.total,items:r==null?void 0:r.items,error:u,gateways:$,onChange:({page:c,size:F})=>{l.update({page:String(c),size:String(F)})}},{toolbar:t(()=>[i(Z,{class:"data-plane-proxy-filter",placeholder:"tag: 'kuma.io/protocol: http'",query:e.query,fields:{name:{description:"filter by name or parts of a name"},protocol:{description:"filter by “kuma.io/protocol” value"},tag:{description:"filter by tags (e.g. “tag: version:2”)"},zone:{description:"filter by “kuma.io/zone” value"}},onFieldsChange:c=>l.update({query:c.query,s:c.query.length>0?JSON.stringify(c.fields):""})},null,8,["placeholder","query","fields","onFieldsChange"]),a(),$?(s(),o(p(E),{key:0,label:"Type","overlay-label":!0,items:[{label:"All",value:"all"},{label:"Builtin",value:"builtin"},{label:"Delegated",value:"delegated"}].map(c=>({...c,selected:c.value===e.gatewayType})),appearance:"select",onSelected:c=>l.update({gatewayType:String(c.value)})},{"item-template":t(({item:c})=>[a(h(c.label),1)]),_:2},1032,["items","onSelected"])):_("",!0)]),_:2},1032,["page-number","page-size","total","items","error","gateways","onChange"])]),_:2},1024))),128))]}),_:2},1032,["src"])):_("",!0)]))]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["breadcrumbs"])]),_:1}))}});const ye=P(se,[["__scopeId","data-v-2cd714a6"]]);export{ye as default};
