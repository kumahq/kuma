import{d as rt,Q as lt,r as c,m as b,o as i,w as t,b as o,s as B,T as ut,c as u,e as a,F as m,v,p as _,q as C,L as w,S as mt,t as r,M as U,K as yt,C as ct,_ as bt}from"./index-BfbnxhY1.js";import{S as ft}from"./SummaryView-CK2XSYPn.js";import{T as gt}from"./TagList-Bx_e5CS2.js";import{C as W,a as A,b as R}from"./ConnectionTraffic-b3GDWcbs.js";const kt={"data-testid":"dataplane-mtls"},vt={class:"columns"},_t={key:0,"data-testid":"dataplane-subscriptions"},wt=rt({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(Y){const N=lt(),s=Y;return(Ct,e)=>{const q=c("XI18n"),E=c("XNotification"),z=c("XIcon"),$=c("DataCollection"),h=c("XLayout"),X=c("XAction"),T=c("XBadge"),Z=c("XCopyButton"),tt=c("XAboutCard"),O=c("XEmptyState"),et=c("XInputSwitch"),at=c("XProgress"),S=c("XCard"),nt=c("RouterView"),ot=c("AppView"),st=c("DataSource"),it=c("RouteView");return i(),b(it,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:t(({route:f,t:l,can:V,me:I,uri:dt})=>[o(st,{src:dt(B(ut),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[f.params.proxyType]??"dataplane",name:f.params.proxy,mesh:f.params.mesh||"*",socketAddress:s.data.dataplane.networking.inboundAddress})},{default:t(({data:g,error:x,refresh:pt})=>[o(ot,{notifications:!0},{default:t(()=>{var P,j,L,F,M,G,K,Q,H,J;return[(i(!0),u(m,null,v([{bool:((j=(P=s.data.dataplaneInsight.version)==null?void 0:P.kumaDp)==null?void 0:j.kumaCpCompatible)===!1,key:"dp-cp-incompatible",params:{kumaDp:((L=s.data.dataplaneInsight.version)==null?void 0:L.kumaDp.version)??""}},{bool:((M=(F=s.data.dataplaneInsight.version)==null?void 0:F.envoy)==null?void 0:M.kumaDpCompatible)===!1,key:"envoy-dp-incompatible",params:{envoy:((G=s.data.dataplaneInsight.version)==null?void 0:G.envoy.version)??"",kumaDp:((K=s.data.dataplaneInsight.version)==null?void 0:K.kumaDp.version)??""}},{bool:V("use zones")&&s.data.zone&&((H=(Q=s.data.dataplaneInsight.version)==null?void 0:Q.kumaDp)==null?void 0:H.kumaCpCompatible)===!1,key:"dp-zone-cp-incompatible",params:{kumaDp:((J=s.data.dataplaneInsight.version)==null?void 0:J.kumaDp.version)??""}},{bool:s.data.isCertExpired,key:"certificate-expired"},{bool:!s.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!!x,key:"stats-not-enhanced",params:{error:(x==null?void 0:x.toString())??""}}],({bool:n,key:d,params:p})=>(i(),u(m,{key:d},[n?(i(),b(E,{key:0,"data-testid":`warning-${d}`,uri:`data-planes.notifications.${d}.${s.data.id}`},{default:t(()=>[o(q,{path:`data-planes.notifications.${d}`,params:Object.fromEntries(Object.entries(p??{}))},null,8,["path","params"])]),_:2},1032,["data-testid","uri"])):_("",!0)],64))),128)),e[46]||(e[46]=a()),o(h,{type:"stack","data-testid":"dataplane-details"},{default:t(()=>[o(tt,{title:l("data-planes.routes.item.about.title"),created:s.data.creationTime,modified:s.data.modificationTime},{default:t(()=>[o(w,{layout:"horizontal"},{title:t(()=>[a(r(l("http.api.property.status")),1)]),body:t(()=>[o(h,{type:"separated"},{default:t(()=>[o(mt,{status:s.data.status},null,8,["status"]),e[0]||(e[0]=a()),s.data.dataplaneType==="standard"?(i(),b($,{key:0,items:s.data.dataplane.networking.inbounds,predicate:n=>n.state!=="Ready",empty:!1},{default:t(({items:n})=>[o(z,{name:"info"},{default:t(()=>[C("ul",null,[(i(!0),u(m,null,v(n,d=>(i(),u("li",{key:`${d.service}:${d.port}`},r(l("data-planes.routes.item.unhealthy_inbound",{service:d.service,port:d.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):_("",!0)]),_:2},1024)]),_:2},1024),e[7]||(e[7]=a()),V("use zones")&&s.data.zone?(i(),b(w,{key:0,layout:"horizontal"},{title:t(()=>[a(r(l("http.api.property.zone")),1)]),body:t(()=>[o(T,{appearance:"decorative"},{default:t(()=>[o(X,{to:{name:"zone-cp-detail-view",params:{zone:s.data.zone}}},{default:t(()=>[a(r(s.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2},1024)):_("",!0),e[8]||(e[8]=a()),o(w,{layout:"horizontal"},{title:t(()=>[a(r(l("http.api.proptery.type")),1)]),body:t(()=>[o(T,{appearance:"decorative"},{default:t(()=>[a(r(l(`data-planes.type.${s.data.dataplaneType}`)),1)]),_:2},1024)]),_:2},1024),e[9]||(e[9]=a()),s.data.namespace.length>0?(i(),b(w,{key:1,layout:"horizontal"},{title:t(()=>[a(r(l("http.api.property.namespace")),1)]),body:t(()=>[o(T,{appearance:"decorative"},{default:t(()=>[a(r(s.data.namespace),1)]),_:1})]),_:2},1024)):_("",!0),e[10]||(e[10]=a()),o(w,{layout:"horizontal"},{title:t(()=>[a(r(l("http.api.property.address")),1)]),body:t(()=>[o(Z,{variant:"badge",format:"default",text:`${s.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024),e[11]||(e[11]=a()),s.data.dataplane.networking.gateway?(i(),b(w,{key:2,layout:"horizontal"},{title:t(()=>[a(r(l("http.api.property.tags")),1)]),body:t(()=>[o(gt,{tags:s.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024)):_("",!0)]),_:2},1032,["title","created","modified"]),e[42]||(e[42]=a()),o(S,{class:"traffic","data-testid":"dataplane-traffic"},{default:t(()=>[o(h,{type:"columns"},{default:t(()=>[o(W,null,{title:t(()=>[o(h,{type:"separated"},{default:t(()=>[o(z,{name:"inbound"}),e[12]||(e[12]=a()),e[13]||(e[13]=C("span",null,"Inbounds",-1))]),_:1})]),default:t(()=>[e[15]||(e[15]=a()),(i(!0),u(m,null,v([s.data.dataplane.networking.type==="gateway"?Object.entries((g==null?void 0:g.inbounds)??{}).reduce((n,[d,p])=>{var k;const y=d.split("_").at(-1);return y===(((k=s.data.dataplane.networking.admin)==null?void 0:k.port)??"9901")?n:n.concat([{...s.data.dataplane.networking.inbounds[0],name:d,port:Number(y),protocol:["http","tcp"].find(D=>typeof p[D]<"u")??"tcp",addressPort:`${s.data.dataplane.networking.inbounds[0].address}:${y}`}])},[]):s.data.dataplane.networking.inbounds],n=>(i(),b(A,{key:n,type:"inbound","data-testid":"dataplane-inbounds"},{default:t(()=>[o($,{type:"inbounds",items:n,predicate:d=>d.port!==49151},U({default:t(({items:d})=>[o(h,{type:"stack",size:"small"},{default:t(()=>[(i(!0),u(m,null,v(d,p=>(i(),u(m,{key:`${p.name}`},[(i(!0),u(m,null,v([g==null?void 0:g.inbounds[p.name]],y=>(i(),b(R,{key:y,"data-testid":"dataplane-inbound",protocol:p.protocol,service:V("use service-insights",s.mesh)?p.tags["kuma.io/service"]:"","port-name":p.portName,traffic:typeof x>"u"?y:{name:"",protocol:p.protocol,port:`${p.port}`}},{default:t(()=>[o(X,{"data-action":"",to:{name:(k=>k.includes("bound")?k.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(B(N).name)),params:{connection:p.name},query:{inactive:f.params.inactive}}},{default:t(()=>[a(r(p.name.replace("localhost","").replace("_",":")),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","service","port-name","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},[s.data.dataplaneType==="delegated"?{name:"empty",fn:t(()=>[o(O,null,{default:t(()=>[C("p",null,`
                            This proxy is a delegated gateway therefore `+r(l("common.product.name"))+` does not have any
                            visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),e[26]||(e[26]=a()),o(W,null,U({title:t(()=>[o(h,{type:"separated"},{default:t(()=>[o(z,{name:"outbound"}),e[19]||(e[19]=a()),e[20]||(e[20]=C("span",null,"Outbounds",-1))]),_:1})]),default:t(()=>[e[24]||(e[24]=a()),e[25]||(e[25]=a()),typeof x>"u"?(i(),u(m,{key:0},[typeof g>"u"?(i(),b(at,{key:0})):(i(),u(m,{key:1},[o(A,{type:"passthrough"},{default:t(()=>[o(R,{protocol:"passthrough",traffic:g.passthrough},{default:t(()=>e[21]||(e[21]=[a(`
                        Non mesh traffic
                      `)])),_:2},1032,["traffic"])]),_:2},1024),e[23]||(e[23]=a()),(i(),u(m,null,v(["upstream"],n=>(i(),u(m,{key:n},[Object.values(g.outbounds).find(d=>{var p,y;return(typeof d.tcp<"u"?(p=d.tcp)==null?void 0:p[`${n}_cx_rx_bytes_total`]:(y=d.http)==null?void 0:y[`${n}_rq_total`])??!1})?(i(),b(E,{key:0,variant:"info",uri:`data-planes.notifications.recommend-reachable-services:${s.data.id}`},{default:t(()=>[o(q,{path:"data-planes.notifications.recommend-reachable",params:{mode:s.mesh.meshServices.mode}},null,8,["params"])]),_:1},8,["uri"])):_("",!0),e[22]||(e[22]=a()),o($,{type:"outbounds",predicate:f.params.inactive?void 0:([d,p])=>{var y,k;return((typeof p.tcp<"u"?(y=p.tcp)==null?void 0:y[`${n}_cx_rx_bytes_total`]:(k=p.http)==null?void 0:k[`${n}_rq_total`])??0)>0},items:Object.entries(g.outbounds)},{default:t(({items:d})=>[d.length>0?(i(),b(A,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:t(()=>[(i(),u(m,null,v([/-([a-f0-9]){16}$/],p=>o(h,{key:p,type:"stack",size:"small"},{default:t(()=>[(i(!0),u(m,null,v(d,([y,k])=>(i(),b(R,{key:`${y}`,"data-testid":"dataplane-outbound",protocol:["grpc","http","tcp"].find(D=>typeof k[D]<"u")??"tcp",traffic:k,service:k.$resourceMeta.type===""?y.replace(p,""):void 0,direction:n},{default:t(()=>[o(X,{"data-action":"",to:{name:(D=>D.includes("bound")?D.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(B(N).name)),params:{connection:y},query:{inactive:f.params.inactive}}},{default:t(()=>[a(r(y),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","service","direction"]))),128))]),_:2},1024)),64))]),_:2},1024)):_("",!0)]),_:2},1032,["predicate","items"])],64))),64))],64))],64)):(i(),b(O,{key:1}))]),_:2},[g?{name:"actions",fn:t(()=>[o(et,{checked:f.params.inactive,"data-testid":"dataplane-outbounds-inactive-toggle",onChange:n=>f.update({inactive:n})},{label:t(()=>e[16]||(e[16]=[a(`
                      Show inactive
                    `)])),_:2},1032,["checked","onChange"]),e[18]||(e[18]=a()),o(X,{action:"refresh",appearance:"primary",onClick:pt},{default:t(()=>e[17]||(e[17]=[a(`
                    Refresh
                  `)])),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024),e[43]||(e[43]=a()),o(nt,null,{default:t(n=>[n.route.name!==f.name?(i(),b(ft,{key:0,width:"670px",onClose:function(){f.replace({name:"data-plane-detail-view",params:{mesh:f.params.mesh,proxy:f.params.proxy},query:{inactive:f.params.inactive?null:void 0}})}},{default:t(()=>[(i(),b(yt(n.Component),{data:f.params.subscription.length>0?s.data.dataplaneInsight.subscriptions:n.route.name.includes("-inbound-")?s.data.dataplane.networking.inbounds:(g==null?void 0:g.outbounds)||{},networking:s.data.dataplane.networking},null,8,["data","networking"]))]),_:2},1032,["onClose"])):_("",!0)]),_:2},1024),e[44]||(e[44]=a()),C("div",kt,[s.data.dataplaneInsight.mTLS?(i(!0),u(m,{key:0},v([s.data.dataplaneInsight.mTLS],n=>(i(),b(S,{key:n},{title:t(()=>[C("h2",null,r(l("data-planes.routes.item.mtls.title")),1)]),default:t(()=>[e[36]||(e[36]=a()),C("div",vt,[o(w,null,{title:t(()=>[a(r(l("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:t(()=>[a(r(l("common.formats.datetime",{value:Date.parse(n.certificateExpirationTime)})),1)]),_:2},1024),e[32]||(e[32]=a()),o(w,null,{title:t(()=>[a(r(l("data-planes.routes.item.mtls.generation_time.title")),1)]),body:t(()=>[a(r(l("common.formats.datetime",{value:Date.parse(n.lastCertificateRegeneration)})),1)]),_:2},1024),e[33]||(e[33]=a()),o(w,null,{title:t(()=>[a(r(l("data-planes.routes.item.mtls.regenerations.title")),1)]),body:t(()=>[a(r(l("common.formats.integer",{value:n.certificateRegenerations})),1)]),_:2},1024),e[34]||(e[34]=a()),o(w,null,{title:t(()=>[a(r(l("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:t(()=>[a(r(n.issuedBackend),1)]),_:2},1024),e[35]||(e[35]=a()),o(w,null,{title:t(()=>[a(r(l("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:t(()=>[C("ul",null,[(i(!0),u(m,null,v(n.supportedBackends,d=>(i(),u("li",{key:d},r(d),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):_("",!0)]),e[45]||(e[45]=a()),s.data.dataplaneInsight.subscriptions.length>0?(i(),u("div",_t,[o(S,null,{title:t(()=>[C("h2",null,r(l("data-planes.routes.item.subscriptions.title")),1)]),default:t(()=>[e[41]||(e[41]=a()),o(ct,{headers:[{...I.get("headers.instanceId"),label:l("http.api.property.instanceId"),key:"instanceId"},{...I.get("headers.version"),label:l("http.api.property.version"),key:"version"},{...I.get("headers.connected"),label:l("http.api.property.connected"),key:"connected"},{...I.get("headers.disconnected"),label:l("http.api.property.disconnected"),key:"disconnected"},{...I.get("headers.responses"),label:l("http.api.property.responses"),key:"responses"}],"is-selected-row":n=>n.id===f.params.subscription,items:s.data.dataplaneInsight.subscriptions.map((n,d,p)=>p[p.length-(d+1)]),onResize:I.set},{instanceId:t(({row:n})=>[o(X,{"data-action":"",to:{name:"data-plane-subscription-summary-view",params:{subscription:n.id}}},{default:t(()=>[a(r(n.controlPlaneInstanceId),1)]),_:2},1032,["to"])]),version:t(({row:n})=>{var d,p;return[a(r(((p=(d=n.version)==null?void 0:d.kumaDp)==null?void 0:p.version)??"-"),1)]}),connected:t(({row:n})=>[a(r(l("common.formats.datetime",{value:Date.parse(n.connectTime??"")})),1)]),disconnected:t(({row:n})=>[n.disconnectTime?(i(),u(m,{key:0},[a(r(l("common.formats.datetime",{value:Date.parse(n.disconnectTime)})),1)],64)):_("",!0)]),responses:t(({row:n})=>{var d;return[(i(!0),u(m,null,v([((d=n.status)==null?void 0:d.total)??{}],p=>(i(),u(m,null,[a(r(p.responsesSent)+"/"+r(p.responsesAcknowledged),1)],64))),256))]}),_:2},1032,["headers","is-selected-row","items","onResize"])]),_:2},1024)])):_("",!0)]),_:2},1024)]}),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),Xt=bt(wt,[["__scopeId","data-v-77b78da0"]]);export{Xt as default};
