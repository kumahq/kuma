import{A as K,a as O}from"./AccordionList-Ca9DGQeI.js";import{d as S,a as k,o as e,c as t,m as c,f as l,F as r,H as b,t as p,e as u,w as a,p as C,b as y,X as D,x as G,y as z,_ as x,M as J,q as P,l as H,n as M,a2 as Q}from"./index-2mpecEEN.js";import{C as q}from"./CodeBlock-MuT-Pggn.js";import{P as X}from"./PolicyTypeTag-ncg6p5WU.js";import{T as F}from"./TagList-JmFVLj28.js";import{t as Y}from"./toYaml-sPaYOD3i.js";import{A as U}from"./AppCollection-0LRJcRDP.js";const w=h=>(G("data-v-f3e7afbb"),h=h(),z(),h),W={class:"policies-list"},Z={class:"mesh-gateway-policy-list"},E=w(()=>c("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),ee={key:0},te=w(()=>c("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),ae=w(()=>c("b",null,"Host",-1)),se=w(()=>c("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),le={class:"dataplane-policy-header"},oe=w(()=>c("b",null,"Route",-1)),ne=w(()=>c("b",null,"Service",-1)),ie={key:0,class:"badge-list"},ce={class:"mt-1"},re=S({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},policyTypesByName:{}},setup(h){const _=h;return(f,L)=>{const $=k("RouterLink"),g=k("KBadge");return e(),t("div",W,[c("div",Z,[E,l(),f.gatewayDataplane.routePolicies.length>0?(e(),t("ul",ee,[(e(!0),t(r,null,b(f.gatewayDataplane.routePolicies,(i,o)=>(e(),t("li",{key:o},[c("span",null,p(i.type),1),l(`:

          `),u($,{to:{name:"policy-detail-view",params:{mesh:i.mesh,policyPath:_.policyTypesByName[i.type].path,policy:i.name}}},{default:a(()=>[l(p(i.name),1)]),_:2},1032,["to"])]))),128))])):C("",!0),l(),te,l(),c("div",null,[(e(!0),t(r,null,b(f.gatewayDataplane.listenerEntries,(i,o)=>(e(),t("div",{key:o},[c("div",null,[c("div",null,[ae,l(": "+p(i.hostName)+":"+p(i.port)+" ("+p(i.protocol)+`)
            `,1)]),l(),i.routeEntries.length>0?(e(),t(r,{key:0},[se,l(),u(O,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),t(r,null,b(i.routeEntries,(n,d)=>(e(),y(K,{key:d},D({"accordion-header":a(()=>[c("div",le,[c("div",null,[c("div",null,[oe,l(": "),u($,{to:{name:"policy-detail-view",params:{mesh:n.route.mesh,policyPath:_.policyTypesByName[n.route.type].path,policy:n.route.name}}},{default:a(()=>[l(p(n.route.name),1)]),_:2},1032,["to"])]),l(),c("div",null,[ne,l(": "+p(n.service),1)])]),l(),n.origins.length>0?(e(),t("div",ie,[(e(!0),t(r,null,b(n.origins,(s,m)=>(e(),y(g,{key:`${o}-${m}`},{default:a(()=>[l(p(s.type),1)]),_:2},1024))),128))])):C("",!0)])]),_:2},[n.origins.length>0?{name:"accordion-content",fn:a(()=>[c("ul",ce,[(e(!0),t(r,null,b(n.origins,(s,m)=>(e(),t("li",{key:`${o}-${m}`},[l(p(s.type)+`:

                        `,1),u($,{to:{name:"policy-detail-view",params:{mesh:s.mesh,policyPath:_.policyTypesByName[s.type].path,policy:s.name}}},{default:a(()=>[l(p(s.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):C("",!0)])]))),128))])])])}}}),pe=x(re,[["__scopeId","data-v-f3e7afbb"]]),ue={class:"policy-type-heading"},de={class:"policy-list"},me={key:0},ye=S({__name:"PolicyTypeEntryList",props:{policyTypeEntries:{},policyTypesByName:{}},setup(h){const _=h,f=J(()=>_.policyTypeEntries.filter($=>{var g;return((g=_.policyTypesByName[$.type])==null?void 0:g.isTargetRefBased)===!1}));function L({headerKey:$}){return{class:`cell-${$}`}}return($,g)=>{const i=k("RouterLink"),o=k("KTable");return e(),y(O,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),t(r,null,b(f.value,(n,d)=>(e(),y(K,{key:d},{"accordion-header":a(()=>[c("h3",ue,[u(X,{"policy-type":n.type},{default:a(()=>[l(p(n.type)+" ("+p(n.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[c("div",de,[u(o,{class:"policy-type-table",fetcher:()=>({data:n.connections,total:n.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":L,"disable-pagination":"","is-clickable":""},{sourceTags:a(({row:s})=>[s.sourceTags.length>0?(e(),y(F,{key:0,class:"tag-list","should-truncate":"",tags:s.sourceTags},null,8,["tags"])):(e(),t(r,{key:1},[l(`
                —
              `)],64))]),destinationTags:a(({row:s})=>[s.destinationTags.length>0?(e(),y(F,{key:0,class:"tag-list","should-truncate":"",tags:s.destinationTags},null,8,["tags"])):(e(),t(r,{key:1},[l(`
                —
              `)],64))]),name:a(({row:s})=>[s.name!==null?(e(),t(r,{key:0},[l(p(s.name),1)],64)):(e(),t(r,{key:1},[l(`
                —
              `)],64))]),origins:a(({row:s})=>[s.origins.length>0?(e(),t("ul",me,[(e(!0),t(r,null,b(s.origins,(m,v)=>(e(),t("li",{key:`${d}-${v}`},[u(i,{to:{name:"policy-detail-view",params:{mesh:m.mesh,policyPath:_.policyTypesByName[m.type].path,policy:m.name}}},{default:a(()=>[l(p(m.name),1)]),_:2},1032,["to"])]))),128))])):(e(),t(r,{key:1},[l(`
                —
              `)],64))]),config:a(({row:s})=>[s.config?(e(),y(q,{key:0,code:P(Y)(s.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),t(r,{key:1},[l(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}}),_e=x(ye,[["__scopeId","data-v-18983fd0"]]),he=h=>(G("data-v-cdc04375"),h=h(),z(),h),fe={class:"policy-type-heading"},ge={key:0,class:"matcher"},ke={key:0,class:"matcher__and"},be=he(()=>c("br",null,null,-1)),$e={key:1,class:"matcher__not"},ve={class:"matcher__term"},Te={key:1},Be={key:0},Ce=S({__name:"RuleEntryList",props:{rules:{},policyTypesByName:{}},setup(h){const{t:_}=H(),f=h;return(L,$)=>{const g=k("RouterLink");return e(),y(O,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),t(r,null,b([f.rules.reduce((i,o)=>(typeof i[o.type]>"u"&&(i[o.type]=[]),i[o.type].push(o),i),{})],i=>(e(),t(r,{key:i},[(e(!0),t(r,null,b(i,(o,n)=>(e(),y(K,{key:n},{"accordion-header":a(()=>[c("h3",fe,[u(X,{"policy-type":n},{default:a(()=>[l(p(n),1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[(e(!0),t(r,null,b([o.some(d=>d.matchers.length>0)],d=>(e(),t("div",{key:d,class:"policy-list"},[u(U,{class:M(["policy-type-table",{"has-matchers":d}]),total:o.length,items:o,headers:[...d?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:a(({row:s})=>[s.matchers.length>0?(e(),t("span",ge,[(e(!0),t(r,null,b(s.matchers,({key:m,value:v,not:V},T)=>(e(),t(r,{key:T},[T>0?(e(),t("span",ke,[l(" and"),be])):C("",!0),V?(e(),t("span",$e,"!")):C("",!0),c("span",ve,p(`${m}:${v}`),1)],64))),128))])):(e(),t("i",Te,p(P(_)("data-planes.routes.item.matches_everything")),1))]),origins:a(({row:s})=>[s.origins.length>0?(e(),t("ul",Be,[(e(!0),t(r,null,b(s.origins,(m,v)=>(e(),t("li",{key:`${n}-${v}`},[u(g,{to:{name:"policy-detail-view",params:{mesh:m.mesh,policyPath:f.policyTypesByName[m.type].path,policy:m.name}}},{default:a(()=>[l(p(m.name),1)]),_:2},1032,["to"])]))),128))])):(e(),t(r,{key:1},[l(p(P(_)("common.collection.none")),1)],64))]),config:a(({row:s})=>[s.config?(e(),y(q,{key:0,code:P(Y)(s.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),t(r,{key:1},[l(p(P(_)("common.collection.none")),1)],64))]),_:2},1032,["class","total","items","headers"])]))),128))]),_:2},1024))),128))],64))),128))]),_:1})}}}),I=x(Ce,[["__scopeId","data-v-cdc04375"]]),Pe={class:"stack"},Ne={class:"mb-2"},we=S({__name:"StandardDataplanePolicies",props:{rules:{},policyTypesByName:{}},setup(h){const{t:_}=H(),f=h;return(L,$)=>{const g=k("KCard"),i=k("DataCollection");return e(),t("div",Pe,[u(i,{items:f.rules,predicate:o=>o.ruleType==="proxy",comparator:(o,n)=>o.type.localeCompare(n.type),empty:!1},{default:a(({items:o})=>[u(g,null,{default:a(()=>[c("h3",null,p(P(_)("data-planes.routes.item.proxy_rule")),1),l(),u(I,{class:"mt-2",rules:o,"policy-types-by-name":f.policyTypesByName,"data-testid":"proxy-rule-list"},null,8,["rules","policy-types-by-name"])]),_:2},1024)]),_:1},8,["items","predicate","comparator"]),l(),u(i,{items:f.rules,predicate:o=>o.ruleType==="to",comparator:(o,n)=>o.type.localeCompare(n.type),empty:!1},{default:a(({items:o})=>[u(g,null,{default:a(()=>[c("h3",null,p(P(_)("data-planes.routes.item.to_rules")),1),l(),u(I,{class:"mt-2",rules:o,"policy-types-by-name":f.policyTypesByName,"data-testid":"to-rule-list"},null,8,["rules","policy-types-by-name"])]),_:2},1024)]),_:1},8,["items","predicate","comparator"]),l(),u(i,{items:f.rules,predicate:o=>o.ruleType==="from",comparator:(o,n)=>o.type.localeCompare(n.type),empty:!1},{default:a(({items:o})=>[u(g,null,{default:a(()=>[c("h3",Ne,p(P(_)("data-planes.routes.item.from_rules")),1),l(),(e(!0),t(r,null,b([o.reduce((n,d)=>{var s;return typeof((s=d.inbound)==null?void 0:s.port)<"u"&&(typeof n[d.inbound.port]>"u"&&(n[d.inbound.port]=[]),n[d.inbound.port].push(d)),n},{})],n=>(e(),t(r,{key:n},[(e(!0),t(r,null,b(Object.entries(n).sort(([d],[s])=>Number(s)-Number(d)),([d,s],m)=>(e(),t("div",{key:m},[c("h4",null,p(P(_)("data-planes.routes.item.port",{port:d})),1),l(),u(I,{class:"mt-2",rules:s,"policy-types-by-name":f.policyTypesByName,"data-testid":`from-rule-list-${m}`},null,8,["rules","policy-types-by-name","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:1},8,["items","predicate","comparator"])])}}}),Le={class:"stack"},Re={key:0},je=S({__name:"DataPlanePoliciesView",props:{data:{}},setup(h){const _=h;return(f,L)=>{const $=k("RouteTitle"),g=k("DataCollection"),i=k("DataLoader"),o=k("KCard"),n=k("DataSource"),d=k("AppView"),s=k("RouteView");return e(),y(s,{name:"data-plane-policies-view",params:{mesh:"",dataPlane:""}},{default:a(({can:m,route:v,t:V})=>[u(d,null,{title:a(()=>[c("h2",null,[u($,{title:V("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"])])]),default:a(()=>[l(),c("div",Le,[u(n,{src:"/*/policy-types"},{default:a(({data:T,error:A})=>[u(i,{src:`/meshes/${v.params.mesh}/dataplanes/${v.params.dataPlane}/rules`,data:[T],errors:[A]},{default:a(({data:B})=>[B&&T?(e(),y(g,{key:0,items:B.rules},{default:a(()=>[u(we,{"policy-types-by-name":T.policies.reduce((R,N)=>Object.assign(R,{[N.name]:N}),{}),rules:B.rules,"data-testid":"rules-based-policies"},null,8,["policy-types-by-name","rules"])]),_:2},1032,["items"])):C("",!0)]),_:2},1032,["src","data","errors"]),l(),m("use zones")?C("",!0):(e(),t("div",Re,[c("h3",null,p(V("data-planes.routes.item.legacy_policies")),1),l(),_.data.dataplaneType==="builtin"?(e(),y(i,{key:0,src:`/meshes/${v.params.mesh}/dataplanes/${v.params.dataPlane}/gateway-dataplane-policies`,data:[T],errors:[A]},{default:a(({data:B})=>[B?(e(),y(g,{key:0,items:B.routePolicies},{default:a(()=>[B.listenerEntries.length===0?(e(),y(Q,{key:0})):(e(),y(o,{key:1,class:"mt-4"},{default:a(()=>[T?(e(),y(pe,{key:0,"policy-types-by-name":T.policies.reduce((R,N)=>Object.assign(R,{[N.name]:N}),{}),"gateway-dataplane":B,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["policy-types-by-name","gateway-dataplane"])):C("",!0)]),_:2},1024))]),_:2},1032,["items"])):C("",!0)]),_:2},1032,["src","data","errors"])):(e(),y(i,{key:1,src:`/meshes/${v.params.mesh}/dataplanes/${v.params.dataPlane}/sidecar-dataplane-policies`,data:[T],errors:[A]},{default:a(({data:B})=>[B?(e(),y(g,{key:0,items:B.policyTypeEntries},{default:a(({items:R})=>[u(o,{class:"mt-4"},{default:a(()=>[T?(e(),y(_e,{key:0,"policy-type-entries":R,"policy-types-by-name":T.policies.reduce((N,j)=>Object.assign(N,{[j.name]:j}),{}),"data-testid":"sidecar-dataplane-policies"},null,8,["policy-type-entries","policy-types-by-name"])):C("",!0)]),_:2},1024)]),_:2},1032,["items"])):C("",!0)]),_:2},1032,["src","data","errors"]))]))]),_:2},1024)])]),_:2},1024)]),_:1})}}});export{je as default};
