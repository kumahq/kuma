import{a as tt,K as V}from"./index-52545d1d.js";import{_ as q,a as k,o as r,b as f,w as e,p as o,r as T,f as t,d as R,c,e as l,l as W,t as n,q as a,v as C,n as et,x as at,N as E,$ as st,a0 as v,a1 as ot,F as m,a2 as nt,J as g,a3 as lt,z as rt,A as dt}from"./index-ddb38e98.js";import{g as it,a as ct,b as ut,c as _t}from"./index-3d038f44.js";import{E as pt}from"./ErrorBlock-a5cb6d15.js";import{_ as ft}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-b38e136a.js";import{S as mt}from"./StatusBadge-105ed2f1.js";import{T as G}from"./TagList-bd8e05fd.js";import{T as B}from"./TextWithCopyButton-7c7a35f6.js";import{_ as ht}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-e5045d0e.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-726b6e24.js";import"./CopyButton-769bff11.js";import"./AccordionList-e1dac560.js";const vt={},yt={class:"card"},gt={class:"title"},kt={class:"body"};function xt(h,s){const p=k("KCard");return r(),f(p,{class:"data-card"},{default:e(()=>[o("dl",null,[o("div",yt,[o("dt",gt,[T(h.$slots,"title",{},void 0,!0)]),t(),o("dd",kt,[T(h.$slots,"default",{},void 0,!0)])])])]),_:3})}const F=q(vt,[["render",xt],["__scopeId","data-v-b31975bf"]]),bt={class:"service-traffic"},$t=R({__name:"DataPlaneTraffic",setup(h){return(s,p)=>(r(),c("div",bt,[l(F,{class:"header"},{title:e(()=>[T(s.$slots,"title",{},void 0,!0)]),_:3}),t(),T(s.$slots,"default",{},void 0,!0)]))}});const H=q($t,[["__scopeId","data-v-8e8bcc45"]]),wt={class:"title"},Ct={key:0},Tt=R({__name:"ServiceTrafficCard",props:{protocol:{},requests:{default:void 0},rx:{default:0},tx:{default:0}},setup(h){const{t:s}=W(),p=h;return(I,u)=>{const D=k("KBadge");return r(),f(F,{class:"service-traffic-card"},{title:e(()=>[l(D,{appearance:p.protocol==="unknown"?"success":"default"},{default:e(()=>[t(n(a(s)(`data-planes.components.service_traffic_card.protocol.${p.protocol}`,{},{defaultMessage:a(s)(`http.api.value.${p.protocol}`)})),1)]),_:1},8,["appearance"]),t(),o("span",wt,[T(I.$slots,"default",{},void 0,!0)])]),default:e(()=>[t(),o("dl",null,[o("div",null,[o("dt",null,n(a(s)("data-planes.components.service_traffic_card.tx")),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:p.tx})),1)]),t(),o("div",null,[o("dt",null,n(a(s)("data-planes.components.service_traffic_card.rx")),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:p.rx})),1)]),t(),typeof p.requests<"u"?(r(),c("div",Ct,[o("dt",null,n(a(s)("data-planes.components.service_traffic_card.requests")),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:p.requests})),1)])):C("",!0)])]),_:3})}}});const M=q(Tt,[["__scopeId","data-v-8fe56b2f"]]),It={class:"body"},Dt=R({__name:"ServiceTrafficGroup",props:{type:{}},setup(h){const s=h;return(p,I)=>{const u=k("KCard");return r(),f(u,{class:et(["service-traffic-group",`type-${s.type}`])},{default:e(()=>[o("div",It,[T(p.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}});const z=q(Dt,[["__scopeId","data-v-baf4abf7"]]),Kt=h=>(rt("data-v-e0064883"),h=h(),dt(),h),St={"data-testid":"dataplane-warnings"},qt=["data-testid","innerHTML"],Bt={class:"stack","data-testid":"dataplane-details"},Rt={class:"columns"},At={class:"status-with-reason"},Pt={class:"columns"},Vt=Kt(()=>o("span",null,"Outbounds",-1)),Et={class:"passthrough"},Mt={class:"outbounds"},zt={key:1,"data-testid":"dataplane-inbounds"},Nt={class:"inbound-list"},Lt={class:"mt-4 columns"},Ut={"data-testid":"dataplane-mtls"},Ot={class:"columns"},Gt=["innerHTML"],Ht={key:0,"data-testid":"dataplane-subscriptions"},Wt=R({__name:"DataPlaneDetailView",props:{data:{}},setup(h){const{t:s,formatIsoDate:p}=W(),I=at(),u=h,D=E(()=>it(u.data)),j=E(()=>{const w=ct(u.data);return w!==void 0?p(w):s("common.detail.none")}),N=E(()=>{const w=ut(u.data,I("use zones"));return _t(u.data)&&w.push({kind:"CERT_EXPIRED"}),w});return(w,Ft)=>{const J=k("KTooltip"),K=k("KCard"),X=k("DataSource"),L=k("KBadge"),Z=k("KAlert"),Q=k("AppView"),Y=k("RouteView");return r(),f(Y,{params:{mesh:"",dataPlane:""},name:"data-plane-detail-view"},{default:e(({route:U})=>[l(Q,null,st({default:e(()=>{var b,O;return[t(),o("div",Bt,[l(K,null,{default:e(()=>[o("div",Rt,[l(v,null,{title:e(()=>[t(n(a(s)("http.api.property.status")),1)]),body:e(()=>[o("div",At,[l(mt,{status:D.value.status},null,8,["status"]),t(),D.value.reason.length>0?(r(),f(J,{key:0,label:D.value.reason.join(", "),class:"reason-tooltip"},{default:e(()=>[l(a(ot),{color:a(tt),size:a(V),"hide-title":""},null,8,["color","size"])]),_:1},8,["label"])):C("",!0)])]),_:1}),t(),l(v,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.last_updated")),1)]),body:e(()=>[t(n(j.value),1)]),_:1}),t(),u.data.dataplane.networking.gateway?(r(),c(m,{key:0},[l(v,null,{title:e(()=>[t(n(a(s)("http.api.property.tags")),1)]),body:e(()=>[l(G,{tags:u.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:1}),t(),l(v,null,{title:e(()=>[t(n(a(s)("http.api.property.address")),1)]),body:e(()=>[l(B,{text:`${u.data.dataplane.networking.address}`},null,8,["text"])]),_:1})],64)):C("",!0)])]),_:1}),t(),a(I)("read traffic")&&typeof u.data.dataplane.networking.gateway>"u"?(r(),f(X,{key:0,src:`/meshes/${U.params.mesh}/dataplanes/${U.params.dataPlane}/traffic`},{default:e(({data:d,error:$})=>[$?(r(),f(pt,{key:0,error:$},null,8,["error"])):d===void 0?(r(),f(ft,{key:1})):(r(),f(K,{key:2,class:"traffic"},{default:e(()=>[o("div",Pt,[l(H,null,{title:e(()=>[l(a(nt),{display:"inline-block",decorative:"",size:a(V)},null,8,["size"]),t(`
                  Inbounds
                `)]),data:e(()=>[o("dl",null,[o("div",null,[o("dt",null,n(a(s)("services.components.service_traffic.inbound",{},{defaultMessage:"Requests"})),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),l(z,{type:"inbound"},{default:e(()=>[(r(!0),c(m,null,g(d.inbounds,_=>(r(),c(m,{key:`${_.name}`},[(r(!0),c(m,null,g([{protocol:typeof _.http<"u"?"http":"tcp",direction:"downstream"}],i=>{var x,y;return r(),f(M,{key:i.protocol,protocol:i.protocol,tx:(x=_[i.protocol])==null?void 0:x[`${i.direction}_cx_tx_bytes_total`],rx:(y=_[i.protocol])==null?void 0:y[`${i.direction}_cx_rx_bytes_total`],requests:i.protocol==="http"?["http1_total","http2_total","http3_total"].reduce((A,P)=>{var S;return A+(((S=_.http)==null?void 0:S[`${i.direction}_rq_${P}`])??0)},0):void 0},{default:e(()=>[t(n(_.name),1)]),_:2},1032,["protocol","tx","rx","requests"])}),128))],64))),128))]),_:2},1024)]),_:2},1024),t(),l(H,null,{title:e(()=>[l(a(lt),{display:"inline-block",decorative:"",size:a(V)},null,8,["size"]),t(),Vt]),data:e(()=>[o("dl",null,[o("div",null,[o("dt",Et,n(a(s)("services.components.service_traffic.passthrough",{},{defaultMessage:"Passthrough Requests"})),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:1e3})),1)]),t(),o("div",null,[o("dt",Mt,n(a(s)("services.components.service_traffic.mesh",{},{defaultMessage:"Mesh Requests"})),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),l(z,{type:"passthrough"},{default:e(()=>[(r(),c(m,null,g([{protocol:"cluster",direction:"downstream"}],_=>l(M,{key:_.protocol,protocol:"unknown",tx:d.passthrough.reduce((i,x)=>{var y;return i+(((y=x[_.protocol])==null?void 0:y[`${_.direction}_cx_tx_bytes_total`])??0)},0),rx:d.passthrough.reduce((i,x)=>{var y;return i+(((y=x[_.protocol])==null?void 0:y[`${_.direction}_cx_rx_bytes_total`])??0)},0)},{default:e(()=>[t(`
                      Non mesh traffic
                    `)]),_:2},1032,["tx","rx"])),64))]),_:2},1024),t(),l(z,{type:"outbound"},{default:e(()=>[(r(!0),c(m,null,g(d.outbounds,_=>(r(),c(m,{key:`${_.name}`},[(r(!0),c(m,null,g([{protocol:typeof _.http<"u"?"http":"tcp",direction:"downstream"}],i=>{var x,y;return r(),f(M,{key:i.protocol,protocol:i.protocol,tx:(x=_[i.protocol])==null?void 0:x[`${i.direction}_cx_tx_bytes_total`],rx:(y=_[i.protocol])==null?void 0:y[`${i.direction}_cx_rx_bytes_total`],requests:i.protocol==="http"?["http1_total","http2_total","http3_total"].reduce((A,P)=>{var S;return A+(((S=_.http)==null?void 0:S[`${i.direction}_rq_${P}`])??0)},0):void 0},{default:e(()=>[t(n(_.name),1)]),_:2},1032,["protocol","tx","rx","requests"])}),128))],64))),128))]),_:2},1024)]),_:2},1024)])]),_:2},1024))]),_:2},1032,["src"])):C("",!0),t(),u.data.dataplane.networking.inbound&&u.data.dataplane.networking.inbound.length>0?(r(),c("div",zt,[o("h2",null,n(a(s)("data-planes.routes.item.inbounds")),1),t(),l(K,{class:"mt-4"},{default:e(()=>[o("div",Nt,[(r(!0),c(m,null,g(u.data.dataplane.networking.inbound,(d,$)=>(r(),c("div",{key:$,class:"inbound"},[o("h4",null,[l(B,{text:d.tags["kuma.io/service"]},{default:e(()=>[t(n(a(s)("data-planes.routes.item.inbound_name",{service:d.tags["kuma.io/service"]})),1)]),_:2},1032,["text"])]),t(),o("div",Lt,[l(v,null,{title:e(()=>[t(n(a(s)("http.api.property.status")),1)]),body:e(()=>[!d.health||d.health.ready?(r(),f(L,{key:0,appearance:"success"},{default:e(()=>[t(n(a(s)("data-planes.routes.item.health.ready")),1)]),_:1})):(r(),f(L,{key:1,appearance:"danger"},{default:e(()=>[t(n(a(s)("data-planes.routes.item.health.not_ready")),1)]),_:1}))]),_:2},1024),t(),l(v,null,{title:e(()=>[t(n(a(s)("http.api.property.tags")),1)]),body:e(()=>[l(G,{tags:d.tags},null,8,["tags"])]),_:2},1024),t(),l(v,null,{title:e(()=>[t(n(a(s)("http.api.property.address")),1)]),body:e(()=>[l(B,{text:`${d.address??u.data.dataplane.networking.advertisedAddress??u.data.dataplane.networking.address}:${d.port}`},null,8,["text"])]),_:2},1024),t(),l(v,null,{title:e(()=>[t(n(a(s)("http.api.property.serviceAddress")),1)]),body:e(()=>[l(B,{text:`${d.serviceAddress??d.address??u.data.dataplane.networking.address}:${d.servicePort??d.port}`},null,8,["text"])]),_:2},1024)])]))),128))])]),_:1})])):C("",!0),t(),o("div",Ut,[o("h2",null,n(a(s)("data-planes.routes.item.mtls.title")),1),t(),(b=u.data.dataplaneInsight)!=null&&b.mTLS?(r(!0),c(m,{key:0},g([u.data.dataplaneInsight.mTLS],d=>(r(),f(K,{key:d,class:"mt-4"},{default:e(()=>[o("div",Ot,[l(v,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:e(()=>[t(n(a(p)(d.certificateExpirationTime)),1)]),_:2},1024),t(),l(v,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.generation_time.title")),1)]),body:e(()=>[t(n(a(p)(d.lastCertificateRegeneration)),1)]),_:2},1024),t(),l(v,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.regenerations.title")),1)]),body:e(()=>[t(n(a(s)("common.formats.integer",{value:d.certificateRegenerations})),1)]),_:2},1024),t(),l(v,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:e(()=>[t(n(d.issuedBackend),1)]),_:2},1024),t(),l(v,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:e(()=>[o("ul",null,[(r(!0),c(m,null,g(d.supportedBackends,$=>(r(),c("li",{key:$},n($),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(r(),f(Z,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:e(()=>[o("div",{innerHTML:a(s)("data-planes.routes.item.mtls.disabled")},null,8,Gt)]),_:1}))]),t(),(r(!0),c(m,null,g([((O=u.data.dataplaneInsight)==null?void 0:O.subscriptions)??[]],d=>(r(),c(m,{key:d},[d.length>0?(r(),c("div",Ht,[o("h2",null,n(a(s)("data-planes.routes.item.subscriptions.title")),1),t(),l(K,{class:"mt-4"},{default:e(()=>[l(ht,{subscriptions:d},null,8,["subscriptions"])]),_:2},1024)])):C("",!0)],64))),128))])]}),_:2},[N.value.length>0?{name:"notifications",fn:e(()=>[o("ul",St,[(r(!0),c(m,null,g(N.value,b=>(r(),c("li",{key:b.kind,"data-testid":`warning-${b.kind}`,innerHTML:a(s)(`common.warnings.${b.kind}`,b.payload)},null,8,qt))),128)),t()])]),key:"0"}:void 0]),1024)]),_:1})}}});const le=q(Wt,[["__scopeId","data-v-e0064883"]]);export{le as default};
