import{d as L,u as q,q as s,o as T,a as h,w as u,h as c,b as k,g as z,P as w,f as B}from"./index-0b8ed13f.js";import{S as F}from"./ServiceSummary-b58627f6.js";import{j as M,k as O,g as Q,_ as R}from"./RouteView.vue_vue_type_script_setup_true_lang-4999f19d.js";import{_ as U}from"./RouteTitle.vue_vue_type_script_setup_true_lang-65d5caa7.js";import{C as j}from"./ContentWrapper-9d52e143.js";import{D as G}from"./DataOverview-92c4fef1.js";import{Q as y}from"./QueryParameter-70743f73.js";import"./kongponents.es-a99534bb.js";import"./DefinitionListItem-a18dd4eb.js";import"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-a7645b28.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-e187911d.js";import"./TextWithCopyButton-45a80278.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-eb706f57.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-0272b2d5.js";import"./ErrorBlock-ddeaa4b4.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-bcba5a7a.js";import"./toYaml-4e00099e.js";import"./StatusBadge-bc14a264.js";import"./TagList-1ea0a113.js";const me=L({__name:"ServiceListView",props:{selectedServiceName:{type:String,required:!1,default:null},offset:{type:Number,required:!1,default:0}},setup(D){const m=D,p=M(),{t:N}=O(),P=[{label:"Name",key:"entity"},{label:"Type",key:"serviceType"},{label:"Address",key:"addressPort"},{label:"Status",key:"status"},{label:"DP proxies (online / total)",key:"dpProxiesStatus"}],A={title:"No Data",message:"There are no service insights present."},E=q(),v=s(!0),d=s(null),_=s(null),S=s(m.offset),t=s(null),o=s(null),n=s({headers:P,data:[]});b(m.offset);async function b(a){var i;S.value=a,y.set("offset",a>0?a:null),v.value=!0,d.value=null;const e=E.params.mesh,r=w;try{const{items:l,next:f}=await p.getAllServiceInsightsFromMesh({mesh:e},{size:r,offset:a});_.value=f,n.value.data=C(l??[]),await x({name:m.selectedServiceName??((i=n.value.data[0])==null?void 0:i.entity.name),mesh:e})}catch(l){n.value.data=[],t.value=null,o.value=null,l instanceof Error?d.value=l:console.error(l)}finally{v.value=!1}}function C(a){return a.map(e=>{const{serviceType:r="internal",addressPort:i="",status:l="not_available"}=e,f={name:"service-detail-view",params:{mesh:e.mesh,service:e.name}};let g="â€”";if(e.dataplanes){const{online:V=0,total:$=0}=e.dataplanes;g=`${V} / ${$}`}return{entity:e,detailViewRoute:f,status:l,serviceType:r,dpProxiesStatus:g,addressPort:i}})}async function x({name:a,mesh:e}){a!==void 0?(t.value=await p.getServiceInsight({mesh:e,name:a}),t.value.serviceType==="external"&&(o.value=await p.getExternalServiceByServiceInsightName(e,a)),y.set("service",a)):(t.value=null,o.value=null,y.set("service",null))}return(a,e)=>(T(),h(R,{module:"services"},{default:u(()=>[c(U,{title:k(N)("services.routes.items.title")},null,8,["title"]),z(),c(Q,null,{default:u(()=>[c(j,null,{content:u(()=>{var r;return[c(G,{"selected-entity-name":(r=t.value)==null?void 0:r.name,"page-size":k(w),error:d.value,"is-loading":v.value,"empty-state":A,"table-data":n.value,"table-data-is-empty":n.value.data.length===0,next:_.value,"page-offset":S.value,onTableAction:x,onLoadData:b},null,8,["selected-entity-name","page-size","error","is-loading","table-data","table-data-is-empty","next","page-offset"])]}),sidebar:u(()=>[t.value!==null?(T(),h(F,{key:0,service:t.value,"external-service":o.value},null,8,["service","external-service"])):B("",!0)]),_:1})]),_:1})]),_:1}))}});export{me as default};
