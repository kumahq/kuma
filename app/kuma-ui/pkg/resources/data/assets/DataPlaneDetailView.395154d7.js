import{d as E,o as e,c as b,w as o,i as a,n as D,cl as W,J,j as t,F as _,t as i,a as h,b as P,z as I,u as v,v as le,cK as oe,S as Z,cm as z,h as X,D as q,B as Q,C as ee,r as S,f as j,k as x,q as F,e as C,cA as ie,cz as H,cC as re,x as ce,cL as ue,A as de,O as pe,y as me,ck as he,cH as _e,cI as ye,cM as ve,cJ as fe,cv as ge,p as Pe}from"./index.3bc39668.js";import{_ as ae}from"./EmptyBlock.vue_vue_type_script_setup_true_lang.74b6b406.js";import{E as te}from"./ErrorBlock.f4ac98cc.js";import{_ as se}from"./LoadingBlock.vue_vue_type_script_setup_true_lang.13b03cfc.js";import{S as ke,E as V}from"./EnvoyData.e4795d9b.js";import{_ as Y}from"./LabelList.vue_vue_type_style_index_0_lang.0e14ac31.js";import{T as we}from"./TabsWidget.1751eed8.js";import{Y as De}from"./YamlView.24c9d3cb.js";import{a as be,S as $e}from"./SubscriptionHeader.3b12e257.js";import{W as Le}from"./WarningsWidget.216ea4e1.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.b3d38a49.js";import"./_commonjsHelpers.f037b798.js";import"./index.58caa11d.js";const Se={class:"dataplane-policy-header"},Oe={class:"dataplane-policy-subtitle"},Te={key:0,class:"badge-list"},Ce={class:"policy-wrapper"},Ie={class:"policy-type"},Me={key:0},Ne=E({__name:"SidecarDataplanePolicyList",props:{sidecarDataplanePolicies:{type:Array,required:!0}},setup(u){const r=u,O={inbound:"Policies applied on incoming connection on address",outbound:"Policies applied on outgoing connection to the address",service:"Policies applied on outgoing connections to service",dataplane:"Policies applied on all incoming and outgoing connections to the selected data plane proxy"};return(k,f)=>{const m=X("router-link");return e(),b(z,{"initially-open":[],"multiple-open":""},{default:o(()=>[(e(!0),a(_,null,D(r.sidecarDataplanePolicies,(n,d)=>(e(),b(W,{key:d},J({"accordion-header":o(()=>[t("div",Se,[t("div",null,[t("p",null,[n.type==="dataplane"?(e(),a(_,{key:0},[P(" Dataplane ")],64)):(e(),a(_,{key:1},[P(i(n.service),1)],64))]),t("p",Oe,[n.type==="inbound"||n.type==="outbound"?(e(),a(_,{key:0},[P(i(n.type)+" "+i(n.name),1)],64)):n.type==="service"||n.type==="dataplane"?(e(),a(_,{key:1},[P(i(n.type),1)],64)):I("",!0),h(v(oe),{width:"300",placement:"right",trigger:"hover"},{content:o(()=>[P(i(O[n.type]),1)]),default:o(()=>[h(v(le),{icon:"help",size:"16",class:"ml-1"})]),_:2},1024)])]),n.matchedPolicies.length>0?(e(),a("div",Te,[(e(!0),a(_,null,D(n.matchedPolicies,(g,y)=>(e(),b(v(Z),{key:`${d}-${y}`},{default:o(()=>[P(i(g.name),1)]),_:2},1024))),128))])):I("",!0)])]),_:2},[n.matchedPolicies.length>0?{name:"accordion-content",fn:o(()=>[t("div",Ce,[(e(!0),a(_,null,D(n.matchedPolicies,(g,y)=>(e(),a("div",{key:`${d}-${y}`},[t("p",Ie,i(g.pluralName),1),g.policies.length>0?(e(),a("ul",Me,[(e(!0),a(_,null,D(g.policies,(w,M)=>(e(),a("li",{key:`${d}-${y}-${M}`,"data-testid":"policy-name"},[h(m,{to:w.route},{default:o(()=>[P(i(w.name),1)]),_:2},1032,["to"])]))),128))])):I("",!0)]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:1})}}});const Ge=q(Ne,[["__scopeId","data-v-84de6b02"]]),N=u=>(Q("data-v-5d6a081d"),u=u(),ee(),u),Ae={class:"mesh-gateway-policy-list"},Ee=N(()=>t("h3",null,"Gateway policies",-1)),xe={key:0,class:"policy-list"},qe=N(()=>t("h3",{class:"mt-6"}," Listeners ",-1)),Be=N(()=>t("b",null,"Host",-1)),Re=N(()=>t("h4",{class:"mt-2"}," Routes ",-1)),Ve={class:"dataplane-policy-header"},je=N(()=>t("b",null,"Route",-1)),We=N(()=>t("b",null,"Service",-1)),ze={key:0,class:"badge-list"},Fe={class:"policy-list mt-1"},Ue=E({__name:"MeshGatewayDataplanePolicyList",props:{meshGatewayDataplane:{type:Object,required:!0},meshGatewayListenerEntries:{type:Array,required:!0},meshGatewayRoutePolicies:{type:Array,required:!0}},setup(u){const r=u;return(O,k)=>{const f=X("router-link");return e(),a("div",Ae,[Ee,u.meshGatewayRoutePolicies.length>0?(e(),a("ul",xe,[(e(!0),a(_,null,D(u.meshGatewayRoutePolicies,(m,n)=>(e(),a("li",{key:n},[t("span",null,i(m.type),1),P(": "),h(f,{to:m.route},{default:o(()=>[P(i(m.name),1)]),_:2},1032,["to"])]))),128))])):I("",!0),qe,t("div",null,[(e(!0),a(_,null,D(r.meshGatewayListenerEntries,(m,n)=>(e(),a("div",{key:n},[t("div",null,[t("div",null,[Be,P(": "+i(m.hostName)+":"+i(m.port)+" ("+i(m.protocol)+") ",1)]),m.routeEntries.length>0?(e(),a(_,{key:0},[Re,h(z,{"initially-open":[],"multiple-open":""},{default:o(()=>[(e(!0),a(_,null,D(m.routeEntries,(d,g)=>(e(),b(W,{key:g},J({"accordion-header":o(()=>[t("div",Ve,[t("div",null,[t("div",null,[je,P(": "),h(f,{to:d.route},{default:o(()=>[P(i(d.routeName),1)]),_:2},1032,["to"])]),t("div",null,[We,P(": "+i(d.service),1)])]),d.policies.length>0?(e(),a("div",ze,[(e(!0),a(_,null,D(d.policies,(y,w)=>(e(),b(v(Z),{key:`${n}-${w}`},{default:o(()=>[P(i(y.type),1)]),_:2},1024))),128))])):I("",!0)])]),_:2},[d.policies.length>0?{name:"accordion-content",fn:o(()=>[t("ul",Fe,[(e(!0),a(_,null,D(d.policies,(y,w)=>(e(),a("li",{key:`${n}-${w}`},[P(i(y.type)+": ",1),h(f,{to:y.route},{default:o(()=>[P(i(y.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):I("",!0)])]))),128))])])}}});const Ke=q(Ue,[["__scopeId","data-v-5d6a081d"]]),He={key:2,class:"policies-list"},Ye={key:3,class:"policies-list"},Je=E({__name:"DataplanePolicies",props:{dataPlane:{type:Object,required:!0}},setup(u){const r=u,O=F(),k=S(null),f=S([]),m=S([]),n=S([]),d=S(!0),g=S(null);j(()=>r.dataPlane.name,function(){y()}),y();async function y(){var $,c;g.value=null,d.value=!0,f.value=[],m.value=[],n.value=[];try{if(((c=($=r.dataPlane.networking.gateway)==null?void 0:$.type)==null?void 0:c.toUpperCase())==="BUILTIN")k.value=await x.getMeshGatewayDataplane({mesh:r.dataPlane.mesh,name:r.dataPlane.name}),m.value=w(k.value),n.value=M(k.value.policies);else{const{items:s}=await x.getSidecarDataplanePolicies({mesh:r.dataPlane.mesh,name:r.dataPlane.name});f.value=B(s)}}catch(l){l instanceof Error?g.value=l:console.error(l)}finally{d.value=!1}}function w($){const c=[];for(const l of $.listeners)for(const s of l.hosts)for(const p of s.routes){const T=[];for(const L of p.destinations){const G=M(L.policies),A={routeName:p.route,route:{name:"meshgatewayroutes",params:{mesh:$.gateway.mesh},query:{ns:p.route}},service:L.tags["kuma.io/service"],policies:G};T.push(A)}c.push({protocol:l.protocol,port:l.port,hostName:s.hostName,routeEntries:T})}return c}function M($){if($===void 0)return[];const c=[];for(const l of Object.values($)){const s=O.state.policiesByType[l.type];c.push({type:l.type,name:l.name,route:{name:s.path,params:{mesh:l.mesh},query:{ns:l.name}}})}return c}function B($){const c=[];for(const l of $){const s=[];for(const[G,A]of Object.entries(l.matchedPolicies)){const U=O.state.policiesByType[G],K=[];for(const R of A)K.push({name:R.name,route:{name:U.path,query:{ns:R.name},params:{mesh:R.mesh}}});s.push({name:G,pluralName:U.pluralDisplayName,policies:K})}const{name:p,type:T,service:L}=l;c.push({name:p,type:T,service:L,matchedPolicies:s})}return c}return($,c)=>d.value?(e(),b(se,{key:0})):g.value!==null?(e(),b(te,{key:1,error:g.value},null,8,["error"])):f.value.length>0?(e(),a("div",He,[h(Ge,{"sidecar-dataplane-policies":f.value},null,8,["sidecar-dataplane-policies"])])):m.value.length>0&&k.value!==null?(e(),a("div",Ye,[h(Ke,{"mesh-gateway-dataplane":k.value,"mesh-gateway-listener-entries":m.value,"mesh-gateway-route-policies":n.value},null,8,["mesh-gateway-dataplane","mesh-gateway-listener-entries","mesh-gateway-route-policies"])])):(e(),b(ae,{key:4}))}});const Ze=q(Je,[["__scopeId","data-v-34268377"]]),ne=u=>(Q("data-v-c0cede09"),u=u(),ee(),u),Xe={key:0},Qe={key:1},ea=ne(()=>t("h4",null,"Tags",-1)),aa=ne(()=>t("h4",null,"Versions",-1)),ta={class:"config-wrapper"},sa={key:0},na=["href"],la=E({__name:"DataPlaneDetails",props:{dataPlane:{type:Object,required:!0},dataPlaneOverview:{type:Object,required:!0}},setup(u){const r=u,O=F(),k=[{hash:"#overview",title:"Overview"},{hash:"#insights",title:"DPP Insights"},{hash:"#dpp-policies",title:"Policies"},{hash:"#xds-configuration",title:"XDS Configuration"},{hash:"#envoy-stats",title:"Stats"},{hash:"#envoy-clusters",title:"Clusters"},{hash:"#mtls",title:"Certificate Insights"},{hash:"#warnings",title:"Warnings"}],f=S([]),m=C(()=>{const{type:c,name:l,mesh:s}=r.dataPlane,p=ie(r.dataPlane,r.dataPlaneOverview.dataplaneInsight);return{type:c,name:l,mesh:s,status:p}}),n=C(()=>H(r.dataPlane)),d=C(()=>re(r.dataPlaneOverview.dataplaneInsight)),g=C(()=>ce(r.dataPlane)),y=C(()=>ue(r.dataPlaneOverview)),w=C(()=>{var l,s;const c=Array.from((s=(l=r.dataPlaneOverview.dataplaneInsight)==null?void 0:l.subscriptions)!=null?s:[]);return c.reverse(),c}),M=C(()=>{const c=O.getters["config/getKumaDocsVersion"];return c!==null?c:"latest"}),B=C(()=>f.value.length===0?k.filter(c=>c.hash!=="#warnings"):k);function $(){var p,T;const c=(T=(p=r.dataPlaneOverview.dataplaneInsight)==null?void 0:p.subscriptions)!=null?T:[];if(c.length===0||!("version"in c[0]))return;const l=c[0].version;if(l&&l.kumaDp&&l.envoy){const L=_e(l);L.kind!==ye&&L.kind!==ve&&f.value.push(L)}O.getters["config/getMulticlusterStatus"]&&l&&H(r.dataPlane).find(A=>A.label===fe)&&typeof l.kumaDp.kumaCpCompatible=="boolean"&&!l.kumaDp.kumaCpCompatible&&f.value.push({kind:ge,payload:{kumaDp:l.kumaDp.version}})}return $(),(c,l)=>(e(),b(we,{tabs:v(B),"initial-tab-override":"overview"},{tabHeader:o(()=>[t("div",null,[t("h3",null," DPP: "+i(u.dataPlane.name),1)])]),overview:o(()=>[h(Y,null,{default:o(()=>[t("div",null,[t("ul",null,[(e(!0),a(_,null,D(v(m),(s,p)=>(e(),a("li",{key:p},[t("h4",null,i(p),1),p==="status"&&typeof s!="string"?(e(),a("div",Xe,[t("div",{class:de(["entity-status",{"is-offline":s.status.toLowerCase()==="offline","is-online":s.status.toLowerCase()==="online","is-degraded":s.status.toLowerCase()==="partially degraded","is-not-available":s.status.toLowerCase()==="not available"}])},[t("span",null,i(s.status),1)],2),(e(!0),a(_,null,D(s.reason,(T,L)=>(e(),a("div",{key:L,class:"reason"},i(T),1))),128))])):(e(),a("div",Qe,i(s),1))]))),128))])]),t("div",null,[v(n).length>0?(e(),a(_,{key:0},[ea,t("p",null,[(e(!0),a(_,null,D(v(n),(s,p)=>(e(),a("span",{key:p,class:"tag-cols"},[t("span",null,i(s.label)+": ",1),t("span",null,i(s.value),1)]))),128))])],64)):I("",!0),v(d)?(e(),a(_,{key:1},[aa,t("p",null,[(e(!0),a(_,null,D(v(d),(s,p)=>(e(),a("span",{key:p,class:"tag-cols"},[t("span",null,i(p)+": ",1),t("span",null,i(s),1)]))),128))])],64)):I("",!0)])]),_:1}),t("div",ta,[h(De,{id:"code-block-data-plane",content:v(g),"is-searchable":""},null,8,["content"])])]),insights:o(()=>[h(ke,{"is-empty":v(w).length===0},{default:o(()=>[h(v(pe),{"border-variant":"noBorder"},{body:o(()=>[h(z,{"initially-open":0},{default:o(()=>[(e(!0),a(_,null,D(v(w),(s,p)=>(e(),b(W,{key:p},{"accordion-header":o(()=>[h(be,{details:s},null,8,["details"])]),"accordion-content":o(()=>[h($e,{details:s,"is-discovery-subscription":""},null,8,["details"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["is-empty"])]),"dpp-policies":o(()=>[h(Ze,{"data-plane":u.dataPlane},null,8,["data-plane"])]),"xds-configuration":o(()=>[h(V,{"data-path":"xds",mesh:u.dataPlane.mesh,"dpp-name":u.dataPlane.name,"query-key":"envoy-data-data-plane"},null,8,["mesh","dpp-name"])]),"envoy-stats":o(()=>[h(V,{"data-path":"stats",mesh:u.dataPlane.mesh,"dpp-name":u.dataPlane.name,"query-key":"envoy-data-data-plane"},null,8,["mesh","dpp-name"])]),"envoy-clusters":o(()=>[h(V,{"data-path":"clusters",mesh:u.dataPlane.mesh,"dpp-name":u.dataPlane.name,"query-key":"envoy-data-data-plane"},null,8,["mesh","dpp-name"])]),mtls:o(()=>[h(Y,null,{default:o(()=>[v(y)!==null?(e(),a("ul",sa,[(e(!0),a(_,null,D(v(y),(s,p)=>(e(),a("li",{key:p},[t("h4",null,i(s.label),1),t("p",null,i(s.value),1)]))),128))])):(e(),b(v(me),{key:1,appearance:"danger"},{alertMessage:o(()=>[P(" This data plane proxy does not yet have mTLS configured \u2014 "),t("a",{href:`https://kuma.io/docs/${v(M)}/policies/mutual-tls/`,class:"external-link",target:"_blank"}," Learn About Certificates in "+i(v(he)),9,na)]),_:1}))]),_:1})]),warnings:o(()=>[h(Le,{warnings:f.value},null,8,["warnings"])]),_:1},8,["tabs"]))}});const oa=q(la,[["__scopeId","data-v-c0cede09"]]),ia={class:"component-frame"},ka=E({__name:"DataPlaneDetailView",setup(u){const r=Pe(),O=F(),k=S(null),f=S(null),m=S(!0),n=S(null);async function d(){n.value=null,m.value=!0;const g=r.params.mesh,y=r.params.dataPlane;try{k.value=await x.getDataplaneFromMesh({mesh:g,name:y}),f.value=await x.getDataplaneOverviewFromMesh({mesh:g,name:y})}catch(w){k.value=null,w instanceof Error?n.value=w:console.error(w)}finally{m.value=!1}}return j(()=>r.params.mesh,function(){r.name==="data-plane-detail-view"&&d()}),j(()=>r.params.dataPlane,function(){r.name==="data-plane-detail-view"&&d()}),d(),O.dispatch("updatePageTitle",r.params.dataPlane),(g,y)=>(e(),a("div",ia,[m.value?(e(),b(se,{key:0})):n.value!==null?(e(),b(te,{key:1,error:n.value},null,8,["error"])):k.value===null||f.value===null?(e(),b(ae,{key:2})):(e(),b(oa,{key:3,"data-plane":k.value,"data-plane-overview":f.value},null,8,["data-plane","data-plane-overview"]))]))}});export{ka as default};
