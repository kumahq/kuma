import{d as N,i as S,j as _,n as A,o as s,c as u,a as d,u as n,G as C,e as o,H as K,l as G,m as H,r as b,J,K as $,L as q,w as v,M as x,k as w,g as i,F as D,z as B,y as h,_ as L,x as V}from"./index-e4d45609.js";import{_ as Q}from"./LabelList.vue_vue_type_style_index_0_lang-27780089.js";import{M as U}from"./MeshResources-4d6b187a.js";import{_ as W}from"./YamlView.vue_vue_type_script_setup_true_lang-9917b2d3.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-e127f388.js";import"./ErrorBlock-e4240a41.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-01d7e33d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-dc80c0c7.js";import"./toYaml-4e00099e.js";const X={class:"chart-box-list"},Y=N({__name:"MeshCharts",setup(O){const r=S(),y=_(()=>r.getters.getChart("services",{title:"Services",showTotal:!0})),g=_(()=>r.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),f=_(()=>r.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),k=_(()=>r.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));A(()=>r.state.selectedMesh,function(){p()}),p();function p(){r.dispatch("fetchMeshInsights",r.state.selectedMesh),r.dispatch("fetchServices",r.state.selectedMesh)}return(l,P)=>(s(),u("div",X,[d(C,{data:n(y)},null,8,["data"]),o(),d(C,{data:n(g)},null,8,["data"]),o(),d(C,{data:n(f)},null,8,["data"]),o(),d(C,{data:n(k)},null,8,["data"])]))}});const Z=K(Y,[["__scopeId","data-v-7d682009"]]),ee={class:"kcard-stack"},te={key:1},ae={key:1},se={class:"policy-counts"},ne={key:0},oe=N({__name:"MeshOverviewView",setup(O){const r=G(),y=H(),g=S(),f=b(!0),k=b(!1),p=b(!1),l=b(null),P=b(null),I=_(()=>l.value!==null?J(l.value):null),R=_(()=>{if(l.value===null)return null;const{name:t,type:a,creationTime:m,modificationTime:e}=l.value;return{name:t,type:a,created:$(m),modified:$(e),"Data Plane Proxies":g.state.meshInsight.dataplanes.total}}),F=_(()=>{var T;if(l.value===null)return null;const t=M(l.value,"mtls"),a=M(l.value,"logging"),m=M(l.value,"metrics"),e=M(l.value,"tracing"),c=!!((T=l.value.routing)!=null&&T.localityAwareLoadBalancing);return{mtls:t,logging:a,metrics:m,tracing:e,localityAwareLoadBalancing:c}}),j=_(()=>g.state.sidebar.insights.mesh.policies.total),z=_(()=>g.state.policyTypes.map(t=>{var a;return{...t,length:((a=g.state.meshInsight.policies[t.name])==null?void 0:a.total)??0}}));A(()=>y.params.mesh,function(){y.name==="single-mesh-overview"&&(f.value=!0,p.value=!1,k.value=!1,E())}),E();async function E(){f.value=!0,p.value=!1;const t=y.params.mesh;try{l.value=await r.getMesh({name:t}),P.value=await r.getMeshInsights({name:t})}catch(a){k.value=!0,p.value=!0,console.error(a)}finally{f.value=!1}}function M(t,a){if(t===null||t[a]===void 0)return!1;const m=t[a].enabledBackend??t[a].defaultBackend??t[a].backends[0].name,e=t[a].backends.find(c=>c.name===m);return`${e.type} / ${e.name}`}return(t,a)=>{const m=q("router-link");return s(),u("div",ee,[d(n(x),null,{body:v(()=>[d(Z)]),_:1}),o(),l.value!==null?(s(),w(n(x),{key:0},{body:v(()=>[d(Q,{"has-error":k.value,"is-loading":f.value,"is-empty":p.value},{default:v(()=>[i("div",null,[i("ul",null,[(s(!0),u(D,null,B(n(R),(e,c)=>(s(),u("li",{key:c},[i("h4",null,h(c),1),o(),typeof e=="boolean"?(s(),w(n(L),{key:0,appearance:e?"success":"danger"},{default:v(()=>[o(h(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),u("p",te,h(e),1))]))),128))])]),o(),i("div",null,[i("ul",null,[(s(!0),u(D,null,B(n(F),(e,c)=>(s(),u("li",{key:c},[i("h4",null,h(c),1),o(),typeof e=="boolean"?(s(),w(n(L),{key:0,appearance:e?"success":"danger"},{default:v(()=>[o(h(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),u("p",ae,h(e),1))]))),128))])]),o(),i("div",null,[i("ul",se,[i("li",null,[i("h4",null,`
                  Policies (`+h(n(j))+`)
                `,1),o(),i("ul",null,[(s(!0),u(D,null,B(n(z),(e,c)=>(s(),u(D,{key:c},[e.length!==0?(s(),u("li",ne,[d(m,{to:{name:"policy",params:{policyPath:e.path}}},{default:v(()=>[o(h(e.name)+": "+h(e.length),1)]),_:2},1032,["to"])])):V("",!0)],64))),128))])])])])]),_:1},8,["has-error","is-loading","is-empty"])]),_:1})):V("",!0),o(),n(I)!==null?(s(),w(n(x),{key:1},{body:v(()=>[d(W,{id:"code-block-mesh",content:n(I)},null,8,["content"])]),_:1})):V("",!0),o(),d(U)])}}});const me=K(oe,[["__scopeId","data-v-bd3f5416"]]);export{me as default};
