import{a as X,K as R}from"./index-fce48c05.js";import{_ as D,a as g,o as d,b as f,w as e,p as o,r as w,f as t,d as q,c as u,e as l,l as U,t as n,q as a,s as $,n as Z,M as J,a0 as Q,a1 as y,a2 as Y,F as m,a3 as tt,I as b,a4 as et,y as at,z as st}from"./index-c5d86139.js";import{E as ot}from"./ErrorBlock-6429551f.js";import{_ as nt}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-eb658848.js";import{S as lt}from"./StatusBadge-43da8333.js";import{T as z}from"./TagList-e45d344d.js";import{T as K}from"./TextWithCopyButton-7ae5a11a.js";import{_ as dt}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-641c2d3a.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-5489e4aa.js";import"./CopyButton-61864c1e.js";import"./AccordionList-5e44cc97.js";const rt={},it={class:"card"},ct={class:"title"},ut={class:"body"};function _t(h,s){const p=g("KCard");return d(),f(p,{class:"data-card"},{default:e(()=>[o("dl",null,[o("div",it,[o("dt",ct,[w(h.$slots,"title",{},void 0,!0)]),t(),o("dd",ut,[w(h.$slots,"default",{},void 0,!0)])])])]),_:3})}const L=D(rt,[["render",_t],["__scopeId","data-v-65e18720"]]),pt={class:"service-traffic"},ft=q({__name:"DataPlaneTraffic",setup(h){return(s,p)=>(d(),u("div",pt,[l(L,{class:"header"},{title:e(()=>[w(s.$slots,"title",{},void 0,!0)]),_:3}),t(),w(s.$slots,"default",{},void 0,!0)]))}});const N=D(ft,[["__scopeId","data-v-8e8bcc45"]]),mt={class:"title"},ht={key:0},yt=q({__name:"ServiceTrafficCard",props:{protocol:{},requests:{default:void 0},rx:{default:0},tx:{default:0}},setup(h){const{t:s}=U(),p=h;return(i,C)=>{const V=g("KBadge");return d(),f(L,{class:"service-traffic-card"},{title:e(()=>[l(V,{appearance:p.protocol==="unknown"?"success":"info"},{default:e(()=>[t(n(a(s)(`data-planes.components.service_traffic_card.protocol.${p.protocol}`,{},{defaultMessage:a(s)(`http.api.value.${p.protocol}`)})),1)]),_:1},8,["appearance"]),t(),o("span",mt,[w(i.$slots,"default",{},void 0,!0)])]),default:e(()=>[t(),o("dl",null,[o("div",null,[o("dt",null,n(a(s)("data-planes.components.service_traffic_card.tx")),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:p.tx})),1)]),t(),o("div",null,[o("dt",null,n(a(s)("data-planes.components.service_traffic_card.rx")),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:p.rx})),1)]),t(),typeof p.requests<"u"?(d(),u("div",ht,[o("dt",null,n(a(s)("data-planes.components.service_traffic_card.requests")),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:p.requests})),1)])):$("",!0)])]),_:3})}}});const M=D(yt,[["__scopeId","data-v-19bc134f"]]),vt={class:"body"},gt=q({__name:"ServiceTrafficGroup",props:{type:{}},setup(h){const s=h;return(p,i)=>{const C=g("KCard");return d(),f(C,{class:Z(["service-traffic-group",`type-${s.type}`])},{default:e(()=>[o("div",vt,[w(p.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}});const P=D(gt,[["__scopeId","data-v-baf4abf7"]]),kt=h=>(at("data-v-16ff59dd"),h=h(),st(),h),bt={"data-testid":"dataplane-warnings"},xt=["data-testid","innerHTML"],$t={class:"stack","data-testid":"dataplane-details"},wt={class:"columns"},Ct={class:"status-with-reason"},It={class:"columns"},Tt=kt(()=>o("span",null,"Outbounds",-1)),Dt={class:"passthrough"},Kt={class:"outbounds"},qt={key:1,"data-testid":"dataplane-inbounds"},Bt={class:"inbound-list"},St={class:"mt-4 columns"},Rt={"data-testid":"dataplane-mtls"},Mt={class:"columns"},Pt=["innerHTML"],Vt={key:2,"data-testid":"dataplane-subscriptions"},Et=q({__name:"DataPlaneDetailView",props:{data:{}},setup(h){const{t:s,formatIsoDate:p}=U(),i=h,C=J(()=>i.data.warnings.concat(...i.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(V,At)=>{const O=g("KTooltip"),I=g("KCard"),G=g("DataSource"),E=g("KBadge"),H=g("KAlert"),F=g("AppView"),j=g("RouteView");return d(),f(j,{params:{mesh:"",dataPlane:""},name:"data-plane-detail-view"},{default:e(({can:W,route:A})=>[l(F,null,Q({default:e(()=>[t(),o("div",$t,[l(I,null,{default:e(()=>[o("div",wt,[l(y,null,{title:e(()=>[t(n(a(s)("http.api.property.status")),1)]),body:e(()=>[o("div",Ct,[l(lt,{status:i.data.status},null,8,["status"]),t(),i.data.unhealthyInbounds.length>0?(d(),f(O,{key:0,label:i.data.unhealthyInbounds.map(r=>a(s)("data-planes.routes.item.unhealthy_inbound",r)).join(", "),class:"reason-tooltip"},{default:e(()=>[l(a(Y),{color:a(X),size:a(R),"hide-title":""},null,8,["color","size"])]),_:1},8,["label"])):$("",!0)])]),_:1}),t(),l(y,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.last_updated")),1)]),body:e(()=>[i.data.lastUpdateTime?(d(),u(m,{key:0},[t(n(a(p)(i.data.lastUpdateTime)),1)],64)):(d(),u(m,{key:1},[t(n(a(s)("common.detail.none")),1)],64))]),_:1}),t(),i.data.dataplane.networking.gateway?(d(),u(m,{key:0},[l(y,null,{title:e(()=>[t(n(a(s)("http.api.property.tags")),1)]),body:e(()=>[l(z,{tags:i.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:1}),t(),l(y,null,{title:e(()=>[t(n(a(s)("http.api.property.address")),1)]),body:e(()=>[l(K,{text:`${i.data.dataplane.networking.address}`},null,8,["text"])]),_:1})],64)):$("",!0)])]),_:1}),t(),W("read traffic")&&i.data.dataplaneType==="standard"?(d(),f(G,{key:0,src:`/meshes/${A.params.mesh}/dataplanes/${A.params.dataPlane}/traffic`},{default:e(({data:r,error:x})=>[x?(d(),f(ot,{key:0,error:x},null,8,["error"])):r===void 0?(d(),f(nt,{key:1})):(d(),f(I,{key:2,class:"traffic"},{default:e(()=>[o("div",It,[l(N,null,{title:e(()=>[l(a(tt),{display:"inline-block",decorative:"",size:a(R)},null,8,["size"]),t(`
                  Inbounds
                `)]),data:e(()=>[o("dl",null,[o("div",null,[o("dt",null,n(a(s)("services.components.service_traffic.inbound",{},{defaultMessage:"Requests"})),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),l(P,{type:"inbound"},{default:e(()=>[(d(!0),u(m,null,b(r.inbounds,_=>(d(),u(m,{key:`${_.name}`},[(d(!0),u(m,null,b([{protocol:typeof _.http<"u"?"http":"tcp",direction:"downstream"}],c=>{var k,v;return d(),f(M,{key:c.protocol,protocol:c.protocol,tx:(k=_[c.protocol])==null?void 0:k[`${c.direction}_cx_tx_bytes_total`],rx:(v=_[c.protocol])==null?void 0:v[`${c.direction}_cx_rx_bytes_total`],requests:c.protocol==="http"?["http1_total","http2_total","http3_total"].reduce((B,S)=>{var T;return B+(((T=_.http)==null?void 0:T[`${c.direction}_rq_${S}`])??0)},0):void 0},{default:e(()=>[t(n(_.name),1)]),_:2},1032,["protocol","tx","rx","requests"])}),128))],64))),128))]),_:2},1024)]),_:2},1024),t(),l(N,null,{title:e(()=>[l(a(et),{display:"inline-block",decorative:"",size:a(R)},null,8,["size"]),t(),Tt]),data:e(()=>[o("dl",null,[o("div",null,[o("dt",Dt,n(a(s)("services.components.service_traffic.passthrough",{},{defaultMessage:"Passthrough Requests"})),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:1e3})),1)]),t(),o("div",null,[o("dt",Kt,n(a(s)("services.components.service_traffic.mesh",{},{defaultMessage:"Mesh Requests"})),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),l(P,{type:"passthrough"},{default:e(()=>[(d(),u(m,null,b([{protocol:"cluster",direction:"downstream"}],_=>l(M,{key:_.protocol,protocol:"unknown",tx:r.passthrough.reduce((c,k)=>{var v;return c+(((v=k[_.protocol])==null?void 0:v[`${_.direction}_cx_tx_bytes_total`])??0)},0),rx:r.passthrough.reduce((c,k)=>{var v;return c+(((v=k[_.protocol])==null?void 0:v[`${_.direction}_cx_rx_bytes_total`])??0)},0)},{default:e(()=>[t(`
                      Non mesh traffic
                    `)]),_:2},1032,["tx","rx"])),64))]),_:2},1024),t(),l(P,{type:"outbound"},{default:e(()=>[(d(!0),u(m,null,b(r.outbounds,_=>(d(),u(m,{key:`${_.name}`},[(d(!0),u(m,null,b([{protocol:typeof _.http<"u"?"http":"tcp",direction:"downstream"}],c=>{var k,v;return d(),f(M,{key:c.protocol,protocol:c.protocol,tx:(k=_[c.protocol])==null?void 0:k[`${c.direction}_cx_tx_bytes_total`],rx:(v=_[c.protocol])==null?void 0:v[`${c.direction}_cx_rx_bytes_total`],requests:c.protocol==="http"?["http1_total","http2_total","http3_total"].reduce((B,S)=>{var T;return B+(((T=_.http)==null?void 0:T[`${c.direction}_rq_${S}`])??0)},0):void 0},{default:e(()=>[t(n(_.name),1)]),_:2},1032,["protocol","tx","rx","requests"])}),128))],64))),128))]),_:2},1024)]),_:2},1024)])]),_:2},1024))]),_:2},1032,["src"])):$("",!0),t(),i.data.dataplane.networking.inbound&&i.data.dataplane.networking.inbound.length>0?(d(),u("div",qt,[o("h2",null,n(a(s)("data-planes.routes.item.inbounds")),1),t(),l(I,{class:"mt-4"},{default:e(()=>[o("div",Bt,[(d(!0),u(m,null,b(i.data.dataplane.networking.inbound,(r,x)=>(d(),u("div",{key:x,class:"inbound"},[o("h4",null,[l(K,{text:r.tags["kuma.io/service"]},{default:e(()=>[t(n(a(s)("data-planes.routes.item.inbound_name",{service:r.tags["kuma.io/service"]})),1)]),_:2},1032,["text"])]),t(),o("div",St,[l(y,null,{title:e(()=>[t(n(a(s)("http.api.property.status")),1)]),body:e(()=>[!r.health||r.health.ready?(d(),f(E,{key:0,appearance:"success"},{default:e(()=>[t(n(a(s)("data-planes.routes.item.health.ready")),1)]),_:1})):(d(),f(E,{key:1,appearance:"danger"},{default:e(()=>[t(n(a(s)("data-planes.routes.item.health.not_ready")),1)]),_:1}))]),_:2},1024),t(),l(y,null,{title:e(()=>[t(n(a(s)("http.api.property.tags")),1)]),body:e(()=>[l(z,{tags:r.tags},null,8,["tags"])]),_:2},1024),t(),l(y,null,{title:e(()=>[t(n(a(s)("http.api.property.address")),1)]),body:e(()=>[l(K,{text:`${r.address??i.data.dataplane.networking.advertisedAddress??i.data.dataplane.networking.address}:${r.port}`},null,8,["text"])]),_:2},1024),t(),l(y,null,{title:e(()=>[t(n(a(s)("http.api.property.serviceAddress")),1)]),body:e(()=>[l(K,{text:`${r.serviceAddress??r.address??i.data.dataplane.networking.address}:${r.servicePort??r.port}`},null,8,["text"])]),_:2},1024)])]))),128))])]),_:1})])):$("",!0),t(),o("div",Rt,[o("h2",null,n(a(s)("data-planes.routes.item.mtls.title")),1),t(),i.data.dataplaneInsight.mTLS?(d(!0),u(m,{key:0},b([i.data.dataplaneInsight.mTLS],r=>(d(),f(I,{key:r,class:"mt-4"},{default:e(()=>[o("div",Mt,[l(y,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:e(()=>[t(n(a(p)(r.certificateExpirationTime)),1)]),_:2},1024),t(),l(y,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.generation_time.title")),1)]),body:e(()=>[t(n(a(p)(r.lastCertificateRegeneration)),1)]),_:2},1024),t(),l(y,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.regenerations.title")),1)]),body:e(()=>[t(n(a(s)("common.formats.integer",{value:r.certificateRegenerations})),1)]),_:2},1024),t(),l(y,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:e(()=>[t(n(r.issuedBackend),1)]),_:2},1024),t(),l(y,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:e(()=>[o("ul",null,[(d(!0),u(m,null,b(r.supportedBackends,x=>(d(),u("li",{key:x},n(x),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(d(),f(H,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:e(()=>[o("div",{innerHTML:a(s)("data-planes.routes.item.mtls.disabled")},null,8,Pt)]),_:1}))]),t(),i.data.dataplaneInsight.subscriptions.length>0?(d(),u("div",Vt,[o("h2",null,n(a(s)("data-planes.routes.item.subscriptions.title")),1),t(),l(I,{class:"mt-4"},{default:e(()=>[l(dt,{subscriptions:i.data.dataplaneInsight.subscriptions},null,8,["subscriptions"])]),_:1})])):$("",!0)])]),_:2},[C.value.length>0?{name:"notifications",fn:e(()=>[o("ul",bt,[(d(!0),u(m,null,b(C.value,r=>(d(),u("li",{key:r.kind,"data-testid":`warning-${r.kind}`,innerHTML:a(s)(`common.warnings.${r.kind}`,r.payload)},null,8,xt))),128)),t()])]),key:"0"}:void 0]),1024)]),_:1})}}});const Zt=D(Et,[["__scopeId","data-v-16ff59dd"]]);export{Zt as default};
