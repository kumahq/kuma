import{c as H,E as Y,Z as J,z as X,f as ee}from"./kongponents.es-414449e8.js";import{d as q,o as c,b as g,w as a,g as m,e as d,h as p,a as te,u as ae,r as _,c as x,v as se,V as le,G as oe,x as ie,j as A,i as y,f as w,y as R,t as D,N as z,F as U,q as ne,p as re,m as ce}from"./index-7c362181.js";import{_ as pe}from"./PolicyConnections.vue_vue_type_script_setup_true_lang-10668c77.js";import{D as ue}from"./DataOverview-ec1adda3.js";import{T as $,a as me,D as de}from"./TextWithCopyButton-28c506a3.js";import{T as ye}from"./TabsWidget-72787dfe.js";import{_ as he}from"./YamlView.vue_vue_type_script_setup_true_lang-50a2869f.js";import{u as ve}from"./store-72ab29d4.js";import{u as fe,a as _e}from"./index-efbce9eb.js";import{Q as L}from"./QueryParameter-70743f73.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-6ef0b459.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-6507ce20.js";import"./ErrorBlock-41d3ccd4.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-b7beddaa.js";import"./datadogLogEvents-302eea7b.js";import"./TagList-4b66449c.js";import"./StatusBadge-48ca88d8.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-c645bc0d.js";import"./toYaml-4e00099e.js";const be=q({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(h){const n=h;return(S,E)=>(c(),g(d(Y),{class:"docs-link",appearance:"outline",target:"_blank",to:n.href},{default:a(()=>[m(d(H),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),p(`

    Documentation
  `)]),_:1},8,["to"]))}}),Pe=h=>(re("data-v-aec69631"),h=h(),ce(),h),ke={class:"kcard-stack"},we={class:"kcard-border"},Te=Pe(()=>y("p",null,[y("strong",null,"Warning"),p(` This policy is experimental. If you encountered any problem please open an
                  `),y("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),xe={class:"kcard-border"},De={class:"entity-heading","data-testid":"policy-single-entity"},Se=q({__name:"PolicyListView",props:{selectedPolicyName:{type:[String,null],required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(h){const n=h,S=fe(),E=_e(),M=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],F=te(),b=ae(),u=ve(),T=_(!0),P=_(null),s=_(null),v=_(null),V=_(null),B=_(n.offset),k=_({headers:[{label:"Name",key:"entity"},{label:"Type",key:"type"}],data:[]}),C=x(()=>s.value===null?null:{name:"policy-detail-view",params:{mesh:s.value.mesh,policy:s.value.name,policyPath:n.policyPath}}),f=x(()=>u.state.policyTypesByPath[n.policyPath]),O=x(()=>u.state.policyTypes.map(e=>({label:e.name,value:e.path,selected:e.path===n.policyPath}))),W=x(()=>u.state.policyTypes.filter(e=>(u.state.sidebar.insights.mesh.policies[e.name]??0)===0).map(e=>e.name));se(()=>b.params.mesh,function(){b.name===n.policyPath&&N(0)}),K();async function K(){const e=u.state.policyTypesByPath[n.policyPath];e!==void 0&&(await u.dispatch("updatePageTitle",""),await u.dispatch("updatePageTitle",e.name)),N(n.offset)}async function N(e){var o;B.value=e,L.set("offset",e>0?e:null),T.value=!0,P.value=null;const l=b.params.mesh,r=b.params.policyPath,t=z;try{const{items:i,next:j}=await S.getAllPolicyEntitiesFromMesh({mesh:l,path:r},{size:t,offset:e});V.value=j,k.value.data=Q(i??[]),await I({name:n.selectedPolicyName??((o=k.value.data[0])==null?void 0:o.entity.name),mesh:l,path:r})}catch(i){k.value.data=[],s.value=null,i instanceof Error?P.value=i:console.error(i)}finally{T.value=!1}}function Q(e){return e.map(l=>{const{type:r,name:t}=l,o={name:"policy-detail-view",params:{mesh:l.mesh,policyPath:b.params.policyPath,policy:t}};return{entity:l,detailViewRoute:o,type:r}})}async function Z(e){const{name:l,mesh:r,type:t}=e,i=u.state.policyTypesByName[t].path;await I({name:l,mesh:r,path:i})}async function I({name:e,mesh:l,path:r}){if(e===void 0){s.value=null,v.value=null,L.set("policy",null);return}try{const t=await S.getSinglePolicyEntity({mesh:l,path:r,name:e});s.value=le(t,["type","name","mesh"]),L.set("policy",t.name),v.value=oe(t)}catch(t){console.error(t)}}function G(e){F.push({name:"policies-list-view",params:{...b.params,policyPath:e.value}})}return(e,l)=>{var t;const r=ie("router-link");return f.value?(c(),A("div",{key:0,class:R(["relative",f.value.path])},[y("div",ke,[y("div",we,[f.value.isExperimental?(c(),g(d(X),{key:0,"border-variant":"noBorder",class:"mb-4"},{body:a(()=>[m(d(J),{appearance:"warning"},{alertMessage:a(()=>[Te]),_:1})]),_:1})):w("",!0),p(),m(ue,{"selected-entity-name":(t=s.value)==null?void 0:t.name,"page-size":d(z),error:P.value,"is-loading":T.value,"empty-state":{title:"No Data",message:`There are no ${f.value.name} policies present.`},"table-data":k.value,"table-data-is-empty":k.value.data.length===0,next:V.value,"page-offset":B.value,onTableAction:Z,onLoadData:N},{additionalControls:a(()=>[m(d(ee),{label:"Policies",items:O.value,"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:G},{"item-template":a(({item:o})=>[y("span",{class:R({"policy-type-empty":W.value.includes(o.label)})},D(o.label),3)]),_:1},8,["items"]),p(),m(be,{href:`${d(E)("KUMA_DOCS_URL")}/policies/${f.value.path}/?${d(E)("KUMA_UTM_QUERY_PARAMS")}`,"data-testid":"policy-documentation-link"},null,8,["href"])]),default:a(()=>[p(`
          >
          `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"])]),p(),y("div",xe,[s.value!==null&&C.value!==null?(c(),g(ye,{key:0,"has-error":P.value!==null,error:P.value,"is-loading":T.value,tabs:M},{tabHeader:a(()=>[y("h1",De,[p(D(f.value.name)+`:

              `,1),m($,{text:s.value.name},{default:a(()=>[m(r,{to:C.value},{default:a(()=>[p(D(s.value.name),1)]),_:1},8,["to"])]),_:1},8,["text"])])]),overview:a(()=>[m(de,{"data-testid":"policy-detail-label-list"},{default:a(()=>[(c(!0),A(U,null,ne(s.value,(o,i)=>(c(),g(me,{key:i,term:i},{default:a(()=>[i==="name"?(c(),g($,{key:0,text:o},null,8,["text"])):(c(),A(U,{key:1},[p(D(o),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),p(),v.value!==null?(c(),g(he,{key:0,id:"code-block-policy",class:"mt-4",content:v.value,"is-searchable":""},null,8,["content"])):w("",!0)]),"affected-dpps":a(()=>[v.value!==null?(c(),g(pe,{key:0,mesh:v.value.mesh,"policy-name":v.value.name,"policy-path":f.value.path},null,8,["mesh","policy-name","policy-path"])):w("",!0)]),_:1},8,["has-error","error","is-loading"])):w("",!0)])])],2)):w("",!0)}}});const Ge=ge(Se,[["__scopeId","data-v-aec69631"]]);export{Ge as default};
