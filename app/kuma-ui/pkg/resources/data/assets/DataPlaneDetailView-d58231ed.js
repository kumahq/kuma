import{a as j,K as q}from"./index-fce48c05.js";import{_ as B,a as b,o,b as f,w as e,m as s,r as C,f as t,d as A,c as d,e as r,k as W,t as l,l as a,F as c,D as m,n as J,J as Y,W as Q,X as y,Y as tt,p as $,Z as et,$ as at,a0 as st,v as nt,x as lt}from"./index-f385383f.js";import{E as ot}from"./ErrorBlock-6c88077a.js";import{_ as rt}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-bf912351.js";import{S as dt}from"./StatusBadge-9db39394.js";import{T as O}from"./TagList-9e46e2cc.js";import{T as z}from"./TextWithCopyButton-66e03f53.js";import{_ as it}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-01c7701f.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-f04c574e.js";import"./CopyButton-bd8ef627.js";import"./AccordionList-649f631e.js";const ct={},ut={class:"card"},_t={class:"title"},pt={class:"body"};function ft(v,n){const u=b("KCard");return o(),f(u,{class:"data-card"},{default:e(()=>[s("dl",null,[s("div",ut,[s("dt",_t,[C(v.$slots,"title",{},void 0,!0)]),t(),s("dd",pt,[C(v.$slots,"default",{},void 0,!0)])])])]),_:3})}const X=B(ct,[["render",ft],["__scopeId","data-v-6e083223"]]),mt={class:"service-traffic"},vt={class:"actions"},ht=A({__name:"DataPlaneTraffic",setup(v){return(n,u)=>(o(),d("div",mt,[s("div",vt,[C(n.$slots,"actions",{},void 0,!0)]),t(),r(X,{class:"header"},{title:e(()=>[C(n.$slots,"title",{},void 0,!0)]),_:3}),t(),C(n.$slots,"default",{},void 0,!0)]))}});const F=B(ht,[["__scopeId","data-v-5bd1dbf9"]]),yt={class:"title"},gt=A({__name:"ServiceTrafficCard",props:{protocol:{},traffic:{}},setup(v){const{t:n}=W(),u=v;return(_,K)=>{const G=b("KBadge");return o(),f(X,{class:"service-traffic-card"},{title:e(()=>[r(G,{appearance:u.protocol==="passthrough"?"success":"info"},{default:e(()=>[t(l(a(n)(`data-planes.components.service_traffic_card.protocol.${u.protocol}`,{},{defaultMessage:a(n)(`http.api.value.${u.protocol}`)})),1)]),_:1},8,["appearance"]),t(),s("div",yt,[C(_.$slots,"default",{},void 0,!0)])]),default:e(()=>{var N,V,w,R,P,M,T;return[t(),s("dl",null,[u.protocol==="passthrough"?(o(!0),d(c,{key:0},m([["http","tcp"].reduce((p,D)=>{const E="downstream";return Object.entries(u.traffic[D]||{}).reduce((S,[x,i])=>[`${E}_cx_tx_bytes_total`,`${E}_cx_rx_bytes_total`].includes(x)?{...S,[x]:i+(S[x]??0)}:S,p)},{})],(p,D)=>(o(),d(c,{key:D},[s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,l(a(n)("common.formats.bytes",{value:p.downstream_cx_rx_bytes_total??0})),1)]),t(),s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,l(a(n)("common.formats.bytes",{value:p.downstream_cx_tx_bytes_total??0})),1)])],64))),128)):u.protocol==="http"?(o(),d(c,{key:1},[(o(!0),d(c,null,m([((N=u.traffic.http)==null?void 0:N.downstream_rq_1xx)??0].filter(p=>p!==0),p=>(o(),d("div",{key:p},[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.1xx")),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:p})),1)]))),128)),t(),s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.2xx")),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:((V=u.traffic.http)==null?void 0:V.downstream_rq_2xx)??0})),1)]),t(),(o(!0),d(c,null,m([((w=u.traffic.http)==null?void 0:w.downstream_rq_3xx)??0].filter(p=>p!==0),p=>(o(),d("div",{key:p},[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.3xx")),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:p})),1)]))),128)),t(),s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.4xx")),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:((R=u.traffic.http)==null?void 0:R.downstream_rq_4xx)??0})),1)]),t(),s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.5xx")),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:((P=u.traffic.http)==null?void 0:P.downstream_rq_5xx)??0})),1)])],64)):(o(),d(c,{key:2},[s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,l(a(n)("common.formats.bytes",{value:((M=u.traffic.tcp)==null?void 0:M.downstream_cx_rx_bytes_total)??0})),1)]),t(),s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,l(a(n)("common.formats.bytes",{value:((T=u.traffic.tcp)==null?void 0:T.downstream_cx_tx_bytes_total)??0})),1)])],64))])]}),_:3})}}});const U=B(gt,[["__scopeId","data-v-23b8b43b"]]),bt={class:"body"},xt=A({__name:"ServiceTrafficGroup",props:{type:{}},setup(v){const n=v;return(u,_)=>{const K=b("KCard");return o(),f(K,{class:J(["service-traffic-group",`type-${n.type}`])},{default:e(()=>[s("div",bt,[C(u.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}});const L=B(xt,[["__scopeId","data-v-baf4abf7"]]),kt=v=>(nt("data-v-d47a13a3"),v=v(),lt(),v),wt={"data-testid":"dataplane-warnings"},$t=["data-testid","innerHTML"],Ct={class:"stack","data-testid":"dataplane-details"},It={class:"columns"},Kt={class:"status-with-reason"},Tt={class:"columns"},Dt=kt(()=>s("span",null,"Outbounds",-1)),St={class:"passthrough"},Bt={class:"outbounds"},Vt={key:1,"data-testid":"dataplane-inbounds"},Rt={class:"inbound-list"},Pt={class:"mt-4 columns"},Mt={"data-testid":"dataplane-mtls"},Et={class:"columns"},qt=["innerHTML"],zt={key:2,"data-testid":"dataplane-subscriptions"},At=A({__name:"DataPlaneDetailView",props:{data:{}},setup(v){const{t:n,formatIsoDate:u}=W(),_=v,K=Y(()=>_.data.warnings.concat(..._.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(G,N)=>{const V=b("KTooltip"),w=b("KCard"),R=b("KInputSwitch"),P=b("KButton"),M=b("DataSource"),T=b("KBadge"),p=b("KAlert"),D=b("AppView"),E=b("RouteView");return o(),f(E,{params:{mesh:"",dataPlane:"",inactive:!1},name:"data-plane-detail-view"},{default:e(({can:S,route:x})=>[r(D,null,Q({default:e(()=>[t(),s("div",Ct,[r(w,null,{default:e(()=>[s("div",It,[r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.status")),1)]),body:e(()=>[s("div",Kt,[r(dt,{status:_.data.status},null,8,["status"]),t(),(o(!0),d(c,null,m([_.data.dataplane.networking.inbounds.filter(i=>!i.health.ready)],i=>(o(),d(c,{key:i},[i.length>0?(o(),f(V,{key:0,class:"reason-tooltip","position-fixed":""},{content:e(()=>[s("ul",null,[(o(!0),d(c,null,m(i,g=>(o(),d("li",{key:`${g.service}:${g.port}`},l(a(n)("data-planes.routes.item.unhealthy_inbound",{service:g.service,port:g.port})),1))),128))])]),default:e(()=>[r(a(tt),{color:a(j),size:a(q),"hide-title":""},null,8,["color","size"]),t()]),_:2},1024)):$("",!0)],64))),128))])]),_:1}),t(),r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.last_updated")),1)]),body:e(()=>[t(l(a(u)(_.data.modificationTime)),1)]),_:1}),t(),_.data.dataplane.networking.gateway?(o(),d(c,{key:0},[r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.tags")),1)]),body:e(()=>[r(O,{tags:_.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:1}),t(),r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.address")),1)]),body:e(()=>[r(z,{text:`${_.data.dataplane.networking.address}`},null,8,["text"])]),_:1})],64)):$("",!0)])]),_:1}),t(),S("read traffic")&&_.data.dataplaneType==="standard"?(o(),f(M,{key:0,src:`/meshes/${x.params.mesh}/dataplanes/${x.params.dataPlane}/traffic`},{default:e(({data:i,error:g,refresh:Z})=>[g?(o(),f(ot,{key:0,error:g},null,8,["error"])):i===void 0?(o(),f(rt,{key:1})):(o(),f(w,{key:2,class:"traffic"},{default:e(()=>[s("div",Tt,[r(F,null,{title:e(()=>[r(a(et),{display:"inline-block",decorative:"",size:a(q)},null,8,["size"]),t(`
                  Inbounds
                `)]),data:e(()=>[s("dl",null,[s("div",null,[s("dt",null,l(a(n)("services.components.service_traffic.inbound",{},{defaultMessage:"Requests"})),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),r(L,{type:"inbound"},{default:e(()=>[(o(!0),d(c,null,m(i.inbounds,h=>(o(),d(c,{key:`${h.name}`},[(o(!0),d(c,null,m([h.name.split("_").at(-1)],I=>(o(),d(c,{key:I},[(o(!0),d(c,null,m([_.data.dataplane.networking.inbounds.find(k=>`${k.port}`==`${I}`)],k=>(o(),d(c,{key:k},[k?(o(),f(U,{key:0,protocol:typeof h.http<"u"?"http":"tcp",traffic:h},{default:e(()=>[t(`
                          :`+l(k.port)+" ",1),r(O,{tags:[{label:"kuma.io/service",value:k.tags["kuma.io/service"]}]},null,8,["tags"])]),_:2},1032,["protocol","traffic"])):$("",!0)],64))),128))],64))),128))],64))),128))]),_:2},1024)]),_:2},1024),t(),r(F,null,{actions:e(()=>[r(R,{modelValue:x.params.inactive,"onUpdate:modelValue":h=>x.params.inactive=h},{label:e(()=>[t(`
                      Show inactive
                    `)]),_:2},1032,["modelValue","onUpdate:modelValue"]),t(),r(P,{appearance:"primary",onClick:Z},{default:e(()=>[r(a(at),{size:a(q)},null,8,["size"]),t(`

                    Refresh
                  `)]),_:2},1032,["onClick"])]),title:e(()=>[r(a(st),{display:"inline-block",decorative:"",size:a(q)},null,8,["size"]),t(),Dt]),data:e(()=>[s("dl",null,[s("div",null,[s("dt",St,l(a(n)("services.components.service_traffic.passthrough",{},{defaultMessage:"Passthrough Requests"})),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:1e3})),1)]),t(),s("div",null,[s("dt",Bt,l(a(n)("services.components.service_traffic.mesh",{},{defaultMessage:"Mesh Requests"})),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),t(),r(L,{type:"passthrough"},{default:e(()=>[r(U,{protocol:"passthrough",traffic:i.passthrough},{default:e(()=>[t(`
                    Non mesh traffic
                  `)]),_:2},1032,["traffic"])]),_:2},1024),t(),r(L,{type:"outbound"},{default:e(()=>[(o(!0),d(c,null,m(i.outbounds,h=>(o(),d(c,{key:`${h.name}`},[(o(!0),d(c,null,m([typeof h.http<"u"?"http":"tcp"],I=>{var k,H;return o(),d(c,{key:I},[x.params.inactive||((I!=="http"?(k=h.tcp)==null?void 0:k.downstream_cx_rx_bytes_total:(H=h.http)==null?void 0:H.downstream_rq_total)??0>0)?(o(),f(U,{key:0,protocol:I,traffic:h},{default:e(()=>[t(l(h.name),1)]),_:2},1032,["protocol","traffic"])):$("",!0)],64)}),128))],64))),128))]),_:2},1024)]),_:2},1024)])]),_:2},1024))]),_:2},1032,["src"])):$("",!0),t(),_.data.dataplane.networking.inbounds.length>0?(o(),d("div",Vt,[s("h2",null,l(a(n)("data-planes.routes.item.inbounds")),1),t(),r(w,{class:"mt-4"},{default:e(()=>[s("div",Rt,[(o(!0),d(c,null,m(_.data.dataplane.networking.inbounds,(i,g)=>(o(),d("div",{key:g,class:"inbound"},[s("h4",null,[r(z,{text:i.tags["kuma.io/service"]},{default:e(()=>[t(l(a(n)("data-planes.routes.item.inbound_name",{service:i.tags["kuma.io/service"]})),1)]),_:2},1032,["text"])]),t(),s("div",Pt,[r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.status")),1)]),body:e(()=>[i.health.ready?(o(),f(T,{key:0,appearance:"success"},{default:e(()=>[t(l(a(n)("data-planes.routes.item.health.ready")),1)]),_:1})):(o(),f(T,{key:1,appearance:"danger"},{default:e(()=>[t(l(a(n)("data-planes.routes.item.health.not_ready")),1)]),_:1}))]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.tags")),1)]),body:e(()=>[r(O,{tags:i.tags},null,8,["tags"])]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.address")),1)]),body:e(()=>[r(z,{text:i.addressPort},null,8,["text"])]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.serviceAddress")),1)]),body:e(()=>[r(z,{text:i.serviceAddressPort},null,8,["text"])]),_:2},1024)])]))),128))])]),_:1})])):$("",!0),t(),s("div",Mt,[s("h2",null,l(a(n)("data-planes.routes.item.mtls.title")),1),t(),_.data.dataplaneInsight.mTLS?(o(!0),d(c,{key:0},m([_.data.dataplaneInsight.mTLS],i=>(o(),f(w,{key:i,class:"mt-4"},{default:e(()=>[s("div",Et,[r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:e(()=>[t(l(a(u)(i.certificateExpirationTime)),1)]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.mtls.generation_time.title")),1)]),body:e(()=>[t(l(a(u)(i.lastCertificateRegeneration)),1)]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.mtls.regenerations.title")),1)]),body:e(()=>[t(l(a(n)("common.formats.integer",{value:i.certificateRegenerations})),1)]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:e(()=>[t(l(i.issuedBackend),1)]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:e(()=>[s("ul",null,[(o(!0),d(c,null,m(i.supportedBackends,g=>(o(),d("li",{key:g},l(g),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(o(),f(p,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:e(()=>[s("div",{innerHTML:a(n)("data-planes.routes.item.mtls.disabled")},null,8,qt)]),_:1}))]),t(),_.data.dataplaneInsight.subscriptions.length>0?(o(),d("div",zt,[s("h2",null,l(a(n)("data-planes.routes.item.subscriptions.title")),1),t(),r(w,{class:"mt-4"},{default:e(()=>[r(it,{subscriptions:_.data.dataplaneInsight.subscriptions},null,8,["subscriptions"])]),_:1})])):$("",!0)])]),_:2},[K.value.length>0?{name:"notifications",fn:e(()=>[s("ul",wt,[(o(!0),d(c,null,m(K.value,i=>(o(),d("li",{key:i.kind,"data-testid":`warning-${i.kind}`,innerHTML:a(n)(`common.warnings.${i.kind}`,i.payload)},null,8,$t))),128)),t()])]),key:"0"}:void 0]),1024)]),_:1})}}});const Jt=B(At,[["__scopeId","data-v-d47a13a3"]]);export{Jt as default};
