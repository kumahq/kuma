import{d as U,I as E,G as R,o as s,p as f,w as t,c as y,H as W,F as G,E as de,r as v,b as i,m as I,$ as le,R as M,e as a,Q as S,t as r,l as C,S as pe,J as b,K as x,V as ue,W as me,L as P,q as N,A as ce,_ as ye}from"./index-Ch1waQC_.js";import{S as ge}from"./SummaryView-CvxHxN3s.js";import{T as fe}from"./TagList-Cw8tefL6.js";import{C as j,a as O,b as K}from"./ConnectionTraffic-BHxcCgZG.js";const ve=["aria-hidden"],J='<path d="M15 18L21 12L15 6L13.6 7.4L17.2 11H3V13H17.2L13.6 16.6L15 18Z" fill="currentColor"/>',be=U({__name:"ForwardIcon",props:{title:{type:String,required:!1,default:""},color:{type:String,required:!1,default:"currentColor"},display:{type:String,required:!1,default:"block"},decorative:{type:Boolean,required:!1,default:!1},size:{type:[Number,String],required:!1,default:E,validator:c=>{if(typeof c=="number"&&c>0)return!0;if(typeof c=="string"){const d=String(c).replace(/px/gi,""),n=Number(d);if(n&&!isNaN(n)&&Number.isInteger(n)&&n>0)return!0}return!1}},as:{type:String,required:!1,default:"span"},staticIds:{type:Boolean,default:!1}},setup(c){const d=c,n=R(()=>{if(typeof d.size=="number"&&d.size>0)return`${d.size}px`;if(typeof d.size=="string"){const g=String(d.size).replace(/px/gi,""),l=Number(g);if(l&&!isNaN(l)&&Number.isInteger(l)&&l>0)return`${l}px`}return E}),T=R(()=>({boxSizing:"border-box",color:d.color,display:d.display,flexShrink:"0",height:n.value,lineHeight:"0",width:n.value,pointerEvents:d.decorative?"none":void 0})),A=g=>{const l={},D=Math.random().toString(36).substring(2,12);return g.replace(/id="([^"]+)"/g,(L,w)=>{const $=`${D}-${w}`;return l[w]=$,`id="${$}"`}).replace(/#([^\s^")]+)/g,(L,w)=>l[w]?`#${l[w]}`:L)},e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","&":"&amp;"},B=g=>g.replace(/[<>"'&]/g,l=>e[l]),V=`${d.title?`<title data-testid="kui-icon-svg-title">${B(d.title)}</title>`:""}${d.staticIds?J:A(J)}`;return(g,l)=>(s(),f(G(c.as),{"aria-hidden":c.decorative?"true":void 0,class:"kui-icon forward-icon","data-testid":"kui-icon-wrapper-forward-icon",style:W(T.value),tabindex:c.decorative?"-1":void 0},{default:t(()=>[(s(),y("svg",{"aria-hidden":c.decorative?"true":void 0,"data-testid":"kui-icon-svg-forward-icon",fill:"none",height:"100%",role:"img",viewBox:"0 0 24 24",width:"100%",xmlns:"http://www.w3.org/2000/svg",innerHTML:V},null,8,ve))]),_:1},8,["aria-hidden","style","tabindex"]))}}),we=["aria-hidden"],Q='<path d="M12 21V19H19V5H12V3H19C19.55 3 20.0208 3.19583 20.4125 3.5875C20.8042 3.97917 21 4.45 21 5V19C21 19.55 20.8042 20.0208 20.4125 20.4125C20.0208 20.8042 19.55 21 19 21H12ZM10 17L8.625 15.55L11.175 13H3V11H11.175L8.625 8.45L10 7L15 12L10 17Z" fill="currentColor"/>',ke=U({__name:"GatewayIcon",props:{title:{type:String,required:!1,default:""},color:{type:String,required:!1,default:"currentColor"},display:{type:String,required:!1,default:"block"},decorative:{type:Boolean,required:!1,default:!1},size:{type:[Number,String],required:!1,default:E,validator:c=>{if(typeof c=="number"&&c>0)return!0;if(typeof c=="string"){const d=String(c).replace(/px/gi,""),n=Number(d);if(n&&!isNaN(n)&&Number.isInteger(n)&&n>0)return!0}return!1}},as:{type:String,required:!1,default:"span"},staticIds:{type:Boolean,default:!1}},setup(c){const d=c,n=R(()=>{if(typeof d.size=="number"&&d.size>0)return`${d.size}px`;if(typeof d.size=="string"){const g=String(d.size).replace(/px/gi,""),l=Number(g);if(l&&!isNaN(l)&&Number.isInteger(l)&&l>0)return`${l}px`}return E}),T=R(()=>({boxSizing:"border-box",color:d.color,display:d.display,flexShrink:"0",height:n.value,lineHeight:"0",width:n.value,pointerEvents:d.decorative?"none":void 0})),A=g=>{const l={},D=Math.random().toString(36).substring(2,12);return g.replace(/id="([^"]+)"/g,(L,w)=>{const $=`${D}-${w}`;return l[w]=$,`id="${$}"`}).replace(/#([^\s^")]+)/g,(L,w)=>l[w]?`#${l[w]}`:L)},e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","&":"&amp;"},B=g=>g.replace(/[<>"'&]/g,l=>e[l]),V=`${d.title?`<title data-testid="kui-icon-svg-title">${B(d.title)}</title>`:""}${d.staticIds?Q:A(Q)}`;return(g,l)=>(s(),f(G(c.as),{"aria-hidden":c.decorative?"true":void 0,class:"kui-icon gateway-icon","data-testid":"kui-icon-wrapper-gateway-icon",style:W(T.value),tabindex:c.decorative?"-1":void 0},{default:t(()=>[(s(),y("svg",{"aria-hidden":c.decorative?"true":void 0,"data-testid":"kui-icon-svg-gateway-icon",fill:"none",height:"100%",role:"img",viewBox:"0 0 24 24",width:"100%",xmlns:"http://www.w3.org/2000/svg",innerHTML:V},null,8,we))]),_:1},8,["aria-hidden","style","tabindex"]))}}),_e={"data-testid":"dataplane-warnings"},he=["data-testid","innerHTML"],ze={key:0,"data-testid":"warning-stats-loading"},Ce={class:"status-with-reason"},Se={"data-testid":"dataplane-mtls"},xe={class:"columns"},$e=["innerHTML"],Ie={key:0,"data-testid":"dataplane-subscriptions"},Ne=U({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(c){const d=de(),n=c,T=R(()=>n.data.warnings.concat(...n.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(A,e)=>{const B=v("KTooltip"),V=v("DataCollection"),g=v("XAction"),l=v("XBadge"),D=v("XCopyButton"),L=v("XAboutCard"),w=v("XEmptyState"),$=v("XLayout"),Y=v("XInputSwitch"),ee=v("XProgress"),Z=v("XCard"),te=v("RouterView"),ae=v("XAlert"),ne=v("AppView"),oe=v("DataSource"),ie=v("RouteView");return s(),f(ie,{params:{mesh:"",dataPlane:"",subscription:"",inactive:!1},name:"data-plane-detail-view"},{default:t(({route:k,t:p,can:F,me:X,uri:se})=>[i(oe,{src:se(I(le),"/meshes/:mesh/dataplanes/:name/stats/:address",{mesh:k.params.mesh,name:k.params.dataPlane,address:n.data.dataplane.networking.inboundAddress})},{default:t(({data:h,error:H,refresh:re})=>[i(ne,null,M({default:t(()=>[e[48]||(e[48]=a()),i($,{type:"stack","data-testid":"dataplane-details"},{default:t(()=>[i(L,{title:p("data-planes.routes.item.about.title"),created:n.data.creationTime,modified:n.data.modificationTime},{default:t(()=>[i(S,{layout:"horizontal"},{title:t(()=>[a(r(p("http.api.property.status")),1)]),body:t(()=>[C("div",Ce,[i(pe,{status:n.data.status},null,8,["status"]),e[4]||(e[4]=a()),n.data.dataplaneType==="standard"?(s(),f(V,{key:0,items:n.data.dataplane.networking.inbounds,predicate:o=>o.state!=="Ready",empty:!1},{default:t(({items:o})=>[i(B,{class:"reason-tooltip"},{content:t(()=>[C("ul",null,[(s(!0),y(b,null,x(o,u=>(s(),y("li",{key:`${u.service}:${u.port}`},r(p("data-planes.routes.item.unhealthy_inbound",{service:u.service,port:u.port})),1))),128))])]),default:t(()=>[i(I(ue),{color:I(me),size:I(P)},null,8,["color","size"]),e[3]||(e[3]=a())]),_:2},1024)]),_:2},1032,["items","predicate"])):N("",!0)])]),_:2},1024),e[11]||(e[11]=a()),F("use zones")&&n.data.zone?(s(),f(S,{key:0,layout:"horizontal"},{title:t(()=>[a(r(p("http.api.property.zone")),1)]),body:t(()=>[i(l,{appearance:"decorative"},{default:t(()=>[i(g,{to:{name:"zone-cp-detail-view",params:{zone:n.data.zone}}},{default:t(()=>[a(r(n.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2},1024)):N("",!0),e[12]||(e[12]=a()),i(S,{layout:"horizontal"},{title:t(()=>[a(r(p("http.api.proptery.type")),1)]),body:t(()=>[i(l,{appearance:"decorative"},{default:t(()=>[a(r(p(`data-planes.type.${n.data.dataplaneType}`)),1)]),_:2},1024)]),_:2},1024),e[13]||(e[13]=a()),n.data.namespace.length>0?(s(),f(S,{key:1,layout:"horizontal"},{title:t(()=>[a(r(p("http.api.property.namespace")),1)]),body:t(()=>[i(l,{appearance:"decorative"},{default:t(()=>[a(r(n.data.namespace),1)]),_:1})]),_:2},1024)):N("",!0),e[14]||(e[14]=a()),i(S,{layout:"horizontal"},{title:t(()=>[a(r(p("http.api.property.address")),1)]),body:t(()=>[i(D,{variant:"badge",format:"default",text:`${n.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024),e[15]||(e[15]=a()),n.data.dataplane.networking.gateway?(s(),f(S,{key:2,layout:"horizontal"},{title:t(()=>[a(r(p("http.api.property.tags")),1)]),body:t(()=>[i(fe,{tags:n.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024)):N("",!0)]),_:2},1032,["title","created","modified"]),e[44]||(e[44]=a()),i(Z,{class:"traffic","data-testid":"dataplane-traffic"},{default:t(()=>[i($,{type:"columns"},{default:t(()=>[i(j,null,{title:t(()=>[i(I(be),{display:"inline-block",decorative:"",size:I(P)},null,8,["size"]),e[16]||(e[16]=a(`
                  Inbounds
                `))]),default:t(()=>[e[18]||(e[18]=a()),(s(!0),y(b,null,x([n.data.dataplane.networking.type==="gateway"?Object.entries((h==null?void 0:h.inbounds)??{}).reduce((o,[u,m])=>{var z;const _=u.split("_").at(-1);return _===(((z=n.data.dataplane.networking.admin)==null?void 0:z.port)??"9901")?o:o.concat([{...n.data.dataplane.networking.inbounds[0],name:u,port:Number(_),protocol:["http","tcp"].find(q=>typeof m[q]<"u")??"tcp",addressPort:`${n.data.dataplane.networking.inbounds[0].address}:${_}`}])},[]):n.data.dataplane.networking.inbounds],o=>(s(),f(O,{key:o,type:"inbound","data-testid":"dataplane-inbounds"},{default:t(()=>[i(V,{type:"inbounds",items:o,predicate:u=>u.port!==49151},M({default:t(({items:u})=>[i($,{type:"stack",size:"small"},{default:t(()=>[(s(!0),y(b,null,x(u,m=>(s(),y(b,{key:`${m.name}`},[(s(!0),y(b,null,x([h==null?void 0:h.inbounds[m.name]],_=>(s(),f(K,{key:_,"data-testid":"dataplane-inbound",protocol:m.protocol,service:F("use service-insights",n.mesh)?m.tags["kuma.io/service"]:"",traffic:typeof H>"u"?_:{name:"",protocol:m.protocol,port:`${m.port}`}},{default:t(()=>[i(g,{"data-action":"",to:{name:(z=>z.includes("bound")?z.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(I(d).name)),params:{connection:m.name},query:{inactive:k.params.inactive}}},{default:t(()=>[a(r(m.name.replace("localhost","").replace("_",":")),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","service","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},[n.data.dataplaneType==="delegated"?{name:"empty",fn:t(()=>[i(w,null,{default:t(()=>[C("p",null,`
                            This proxy is a delegated gateway therefore `+r(p("common.product.name"))+` does not have any visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),e[28]||(e[28]=a()),i(j,null,M({title:t(()=>[i(I(ke),{display:"inline-block",decorative:"",size:I(P)},null,8,["size"]),e[22]||(e[22]=a()),e[23]||(e[23]=C("span",null,"Outbounds",-1))]),default:t(()=>[e[26]||(e[26]=a()),e[27]||(e[27]=a()),typeof H>"u"?(s(),y(b,{key:0},[typeof h>"u"?(s(),f(ee,{key:0})):(s(),y(b,{key:1},[i(O,{type:"passthrough"},{default:t(()=>[i(K,{protocol:"passthrough",traffic:h.passthrough},{default:t(()=>e[24]||(e[24]=[a(`
                        Non mesh traffic
                      `)])),_:2},1032,["traffic"])]),_:2},1024),e[25]||(e[25]=a()),(s(),y(b,null,x(["upstream"],o=>i(V,{key:o,type:"outbounds",predicate:k.params.inactive?void 0:([u,m])=>{var _,z;return((typeof m.tcp<"u"?(_=m.tcp)==null?void 0:_[`${o}_cx_rx_bytes_total`]:(z=m.http)==null?void 0:z[`${o}_rq_total`])??0)>0},items:Object.entries(h.outbounds)},{default:t(({items:u})=>[u.length>0?(s(),f(O,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:t(()=>[(s(),y(b,null,x([/-([a-f0-9]){16}$/],m=>i($,{key:m,type:"stack",size:"small"},{default:t(()=>[(s(!0),y(b,null,x(u,([_,z])=>(s(),f(K,{key:`${_}`,"data-testid":"dataplane-outbound",protocol:["grpc","http","tcp"].find(q=>typeof z[q]<"u")??"tcp",traffic:z,service:z.$resourceMeta.type===""?_.replace(m,""):void 0,direction:o},{default:t(()=>[i(g,{"data-action":"",to:{name:(q=>q.includes("bound")?q.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(I(d).name)),params:{connection:_},query:{inactive:k.params.inactive}}},{default:t(()=>[a(r(_),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","service","direction"]))),128))]),_:2},1024)),64))]),_:2},1024)):N("",!0)]),_:2},1032,["predicate","items"])),64))],64))],64)):(s(),f(w,{key:1}))]),_:2},[h?{name:"actions",fn:t(()=>[i(Y,{modelValue:k.params.inactive,"onUpdate:modelValue":o=>k.params.inactive=o,"data-testid":"dataplane-outbounds-inactive-toggle"},{label:t(()=>e[19]||(e[19]=[a(`
                      Show inactive
                    `)])),_:2},1032,["modelValue","onUpdate:modelValue"]),e[21]||(e[21]=a()),i(g,{action:"refresh",appearance:"primary",onClick:re},{default:t(()=>e[20]||(e[20]=[a(`
                    Refresh
                  `)])),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024),e[45]||(e[45]=a()),i(te,null,{default:t(o=>[o.route.name!==k.name?(s(),f(ge,{key:0,width:"670px",onClose:function(){k.replace({name:"data-plane-detail-view",params:{mesh:k.params.mesh,dataPlane:k.params.dataPlane},query:{inactive:k.params.inactive?null:void 0}})}},{default:t(()=>[(s(),f(G(o.Component),{data:k.params.subscription.length>0?n.data.dataplaneInsight.subscriptions:o.route.name.includes("-inbound-")?n.data.dataplane.networking.inbounds:(h==null?void 0:h.outbounds)||{},networking:n.data.dataplane.networking},null,8,["data","networking"]))]),_:2},1032,["onClose"])):N("",!0)]),_:2},1024),e[46]||(e[46]=a()),C("div",Se,[C("h2",null,r(p("data-planes.routes.item.mtls.title")),1),e[38]||(e[38]=a()),n.data.dataplaneInsight.mTLS?(s(!0),y(b,{key:0},x([n.data.dataplaneInsight.mTLS],o=>(s(),f(Z,{key:o,class:"mt-4"},{default:t(()=>[C("div",xe,[i(S,null,{title:t(()=>[a(r(p("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:t(()=>[a(r(p("common.formats.datetime",{value:Date.parse(o.certificateExpirationTime)})),1)]),_:2},1024),e[34]||(e[34]=a()),i(S,null,{title:t(()=>[a(r(p("data-planes.routes.item.mtls.generation_time.title")),1)]),body:t(()=>[a(r(p("common.formats.datetime",{value:Date.parse(o.lastCertificateRegeneration)})),1)]),_:2},1024),e[35]||(e[35]=a()),i(S,null,{title:t(()=>[a(r(p("data-planes.routes.item.mtls.regenerations.title")),1)]),body:t(()=>[a(r(p("common.formats.integer",{value:o.certificateRegenerations})),1)]),_:2},1024),e[36]||(e[36]=a()),i(S,null,{title:t(()=>[a(r(p("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:t(()=>[a(r(o.issuedBackend),1)]),_:2},1024),e[37]||(e[37]=a()),i(S,null,{title:t(()=>[a(r(p("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:t(()=>[C("ul",null,[(s(!0),y(b,null,x(o.supportedBackends,u=>(s(),y("li",{key:u},r(u),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(s(),f(ae,{key:1,class:"mt-4",variant:"warning"},{default:t(()=>[C("div",{innerHTML:p("data-planes.routes.item.mtls.disabled")},null,8,$e)]),_:2},1024))]),e[47]||(e[47]=a()),n.data.dataplaneInsight.subscriptions.length>0?(s(),y("div",Ie,[C("h2",null,r(p("data-planes.routes.item.subscriptions.title")),1),e[43]||(e[43]=a()),i(ce,{headers:[{...X.get("headers.instanceId"),label:p("http.api.property.instanceId"),key:"instanceId"},{...X.get("headers.version"),label:p("http.api.property.version"),key:"version"},{...X.get("headers.connected"),label:p("http.api.property.connected"),key:"connected"},{...X.get("headers.disconnected"),label:p("http.api.property.disconnected"),key:"disconnected"},{...X.get("headers.responses"),label:p("http.api.property.responses"),key:"responses"}],"is-selected-row":o=>o.id===k.params.subscription,items:n.data.dataplaneInsight.subscriptions.map((o,u,m)=>m[m.length-(u+1)]),onResize:X.set},{instanceId:t(({row:o})=>[i(g,{"data-action":"",to:{name:"data-plane-subscription-summary-view",params:{subscription:o.id}}},{default:t(()=>[a(r(o.controlPlaneInstanceId),1)]),_:2},1032,["to"])]),version:t(({row:o})=>{var u,m;return[a(r(((m=(u=o.version)==null?void 0:u.kumaDp)==null?void 0:m.version)??"-"),1)]}),connected:t(({row:o})=>[a(r(p("common.formats.datetime",{value:Date.parse(o.connectTime??"")})),1)]),disconnected:t(({row:o})=>[o.disconnectTime?(s(),y(b,{key:0},[a(r(p("common.formats.datetime",{value:Date.parse(o.disconnectTime)})),1)],64)):N("",!0)]),responses:t(({row:o})=>{var u;return[(s(!0),y(b,null,x([((u=o.status)==null?void 0:u.total)??{}],m=>(s(),y(b,null,[a(r(m.responsesSent)+"/"+r(m.responsesAcknowledged),1)],64))),256))]}),_:2},1032,["headers","is-selected-row","items","onResize"])])):N("",!0)]),_:2},1024)]),_:2},[T.value.length>0||H?{name:"notifications",fn:t(()=>[C("ul",_e,[(s(!0),y(b,null,x(T.value,o=>(s(),y("li",{key:o.kind,"data-testid":`warning-${o.kind}`,innerHTML:p(`common.warnings.${o.kind}`,o.payload)},null,8,he))),128)),e[2]||(e[2]=a()),H?(s(),y("li",ze,[e[0]||(e[0]=a(`
              The below view is not enhanced with runtime stats (Error loading stats: `)),C("strong",null,r(H.toString()),1),e[1]||(e[1]=a(`)
            `))])):N("",!0)])]),key:"0"}:void 0]),1024)]),_:2},1032,["src"])]),_:1})}}}),qe=ye(Ne,[["__scopeId","data-v-9fc1e5f3"]]);export{qe as default};
