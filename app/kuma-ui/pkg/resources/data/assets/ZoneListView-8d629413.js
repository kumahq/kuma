import{m as q,A as D,o as F,p as K,S as U,K as R,q as W,_ as P,B as G,f as X}from"./RouteView.vue_vue_type_script_setup_true_lang-7aee8921.js";import{d as L,j as x,o as i,a as r,w as e,A as Z,g as n,b as a,N as j,f as A,X as H,r as J,h as s,C as Y,q as T,H as Q,t as l,e as O,F as I,M as ee,R as te,E as M,v as oe,I as S}from"./index-1a6818f4.js";import{_ as ne}from"./MultizoneInfo.vue_vue_type_script_setup_true_lang-d0abf81a.js";import{_ as ae}from"./RouteTitle.vue_vue_type_script_setup_true_lang-957e0dce.js";import{_ as se}from"./WarningIcon.vue_vue_type_script_setup_true_lang-ac7280a6.js";const ie=L({__name:"DeleteResourceModal",props:{actionButtonText:{type:String,required:!1,default:"Yes, delete"},confirmationText:{type:String,required:!1,default:""},deleteFunction:{type:Function,required:!0},isVisible:{type:Boolean,required:!0},modalId:{type:String,required:!0},title:{type:String,required:!1,default:"Delete"}},emits:["cancel","delete"],setup(N,{emit:p}){const c=N,u=x(!1);async function b(){u.value=!1;try{await c.deleteFunction(),p("delete")}catch{u.value=!0}}return(d,v)=>(i(),r(a(H),{"action-button-text":c.actionButtonText,"confirmation-text":c.confirmationText,"is-visible":c.isVisible,"modal-id":c.modalId,title:c.title,type:"danger","data-testid":"delete-resource-modal",onCanceled:v[0]||(v[0]=E=>p("cancel")),onProceed:b},{"body-content":e(()=>[Z(d.$slots,"body-content"),n(),u.value?(i(),r(a(j),{key:0,class:"mt-4",appearance:"danger","is-dismissible":""},{alertMessage:e(()=>[Z(d.$slots,"error")]),_:3})):A("",!0)]),_:3},8,["action-button-text","confirmation-text","is-visible","modal-id","title"]))}}),le=L({__name:"ZoneListView",props:{page:{type:Number,required:!0},size:{type:Number,required:!0}},setup(N){const p=N,c=q(),u=x(!1),b=x(!1),d=x("");function v(m){return m.map(g=>{var C;const{name:z}=g,V={name:"zone-cp-detail-view",params:{zone:z}};let t="",f="kubernetes",_=!0;(((C=g.zoneInsight)==null?void 0:C.subscriptions)??[]).forEach(o=>{if(o.version&&o.version.kumaCp){t=o.version.kumaCp.version;const{kumaCpGlobalCompatible:k=!0}=o.version.kumaCp;_=k}o.config&&(f=JSON.parse(o.config).environment)});const h=G(g);return{detailViewRoute:V,name:z,status:h,zoneCpVersion:t,type:f,warnings:!_}})}async function E(){await c.deleteZone({name:d.value})}function w(){u.value=!u.value}function B(m){w(),d.value=m}function $(m){b.value=(m==null?void 0:m.items.length)>0}return(m,g)=>{const z=J("RouterLink");return i(),r(P,{name:"zone-cp-list-view"},{default:e(({route:V,t,can:f,env:_})=>[s(D,null,Y({title:e(()=>[T("h1",null,[s(ae,{title:t("zone-cps.routes.items.title"),render:!0},null,8,["title"])])]),default:e(()=>[n(),n(),f("use zones")?(i(),r(F,{key:1,src:`/zone-cps?size=${p.size}&page=${p.page}`,onChange:$},{default:e(({data:y,error:h,refresh:C})=>[s(a(Q),null,{body:e(()=>[s(K,{class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{label:"Name",key:"name"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Type",key:"type"},{label:"Status",key:"status"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Actions",key:"actions",hideLabel:!0}],"page-number":p.page,"page-size":p.size,total:y==null?void 0:y.total,items:y?v(y.items):void 0,error:h,"empty-state-title":_("KUMA_ZONE_CREATION_FLOW")==="enabled"?t("zone-cps.empty_state.title"):void 0,"empty-state-message":_("KUMA_ZONE_CREATION_FLOW")==="enabled"?t("zone-cps.empty_state.message"):void 0,"empty-state-cta-to":_("KUMA_ZONE_CREATION_FLOW")==="enabled"?{name:"zone-create-view"}:void 0,"empty-state-cta-text":_("KUMA_ZONE_CREATION_FLOW")==="enabled"?t("zones.index.create"):void 0,onChange:V.update},{name:e(({row:o,rowValue:k})=>[s(z,{to:o.detailViewRoute,"data-testid":"detail-view-link"},{default:e(()=>[n(l(k),1)]),_:2},1032,["to"])]),zoneCpVersion:e(({rowValue:o})=>[n(l(o||t("common.collection.none")),1)]),type:e(({rowValue:o})=>[n(l(o||t("common.collection.none")),1)]),status:e(({rowValue:o})=>[o?(i(),r(U,{key:0,status:o},null,8,["status"])):(i(),O(I,{key:1},[n(l(t("common.collection.none")),1)],64))]),warnings:e(({rowValue:o})=>[o?(i(),r(a(ee),{key:0,label:t("zone-cps.list.version_mismatch")},{default:e(()=>[s(se,{class:"mr-1",size:a(R),"hide-title":""},null,8,["size"])]),_:2},1032,["label"])):(i(),O(I,{key:1},[n(l(t("common.collection.none")),1)],64))]),actions:e(({row:o})=>[s(a(te),{class:"actions-dropdown","data-testid":"actions-dropdown","kpop-attributes":{placement:"bottomEnd",popoverClasses:"mt-5 more-actions-popover"},width:"150"},{default:e(()=>[s(a(M),{class:"non-visual-button",appearance:"secondary",size:"small"},{icon:e(()=>[s(a(oe),{color:a(W),icon:"more",size:a(R)},null,8,["color","size"])]),_:1})]),items:e(()=>[s(a(S),{item:{to:o.detailViewRoute,label:t("common.collection.actions.view")}},null,8,["item"]),n(),f("create zones")?(i(),r(a(S),{key:0,"has-divider":"","is-dangerous":"","data-testid":"dropdown-delete-item",onClick:k=>B(o.name)},{default:e(()=>[n(l(t("common.collection.actions.delete")),1)]),_:2},1032,["onClick"])):A("",!0)]),_:2},1024)]),_:2},1032,["page-number","page-size","total","items","error","empty-state-title","empty-state-message","empty-state-cta-to","empty-state-cta-text","onChange"])]),_:2},1024),n(),u.value?(i(),r(ie,{key:0,"confirmation-text":d.value,"delete-function":E,"is-visible":u.value,"modal-id":"delete-zone-modal","action-button-text":t("zones.delete.confirmModal.proceedText"),title:t("zones.delete.confirmModal.title"),onCancel:w,onDelete:()=>{w(),C()}},{"body-content":e(()=>[T("p",null,l(t("zones.delete.confirmModal.text1",{zoneName:d.value})),1),n(),T("p",null,l(t("zones.delete.confirmModal.text2")),1)]),error:e(()=>[n(l(t("zones.delete.confirmModal.errorText")),1)]),_:2},1032,["confirmation-text","is-visible","action-button-text","title","onDelete"])):A("",!0)]),_:2},1032,["src"])):(i(),r(ne,{key:0}))]),_:2},[f("create zones")&&b.value?{name:"actions",fn:e(()=>[s(a(M),{appearance:"primary",icon:"plus",to:{name:"zone-create-view"},"data-testid":"create-zone-link"},{default:e(()=>[n(l(t("zones.index.create")),1)]),_:2},1024)]),key:"0"}:void 0]),1024)]),_:1})}}});const pe=X(le,[["__scopeId","data-v-225a5ad3"]]);export{pe as default};
