import{d as B,c as S,r as z,o as s,a as n,w as i,k as P,g as r,h as f,t as F,f as O,e as N,F as E,b as I,u as R,q as T}from"./index-bdbf5b57.js";import{q as W}from"./kongponents.es-21ce59a5.js";import{D as G,a as $}from"./DefinitionListItem-310ce025.js";import{_ as Q}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-f1cf8b3f.js";import{S as J}from"./StatusBadge-c156d8c6.js";import{T as K}from"./TagList-af54ef62.js";import{T as M}from"./TextWithCopyButton-8088f9cb.js";import{g as V,f as H,i as U,A as X,h as Y,_ as Z}from"./RouteView.vue_vue_type_script_setup_true_lang-9e62d24f.js";import{D as ee}from"./DataPlaneList-9df1e968.js";import{_ as te}from"./RouteTitle.vue_vue_type_script_setup_true_lang-dcec85af.js";import{_ as ae}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-ee434af6.js";import{E as re}from"./ErrorBlock-b1fa7c54.js";import{Q as se}from"./QueryParameter-70743f73.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-5891fe23.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-dedd65ac.js";import"./DataOverview-43dcbd85.js";const le={class:"entity-section-list"},ne={class:"entity-title"},ie=B({__name:"ServiceSummary",props:{service:{type:Object,required:!0},externalService:{type:Object,required:!1,default:null}},setup(h){const e=h,t=V(),y=S(()=>({name:"service-detail-view",params:{service:e.service.name,mesh:e.service.mesh}})),_=S(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.networking.address:e.service.addressPort??null),g=S(()=>{var a;return e.service.serviceType==="external"&&e.externalService!==null?(a=e.externalService.networking.tls)!=null&&a.enabled?"Enabled":"Disabled":null}),l=S(()=>{var a,o;if(e.service.serviceType==="external")return null;{const u=((a=e.service.dataplanes)==null?void 0:a.online)??0,q=((o=e.service.dataplanes)==null?void 0:o.total)??0;return`${u} online / ${q} total`}}),c=S(()=>e.service.serviceType==="external"?null:e.service.status??null),x=S(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.tags:null);async function k(a){if(e.service.serviceType==="external"&&e.externalService!==null){const{mesh:o,name:u}=e.externalService;return await t.getExternalService({mesh:o,name:u},a)}else{const{mesh:o,name:u}=e.service;return await t.getServiceInsight({mesh:o,name:u},a)}}return(a,o)=>{const u=z("router-link");return s(),n(I(W),null,{body:i(()=>[P("div",le,[P("section",null,[P("h1",ne,[P("span",null,[r(`
              Service:

              `),f(M,{text:e.service.name},{default:i(()=>[f(u,{to:y.value},{default:i(()=>[r(F(e.service.name),1)]),_:1},8,["to"])]),_:1},8,["text"])]),r(),c.value?(s(),n(J,{key:0,status:c.value},null,8,["status"])):O("",!0)]),r(),f(G,{class:"mt-4"},{default:i(()=>[f($,{term:"Address"},{default:i(()=>[_.value!==null?(s(),N(E,{key:0},[r(F(_.value),1)],64)):(s(),N(E,{key:1},[r(`
                —
              `)],64))]),_:1}),r(),g.value!==null?(s(),n($,{key:0,term:"TLS"},{default:i(()=>[r(F(g.value),1)]),_:1})):O("",!0),r(),l.value!==null?(s(),n($,{key:1,term:"Data Plane Proxies"},{default:i(()=>[r(F(l.value),1)]),_:1})):O("",!0),r(),x.value!==null?(s(),n($,{key:2,term:"Tags"},{default:i(()=>[f(K,{tags:x.value},null,8,["tags"])]),_:1})):O("",!0)]),_:1})]),r(),f(Q,{id:"code-block-service","resource-fetcher":k,"resource-fetcher-watch-key":e.service.name,"is-searchable":"","show-copy-as-kubernetes-button":e.service.serviceType==="external"&&e.externalService!==null,"code-max-height":"250px"},null,8,["resource-fetcher-watch-key","show-copy-as-kubernetes-button"])])]),_:1})}}});const ce=H(ie,[["__scopeId","data-v-6b783de5"]]),oe=B({__name:"ServiceDetails",props:{service:{type:Object,required:!0},externalService:{type:Object,required:!1,default:null},dataPlaneOverviews:{type:Array,required:!1,default:null},dppFilterFields:{type:Object,required:!0},selectedDppName:{type:String,required:!1,default:null}},emits:["load-dataplane-overviews"],setup(h,{emit:e}){const t=h;function y(_,g){var c;(((c=t.service.serviceType)==null?void 0:c.startsWith("gateway"))??!1)||delete g.gateway,e("load-dataplane-overviews",_,g)}return(_,g)=>{var l;return s(),N(E,null,[f(ce,{service:t.service,"external-service":h.externalService},null,8,["service","external-service"]),r(),t.dataPlaneOverviews!==null?(s(),n(ee,{key:0,class:"mt-4","data-plane-overviews":t.dataPlaneOverviews,"dpp-filter-fields":t.dppFilterFields,"selected-dpp-name":t.selectedDppName,"is-gateway-view":((l=t.dataPlaneOverviews[0])==null?void 0:l.dataplane.networking.gateway)!==void 0,onLoadData:y},null,8,["data-plane-overviews","dpp-filter-fields","selected-dpp-name","is-gateway-view"])):O("",!0)],64)}}}),ue={class:"service-details"},Pe=B({__name:"ServiceDetailView",props:{selectedDppName:{type:String,required:!1,default:null}},setup(h){const e=h,t=V(),y=R(),{t:_}=U(),g={name:{description:"filter by name or parts of a name"},protocol:{description:"filter by “kuma.io/protocol” value"},tag:{description:"filter by tags (e.g. “tag: version:2”)"},zone:{description:"filter by “kuma.io/zone” value"}},l=T(null),c=T(null),x=T(null),k=T(!0),a=T(null);o();function o(){const v=se.get("filterFields"),w=v!==null?JSON.parse(v):{};u(0,w)}async function u(v,w={}){k.value=!0,a.value=null,l.value=null,c.value=null,x.value=null;const p=y.params.mesh,b=y.params.service;try{l.value=await t.getServiceInsight({mesh:p,name:b}),l.value.serviceType==="external"?c.value=await t.getExternalServiceByServiceInsightName(p,b):await q(v,w)}catch(m){m instanceof Error?a.value=m:console.error(m)}finally{k.value=!1}}async function q(v,w){const p=y.params.mesh,b=y.params.service;try{const m=j(b,v,w),d=await t.getAllDataplaneOverviewsFromMesh({mesh:p},m);x.value=d.items??[]}catch{x.value=null}}function j(v,w,p){const m=`kuma.io/service:${v}`,d={...p,offset:w,size:50};if(d.tag){const A=Array.isArray(d.tag)?d.tag:[d.tag],L=[];for(const[D,C]of A.entries())C.startsWith("kuma.io/service:")&&L.push(D);for(let D=L.length-1;D===0;D--)A.splice(L[D],1);d.tag=A.concat(m)}else d.tag=m;return d}return(v,w)=>(s(),n(Z,null,{default:i(({route:p})=>[f(te,{title:I(_)("services.routes.item.title",{name:p.params.service})},null,8,["title"]),r(),f(X,{breadcrumbs:[{to:{name:"services-list-view",params:{mesh:p.params.mesh}},text:I(_)("services.routes.item.breadcrumbs")}]},{default:i(()=>[P("div",ue,[k.value?(s(),n(Y,{key:0})):a.value!==null?(s(),n(re,{key:1,error:a.value},null,8,["error"])):l.value===null?(s(),n(ae,{key:2})):(s(),n(oe,{key:3,service:l.value,"data-plane-overviews":x.value,"external-service":c.value,"dpp-filter-fields":g,"selected-dpp-name":e.selectedDppName,onLoadDataplaneOverviews:q},null,8,["service","data-plane-overviews","external-service","selected-dpp-name"]))])]),_:2},1032,["breadcrumbs"])]),_:1}))}});export{Pe as default};
