import{_ as N,T as x,U as F,P as H,l as K,V as R,K as u,W as v,X as M,n as P,Y as G,Z as U,h as g,b as m,w as i,r as o,o as a,e as h,p as b,i as d,t as _,F as w,k,f as C}from"./index.f2463021.js";import{S as q,a as J}from"./SubscriptionHeader.a69b1f1e.js";import{M as Y}from"./MultizoneInfo.b5cefde3.js";import{C as j}from"./CodeBlock.f31221ad.js";import{g as X}from"./tableDataUtils.233f95a0.js";import{F as Q}from"./FrameSkeleton.2e66f46d.js";import{D as $}from"./DataOverview.e6547ee7.js";import{T as ee}from"./TabsWidget.817a2fd6.js";import{E as te}from"./EntityURLControl.210b712d.js";import{L as se}from"./LabelList.c9504cac.js";import{W as ne}from"./WarningsWidget.05a75c3e.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.79e60fc9.js";import"./ErrorBlock.6b7b6a0a.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.92dd8129.js";const ie={name:"ZonesView",components:{AccordionList:x,AccordionItem:F,FrameSkeleton:Q,DataOverview:$,TabsWidget:ee,LabelList:se,WarningsWidget:ne,CodeBlock:j,SubscriptionDetails:q,SubscriptionHeader:J,MultizoneInfo:Y,EntityURLControl:te},data(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,empty_state:{title:"No Data",message:"There are no Zones present."},tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Status",key:"status"},{label:"Name",key:"name"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Storage type",key:"storeType"},{label:"Ingress",key:"hasIngress"},{label:"Egress",key:"hasEgress"},{key:"warnings",hideLabel:!0}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#insights",title:"Zone Insights"},{hash:"#config",title:"Config"},{hash:"#warnings",title:"Warnings"}],entity:{},pageSize:H,next:null,warnings:[],subscriptionsReversed:[],codeOutput:null,zonesWithIngress:new Set}},computed:{...K({multicluster:"config/getMulticlusterStatus",globalCpVersion:"config/getVersion"})},watch:{$route(){this.isLoading=!0,this.isEmpty=!1,this.hasError=!1,this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,this.tableDataIsEmpty=!1,this.init()}},beforeMount(){this.init()},methods:{init(){this.multicluster&&this.loadData()},filterTabs(){return this.warnings.length?this.tabs:this.tabs.filter(s=>s.hash!=="#warnings")},tableAction(s){const t=s;this.getEntity(t)},parseData(s){const{zoneInsight:t={},name:n}=s;let r="-",e="",p=!0;return t.subscriptions&&t.subscriptions.length&&t.subscriptions.forEach(l=>{if(l.version&&l.version.kumaCp){r=l.version.kumaCp.version;const{kumaCpGlobalCompatible:y=!0}=l.version.kumaCp;p=y,l.config&&(e=JSON.parse(l.config).store.type)}}),{...s,status:R(t).status,zoneCpVersion:r,storeType:e,hasIngress:this.zonesWithIngress.has(n)?"Yes":"No",hasEgress:this.zonesWithEgress.has(n)?"Yes":"No",withWarnings:!p}},calculateZonesWithIngress(s){const t=new Set;s.forEach(({zoneIngress:{zone:n}})=>{t.add(n)}),this.zonesWithIngress=t},calculateZonesWithEgress(s){const t=new Set;s.forEach(({zoneEgress:{zone:n}})=>{t.add(n)}),this.zonesWithEgress=t},async loadData(s="0"){this.isLoading=!0,this.isEmpty=!1;const t=this.$route.query.ns||null;try{const[{data:n,next:r},{items:e},{items:p}]=await Promise.all([X({getSingleEntity:u.getZoneOverview.bind(u),getAllEntities:u.getAllZoneOverviews.bind(u),size:this.pageSize,offset:s,query:t}),v({callEndpoint:u.getAllZoneIngressOverviews.bind(u)}),v({callEndpoint:u.getAllZoneEgressOverviews.bind(u)})]);this.next=r,n.length?(this.calculateZonesWithIngress(e),this.calculateZonesWithEgress(p),this.tableData.data=n.map(this.parseData),this.tableDataIsEmpty=!1,this.isEmpty=!1,this.getEntity({name:n[0].name})):(this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.entityIsEmpty=!0)}catch(n){this.hasError=!0,this.isEmpty=!0,console.error(n)}finally{this.isLoading=!1}},async getEntity(s){this.entityIsLoading=!0,this.entityIsEmpty=!0;const t=["type","name"],n=setTimeout(()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1},"500");if(s){this.entityIsEmpty=!1,this.warnings=[];try{const r=await u.getZoneOverview({name:s.name}),e=M(r,"zoneInsight.subscriptions",[]);if(this.entity={...P(r,t),"Authentication Type":G(r)},this.subscriptionsReversed=Array.from(e).reverse(),e.length){const{version:p={}}=e[e.length-1],{kumaCp:l={}}=p,y=l.version||"-",{kumaCpGlobalCompatible:E=!0}=l;E||this.warnings.push({kind:U,payload:{zoneCpVersion:y,globalCpVersion:this.globalCpVersion}}),e[e.length-1].config&&(this.codeOutput=JSON.stringify(JSON.parse(e[e.length-1].config),null,2))}}catch(r){console.error(r),this.entity={},this.entityHasError=!0,this.entityIsEmpty=!0}finally{clearTimeout(n)}}this.entityIsLoading=!1}}},oe={class:"zones"},ae=d("span",{class:"custom-control-icon"}," \u2190 ",-1),re=C(" View All "),le={key:0},ce={key:1},pe={key:2};function he(s,t,n,r,e,p){const l=o("MultizoneInfo"),y=o("KButton"),E=o("DataOverview"),L=o("EntityURLControl"),S=o("KBadge"),D=o("LabelList"),z=o("SubscriptionHeader"),A=o("SubscriptionDetails"),W=o("AccordionItem"),O=o("AccordionList"),I=o("KCard"),T=o("CodeBlock"),Z=o("WarningsWidget"),V=o("TabsWidget"),B=o("FrameSkeleton");return a(),g("div",oe,[s.multicluster===!1?(a(),m(l,{key:0})):(a(),m(B,{key:1},{default:i(()=>[h(E,{"page-size":e.pageSize,"has-error":e.hasError,"is-loading":e.isLoading,"empty-state":e.empty_state,"table-data":e.tableData,"table-data-is-empty":e.tableDataIsEmpty,"show-warnings":e.tableData.data.some(c=>c.withWarnings),next:e.next,onTableAction:p.tableAction,onLoadData:t[0]||(t[0]=c=>p.loadData(c))},{additionalControls:i(()=>[s.$route.query.ns?(a(),m(y,{key:0,class:"back-button",appearance:"primary",to:{name:"zones"}},{default:i(()=>[ae,re]),_:1})):b("",!0)]),_:1},8,["page-size","has-error","is-loading","empty-state","table-data","table-data-is-empty","show-warnings","next","onTableAction"]),e.isEmpty===!1?(a(),m(V,{key:0,"has-error":e.hasError,"is-loading":e.isLoading,tabs:p.filterTabs(),"initial-tab-override":"overview"},{tabHeader:i(()=>[d("div",null,[d("h3",null," Zone: "+_(e.entity.name),1)]),d("div",null,[h(L,{name:e.entity.name},null,8,["name"])])]),overview:i(()=>[h(D,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:i(()=>[d("div",null,[d("ul",null,[(a(!0),g(w,null,k(e.entity,(c,f)=>(a(),g("li",{key:f},[c?(a(),g("h4",le,_(f),1)):b("",!0),f==="status"?(a(),g("p",ce,[h(S,{appearance:c==="Offline"?"danger":"success"},{default:i(()=>[C(_(c),1)]),_:2},1032,["appearance"])])):(a(),g("p",pe,_(c),1))]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])]),insights:i(()=>[h(I,{"border-variant":"noBorder"},{body:i(()=>[h(O,{"initially-open":0},{default:i(()=>[(a(!0),g(w,null,k(e.subscriptionsReversed,(c,f)=>(a(),m(W,{key:f},{"accordion-header":i(()=>[h(z,{details:c},null,8,["details"])]),"accordion-content":i(()=>[h(A,{details:c},null,8,["details"])]),_:2},1024))),128))]),_:1})]),_:1})]),config:i(()=>[e.codeOutput?(a(),m(I,{key:0,"border-variant":"noBorder"},{body:i(()=>[h(T,{language:"json",code:e.codeOutput},null,8,["code"])]),_:1})):b("",!0)]),warnings:i(()=>[h(Z,{warnings:e.warnings},null,8,["warnings"])]),_:1},8,["has-error","is-loading","tabs"])):b("",!0)]),_:1}))])}const Le=N(ie,[["render",he]]);export{Le as default};
