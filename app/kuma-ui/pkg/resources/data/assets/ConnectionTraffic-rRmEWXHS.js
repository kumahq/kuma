import{_ as C,r as k,p as v,o as d,w as y,l as o,e as r,a as x,d as M,k as P,c,q as b,t as n,N as m,L as S,m as a,n as D,b as F}from"./index-CHUyLuna.js";import{T as L}from"./TagList-m8GBpf7x.js";const X=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],G=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],Y=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],U=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],q=(s,t,i)=>{let u=s;return typeof t=="string"||Array.isArray(t)?u=s.toLocaleString(t,i):(t===!0||i!==void 0)&&(u=s.toLocaleString(void 0,i)),u},I=s=>{if(typeof s=="number")return Math.log10(s);const t=s.toString(10);return t.length+Math.log10("0."+t.slice(0,15))},V=s=>typeof s=="number"?Math.log(s):I(s)*Math.log(10),Z=(s,t)=>{if(typeof s=="number")return s/t;const i=s/BigInt(t),u=s%BigInt(t);return Number(i)+Number(u)/t};function B(s,t){if(typeof s!="bigint"&&!Number.isFinite(s))throw new TypeError(`Expected a finite number, got ${typeof s}: ${s}`);t={bits:!1,binary:!1,space:!0,...t};const i=t.bits?t.binary?U:Y:t.binary?G:X,u=t.space?" ":"";if(t.signed&&(typeof s=="number"?s===0:s===0n))return` 0${u}${i[0]}`;const p=s<0,e=p?"-":t.signed?"+":"";p&&(s=-s);let f;if(t.minimumFractionDigits!==void 0&&(f={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(f={maximumFractionDigits:t.maximumFractionDigits,...f}),s<1){const g=q(s,t.locale,f);return e+g+u+i[0]}const _=Math.min(Math.floor(t.binary?V(s)/Math.log(1024):I(s)/3),i.length-1);if(s=Z(s,(t.binary?1024:1e3)**_),!f){const g=Math.max(3,Number.parseInt(s,10).toString().length);s=s.toPrecision(g)}const l=q(Number(s),t.locale,f),$=i[_];return e+l+u+$}const A={},j={class:"card"},z={class:"title"},K={class:"body"};function W(s,t){const i=k("XCard");return d(),v(i,{class:"data-card"},{default:y(()=>[o("dl",null,[o("div",j,[o("dt",z,[x(s.$slots,"title",{},void 0,!0)]),t[0]||(t[0]=r()),o("dd",K,[x(s.$slots,"default",{},void 0,!0)])])])]),_:3})}const w=C(A,[["render",W],["__scopeId","data-v-719ec237"]]),H={class:"title"},J={key:0},Q={key:1},R={"data-testid":"grpc-success"},O={"data-testid":"grpc-failure"},h={"data-testid":"rq-2xx"},tt={"data-testid":"rq-4xx"},et={"data-testid":"rq-5xx"},it={"data-testid":"connections-total"},st={key:0,"data-testid":"bytes-received"},ot={key:1,"data-testid":"bytes-sent"},rt=M({__name:"ConnectionCard",props:{protocol:{},service:{default:""},traffic:{default:void 0},direction:{default:"downstream"},portName:{default:void 0}},setup(s){const{t}=P(),i=s,u=p=>{const e=p.target;if(p.isTrusted&&e.nodeName.toLowerCase()!=="a"){const f=e.closest(".service-traffic-card, a");if(f){const _=f.nodeName.toLowerCase()==="a"?f:f.querySelector("[data-action]");_!==null&&"click"in _&&typeof _.click=="function"&&_.click()}}};return(p,e)=>{const f=k("XBadge"),_=k("XProgress");return d(),v(w,{class:"service-traffic-card",onClick:u},{title:y(()=>[i.service.length>0?(d(),v(L,{key:0,tags:[{label:"kuma.io/service",value:i.service}]},null,8,["tags"])):b("",!0),e[1]||(e[1]=r()),o("div",H,[i.protocol!==""?(d(),v(f,{key:0,class:"protocol",appearance:i.protocol==="passthrough"?"success":"info"},{default:y(()=>[r(n(a(t)(`data-planes.components.service_traffic_card.protocol.${i.protocol}`,{},{defaultMessage:a(t)(`http.api.value.${i.protocol}`)})),1)]),_:1},8,["appearance"])):b("",!0),e[0]||(e[0]=r()),x(p.$slots,"default",{},void 0,!0)])]),default:y(()=>[e[24]||(e[24]=r()),i.portName?(d(),c("dl",J,[o("div",null,[e[2]||(e[2]=o("dt",null,"Name",-1)),e[3]||(e[3]=r()),o("dd",null,n(i.portName),1)])])):b("",!0),e[25]||(e[25]=r()),i.traffic?(d(),c("dl",Q,[i.protocol==="passthrough"?(d(!0),c(m,{key:0},S([["http","tcp"].reduce((l,$)=>{const g=i.direction;return Object.entries(i.traffic?.[$]||{}).reduce((N,[T,E])=>[`${g}_cx_tx_bytes_total`,`${g}_cx_rx_bytes_total`].includes(T)?{...N,[T]:E+(N[T]??0)}:N,l)},{})],(l,$)=>(d(),c(m,{key:$},[o("div",null,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.tx")),1),e[4]||(e[4]=r()),o("dd",null,n(a(B)(l.downstream_cx_rx_bytes_total??0)),1)]),e[6]||(e[6]=r()),o("div",null,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.rx")),1),e[5]||(e[5]=r()),o("dd",null,n(a(B)(l.downstream_cx_tx_bytes_total??0)),1)])],64))),128)):i.protocol==="grpc"?(d(),c(m,{key:1},[o("div",R,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.grpc_success")),1),e[7]||(e[7]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:i.traffic.grpc?.success})),1)]),e[9]||(e[9]=r()),o("div",O,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.grpc_failure")),1),e[8]||(e[8]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:i.traffic.grpc?.failure})),1)])],64)):i.protocol.startsWith("http")?(d(),c(m,{key:2},[(d(!0),c(m,null,S([i.traffic.http?.[`${i.direction}_rq_1xx`]??0].filter(l=>l!==0),l=>(d(),c("div",{key:l,"data-testid":"rq-1xx"},[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.1xx")),1),e[10]||(e[10]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:l})),1)]))),128)),e[15]||(e[15]=r()),o("div",h,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.2xx")),1),e[11]||(e[11]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:i.traffic.http?.[`${i.direction}_rq_2xx`]})),1)]),e[16]||(e[16]=r()),(d(!0),c(m,null,S([i.traffic.http?.[`${i.direction}_rq_3xx`]??0].filter(l=>l!==0),l=>(d(),c("div",{key:l,"data-testid":"rq-3xx"},[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.3xx")),1),e[12]||(e[12]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:l})),1)]))),128)),e[17]||(e[17]=r()),o("div",tt,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.4xx")),1),e[13]||(e[13]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:i.traffic.http?.[`${i.direction}_rq_4xx`]})),1)]),e[18]||(e[18]=r()),o("div",et,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.5xx")),1),e[14]||(e[14]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:i.traffic.http?.[`${i.direction}_rq_5xx`]})),1)])],64)):(d(),c(m,{key:3},[o("div",it,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.cx")),1),e[19]||(e[19]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:i.traffic.tcp?.[`${i.direction}_cx_total`]})),1)]),e[22]||(e[22]=r()),typeof i.traffic.tcp?.[`${i.direction}_cx_tx_bytes_total`]<"u"?(d(),c("div",st,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.rx")),1),e[20]||(e[20]=r()),o("dd",null,n(a(B)(i.traffic.tcp?.[`${i.direction}_cx_tx_bytes_total`])),1)])):b("",!0),e[23]||(e[23]=r()),typeof i.traffic.tcp?.[`${i.direction}_cx_rx_bytes_total`]<"u"?(d(),c("div",ot,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.tx")),1),e[21]||(e[21]=r()),o("dd",null,n(a(B)(i.traffic.tcp?.[`${i.direction}_cx_rx_bytes_total`])),1)])):b("",!0)],64))])):(d(),v(_,{key:2,variant:"line"}))]),_:3})}}}),pt=C(rt,[["__scopeId","data-v-a3f939b9"]]),nt={class:"body"},at=M({__name:"ConnectionGroup",props:{type:{}},setup(s){const t=s;return(i,u)=>{const p=k("XCard");return d(),v(p,{class:D(["service-traffic-group",`type-${t.type}`])},{default:y(()=>[o("div",nt,[x(i.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}}),_t=C(at,[["__scopeId","data-v-25c74403"]]),dt={class:"service-traffic"},lt={class:"actions"},ct=M({__name:"ConnectionTraffic",setup(s){return(t,i)=>(d(),c("div",dt,[o("div",lt,[x(t.$slots,"actions",{},void 0,!0)]),i[0]||(i[0]=r()),F(w,{class:"header"},{title:y(()=>[x(t.$slots,"title",{},void 0,!0)]),_:3}),i[1]||(i[1]=r()),x(t.$slots,"default",{},void 0,!0)]))}}),mt=C(ct,[["__scopeId","data-v-e6bd176c"]]);export{mt as C,_t as a,pt as b};
