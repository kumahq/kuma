import{_ as P,U as x,V as F,P as H,k as R,W as M,K as h,X as w,Y as G,l as U,Z as q,$ as J,o as a,f as m,b as d,w as t,d as l,n as b,h as g,t as _,F as C,j as k,e as I,r as o}from"./index.b4c50a9a.js";import{S as Y,a as j}from"./SubscriptionHeader.b4efae60.js";import{M as X}from"./MultizoneInfo.1fc9a226.js";import{C as Q}from"./CodeBlock.250aca45.js";import{g as $}from"./tableDataUtils.d6a29fca.js";import{F as ee}from"./FrameSkeleton.04ef524c.js";import{D as te}from"./DataOverview.57d630c5.js";import{T as se}from"./TabsWidget.a658e878.js";import{E as ne}from"./EntityURLControl.cf60ee76.js";import{L as oe}from"./LabelList.2e2a2df8.js";import{W as ie}from"./WarningsWidget.f18ade49.js";import"./ErrorBlock.63ee7be4.js";const ae={name:"ZonesView",components:{AccordionList:x,AccordionItem:F,FrameSkeleton:ee,DataOverview:te,TabsWidget:se,LabelList:oe,WarningsWidget:ie,CodeBlock:Q,SubscriptionDetails:Y,SubscriptionHeader:j,MultizoneInfo:X,EntityURLControl:ne},data(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,empty_state:{title:"No Data",message:"There are no Zones present."},tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Status",key:"status"},{label:"Name",key:"name"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Storage type",key:"storeType"},{label:"Ingress",key:"hasIngress"},{label:"Egress",key:"hasEgress"},{key:"warnings",hideLabel:!0}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#insights",title:"Zone Insights"},{hash:"#config",title:"Config"},{hash:"#warnings",title:"Warnings"}],entity:{},pageSize:H,next:null,warnings:[],subscriptionsReversed:[],codeOutput:null,zonesWithIngress:new Set}},computed:{...R({multicluster:"config/getMulticlusterStatus",globalCpVersion:"config/getVersion"})},watch:{$route(){this.isLoading=!0,this.isEmpty=!1,this.hasError=!1,this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,this.tableDataIsEmpty=!1,this.init()}},beforeMount(){this.init()},methods:{init(){this.multicluster&&this.loadData()},filterTabs(){return this.warnings.length?this.tabs:this.tabs.filter(n=>n.hash!=="#warnings")},tableAction(n){const s=n;this.getEntity(s)},parseData(n){const{zoneInsight:s={},name:i}=n;let c="-",e="",u=!0;return s.subscriptions&&s.subscriptions.length&&s.subscriptions.forEach(p=>{if(p.version&&p.version.kumaCp){c=p.version.kumaCp.version;const{kumaCpGlobalCompatible:y=!0}=p.version.kumaCp;u=y,p.config&&(e=JSON.parse(p.config).store.type)}}),{...n,status:M(s).status,zoneCpVersion:c,storeType:e,hasIngress:this.zonesWithIngress.has(i)?"Yes":"No",hasEgress:this.zonesWithEgress.has(i)?"Yes":"No",withWarnings:!u}},calculateZonesWithIngress(n){const s=new Set;n.forEach(({zoneIngress:{zone:i}})=>{s.add(i)}),this.zonesWithIngress=s},calculateZonesWithEgress(n){const s=new Set;n.forEach(({zoneEgress:{zone:i}})=>{s.add(i)}),this.zonesWithEgress=s},async loadData(n="0"){this.isLoading=!0,this.isEmpty=!1;const s=this.$route.query.ns||null;try{const[{data:i,next:c},{items:e},{items:u}]=await Promise.all([$({getSingleEntity:h.getZoneOverview.bind(h),getAllEntities:h.getAllZoneOverviews.bind(h),size:this.pageSize,offset:n,query:s}),w({callEndpoint:h.getAllZoneIngressOverviews.bind(h)}),w({callEndpoint:h.getAllZoneEgressOverviews.bind(h)})]);this.next=c,i.length?(this.calculateZonesWithIngress(e),this.calculateZonesWithEgress(u),this.tableData.data=i.map(this.parseData),this.tableDataIsEmpty=!1,this.isEmpty=!1,this.getEntity({name:i[0].name})):(this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.entityIsEmpty=!0)}catch(i){this.hasError=!0,this.isEmpty=!0,console.error(i)}finally{this.isLoading=!1}},async getEntity(n){this.entityIsLoading=!0,this.entityIsEmpty=!0;const s=["type","name"],i=setTimeout(()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1},"500");if(n){this.entityIsEmpty=!1,this.warnings=[];try{const c=await h.getZoneOverview({name:n.name}),e=G(c,"zoneInsight.subscriptions",[]);if(this.entity={...U(c,s),"Authentication Type":q(c)},this.subscriptionsReversed=Array.from(e).reverse(),e.length){const{version:u={}}=e[e.length-1],{kumaCp:p={}}=u,y=p.version||"-",{kumaCpGlobalCompatible:E=!0}=p;E||this.warnings.push({kind:J,payload:{zoneCpVersion:y,globalCpVersion:this.globalCpVersion}}),e[e.length-1].config&&(this.codeOutput=JSON.stringify(JSON.parse(e[e.length-1].config),null,2))}}catch(c){console.error(c),this.entity={},this.entityHasError=!0,this.entityIsEmpty=!0}finally{clearTimeout(i)}}this.entityIsLoading=!1}}},re={class:"zones"},le=g("span",{class:"custom-control-icon"}," \u2190 ",-1),ce=I(" View All "),pe={key:0},ue={key:1},he={key:2},ge=I(" Copy config to clipboard "),me=g("div",null,[g("p",null,"Config copied to clipboard!")],-1);function de(n,s,i,c,e,u){const p=o("MultizoneInfo"),y=o("KButton"),E=o("DataOverview"),L=o("EntityURLControl"),S=o("KBadge"),D=o("LabelList"),z=o("SubscriptionHeader"),A=o("SubscriptionDetails"),O=o("AccordionItem"),W=o("AccordionList"),v=o("KCard"),T=o("CodeBlock"),Z=o("KPop"),V=o("KClipboardProvider"),B=o("WarningsWidget"),N=o("TabsWidget"),K=o("FrameSkeleton");return a(),m("div",re,[n.multicluster===!1?(a(),d(p,{key:0})):(a(),d(K,{key:1},{default:t(()=>[l(E,{"page-size":e.pageSize,"has-error":e.hasError,"is-loading":e.isLoading,"empty-state":e.empty_state,"table-data":e.tableData,"table-data-is-empty":e.tableDataIsEmpty,"show-warnings":e.tableData.data.some(r=>r.withWarnings),next:e.next,onTableAction:u.tableAction,onLoadData:s[0]||(s[0]=r=>u.loadData(r))},{additionalControls:t(()=>[n.$route.query.ns?(a(),d(y,{key:0,class:"back-button",appearance:"primary",to:{name:"zones"}},{default:t(()=>[le,ce]),_:1})):b("",!0)]),_:1},8,["page-size","has-error","is-loading","empty-state","table-data","table-data-is-empty","show-warnings","next","onTableAction"]),e.isEmpty===!1?(a(),d(N,{key:0,"has-error":e.hasError,"is-loading":e.isLoading,tabs:u.filterTabs(),"initial-tab-override":"overview"},{tabHeader:t(()=>[g("div",null,[g("h3",null," Zone: "+_(e.entity.name),1)]),g("div",null,[l(L,{name:e.entity.name},null,8,["name"])])]),overview:t(()=>[l(D,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:t(()=>[g("div",null,[g("ul",null,[(a(!0),m(C,null,k(e.entity,(r,f)=>(a(),m("li",{key:f},[r?(a(),m("h4",pe,_(f),1)):b("",!0),f==="status"?(a(),m("p",ue,[l(S,{appearance:r==="Offline"?"danger":"success"},{default:t(()=>[I(_(r),1)]),_:2},1032,["appearance"])])):(a(),m("p",he,_(r),1))]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])]),insights:t(()=>[l(v,{"border-variant":"noBorder"},{body:t(()=>[l(W,{"initially-open":0},{default:t(()=>[(a(!0),m(C,null,k(e.subscriptionsReversed,(r,f)=>(a(),d(O,{key:f},{"accordion-header":t(()=>[l(z,{details:r},null,8,["details"])]),"accordion-content":t(()=>[l(A,{details:r},null,8,["details"])]),_:2},1024))),128))]),_:1})]),_:1})]),config:t(()=>[e.codeOutput?(a(),d(v,{key:0,"border-variant":"noBorder"},{body:t(()=>[l(T,{language:"json",code:e.codeOutput},null,8,["code"])]),actions:t(()=>[e.codeOutput?(a(),d(V,{key:0},{default:t(({copyToClipboard:r})=>[l(Z,{placement:"bottom"},{content:t(()=>[me]),default:t(()=>[l(y,{appearance:"primary",onClick:()=>{r(e.codeOutput)}},{default:t(()=>[ge]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})):b("",!0)]),_:1})):b("",!0)]),warnings:t(()=>[l(B,{warnings:e.warnings},null,8,["warnings"])]),_:1},8,["has-error","is-loading","tabs"])):b("",!0)]),_:1}))])}const De=P(ae,[["render",de]]);export{De as default};
