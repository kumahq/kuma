import{_ as N,r as C,p as v,o as d,w as g,l as o,e as r,a as x,d as w,k as J,c,q as y,t as n,L as m,J as M,m as a,n as K,b as W}from"./index-Dq_FLkmZ.js";import{T as H}from"./TagList-Ct_aBoky.js";const Q=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],R=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],O=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],h=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],Z=(s,t,i)=>{let u=s;return typeof t=="string"||Array.isArray(t)?u=s.toLocaleString(t,i):(t===!0||i!==void 0)&&(u=s.toLocaleString(void 0,i)),u},A=s=>{if(typeof s=="number")return Math.log10(s);const t=s.toString(10);return t.length+Math.log10("0."+t.slice(0,15))},tt=s=>typeof s=="number"?Math.log(s):A(s)*Math.log(10),et=(s,t)=>{if(typeof s=="number")return s/t;const i=s/BigInt(t),u=s%BigInt(t);return Number(i)+Number(u)/t};function k(s,t){if(typeof s!="bigint"&&!Number.isFinite(s))throw new TypeError(`Expected a finite number, got ${typeof s}: ${s}`);t={bits:!1,binary:!1,space:!0,...t};const i=t.bits?t.binary?h:O:t.binary?R:Q,u=t.space?" ":"";if(t.signed&&(typeof s=="number"?s===0:s===0n))return` 0${u}${i[0]}`;const p=s<0,e=p?"-":t.signed?"+":"";p&&(s=-s);let f;if(t.minimumFractionDigits!==void 0&&(f={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(f={maximumFractionDigits:t.maximumFractionDigits,...f}),s<1){const B=Z(s,t.locale,f);return e+B+u+i[0]}const _=Math.min(Math.floor(t.binary?tt(s)/Math.log(1024):A(s)/3),i.length-1);s=et(s,(t.binary?1024:1e3)**_),f||(s=s.toPrecision(3));const $=Z(Number(s),t.locale,f),b=i[_];return e+$+u+b}const it={},st={class:"card"},ot={class:"title"},rt={class:"body"};function nt(s,t){const i=C("XCard");return d(),v(i,{class:"data-card"},{default:g(()=>[o("dl",null,[o("div",st,[o("dt",ot,[x(s.$slots,"title",{},void 0,!0)]),t[0]||(t[0]=r()),o("dd",rt,[x(s.$slots,"default",{},void 0,!0)])])])]),_:3})}const j=N(it,[["render",nt],["__scopeId","data-v-719ec237"]]),at={class:"title"},dt={key:0},lt={key:1},ct={"data-testid":"grpc-success"},ft={"data-testid":"grpc-failure"},ut={"data-testid":"rq-2xx"},pt={"data-testid":"rq-4xx"},_t={"data-testid":"rq-5xx"},mt={"data-testid":"connections-total"},xt={key:0,"data-testid":"bytes-received"},vt={key:1,"data-testid":"bytes-sent"},gt=w({__name:"ConnectionCard",props:{protocol:{},service:{default:""},traffic:{default:void 0},direction:{default:"downstream"},portName:{default:void 0}},setup(s){const{t}=J(),i=s,u=p=>{const e=p.target;if(p.isTrusted&&e.nodeName.toLowerCase()!=="a"){const f=e.closest(".service-traffic-card, a");if(f){const _=f.nodeName.toLowerCase()==="a"?f:f.querySelector("[data-action]");_!==null&&"click"in _&&typeof _.click=="function"&&_.click()}}};return(p,e)=>{const f=C("XBadge"),_=C("XProgress");return d(),v(j,{class:"service-traffic-card",onClick:u},{title:g(()=>[i.service.length>0?(d(),v(H,{key:0,tags:[{label:"kuma.io/service",value:i.service}]},null,8,["tags"])):y("",!0),e[1]||(e[1]=r()),o("div",at,[i.protocol!==""?(d(),v(f,{key:0,class:"protocol",appearance:i.protocol==="passthrough"?"success":"info"},{default:g(()=>[r(n(a(t)(`data-planes.components.service_traffic_card.protocol.${i.protocol}`,{},{defaultMessage:a(t)(`http.api.value.${i.protocol}`)})),1)]),_:1},8,["appearance"])):y("",!0),e[0]||(e[0]=r()),x(p.$slots,"default",{},void 0,!0)])]),default:g(()=>{var $,b,B,E,I,D,F,L,P,X,G,Y;return[e[24]||(e[24]=r()),i.portName?(d(),c("dl",dt,[o("div",null,[e[2]||(e[2]=o("dt",null,"Name",-1)),e[3]||(e[3]=r()),o("dd",null,n(i.portName),1)])])):y("",!0),e[25]||(e[25]=r()),i.traffic?(d(),c("dl",lt,[i.protocol==="passthrough"?(d(!0),c(m,{key:0},M([["http","tcp"].reduce((l,T)=>{var V;const U=i.direction;return Object.entries(((V=i.traffic)==null?void 0:V[T])||{}).reduce((S,[q,z])=>[`${U}_cx_tx_bytes_total`,`${U}_cx_rx_bytes_total`].includes(q)?{...S,[q]:z+(S[q]??0)}:S,l)},{})],(l,T)=>(d(),c(m,{key:T},[o("div",null,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.tx")),1),e[4]||(e[4]=r()),o("dd",null,n(a(k)(l.downstream_cx_rx_bytes_total??0)),1)]),e[6]||(e[6]=r()),o("div",null,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.rx")),1),e[5]||(e[5]=r()),o("dd",null,n(a(k)(l.downstream_cx_tx_bytes_total??0)),1)])],64))),128)):i.protocol==="grpc"?(d(),c(m,{key:1},[o("div",ct,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.grpc_success")),1),e[7]||(e[7]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:($=i.traffic.grpc)==null?void 0:$.success})),1)]),e[9]||(e[9]=r()),o("div",ft,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.grpc_failure")),1),e[8]||(e[8]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:(b=i.traffic.grpc)==null?void 0:b.failure})),1)])],64)):i.protocol.startsWith("http")?(d(),c(m,{key:2},[(d(!0),c(m,null,M([((B=i.traffic.http)==null?void 0:B[`${i.direction}_rq_1xx`])??0].filter(l=>l!==0),l=>(d(),c("div",{key:l,"data-testid":"rq-1xx"},[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.1xx")),1),e[10]||(e[10]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:l})),1)]))),128)),e[15]||(e[15]=r()),o("div",ut,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.2xx")),1),e[11]||(e[11]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:(E=i.traffic.http)==null?void 0:E[`${i.direction}_rq_2xx`]})),1)]),e[16]||(e[16]=r()),(d(!0),c(m,null,M([((I=i.traffic.http)==null?void 0:I[`${i.direction}_rq_3xx`])??0].filter(l=>l!==0),l=>(d(),c("div",{key:l,"data-testid":"rq-3xx"},[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.3xx")),1),e[12]||(e[12]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:l})),1)]))),128)),e[17]||(e[17]=r()),o("div",pt,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.4xx")),1),e[13]||(e[13]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:(D=i.traffic.http)==null?void 0:D[`${i.direction}_rq_4xx`]})),1)]),e[18]||(e[18]=r()),o("div",_t,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.5xx")),1),e[14]||(e[14]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:(F=i.traffic.http)==null?void 0:F[`${i.direction}_rq_5xx`]})),1)])],64)):(d(),c(m,{key:3},[o("div",mt,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.cx")),1),e[19]||(e[19]=r()),o("dd",null,n(a(t)("common.formats.integer",{value:(L=i.traffic.tcp)==null?void 0:L[`${i.direction}_cx_total`]})),1)]),e[22]||(e[22]=r()),typeof((P=i.traffic.tcp)==null?void 0:P[`${i.direction}_cx_tx_bytes_total`])<"u"?(d(),c("div",xt,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.rx")),1),e[20]||(e[20]=r()),o("dd",null,n(a(k)((X=i.traffic.tcp)==null?void 0:X[`${i.direction}_cx_tx_bytes_total`])),1)])):y("",!0),e[23]||(e[23]=r()),typeof((G=i.traffic.tcp)==null?void 0:G[`${i.direction}_cx_rx_bytes_total`])<"u"?(d(),c("div",vt,[o("dt",null,n(a(t)("data-planes.components.service_traffic_card.tx")),1),e[21]||(e[21]=r()),o("dd",null,n(a(k)((Y=i.traffic.tcp)==null?void 0:Y[`${i.direction}_cx_rx_bytes_total`])),1)])):y("",!0)],64))])):(d(),v(_,{key:2,variant:"line"}))]}),_:3})}}}),Tt=N(gt,[["__scopeId","data-v-a3f939b9"]]),yt={class:"body"},$t=w({__name:"ConnectionGroup",props:{type:{}},setup(s){const t=s;return(i,u)=>{const p=C("XCard");return d(),v(p,{class:K(["service-traffic-group",`type-${t.type}`])},{default:g(()=>[o("div",yt,[x(i.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}}),St=N($t,[["__scopeId","data-v-25c74403"]]),bt={class:"service-traffic"},Bt={class:"actions"},kt=w({__name:"ConnectionTraffic",setup(s){return(t,i)=>(d(),c("div",bt,[o("div",Bt,[x(t.$slots,"actions",{},void 0,!0)]),i[0]||(i[0]=r()),W(j,{class:"header"},{title:g(()=>[x(t.$slots,"title",{},void 0,!0)]),_:3}),i[1]||(i[1]=r()),x(t.$slots,"default",{},void 0,!0)]))}}),qt=N(kt,[["__scopeId","data-v-e6bd176c"]]);export{qt as C,St as a,Tt as b};
