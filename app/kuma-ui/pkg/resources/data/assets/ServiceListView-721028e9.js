import{d as E,u as C,r,v as L,e as g,w,B as T,o as _,g as z,b as B,f as R}from"./index-6ef061d4.js";import{S as V}from"./ServiceSummary-81875500.js";import{C as q}from"./ContentWrapper-09c5378f.js";import{D as F}from"./DataOverview-273e56b2.js";import{u as M}from"./index-8eaa4fe5.js";import{Q as k}from"./QueryParameter-70743f73.js";import"./kongponents.es-5ca9e130.js";import"./DefinitionListItem-97bb646e.js";import"./ErrorBlock-5ce00c3e.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-431ef500.js";import"./StatusBadge-310603a4.js";import"./TagList-2830199d.js";import"./store-444aa12f.js";import"./YamlView.vue_vue_type_script_setup_true_lang-f94f7cbc.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-cadc6770.js";import"./toYaml-4e00099e.js";import"./datadogLogEvents-302eea7b.js";const se=E({__name:"ServiceListView",props:{selectedServiceName:{type:String,required:!1,default:null},offset:{type:Number,required:!1,default:0}},setup(A){const m=A,u=M(),P=[{label:"Service",key:"name"},{label:"Type",key:"serviceType"},{label:"Address",key:"addressPort"},{label:"Status",key:"status"},{label:"DP proxies (online / total)",key:"dpProxiesStatus"}],D={title:"No Data",message:"There are no service insights present."},c=C(),p=r(!0),v=r(null),S=r(null),x=r(m.offset),l=r(null),b=r(null),o=r({headers:P,data:[]});L(()=>c.params.mesh,function(){c.name==="service-list-view"&&d(0)}),d(m.offset);async function d(e){x.value=e,k.set("offset",e>0?e:null),p.value=!0,v.value=null;const t=c.params.mesh,s=T;try{const{items:a,next:f}=await u.getAllServiceInsightsFromMesh({mesh:t},{size:s,offset:e});if(S.value=f,Array.isArray(a)&&a.length>0){a.sort((n,i)=>n.name>i.name?1:n.name<i.name?-1:0),o.value.data=a.map(n=>N(n));const y=m.selectedServiceName??a[0].name;await h({name:y,mesh:t})}else o.value.data=[]}catch(a){a instanceof Error?v.value=a:console.error(a)}finally{p.value=!1}}function N(e){const t={name:"service-detail-view",params:{mesh:e.mesh,service:e.name}},s={name:"mesh-detail-view",params:{mesh:e.mesh}};let a="â€”";if(e.dataplanes){const{online:n=0,total:i=0}=e.dataplanes;a=`${n} / ${i}`}const f=e.addressPort,y=e.serviceType??"internal";return{...e,serviceType:y,nameRoute:t,meshRoute:s,dpProxiesStatus:a,addressPort:f}}async function h({mesh:e,name:t}){l.value=await u.getServiceInsight({mesh:e,name:t}),l.value.serviceType==="external"&&(b.value=await u.getExternalServiceByServiceInsightName(e,t)),k.set("service",t)}return(e,t)=>(_(),g(q,null,{content:w(()=>{var s;return[z(F,{"selected-entity-name":(s=l.value)==null?void 0:s.name,"page-size":B(T),error:v.value,"is-loading":p.value,"empty-state":D,"table-data":o.value,"table-data-is-empty":o.value.data.length===0,next:S.value,"page-offset":x.value,onTableAction:h,onLoadData:d},null,8,["selected-entity-name","page-size","error","is-loading","table-data","table-data-is-empty","next","page-offset"])]}),sidebar:w(()=>[l.value!==null?(_(),g(V,{key:0,service:l.value,"external-service":b.value},null,8,["service","external-service"])):R("",!0)]),_:1}))}});export{se as default};
