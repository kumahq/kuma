import{d as L,a2 as tt,r as f,p,o,w as t,b as e,m as D,a3 as at,c as m,e as n,N as y,L as _,q as w,O as k,T as et,l as I,t as r,a4 as nt,M as q,a5 as ot,y as st,_ as it}from"./index-DzjyxUQd.js";import{T as dt}from"./TagList-wF-z4hU5.js";import{C as P,a as V,b as A}from"./ConnectionTraffic-qIMApd9r.js";const rt=L({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(j){const E=tt(),i=j;return(pt,a)=>{const x=f("XI18n"),T=f("XNotification"),X=f("XIcon"),R=f("DataCollection"),c=f("XLayout"),h=f("XAction"),v=f("XBadge"),S=f("XCopyButton"),K=f("XAboutCard"),O=f("XEmptyState"),M=f("XInputSwitch"),F=f("XProgress"),G=f("XCard"),U=f("XDrawer"),Z=f("RouterView"),H=f("AppView"),J=f("DataSource"),Q=f("RouteView");return o(),p(Q,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:t(({route:b,t:l,can:$,uri:W})=>[e(J,{src:W(D(at),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[b.params.proxyType]??"dataplane",name:b.params.proxy,mesh:b.params.mesh||"*",socketAddress:i.data.dataplane.networking.inboundAddress})},{default:t(({data:C,error:B,refresh:Y})=>[e(H,{notifications:!0},{default:t(()=>[(o(!0),m(y,null,_([{bool:i.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:i.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:i.data.dataplaneInsight.version?.envoy.version??"",kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!($("use zones")&&i.data.zone&&i.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:i.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:i.data.isCertExpired,key:"certificate-expired"},{bool:!i.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!!B,key:"stats-not-enhanced",params:{error:B?.toString()??""}},{bool:!$("use transparent-proxying",i.data),key:"networking-transparent-proxying",variant:"info"}],({bool:s,key:d,params:u,variant:g})=>(o(),p(T,{key:d,notify:s,"data-testid":`warning-${d}`,uri:`data-planes.notifications.${d}.${i.data.id}`,variant:g},{default:t(()=>[e(x,{path:`data-planes.notifications.${d}`,params:Object.fromEntries(Object.entries(u??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),a[49]||(a[49]=n()),e(c,{type:"stack","data-testid":"dataplane-details"},{default:t(()=>[e(K,{title:l("data-planes.routes.item.about.title"),created:i.data.creationTime,modified:i.data.modificationTime,class:"about-section"},{default:t(()=>[e(c,null,{default:t(()=>[e(c,{type:"separated"},{default:t(()=>[e(k,{layout:"horizontal"},{title:t(()=>[n(r(l("http.api.property.status")),1)]),body:t(()=>[e(c,{type:"separated"},{default:t(()=>[e(et,{status:i.data.status},null,8,["status"]),a[0]||(a[0]=n()),i.data.dataplaneType==="standard"?(o(),p(R,{key:0,items:i.data.dataplane.networking.inbounds,predicate:s=>s.state!=="Ready",empty:!1},{default:t(({items:s})=>[e(X,{name:"info"},{default:t(()=>[I("ul",null,[(o(!0),m(y,null,_(s,d=>(o(),m("li",{key:`${d.service}:${d.port}`},r(l("data-planes.routes.item.unhealthy_inbound",{port:d.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):w("",!0)]),_:2},1024)]),_:2},1024),a[7]||(a[7]=n()),$("use zones")&&i.data.zone?(o(),p(k,{key:0,layout:"horizontal"},{title:t(()=>[n(r(l("http.api.property.zone")),1)]),body:t(()=>[e(v,{appearance:"decorative"},{default:t(()=>[e(h,{to:{name:"zone-cp-detail-view",params:{zone:i.data.zone}}},{default:t(()=>[n(r(i.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2},1024)):w("",!0),a[8]||(a[8]=n()),e(k,{layout:"horizontal"},{title:t(()=>[n(r(l("http.api.property.type")),1)]),body:t(()=>[e(v,{appearance:"decorative"},{default:t(()=>[n(r(l(`data-planes.type.${i.data.dataplaneType}`)),1)]),_:2},1024)]),_:2},1024),a[9]||(a[9]=n()),i.data.namespace.length>0?(o(),p(k,{key:1,layout:"horizontal"},{title:t(()=>[n(r(l("http.api.property.namespace")),1)]),body:t(()=>[e(v,{appearance:"decorative"},{default:t(()=>[n(r(i.data.namespace),1)]),_:1})]),_:2},1024)):w("",!0),a[10]||(a[10]=n()),e(k,{layout:"horizontal"},{title:t(()=>[n(r(l("http.api.property.address")),1)]),body:t(()=>[e(S,{variant:"badge",format:"default",text:`${i.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024),a[11]||(a[11]=n()),i.data.dataplane.networking.gateway?(o(),p(k,{key:2,layout:"horizontal"},{title:t(()=>[n(r(l("http.api.property.tags")),1)]),body:t(()=>[e(dt,{tags:i.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024)):w("",!0)]),_:2},1024),a[29]||(a[29]=n()),i.data.dataplaneInsight.mTLS?(o(),p(c,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:t(()=>[I("h3",null,r(l("data-planes.routes.item.mtls.title")),1),a[21]||(a[21]=n()),e(c,{size:"small"},{default:t(()=>[(o(!0),m(y,null,_([i.data.dataplaneInsight.mTLS],s=>(o(),m(y,{key:s},[e(c,{type:"separated"},{default:t(()=>[typeof s.lastCertificateRegeneration<"u"&&typeof s.certificateExpirationTime<"u"&&typeof s.issuedBackend<"u"?(o(),m(y,{key:0},[e(k,{layout:"horizontal"},{title:t(()=>[e(x,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:t(()=>[e(v,{appearance:"neutral"},{default:t(()=>[n(r(l("common.formats.datetime",{value:Date.parse(s.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2},1024),a[14]||(a[14]=n()),e(k,{layout:"horizontal"},{title:t(()=>[e(x,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:t(()=>[e(v,{appearance:"neutral"},{default:t(()=>[n(r(l("common.formats.datetime",{value:Date.parse(s.certificateExpirationTime)})),1)]),_:2},1024)]),_:2},1024)],64)):(o(),p(x,{key:1,path:"data-planes.routes.item.mtls.managed_externally"}))]),_:2},1024),a[20]||(a[20]=n()),e(c,{type:"separated"},{default:t(()=>[typeof s.certificateRegenerations<"u"?(o(),p(k,{key:0,layout:"horizontal"},{title:t(()=>[n(r(l("data-planes.routes.item.mtls.regenerations.title")),1)]),body:t(()=>[e(v,{appearance:"info"},{default:t(()=>[n(r(l("common.formats.integer",{value:s.certificateRegenerations})),1)]),_:2},1024)]),_:2},1024)):w("",!0),a[18]||(a[18]=n()),s.issuedBackend?(o(),p(k,{key:1,layout:"horizontal"},{title:t(()=>[n(r(l("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:t(()=>[D(nt).isKriString(s.issuedBackend)?(o(),p(h,{key:0,to:{name:"data-plane-mesh-identity-summary-view",params:{mid:s.issuedBackend}}},{default:t(()=>[e(v,{appearance:"decorative"},{default:t(()=>[n(r(s.issuedBackend),1)]),_:2},1024)]),_:2},1032,["to"])):(o(),p(v,{key:1,appearance:"decorative"},{default:t(()=>[n(r(s.issuedBackend),1)]),_:2},1024))]),_:2},1024)):w("",!0),a[19]||(a[19]=n()),typeof s.supportedBackends<"u"?(o(),p(k,{key:2,layout:"horizontal"},{title:t(()=>[n(r(l("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:t(()=>[e(c,{type:"separated",truncate:""},{default:t(()=>[(o(!0),m(y,null,_(s.supportedBackends,d=>(o(),p(v,{key:d,appearance:d===s.issuedBackend?"decorative":"info"},{default:t(()=>[n(r(d),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2},1024)):w("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):w("",!0),a[30]||(a[30]=n()),i.data.dataplaneInsight.subscriptions.length>0?(o(),p(c,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:t(()=>[e(c,{type:"separated"},{default:t(()=>[I("h3",null,r(l("data-planes.routes.item.subscriptions.title")),1),a[22]||(a[22]=n()),e(h,{"data-action":"",appearance:"anchor",to:{name:"data-plane-subscriptions-summary-view",params:{mesh:b.params.mesh,proxy:b.params.proxy},query:{inactive:b.params.inactive}}},{default:t(()=>[n(`
                    (`+r(l("data-planes.routes.item.xds.show-details"))+`)
                  `,1)]),_:2},1032,["to"])]),_:2},1024),a[28]||(a[28]=n()),(o(!0),m(y,null,_([[...i.data.dataplaneInsight.subscriptions].reverse()],s=>(o(),p(c,{key:typeof s,type:"separated"},{default:t(()=>[(o(!0),m(y,null,_([s.find(d=>!d.disconnectTime)??s[0]],d=>(o(),m(y,{key:d.id},[!d.disconnectTime&&d.connectTime?(o(),m(y,{key:0},[e(k,{layout:"horizontal"},{title:t(()=>[e(x,{path:"data-planes.routes.item.xds.connected"})]),body:t(()=>[e(v,{appearance:"neutral"},{default:t(()=>[n(r(l("common.formats.datetime",{value:Date.parse(d.connectTime)})),1)]),_:2},1024)]),_:2},1024),a[26]||(a[26]=n()),e(k,{layout:"horizontal"},{title:t(()=>[e(x,{path:"data-planes.routes.item.xds.instance"})]),body:t(()=>[e(v,{appearance:"info"},{default:t(()=>[n(r(d.controlPlaneInstanceId),1)]),_:2},1024)]),_:2},1024),a[27]||(a[27]=n()),e(k,{layout:"horizontal"},{title:t(()=>[e(x,{path:"data-planes.routes.item.xds.version"})]),body:t(()=>[e(v,{appearance:"info"},{default:t(()=>[n(r(d.version?.kumaDp?.version??l("common.unknown")),1)]),_:2},1024)]),_:2},1024)],64)):(o(),p(x,{key:1,path:"data-planes.routes.item.xds.disconnected"}))],64))),128))]),_:2},1024))),128))]),_:2},1024)):w("",!0)]),_:2},1024)]),_:2},1032,["title","created","modified"]),a[47]||(a[47]=n()),e(G,{class:"traffic","data-testid":"dataplane-traffic"},{default:t(()=>[e(c,{type:"columns"},{default:t(()=>[e(P,null,{title:t(()=>[e(c,{type:"separated"},{default:t(()=>[e(X,{name:"inbound"}),a[31]||(a[31]=n()),a[32]||(a[32]=I("span",null,"Inbounds",-1))]),_:1})]),default:t(()=>[a[35]||(a[35]=n()),(o(!0),m(y,null,_([i.data.dataplane.networking.type==="gateway"?Object.entries(C?.inbounds??{}).reduce((s,[d,u])=>{const g=d.split("_").at(-1);return g===(i.data.dataplane.networking.admin?.port??"9901")?s:s.concat([{...i.data.dataplane.networking.inbounds[0],name:d,clusterName:d,port:Number(g),protocol:["http","tcp"].find(z=>typeof u[z]<"u")??"tcp",addressPort:`${i.data.dataplane.networking.inbounds[0].address}:${g}`}])},[]):i.data.dataplane.networking.inbounds],s=>(o(),p(V,{key:s,type:"inbound","data-testid":"dataplane-inbounds"},{default:t(()=>[e(R,{type:"inbounds",items:s,predicate:d=>d.port!==49151},q({default:t(({items:d})=>[e(c,{type:"stack",size:"small"},{default:t(()=>[(o(!0),m(y,null,_(d,u=>(o(),m(y,{key:`${u.name}`},[(o(!0),m(y,null,_([C?.inbounds[u.clusterName]],g=>(o(),p(A,{key:g,"data-testid":"dataplane-inbound",protocol:u.protocol,"port-name":u.portName,service:$("use service-insights",i.mesh)?u.tags["kuma.io/service"]:"",traffic:typeof B>"u"?g:{name:"",protocol:u.protocol,port:`${u.port}`},"data-actionable":""},{state:t(()=>[u.state!=="Ready"?(o(),p(X,{key:0,name:"danger",size:D(ot),placement:"right"},{default:t(()=>[n(r(l("data-planes.routes.item.unhealthy_inbound",{port:u.port})),1)]),_:2},1032,["size"])):w("",!0)]),default:t(()=>[a[33]||(a[33]=n()),e(h,{"data-action":"",to:{name:(z=>z.includes("bound")?z.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(D(E).name)),params:{connection:u.name},query:{inactive:b.params.inactive}}},{default:t(()=>[n(r(u.name.replace("localhost","").replace("_",":")),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","service","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},[i.data.dataplaneType==="delegated"?{name:"empty",fn:t(()=>[e(O,null,{default:t(()=>[I("p",null,`
                            This proxy is a delegated gateway therefore `+r(l("common.product.name"))+` does not have any
                            visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),a[46]||(a[46]=n()),e(P,null,q({title:t(()=>[e(c,{type:"separated"},{default:t(()=>[e(X,{name:"outbound"}),a[39]||(a[39]=n()),a[40]||(a[40]=I("span",null,"Outbounds",-1))]),_:1})]),default:t(()=>[a[44]||(a[44]=n()),a[45]||(a[45]=n()),typeof B>"u"?(o(),m(y,{key:0},[typeof C>"u"?(o(),p(F,{key:0})):(o(),m(y,{key:1},[e(V,{type:"passthrough"},{default:t(()=>[e(A,{protocol:"passthrough",traffic:C.passthrough},{default:t(()=>[...a[41]||(a[41]=[n(`
                        Non mesh traffic
                      `,-1)])]),_:1},8,["traffic"])]),_:2},1024),a[43]||(a[43]=n()),(o(),m(y,null,_(["upstream"],s=>(o(),m(y,{key:s},[e(T,{notify:!!Object.values(C.outbounds).find(d=>(typeof d.tcp<"u"?d.tcp?.[`${s}_cx_rx_bytes_total`]:d.http?.[`${s}_rq_total`])??!1),variant:"info",uri:`data-planes.notifications.recommend-reachable-services:${i.data.id}`},{default:t(()=>[e(x,{path:"data-planes.notifications.recommend-reachable",params:{mode:i.mesh.meshServices.mode}},null,8,["params"])]),_:1},8,["notify","uri"]),a[42]||(a[42]=n()),e(R,{type:"outbounds",predicate:b.params.inactive?void 0:([d,u])=>((typeof u.tcp<"u"?u.tcp?.[`${s}_cx_rx_bytes_total`]:u.http?.[`${s}_rq_total`])??0)>0,items:Object.entries(C.outbounds)},{default:t(({items:d})=>[d.length>0?(o(),p(V,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:t(()=>[(o(),m(y,null,_([/-([a-f0-9]){16}$/],u=>e(c,{key:u,type:"stack",size:"small"},{default:t(()=>[(o(!0),m(y,null,_(d,([g,z])=>(o(),p(A,{key:`${g}`,"data-testid":"dataplane-outbound",protocol:["grpc","http","tcp"].find(N=>typeof z[N]<"u")??"tcp",traffic:z,service:z.$resourceMeta.type===""?g.replace(u,""):void 0,direction:s,"data-actionable":""},{default:t(()=>[e(h,{"data-action":"",to:{name:(N=>N.includes("bound")?N.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(D(E).name)),params:{connection:g},query:{inactive:b.params.inactive}}},{default:t(()=>[n(r(g),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","service","direction"]))),128))]),_:2},1024)),64))]),_:2},1024)):w("",!0)]),_:2},1032,["predicate","items"])],64))),64))],64))],64)):(o(),p(O,{key:1}))]),_:2},[C?{name:"actions",fn:t(()=>[e(M,{checked:b.params.inactive,"data-testid":"dataplane-outbounds-inactive-toggle",onChange:s=>b.update({inactive:s})},{label:t(()=>[...a[36]||(a[36]=[n(`
                      Show inactive
                    `,-1)])]),_:1},8,["checked","onChange"]),a[38]||(a[38]=n()),e(h,{action:"refresh",appearance:"primary",onClick:Y},{default:t(()=>[...a[37]||(a[37]=[n(`
                    Refresh
                  `,-1)])]),_:1},8,["onClick"])]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024),a[48]||(a[48]=n()),e(Z,null,{default:t(s=>[s.route.name!==b.name?(o(),p(U,{key:0,width:s.route.name==="data-plane-subscriptions-summary-view"?"900px":"670px",onClose:function(){b.replace({name:"data-plane-detail-view",params:{mesh:b.params.mesh,proxy:b.params.proxy},query:{inactive:b.params.inactive?null:void 0}})}},{default:t(()=>[(o(),p(st(s.Component),{data:b.params.subscription.length>0?i.data.dataplaneInsight.subscriptions:s.route.name.includes("-inbound-")?i.data.dataplane.networking.inbounds:C?.outbounds||{},networking:i.data.dataplane.networking,subscriptions:i.data.dataplaneInsight.subscriptions},null,8,["data","networking","subscriptions"]))]),_:2},1032,["width","onClose"])):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),yt=it(rt,[["__scopeId","data-v-b0ab64eb"]]);export{yt as default};
