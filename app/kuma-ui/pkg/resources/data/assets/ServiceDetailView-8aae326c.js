import{d as B,c as S,r as z,o as s,a as n,w as i,k as P,g as r,h as f,t as $,f as O,e as q,F as E,b as I,u as R,q as T}from"./index-9404de83.js";import{J}from"./kongponents.es-44d50ffe.js";import{D as W,a as A}from"./DefinitionListItem-852da124.js";import{_ as G}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-637b2f8e.js";import{S as Q}from"./StatusBadge-cf5e3726.js";import{T as K}from"./TagList-574a8386.js";import{T as M}from"./TextWithCopyButton-96eef015.js";import{g as V,f as H,i as U,A as X,h as Y,_ as Z}from"./RouteView.vue_vue_type_script_setup_true_lang-5211ad2b.js";import{D as ee}from"./DataPlaneList-339556d6.js";import{_ as te}from"./RouteTitle.vue_vue_type_script_setup_true_lang-4c670f7a.js";import{_ as ae}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-82eae69e.js";import{E as re}from"./ErrorBlock-a1e01761.js";import{Q as se}from"./QueryParameter-70743f73.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-4249e911.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-d7b2de58.js";import"./DataOverview-44386ef7.js";const le={class:"entity-section-list"},ne={class:"entity-title"},ie=B({__name:"ServiceSummary",props:{service:{type:Object,required:!0},externalService:{type:Object,required:!1,default:null}},setup(h){const e=h,t=V(),y=S(()=>({name:"service-detail-view",params:{service:e.service.name,mesh:e.service.mesh}})),_=S(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.networking.address:e.service.addressPort??null),g=S(()=>{var a;return e.service.serviceType==="external"&&e.externalService!==null?(a=e.externalService.networking.tls)!=null&&a.enabled?"Enabled":"Disabled":null}),l=S(()=>{var a,o;if(e.service.serviceType==="external")return null;{const u=((a=e.service.dataplanes)==null?void 0:a.online)??0,F=((o=e.service.dataplanes)==null?void 0:o.total)??0;return`${u} online / ${F} total`}}),c=S(()=>e.service.serviceType==="external"?null:e.service.status??null),x=S(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.tags:null);async function k(a){if(e.service.serviceType==="external"&&e.externalService!==null){const{mesh:o,name:u}=e.externalService;return await t.getExternalService({mesh:o,name:u},a)}else{const{mesh:o,name:u}=e.service;return await t.getServiceInsight({mesh:o,name:u},a)}}return(a,o)=>{const u=z("router-link");return s(),n(I(J),null,{body:i(()=>[P("div",le,[P("section",null,[P("h1",ne,[P("span",null,[r(`
              Service:

              `),f(M,{text:e.service.name},{default:i(()=>[f(u,{to:y.value},{default:i(()=>[r($(e.service.name),1)]),_:1},8,["to"])]),_:1},8,["text"])]),r(),c.value?(s(),n(Q,{key:0,status:c.value},null,8,["status"])):O("",!0)]),r(),f(W,{class:"mt-4"},{default:i(()=>[f(A,{term:"Address"},{default:i(()=>[_.value!==null?(s(),q(E,{key:0},[r($(_.value),1)],64)):(s(),q(E,{key:1},[r(`
                —
              `)],64))]),_:1}),r(),g.value!==null?(s(),n(A,{key:0,term:"TLS"},{default:i(()=>[r($(g.value),1)]),_:1})):O("",!0),r(),l.value!==null?(s(),n(A,{key:1,term:"Data Plane Proxies"},{default:i(()=>[r($(l.value),1)]),_:1})):O("",!0),r(),x.value!==null?(s(),n(A,{key:2,term:"Tags"},{default:i(()=>[f(K,{tags:x.value},null,8,["tags"])]),_:1})):O("",!0)]),_:1})]),r(),f(G,{id:"code-block-service","resource-fetcher":k,"resource-fetcher-watch-key":e.service.name,"is-searchable":"","show-copy-as-kubernetes-button":e.service.serviceType==="external"&&e.externalService!==null,"code-max-height":"250px"},null,8,["resource-fetcher-watch-key","show-copy-as-kubernetes-button"])])]),_:1})}}});const ce=H(ie,[["__scopeId","data-v-6b783de5"]]),oe=B({__name:"ServiceDetails",props:{service:{type:Object,required:!0},externalService:{type:Object,required:!1,default:null},dataPlaneOverviews:{type:Array,required:!1,default:null},dppFilterFields:{type:Object,required:!0},selectedDppName:{type:String,required:!1,default:null}},emits:["load-dataplane-overviews"],setup(h,{emit:e}){const t=h;function y(_,g){var c;(((c=t.service.serviceType)==null?void 0:c.startsWith("gateway"))??!1)||delete g.gateway,e("load-dataplane-overviews",_,g)}return(_,g)=>{var l;return s(),q(E,null,[f(ce,{service:t.service,"external-service":h.externalService},null,8,["service","external-service"]),r(),t.dataPlaneOverviews!==null?(s(),n(ee,{key:0,class:"mt-4","data-plane-overviews":t.dataPlaneOverviews,"dpp-filter-fields":t.dppFilterFields,"selected-dpp-name":t.selectedDppName,"is-gateway-view":((l=t.dataPlaneOverviews[0])==null?void 0:l.dataplane.networking.gateway)!==void 0,onLoadData:y},null,8,["data-plane-overviews","dpp-filter-fields","selected-dpp-name","is-gateway-view"])):O("",!0)],64)}}}),ue={class:"service-details"},Pe=B({__name:"ServiceDetailView",props:{selectedDppName:{type:String,required:!1,default:null}},setup(h){const e=h,t=V(),y=R(),{t:_}=U(),g={name:{description:"filter by name or parts of a name"},protocol:{description:"filter by “kuma.io/protocol” value"},tag:{description:"filter by tags (e.g. “tag: version:2”)"},zone:{description:"filter by “kuma.io/zone” value"}},l=T(null),c=T(null),x=T(null),k=T(!0),a=T(null);o();function o(){const v=se.get("filterFields"),w=v!==null?JSON.parse(v):{};u(0,w)}async function u(v,w={}){k.value=!0,a.value=null,l.value=null,c.value=null,x.value=null;const p=y.params.mesh,b=y.params.service;try{l.value=await t.getServiceInsight({mesh:p,name:b}),l.value.serviceType==="external"?c.value=await t.getExternalServiceByServiceInsightName(p,b):await F(v,w)}catch(m){m instanceof Error?a.value=m:console.error(m)}finally{k.value=!1}}async function F(v,w){const p=y.params.mesh,b=y.params.service;try{const m=j(b,v,w),d=await t.getAllDataplaneOverviewsFromMesh({mesh:p},m);x.value=d.items??[]}catch{x.value=null}}function j(v,w,p){const m=`kuma.io/service:${v}`,d={...p,offset:w,size:50};if(d.tag){const L=Array.isArray(d.tag)?d.tag:[d.tag],N=[];for(const[D,C]of L.entries())C.startsWith("kuma.io/service:")&&N.push(D);for(let D=N.length-1;D===0;D--)L.splice(N[D],1);d.tag=L.concat(m)}else d.tag=m;return d}return(v,w)=>(s(),n(Z,null,{default:i(({route:p})=>[f(te,{title:I(_)("services.routes.item.title",{name:p.params.service})},null,8,["title"]),r(),f(X,{breadcrumbs:[{to:{name:"services-list-view",params:{mesh:p.params.mesh}},text:I(_)("services.routes.item.breadcrumbs")}]},{default:i(()=>[P("div",ue,[k.value?(s(),n(Y,{key:0})):a.value!==null?(s(),n(re,{key:1,error:a.value},null,8,["error"])):l.value===null?(s(),n(ae,{key:2})):(s(),n(oe,{key:3,service:l.value,"data-plane-overviews":x.value,"external-service":c.value,"dpp-filter-fields":g,"selected-dpp-name":e.selectedDppName,onLoadDataplaneOverviews:F},null,8,["service","data-plane-overviews","external-service","selected-dpp-name"]))])]),_:2},1032,["breadcrumbs"])]),_:1}))}});export{Pe as default};
