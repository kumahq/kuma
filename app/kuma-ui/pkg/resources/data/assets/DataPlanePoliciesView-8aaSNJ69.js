import{A as M,a as j}from"./AccordionList-wVfYOae_.js";import{d as K,a as k,o as e,c as a,m as o,f as s,F as c,E as v,t as i,e as y,w as l,p as B,b as n,a1 as D,x as q,y as H,_ as G,I as W,q as R,l as Y,n as X,S as O}from"./index-L_2d1oA-.js";import{C as J}from"./CodeBlock-B8z6MMys.js";import{P as Q}from"./PolicyTypeTag-Cx3ilgcR.js";import{T as z}from"./TagList-PhMEwhbH.js";import{t as U}from"./toYaml-sPaYOD3i.js";import{E as F}from"./ErrorBlock-yLPLZf_6.js";import{_ as V}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-6BqX7dm5.js";import"./index-FZCiQto1.js";import"./TextWithCopyButton-msv3q9gZ.js";import"./CopyButton-AB3vXwLG.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-31yMuyzv.js";const C=_=>(q("data-v-f3e7afbb"),_=_(),H(),_),Z={class:"policies-list"},E={class:"mesh-gateway-policy-list"},ee=C(()=>o("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),te={key:0},ae=C(()=>o("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),se=C(()=>o("b",null,"Host",-1)),le=C(()=>o("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),ne={class:"dataplane-policy-header"},oe=C(()=>o("b",null,"Route",-1)),ie=C(()=>o("b",null,"Service",-1)),ce={key:0,class:"badge-list"},re={class:"mt-1"},pe=K({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},policyTypesByName:{}},setup(_){const d=_;return(r,w)=>{const g=k("RouterLink"),h=k("KBadge");return e(),a("div",Z,[o("div",E,[ee,s(),r.gatewayDataplane.routePolicies.length>0?(e(),a("ul",te,[(e(!0),a(c,null,v(r.gatewayDataplane.routePolicies,(u,f)=>(e(),a("li",{key:f},[o("span",null,i(u.type),1),s(`:

          `),y(g,{to:{name:"policy-detail-view",params:{mesh:u.mesh,policyPath:d.policyTypesByName[u.type].path,policy:u.name}}},{default:l(()=>[s(i(u.name),1)]),_:2},1032,["to"])]))),128))])):B("",!0),s(),ae,s(),o("div",null,[(e(!0),a(c,null,v(r.gatewayDataplane.listenerEntries,(u,f)=>(e(),a("div",{key:f},[o("div",null,[o("div",null,[se,s(": "+i(u.hostName)+":"+i(u.port)+" ("+i(u.protocol)+`)
            `,1)]),s(),u.routeEntries.length>0?(e(),a(c,{key:0},[le,s(),y(j,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),a(c,null,v(u.routeEntries,(p,T)=>(e(),n(M,{key:T},D({"accordion-header":l(()=>[o("div",ne,[o("div",null,[o("div",null,[oe,s(": "),y(g,{to:{name:"policy-detail-view",params:{mesh:p.route.mesh,policyPath:d.policyTypesByName[p.route.type].path,policy:p.route.name}}},{default:l(()=>[s(i(p.route.name),1)]),_:2},1032,["to"])]),s(),o("div",null,[ie,s(": "+i(p.service),1)])]),s(),p.origins.length>0?(e(),a("div",ce,[(e(!0),a(c,null,v(p.origins,(t,m)=>(e(),n(h,{key:`${f}-${m}`},{default:l(()=>[s(i(t.type),1)]),_:2},1024))),128))])):B("",!0)])]),_:2},[p.origins.length>0?{name:"accordion-content",fn:l(()=>[o("ul",re,[(e(!0),a(c,null,v(p.origins,(t,m)=>(e(),a("li",{key:`${f}-${m}`},[s(i(t.type)+`:

                        `,1),y(g,{to:{name:"policy-detail-view",params:{mesh:t.mesh,policyPath:d.policyTypesByName[t.type].path,policy:t.name}}},{default:l(()=>[s(i(t.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):B("",!0)])]))),128))])])])}}}),ue=G(pe,[["__scopeId","data-v-f3e7afbb"]]),de={class:"policy-type-heading"},ye={class:"policy-list"},me={key:0},_e=K({__name:"PolicyTypeEntryList",props:{policyTypeEntries:{},policyTypesByName:{}},setup(_){const d=_,r=W(()=>d.policyTypeEntries.filter(g=>{var h;return((h=d.policyTypesByName[g.type])==null?void 0:h.isTargetRefBased)===!1}));function w({headerKey:g}){return{class:`cell-${g}`}}return(g,h)=>{const u=k("RouterLink"),f=k("KTable");return e(),n(j,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),a(c,null,v(r.value,(p,T)=>(e(),n(M,{key:T},{"accordion-header":l(()=>[o("h3",de,[y(Q,{"policy-type":p.type},{default:l(()=>[s(i(p.type)+" ("+i(p.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":l(()=>[o("div",ye,[y(f,{class:"policy-type-table",fetcher:()=>({data:p.connections,total:p.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":w,"disable-pagination":"","is-clickable":""},{sourceTags:l(({row:t})=>[t.sourceTags.length>0?(e(),n(z,{key:0,class:"tag-list","should-truncate":"",tags:t.sourceTags},null,8,["tags"])):(e(),a(c,{key:1},[s(`
                —
              `)],64))]),destinationTags:l(({row:t})=>[t.destinationTags.length>0?(e(),n(z,{key:0,class:"tag-list","should-truncate":"",tags:t.destinationTags},null,8,["tags"])):(e(),a(c,{key:1},[s(`
                —
              `)],64))]),name:l(({row:t})=>[t.name!==null?(e(),a(c,{key:0},[s(i(t.name),1)],64)):(e(),a(c,{key:1},[s(`
                —
              `)],64))]),origins:l(({row:t})=>[t.origins.length>0?(e(),a("ul",me,[(e(!0),a(c,null,v(t.origins,(m,b)=>(e(),a("li",{key:`${T}-${b}`},[y(u,{to:{name:"policy-detail-view",params:{mesh:m.mesh,policyPath:d.policyTypesByName[m.type].path,policy:m.name}}},{default:l(()=>[s(i(m.name),1)]),_:2},1032,["to"])]))),128))])):(e(),a(c,{key:1},[s(`
                —
              `)],64))]),config:l(({row:t})=>[t.config?(e(),n(J,{key:0,code:R(U)(t.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),a(c,{key:1},[s(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}}),he=G(_e,[["__scopeId","data-v-18983fd0"]]),ge=_=>(q("data-v-c78ed2e9"),_=_(),H(),_),fe={class:"policy-type-heading"},ke={class:"policy-list"},be={key:0,class:"matcher"},ve={key:0,class:"matcher__and"},$e=ge(()=>o("br",null,null,-1)),Te={key:1,class:"matcher__not"},Re={class:"matcher__term"},Be={key:1},we={key:0},Pe=K({__name:"RuleEntryList",props:{ruleEntries:{},policyTypesByName:{},showMatchers:{type:Boolean,default:!0}},setup(_){const{t:d}=Y(),r=_;function w({headerKey:g}){return{class:`cell-${g}`}}return(g,h)=>{const u=k("RouterLink"),f=k("KTable");return e(),n(j,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),a(c,null,v(r.ruleEntries,(p,T)=>(e(),n(M,{key:T},{"accordion-header":l(()=>[o("h3",fe,[y(Q,{"policy-type":p.type},{default:l(()=>[s(i(p.type),1)]),_:2},1032,["policy-type"])])]),"accordion-content":l(()=>[o("div",ke,[y(f,{class:X(["policy-type-table",{"has-matchers":r.showMatchers}]),fetcher:()=>({data:p.rules,total:p.rules.length}),headers:[...r.showMatchers?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}],"cell-attrs":w,"disable-pagination":""},D({origins:l(({row:t})=>[t.origins.length>0?(e(),a("ul",we,[(e(!0),a(c,null,v(t.origins,(m,b)=>(e(),a("li",{key:`${T}-${b}`},[y(u,{to:{name:"policy-detail-view",params:{mesh:m.mesh,policyPath:r.policyTypesByName[m.type].path,policy:m.name}}},{default:l(()=>[s(i(m.name),1)]),_:2},1032,["to"])]))),128))])):(e(),a(c,{key:1},[s(i(R(d)("common.collection.none")),1)],64))]),config:l(({row:t})=>[t.config?(e(),n(J,{key:0,code:R(U)(t.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),a(c,{key:1},[s(i(R(d)("common.collection.none")),1)],64))]),_:2},[r.showMatchers?{name:"matchers",fn:l(({row:t})=>[t.matchers&&t.matchers.length>0?(e(),a("span",be,[(e(!0),a(c,null,v(t.matchers,({key:m,value:b,not:P},$)=>(e(),a(c,{key:$},[$>0?(e(),a("span",ve,[s(" and"),$e])):B("",!0),P?(e(),a("span",Te,"!")):B("",!0),o("span",Re,i(`${m}:${b}`),1)],64))),128))])):(e(),a("i",Be,i(R(d)("data-planes.routes.item.matches_everything")),1))]),key:"0"}:void 0]),1032,["class","fetcher","headers"])])]),_:2},1024))),128))]),_:1})}}}),x=G(Pe,[["__scopeId","data-v-c78ed2e9"]]),Ne={class:"stack"},Ce={class:"mb-2"},Le=K({__name:"StandardDataplanePolicies",props:{inspectRulesForDataplane:{},policyTypesByName:{}},setup(_){const{t:d}=Y(),r=_;return(w,g)=>{const h=k("KCard");return e(),a("div",Ne,[r.inspectRulesForDataplane.proxyRules.length>0?(e(),n(h,{key:0},{default:l(()=>[o("h3",null,i(R(d)("data-planes.routes.item.proxy_rule")),1),s(),y(x,{class:"mt-2","rule-entries":r.inspectRulesForDataplane.proxyRules,"policy-types-by-name":r.policyTypesByName,"show-matchers":!1,"data-testid":"proxy-rule-list"},null,8,["rule-entries","policy-types-by-name"])]),_:1})):B("",!0),s(),r.inspectRulesForDataplane.toRules.length>0?(e(),n(h,{key:1},{default:l(()=>[o("h3",null,i(R(d)("data-planes.routes.item.to_rules")),1),s(),y(x,{class:"mt-2","rule-entries":r.inspectRulesForDataplane.toRules,"policy-types-by-name":r.policyTypesByName,"data-testid":"to-rule-list"},null,8,["rule-entries","policy-types-by-name"])]),_:1})):B("",!0),s(),r.inspectRulesForDataplane.fromRuleInbounds.length>0?(e(),n(h,{key:2},{default:l(()=>[o("h3",Ce,i(R(d)("data-planes.routes.item.from_rules")),1),s(),(e(!0),a(c,null,v(r.inspectRulesForDataplane.fromRuleInbounds,(u,f)=>(e(),a("div",{key:f},[o("h4",null,i(R(d)("data-planes.routes.item.port",{port:u.port})),1),s(),y(x,{class:"mt-2","rule-entries":u.ruleEntries,"policy-types-by-name":r.policyTypesByName,"data-testid":`from-rule-list-${f}`},null,8,["rule-entries","policy-types-by-name","data-testid"])]))),128))]),_:1})):B("",!0)])}}}),Ie={class:"stack"},qe=K({__name:"DataPlanePoliciesView",props:{data:{}},setup(_){const d=_;return(r,w)=>{const g=k("RouteTitle"),h=k("DataSource"),u=k("KCard"),f=k("AppView"),p=k("RouteView");return e(),n(p,{name:"data-plane-policies-view",params:{mesh:"",dataPlane:""}},{default:l(({can:T,route:t,t:m})=>[y(f,null,{title:l(()=>[o("h2",null,[y(g,{title:m("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"])])]),default:l(()=>[s(),o("div",Ie,[y(h,{src:"/*/policy-types"},{default:l(({data:b,error:P})=>[y(h,{src:`/meshes/${t.params.mesh}/dataplanes/${t.params.dataPlane}/rules`},{default:l(({data:$,error:L})=>[P?(e(),n(F,{key:0,error:P},null,8,["error"])):L?(e(),n(F,{key:1,error:L},null,8,["error"])):b===void 0||$===void 0?(e(),n(V,{key:2})):$.rules.length===0?(e(),n(O,{key:3})):(e(),n(Le,{key:4,"policy-types-by-name":b.policies.reduce((N,I)=>Object.assign(N,{[I.name]:I}),{}),"inspect-rules-for-dataplane":$,"data-testid":"rules-based-policies"},null,8,["policy-types-by-name","inspect-rules-for-dataplane"]))]),_:2},1032,["src"]),s(),T("use zones")?B("",!0):(e(),n(h,{key:0,src:d.data.dataplaneType!=="builtin"?`/meshes/${t.params.mesh}/dataplanes/${t.params.dataPlane}/sidecar-dataplane-policies`:""},{default:l(({data:$,error:L})=>[y(h,{src:d.data.dataplaneType==="builtin"?`/meshes/${t.params.mesh}/dataplanes/${t.params.dataPlane}/gateway-dataplane-policies`:""},{default:l(({data:N,error:I})=>[o("div",null,[o("h3",null,i(m("data-planes.routes.item.legacy_policies")),1),s(),P?(e(),n(F,{key:0,error:P},null,8,["error"])):L?(e(),n(F,{key:1,error:L},null,8,["error"])):I?(e(),n(F,{key:2,error:I},null,8,["error"])):b===void 0?(e(),n(V,{key:3})):d.data.dataplaneType==="builtin"?(e(),a(c,{key:4},[N===void 0?(e(),n(V,{key:0})):N.routePolicies.length===0&&N.listenerEntries.length===0?(e(),n(O,{key:1})):(e(),n(u,{key:2,class:"mt-4"},{default:l(()=>[y(ue,{"policy-types-by-name":b.policies.reduce((A,S)=>Object.assign(A,{[S.name]:S}),{}),"gateway-dataplane":N,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["policy-types-by-name","gateway-dataplane"])]),_:2},1024))],64)):(e(),a(c,{key:5},[$===void 0?(e(),n(V,{key:0})):$.policyTypeEntries.length===0?(e(),n(O,{key:1})):(e(),n(u,{key:2,class:"mt-4"},{default:l(()=>[y(he,{"policy-type-entries":$.policyTypeEntries,"policy-types-by-name":b.policies.reduce((A,S)=>Object.assign(A,{[S.name]:S}),{}),"data-testid":"sidecar-dataplane-policies"},null,8,["policy-type-entries","policy-types-by-name"])]),_:2},1024))],64))])]),_:2},1032,["src"])]),_:2},1032,["src"]))]),_:2},1024)])]),_:2},1024)]),_:1})}}});export{qe as default};
