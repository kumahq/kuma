import{_ as T,r as N,p as g,o as d,w as v,l as s,e as r,a as p,d as M,k as P,c as f,q as $,t as i,N as m,L as S,m as a,n as X,b as L}from"./index-Cu0UScaV.js";import{T as G}from"./TagList-BrCaNPeR.js";const Y=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],F=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],U=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Z=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],q=(o,t,e)=>{let c=o;return typeof t=="string"||Array.isArray(t)?c=o.toLocaleString(t,e):(t===!0||e!==void 0)&&(c=o.toLocaleString(void 0,e)),c},I=o=>{if(typeof o=="number")return Math.log10(o);const t=o.toString(10);return t.length+Math.log10(`0.${t.slice(0,15)}`)},D=o=>typeof o=="number"?Math.log(o):I(o)*Math.log(10),V=(o,t)=>{if(typeof o=="number")return o/t;const e=o/BigInt(t),c=o%BigInt(t);return Number(e)+Number(c)/t},E=(o,t)=>{if(t===void 0)return o;if(typeof t!="number"||!Number.isSafeInteger(t)||t<0)throw new TypeError(`Expected fixedWidth to be a non-negative integer, got ${typeof t}: ${t}`);return t===0?o:o.length<t?o.padStart(t," "):o},A=o=>{const{minimumFractionDigits:t,maximumFractionDigits:e}=o;if(!(t===void 0&&e===void 0))return{...t!==void 0&&{minimumFractionDigits:t},...e!==void 0&&{maximumFractionDigits:e},roundingMode:"trunc"}};function k(o,t){if(typeof o!="bigint"&&!Number.isFinite(o))throw new TypeError(`Expected a finite number, got ${typeof o}: ${o}`);t={bits:!1,binary:!1,space:!0,nonBreakingSpace:!1,...t};const e=t.bits?t.binary?Z:U:t.binary?F:Y,c=t.space?t.nonBreakingSpace?"Â ":" ":"",n=typeof o=="number"?o===0:o===0n;if(t.signed&&n){const u=` 0${c}${e[0]}`;return E(u,t.fixedWidth)}const b=o<0,B=b?"-":t.signed?"+":"";b&&(o=-o);const l=A(t);let _;if(o<1){const u=q(o,t.locale,l);_=B+u+c+e[0]}else{const u=Math.min(Math.floor(t.binary?D(o)/Math.log(1024):I(o)/3),e.length-1);if(o=V(o,(t.binary?1024:1e3)**u),!l){const C=Math.max(3,Math.floor(o).toString().length);o=o.toPrecision(C)}const x=q(Number(o),t.locale,l),y=e[u];_=B+x+c+y}return E(_,t.fixedWidth)}const j={},z={class:"card"},K={class:"title"},H={class:"body"};function J(o,t){const e=N("XCard");return d(),g(e,{class:"data-card"},{default:v(()=>[s("dl",null,[s("div",z,[s("dt",K,[p(o.$slots,"title",{},void 0,!0)]),t[0]||(t[0]=r()),s("dd",H,[p(o.$slots,"default",{},void 0,!0)])])])]),_:3})}const w=T(j,[["render",J],["__scopeId","data-v-719ec237"]]),Q={class:"aside"},R={class:"title"},W={key:0},O={key:1},h={"data-testid":"grpc-success"},tt={"data-testid":"grpc-failure"},et={"data-testid":"rq-2xx"},nt={"data-testid":"rq-4xx"},ot={"data-testid":"rq-5xx"},st={"data-testid":"connections-total"},rt={key:0,"data-testid":"bytes-received"},it={key:1,"data-testid":"bytes-sent"},at=M({__name:"ConnectionCard",props:{protocol:{},service:{default:""},traffic:{default:void 0},direction:{default:"downstream"},portName:{default:void 0}},setup(o){const{t}=P(),e=o;return(c,n)=>{const b=N("XBadge"),B=N("XProgress");return d(),g(w,{class:"service-traffic-card"},{title:v(()=>[s("div",Q,[p(c.$slots,"aside",{},()=>[e.service.length>0?(d(),g(G,{key:0,tags:[{label:"kuma.io/service",value:e.service}]},null,8,["tags"])):$("",!0)],!0)]),n[2]||(n[2]=r()),s("div",R,[p(c.$slots,"state",{},void 0,!0),n[0]||(n[0]=r()),e.protocol!==""?(d(),g(b,{key:0,class:"protocol",appearance:e.protocol==="passthrough"?"success":"info"},{default:v(()=>[r(i(a(t)(`data-planes.components.service_traffic_card.protocol.${e.protocol}`,{},{defaultMessage:a(t)(`http.api.value.${e.protocol}`)})),1)]),_:1},8,["appearance"])):$("",!0),n[1]||(n[1]=r()),p(c.$slots,"default",{},void 0,!0)])]),default:v(()=>[n[25]||(n[25]=r()),e.portName?(d(),f("dl",W,[s("div",null,[n[3]||(n[3]=s("dt",null,"Name",-1)),n[4]||(n[4]=r()),s("dd",null,i(e.portName),1)])])):$("",!0),n[26]||(n[26]=r()),e.traffic?(d(),f("dl",O,[e.protocol==="passthrough"?(d(!0),f(m,{key:0},S([["http","tcp"].reduce((l,_)=>{const u=e.direction;return Object.entries(e.traffic?.[_]||{}).reduce((x,[y,C])=>[`${u}_cx_tx_bytes_total`,`${u}_cx_rx_bytes_total`].includes(y)?{...x,[y]:C+(x[y]??0)}:x,l)},{})],(l,_)=>(d(),f(m,{key:_},[s("div",null,[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.tx")),1),n[5]||(n[5]=r()),s("dd",null,i(a(k)(l.downstream_cx_rx_bytes_total??0)),1)]),n[7]||(n[7]=r()),s("div",null,[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.rx")),1),n[6]||(n[6]=r()),s("dd",null,i(a(k)(l.downstream_cx_tx_bytes_total??0)),1)])],64))),128)):e.protocol==="grpc"?(d(),f(m,{key:1},[s("div",h,[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.grpc_success")),1),n[8]||(n[8]=r()),s("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.grpc?.success})),1)]),n[10]||(n[10]=r()),s("div",tt,[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.grpc_failure")),1),n[9]||(n[9]=r()),s("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.grpc?.failure})),1)])],64)):e.protocol.startsWith("http")?(d(),f(m,{key:2},[(d(!0),f(m,null,S([e.traffic.http?.[`${e.direction}_rq_1xx`]??0].filter(l=>l!==0),l=>(d(),f("div",{key:l,"data-testid":"rq-1xx"},[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.1xx")),1),n[11]||(n[11]=r()),s("dd",null,i(a(t)("common.formats.integer",{value:l})),1)]))),128)),n[16]||(n[16]=r()),s("div",et,[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.2xx")),1),n[12]||(n[12]=r()),s("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.http?.[`${e.direction}_rq_2xx`]})),1)]),n[17]||(n[17]=r()),(d(!0),f(m,null,S([e.traffic.http?.[`${e.direction}_rq_3xx`]??0].filter(l=>l!==0),l=>(d(),f("div",{key:l,"data-testid":"rq-3xx"},[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.3xx")),1),n[13]||(n[13]=r()),s("dd",null,i(a(t)("common.formats.integer",{value:l})),1)]))),128)),n[18]||(n[18]=r()),s("div",nt,[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.4xx")),1),n[14]||(n[14]=r()),s("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.http?.[`${e.direction}_rq_4xx`]})),1)]),n[19]||(n[19]=r()),s("div",ot,[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.5xx")),1),n[15]||(n[15]=r()),s("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.http?.[`${e.direction}_rq_5xx`]})),1)])],64)):(d(),f(m,{key:3},[s("div",st,[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.cx")),1),n[20]||(n[20]=r()),s("dd",null,i(a(t)("common.formats.integer",{value:e.traffic.tcp?.[`${e.direction}_cx_total`]})),1)]),n[23]||(n[23]=r()),typeof e.traffic.tcp?.[`${e.direction}_cx_tx_bytes_total`]<"u"?(d(),f("div",rt,[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.rx")),1),n[21]||(n[21]=r()),s("dd",null,i(a(k)(e.traffic.tcp?.[`${e.direction}_cx_tx_bytes_total`])),1)])):$("",!0),n[24]||(n[24]=r()),typeof e.traffic.tcp?.[`${e.direction}_cx_rx_bytes_total`]<"u"?(d(),f("div",it,[s("dt",null,i(a(t)("data-planes.components.service_traffic_card.tx")),1),n[22]||(n[22]=r()),s("dd",null,i(a(k)(e.traffic.tcp?.[`${e.direction}_cx_rx_bytes_total`])),1)])):$("",!0)],64))])):(d(),g(B,{key:2,variant:"line"}))]),_:3})}}}),mt=T(at,[["__scopeId","data-v-14997fd7"]]),dt={class:"body"},lt=M({__name:"ConnectionGroup",props:{type:{}},setup(o){const t=o;return(e,c)=>{const n=N("XCard");return d(),g(n,{class:X(["service-traffic-group",`type-${t.type}`])},{default:v(()=>[s("div",dt,[p(e.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}}),gt=T(lt,[["__scopeId","data-v-25c74403"]]),ct={class:"service-traffic"},ft={class:"actions"},ut=M({__name:"ConnectionTraffic",setup(o){return(t,e)=>(d(),f("div",ct,[s("div",ft,[p(t.$slots,"actions",{},void 0,!0)]),e[0]||(e[0]=r()),L(w,{class:"header"},{title:v(()=>[p(t.$slots,"title",{},void 0,!0)]),_:3}),e[1]||(e[1]=r()),p(t.$slots,"default",{},void 0,!0)]))}}),vt=T(ut,[["__scopeId","data-v-e6bd176c"]]);export{vt as C,gt as a,mt as b};
