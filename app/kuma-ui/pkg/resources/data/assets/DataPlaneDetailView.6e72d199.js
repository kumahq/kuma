import{_ as W,U as Y,V as F,I as R,H as q,z,Q as H,m as Z,K as B,o as e,b as v,w as o,d,f as l,j as f,h as s,n as C,t as c,F as _,e as x,r as b,L as U,cH as O,O as w,p as G,M as m,cD as J,cE as Q,cI as X,cx as N,cF as ee,a4 as ae,D as te,E as se,S as ne,cy as oe,cz as le,s as ie,cJ as re,cK as ce,a3 as de,T as ue,cL as pe,cM as me}from"./index.2f6d90b0.js";import{S as j,E as A}from"./EnvoyData.ba17b673.js";import{E as he}from"./EntityURLControl.97461fef.js";import{L as V}from"./LabelList.27a15810.js";import{a as _e,S as ye}from"./SubscriptionHeader.099107c6.js";import{T as fe}from"./TabsWidget.37f6a0c6.js";import{W as ve}from"./WarningsWidget.e89a4b28.js";import{Y as ge}from"./YamlView.25baae1a.js";import{E as Pe,_ as be}from"./ErrorBlock.65239dfd.js";import{_ as we}from"./CodeBlock.45d0fc63.js";import"./index.58caa11d.js";const De={inbound:"Policies applied on incoming connection on address",outbound:"Policies applied on outgoing connection to the address",service:"Policies applied on outgoing connections to service",dataplane:"Policies applied on all incoming and outgoing connections to the selected data plane proxy"},Ie={name:"DataplanePolicies",components:{StatusInfo:j,AccordionList:Y,AccordionItem:F,KCard:R,KPop:q,KIcon:z,KBadge:H},props:{mesh:{type:String,required:!0},dppName:{type:String,required:!0}},data(){return{items:[],hasItems:!1,isLoading:!0,error:null,searchInput:"",POLICY_TYPE_SUBTITLE:De}},computed:{...Z({policiesByType:n=>n.policiesByType})},watch:{dppName(){this.fetchPolicies()}},mounted(){this.fetchPolicies()},methods:{async fetchPolicies(){this.error=null,this.isLoading=!0;try{const{items:n,total:i,kind:p}=await B.getDataplanePolicies({mesh:this.mesh,dppName:this.dppName});(p===void 0||p==="SidecarDataplane")&&(this.processItems(n),this.items=n,this.hasItems=i>0)}catch(n){this.error=n}finally{this.isLoading=!1}},processItems(n){for(const i of n){i.policyTypes={};for(const p in i.matchedPolicies){const y=this.policiesByType[p],u={pluralDisplayName:y.pluralDisplayName,policies:i.matchedPolicies[p]};for(const h of u.policies)h.route={name:y.path,query:{ns:h.name},params:{mesh:h.mesh}};i.policyTypes[p]=u}}}}},ke={class:"flex items-center justify-between"},Se={key:0,class:"text-lg"},Le={key:1,class:"text-lg"},Te={class:"subtitle"},Oe={key:0},Ce={key:1},xe={class:"flex flex-wrap justify-end"},Ee={class:"policy-wrapper"},Ke={class:"policy-type"};function $e(n,i,p,y,u,h){const T=b("KIcon"),D=b("KPop"),I=b("KBadge"),g=b("router-link"),k=b("AccordionItem"),S=b("AccordionList"),E=b("KCard"),K=b("StatusInfo");return e(),v(K,{"has-error":u.error!==null,"is-loading":u.isLoading,error:u.error,"is-empty":!u.hasItems},{default:o(()=>[d(E,{"border-variant":"noBorder"},{body:o(()=>[d(S,{"initially-open":[],"multiple-open":""},{default:o(()=>[(e(!0),l(_,null,f(u.items,(a,P)=>(e(),v(k,{key:P},{"accordion-header":o(()=>[s("div",ke,[s("div",null,[a.type==="dataplane"?(e(),l("p",Se," Dataplane ")):C("",!0),a.type!=="dataplane"?(e(),l("p",Le,c(a.service),1)):C("",!0),s("p",Te,[a.type==="inbound"||a.type==="outbound"?(e(),l("span",Oe,c(a.type)+" "+c(a.name),1)):a.type==="service"||a.type==="dataplane"?(e(),l("span",Ce,c(a.type),1)):C("",!0),d(D,{width:"300",placement:"right",trigger:"hover"},{content:o(()=>[s("div",null,c(u.POLICY_TYPE_SUBTITLE[a.type]),1)]),default:o(()=>[d(T,{icon:"help",size:"16",class:"ml-1"})]),_:2},1024)])]),s("div",xe,[(e(!0),l(_,null,f(a.matchedPolicies,(t,r)=>(e(),v(I,{key:`${P}-${r}`,class:"mr-2 mb-2"},{default:o(()=>[x(c(r),1)]),_:2},1024))),128))])])]),"accordion-content":o(()=>[s("div",Ee,[(e(!0),l(_,null,f(a.policyTypes,(t,r)=>(e(),l("div",{key:`${P}-${r}`,class:"policy-item"},[s("h4",Ke,c(t.pluralDisplayName),1),s("ul",null,[(e(!0),l(_,null,f(t.policies,(L,$)=>(e(),l("li",{key:`${P}-${r}-${$}`,class:"my-1","data-testid":"policy-name"},[d(g,{to:L.route},{default:o(()=>[x(c(L.name),1)]),_:2},1032,["to"])]))),128))])]))),128))])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["has-error","is-loading","error","is-empty"])}const Ae=W(Ie,[["render",$e],["__scopeId","data-v-7223f9a8"]]),M=n=>(te("data-v-8eb75baf"),n=n(),se(),n),Be={key:0},Me={class:"entity-status__label"},Ne=M(()=>s("span",{class:"entity-status__dot"},null,-1)),Ve={key:1},We=M(()=>s("h4",null,"Tags",-1)),Ye=M(()=>s("h4",null,"Versions",-1)),Fe={key:0},Re=x(" This data plane proxy does not yet have mTLS configured \u2014 "),Ue=["href"],je=U({__name:"DataPlaneDetails",props:{dataPlane:{type:Object,required:!0},dataPlaneOverview:{type:Object,required:!0}},setup(n){const i=n,p=ne(ue),y=[{hash:"#overview",title:"Overview"},{hash:"#insights",title:"DPP Insights"},{hash:"#dpp-policies",title:"Policies"},{hash:"#xds-configuration",title:"XDS Configuration"},{hash:"#envoy-stats",title:"Stats"},{hash:"#envoy-clusters",title:"Clusters"},{hash:"#mtls",title:"Certificate Insights"},{hash:"#yaml",title:"YAML"},{hash:"#warnings",title:"Warnings"}],u=O([]),h=w(()=>{const{type:a,name:P,mesh:t}=i.dataPlane,r=oe(i.dataPlane,i.dataPlaneOverview.dataplaneInsight);return{type:a,name:P,mesh:t,status:r}}),T=w(()=>N(i.dataPlane)),D=w(()=>le(i.dataPlaneOverview.dataplaneInsight)),I=w(()=>ie(i.dataPlane)),g=w(()=>re(i.dataPlaneOverview)),k=w(()=>{const a=Array.from(i.dataPlaneOverview.dataplaneInsight.subscriptions);return a.reverse(),a}),S=w(()=>{const a=p.getters.getKumaDocsVersion;return a!==null?a:"latest"}),E=w(()=>u.value.length===0?y.filter(a=>a.hash!=="#warnings"):y);async function K(){if(i.dataPlaneOverview.dataplaneInsight.subscriptions.length===0)return;const a=i.dataPlaneOverview.dataplaneInsight.subscriptions[0].version;if(a.kumaDp&&a.envoy){const t=J(a);t.kind!==Q&&t.kind!==X&&u.value.push(t)}if(p.getters["config/getMulticlusterStatus"]){const t=N(i.dataPlane),{compatible:r,payload:L}=await ee(t,a.kumaDp.version);r||u.value.push({kind:ae,payload:L})}}return K(),(a,P)=>(e(),v(fe,{tabs:m(E),"initial-tab-override":"overview"},{tabHeader:o(()=>[s("div",null,[s("h3",null," DPP: "+c(n.dataPlane.name),1)]),s("div",null,[d(he,{name:n.dataPlane.name,mesh:n.dataPlane.mesh},null,8,["name","mesh"])])]),overview:o(()=>[d(V,null,{default:o(()=>[s("div",null,[s("ul",null,[(e(!0),l(_,null,f(m(h),(t,r)=>(e(),l("li",{key:r},[s("h4",null,c(r),1),r==="status"&&typeof t!="string"?(e(),l("div",Be,[s("div",{class:G(["entity-status",{"is-offline":t.status.toString().toLowerCase()==="offline","is-degraded":t.status.toString().toLowerCase()==="partially degraded"}])},[s("span",Me,c(t.status),1)],2),(e(!0),l(_,null,f(t.reason,(L,$)=>(e(),l("div",{key:$,class:"reason"},[Ne,x(" "+c(L),1)]))),128))])):(e(),l("div",Ve,c(t),1))]))),128))])]),s("div",null,[We,s("p",null,[(e(!0),l(_,null,f(m(T),(t,r)=>(e(),l("span",{key:r,class:"tag-cols"},[s("span",null,c(t.label)+": ",1),s("span",null,c(t.value),1)]))),128))]),m(D)?(e(),l(_,{key:0},[Ye,s("p",null,[(e(!0),l(_,null,f(m(D),(t,r)=>(e(),l("span",{key:r,class:"tag-cols"},[s("span",null,c(r)+": ",1),s("span",null,c(t),1)]))),128))])],64)):C("",!0)])]),_:1})]),insights:o(()=>[d(j,{"is-empty":m(k).length===0},{default:o(()=>[d(m(R),{"border-variant":"noBorder"},{body:o(()=>[d(Y,{"initially-open":0},{default:o(()=>[(e(!0),l(_,null,f(m(k),(t,r)=>(e(),v(F,{key:r},{"accordion-header":o(()=>[d(_e,{details:t},null,8,["details"])]),"accordion-content":o(()=>[d(ye,{details:t,"is-discovery-subscription":""},null,8,["details"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["is-empty"])]),"dpp-policies":o(()=>[d(Ae,{mesh:n.dataPlane.mesh,"dpp-name":n.dataPlane.name},null,8,["mesh","dpp-name"])]),"xds-configuration":o(()=>[d(A,{"data-path":"xds",mesh:n.dataPlane.mesh,"dpp-name":n.dataPlane.name},null,8,["mesh","dpp-name"])]),"envoy-stats":o(()=>[d(A,{"data-path":"stats",mesh:n.dataPlane.mesh,"dpp-name":n.dataPlane.name},null,8,["mesh","dpp-name"])]),"envoy-clusters":o(()=>[d(A,{"data-path":"clusters",mesh:n.dataPlane.mesh,"dpp-name":n.dataPlane.name},null,8,["mesh","dpp-name"])]),mtls:o(()=>[d(V,null,{default:o(()=>[m(g)!==null?(e(),l("ul",Fe,[(e(!0),l(_,null,f(m(g),(t,r)=>(e(),l("li",{key:r},[s("h4",null,c(t.label),1),s("p",null,c(t.value),1)]))),128))])):(e(),v(m(ce),{key:1,appearance:"danger"},{alertMessage:o(()=>[Re,s("a",{href:`https://kuma.io/docs/${m(S)}/documentation/security/#certificates`,class:"external-link",target:"_blank"}," Learn About Certificates in "+c(m(de)),9,Ue)]),_:1}))]),_:1})]),yaml:o(()=>[d(ge,{content:m(I)},null,8,["content"])]),warnings:o(()=>[d(ve,{warnings:u.value},null,8,["warnings"])]),_:1},8,["tabs"]))}});const qe=W(je,[["__scopeId","data-v-8eb75baf"]]),ze={class:"component-frame"},oa=U({__name:"DataPlaneDetailView",setup(n){const i=pe(),p=O(null),y=O(null),u=O(!0),h=O(null),T={};async function D(){h.value=null,u.value=!0;const I=i.params.mesh,g=i.params.dataPlane,k=T;try{p.value=await B.getDataplaneFromMesh({mesh:I,name:g},k),y.value=await B.getDataplaneOverviewFromMesh({mesh:I,name:g},k)}catch(S){p.value=null,S instanceof Error?h.value=S:console.error(S)}finally{u.value=!1}}return me(()=>i.params.mesh,function(){i.name==="data-plane-detail-view"&&D()}),D(),(I,g)=>(e(),l("div",ze,[u.value?(e(),v(we,{key:0})):h.value!==null?(e(),v(Pe,{key:1,error:h.value},null,8,["error"])):p.value===null||y.value===null?(e(),v(be,{key:2})):(e(),v(qe,{key:3,"data-plane":p.value,"data-plane-overview":y.value},null,8,["data-plane","data-plane-overview"]))]))}});export{oa as default};
