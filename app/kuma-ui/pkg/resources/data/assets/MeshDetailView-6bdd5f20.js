import{d as O,c as d,o as l,e as y,h as n,g as u,u as K,r as R,w as i,b as h,G as P,q as A,F as I,s as V,a as _,R as T,t as B}from"./index-125a4644.js";import{g as q,p as S,s as N,D as L,f as F,m as G,e as W,A as z,q as H,_ as J}from"./RouteView.vue_vue_type_script_setup_true_lang-fb8eb0d5.js";import{D as j,a as M}from"./DefinitionListItem-11239d65.js";import{_ as Q}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-e0fb0021.js";import{T as U}from"./TextWithCopyButton-1d2d10ce.js";import{n as X}from"./notEmpty-7f452b20.js";import{_ as E}from"./DataSource.vue_vue_type_script_setup_true_lang-dc3089c8.js";import{_ as Y}from"./RouteTitle.vue_vue_type_script_setup_true_lang-b42523ab.js";import{_ as Z}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-2fd8f58c.js";import{E as tt}from"./ErrorBlock-4d3be51a.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-ecf54904.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-a90684ea.js";const et={class:"chart-box-list"},at=O({__name:"MeshCharts",props:{meshInsight:{type:Object,required:!0}},setup(k){const m=k,c=q(),g=d(()=>S([m.meshInsight])),b=d(()=>{const{total:e,online:t,partiallyDegraded:a}=g.value.dataplanes;return{total:e,online:t,partiallyDegraded:a,offline:e-t-a}}),w=d(()=>{const{total:e,internal:t,external:a}=g.value.services;return{total:e,internal:t,external:a}}),D=d(()=>g.value.dpVersions),x=d(()=>{const e=[],{internal:t,external:a}=w.value;return t&&e.push({title:c.t("common.charts.services.internalLabel"),data:t}),a&&e.push({title:c.t("common.charts.services.externalLabel"),data:a}),{title:c.t("common.charts.services.title"),showTotal:!0,dataPoints:e}}),v=d(()=>{const e=[],{total:t,online:a,partiallyDegraded:s}=b.value;if(t>0){e.push({title:c.t("http.api.value.online"),statusKeyword:"online",data:a}),s>0&&e.push({title:c.t("http.api.value.partially_degraded"),statusKeyword:"partially_degraded",data:s});const o=t-s-a;o>0&&e.push({title:c.t("http.api.value.offline"),statusKeyword:"offline",data:o})}return{title:c.t("common.charts.dataPlaneProxies.title"),showTotal:!0,dataPoints:e}}),C=d(()=>{const e=Object.entries(D.value.kumaDp).map(([t,a])=>({title:t,data:a.total??0}));return e.sort((t,a)=>t.title==="unknown"?1:a.title==="unknown"?-1:N(t.title,a.title)),{title:c.t("common.charts.kumaDp.title"),subtitle:c.t("common.charts.kumaDp.subtitle"),dataPoints:e}}),$=d(()=>{const e=Object.entries(D.value.envoy).map(([t,a])=>({title:t,data:a.total??0}));return e.sort((t,a)=>t.title==="unknown"?1:a.title==="unknown"?-1:N(t.title,a.title)),{title:c.t("common.charts.envoy.title"),subtitle:c.t("common.charts.envoy.subtitle"),dataPoints:e}});return(e,t)=>(l(),y("div",et,[n(L,{data:x.value},null,8,["data"]),u(),n(L,{data:v.value},null,8,["data"]),u(),n(L,{data:C.value},null,8,["data"]),u(),n(L,{data:$.value},null,8,["data"])]))}});const st=F(at,[["__scopeId","data-v-19ba3cca"]]),nt={class:"stack"},rt={class:"columns"},ot=O({__name:"MeshDetails",props:{mesh:{type:Object,required:!0},meshInsight:{type:Object,required:!0}},setup(k){const m=k,{t:c,formatIsoDate:g}=q(),b=G(),w=K(),D=W(),x=d(()=>{const{name:s,creationTime:o,modificationTime:f}=m.mesh;return{name:s,created:g(o),modified:g(f),"Data Plane Proxies":m.meshInsight.dataplanes.total}}),v=d(()=>{var s;return!!((s=m.mesh.routing)!=null&&s.localityAwareLoadBalancing)}),C=d(()=>({mtls:t(m.mesh,"mtls"),logging:t(m.mesh,"logging"),metrics:t(m.mesh,"metrics"),tracing:t(m.mesh,"tracing")})),$=d(()=>Object.values(m.meshInsight.policies??{}).reduce((s,o)=>s+o.total,0)),e=d(()=>Object.entries(m.meshInsight.policies??{}).map(([s,o])=>{const f=D.state.policyTypesByName[s];return f&&o.total!==0?{name:f.name,path:f.path,total:o.total}:null}).filter(X));function t(s,o){if(s[o]===void 0)return"";const f=s[o].enabledBackend??s[o].defaultBackend??s[o].backends[0].name,r=s[o].backends.find(p=>p.name===f);return`${r.type} / ${r.name}`}async function a(s){const o=w.params.mesh;return await b.getMesh({name:o},s)}return(s,o)=>{const f=R("router-link");return l(),y("div",nt,[n(h(P),null,{body:i(()=>[n(st,{"mesh-insight":k.meshInsight},null,8,["mesh-insight"])]),_:1}),u(),n(h(P),null,{body:i(()=>[A("div",rt,[n(j,null,{default:i(()=>[(l(!0),y(I,null,V(x.value,(r,p)=>(l(),_(M,{key:p,term:h(c)(`http.api.property.${p}`)},{default:i(()=>[typeof r=="boolean"?(l(),_(h(T),{key:0,appearance:r?"success":"danger"},{default:i(()=>[u(B(r?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):p==="name"&&typeof r=="string"?(l(),_(U,{key:1,text:r},null,8,["text"])):(l(),y(I,{key:2},[u(B(r),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),u(),n(j,null,{default:i(()=>[(l(!0),y(I,null,V(C.value,(r,p)=>(l(),_(M,{key:p,term:h(c)(`http.api.property.${p}`)},{default:i(()=>[r===""?(l(),_(h(T),{key:0,appearance:"danger"},{default:i(()=>[u(`
                Disabled
              `)]),_:1})):(l(),y(I,{key:1},[u(B(r),1)],64))]),_:2},1032,["term"]))),128)),u(),n(M,{term:h(c)("http.api.property.localityAwareLoadBalancing")},{default:i(()=>[n(h(T),{appearance:v.value?"success":"danger"},{default:i(()=>[u(B(v.value?"Enabled":"Disabled"),1)]),_:1},8,["appearance"])]),_:1},8,["term"])]),_:1}),u(),n(j,null,{default:i(()=>[n(M,{term:`Policies (${$.value})`},{default:i(()=>[A("ul",null,[(l(!0),y(I,null,V(e.value,(r,p)=>(l(),y("li",{key:p},[n(f,{to:{name:"policies-list-view",params:{policyPath:r.path}}},{default:i(()=>[u(B(r.name)+": "+B(r.total),1)]),_:2},1032,["to"])]))),128))])]),_:1},8,["term"])]),_:1})])]),_:1}),u(),n(h(P),null,{body:i(()=>{var r;return[n(Q,{id:"code-block-mesh","resource-fetcher":a,"resource-fetcher-watch-key":((r=k.mesh)==null?void 0:r.name)||null},null,8,["resource-fetcher-watch-key"])]}),_:1})])}}}),vt=O({__name:"MeshDetailView",setup(k){const{t:m}=q();return(c,g)=>(l(),_(J,{name:"mesh-overview-view"},{default:i(({route:b})=>[n(Y,{title:h(m)("meshes.routes.overview.title")},null,8,["title"]),u(),n(z,null,{default:i(()=>[n(E,{src:`/meshes/${b.params.mesh}`},{default:i(({data:w,isLoading:D,error:x})=>[n(E,{src:`/mesh-insights/${b.params.mesh}`},{default:i(({data:v,isLoading:C,error:$})=>[D||C?(l(),_(H,{key:0})):x??$?(l(),_(tt,{key:1,error:x??$},null,8,["error"])):w===void 0||v===void 0?(l(),_(Z,{key:2})):(l(),_(ot,{key:3,mesh:w,"mesh-insight":v,"data-testid":"detail-view-details"},null,8,["mesh","mesh-insight"]))]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1024)]),_:1}))}});export{vt as default};
