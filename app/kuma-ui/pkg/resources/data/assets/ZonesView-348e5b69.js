import{M as R}from"./kongponents.es-5ca9e130.js";import{d as U,u as j,r as n,v as H,y as J,z as D,j as _,b as E,e as T,i as K,g as V,w as O,h as W,f as B,A as X,B as L,o as u}from"./index-6ef061d4.js";import{_ as ee}from"./MultizoneInfo.vue_vue_type_script_setup_true_lang-806aea7f.js";import{_ as ae}from"./ZoneDetails.vue_vue_type_script_setup_true_lang-a856acfb.js";import{D as te}from"./DataOverview-273e56b2.js";import{u as se}from"./store-444aa12f.js";import{u as ne}from"./index-8eaa4fe5.js";import{Q as M}from"./QueryParameter-70743f73.js";import"./AccordionList-fc691476.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-cadc6770.js";import"./DefinitionListItem-97bb646e.js";import"./ErrorBlock-5ce00c3e.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-431ef500.js";import"./SubscriptionHeader.vue_vue_type_script_setup_true_lang-60a557a2.js";import"./TabsWidget-a1cf8c62.js";import"./datadogLogEvents-302eea7b.js";import"./WarningsWidget.vue_vue_type_script_setup_true_lang-b038c61c.js";import"./TagList-2830199d.js";import"./StatusBadge-310603a4.js";const oe={class:"zones"},re={key:1,class:"kcard-stack"},le={class:"kcard-border"},ie={key:0,class:"kcard-border"},Ne=U({__name:"ZonesView",props:{selectedZoneName:{type:String,required:!1,default:null},offset:{type:Number,required:!1,default:0}},setup(P){const g=P,o=ne(),q={title:"No Data",message:"There are no Zones present."},y=j(),z=se(),c=n(!0),l=n(!1),h=n(null),w=n(!0),f=n(!1),b=n(!1),m=n(!1),v=n({headers:[{label:"Status",key:"status"},{label:"Name",key:"name"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Storage type",key:"storeType"},{label:"Ingress",key:"hasIngress"},{label:"Egress",key:"hasEgress"},{label:"Warnings",key:"warnings",hideLabel:!0}],data:[]}),i=n(null),I=n(null),S=n(g.offset),Z=n(new Set),C=n(new Set);H(()=>y.params.mesh,function(){y.name==="zone-list-view"&&(c.value=!0,l.value=!1,w.value=!0,f.value=!1,b.value=!1,m.value=!1,h.value=null,N(0))}),J(function(){N(g.offset)});function N(e){z.getters["config/getMulticlusterStatus"]&&A(e)}function Y(e){var d;let a="-",s="",t=!0;(((d=e.zoneInsight)==null?void 0:d.subscriptions)??[]).forEach(r=>{if(r.version&&r.version.kumaCp){a=r.version.kumaCp.version;const{kumaCpGlobalCompatible:Q=!0}=r.version.kumaCp;t=Q,r.config&&(s=JSON.parse(r.config).store.type)}});const k=X(e.zoneInsight);return{...e,status:k,zoneCpVersion:a,storeType:s,hasIngress:Z.value.has(e.name)?"Yes":"No",hasEgress:C.value.has(e.name)?"Yes":"No",withWarnings:!t}}function $(e){const a=new Set;e.forEach(({zoneIngress:{zone:s}})=>{a.add(s)}),Z.value=a}function F(e){const a=new Set;e.forEach(({zoneEgress:{zone:s}})=>{a.add(s)}),C.value=a}async function A(e){S.value=e,M.set("offset",e>0?e:null),c.value=!0,l.value=!1;const a=y.query.ns||null,s=L;try{const[{data:t,next:p},{items:k},{items:d}]=await Promise.all([G(a,s,e),D(o.getAllZoneIngressOverviews.bind(o)),D(o.getAllZoneEgressOverviews.bind(o))]);I.value=p,t.length?($(k),F(d),v.value.data=t.map(Y),m.value=!1,l.value=!1,await x({name:g.selectedZoneName??t[0].name})):(v.value.data=[],m.value=!0,l.value=!0,f.value=!0)}catch(t){t instanceof Error?h.value=t:console.error(t),l.value=!0}finally{c.value=!1}}async function x({name:e}){b.value=!1,w.value=!0,f.value=!1;try{i.value=await o.getZoneOverview({name:e}),M.set("zone",e)}catch(a){console.error(a),i.value=null,b.value=!0,f.value=!0}finally{w.value=!1}}async function G(e,a,s){if(e)return{data:[await o.getZoneOverview({name:e},{size:a,offset:s})],next:null};{const{items:t,next:p}=await o.getAllZoneOverviews({size:a,offset:s});return{data:t??[],next:p}}}return(e,a)=>{var s;return u(),_("div",oe,[E(z).getters["config/getMulticlusterStatus"]===!1?(u(),T(ee,{key:0})):(u(),_("div",re,[K("div",le,[V(te,{"selected-entity-name":(s=i.value)==null?void 0:s.name,"page-size":E(L),"is-loading":c.value,error:h.value,"empty-state":q,"table-data":v.value,"table-data-is-empty":m.value,"show-warnings":v.value.data.some(t=>t.withWarnings),next:I.value,"page-offset":S.value,onTableAction:x,onLoadData:A},{additionalControls:O(()=>[e.$route.query.ns?(u(),T(E(R),{key:0,class:"back-button",appearance:"primary",icon:"arrowLeft",to:{name:"zone-list-view"}},{default:O(()=>[W(`
              View all
            `)]),_:1})):B("",!0)]),_:1},8,["selected-entity-name","page-size","is-loading","error","table-data","table-data-is-empty","show-warnings","next","page-offset"])]),W(),i.value!==null?(u(),_("div",ie,[V(ae,{"zone-overview":i.value},null,8,["zone-overview"])])):B("",!0)]))])}}});export{Ne as default};
