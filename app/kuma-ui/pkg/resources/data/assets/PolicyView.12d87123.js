import{d as z,o as c,c as L,w as r,a as g,u as t,m as ee,b as i,O as H,r as a,e as q,f as W,g as ae,k as I,h as te,i as P,j as l,l as se,v as le,F as j,n as K,t as N,p as ne,q as oe,s as re,P as U,x as ie,y as ue,z as ce,A as C,B as pe,C as G,D as me,E as de,G as ye}from"./index.7a1b9f3b.js";import{p as ve,D as he}from"./patchQueryParam.15c2e324.js";import{F as fe}from"./FrameSkeleton.945e359a.js";import{_ as Q}from"./LabelList.vue_vue_type_style_index_0_lang.2f98ab4d.js";import{T as _e}from"./TabsWidget.c3964153.js";import{_ as ge}from"./YamlView.vue_vue_type_script_setup_true_lang.6cc595be.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.9d4cddf8.js";import"./ErrorBlock.471a1209.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.4715809d.js";import"./StatusBadge.3c5db700.js";import"./TagList.84f5f0a1.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.9bb3d75c.js";import"./_commonjsHelpers.f037b798.js";const be=z({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(v){const p=v;return(T,E)=>(c(),L(t(H),{class:"docs-link",appearance:"outline",target:"_blank",to:p.href},{default:r(()=>[g(t(ee),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),i(`

    Documentation
  `)]),_:1},8,["to"]))}}),ke=l("h4",null,"Dataplanes",-1),we=z({__name:"PolicyConnections",props:{mesh:{type:String,required:!0},policyType:{type:String,required:!0},policyName:{type:String,required:!0}},setup(v){const p=v,T=a(!1),E=a(!0),h=a(!1),b=a([]),f=a(""),k=q(()=>{const n=f.value.toLowerCase();return b.value.filter(({dataplane:o})=>o.name.toLowerCase().includes(n))});W(()=>p.policyName,function(){_()}),ae(function(){_()});async function _(){h.value=!1,E.value=!0;try{const{items:n,total:o}=await I.getPolicyConnections({mesh:p.mesh,policyType:p.policyType,policyName:p.policyName});T.value=o>0,b.value=n!=null?n:[]}catch{h.value=!0}finally{E.value=!1}}return(n,o)=>{const w=te("router-link");return c(),P("div",null,[g(Q,{"has-error":h.value,"is-loading":E.value,"is-empty":!T.value},{default:r(()=>[l("ul",null,[l("li",null,[ke,i(),se(l("input",{id:"dataplane-search","onUpdate:modelValue":o[0]||(o[0]=m=>f.value=m),type:"text",class:"k-input mb-4",placeholder:"Filter by name",required:"","data-testid":"dataplane-search-input"},null,512),[[le,f.value]]),i(),(c(!0),P(j,null,K(t(k),(m,D)=>(c(),P("p",{key:D,class:"my-1","data-testid":"dataplane-name"},[g(w,{to:{name:"data-plane-detail-view",params:{mesh:m.dataplane.mesh,dataPlane:m.dataplane.name}}},{default:r(()=>[i(N(m.dataplane.name),1)]),_:2},1032,["to"])]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])])}}}),De=v=>(me("data-v-287fec2a"),v=v(),de(),v),Pe={key:0,class:"mb-4"},Ee=De(()=>l("p",null,[l("strong",null,"Warning"),i(` This policy is experimental. If you encountered any problem please open an
            `),l("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),xe={class:"entity-heading","data-testid":"policy-single-entity"},Se={"data-testid":"policy-overview-tab"},Ce={class:"config-wrapper"},Ne=z({__name:"PolicyView",props:{policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(v){const p=v,T=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],E=ne(),h=oe(),b=re(),f=a(!0),k=a(!1),_=a(null),n=a(!0),o=a(!1),w=a(!1),m=a(!1),D=a({}),x=a(null),$=a(null),B=a(p.offset),A=a({headers:[{label:"Actions",key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Type",key:"type"}],data:[]}),d=q(()=>b.state.policiesByPath[p.policyPath]),Z=q(()=>b.state.policies.map(e=>{var s;return{length:(s=b.state.sidebar.insights.mesh.policies[e.name])!=null?s:0,label:e.pluralDisplayName,value:e.path,selected:e.path===h.name}})),J=q(()=>`https://kuma.io/docs/${b.getters["config/getKumaDocsVersion"]}/policies/${d.value.path}/`);W(()=>h.params.mesh,function(){h.name===p.policyPath&&(f.value=!0,k.value=!1,n.value=!0,o.value=!1,w.value=!1,m.value=!1,_.value=null,F(0))}),F(p.offset);async function F(e){var R;B.value=e,ve("offset",e>0?e:null),f.value=!0,_.value=null;const s=h.query.ns||null,u=h.params.mesh,S=d.value.path;try{let y;if(u!==null&&s!==null)y=[await I.getSinglePolicyEntity({mesh:u,path:S,name:s})],$.value=null;else{const V={size:U,offset:e},M=await I.getAllPolicyEntitiesFromMesh({mesh:u,path:S},V);y=(R=M.items)!=null?R:[],$.value=M.next}y.length>0?(A.value.data=y.map(V=>Y(V)),m.value=!1,k.value=!1,await O({mesh:y[0].mesh,name:y[0].name,path:S})):(A.value.data=[],m.value=!0,k.value=!0,o.value=!0)}catch(y){y instanceof Error?_.value=y:console.error(y),k.value=!0}finally{f.value=!1,n.value=!1}}function X(e){E.push({name:e.value})}function Y(e){if(!e.mesh)return e;const s=e,u={name:"mesh-detail-view",params:{mesh:e.mesh}};return s.meshRoute=u,s}async function O(e){w.value=!1,n.value=!0,o.value=!1;try{const s=await I.getSinglePolicyEntity({mesh:e.mesh,path:d.value.path,name:e.name});if(s){const u=["type","name","mesh"];D.value=ie(s,u),x.value=ue(s)}else D.value={},o.value=!0}catch(s){w.value=!0,console.error(s)}finally{n.value=!1}}return(e,s)=>t(d)?(c(),P("div",{key:0,class:G(["relative",t(d).path])},[t(d).isExperimental?(c(),P("div",Pe,[g(t(ce),{appearance:"warning"},{alertMessage:r(()=>[Ee]),_:1})])):C("",!0),i(),g(fe,null,{default:r(()=>[g(he,{"selected-entity-name":D.value.name,"page-size":t(U),error:_.value,"is-loading":f.value,"empty-state":{title:"No Data",message:`There are no ${t(d).pluralDisplayName} present.`},"table-data":A.value,"table-data-is-empty":m.value,next:$.value,"page-offset":B.value,onTableAction:O,onLoadData:F},{additionalControls:r(()=>[g(t(pe),{label:"Policies",items:t(Z),"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:X},{"item-template":r(({item:u})=>[l("span",{class:G({"policy-type-empty":u.length===0})},N(u.label),3)]),_:1},8,["items"]),i(),g(be,{href:t(J),"data-testid":"policy-documentation-link"},null,8,["href"]),i(),e.$route.query.ns?(c(),L(t(H),{key:0,class:"back-button",appearance:"primary",icon:"arrowLeft",to:{name:t(d).path}},{default:r(()=>[i(`
            View all
          `)]),_:1},8,["to"])):C("",!0)]),default:r(()=>[i(`
        >
        `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"]),i(),k.value===!1?(c(),L(_e,{key:0,"has-error":_.value!==null,error:_.value,"is-loading":f.value,tabs:T,"initial-tab-override":"overview"},{tabHeader:r(()=>[l("h1",xe,N(t(d).singularDisplayName)+": "+N(D.value.name),1)]),overview:r(()=>[g(Q,{"has-error":w.value,"is-loading":n.value,"is-empty":o.value},{default:r(()=>[l("div",Se,[l("ul",null,[(c(!0),P(j,null,K(D.value,(u,S)=>(c(),P("li",{key:S},[l("h4",null,N(S),1),i(),l("p",null,N(u),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"]),i(),l("div",Ce,[x.value!==null?(c(),L(ge,{key:0,id:"code-block-policy","has-error":w.value,"is-loading":n.value,"is-empty":o.value,content:x.value,"is-searchable":""},null,8,["has-error","is-loading","is-empty","content"])):C("",!0)])]),"affected-dpps":r(()=>[x.value!==null?(c(),L(we,{key:0,mesh:x.value.mesh,"policy-name":x.value.name,"policy-type":t(d).path},null,8,["mesh","policy-name","policy-type"])):C("",!0)]),_:1},8,["has-error","error","is-loading"])):C("",!0)]),_:1})],2)):C("",!0)}});const Ge=ye(Ne,[["__scopeId","data-v-287fec2a"]]);export{Ge as default};
