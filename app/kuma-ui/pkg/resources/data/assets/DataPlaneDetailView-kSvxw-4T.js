import{_ as R,a as h,o,b as v,w as a,r as E,m as s,f as t,d as G,l as at,q as N,p as d,t as i,e as r,F as f,c as u,H as x,n as nt,B as st,M as ot,Z as I,$ as it,a0 as lt,K as z,W as rt,a1 as dt,a2 as W,X as Y,a3 as ct,A as ut,a4 as pt,D as _t,x as mt,y as ft}from"./index-VS3FVx2q.js";import{S as vt}from"./StatusBadge-9jbSxL4n.js";import{S as yt}from"./SummaryView-7zYd_0GU.js";import{T as Q}from"./TagList-hLd44SLU.js";import{_ as gt}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-lfiepn_F.js";import"./AccordionList-okKhkqiP.js";const ht=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],kt=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],bt=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],$t=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],X=(c,n,e)=>{let b=c;return typeof n=="string"||Array.isArray(n)?b=c.toLocaleString(n,e):(n===!0||e!==void 0)&&(b=c.toLocaleString(void 0,e)),b};function O(c,n){if(!Number.isFinite(c))throw new TypeError(`Expected a finite number, got ${typeof c}: ${c}`);n={bits:!1,binary:!1,space:!0,...n};const e=n.bits?n.binary?$t:bt:n.binary?kt:ht,b=n.space?" ":"";if(n.signed&&c===0)return` 0${b}${e[0]}`;const B=c<0,D=B?"-":n.signed?"+":"";B&&(c=-c);let g;if(n.minimumFractionDigits!==void 0&&(g={minimumFractionDigits:n.minimumFractionDigits}),n.maximumFractionDigits!==void 0&&(g={maximumFractionDigits:n.maximumFractionDigits,...g}),c<1){const V=X(c,n.locale,g);return D+V+b+e[0]}const $=Math.min(Math.floor(n.binary?Math.log(c)/Math.log(1024):Math.log10(c)/3),e.length-1);c/=(n.binary?1024:1e3)**$,g||(c=c.toPrecision(3));const T=X(Number(c),n.locale,g),K=e[$];return D+T+b+K}const xt={},wt={class:"card"},Bt={class:"title"},Ct={class:"body"};function Tt(c,n){const e=h("KCard");return o(),v(e,{class:"data-card"},{default:a(()=>[s("dl",null,[s("div",wt,[s("dt",Bt,[E(c.$slots,"title",{},void 0,!0)]),t(),s("dd",Ct,[E(c.$slots,"default",{},void 0,!0)])])])]),_:3})}const tt=R(xt,[["render",Tt],["__scopeId","data-v-3f9a3cf3"]]),It={class:"title"},St={key:0},Dt=G({__name:"ConnectionCard",props:{protocol:{},service:{default:""},traffic:{default:void 0},direction:{default:"downstream"}},setup(c){const{t:n}=at(),e=c,b=B=>{const D=B.target;if(B.isTrusted&&D.nodeName.toLowerCase()!=="a"){const g=D.closest(".service-traffic-card, a");if(g){const $=g.nodeName.toLowerCase()==="a"?g:g.querySelector("[data-action]");$!==null&&"click"in $&&typeof $.click=="function"&&$.click()}}};return(B,D)=>{const g=h("KBadge"),$=h("KSkeletonBox");return o(),v(tt,{class:"service-traffic-card",onClick:b},{title:a(()=>[e.service.length>0?(o(),v(Q,{key:0,tags:[{label:"kuma.io/service",value:e.service}]},null,8,["tags"])):N("",!0),t(),s("div",It,[r(g,{class:"protocol",appearance:e.protocol==="passthrough"?"success":"info"},{default:a(()=>[t(i(d(n)(`data-planes.components.service_traffic_card.protocol.${e.protocol}`,{},{defaultMessage:d(n)(`http.api.value.${e.protocol}`)})),1)]),_:1},8,["appearance"]),t(),E(B.$slots,"default",{},void 0,!0)])]),default:a(()=>{var T,K,V,P,L,q,U,A,F;return[t(),e.traffic?(o(),u("dl",St,[e.protocol==="passthrough"?(o(!0),u(f,{key:0},x([["http","tcp"].reduce((p,m)=>{var S;const y=e.direction;return Object.entries(((S=e.traffic)==null?void 0:S[m])||{}).reduce((M,[l,_])=>[`${y}_cx_tx_bytes_total`,`${y}_cx_rx_bytes_total`].includes(l)?{...M,[l]:_+(M[l]??0)}:M,p)},{})],(p,m)=>(o(),u(f,{key:m},[s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,i(d(O)(p.downstream_cx_rx_bytes_total??0)),1)]),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,i(d(O)(p.downstream_cx_tx_bytes_total??0)),1)])],64))),128)):e.protocol==="grpc"?(o(),u(f,{key:1},[s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.grpc_success")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:((T=e.traffic.grpc)==null?void 0:T.success)??0})),1)]),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.grpc_failure")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:((K=e.traffic.grpc)==null?void 0:K.failure)??0})),1)])],64)):e.protocol.startsWith("http")?(o(),u(f,{key:2},[(o(!0),u(f,null,x([((V=e.traffic.http)==null?void 0:V[`${e.direction}_rq_1xx`])??0].filter(p=>p!==0),p=>(o(),u("div",{key:p},[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.1xx")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:p})),1)]))),128)),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.2xx")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:((P=e.traffic.http)==null?void 0:P[`${e.direction}_rq_2xx`])??0})),1)]),t(),(o(!0),u(f,null,x([((L=e.traffic.http)==null?void 0:L[`${e.direction}_rq_3xx`])??0].filter(p=>p!==0),p=>(o(),u("div",{key:p},[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.3xx")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:p})),1)]))),128)),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.4xx")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:((q=e.traffic.http)==null?void 0:q[`${e.direction}_rq_4xx`])??0})),1)]),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.5xx")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:((U=e.traffic.http)==null?void 0:U[`${e.direction}_rq_5xx`])??0})),1)])],64)):(o(),u(f,{key:3},[s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,i(d(O)(((A=e.traffic.tcp)==null?void 0:A[`${e.direction}_cx_rx_bytes_total`])??0)),1)]),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,i(d(O)(((F=e.traffic.tcp)==null?void 0:F[`${e.direction}_cx_tx_bytes_total`])??0)),1)])],64))])):(o(),v($,{key:1,width:"10"}))]}),_:3})}}}),Z=R(Dt,[["__scopeId","data-v-835f2ea7"]]),Kt={class:"body"},Nt=G({__name:"ConnectionGroup",props:{type:{}},setup(c){const n=c;return(e,b)=>{const B=h("KCard");return o(),v(B,{class:nt(["service-traffic-group",`type-${n.type}`])},{default:a(()=>[s("div",Kt,[E(e.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}}),H=R(Nt,[["__scopeId","data-v-9402d5d1"]]),Et={class:"service-traffic"},Vt={class:"actions"},Mt=G({__name:"ConnectionTraffic",setup(c){return(n,e)=>(o(),u("div",Et,[s("div",Vt,[E(n.$slots,"actions",{},void 0,!0)]),t(),r(tt,{class:"header"},{title:a(()=>[E(n.$slots,"title",{},void 0,!0)]),_:3}),t(),E(n.$slots,"default",{},void 0,!0)]))}}),J=R(Mt,[["__scopeId","data-v-e6bd176c"]]),Rt=c=>(mt("data-v-59947235"),c=c(),ft(),c),Pt={"data-testid":"dataplane-warnings"},Lt=["data-testid","innerHTML"],qt={key:0,"data-testid":"warning-stats-loading"},Ut={class:"stack","data-testid":"dataplane-details"},At={class:"columns"},Ft={class:"status-with-reason"},Ot={class:"columns"},Gt=Rt(()=>s("span",null,"Outbounds",-1)),zt={"data-testid":"dataplane-mtls"},Yt={class:"columns"},Zt=["innerHTML"],Ht={key:0,"data-testid":"dataplane-subscriptions"},jt=G({__name:"DataPlaneDetailView",props:{data:{}},setup(c){const n=st(),e=c,b=ot(()=>e.data.warnings.concat(...e.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(B,D)=>{const g=h("KTooltip"),$=h("DataCollection"),T=h("KCard"),K=h("RouterLink"),V=h("KInputSwitch"),P=h("KButton"),L=h("RouterView"),q=h("KAlert"),U=h("AppView"),A=h("DataSource"),F=h("RouteView");return o(),v(F,{params:{mesh:"",dataPlane:"",inactive:!1},name:"data-plane-detail-view"},{default:a(({route:p,t:m})=>[r(A,{src:`/meshes/${p.params.mesh}/dataplanes/${p.params.dataPlane}/stats/${e.data.dataplane.networking.address}`},{default:a(({data:y,error:S,refresh:M})=>[r(U,null,Y({default:a(()=>[t(),s("div",Ut,[r(T,null,{default:a(()=>[s("div",At,[r(I,null,{title:a(()=>[t(i(m("http.api.property.status")),1)]),body:a(()=>[s("div",Ft,[r(vt,{status:e.data.status},null,8,["status"]),t(),e.data.dataplaneType==="standard"?(o(),v($,{key:0,items:e.data.dataplane.networking.inbounds,predicate:l=>!l.health.ready,empty:!1},{default:a(({items:l})=>[r(g,{class:"reason-tooltip"},{content:a(()=>[s("ul",null,[(o(!0),u(f,null,x(l,_=>(o(),u("li",{key:`${_.service}:${_.port}`},i(m("data-planes.routes.item.unhealthy_inbound",{service:_.service,port:_.port})),1))),128))])]),default:a(()=>[r(d(it),{color:d(lt),size:d(z)},null,8,["color","size"]),t()]),_:2},1024)]),_:2},1032,["items","predicate"])):N("",!0)])]),_:2},1024),t(),r(I,null,{title:a(()=>[t(i(m("data-planes.routes.item.last_updated")),1)]),body:a(()=>[t(i(m("common.formats.datetime",{value:Date.parse(e.data.modificationTime)})),1)]),_:2},1024),t(),e.data.dataplane.networking.gateway?(o(),u(f,{key:0},[r(I,null,{title:a(()=>[t(i(m("http.api.property.tags")),1)]),body:a(()=>[r(Q,{tags:e.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024),t(),r(I,null,{title:a(()=>[t(i(m("http.api.property.address")),1)]),body:a(()=>[r(rt,{text:`${e.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024)],64)):N("",!0)])]),_:2},1024),t(),r(T,{class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[s("div",Ot,[r(J,null,{title:a(()=>[r(d(dt),{display:"inline-block",decorative:"",size:d(z)},null,8,["size"]),t(`
                  Inbounds
                `)]),default:a(()=>[t(),r(H,{type:"inbound"},{default:a(()=>[(o(!0),u(f,null,x([e.data.dataplane.networking.type==="gateway"?Object.entries((y==null?void 0:y.inbounds)??{}).reduce((l,[_,w])=>{var j;const[C,k]=_.split("_");return k===(((j=e.data.dataplane.networking.admin)==null?void 0:j.port)??"9901")?l:l.concat([{...e.data.dataplane.networking.inbounds[0],name:_,port:Number(k),protocol:["http","tcp"].find(et=>typeof w[et]<"u")??"tcp",addressPort:`${e.data.dataplane.networking.inbounds[0].address}:${k}`}])},[]):e.data.dataplane.networking.inbounds],l=>(o(),v($,{key:l,items:l},Y({default:a(()=>[(o(!0),u(f,null,x(l,_=>(o(),u(f,{key:`${_.name}`},[(o(!0),u(f,null,x([y==null?void 0:y.inbounds[_.name]],w=>(o(),v(Z,{key:w,protocol:_.protocol,service:_.tags["kuma.io/service"],traffic:typeof S>"u"?w:{name:"",protocol:_.protocol,port:`${_.port}`}},{default:a(()=>[(o(!0),u(f,null,x([`${_.name.replace("_",":")}`],C=>(o(),v(K,{key:C,"data-action":"",to:{name:(k=>k.includes("bound")?k.replace("-outbound-","-inbound-"):"connection-inbound-summary-overview-view")(String(d(n).name)),params:{service:C},query:{inactive:p.params.inactive?null:void 0}}},{default:a(()=>[t(i(C),1)]),_:2},1032,["to"]))),128))]),_:2},1032,["protocol","service","traffic"]))),128))],64))),128))]),_:2},[e.data.dataplaneType==="delegated"?{name:"empty",fn:a(()=>[r(W,null,{default:a(()=>[t(`
                          This proxy is a delegated gateway therefore `+i(m("common.product.name"))+` does not have any visibility into inbounds for this gateway
                        `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items"]))),128))]),_:2},1024)]),_:2},1024),t(),r(J,null,Y({title:a(()=>[r(d(ct),{display:"inline-block",decorative:"",size:d(z)},null,8,["size"]),t(),Gt]),default:a(()=>[t(),t(),typeof S>"u"?(o(),u(f,{key:0},[typeof y>"u"?(o(),v(ut,{key:0})):(o(),u(f,{key:1},x(["upstream"],l=>(o(),u(f,{key:l},[r(H,{type:"passthrough"},{default:a(()=>[r(Z,{protocol:"passthrough",traffic:y.passthrough},{default:a(()=>[t(`
                          Non mesh traffic
                        `)]),_:2},1032,["traffic"])]),_:2},1024),t(),r($,{predicate:p.params.inactive?void 0:([_,w])=>{var C,k;return((typeof w.tcp<"u"?(C=w.tcp)==null?void 0:C[`${l}_cx_rx_bytes_total`]:(k=w.http)==null?void 0:k[`${l}_rq_total`])??0)>0},items:Object.entries(y.outbounds)},{default:a(({items:_})=>[_.length>0?(o(),v(H,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[(o(!0),u(f,null,x(_,([w,C])=>(o(),v(Z,{key:`${w}`,protocol:["grpc","http","tcp"].find(k=>typeof C[k]<"u")??"tcp",traffic:C,direction:l},{default:a(()=>[r(K,{"data-action":"",to:{name:(k=>k.includes("bound")?k.replace("-inbound-","-outbound-"):"connection-outbound-summary-overview-view")(String(d(n).name)),params:{service:w},query:{inactive:p.params.inactive?null:void 0}}},{default:a(()=>[t(i(w),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","direction"]))),128))]),_:2},1024)):N("",!0)]),_:2},1032,["predicate","items"])],64))),64))],64)):(o(),v(W,{key:1}))]),_:2},[y?{name:"actions",fn:a(()=>[r(V,{modelValue:p.params.inactive,"onUpdate:modelValue":l=>p.params.inactive=l,"data-testid":"dataplane-outbounds-inactive-toggle"},{label:a(()=>[t(`
                      Show inactive
                    `)]),_:2},1032,["modelValue","onUpdate:modelValue"]),t(),r(P,{appearance:"primary",onClick:M},{default:a(()=>[r(d(pt)),t(`

                    Refresh
                  `)]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)])]),_:2},1024),t(),r(L,null,{default:a(l=>[l.route.name!==p.name?(o(),v(yt,{key:0,width:"670px",onClose:function(_){p.replace({name:"data-plane-detail-view",params:{mesh:p.params.mesh,dataPlane:p.params.dataPlane},query:{inactive:p.params.inactive?null:void 0}})}},{default:a(()=>[(o(),v(_t(l.Component),{data:l.route.name.includes("-inbound-")?e.data.dataplane.networking.inbounds:(y==null?void 0:y.outbounds)||{},"dataplane-overview":e.data},null,8,["data","dataplane-overview"]))]),_:2},1032,["onClose"])):N("",!0)]),_:2},1024),t(),s("div",zt,[s("h2",null,i(m("data-planes.routes.item.mtls.title")),1),t(),e.data.dataplaneInsight.mTLS?(o(!0),u(f,{key:0},x([e.data.dataplaneInsight.mTLS],l=>(o(),v(T,{key:l,class:"mt-4"},{default:a(()=>[s("div",Yt,[r(I,null,{title:a(()=>[t(i(m("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:a(()=>[t(i(m("common.formats.datetime",{value:Date.parse(l.certificateExpirationTime)})),1)]),_:2},1024),t(),r(I,null,{title:a(()=>[t(i(m("data-planes.routes.item.mtls.generation_time.title")),1)]),body:a(()=>[t(i(m("common.formats.datetime",{value:Date.parse(l.lastCertificateRegeneration)})),1)]),_:2},1024),t(),r(I,null,{title:a(()=>[t(i(m("data-planes.routes.item.mtls.regenerations.title")),1)]),body:a(()=>[t(i(m("common.formats.integer",{value:l.certificateRegenerations})),1)]),_:2},1024),t(),r(I,null,{title:a(()=>[t(i(m("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:a(()=>[t(i(l.issuedBackend),1)]),_:2},1024),t(),r(I,null,{title:a(()=>[t(i(m("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:a(()=>[s("ul",null,[(o(!0),u(f,null,x(l.supportedBackends,_=>(o(),u("li",{key:_},i(_),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(o(),v(q,{key:1,class:"mt-4",appearance:"warning"},{default:a(()=>[s("div",{innerHTML:m("data-planes.routes.item.mtls.disabled")},null,8,Zt)]),_:2},1024))]),t(),e.data.dataplaneInsight.subscriptions.length>0?(o(),u("div",Ht,[s("h2",null,i(m("data-planes.routes.item.subscriptions.title")),1),t(),r(T,{class:"mt-4"},{default:a(()=>[r(gt,{subscriptions:e.data.dataplaneInsight.subscriptions},null,8,["subscriptions"])]),_:1})])):N("",!0)])]),_:2},[b.value.length>0||S?{name:"notifications",fn:a(()=>[s("ul",Pt,[(o(!0),u(f,null,x(b.value,l=>(o(),u("li",{key:l.kind,"data-testid":`warning-${l.kind}`,innerHTML:m(`common.warnings.${l.kind}`,l.payload)},null,8,Lt))),128)),t(),S?(o(),u("li",qt,[t(`
              The below view is not enhanced with runtime stats (Error loading stats: `),s("strong",null,i(S.toString()),1),t(`)
            `)])):N("",!0)])]),key:"0"}:void 0]),1024)]),_:2},1032,["src"])]),_:1})}}}),ae=R(jt,[["__scopeId","data-v-59947235"]]);export{ae as default};
