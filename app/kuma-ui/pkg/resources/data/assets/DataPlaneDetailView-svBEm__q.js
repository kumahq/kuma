import{d as ta,a2 as na,a8 as oa,r as y,p as d,o,w as a,b as e,m as w,F as S,$ as sa,a3 as ia,c as f,e as n,N as c,L as _,q as g,O as b,T as ra,l as C,t as p,M as pa,a4 as j,y as da,_ as la}from"./index-DI4CRQyW.js";import{T as ua}from"./TagList-z8-IP-o2.js";import{C as F,a as T,b as A}from"./ConnectionTraffic-BZOoGBXy.js";const ma=ta({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(G){const E=na(),s=G;return oa("data-plane-overview",s.data),(ya,t)=>{const x=y("XI18n"),K=y("XNotification"),B=y("XIcon"),V=y("DataCollection"),m=y("XLayout"),z=y("XAction"),k=y("XBadge"),M=y("XCopyButton"),P=y("XAboutCard"),q=y("XEmptyState"),H=y("XCard"),J=y("XDrawer"),Q=y("RouterView"),U=y("AppView"),W=y("DataLoader"),h=y("DataSource"),Y=y("RouteView");return o(),d(Y,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:a(({route:u,t:l,can:$,uri:I})=>[e(h,{src:I(w(S),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:u.params.mesh,name:u.params.proxy})},{default:a(({data:X})=>[e(h,{src:I(w(sa),"/meshes/:mesh/dataplanes/:name/layout",{mesh:u.params.mesh,name:u.params.proxy})},{default:a(({data:D,refresh:Z,error:L})=>[e(h,{src:I(w(S),"/policy-types",{})},{default:a(({data:O})=>[e(h,{src:I(w(ia),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[u.params.proxyType]??"dataplane",name:u.params.proxy,mesh:u.params.mesh||"*",socketAddress:"self_inbound"})},{default:a(({data:R,error:aa,refresh:ea})=>[e(W,{data:[D,X,O,R]},{default:a(()=>[e(U,{notifications:!0},{default:a(()=>[(o(!0),f(c,null,_([{bool:s.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:s.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:s.data.dataplaneInsight.version?.envoy.version??"",kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!($("use zones")&&s.data.zone&&s.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:s.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:s.data.isCertExpired,key:"certificate-expired"},{bool:!s.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!$("use transparent-proxying",s.data),key:"networking-transparent-proxying",variant:"info"}],({bool:i,key:r,params:v,variant:N})=>(o(),d(K,{key:r,notify:i,"data-testid":`warning-${r}`,uri:`data-planes.notifications.${r}.${s.data.id}`,variant:N},{default:a(()=>[e(x,{path:`data-planes.notifications.${r}`,params:Object.fromEntries(Object.entries(v??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),t[47]||(t[47]=n()),e(m,{type:"stack","data-testid":"dataplane-details"},{default:a(()=>[e(P,{title:l("data-planes.routes.item.about.title"),created:s.data.creationTime,modified:s.data.modificationTime,class:"about-section"},{default:a(()=>[e(m,null,{default:a(()=>[e(m,{type:"separated"},{default:a(()=>[e(b,{layout:"horizontal"},{title:a(()=>[n(p(l("http.api.property.status")),1)]),body:a(()=>[e(m,{type:"separated"},{default:a(()=>[e(ra,{status:s.data.status},null,8,["status"]),t[0]||(t[0]=n()),s.data.dataplaneType==="standard"?(o(),d(V,{key:0,items:s.data.dataplane.networking.inbounds,predicate:i=>i.state!=="Ready",empty:!1},{default:a(({items:i})=>[e(B,{name:"info"},{default:a(()=>[C("ul",null,[(o(!0),f(c,null,_(i,r=>(o(),f("li",{key:`${r.service}:${r.port}`},p(l("data-planes.routes.item.unhealthy_inbound",{service:r.service,port:r.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):g("",!0)]),_:2},1024)]),_:2},1024),t[7]||(t[7]=n()),$("use zones")&&s.data.zone?(o(),d(b,{key:0,layout:"horizontal"},{title:a(()=>[n(p(l("http.api.property.zone")),1)]),body:a(()=>[e(k,{appearance:"decorative"},{default:a(()=>[e(z,{to:{name:"zone-cp-detail-view",params:{zone:s.data.zone}}},{default:a(()=>[n(p(s.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2},1024)):g("",!0),t[8]||(t[8]=n()),e(b,{layout:"horizontal"},{title:a(()=>[n(p(l("http.api.property.type")),1)]),body:a(()=>[e(k,{appearance:"decorative"},{default:a(()=>[n(p(l(`data-planes.type.${s.data.dataplaneType}`)),1)]),_:2},1024)]),_:2},1024),t[9]||(t[9]=n()),s.data.namespace.length>0?(o(),d(b,{key:1,layout:"horizontal"},{title:a(()=>[n(p(l("http.api.property.namespace")),1)]),body:a(()=>[e(k,{appearance:"decorative"},{default:a(()=>[n(p(s.data.namespace),1)]),_:1})]),_:2},1024)):g("",!0),t[10]||(t[10]=n()),e(b,{layout:"horizontal"},{title:a(()=>[n(p(l("http.api.property.address")),1)]),body:a(()=>[e(M,{variant:"badge",format:"default",text:`${s.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024),t[11]||(t[11]=n()),s.data.dataplane.networking.gateway?(o(),d(b,{key:2,layout:"horizontal"},{title:a(()=>[n(p(l("http.api.property.tags")),1)]),body:a(()=>[e(ua,{tags:s.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024)):g("",!0)]),_:2},1024),t[30]||(t[30]=n()),s.data.dataplaneInsight.mTLS?(o(),d(m,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:a(()=>[C("h3",null,p(l("data-planes.routes.item.mtls.title")),1),t[21]||(t[21]=n()),e(m,{size:"small"},{default:a(()=>[(o(!0),f(c,null,_([s.data.dataplaneInsight.mTLS],i=>(o(),f(c,{key:i},[e(m,{type:"separated"},{default:a(()=>[typeof i.lastCertificateRegeneration<"u"&&typeof i.certificateExpirationTime<"u"&&typeof i.issuedBackend<"u"?(o(),f(c,{key:0},[e(b,{layout:"horizontal"},{title:a(()=>[e(x,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:a(()=>[e(k,{appearance:"neutral"},{default:a(()=>[n(p(l("common.formats.datetime",{value:Date.parse(i.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2},1024),t[14]||(t[14]=n()),e(b,{layout:"horizontal"},{title:a(()=>[e(x,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:a(()=>[e(k,{appearance:"neutral"},{default:a(()=>[n(p(l("common.formats.datetime",{value:Date.parse(i.certificateExpirationTime)})),1)]),_:2},1024)]),_:2},1024)],64)):(o(),d(x,{key:1,path:"data-planes.routes.item.mtls.managed_externally"}))]),_:2},1024),t[20]||(t[20]=n()),e(m,{type:"separated"},{default:a(()=>[typeof i.certificateRegenerations<"u"?(o(),d(b,{key:0,layout:"horizontal"},{title:a(()=>[n(p(l("data-planes.routes.item.mtls.regenerations.title")),1)]),body:a(()=>[e(k,{appearance:"info"},{default:a(()=>[n(p(l("common.formats.integer",{value:i.certificateRegenerations})),1)]),_:2},1024)]),_:2},1024)):g("",!0),t[18]||(t[18]=n()),i.issuedBackend?(o(),d(b,{key:1,layout:"horizontal"},{title:a(()=>[n(p(l("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:a(()=>[e(k,{appearance:"decorative"},{default:a(()=>[n(p(i.issuedBackend),1)]),_:2},1024)]),_:2},1024)):g("",!0),t[19]||(t[19]=n()),typeof i.supportedBackends<"u"?(o(),d(b,{key:2,layout:"horizontal"},{title:a(()=>[n(p(l("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:a(()=>[e(m,{type:"separated",truncate:""},{default:a(()=>[(o(!0),f(c,null,_(i.supportedBackends,r=>(o(),d(k,{key:r,appearance:r===i.issuedBackend?"decorative":"info"},{default:a(()=>[n(p(r),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2},1024)):g("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):g("",!0),t[31]||(t[31]=n()),s.data.dataplaneInsight.subscriptions.length>0?(o(),d(m,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:a(()=>[e(m,{type:"separated"},{default:a(()=>[C("h3",null,p(l("data-planes.routes.item.subscriptions.title")),1),t[22]||(t[22]=n()),e(z,{"data-action":"",appearance:"anchor",to:{name:"data-plane-subscriptions-summary-view",params:{mesh:u.params.mesh,proxy:u.params.proxy},query:{inactive:u.params.inactive}}},{default:a(()=>[n(`
                            (`+p(l("data-planes.routes.item.xds.show-details"))+`)
                          `,1)]),_:2},1032,["to"])]),_:2},1024),t[28]||(t[28]=n()),(o(!0),f(c,null,_([[...s.data.dataplaneInsight.subscriptions].reverse()],i=>(o(),d(m,{key:typeof i,type:"separated"},{default:a(()=>[(o(!0),f(c,null,_([i.find(r=>!r.disconnectTime)??i[0]],r=>(o(),f(c,{key:r.id},[!r.disconnectTime&&r.connectTime?(o(),f(c,{key:0},[e(b,{layout:"horizontal"},{title:a(()=>[e(x,{path:"data-planes.routes.item.xds.connected"})]),body:a(()=>[e(k,{appearance:"neutral"},{default:a(()=>[n(p(l("common.formats.datetime",{value:Date.parse(r.connectTime)})),1)]),_:2},1024)]),_:2},1024),t[26]||(t[26]=n()),e(b,{layout:"horizontal"},{title:a(()=>[e(x,{path:"data-planes.routes.item.xds.instance"})]),body:a(()=>[e(k,{appearance:"info"},{default:a(()=>[n(p(r.controlPlaneInstanceId),1)]),_:2},1024)]),_:2},1024),t[27]||(t[27]=n()),e(b,{layout:"horizontal"},{title:a(()=>[e(x,{path:"data-planes.routes.item.xds.version"})]),body:a(()=>[e(k,{appearance:"info"},{default:a(()=>[n(p(r.version?.kumaDp?.version??l("common.unknown")),1)]),_:2},1024)]),_:2},1024)],64)):(o(),d(x,{key:1,path:"data-planes.routes.item.xds.disconnected"}))],64))),128))]),_:2},1024))),128))]),_:2},1024)):g("",!0),t[32]||(t[32]=n()),X?.policies.length?(o(),d(m,{key:2,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:a(()=>[C("h3",null,p(l("data-planes.routes.item.policies")),1),t[29]||(t[29]=n()),e(m,{type:"separated"},{default:a(()=>[(o(!0),f(c,null,_(X?.policies,i=>(o(),d(z,{key:i.kind,"data-action":"",appearance:"anchor",to:{name:"data-plane-policy-config-summary-view",params:{mesh:u.params.mesh,proxy:u.params.proxy,policy:i.kind.toLowerCase()}}},{default:a(()=>[e(k,null,{default:a(()=>[n(p(i.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2},1024)):g("",!0)]),_:2},1024)]),_:2},1032,["title","created","modified"]),t[45]||(t[45]=n()),e(H,{class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[e(m,{type:"columns"},{default:a(()=>[e(F,null,{title:a(()=>[e(m,{type:"separated"},{default:a(()=>[e(B,{name:"inbound"}),t[33]||(t[33]=n()),t[34]||(t[34]=C("span",null,"Inbounds",-1))]),_:1})]),default:a(()=>[t[36]||(t[36]=n()),(o(!0),f(c,null,_([D?.inbounds??[]],i=>(o(),d(T,{key:typeof i,type:"inbound","data-testid":"dataplane-inbounds"},{default:a(()=>[e(V,{type:"inbounds",items:i,predicate:r=>r.port!==49151},pa({default:a(({items:r})=>[e(m,{type:"stack",size:"small"},{default:a(()=>[(o(!0),f(c,null,_(r,v=>(o(),d(A,{key:`${v.kri}`,"data-testid":"dataplane-inbound",protocol:v.protocol,"port-name":w(j).fromString(v.proxyResourceName).sectionName,traffic:R?.inbounds[v.proxyResourcePortName]},{default:a(()=>[e(z,{"data-action":"",to:{name:(N=>N.includes("bound")?N.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(w(E).name)),params:{connection:v.proxyResourceName},query:{inactive:u.params.inactive}}},{default:a(()=>[n(p(v.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},[s.data.dataplaneType==="delegated"?{name:"empty",fn:a(()=>[e(q,null,{default:a(()=>[C("p",null,`
                                    This proxy is a delegated gateway therefore `+p(l("common.product.name"))+` does not have any
                                    visibility into inbounds for this gateway.
                                  `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),t[44]||(t[44]=n()),e(F,null,{actions:a(()=>[e(z,{action:"refresh",appearance:"primary",onClick:()=>{Z(),ea()}},{default:a(()=>[...t[37]||(t[37]=[n(`
                            Refresh
                          `,-1)])]),_:1},8,["onClick"])]),title:a(()=>[e(m,{type:"separated"},{default:a(()=>[e(B,{name:"outbound"}),t[38]||(t[38]=n()),t[39]||(t[39]=C("span",null,"Outbounds",-1))]),_:1})]),default:a(()=>[t[42]||(t[42]=n()),t[43]||(t[43]=n()),typeof L>"u"&&typeof aa>"u"&&D?.outbounds.length?(o(),f(c,{key:0},[e(T,{type:"passthrough"},{default:a(()=>[e(A,{protocol:"passthrough",traffic:R?.passthrough},{default:a(()=>[...t[40]||(t[40]=[n(`
                              Non mesh traffic
                            `,-1)])]),_:1},8,["traffic"])]),_:2},1024),t[41]||(t[41]=n()),e(V,{type:"outbounds",items:D?.outbounds},{default:a(({items:i})=>[e(T,{type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[e(m,{type:"stack",size:"small"},{default:a(()=>[(o(!0),f(c,null,_(i,r=>(o(),d(A,{key:r.kri,"data-testid":"dataplane-outbound",protocol:r.protocol,"port-name":w(j).fromString(r.proxyResourceName).sectionName,traffic:R?.outbounds[r.proxyResourceName]},{default:a(()=>[e(z,{"data-action":"",to:{name:(v=>v.includes("bound")?v.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(w(E).name)),params:{connection:r.proxyResourceName},query:{inactive:u.params.inactive}}},{default:a(()=>[n(p(r.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(o(),d(q,{key:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024),t[46]||(t[46]=n()),e(Q,null,{default:a(i=>[i.route.name!==u.name?(o(),d(J,{key:0,width:i.route.name==="data-plane-subscriptions-summary-view"?"900px":"670px",onClose:function(){u.replace({name:"data-plane-detail-view",params:{mesh:u.params.mesh,proxy:u.params.proxy},query:{inactive:u.params.inactive?null:void 0}})}},{default:a(()=>[(o(),d(da(i.Component),{data:u.params.subscription.length>0?s.data.dataplaneInsight.subscriptions:i.route.name.includes("-inbound-")?D?.inbounds:D?.outbounds,"data-plane-overview":s.data,networking:s.data.dataplane.networking,subscriptions:s.data.dataplaneInsight.subscriptions,policies:X?.policies??[],"policy-types-data":O},null,8,["data","data-plane-overview","networking","subscriptions","policies","policy-types-data"]))]),_:2},1032,["width","onClose"])):g("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:1})}}}),ka=la(ma,[["__scopeId","data-v-1bf0bfc0"]]);export{ka as default};
