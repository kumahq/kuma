import{d as h,a2 as tt,r as f,p as y,o as d,w as a,b as n,m as R,a3 as at,e,c as m,N as v,L as _,q as w,l as s,t as l,T as et,M as O,a4 as nt,y as ot,_ as st}from"./index-BRjpzT8y.js";import{T as dt}from"./TagList-BVh3s4pw.js";import{C as P,a as A,b as E}from"./ConnectionTraffic-BXLOZnT4.js";const it={key:0},lt={key:1},rt={key:2},pt={key:0},ut={key:1},mt={key:2},ft=h({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(j){const T=tt(),o=j;return(yt,t)=>{const I=f("XI18n"),V=f("XNotification"),D=f("XIcon"),S=f("DataCollection"),g=f("XLayout"),X=f("XAction"),b=f("XBadge"),M=f("XCopyButton"),$=f("XDl"),F=f("XAboutCard"),q=f("XEmptyState"),G=f("XInputSwitch"),K=f("XProgress"),U=f("XCard"),Z=f("XDrawer"),H=f("RouterView"),J=f("AppView"),Q=f("DataSource"),W=f("RouteView");return d(),y(W,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:a(({route:c,t:p,can:z,uri:Y})=>[n(Q,{src:Y(R(at),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[c.params.proxyType]??"dataplane",name:c.params.proxy,mesh:c.params.mesh||"*",socketAddress:o.data.dataplane.networking.inboundAddress})},{default:a(({data:x,error:B,refresh:L})=>[n(J,{notifications:!0},{default:a(()=>[n(V,{notify:!!B,"data-testid":"warning-stats-not-enhanced",uri:`data-planes.notifications.stats-not-enhanced.${o.data.id}`},{default:a(()=>[n(I,{path:"data-planes.notifications.stats-not-enhanced",params:{error:B?.toString()??""}},null,8,["params"])]),_:2},1032,["notify","uri"]),t[49]||(t[49]=e()),(d(!0),m(v,null,_([{bool:o.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:o.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:o.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:o.data.dataplaneInsight.version?.envoy.version??"",kumaDp:o.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!(z("use zones")&&o.data.zone&&o.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:o.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:o.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:o.data.isCertExpired,key:"certificate-expired"},{bool:!o.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!z("use transparent-proxying",o.data),key:"networking-transparent-proxying",variant:"info"}],({bool:i,key:r,params:u,variant:k})=>(d(),y(V,{key:r,notify:i,"data-testid":`warning-${r}`,uri:`data-planes.notifications.${r}.${o.data.id}`,variant:k},{default:a(()=>[n(I,{path:`data-planes.notifications.${r}`,params:Object.fromEntries(Object.entries(u??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),t[50]||(t[50]=e()),n(g,{type:"stack","data-testid":"dataplane-details"},{default:a(()=>[n(F,{title:p("data-planes.routes.item.about.title"),created:o.data.creationTime,modified:o.data.modificationTime,class:"about-section"},{default:a(()=>[n(g,null,{default:a(()=>[n($,{variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,l(p("http.api.property.status")),1),t[1]||(t[1]=e()),s("dd",null,[n(g,{type:"separated"},{default:a(()=>[n(et,{status:o.data.status},null,8,["status"]),t[0]||(t[0]=e()),n(S,{items:o.data.dataplane.networking.inbounds,predicate:i=>i.state!=="Ready",empty:!1},{default:a(({items:i})=>[n(D,{name:"info"},{default:a(()=>[s("ul",null,[(d(!0),m(v,null,_(i,r=>(d(),m("li",{key:`${r.service}:${r.port}`},l(p("data-planes.routes.item.unhealthy_inbound",{port:r.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1024)])]),t[7]||(t[7]=e()),z("use zones")&&o.data.zone?(d(),m("div",it,[s("dt",null,l(p("http.api.property.zone")),1),t[2]||(t[2]=e()),s("dd",null,[n(b,{appearance:"decorative"},{default:a(()=>[n(X,{to:{name:"zone-cp-detail-view",params:{zone:o.data.zone}}},{default:a(()=>[e(l(o.data.zone),1)]),_:1},8,["to"])]),_:1})])])):w("",!0),t[8]||(t[8]=e()),s("div",null,[s("dt",null,l(p("http.api.property.type")),1),t[3]||(t[3]=e()),s("dd",null,[n(b,{appearance:"decorative"},{default:a(()=>[e(l(p(`data-planes.type.${o.data.dataplaneType}`)),1)]),_:2},1024)])]),t[9]||(t[9]=e()),o.data.namespace.length>0?(d(),m("div",lt,[s("dt",null,l(p("http.api.property.namespace")),1),t[4]||(t[4]=e()),s("dd",null,[n(b,{appearance:"decorative"},{default:a(()=>[e(l(o.data.namespace),1)]),_:1})])])):w("",!0),t[10]||(t[10]=e()),s("div",null,[s("dt",null,l(p("http.api.property.address")),1),t[5]||(t[5]=e()),s("dd",null,[n(M,{variant:"badge",format:"default",text:`${o.data.dataplane.networking.address}`},null,8,["text"])])]),t[11]||(t[11]=e()),o.data.dataplane.networking.gateway?(d(),m("div",rt,[s("dt",null,l(p("http.api.property.tags")),1),t[6]||(t[6]=e()),s("dd",null,[n(dt,{tags:o.data.dataplane.networking.gateway.tags},null,8,["tags"])])])):w("",!0)]),_:2},1024),t[29]||(t[29]=e()),o.data.dataplaneInsight.mTLS?(d(),y(g,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:a(()=>[s("h3",null,l(p("data-planes.routes.item.mtls.title")),1),t[21]||(t[21]=e()),n(g,{size:"small"},{default:a(()=>[(d(!0),m(v,null,_([o.data.dataplaneInsight.mTLS],i=>(d(),m(v,{key:typeof i},[typeof i.lastCertificateRegeneration<"u"&&typeof i.certificateExpirationTime<"u"&&typeof i.issuedBackend<"u"?(d(),y($,{key:0,variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,l(p("data-planes.routes.item.mtls.generation_time.title")),1),t[12]||(t[12]=e()),s("dd",null,[n(b,{appearance:"neutral"},{default:a(()=>[e(l(p("common.formats.datetime",{value:Date.parse(i.lastCertificateRegeneration)})),1)]),_:2},1024)])]),t[14]||(t[14]=e()),s("div",null,[s("dt",null,l(p("data-planes.routes.item.mtls.expiration_time.title")),1),t[13]||(t[13]=e()),s("dd",null,[n(b,{appearance:"neutral"},{default:a(()=>[e(l(p("common.formats.datetime",{value:Date.parse(i.certificateExpirationTime)})),1)]),_:2},1024)])])]),_:2},1024)):(d(),y(I,{key:1,path:"data-planes.routes.item.mtls.managed_externally"})),t[20]||(t[20]=e()),n($,{variant:"x-stack"},{default:a(()=>[typeof i.certificateRegenerations<"u"?(d(),m("div",pt,[s("dt",null,l(p("data-planes.routes.item.mtls.regenerations.title")),1),t[15]||(t[15]=e()),s("dd",null,[n(b,{appearance:"info"},{default:a(()=>[e(l(p("common.formats.integer",{value:i.certificateRegenerations})),1)]),_:2},1024)])])):w("",!0),t[18]||(t[18]=e()),typeof i.issuedBackend<"u"?(d(),m("div",ut,[s("dt",null,l(p("data-planes.routes.item.mtls.issued_backend.title")),1),t[16]||(t[16]=e()),s("dd",null,[n(b,{appearance:"decorative"},{default:a(()=>[e(l(i.issuedBackend),1)]),_:2},1024)])])):w("",!0),t[19]||(t[19]=e()),typeof i.supportedBackends<"u"?(d(),m("div",mt,[s("dt",null,l(p("data-planes.routes.item.mtls.supported_backends.title")),1),t[17]||(t[17]=e()),s("dd",null,[n(g,{type:"separated",truncate:""},{default:a(()=>[(d(!0),m(v,null,_(i.supportedBackends,r=>(d(),y(b,{key:r,appearance:r===i.issuedBackend?"decorative":"info"},{default:a(()=>[e(l(r),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)])])):w("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):w("",!0),t[30]||(t[30]=e()),o.data.dataplaneInsight.subscriptions.length>0?(d(),y(g,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:a(()=>[n(g,{type:"separated"},{default:a(()=>[s("h3",null,l(p("data-planes.routes.item.subscriptions.title")),1),t[22]||(t[22]=e()),n(X,{appearance:"anchor",to:{name:"data-plane-subscriptions-list-view",params:{mesh:c.params.mesh,proxy:c.params.proxy},query:{inactive:c.params.inactive}}},{default:a(()=>[e(`
                    (`+l(p("data-planes.routes.item.xds.show-details"))+`)
                  `,1)]),_:2},1032,["to"])]),_:2},1024),t[28]||(t[28]=e()),o.data.dataplaneInsight.connectedSubscription?(d(),y($,{key:0,variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,l(p("data-planes.routes.item.xds.connected")),1),t[23]||(t[23]=e()),s("dd",null,[n(b,{appearance:"neutral"},{default:a(()=>[e(l(p("common.formats.datetime",{value:Date.parse(o.data.dataplaneInsight.connectedSubscription.connectTime??"")})),1)]),_:2},1024)])]),t[26]||(t[26]=e()),s("div",null,[s("dt",null,l(p("data-planes.routes.item.xds.instance")),1),t[24]||(t[24]=e()),s("dd",null,[n(b,null,{default:a(()=>[e(l(o.data.dataplaneInsight.connectedSubscription.controlPlaneInstanceId),1)]),_:1})])]),t[27]||(t[27]=e()),s("div",null,[s("dt",null,l(p("data-planes.routes.item.xds.version")),1),t[25]||(t[25]=e()),s("dd",null,[n(b,null,{default:a(()=>[e(l(o.data.dataplaneInsight.connectedSubscription.version?.kumaDp?.version??p("common.unknown")),1)]),_:2},1024)])])]),_:2},1024)):(d(),y(I,{key:1,path:"data-planes.routes.item.xds.disconnected"}))]),_:2},1024)):w("",!0)]),_:2},1024)]),_:2},1032,["title","created","modified"]),t[47]||(t[47]=e()),n(U,{class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[n(g,{type:"columns"},{default:a(()=>[n(P,null,{title:a(()=>[n(g,{type:"separated"},{default:a(()=>[n(D,{name:"inbound"}),t[31]||(t[31]=e()),t[32]||(t[32]=s("span",null,"Inbounds",-1))]),_:1})]),default:a(()=>[t[35]||(t[35]=e()),(d(!0),m(v,null,_([o.data.dataplane.networking.type==="gateway"?Object.entries(x?.inbounds??{}).reduce((i,[r,u])=>{const k=r.split("_").at(-1);return k===(o.data.dataplane.networking.admin?.port??"9901")?i:i.concat([{...o.data.dataplane.networking.inbounds[0],name:r,clusterName:r,port:Number(k),protocol:["http","tcp"].find(C=>typeof u[C]<"u")??"tcp",addressPort:`${o.data.dataplane.networking.inbounds[0].address}:${k}`}])},[]):o.data.dataplane.networking.inbounds],i=>(d(),y(A,{key:i,type:"inbound","data-testid":"dataplane-inbounds"},{default:a(()=>[n(S,{type:"inbounds",items:i,predicate:r=>r.port!==49151},O({default:a(({items:r})=>[n(g,{type:"stack",size:"small"},{default:a(()=>[(d(!0),m(v,null,_(r,u=>(d(),m(v,{key:`${u.name}`},[(d(!0),m(v,null,_([x?.inbounds[u.clusterName]],k=>(d(),y(E,{key:k,"data-testid":"dataplane-inbound",protocol:u.protocol,"port-name":u.portName,service:z("use service-insights",o.mesh)?u.tags["kuma.io/service"]:"",traffic:typeof B>"u"?k:{name:"",protocol:u.protocol,port:`${u.port}`},"data-actionable":""},{state:a(()=>[u.state!=="Ready"?(d(),y(D,{key:0,name:"danger",size:R(nt),placement:"right"},{default:a(()=>[e(l(p("data-planes.routes.item.unhealthy_inbound",{port:u.port})),1)]),_:2},1032,["size"])):w("",!0)]),default:a(()=>[t[33]||(t[33]=e()),n(X,{"data-action":"",to:{name:(C=>C.includes("bound")?C.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(R(T).name)),params:{connection:u.name},query:{inactive:c.params.inactive}}},{default:a(()=>[e(l(u.name.replace("localhost","").replace("_",":")),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","service","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},[o.data.dataplaneType==="delegated"?{name:"empty",fn:a(()=>[n(q,null,{default:a(()=>[s("p",null,`
                            This proxy is a delegated gateway therefore `+l(p("common.product.name"))+` does not have any
                            visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),t[46]||(t[46]=e()),n(P,null,O({title:a(()=>[n(g,{type:"separated"},{default:a(()=>[n(D,{name:"outbound"}),t[39]||(t[39]=e()),t[40]||(t[40]=s("span",null,"Outbounds",-1))]),_:1})]),default:a(()=>[t[44]||(t[44]=e()),t[45]||(t[45]=e()),typeof B>"u"?(d(),m(v,{key:0},[typeof x>"u"?(d(),y(K,{key:0})):(d(),m(v,{key:1},[n(A,{type:"passthrough"},{default:a(()=>[n(E,{protocol:"passthrough",traffic:x.passthrough},{default:a(()=>[...t[41]||(t[41]=[e(`
                        Non mesh traffic
                      `,-1)])]),_:1},8,["traffic"])]),_:2},1024),t[43]||(t[43]=e()),(d(),m(v,null,_(["upstream"],i=>(d(),m(v,{key:i},[n(V,{notify:!!Object.values(x.outbounds).find(r=>(typeof r.tcp<"u"?r.tcp?.[`${i}_cx_rx_bytes_total`]:r.http?.[`${i}_rq_total`])??!1),variant:"info",uri:`data-planes.notifications.recommend-reachable-services:${o.data.id}`},{default:a(()=>[n(I,{path:"data-planes.notifications.recommend-reachable",params:{mode:o.mesh.meshServices.mode}},null,8,["params"])]),_:1},8,["notify","uri"]),t[42]||(t[42]=e()),n(S,{type:"outbounds",predicate:c.params.inactive?void 0:([r,u])=>((typeof u.tcp<"u"?u.tcp?.[`${i}_cx_rx_bytes_total`]:u.http?.[`${i}_rq_total`])??0)>0,items:Object.entries(x.outbounds)},{default:a(({items:r})=>[r.length>0?(d(),y(A,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[(d(),m(v,null,_([/-([a-f0-9]){16}$/],u=>n(g,{key:u,type:"stack",size:"small"},{default:a(()=>[(d(!0),m(v,null,_(r,([k,C])=>(d(),y(E,{key:`${k}`,"data-testid":"dataplane-outbound",protocol:["grpc","http","tcp"].find(N=>typeof C[N]<"u")??"tcp",traffic:C,service:C.$resourceMeta.type===""?k.replace(u,""):void 0,direction:i,"data-actionable":""},{default:a(()=>[n(X,{"data-action":"",to:{name:(N=>N.includes("bound")?N.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(R(T).name)),params:{connection:k},query:{inactive:c.params.inactive}}},{default:a(()=>[e(l(k),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","service","direction"]))),128))]),_:2},1024)),64))]),_:2},1024)):w("",!0)]),_:2},1032,["predicate","items"])],64))),64))],64))],64)):(d(),y(q,{key:1}))]),_:2},[x?{name:"actions",fn:a(()=>[n(G,{checked:c.params.inactive,"data-testid":"dataplane-outbounds-inactive-toggle",onChange:i=>c.update({inactive:i})},{label:a(()=>[...t[36]||(t[36]=[e(`
                      Show inactive
                    `,-1)])]),_:1},8,["checked","onChange"]),t[38]||(t[38]=e()),n(X,{action:"refresh",appearance:"primary",onClick:L},{default:a(()=>[...t[37]||(t[37]=[e(`
                    Refresh
                  `,-1)])]),_:1},8,["onClick"])]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024),t[48]||(t[48]=e()),n(H,null,{default:a(i=>[i.route.name!==c.name?(d(),y(Z,{key:0,width:"670px",onClose:function(){c.replace({name:"data-plane-detail-view",params:{mesh:c.params.mesh,proxy:c.params.proxy},query:{inactive:c.params.inactive?null:void 0}})}},{default:a(()=>[(d(),y(ot(i.Component),{data:c.params.subscription.length>0?o.data.dataplaneInsight.subscriptions:i.route.name.includes("-inbound-")?o.data.dataplane.networking.inbounds:x?.outbounds||{},networking:o.data.dataplane.networking},null,8,["data","networking"]))]),_:2},1032,["onClose"])):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),kt=st(ft,[["__scopeId","data-v-1d198e5f"]]);export{kt as default};
