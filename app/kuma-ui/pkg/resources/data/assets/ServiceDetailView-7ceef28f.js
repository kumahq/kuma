import{u as q}from"./vue-router-573afc44.js";import{k as x}from"./kumaApi-db784568.js";import{Q as L}from"./QueryParameter-70743f73.js";import{u as T}from"./store-866e3b85.js";import{_ as A}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-4047971f.js";import{E as B}from"./ErrorBlock-46fedade.js";import{_ as V}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-d3176fee.js";import{D as $}from"./DataPlaneList-f542995d.js";import{S as z}from"./ServiceSummary-dcb79b12.js";import{d as P,h as F,g as I,e as j,f as R,a as u,b as C,F as Q,o as n,r as v,y as O}from"./runtime-dom.esm-bundler-91b41870.js";import"./vuex.esm-bundler-df5bd11e.js";import"./dataplane-4aecf58f.js";import"./helpers-32595d9f.js";import"./constants-31fdaf55.js";import"./ClientStorage-efe299d9.js";import"./kongponents.es-3df60cd6.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./datadogLogEvents-4578cfa7.js";import"./ContentWrapper-b0fa1a61.js";import"./DataOverview-07eb4ec1.js";import"./StatusBadge-81464ebd.js";import"./TagList-91d1133a.js";import"./YamlView.vue_vue_type_script_setup_true_lang-d444e9d2.js";import"./index-a8834e9c.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-98064716.js";import"./_commonjsHelpers-87174ba5.js";const J={class:"component-frame"},M=P({__name:"ServiceDetails",props:{service:{type:Object,required:!0},externalService:{type:Object,required:!1,default:null},dataPlaneOverviews:{type:Array,required:!1,default:null},dppFilterFields:{type:Object,required:!0},selectedDppName:{type:String,required:!1,default:null}},emits:["load-dataplane-overviews"],setup(d,{emit:y}){const s=d;function e(f,i){y("load-dataplane-overviews",f,i)}return(f,i)=>{var o;return n(),F(Q,null,[I("div",J,[j(z,{service:s.service,"external-service":d.externalService},null,8,["service","external-service"])]),R(),s.dataPlaneOverviews!==null?(n(),u($,{key:0,class:"mt-4","data-plane-overviews":s.dataPlaneOverviews,"dpp-filter-fields":s.dppFilterFields,"selected-dpp-name":s.selectedDppName,"is-gateway-view":((o=s.dataPlaneOverviews[0])==null?void 0:o.dataplane.networking.gateway)!==void 0,onLoadData:e},null,8,["data-plane-overviews","dpp-filter-fields","selected-dpp-name","is-gateway-view"])):C("",!0)],64)}}}),W={class:"service-details"},_e=P({__name:"ServiceDetailView",props:{selectedDppName:{type:String,required:!1,default:null}},setup(d){const y=d,s={name:{description:"filter by name or parts of a name"},protocol:{description:"filter by “kuma.io/protocol” value"},tag:{description:"filter by tags (e.g. “tag: version:2”)"},zone:{description:"filter by “kuma.io/zone” value"}},e=q(),f=T(),i=v(null),o=v(null),g=v(null),_=v(!0),w=v(null);O(()=>e.params.mesh,function(){e.name==="service-detail-view"&&h(0)}),O(()=>e.params.name,function(){e.name==="service-detail-view"&&h(0)});function N(){f.dispatch("updatePageTitle",e.params.service);const a=L.get("filterFields"),l=a!==null?JSON.parse(a):{};h(0,l)}N();async function h(a,l={}){_.value=!0,w.value=null,i.value=null,o.value=null,g.value=null;const c=e.params.mesh,p=e.params.service;try{i.value=await x.getServiceInsight({mesh:c,name:p}),i.value.serviceType==="external"?o.value=await x.getExternalService({mesh:c,name:p}):await S(a,l)}catch(t){t instanceof Error?w.value=t:console.error(t)}finally{_.value=!1}}async function S(a,l){const c=e.params.mesh,p=e.params.service;try{const t=b(p,a,l),r=await x.getAllDataplaneOverviewsFromMesh({mesh:c},t);g.value=r.items??[]}catch{g.value=null}}function b(a,l,c){const t=`kuma.io/service:${a}`,r={...c,offset:l,size:50};if(r.tag){const D=Array.isArray(r.tag)?r.tag:[r.tag],k=[];for(const[m,E]of D.entries())E.startsWith("kuma.io/service:")&&k.push(m);for(let m=k.length-1;m===0;m--)D.splice(k[m],1);r.tag=D.concat(t)}else r.tag=t;return r}return(a,l)=>(n(),F("div",W,[_.value?(n(),u(V,{key:0})):w.value!==null?(n(),u(B,{key:1,error:w.value},null,8,["error"])):i.value===null?(n(),u(A,{key:2})):(n(),u(M,{key:3,service:i.value,"data-plane-overviews":g.value,"external-service":o.value,"dpp-filter-fields":s,"selected-dpp-name":y.selectedDppName,onLoadDataplaneOverviews:S},null,8,["service","data-plane-overviews","external-service","selected-dpp-name"]))]))}});export{_e as default};
