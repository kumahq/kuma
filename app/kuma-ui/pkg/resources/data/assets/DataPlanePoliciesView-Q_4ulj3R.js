import{A as I,a as K}from"./AccordionList-K7vP66di.js";import{d as S,a as g,o as e,c as a,m as p,f as l,F as u,G as f,t as d,e as r,w as t,q as R,b as m,U as H,x as U,y as Y,_ as O,p as C,l as G,n as J,a0 as M}from"./index-BvBYCJa7.js";import{C as F}from"./CodeBlock-BjIL_GX7.js";import{P as z}from"./PolicyTypeTag-C5VPJuwe.js";import{T as D}from"./TagList-Db36tjl5.js";import{t as q}from"./toYaml-DB9FPXFY.js";import{A as Q}from"./AppCollection-CLIWru18.js";import{R as W}from"./RuleMatchers-EsIIvyCU.js";const L=k=>(U("data-v-f3e7afbb"),k=k(),Y(),k),X={class:"policies-list"},Z={class:"mesh-gateway-policy-list"},E=L(()=>p("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),ee={key:0},te=L(()=>p("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),ae=L(()=>p("b",null,"Host",-1)),se=L(()=>p("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),le={class:"dataplane-policy-header"},oe=L(()=>p("b",null,"Route",-1)),ne=L(()=>p("b",null,"Service",-1)),ie={key:0,class:"badge-list"},ce={class:"mt-1"},re=S({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},policyTypesByName:{}},setup(k){const y=k;return(_,w)=>{const B=g("RouterLink"),b=g("KBadge");return e(),a("div",X,[p("div",Z,[E,l(),_.gatewayDataplane.routePolicies.length>0?(e(),a("ul",ee,[(e(!0),a(u,null,f(_.gatewayDataplane.routePolicies,(n,s)=>(e(),a("li",{key:s},[p("span",null,d(n.type),1),l(`:

          `),r(B,{to:{name:"policy-detail-view",params:{mesh:n.mesh,policyPath:y.policyTypesByName[n.type].path,policy:n.name}}},{default:t(()=>[l(d(n.name),1)]),_:2},1032,["to"])]))),128))])):R("",!0),l(),te,l(),p("div",null,[(e(!0),a(u,null,f(_.gatewayDataplane.listenerEntries,(n,s)=>(e(),a("div",{key:s},[p("div",null,[p("div",null,[ae,l(": "+d(n.hostName)+":"+d(n.port)+" ("+d(n.protocol)+`)
            `,1)]),l(),n.routeEntries.length>0?(e(),a(u,{key:0},[se,l(),r(K,{"initially-open":[],"multiple-open":""},{default:t(()=>[(e(!0),a(u,null,f(n.routeEntries,(o,i)=>(e(),m(I,{key:i},H({"accordion-header":t(()=>[p("div",le,[p("div",null,[p("div",null,[oe,l(": "),r(B,{to:{name:"policy-detail-view",params:{mesh:o.route.mesh,policyPath:y.policyTypesByName[o.route.type].path,policy:o.route.name}}},{default:t(()=>[l(d(o.route.name),1)]),_:2},1032,["to"])]),l(),p("div",null,[ne,l(": "+d(o.service),1)])]),l(),o.origins.length>0?(e(),a("div",ie,[(e(!0),a(u,null,f(o.origins,(c,h)=>(e(),m(b,{key:`${s}-${h}`},{default:t(()=>[l(d(c.type),1)]),_:2},1024))),128))])):R("",!0)])]),_:2},[o.origins.length>0?{name:"accordion-content",fn:t(()=>[p("ul",ce,[(e(!0),a(u,null,f(o.origins,(c,h)=>(e(),a("li",{key:`${s}-${h}`},[l(d(c.type)+`:

                        `,1),r(B,{to:{name:"policy-detail-view",params:{mesh:c.mesh,policyPath:y.policyTypesByName[c.type].path,policy:c.name}}},{default:t(()=>[l(d(c.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):R("",!0)])]))),128))])])])}}}),pe=O(re,[["__scopeId","data-v-f3e7afbb"]]),ue={class:"policy-type-heading"},de={class:"policy-list"},me={key:0},ye=S({__name:"PolicyTypeEntryList",props:{items:{},types:{}},setup(k){const y=k;function _({headerKey:w}){return{class:`cell-${w}`}}return(w,B)=>{const b=g("RouterLink"),n=g("KTable");return e(),m(K,{"initially-open":[],"multiple-open":""},{default:t(()=>[(e(!0),a(u,null,f(w.items,(s,o)=>(e(),m(I,{key:o},{"accordion-header":t(()=>[p("h3",ue,[r(z,{"policy-type":s.type},{default:t(()=>[l(d(s.type)+" ("+d(s.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":t(()=>[p("div",de,[r(n,{class:"policy-type-table",fetcher:()=>({data:s.connections,total:s.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":_,"disable-pagination":"","is-clickable":""},{sourceTags:t(({row:i})=>[i.sourceTags.length>0?(e(),m(D,{key:0,class:"tag-list","should-truncate":"",tags:i.sourceTags},null,8,["tags"])):(e(),a(u,{key:1},[l(`
                —
              `)],64))]),destinationTags:t(({row:i})=>[i.destinationTags.length>0?(e(),m(D,{key:0,class:"tag-list","should-truncate":"",tags:i.destinationTags},null,8,["tags"])):(e(),a(u,{key:1},[l(`
                —
              `)],64))]),name:t(({row:i})=>[i.name!==null?(e(),a(u,{key:0},[l(d(i.name),1)],64)):(e(),a(u,{key:1},[l(`
                —
              `)],64))]),origins:t(({row:i})=>[i.origins.length>0?(e(),a("ul",me,[(e(!0),a(u,null,f(i.origins,(c,h)=>(e(),a("li",{key:`${o}-${h}`},[r(b,{to:{name:"policy-detail-view",params:{mesh:c.mesh,policyPath:y.types[c.type].path,policy:c.name}}},{default:t(()=>[l(d(c.name),1)]),_:2},1032,["to"])]))),128))])):(e(),a(u,{key:1},[l(`
                —
              `)],64))]),config:t(({row:i})=>[i.config?(e(),m(F,{key:0,code:C(q)(i.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),a(u,{key:1},[l(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}}),_e=O(ye,[["__scopeId","data-v-e683f129"]]),he={class:"policy-type-heading"},fe={key:0,class:"matcher"},ge={key:1},ke={key:0},be=S({__name:"RuleEntryList",props:{rules:{},policyTypesByName:{}},setup(k){const{t:y}=G(),_=k;return(w,B)=>{const b=g("RouterLink");return e(),m(K,{"initially-open":[],"multiple-open":""},{default:t(()=>[(e(!0),a(u,null,f([_.rules.reduce((n,s)=>(typeof n[s.type]>"u"&&(n[s.type]=[]),n[s.type].push(s),n),{})],n=>(e(),a(u,{key:n},[(e(!0),a(u,null,f(n,(s,o)=>(e(),m(I,{key:o},{"accordion-header":t(()=>[p("h3",he,[r(z,{"policy-type":o},{default:t(()=>[l(d(o),1)]),_:2},1032,["policy-type"])])]),"accordion-content":t(()=>[(e(!0),a(u,null,f([s.some(i=>i.matchers.length>0)],i=>(e(),a("div",{key:i,class:"policy-list"},[r(Q,{class:J(["policy-type-table",{"has-matchers":i}]),total:s.length,items:s,headers:[...i?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:t(({row:c})=>[c.matchers.length>0?(e(),a("span",fe,[r(W,{items:c.matchers},null,8,["items"])])):(e(),a("i",ge,d(C(y)("data-planes.routes.item.matches_everything")),1))]),origins:t(({row:c})=>[c.origins.length>0?(e(),a("ul",ke,[(e(!0),a(u,null,f(c.origins,(h,P)=>(e(),a("li",{key:`${o}-${P}`},[r(b,{to:{name:"policy-detail-view",params:{mesh:h.mesh,policyPath:_.policyTypesByName[h.type].path,policy:h.name}}},{default:t(()=>[l(d(h.name),1)]),_:2},1032,["to"])]))),128))])):(e(),a(u,{key:1},[l(d(C(y)("common.collection.none")),1)],64))]),config:t(({row:c})=>[c.config?(e(),m(F,{key:0,code:C(q)(c.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),a(u,{key:1},[l(d(C(y)("common.collection.none")),1)],64))]),_:2},1032,["class","total","items","headers"])]))),128))]),_:2},1024))),128))],64))),128))]),_:1})}}}),A=O(be,[["__scopeId","data-v-aa9a6932"]]),$e={class:"stack"},ve={class:"mb-2"},Te=S({__name:"StandardDataplanePolicies",props:{rules:{},policyTypesByName:{}},setup(k){const{t:y}=G(),_=k;return(w,B)=>{const b=g("KCard"),n=g("DataCollection");return e(),a("div",$e,[r(n,{items:_.rules,predicate:s=>s.ruleType==="proxy",comparator:(s,o)=>s.type.localeCompare(o.type),empty:!1},{default:t(({items:s})=>[r(b,null,{default:t(()=>[p("h3",null,d(C(y)("data-planes.routes.item.proxy_rule")),1),l(),r(A,{class:"mt-2",rules:s,"policy-types-by-name":_.policyTypesByName,"data-testid":"proxy-rule-list"},null,8,["rules","policy-types-by-name"])]),_:2},1024)]),_:1},8,["items","predicate","comparator"]),l(),r(n,{items:_.rules,predicate:s=>s.ruleType==="to",comparator:(s,o)=>s.type.localeCompare(o.type),empty:!1},{default:t(({items:s})=>[r(b,null,{default:t(()=>[p("h3",null,d(C(y)("data-planes.routes.item.to_rules")),1),l(),r(A,{class:"mt-2",rules:s,"policy-types-by-name":_.policyTypesByName,"data-testid":"to-rule-list"},null,8,["rules","policy-types-by-name"])]),_:2},1024)]),_:1},8,["items","predicate","comparator"]),l(),r(n,{items:_.rules,predicate:s=>s.ruleType==="from",comparator:(s,o)=>s.type.localeCompare(o.type),empty:!1},{default:t(({items:s})=>[r(b,null,{default:t(()=>[p("h3",ve,d(C(y)("data-planes.routes.item.from_rules")),1),l(),(e(!0),a(u,null,f([Object.groupBy(s,o=>o.inbound.port)],o=>(e(),a(u,{key:o},[(e(!0),a(u,null,f(Object.entries(o).sort(([i],[c])=>Number(c)-Number(i)),([i,c],h)=>(e(),a("div",{key:h},[p("h4",null,d(C(y)("data-planes.routes.item.port",{port:i})),1),l(),r(A,{class:"mt-2",rules:c,"policy-types-by-name":_.policyTypesByName,"data-testid":`from-rule-list-${h}`},null,8,["rules","policy-types-by-name","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:1},8,["items","predicate","comparator"])])}}}),Ce={class:"stack"},Be={key:0},Ie=S({__name:"DataPlanePoliciesView",props:{data:{}},setup(k){const y=k;return(_,w)=>{const B=g("RouteTitle"),b=g("DataCollection"),n=g("DataLoader"),s=g("KCard"),o=g("DataSource"),i=g("AppView"),c=g("RouteView");return e(),m(c,{name:"data-plane-policies-view",params:{mesh:"",dataPlane:""}},{default:t(({can:h,route:P,t:j})=>[r(i,null,{title:t(()=>[p("h2",null,[r(B,{title:j("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"])])]),default:t(()=>[l(),p("div",Ce,[r(o,{src:"/*/policy-types"},{default:t(({data:N,error:V})=>[r(n,{src:`/meshes/${P.params.mesh}/dataplanes/${P.params.dataPlane}/rules`,data:[N],errors:[V]},{default:t(({data:T})=>[T&&N?(e(),m(b,{key:0,items:T.rules},{default:t(()=>[r(Te,{"policy-types-by-name":N.policies.reduce(($,v)=>Object.assign($,{[v.name]:v}),{}),rules:T.rules,"data-testid":"rules-based-policies"},null,8,["policy-types-by-name","rules"])]),_:2},1032,["items"])):R("",!0)]),_:2},1032,["src","data","errors"]),l(),h("use zones")?R("",!0):(e(),a("div",Be,[p("h3",null,d(j("data-planes.routes.item.legacy_policies")),1),l(),y.data.dataplaneType==="builtin"?(e(),m(n,{key:0,src:`/meshes/${P.params.mesh}/dataplanes/${P.params.dataPlane}/gateway-dataplane-policies`,data:[N],errors:[V]},{default:t(({data:T})=>[(e(!0),a(u,null,f([N.policies.reduce(($,v)=>Object.assign($,{[v.name]:v}),{})],$=>(e(),m(s,{key:$,class:"mt-4"},{default:t(()=>[T?(e(),m(b,{key:0,items:T.routePolicies},{default:t(()=>[T.listenerEntries.length===0?(e(),m(M,{key:0})):(e(),m(pe,{key:1,"policy-types-by-name":$,"gateway-dataplane":T,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["policy-types-by-name","gateway-dataplane"]))]),_:2},1032,["items"])):R("",!0)]),_:2},1024))),128))]),_:2},1032,["src","data","errors"])):(e(),m(n,{key:1,src:`/meshes/${P.params.mesh}/dataplanes/${P.params.dataPlane}/sidecar-dataplane-policies`,data:[N],errors:[V]},{default:t(({data:T})=>[(e(!0),a(u,null,f([N.policies.reduce(($,v)=>Object.assign($,{[v.name]:v}),{})],$=>(e(),m(s,{key:$,class:"mt-4"},{default:t(()=>[r(b,{predicate:v=>{var x;return((x=$[v.type])==null?void 0:x.isTargetRefBased)===!1},items:T.policyTypeEntries},{default:t(({items:v})=>[r(_e,{items:v,types:$,"data-testid":"sidecar-dataplane-policies"},null,8,["items","types"])]),_:2},1032,["predicate","items"])]),_:2},1024))),128))]),_:2},1032,["src","data","errors"]))]))]),_:2},1024)])]),_:2},1024)]),_:1})}}});export{Ie as default};
