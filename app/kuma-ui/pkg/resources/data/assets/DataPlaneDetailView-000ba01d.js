import{a as Z,K as E}from"./index-fce48c05.js";import{_ as B,a as x,o,b as f,w as e,m as s,r as w,f as t,d as z,c as i,e as r,k as F,t as l,l as a,F as c,D as v,n as j,J,W as Y,X as y,Y as Q,p as $,Z as tt,$ as et,a0 as at,v as st,x as nt}from"./index-a963f507.js";import{E as lt}from"./ErrorBlock-a09a5c02.js";import{_ as ot}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-c187db3a.js";import{S as rt}from"./StatusBadge-61c0813f.js";import{T as N}from"./TagList-dafbb3ea.js";import{T as q}from"./TextWithCopyButton-442c5ee6.js";import{_ as dt}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-b6e59a6f.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-0ab8cf0c.js";import"./CopyButton-003985ad.js";import"./AccordionList-caa11dc0.js";const it={},ct={class:"card"},ut={class:"title"},_t={class:"body"};function pt(h,n){const u=x("KCard");return o(),f(u,{class:"data-card"},{default:e(()=>[s("dl",null,[s("div",ct,[s("dt",ut,[w(h.$slots,"title",{},void 0,!0)]),t(),s("dd",_t,[w(h.$slots,"default",{},void 0,!0)])])])]),_:3})}const W=B(it,[["render",pt],["__scopeId","data-v-6e083223"]]),ft={class:"service-traffic"},mt={class:"actions"},vt=z({__name:"DataPlaneTraffic",setup(h){return(n,u)=>(o(),i("div",ft,[s("div",mt,[w(n.$slots,"actions",{},void 0,!0)]),t(),r(W,{class:"header"},{title:e(()=>[w(n.$slots,"title",{},void 0,!0)]),_:3}),t(),w(n.$slots,"default",{},void 0,!0)]))}});const U=B(vt,[["__scopeId","data-v-500eaf28"]]),ht={class:"title"},yt=z({__name:"ServiceTrafficCard",props:{protocol:{},traffic:{}},setup(h){const{t:n}=F(),u=h;return(_,I)=>{const G=x("KBadge");return o(),f(W,{class:"service-traffic-card"},{title:e(()=>[r(G,{appearance:u.protocol==="passthrough"?"success":"info"},{default:e(()=>[t(l(a(n)(`data-planes.components.service_traffic_card.protocol.${u.protocol}`,{},{defaultMessage:a(n)(`http.api.value.${u.protocol}`)})),1)]),_:1},8,["appearance"]),t(),s("div",ht,[w(_.$slots,"default",{},void 0,!0)])]),default:e(()=>{var A,S,b,R,P,K,M;return[t(),s("dl",null,[u.protocol==="passthrough"?(o(!0),i(c,{key:0},v([["http","tcp"].reduce((p,D)=>{const V="downstream";return Object.entries(u.traffic[D]||{}).reduce((C,[d,m])=>[`${V}_cx_tx_bytes_total`,`${V}_cx_rx_bytes_total`].includes(d)?{...C,[d]:m+(C[d]??0)}:C,p)},{})],(p,D)=>(o(),i(c,{key:D},[s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,l(a(n)("common.formats.bytes",{value:p.downstream_cx_rx_bytes_total??0})),1)]),t(),s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,l(a(n)("common.formats.bytes",{value:p.downstream_cx_tx_bytes_total??0})),1)])],64))),128)):u.protocol==="http"?(o(),i(c,{key:1},[(o(!0),i(c,null,v([((A=u.traffic.http)==null?void 0:A.downstream_rq_1xx)??0].filter(p=>p!==0),p=>(o(),i("div",{key:p},[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.1xx")),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:p})),1)]))),128)),t(),s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.2xx")),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:((S=u.traffic.http)==null?void 0:S.downstream_rq_2xx)??0})),1)]),t(),(o(!0),i(c,null,v([((b=u.traffic.http)==null?void 0:b.downstream_rq_3xx)??0].filter(p=>p!==0),p=>(o(),i("div",{key:p},[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.3xx")),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:p})),1)]))),128)),t(),s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.4xx")),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:((R=u.traffic.http)==null?void 0:R.downstream_rq_4xx)??0})),1)]),t(),s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.5xx")),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:((P=u.traffic.http)==null?void 0:P.downstream_rq_5xx)??0})),1)])],64)):(o(),i(c,{key:2},[s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,l(a(n)("common.formats.bytes",{value:((K=u.traffic.tcp)==null?void 0:K.downstream_cx_rx_bytes_total)??0})),1)]),t(),s("div",null,[s("dt",null,l(a(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,l(a(n)("common.formats.bytes",{value:((M=u.traffic.tcp)==null?void 0:M.downstream_cx_tx_bytes_total)??0})),1)])],64))])]}),_:3})}}});const O=B(yt,[["__scopeId","data-v-23b8b43b"]]),gt={class:"body"},xt=z({__name:"ServiceTrafficGroup",props:{type:{}},setup(h){const n=h;return(u,_)=>{const I=x("KCard");return o(),f(I,{class:j(["service-traffic-group",`type-${n.type}`])},{default:e(()=>[s("div",gt,[w(u.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}});const L=B(xt,[["__scopeId","data-v-baf4abf7"]]),kt=h=>(st("data-v-6ddc1117"),h=h(),nt(),h),bt={"data-testid":"dataplane-warnings"},$t=["data-testid","innerHTML"],wt={class:"stack","data-testid":"dataplane-details"},Ct={class:"columns"},Tt={class:"status-with-reason"},It={class:"columns"},Kt=kt(()=>s("span",null,"Outbounds",-1)),Dt={class:"passthrough"},Bt={class:"outbounds"},St={key:1,"data-testid":"dataplane-inbounds"},Rt={class:"inbound-list"},Pt={class:"mt-4 columns"},Mt={"data-testid":"dataplane-mtls"},Vt={class:"columns"},Et=["innerHTML"],qt={key:2,"data-testid":"dataplane-subscriptions"},zt=z({__name:"DataPlaneDetailView",props:{data:{}},setup(h){const{t:n,formatIsoDate:u}=F(),_=h,I=J(()=>_.data.warnings.concat(..._.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(G,A)=>{const S=x("KTooltip"),b=x("KCard"),R=x("KButton"),P=x("DataSource"),K=x("KBadge"),M=x("KAlert"),p=x("AppView"),D=x("RouteView");return o(),f(D,{params:{mesh:"",dataPlane:""},name:"data-plane-detail-view"},{default:e(({can:V,route:C})=>[r(p,null,Y({default:e(()=>[t(),s("div",wt,[r(b,null,{default:e(()=>[s("div",Ct,[r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.status")),1)]),body:e(()=>[s("div",Tt,[r(rt,{status:_.data.status},null,8,["status"]),t(),(o(!0),i(c,null,v([_.data.dataplane.networking.inbounds.filter(d=>!d.health.ready)],d=>(o(),i(c,{key:d},[d.length>0?(o(),f(S,{key:0,class:"reason-tooltip","position-fixed":""},{content:e(()=>[s("ul",null,[(o(!0),i(c,null,v(d,m=>(o(),i("li",{key:`${m.service}:${m.port}`},l(a(n)("data-planes.routes.item.unhealthy_inbound",{service:m.service,port:m.port})),1))),128))])]),default:e(()=>[r(a(Q),{color:a(Z),size:a(E),"hide-title":""},null,8,["color","size"]),t()]),_:2},1024)):$("",!0)],64))),128))])]),_:1}),t(),r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.last_updated")),1)]),body:e(()=>[t(l(a(u)(_.data.modificationTime)),1)]),_:1}),t(),_.data.dataplane.networking.gateway?(o(),i(c,{key:0},[r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.tags")),1)]),body:e(()=>[r(N,{tags:_.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:1}),t(),r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.address")),1)]),body:e(()=>[r(q,{text:`${_.data.dataplane.networking.address}`},null,8,["text"])]),_:1})],64)):$("",!0)])]),_:1}),t(),V("read traffic")&&_.data.dataplaneType==="standard"?(o(),f(P,{key:0,src:`/meshes/${C.params.mesh}/dataplanes/${C.params.dataPlane}/traffic`},{default:e(({data:d,error:m,refresh:X})=>[m?(o(),f(lt,{key:0,error:m},null,8,["error"])):d===void 0?(o(),f(ot,{key:1})):(o(),f(b,{key:2,class:"traffic"},{default:e(()=>[s("div",It,[r(U,null,{title:e(()=>[r(a(tt),{display:"inline-block",decorative:"",size:a(E)},null,8,["size"]),t(`
                  Inbounds
                `)]),data:e(()=>[s("dl",null,[s("div",null,[s("dt",null,l(a(n)("services.components.service_traffic.inbound",{},{defaultMessage:"Requests"})),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),r(L,{type:"inbound"},{default:e(()=>[(o(!0),i(c,null,v(d.inbounds,g=>(o(),i(c,{key:`${g.name}`},[(o(!0),i(c,null,v([g.name.split("_").at(-1)],T=>(o(),i(c,{key:T},[(o(!0),i(c,null,v([_.data.dataplane.networking.inbounds.find(k=>`${k.port}`==`${T}`)],k=>(o(),i(c,{key:k},[k?(o(),f(O,{key:0,protocol:typeof g.http<"u"?"http":"tcp",traffic:g},{default:e(()=>[t(`
                          :`+l(k.port)+" ",1),r(N,{tags:[{label:"kuma.io/service",value:k.tags["kuma.io/service"]}]},null,8,["tags"])]),_:2},1032,["protocol","traffic"])):$("",!0)],64))),128))],64))),128))],64))),128))]),_:2},1024)]),_:2},1024),t(),r(U,null,{actions:e(()=>[r(R,{appearance:"primary",onClick:X},{default:e(()=>[r(a(et),{size:a(E)},null,8,["size"]),t(`

                    Refresh
                  `)]),_:2},1032,["onClick"])]),title:e(()=>[r(a(at),{display:"inline-block",decorative:"",size:a(E)},null,8,["size"]),t(),Kt]),data:e(()=>[s("dl",null,[s("div",null,[s("dt",Dt,l(a(n)("services.components.service_traffic.passthrough",{},{defaultMessage:"Passthrough Requests"})),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:1e3})),1)]),t(),s("div",null,[s("dt",Bt,l(a(n)("services.components.service_traffic.mesh",{},{defaultMessage:"Mesh Requests"})),1),t(),s("dd",null,l(a(n)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),t(),r(L,{type:"passthrough"},{default:e(()=>[r(O,{protocol:"passthrough",traffic:d.passthrough},{default:e(()=>[t(`
                    Non mesh traffic
                  `)]),_:2},1032,["traffic"])]),_:2},1024),t(),r(L,{type:"outbound"},{default:e(()=>[(o(!0),i(c,null,v(d.outbounds,g=>(o(),i(c,{key:`${g.name}`},[(o(!0),i(c,null,v([typeof g.http<"u"?"http":"tcp"],T=>{var k,H;return o(),i(c,{key:T},[(T!=="http"?(k=g.tcp)==null?void 0:k.downstream_cx_rx_bytes_total:(H=g.http)==null?void 0:H.downstream_rq_total)??0>0?(o(),f(O,{key:0,protocol:T,traffic:g},{default:e(()=>[t(l(g.name),1)]),_:2},1032,["protocol","traffic"])):$("",!0)],64)}),128))],64))),128))]),_:2},1024)]),_:2},1024)])]),_:2},1024))]),_:2},1032,["src"])):$("",!0),t(),_.data.dataplane.networking.inbounds.length>0?(o(),i("div",St,[s("h2",null,l(a(n)("data-planes.routes.item.inbounds")),1),t(),r(b,{class:"mt-4"},{default:e(()=>[s("div",Rt,[(o(!0),i(c,null,v(_.data.dataplane.networking.inbounds,(d,m)=>(o(),i("div",{key:m,class:"inbound"},[s("h4",null,[r(q,{text:d.tags["kuma.io/service"]},{default:e(()=>[t(l(a(n)("data-planes.routes.item.inbound_name",{service:d.tags["kuma.io/service"]})),1)]),_:2},1032,["text"])]),t(),s("div",Pt,[r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.status")),1)]),body:e(()=>[d.health.ready?(o(),f(K,{key:0,appearance:"success"},{default:e(()=>[t(l(a(n)("data-planes.routes.item.health.ready")),1)]),_:1})):(o(),f(K,{key:1,appearance:"danger"},{default:e(()=>[t(l(a(n)("data-planes.routes.item.health.not_ready")),1)]),_:1}))]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.tags")),1)]),body:e(()=>[r(N,{tags:d.tags},null,8,["tags"])]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.address")),1)]),body:e(()=>[r(q,{text:d.addressPort},null,8,["text"])]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("http.api.property.serviceAddress")),1)]),body:e(()=>[r(q,{text:d.serviceAddressPort},null,8,["text"])]),_:2},1024)])]))),128))])]),_:1})])):$("",!0),t(),s("div",Mt,[s("h2",null,l(a(n)("data-planes.routes.item.mtls.title")),1),t(),_.data.dataplaneInsight.mTLS?(o(!0),i(c,{key:0},v([_.data.dataplaneInsight.mTLS],d=>(o(),f(b,{key:d,class:"mt-4"},{default:e(()=>[s("div",Vt,[r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:e(()=>[t(l(a(u)(d.certificateExpirationTime)),1)]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.mtls.generation_time.title")),1)]),body:e(()=>[t(l(a(u)(d.lastCertificateRegeneration)),1)]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.mtls.regenerations.title")),1)]),body:e(()=>[t(l(a(n)("common.formats.integer",{value:d.certificateRegenerations})),1)]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:e(()=>[t(l(d.issuedBackend),1)]),_:2},1024),t(),r(y,null,{title:e(()=>[t(l(a(n)("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:e(()=>[s("ul",null,[(o(!0),i(c,null,v(d.supportedBackends,m=>(o(),i("li",{key:m},l(m),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(o(),f(M,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:e(()=>[s("div",{innerHTML:a(n)("data-planes.routes.item.mtls.disabled")},null,8,Et)]),_:1}))]),t(),_.data.dataplaneInsight.subscriptions.length>0?(o(),i("div",qt,[s("h2",null,l(a(n)("data-planes.routes.item.subscriptions.title")),1),t(),r(b,{class:"mt-4"},{default:e(()=>[r(dt,{subscriptions:_.data.dataplaneInsight.subscriptions},null,8,["subscriptions"])]),_:1})])):$("",!0)])]),_:2},[I.value.length>0?{name:"notifications",fn:e(()=>[s("ul",bt,[(o(!0),i(c,null,v(I.value,d=>(o(),i("li",{key:d.kind,"data-testid":`warning-${d.kind}`,innerHTML:a(n)(`common.warnings.${d.kind}`,d.payload)},null,8,$t))),128)),t()])]),key:"0"}:void 0]),1024)]),_:1})}}});const jt=B(zt,[["__scopeId","data-v-6ddc1117"]]);export{jt as default};
