import{A as O,a as F}from"./AccordionList-a75f0783.js";import{d as K,P as A,a as g,o as e,c as u,p as a,f as t,F as k,J as L,t as _,e as m,w as s,v as C,b as l,a5 as H,B as J,C as M,_ as T,E as G,D}from"./index-18b1553c.js";import{_ as U}from"./SidecarDataplanePolicyList.vue_vue_type_script_setup_true_lang-46814fd2.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-3f6534fa.js";import"./PolicyTypeTag-5a89fb25.js";import"./TagList-a9024701.js";import"./toYaml-4e00099e.js";const b=v=>(J("data-v-c7f30269"),v=v(),M(),v),q={class:"policies-list"},z={class:"mesh-gateway-policy-list"},Q=b(()=>a("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),W={key:0},X=b(()=>a("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),Y=b(()=>a("b",null,"Host",-1)),Z=b(()=>a("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),E={class:"dataplane-policy-header"},ee=b(()=>a("b",null,"Route",-1)),te=b(()=>a("b",null,"Service",-1)),ae={key:0,class:"badge-list"},se={class:"mt-1"},oe=K({__name:"GatewayDataplanePolicyList",props:{gatewayDataplane:{},policyTypesByName:{}},setup(v){const P=v,I=A(()=>S(P.gatewayDataplane)),V=A(()=>y(P.gatewayDataplane.policies));function S(h){const f=[],i=h.listeners??[];for(const o of i)for(const n of o.hosts)for(const p of n.routes){const c=[];for(const w of p.destinations){const r=y(w.policies),d={routeName:p.route,route:{name:"policy-detail-view",params:{mesh:h.gateway.mesh,policyPath:"meshgatewayroutes",policy:p.route}},service:w.tags["kuma.io/service"],policies:r};c.push(d)}f.push({protocol:o.protocol,port:o.port,hostName:n.hostName,routeEntries:c})}return f}function y(h){if(h===void 0)return[];const f=[];for(const i of Object.values(h)){const o=P.policyTypesByName[i.type];f.push({type:i.type,name:i.name,route:{name:"policy-detail-view",params:{mesh:i.mesh,policyPath:o.path,policy:i.name}}})}return f}return(h,f)=>{const i=g("router-link"),o=g("KBadge");return e(),u("div",q,[a("div",z,[Q,t(),V.value.length>0?(e(),u("ul",W,[(e(!0),u(k,null,L(V.value,(n,p)=>(e(),u("li",{key:p},[a("span",null,_(n.type),1),t(`:

          `),m(i,{to:n.route},{default:s(()=>[t(_(n.name),1)]),_:2},1032,["to"])]))),128))])):C("",!0),t(),X,t(),a("div",null,[(e(!0),u(k,null,L(I.value,(n,p)=>(e(),u("div",{key:p},[a("div",null,[a("div",null,[Y,t(": "+_(n.hostName)+":"+_(n.port)+" ("+_(n.protocol)+`)
            `,1)]),t(),n.routeEntries.length>0?(e(),u(k,{key:0},[Z,t(),m(F,{"initially-open":[],"multiple-open":""},{default:s(()=>[(e(!0),u(k,null,L(n.routeEntries,(c,w)=>(e(),l(O,{key:w},H({"accordion-header":s(()=>[a("div",E,[a("div",null,[a("div",null,[ee,t(": "),m(i,{to:c.route},{default:s(()=>[t(_(c.routeName),1)]),_:2},1032,["to"])]),t(),a("div",null,[te,t(": "+_(c.service),1)])]),t(),c.policies.length>0?(e(),u("div",ae,[(e(!0),u(k,null,L(c.policies,(r,d)=>(e(),l(o,{key:`${p}-${d}`},{default:s(()=>[t(_(r.type),1)]),_:2},1024))),128))])):C("",!0)])]),_:2},[c.policies.length>0?{name:"accordion-content",fn:s(()=>[a("ul",se,[(e(!0),u(k,null,L(c.policies,(r,d)=>(e(),u("li",{key:`${p}-${d}`},[t(_(r.type)+`:

                        `,1),m(i,{to:r.route},{default:s(()=>[t(_(r.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):C("",!0)])]))),128))])])])}}});const ne=T(oe,[["__scopeId","data-v-c7f30269"]]),_e=K({__name:"GatewayPoliciesView",props:{data:{}},setup(v){const P=v;return(I,V)=>{const S=g("RouteTitle"),y=g("DataSource"),h=g("KCard"),f=g("AppView"),i=g("RouteView");return e(),l(i,{name:"gateway-policies-view",params:{mesh:"",dataPlane:""}},{default:s(({route:o,t:n})=>[m(f,null,{title:s(()=>[a("h2",null,[m(S,{title:n("gateways.routes.item.navigation.gateway-policies-view"),render:!0},null,8,["title"])])]),default:s(()=>[t(),m(h,null,{body:s(()=>{var p,c,w;return[((w=(c=(p=P.data.dataplane)==null?void 0:p.networking)==null?void 0:c.gateway)==null?void 0:w.type)==="BUILTIN"?(e(),l(y,{key:0,src:"/*/policy-types"},{default:s(({data:r,error:d})=>[m(y,{src:`/meshes/${o.params.mesh}/gateways/${o.params.dataPlane}/policies`},{default:s(({data:$,error:N})=>[d?(e(),l(G,{key:0,error:d},null,8,["error"])):N?(e(),l(G,{key:1,error:N},null,8,["error"])):$===void 0||r===void 0?(e(),l(D,{key:2})):(e(),l(ne,{key:3,"policy-types-by-name":r.policies.reduce((R,B)=>Object.assign(R,{[B.name]:B}),{}),"gateway-dataplane":$},null,8,["policy-types-by-name","gateway-dataplane"]))]),_:2},1032,["src"])]),_:2},1024)):(e(),l(y,{key:1,src:"/*/policy-types"},{default:s(({data:r,error:d})=>[m(y,{src:`/meshes/${o.params.mesh}/dataplanes/${o.params.dataPlane}/sidecar-dataplanes-policies`},{default:s(({data:$,error:N})=>[m(y,{src:`/meshes/${o.params.mesh}/dataplanes/${o.params.dataPlane}/rules`},{default:s(({data:R,error:B})=>[d?(e(),l(G,{key:0,error:d},null,8,["error"])):N?(e(),l(G,{key:1,error:N},null,8,["error"])):B?(e(),l(G,{key:2,error:B},null,8,["error"])):r===void 0||$===void 0||R===void 0?(e(),l(D,{key:3})):(e(),l(U,{key:4,"policy-types-by-name":r.policies.reduce((j,x)=>Object.assign(j,{[x.name]:x}),{}),"sidecar-dataplanes":$.items,rules:R.items},null,8,["policy-types-by-name","sidecar-dataplanes","rules"]))]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1024))]}),_:2},1024)]),_:2},1024)]),_:1})}}});export{_e as default};
