import{u as K}from"./vue-router-573afc44.js";import{_ as O}from"./kongponents.es-3df60cd6.js";import{C as U}from"./ContentWrapper-b0fa1a61.js";import{u as A}from"./store-866e3b85.js";import{_ as S,a as R,M as W}from"./MeshResources-aa3a4471.js";import{d as F,c as d,y as Y,o,h as i,e as p,u as t,f as l,r as C,l as j,w as M,b as B,F as k,g as u,v as D,t as h,a as $,p as q,m as z}from"./runtime-dom.esm-bundler-91b41870.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as G}from"./LabelList.vue_vue_type_style_index_0_lang-4346c84c.js";import{_ as H}from"./YamlView.vue_vue_type_script_setup_true_lang-d444e9d2.js";import{k as N}from"./kumaApi-db784568.js";import{s as J,h as T}from"./helpers-32595d9f.js";import"./vuex.esm-bundler-df5bd11e.js";import"./dataplane-4aecf58f.js";import"./constants-31fdaf55.js";import"./ClientStorage-efe299d9.js";import"./Instance-292830fe.js";import"./index-f6b877ca.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-4047971f.js";import"./ErrorBlock-46fedade.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-d3176fee.js";import"./index-a8834e9c.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-98064716.js";import"./_commonjsHelpers-87174ba5.js";const Q={class:"chart-container mt-24"},Z=F({__name:"MeshCharts",setup(v){const a=A(),f=d(()=>a.getters.getServiceResourcesFetching),m=d(()=>a.getters.getMeshInsightsFetching),y=d(()=>a.getters.getChart("services")),g=d(()=>a.getters.getChart("dataplanes")),r=d(()=>a.getters.getChart("policies")),V=d(()=>a.getters.getChart("kumaDPVersions")),I=d(()=>a.getters.getChart("envoyVersions"));Y(()=>a.state.selectedMesh,function(){w()}),w();function w(){a.dispatch("fetchMeshInsights",a.state.selectedMesh),a.dispatch("fetchServices",a.state.selectedMesh)}return(E,P)=>(o(),i("div",Q,[p(S,{class:"chart",title:{singular:"SERVICE",plural:"SERVICES"},data:t(y).data,"is-loading":t(f),"save-chart":""},null,8,["data","is-loading"]),l(),p(S,{class:"chart",title:{singular:"DP PROXY",plural:"DP PROXIES"},data:t(g).data,url:{name:"data-plane-list-view",params:{mesh:t(a).state.selectedMesh}},"is-loading":t(m)},null,8,["data","url","is-loading"]),l(),p(S,{class:"chart",title:{singular:"POLICY",plural:"POLICIES"},data:t(r).data,url:{name:"policies",params:{mesh:t(a).state.selectedMesh}},"is-loading":t(m)},null,8,["data","url","is-loading"]),l(),p(R,{class:"chart",title:"KUMA DP",data:t(V).data,"is-loading":t(m)},null,8,["data","is-loading"]),l(),p(R,{class:"chart",title:"ENVOY",data:t(I).data,"is-loading":t(m),"display-am-charts-logo":""},null,8,["data","is-loading"])]))}});const ee=X(Z,[["__scopeId","data-v-2a02347c"]]),te=v=>(q("data-v-fd1a3799"),v=v(),z(),v),ae={key:0},se={key:1},ne={key:1},oe={class:"policy-counts"},le=te(()=>u("h4",null,`
                  Policies
                `,-1)),re={key:0},ie={key:0,class:"mt-4"},ce=F({__name:"MeshOverviewView",setup(v){const a=K(),f=A(),m=C(!0),y=C(!1),g=C(!1),r=C(null),V=C(null),I=d(()=>r.value!==null?J(r.value):null),w=d(()=>{if(r.value===null)return null;const{name:s,type:n,creationTime:_,modificationTime:e}=r.value;return{name:s,type:n,created:T(_),modified:T(e),"Data Plane Proxies":f.state.meshInsight.dataplanes.total}}),E=d(()=>{var L;if(r.value===null)return null;const s=b(r.value,"mtls"),n=b(r.value,"logging"),_=b(r.value,"metrics"),e=b(r.value,"tracing"),c=Boolean((L=r.value.routing)==null?void 0:L.localityAwareLoadBalancing);return{mtls:s,logging:n,metrics:_,tracing:e,localityAwareLoadBalancing:c}}),P=d(()=>f.state.policyTypes.map(s=>{var n;return{...s,length:((n=f.state.meshInsight.policies[s.name])==null?void 0:n.total)??0}}));Y(()=>a.params.mesh,function(){a.name==="single-mesh-overview"&&(m.value=!0,g.value=!1,y.value=!1,x())}),x();async function x(){m.value=!0,g.value=!1;const s=a.params.mesh;try{r.value=await N.getMesh({name:s}),V.value=await N.getMeshInsights({name:s})}catch(n){y.value=!0,g.value=!0,console.error(n)}finally{m.value=!1}}function b(s,n){if(s===null||s[n]===void 0)return!1;const _=s[n].enabledBackend??s[n].defaultBackend??s[n].backends[0].name,e=s[n].backends.find(c=>c.name===_);return`${e.type} / ${e.name}`}return(s,n)=>{const _=j("router-link");return o(),i(k,null,[p(ee),l(),p(U,{class:"mt-8"},{content:M(()=>[r.value!==null?(o(),i("div",ae,[p(G,{"has-error":y.value,"is-loading":m.value,"is-empty":g.value},{default:M(()=>[u("div",null,[u("ul",null,[(o(!0),i(k,null,D(t(w),(e,c)=>(o(),i("li",{key:c},[u("h4",null,h(c),1),l(),typeof e=="boolean"?(o(),$(t(O),{key:0,appearance:e?"success":"danger"},{default:M(()=>[l(h(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(o(),i("p",se,h(e),1))]))),128))])]),l(),u("div",null,[u("ul",null,[(o(!0),i(k,null,D(t(E),(e,c)=>(o(),i("li",{key:c},[u("h4",null,h(c),1),l(),typeof e=="boolean"?(o(),$(t(O),{key:0,appearance:e?"success":"danger"},{default:M(()=>[l(h(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(o(),i("p",ne,h(e),1))]))),128))])]),l(),u("div",null,[u("ul",oe,[u("li",null,[le,l(),u("ul",null,[(o(!0),i(k,null,D(t(P),(e,c)=>(o(),i(k,{key:c},[e.length!==0?(o(),i("li",re,[p(_,{to:{name:"policies",params:{policyType:e.path}}},{default:M(()=>[l(h(e.name)+": "+h(e.length),1)]),_:2},1032,["to"])])):B("",!0)],64))),128))])])])])]),_:1},8,["has-error","is-loading","is-empty"])])):B("",!0)]),_:1}),l(),t(I)!==null?(o(),i("div",ie,[p(H,{id:"code-block-mesh",content:t(I)},null,8,["content"])])):B("",!0),l(),p(W,{class:"mt-6"})],64)}}});const Le=X(ce,[["__scopeId","data-v-fd1a3799"]]);export{Le as default};
