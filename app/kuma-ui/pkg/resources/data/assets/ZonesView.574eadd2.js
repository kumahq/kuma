import{_ as x,P,k as H,Q as R,K as h,R as w,H as F,l as M,S as G,U,o as a,f as g,b as d,w as t,d as l,n as _,h as m,t as E,F as C,j as k,e as I,r as o}from"./index.6180ff6f.js";import{S as q,a as J}from"./SubscriptionHeader.f3e62532.js";import{M as j}from"./MultizoneInfo.dfca5c53.js";import{C as Y}from"./CodeBlock.c76d2442.js";import{g as Q}from"./tableDataUtils.9642ba3f.js";import{F as X}from"./FrameSkeleton.9d8fd5de.js";import{D as $,L as ee}from"./LabelList.33120ec9.js";import{T as te}from"./TabsWidget.6e628a3c.js";import{A as se,a as ne}from"./AccordionItem.ddeeebdc.js";import{E as oe}from"./EntityURLControl.1c6f3e0f.js";import{W as ie}from"./WarningsWidget.947749b9.js";import"./datadogEvents.f0c2b8e0.js";const ae={name:"ZonesView",components:{AccordionList:se,AccordionItem:ne,FrameSkeleton:X,DataOverview:$,TabsWidget:te,LabelList:ee,WarningsWidget:ie,CodeBlock:Y,SubscriptionDetails:q,SubscriptionHeader:J,MultizoneInfo:j,EntityURLControl:oe},data(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,empty_state:{title:"No Data",message:"There are no Zones present."},tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Status",key:"status"},{label:"Name",key:"name"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Storage type",key:"storeType"},{label:"Ingress",key:"hasIngress"},{label:"Egress",key:"hasEgress"},{key:"warnings",hideLabel:!0}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#insights",title:"Zone Insights"},{hash:"#config",title:"Config"},{hash:"#warnings",title:"Warnings"}],entity:{},pageSize:P,next:null,warnings:[],subscriptionsReversed:[],codeOutput:null,zonesWithIngress:new Set}},computed:{...H({multicluster:"config/getMulticlusterStatus",globalCpVersion:"config/getVersion"})},watch:{$route(){this.isLoading=!0,this.isEmpty=!1,this.hasError=!1,this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,this.tableDataIsEmpty=!1,this.init()}},beforeMount(){this.init()},methods:{init(){this.multicluster&&this.loadData()},filterTabs(){return this.warnings.length?this.tabs:this.tabs.filter(n=>n.hash!=="#warnings")},tableAction(n){const s=n;this.getEntity(s)},parseData(n){const{zoneInsight:s={},name:i}=n;let c="-",e="",u=!0;return s.subscriptions&&s.subscriptions.length&&s.subscriptions.forEach((p,y)=>{if(p.version&&p.version.kumaCp){c=p.version.kumaCp.version;const{kumaCpGlobalCompatible:f=!0}=p.version.kumaCp;u=f,p.config&&(e=JSON.parse(p.config).store.type)}}),{...n,status:R(s).status,zoneCpVersion:c,storeType:e,hasIngress:this.zonesWithIngress.has(i)?"Yes":"No",hasEgress:this.zonesWithEgress.has(i)?"Yes":"No",withWarnings:!u}},calculateZonesWithIngress(n){const s=new Set;n.forEach(({zoneIngress:{zone:i}})=>{s.add(i)}),this.zonesWithIngress=s},calculateZonesWithEgress(n){const s=new Set;n.forEach(({zoneEgress:{zone:i}})=>{s.add(i)}),this.zonesWithEgress=s},async loadData(n="0"){this.isLoading=!0,this.isEmpty=!1;const s=this.$route.query.ns||null;try{const[{data:i,next:c},{items:e},{items:u}]=await Promise.all([Q({getSingleEntity:h.getZoneOverview.bind(h),getAllEntities:h.getAllZoneOverviews.bind(h),size:this.pageSize,offset:n,query:s}),w({callEndpoint:h.getAllZoneIngressOverviews.bind(h)}),w({callEndpoint:h.getAllZoneEgressOverviews.bind(h)})]);this.next=c,i.length?(this.calculateZonesWithIngress(e),this.calculateZonesWithEgress(u),this.tableData.data=i.map(this.parseData),this.tableDataIsEmpty=!1,this.isEmpty=!1,this.getEntity({name:i[0].name})):(this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.entityIsEmpty=!0)}catch(i){this.hasError=!0,this.isEmpty=!0,console.error(i)}finally{this.isLoading=!1}},async getEntity(n){this.entityIsLoading=!0,this.entityIsEmpty=!0;const s=["type","name"],i=setTimeout(()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1},"500");if(n){this.entityIsEmpty=!1,this.warnings=[];try{const c=await h.getZoneOverview({name:n.name}),e=F(c,"zoneInsight.subscriptions",[]);if(this.entity={...M(c,s),"Authentication Type":G(c)},this.subscriptionsReversed=Array.from(e).reverse(),e.length){const{version:u={}}=e[e.length-1],{kumaCp:p={}}=u,y=p.version||"-",{kumaCpGlobalCompatible:f=!0}=p;f||this.warnings.push({kind:U,payload:{zoneCpVersion:y,globalCpVersion:this.globalCpVersion}}),e[e.length-1].config&&(this.codeOutput=JSON.stringify(JSON.parse(e[e.length-1].config),null,2))}}catch(c){console.error(c),this.entity={},this.entityHasError=!0,this.entityIsEmpty=!0}finally{clearTimeout(i)}}this.entityIsLoading=!1}}},re={class:"zones"},le=m("span",{class:"custom-control-icon"}," \u2190 ",-1),ce=I(" View All "),pe={key:0},ue={key:1},he={key:2},me=I(" Copy config to clipboard "),ge=m("div",null,[m("p",null,"Config copied to clipboard!")],-1);function de(n,s,i,c,e,u){const p=o("MultizoneInfo"),y=o("KButton"),f=o("DataOverview"),L=o("EntityURLControl"),S=o("KBadge"),D=o("LabelList"),z=o("SubscriptionHeader"),A=o("SubscriptionDetails"),O=o("AccordionItem"),W=o("AccordionList"),v=o("KCard"),T=o("CodeBlock"),Z=o("KPop"),V=o("KClipboardProvider"),B=o("WarningsWidget"),N=o("TabsWidget"),K=o("FrameSkeleton");return a(),g("div",re,[n.multicluster===!1?(a(),d(p,{key:0})):(a(),d(K,{key:1},{default:t(()=>[l(f,{"page-size":e.pageSize,"has-error":e.hasError,"is-loading":e.isLoading,"empty-state":e.empty_state,"table-data":e.tableData,"table-data-is-empty":e.tableDataIsEmpty,"show-warnings":e.tableData.data.some(r=>r.withWarnings),next:e.next,onTableAction:u.tableAction,onLoadData:s[0]||(s[0]=r=>u.loadData(r))},{additionalControls:t(()=>[n.$route.query.ns?(a(),d(y,{key:0,class:"back-button",appearance:"primary",size:"small",to:{name:"zones"}},{default:t(()=>[le,ce]),_:1})):_("",!0)]),_:1},8,["page-size","has-error","is-loading","empty-state","table-data","table-data-is-empty","show-warnings","next","onTableAction"]),e.isEmpty===!1?(a(),d(N,{key:0,"has-error":e.hasError,"is-loading":e.isLoading,tabs:u.filterTabs(),"initial-tab-override":"overview"},{tabHeader:t(()=>[m("div",null,[m("h3",null," Zone: "+E(e.entity.name),1)]),m("div",null,[l(L,{name:e.entity.name},null,8,["name"])])]),overview:t(()=>[l(D,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:t(()=>[m("div",null,[m("ul",null,[(a(!0),g(C,null,k(e.entity,(r,b)=>(a(),g("li",{key:b},[r?(a(),g("h4",pe,E(b),1)):_("",!0),b==="status"?(a(),g("p",ue,[l(S,{appearance:r==="Offline"?"danger":"success"},{default:t(()=>[I(E(r),1)]),_:2},1032,["appearance"])])):(a(),g("p",he,E(r),1))]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])]),insights:t(()=>[l(v,{"border-variant":"noBorder"},{body:t(()=>[l(W,{"initially-open":0},{default:t(()=>[(a(!0),g(C,null,k(e.subscriptionsReversed,(r,b)=>(a(),d(O,{key:b},{"accordion-header":t(()=>[l(z,{details:r},null,8,["details"])]),"accordion-content":t(()=>[l(A,{details:r},null,8,["details"])]),_:2},1024))),128))]),_:1})]),_:1})]),config:t(()=>[e.codeOutput?(a(),d(v,{key:0,"border-variant":"noBorder"},{body:t(()=>[l(T,{language:"json",code:e.codeOutput},null,8,["code"])]),actions:t(()=>[e.codeOutput?(a(),d(V,{key:0},{default:t(({copyToClipboard:r})=>[l(Z,{placement:"bottom"},{content:t(()=>[ge]),default:t(()=>[l(y,{appearance:"primary",onClick:()=>{r(e.codeOutput)}},{default:t(()=>[me]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})):_("",!0)]),_:1})):_("",!0)]),warnings:t(()=>[l(B,{warnings:e.warnings},null,8,["warnings"])]),_:1},8,["has-error","is-loading","tabs"])):_("",!0)]),_:1}))])}const De=x(ae,[["render",de]]);export{De as default};
