import{d as rt,a7 as lt,r as b,p as l,o as s,w as t,b as a,m as $,a8 as ut,c as y,e as n,N as f,L as x,q as C,O as v,T as mt,l as X,t as p,M as Q,y as yt,_ as ft}from"./index-K8WBfyYN.js";import{S as ct}from"./SummaryView-DUl3MTqg.js";import{T as kt}from"./TagList-CAPFPTf6.js";import{C as U,a as R,b as A}from"./ConnectionTraffic-BpJ83eQ0.js";import{K as W}from"./kri-CjUta6FR.js";const bt=rt({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(Y){const T=lt(),i=Y;return(gt,e)=>{const z=b("XI18n"),E=b("XNotification"),V=b("XIcon"),N=b("DataCollection"),c=b("XLayout"),h=b("XAction"),_=b("XBadge"),Z=b("XCopyButton"),L=b("XAboutCard"),q=b("XEmptyState"),tt=b("XInputSwitch"),et=b("XProgress"),at=b("XCard"),nt=b("RouterView"),ot=b("AppView"),st=b("DataSource"),it=b("RouteView");return s(),l(it,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:t(({route:k,t:m,can:B,uri:dt})=>[a(st,{src:dt($(ut),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[k.params.proxyType]??"dataplane",name:k.params.proxy,mesh:k.params.mesh||"*",socketAddress:i.data.dataplane.networking.inboundAddress})},{default:t(({data:g,error:D,refresh:pt})=>[a(ot,{notifications:!0},{default:t(()=>{var O,P,S,j,K,M,F,G,H,J;return[(s(!0),y(f,null,x([{bool:((P=(O=i.data.dataplaneInsight.version)==null?void 0:O.kumaDp)==null?void 0:P.kumaCpCompatible)===!1,key:"dp-cp-incompatible",params:{kumaDp:((S=i.data.dataplaneInsight.version)==null?void 0:S.kumaDp.version)??""}},{bool:((K=(j=i.data.dataplaneInsight.version)==null?void 0:j.envoy)==null?void 0:K.kumaDpCompatible)===!1,key:"envoy-dp-incompatible",params:{envoy:((M=i.data.dataplaneInsight.version)==null?void 0:M.envoy.version)??"",kumaDp:((F=i.data.dataplaneInsight.version)==null?void 0:F.kumaDp.version)??""}},{bool:!!(B("use zones")&&i.data.zone&&((H=(G=i.data.dataplaneInsight.version)==null?void 0:G.kumaDp)==null?void 0:H.kumaCpCompatible)===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:((J=i.data.dataplaneInsight.version)==null?void 0:J.kumaDp.version)??""}},{bool:i.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:i.data.isCertExpired,key:"certificate-expired"},{bool:!i.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!!D,key:"stats-not-enhanced",params:{error:(D==null?void 0:D.toString())??""}},{bool:!B("use transparent-proxying",i.data),key:"networking-transparent-proxying",variant:"info"}],({bool:o,key:d,params:r,variant:u})=>(s(),l(E,{key:d,notify:o,"data-testid":`warning-${d}`,uri:`data-planes.notifications.${d}.${i.data.id}`,variant:u},{default:t(()=>[a(z,{path:`data-planes.notifications.${d}`,params:Object.fromEntries(Object.entries(r??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),e[48]||(e[48]=n()),a(c,{type:"stack","data-testid":"dataplane-details"},{default:t(()=>[a(L,{title:m("data-planes.routes.item.about.title"),created:i.data.creationTime,modified:i.data.modificationTime,class:"about-section"},{default:t(()=>[a(c,null,{default:t(()=>[a(c,{type:"separated"},{default:t(()=>[a(v,{layout:"horizontal"},{title:t(()=>[n(p(m("http.api.property.status")),1)]),body:t(()=>[a(c,{type:"separated"},{default:t(()=>[a(mt,{status:i.data.status},null,8,["status"]),e[0]||(e[0]=n()),i.data.dataplaneType==="standard"?(s(),l(N,{key:0,items:i.data.dataplane.networking.inbounds,predicate:o=>o.state!=="Ready",empty:!1},{default:t(({items:o})=>[a(V,{name:"info"},{default:t(()=>[X("ul",null,[(s(!0),y(f,null,x(o,d=>(s(),y("li",{key:`${d.service}:${d.port}`},p(m("data-planes.routes.item.unhealthy_inbound",{service:d.service,port:d.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):C("",!0)]),_:2},1024)]),_:2},1024),e[7]||(e[7]=n()),B("use zones")&&i.data.zone?(s(),l(v,{key:0,layout:"horizontal"},{title:t(()=>[n(p(m("http.api.property.zone")),1)]),body:t(()=>[a(_,{appearance:"decorative"},{default:t(()=>[a(h,{to:{name:"zone-cp-detail-view",params:{zone:i.data.zone}}},{default:t(()=>[n(p(i.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2},1024)):C("",!0),e[8]||(e[8]=n()),a(v,{layout:"horizontal"},{title:t(()=>[n(p(m("http.api.property.type")),1)]),body:t(()=>[a(_,{appearance:"decorative"},{default:t(()=>[n(p(m(`data-planes.type.${i.data.dataplaneType}`)),1)]),_:2},1024)]),_:2},1024),e[9]||(e[9]=n()),i.data.namespace.length>0?(s(),l(v,{key:1,layout:"horizontal"},{title:t(()=>[n(p(m("http.api.property.namespace")),1)]),body:t(()=>[a(_,{appearance:"decorative"},{default:t(()=>[n(p(i.data.namespace),1)]),_:1})]),_:2},1024)):C("",!0),e[10]||(e[10]=n()),a(v,{layout:"horizontal"},{title:t(()=>[n(p(m("http.api.property.address")),1)]),body:t(()=>[a(Z,{variant:"badge",format:"default",text:`${i.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024),e[11]||(e[11]=n()),i.data.dataplane.networking.gateway?(s(),l(v,{key:2,layout:"horizontal"},{title:t(()=>[n(p(m("http.api.property.tags")),1)]),body:t(()=>[a(kt,{tags:i.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024)):C("",!0)]),_:2},1024),e[29]||(e[29]=n()),i.data.dataplaneInsight.mTLS?(s(),l(c,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:t(()=>[X("h3",null,p(m("data-planes.routes.item.mtls.title")),1),e[21]||(e[21]=n()),a(c,{size:"small"},{default:t(()=>[(s(!0),y(f,null,x([i.data.dataplaneInsight.mTLS],o=>(s(),y(f,{key:o},[a(c,{type:"separated"},{default:t(()=>[typeof o.lastCertificateRegeneration<"u"&&typeof o.certificateExpirationTime<"u"&&typeof o.issuedBackend<"u"?(s(),y(f,{key:0},[a(v,{layout:"horizontal"},{title:t(()=>[a(z,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:t(()=>[a(_,{appearance:"neutral"},{default:t(()=>[n(p(m("common.formats.datetime",{value:Date.parse(o.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2},1024),e[14]||(e[14]=n()),a(v,{layout:"horizontal"},{title:t(()=>[a(z,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:t(()=>[a(_,{appearance:"neutral"},{default:t(()=>[n(p(m("common.formats.datetime",{value:Date.parse(o.certificateExpirationTime)})),1)]),_:2},1024)]),_:2},1024)],64)):(s(),l(z,{key:1,path:"data-planes.routes.item.mtls.managed_externally"}))]),_:2},1024),e[20]||(e[20]=n()),a(c,{type:"separated"},{default:t(()=>[typeof o.certificateRegenerations<"u"?(s(),l(v,{key:0,layout:"horizontal"},{title:t(()=>[n(p(m("data-planes.routes.item.mtls.regenerations.title")),1)]),body:t(()=>[a(_,{appearance:"info"},{default:t(()=>[n(p(m("common.formats.integer",{value:o.certificateRegenerations})),1)]),_:2},1024)]),_:2},1024)):C("",!0),e[18]||(e[18]=n()),o.issuedBackend?(s(),l(v,{key:1,layout:"horizontal"},{title:t(()=>[n(p(m("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:t(()=>[$(W).isKri(o.issuedBackend)?(s(),l(h,{key:0,to:{name:"data-plane-mesh-identity-summary-view",params:{...$(W).fromString(o.issuedBackend)}}},{default:t(()=>[a(_,{appearance:"decorative"},{default:t(()=>[n(p(o.issuedBackend),1)]),_:2},1024)]),_:2},1032,["to"])):(s(),l(_,{key:1,appearance:"decorative"},{default:t(()=>[n(p(o.issuedBackend),1)]),_:2},1024))]),_:2},1024)):C("",!0),e[19]||(e[19]=n()),typeof o.supportedBackends<"u"?(s(),l(v,{key:2,layout:"horizontal"},{title:t(()=>[n(p(m("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:t(()=>[a(c,{type:"separated",truncate:""},{default:t(()=>[(s(!0),y(f,null,x(o.supportedBackends,d=>(s(),l(_,{key:d,appearance:d===o.issuedBackend?"decorative":"info"},{default:t(()=>[n(p(d),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2},1024)):C("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):C("",!0),e[30]||(e[30]=n()),i.data.dataplaneInsight.subscriptions.length>0?(s(),l(c,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:t(()=>[a(c,{type:"separated"},{default:t(()=>[X("h3",null,p(m("data-planes.routes.item.subscriptions.title")),1),e[22]||(e[22]=n()),a(h,{"data-action":"",appearance:"anchor",to:{name:"data-plane-subscriptions-summary-view",params:{mesh:k.params.mesh,proxy:k.params.proxy},query:{inactive:k.params.inactive}}},{default:t(()=>[n(`
                    (`+p(m("data-planes.routes.item.xds.show-details"))+`)
                  `,1)]),_:2},1032,["to"])]),_:2},1024),e[28]||(e[28]=n()),(s(!0),y(f,null,x([[...i.data.dataplaneInsight.subscriptions].reverse()],o=>(s(),l(c,{key:typeof o,type:"separated"},{default:t(()=>[(s(!0),y(f,null,x([o.find(d=>!d.disconnectTime)??o[0]],d=>(s(),y(f,{key:d.id},[!d.disconnectTime&&d.connectTime?(s(),y(f,{key:0},[a(v,{layout:"horizontal"},{title:t(()=>[a(z,{path:"data-planes.routes.item.xds.connected"})]),body:t(()=>[a(_,{appearance:"neutral"},{default:t(()=>[n(p(m("common.formats.datetime",{value:Date.parse(d.connectTime)})),1)]),_:2},1024)]),_:2},1024),e[26]||(e[26]=n()),a(v,{layout:"horizontal"},{title:t(()=>[a(z,{path:"data-planes.routes.item.xds.instance"})]),body:t(()=>[a(_,{appearance:"info"},{default:t(()=>[n(p(d.controlPlaneInstanceId),1)]),_:2},1024)]),_:2},1024),e[27]||(e[27]=n()),a(v,{layout:"horizontal"},{title:t(()=>[a(z,{path:"data-planes.routes.item.xds.version"})]),body:t(()=>[a(_,{appearance:"info"},{default:t(()=>{var r,u;return[n(p(((u=(r=d.version)==null?void 0:r.kumaDp)==null?void 0:u.version)??m("common.unknown")),1)]}),_:2},1024)]),_:2},1024)],64)):(s(),l(z,{key:1,path:"data-planes.routes.item.xds.disconnected"}))],64))),128))]),_:2},1024))),128))]),_:2},1024)):C("",!0)]),_:2},1024)]),_:2},1032,["title","created","modified"]),e[46]||(e[46]=n()),a(at,{class:"traffic","data-testid":"dataplane-traffic"},{default:t(()=>[a(c,{type:"columns"},{default:t(()=>[a(U,null,{title:t(()=>[a(c,{type:"separated"},{default:t(()=>[a(V,{name:"inbound"}),e[31]||(e[31]=n()),e[32]||(e[32]=X("span",null,"Inbounds",-1))]),_:1})]),default:t(()=>[e[34]||(e[34]=n()),(s(!0),y(f,null,x([i.data.dataplane.networking.type==="gateway"?Object.entries((g==null?void 0:g.inbounds)??{}).reduce((o,[d,r])=>{var w;const u=d.split("_").at(-1);return u===(((w=i.data.dataplane.networking.admin)==null?void 0:w.port)??"9901")?o:o.concat([{...i.data.dataplane.networking.inbounds[0],name:d,clusterName:d,port:Number(u),protocol:["http","tcp"].find(I=>typeof r[I]<"u")??"tcp",addressPort:`${i.data.dataplane.networking.inbounds[0].address}:${u}`}])},[]):i.data.dataplane.networking.inbounds],o=>(s(),l(R,{key:o,type:"inbound","data-testid":"dataplane-inbounds"},{default:t(()=>[a(N,{type:"inbounds",items:o,predicate:d=>d.port!==49151},Q({default:t(({items:d})=>[a(c,{type:"stack",size:"small"},{default:t(()=>[(s(!0),y(f,null,x(d,r=>(s(),y(f,{key:`${r.name}`},[(s(!0),y(f,null,x([g==null?void 0:g.inbounds[r.clusterName]],u=>(s(),l(A,{key:u,"data-testid":"dataplane-inbound",protocol:r.protocol,"port-name":r.portName,service:B("use service-insights",i.mesh)?r.tags["kuma.io/service"]:"",traffic:typeof D>"u"?u:{name:"",protocol:r.protocol,port:`${r.port}`}},{default:t(()=>[a(h,{"data-action":"",to:{name:(w=>w.includes("bound")?w.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String($(T).name)),params:{connection:r.name},query:{inactive:k.params.inactive}}},{default:t(()=>[n(p(r.name.replace("localhost","").replace("_",":")),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","service","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},[i.data.dataplaneType==="delegated"?{name:"empty",fn:t(()=>[a(q,null,{default:t(()=>[X("p",null,`
                            This proxy is a delegated gateway therefore `+p(m("common.product.name"))+` does not have any
                            visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),e[45]||(e[45]=n()),a(U,null,Q({title:t(()=>[a(c,{type:"separated"},{default:t(()=>[a(V,{name:"outbound"}),e[38]||(e[38]=n()),e[39]||(e[39]=X("span",null,"Outbounds",-1))]),_:1})]),default:t(()=>[e[43]||(e[43]=n()),e[44]||(e[44]=n()),typeof D>"u"?(s(),y(f,{key:0},[typeof g>"u"?(s(),l(et,{key:0})):(s(),y(f,{key:1},[a(R,{type:"passthrough"},{default:t(()=>[a(A,{protocol:"passthrough",traffic:g.passthrough},{default:t(()=>[...e[40]||(e[40]=[n(`
                        Non mesh traffic
                      `,-1)])]),_:2},1032,["traffic"])]),_:2},1024),e[42]||(e[42]=n()),(s(),y(f,null,x(["upstream"],o=>(s(),y(f,{key:o},[a(E,{notify:!!Object.values(g.outbounds).find(d=>{var r,u;return(typeof d.tcp<"u"?(r=d.tcp)==null?void 0:r[`${o}_cx_rx_bytes_total`]:(u=d.http)==null?void 0:u[`${o}_rq_total`])??!1}),variant:"info",uri:`data-planes.notifications.recommend-reachable-services:${i.data.id}`},{default:t(()=>[a(z,{path:"data-planes.notifications.recommend-reachable",params:{mode:i.mesh.meshServices.mode}},null,8,["params"])]),_:2},1032,["notify","uri"]),e[41]||(e[41]=n()),a(N,{type:"outbounds",predicate:k.params.inactive?void 0:([d,r])=>{var u,w;return((typeof r.tcp<"u"?(u=r.tcp)==null?void 0:u[`${o}_cx_rx_bytes_total`]:(w=r.http)==null?void 0:w[`${o}_rq_total`])??0)>0},items:Object.entries(g.outbounds)},{default:t(({items:d})=>[d.length>0?(s(),l(R,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:t(()=>[(s(),y(f,null,x([/-([a-f0-9]){16}$/],r=>a(c,{key:r,type:"stack",size:"small"},{default:t(()=>[(s(!0),y(f,null,x(d,([u,w])=>(s(),l(A,{key:`${u}`,"data-testid":"dataplane-outbound",protocol:["grpc","http","tcp"].find(I=>typeof w[I]<"u")??"tcp",traffic:w,service:w.$resourceMeta.type===""?u.replace(r,""):void 0,direction:o},{default:t(()=>[a(h,{"data-action":"",to:{name:(I=>I.includes("bound")?I.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String($(T).name)),params:{connection:u},query:{inactive:k.params.inactive}}},{default:t(()=>[n(p(u),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","service","direction"]))),128))]),_:2},1024)),64))]),_:2},1024)):C("",!0)]),_:2},1032,["predicate","items"])],64))),64))],64))],64)):(s(),l(q,{key:1}))]),_:2},[g?{name:"actions",fn:t(()=>[a(tt,{checked:k.params.inactive,"data-testid":"dataplane-outbounds-inactive-toggle",onChange:o=>k.update({inactive:o})},{label:t(()=>[...e[35]||(e[35]=[n(`
                      Show inactive
                    `,-1)])]),_:2},1032,["checked","onChange"]),e[37]||(e[37]=n()),a(h,{action:"refresh",appearance:"primary",onClick:pt},{default:t(()=>[...e[36]||(e[36]=[n(`
                    Refresh
                  `,-1)])]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024),e[47]||(e[47]=n()),a(nt,null,{default:t(o=>[o.route.name!==k.name?(s(),l(ct,{key:0,width:o.route.name==="data-plane-subscriptions-summary-view"?"900px":"670px",onClose:function(){k.replace({name:"data-plane-detail-view",params:{mesh:k.params.mesh,proxy:k.params.proxy},query:{inactive:k.params.inactive?null:void 0}})}},{default:t(()=>[(s(),l(yt(o.Component),{data:k.params.subscription.length>0?i.data.dataplaneInsight.subscriptions:o.route.name.includes("-inbound-")?i.data.dataplane.networking.inbounds:(g==null?void 0:g.outbounds)||{},networking:i.data.dataplane.networking,subscriptions:i.data.dataplaneInsight.subscriptions},null,8,["data","networking","subscriptions"]))]),_:2},1032,["width","onClose"])):C("",!0)]),_:2},1024)]),_:2},1024)]}),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),zt=ft(bt,[["__scopeId","data-v-5d67c85d"]]);export{zt as default};
