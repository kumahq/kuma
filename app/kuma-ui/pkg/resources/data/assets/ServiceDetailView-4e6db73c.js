import{d as N,o,e as B,h as S,g as q,a as m,f as I,F as L,u as T,q as f,s as O,w as P,b as F,k as V}from"./index-52119cf8.js";import{S as j}from"./ServiceSummary-1a29a720.js";import{D as z}from"./DataPlaneList-0f08534e.js";import{j as C,k as R,g as G,_ as Q}from"./RouteView.vue_vue_type_script_setup_true_lang-28e29218.js";import{_ as W}from"./RouteTitle.vue_vue_type_script_setup_true_lang-a8ac9aaf.js";import{_ as J}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-7a4f8b94.js";import{E as K}from"./ErrorBlock-fa2d4d1f.js";import{_ as M}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-618897f3.js";import{Q as H}from"./QueryParameter-70743f73.js";import"./kongponents.es-6866aec3.js";import"./DefinitionListItem-127050a5.js";import"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-804c7a65.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-3c985a9b.js";import"./TextWithCopyButton-3ef5285a.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-8f27e6ff.js";import"./toYaml-4e00099e.js";import"./StatusBadge-285693a5.js";import"./TagList-cb24b524.js";import"./ContentWrapper-61f4b009.js";import"./DataOverview-bf417d75.js";const U=N({__name:"ServiceDetails",props:{service:{type:Object,required:!0},externalService:{type:Object,required:!1,default:null},dataPlaneOverviews:{type:Array,required:!1,default:null},dppFilterFields:{type:Object,required:!0},selectedDppName:{type:String,required:!1,default:null}},emits:["load-dataplane-overviews"],setup(w,{emit:_}){const e=w;function a(p,u){var c;(((c=e.service.serviceType)==null?void 0:c.startsWith("gateway"))??!1)||delete u.gateway,_("load-dataplane-overviews",p,u)}return(p,u)=>{var t;return o(),B(L,null,[S(j,{service:e.service,"external-service":w.externalService},null,8,["service","external-service"]),q(),e.dataPlaneOverviews!==null?(o(),m(z,{key:0,class:"mt-4","data-plane-overviews":e.dataPlaneOverviews,"dpp-filter-fields":e.dppFilterFields,"selected-dpp-name":e.selectedDppName,"is-gateway-view":((t=e.dataPlaneOverviews[0])==null?void 0:t.dataplane.networking.gateway)!==void 0,onLoadData:a},null,8,["data-plane-overviews","dpp-filter-fields","selected-dpp-name","is-gateway-view"])):I("",!0)],64)}}}),X={class:"service-details"},ge=N({__name:"ServiceDetailView",props:{selectedDppName:{type:String,required:!1,default:null}},setup(w){const _=w,e=C(),a=T(),{t:p}=R(),u={name:{description:"filter by name or parts of a name"},protocol:{description:"filter by “kuma.io/protocol” value"},tag:{description:"filter by tags (e.g. “tag: version:2”)"},zone:{description:"filter by “kuma.io/zone” value"}},t=f(null),c=f(null),y=f(null),h=f(!0),g=f(null);O(()=>a.params.mesh,function(){a.name==="service-detail-view"&&k(0)}),O(()=>a.params.name,function(){a.name==="service-detail-view"&&k(0)});function E(){const r=H.get("filterFields"),n=r!==null?JSON.parse(r):{};k(0,n)}E();async function k(r,n={}){h.value=!0,g.value=null,t.value=null,c.value=null,y.value=null;const s=a.params.mesh,v=a.params.service;try{t.value=await e.getServiceInsight({mesh:s,name:v}),t.value.serviceType==="external"?c.value=await e.getExternalServiceByServiceInsightName(s,v):await b(r,n)}catch(i){i instanceof Error?g.value=i:console.error(i)}finally{h.value=!1}}async function b(r,n){const s=a.params.mesh,v=a.params.service;try{const i=$(v,r,n),l=await e.getAllDataplaneOverviewsFromMesh({mesh:s},i);y.value=l.items??[]}catch{y.value=null}}function $(r,n,s){const i=`kuma.io/service:${r}`,l={...s,offset:n,size:50};if(l.tag){const x=Array.isArray(l.tag)?l.tag:[l.tag],D=[];for(const[d,A]of x.entries())A.startsWith("kuma.io/service:")&&D.push(d);for(let d=D.length-1;d===0;d--)x.splice(D[d],1);l.tag=x.concat(i)}else l.tag=i;return l}return(r,n)=>(o(),m(Q,{module:"services"},{default:P(({route:s})=>[S(W,{title:F(p)("services.routes.item.title",{name:s.params.service})},null,8,["title"]),q(),S(G,{breadcrumbs:[{to:{name:"services-list-view",params:{mesh:s.params.mesh}},text:F(p)("services.routes.item.breadcrumbs")}]},{default:P(()=>[V("div",X,[h.value?(o(),m(M,{key:0})):g.value!==null?(o(),m(K,{key:1,error:g.value},null,8,["error"])):t.value===null?(o(),m(J,{key:2})):(o(),m(U,{key:3,service:t.value,"data-plane-overviews":y.value,"external-service":c.value,"dpp-filter-fields":u,"selected-dpp-name":_.selectedDppName,onLoadDataplaneOverviews:b},null,8,["service","data-plane-overviews","external-service","selected-dpp-name"]))])]),_:2},1032,["breadcrumbs"])]),_:1}))}});export{ge as default};
