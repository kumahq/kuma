import{d as F,o as i,c as T,w as l,a as g,u as s,K as Q,b as I,e as R,r as e,f as B,g as U,h as X,k as N,i as ee,j as w,l as a,m as ae,v as te,F as H,n as O,t as V,p as se,q as le,P as z,s as K,x as M,y as ne,z as P,A as oe,B as re,C as ie,D as ue}from"./index.3a3d021f.js";import{D as ce}from"./DataOverview.529ae0fd.js";import{_ as pe}from"./EntityURLControl.vue_vue_type_script_setup_true_lang.c0a3cdda.js";import{F as me}from"./FrameSkeleton.0eaca3db.js";import{_ as W}from"./LabelList.vue_vue_type_style_index_0_lang.7ae57614.js";import{T as de}from"./TabsWidget.8d50c7e4.js";import{Y as ve}from"./YamlView.291639eb.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.ed08f409.js";import"./ErrorBlock.e950a812.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.fa633f42.js";import"./TagList.4e52fad1.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.1ff82bc9.js";import"./_commonjsHelpers.f037b798.js";const ye=F({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(p){const m=p;return(x,d)=>(i(),T(s(R),{class:"docs-link",appearance:"outline",target:"_blank",to:m.href},{icon:l(()=>[g(s(Q),{icon:"externalLink"})]),default:l(()=>[I(" Documentation ")]),_:1},8,["to"]))}}),he=a("h4",null,"Dataplanes",-1),fe=F({__name:"PolicyConnections",props:{mesh:{type:String,required:!0},policyType:{type:String,required:!0},policyName:{type:String,required:!0}},setup(p){const m=p,x=e(!1),d=e(!0),D=e(!1),b=e([]),v=e(""),k=B(()=>{const u=v.value.toLowerCase();return b.value.filter(({dataplane:n})=>n.name.toLowerCase().includes(u))});U(()=>m.policyName,function(){y()}),X(function(){y()});async function y(){D.value=!1,d.value=!0;try{const{items:u,total:n}=await N.getPolicyConnections({mesh:m.mesh,policyType:m.policyType,policyName:m.policyName});x.value=n>0,b.value=u}catch{D.value=!0}finally{d.value=!1}}return(u,n)=>{const E=ee("router-link");return i(),w("div",null,[g(W,{"has-error":D.value,"is-loading":d.value,"is-empty":!x.value},{default:l(()=>[a("ul",null,[a("li",null,[he,ae(a("input",{id:"dataplane-search","onUpdate:modelValue":n[0]||(n[0]=t=>v.value=t),type:"text",class:"k-input mb-4",placeholder:"Filter by name",required:""},null,512),[[te,v.value]]),(i(!0),w(H,null,O(s(k),(t,h)=>(i(),w("p",{key:h,class:"my-1","data-testid":"dataplane-name"},[g(E,{to:{name:"data-plane-detail-view",params:{mesh:t.dataplane.mesh,dataPlane:t.dataplane.name}}},{default:l(()=>[I(V(t.dataplane.name),1)]),_:2},1032,["to"])]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])])}}}),Y=p=>(re("data-v-b6299113"),p=p(),ie(),p),_e={key:0,class:"mb-4"},ge=Y(()=>a("p",null,[a("strong",null,"Warning"),I(" This policy is experimental. If you encountered any problem please open an "),a("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),be=Y(()=>a("span",{class:"custom-control-icon"}," \u2190 ",-1)),ke={"data-testid":"policy-single-entity"},we={"data-testid":"policy-overview-tab"},De={class:"config-wrapper"},Ee=F({__name:"PolicyView",props:{policyPath:{type:String,required:!0}},setup(p){const m=p,x=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],d=se(),D=le(),b=e(!0),v=e(!1),k=e(null),y=e(!0),u=e(!1),n=e(!1),E=e(!1),t=e({}),h=e(null),q=e(null),A=e({headers:[{label:"Actions",key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Mesh",key:"mesh"},{label:"Type",key:"type"}],data:[]}),c=B(()=>D.state.policiesByPath[m.policyPath]),j=B(()=>`https://kuma.io/docs/${D.getters["config/getKumaDocsVersion"]}/policies/${c.value.path}/`);U(()=>d.params.mesh,function(){d.name===m.policyPath&&(b.value=!0,v.value=!1,y.value=!0,u.value=!1,n.value=!1,E.value=!1,k.value=null,$())}),$();async function $(o=0){b.value=!0,k.value=null;const r=d.query.ns||null,f=d.params.mesh,S=c.value.path;try{let _;if(f!==null&&r!==null)_=[await N.getSinglePolicyEntity({mesh:f,path:S,name:r})],q.value=null;else{const L={size:z,offset:o},C=await N.getAllPolicyEntitiesFromMesh({mesh:f,path:S},L);_=C.items,q.value=C.next}if(_.length>0){A.value.data=_.map(J=>G(J)),E.value=!1,v.value=!1;const L=["type","name","mesh"],C=_[0];t.value=K(C,L),h.value=M(C)}else A.value.data=[],E.value=!0,v.value=!0,u.value=!0}catch(_){_ instanceof Error?k.value=_:console.error(_),v.value=!0}finally{b.value=!1,y.value=!1}}function G(o){if(!o.mesh)return o;const r=o,f={name:"mesh-detail-view",params:{mesh:o.mesh}};return r.meshRoute=f,r}async function Z(o){n.value=!1,y.value=!0,u.value=!1;try{const r=await N.getSinglePolicyEntity({mesh:o.mesh,path:c.value.path,name:o.name});if(r){const f=["type","name","mesh"];t.value=K(r,f),h.value=M(r)}else t.value={},u.value=!0}catch(r){n.value=!0,console.error(r)}finally{y.value=!1}}return(o,r)=>s(c)?(i(),w("div",{key:0,class:oe(["relative",s(c).path])},[s(c).isExperimental?(i(),w("div",_e,[g(s(ne),{appearance:"warning"},{alertMessage:l(()=>[ge]),_:1})])):P("",!0),g(me,null,{default:l(()=>[g(ce,{"selected-entity-name":t.value.name,"page-size":s(z),error:k.value,"is-loading":b.value,"empty-state":{title:"No Data",message:`There are no ${s(c).pluralDisplayName} present.`},"table-data":A.value,"table-data-is-empty":E.value,next:q.value,onTableAction:Z,onLoadData:$},{additionalControls:l(()=>[g(ye,{href:s(j),"data-testid":"policy-documentation-link"},null,8,["href"]),o.$route.query.ns?(i(),T(s(R),{key:0,class:"back-button",appearance:"primary",to:{name:s(c).path}},{default:l(()=>[be,I(" View All ")]),_:1},8,["to"])):P("",!0)]),default:l(()=>[I(" > ")]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next"]),v.value===!1?(i(),T(de,{key:0,"has-error":k.value!==null,error:k.value,"is-loading":b.value,tabs:x,"initial-tab-override":"overview"},{tabHeader:l(()=>[a("div",null,[a("h3",ke,V(s(c).singularDisplayName)+": "+V(t.value.name),1)]),a("div",null,[g(pe,{name:t.value.name,mesh:t.value.mesh},null,8,["name","mesh"])])]),overview:l(()=>[g(W,{"has-error":n.value,"is-loading":y.value,"is-empty":u.value},{default:l(()=>[a("div",we,[a("ul",null,[(i(!0),w(H,null,O(t.value,(f,S)=>(i(),w("li",{key:S},[a("h4",null,V(S),1),a("p",null,V(f),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"]),a("div",De,[h.value!==null?(i(),T(ve,{key:0,id:"code-block-policy","has-error":n.value,"is-loading":y.value,"is-empty":u.value,content:h.value,"is-searchable":""},null,8,["has-error","is-loading","is-empty","content"])):P("",!0)])]),"affected-dpps":l(()=>[h.value!==null?(i(),T(fe,{key:0,mesh:h.value.mesh,"policy-name":h.value.name,"policy-type":s(c).path},null,8,["mesh","policy-name","policy-type"])):P("",!0)]),_:1},8,["has-error","error","is-loading"])):P("",!0)]),_:1})],2)):P("",!0)}});const ze=ue(Ee,[["__scopeId","data-v-b6299113"]]);export{ze as default};
