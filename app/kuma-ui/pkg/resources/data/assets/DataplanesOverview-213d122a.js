import{z as x}from"./kongponents.es-c2485d1e.js";import{P as k,e as w}from"./production-c33f040b.js";import{k as _}from"./kumaApi-302acf12.js";import{L as P}from"./LoadingBox-da7c932b.js";import{S as B}from"./StatusBadge-940bb1dd.js";import{a as N,O as S}from"./OnboardingNavigation-0c346547.js";import{O as A}from"./OnboardingPage-fe05b34b.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";import{i as a,a as f,w as n,o as s,e as r,a4 as F,g as l,t as p,h as u,f as b,F as H}from"./runtime-dom.esm-bundler-32659b48.js";import"./store-96085224.js";const I={name:"DataplanesOverview",components:{OnboardingNavigation:N,OnboardingHeading:S,OnboardingPage:A,LoadingBox:P,StatusBadge:B,KTable:x},metaInfo(){return{title:this.title}},data(){return{productName:k,tableHeaders:[{label:"Mesh",key:"mesh"},{label:"Name",key:"name"},{label:"Status",key:"status"}],tableData:{total:0,data:[]},timeout:null}},computed:{title(){return this.tableData.data.length?"Success":"Waiting for DPPs"},description(){return this.tableData.data.length?"The following data plane proxies (DPPs) are connected to the control plane:":null}},created(){this.getAllDataplanes()},beforeUnmount(){clearTimeout(this.timeout)},methods:{async getAllDataplanes(){let c=!1;const d=[];try{const{items:o}=await _.getAllDataplanes({size:10});if(Array.isArray(o))for(const g of o){const{name:t,mesh:e}=g,m=await _.getDataplaneOverviewFromMesh({mesh:e,name:t}),i=w(m.dataplaneInsight);i==="offline"&&(c=!0),d.push({status:i,name:t,mesh:e})}}catch(o){console.error(o)}this.tableData.data=d,this.tableData.total=this.tableData.data.length,c&&(this.timeout=setTimeout(()=>{this.getAllDataplanes()},1e3))}}},L={key:0,class:"justify-center flex my-4"},z={key:1},C={class:"flex justify-center mt-10 mb-16 pb-16"},K={class:"w-full sm:w-3/5 p-4"},M={class:"font-bold mb-4"};function j(c,d,o,g,t,e){const m=a("OnboardingHeading"),i=a("LoadingBox"),v=a("StatusBadge"),D=a("KTable"),y=a("OnboardingNavigation"),O=a("OnboardingPage");return s(),f(O,null,{header:n(()=>[r(m,null,F({title:n(()=>[l("p",null,p(e.title),1)]),_:2},[e.description!==null?{name:"description",fn:n(()=>[l("p",null,p(e.description),1)]),key:"0"}:void 0]),1024)]),content:n(()=>[t.tableData.data.length?(s(),u("div",z,[l("div",C,[l("div",K,[l("p",M,`
              Found `+p(t.tableData.data.length)+` DPPs:
            `,1),b(),r(D,{class:"onboarding-dataplane-table",fetcher:()=>t.tableData,headers:t.tableHeaders,"disable-pagination":"","is-small":""},{status:n(({rowValue:h})=>[h?(s(),f(v,{key:0,status:h},null,8,["status"])):(s(),u(H,{key:1},[b(`
                  â€”
                `)],64))]),_:1},8,["fetcher","headers"])])])])):(s(),u("div",L,[r(i)]))]),navigation:n(()=>[r(y,{"next-step":"onboarding-completed","previous-step":"onboarding-add-services-code","should-allow-next":t.tableData.data.length>0},null,8,["should-allow-next"])]),_:1})}const Y=T(I,[["render",j]]);export{Y as default};
