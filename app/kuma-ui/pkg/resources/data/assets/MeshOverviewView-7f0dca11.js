import{z as M,I as L}from"./kongponents.es-b7114d58.js";import{d as A,u as O,c as d,v as R,o as n,j as u,g as o,h as l,r as w,N,x as G,w as r,e as C,b as p,i as E,F as f,q as B,t as v,f as S}from"./index-6f18d0d5.js";import{D as x}from"./DoughnutChart-022de0e2.js";import{u as z}from"./store-ffbd1d65.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import{D as V,a as I}from"./DefinitionListItem-8bc09ece.js";import{M as H}from"./MeshResources-90ac75e5.js";import{_ as J}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-24920f35.js";import{_ as Q}from"./StatusInfo.vue_vue_type_script_setup_true_lang-e7fa6724.js";import{T as U}from"./TextWithCopyButton-fe762ac6.js";import{u as X}from"./index-ba9458d7.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-d9734676.js";import"./toYaml-4e00099e.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-57391115.js";import"./ErrorBlock-b14b6241.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-646c9f8e.js";const Y={class:"chart-box-list"},Z=A({__name:"MeshCharts",setup(K){const g=O(),c=z(),_=d(()=>c.getters.getChart("services",{title:"Services",showTotal:!0})),y=d(()=>c.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),k=d(()=>c.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),s=d(()=>c.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));R(()=>g.params.mesh,function(m){typeof m=="string"&&b(m)},{immediate:!0});function b(m){c.dispatch("fetchMeshInsights",m),c.dispatch("fetchServices",m)}return(m,P)=>(n(),u("div",Y,[o(x,{data:_.value},null,8,["data"]),l(),o(x,{data:y.value},null,8,["data"]),l(),o(x,{data:k.value},null,8,["data"]),l(),o(x,{data:s.value},null,8,["data"])]))}});const ee=F(Z,[["__scopeId","data-v-5ab6d374"]]),te={class:"kcard-stack"},ae={class:"columns"},se={key:0},ne=A({__name:"MeshOverviewView",setup(K){const g=X(),c=O(),_=z(),y=w(!0),k=w(!1),s=w(null),b=w(null),m=d(()=>{if(s.value===null)return null;const{name:t,type:a,creationTime:h,modificationTime:e}=s.value;return{name:t,type:a,created:N(h),modified:N(e),"Data Plane Proxies":_.state.meshInsight.dataplanes.total}}),P=d(()=>{var $;if(s.value===null)return null;const t=D(s.value,"mtls"),a=D(s.value,"logging"),h=D(s.value,"metrics"),e=D(s.value,"tracing"),i=!!(($=s.value.routing)!=null&&$.localityAwareLoadBalancing);return{mtls:t,logging:a,metrics:h,tracing:e,localityAwareLoadBalancing:i}}),j=d(()=>_.state.sidebar.insights.mesh.policies.total),q=d(()=>_.state.policyTypes.map(t=>{var a;return{...t,length:((a=_.state.meshInsight.policies[t.name])==null?void 0:a.total)??0}}));R(()=>c.params.mesh,function(){c.name==="single-mesh-overview"&&T()}),T();async function T(){y.value=!0,k.value=!1;const t=c.params.mesh;try{s.value=await g.getMesh({name:t}),b.value=await g.getMeshInsights({name:t})}catch(a){k.value=!0,s.value=null,b.value=null,console.error(a)}finally{y.value=!1}}function D(t,a){if(t===null||t[a]===void 0)return!1;const h=t[a].enabledBackend??t[a].defaultBackend??t[a].backends[0].name,e=t[a].backends.find(i=>i.name===h);return`${e.type} / ${e.name}`}async function W(t){const a=c.params.mesh;return await g.getMesh({name:a},t)}return(t,a)=>{const h=G("router-link");return n(),u("div",te,[o(C(M),null,{body:r(()=>[o(ee)]),_:1}),l(),s.value!==null?(n(),p(C(M),{key:0},{body:r(()=>[E("div",ae,[o(Q,{"is-loading":y.value,"has-error":k.value,"is-empty":s.value===null||b.value===null},{default:r(()=>[o(V,null,{default:r(()=>[(n(!0),u(f,null,B(m.value,(e,i)=>(n(),p(I,{key:i,term:i},{default:r(()=>[typeof e=="boolean"?(n(),p(C(L),{key:0,appearance:e?"success":"danger"},{default:r(()=>[l(v(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):i==="name"&&typeof e=="string"?(n(),p(U,{key:1,text:e},null,8,["text"])):(n(),u(f,{key:2},[l(v(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1})]),_:1},8,["is-loading","has-error","is-empty"]),l(),o(V,null,{default:r(()=>[(n(!0),u(f,null,B(P.value,(e,i)=>(n(),p(I,{key:i,term:i},{default:r(()=>[typeof e=="boolean"?(n(),p(C(L),{key:0,appearance:e?"success":"danger"},{default:r(()=>[l(v(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(n(),u(f,{key:1},[l(v(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),l(),o(V,null,{default:r(()=>[o(I,{term:`Policies (${j.value})`},{default:r(()=>[E("ul",null,[(n(!0),u(f,null,B(q.value,(e,i)=>(n(),u(f,{key:i},[e.length!==0?(n(),u("li",se,[o(h,{to:{name:"policies-list-view",params:{policyPath:e.path}}},{default:r(()=>[l(v(e.name)+": "+v(e.length),1)]),_:2},1032,["to"])])):S("",!0)],64))),128))])]),_:1},8,["term"])]),_:1})])]),_:1})):S("",!0),l(),o(C(M),null,{body:r(()=>{var e;return[o(J,{id:"code-block-mesh","resource-fetcher":W,"resource-fetcher-watch-key":((e=s.value)==null?void 0:e.name)||null},null,8,["resource-fetcher-watch-key"])]}),_:1}),l(),o(H)])}}});const be=F(ne,[["__scopeId","data-v-b1e00ce4"]]);export{be as default};
