import{d as N,q,r,f as L,k as S,o as k,c as T,w as P,a as R,B as V}from"./index.782e29ff.js";import{C as z}from"./ContentWrapper.e3bb8dcd.js";import{p as _,D as B}from"./patchQueryParam.d8aaed4f.js";import{S as M}from"./ServiceSummary.95b13a4a.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.fe3464f0.js";import"./ErrorBlock.e7a95361.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.10b3a197.js";import"./StatusBadge.65e74dea.js";import"./TagList.8b6a3091.js";import"./YamlView.vue_vue_type_script_setup_true_lang.c215dd4f.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.7bd622f2.js";import"./_commonjsHelpers.f037b798.js";const X=N({__name:"ServiceListView",props:{name:{type:String,required:!1,default:null},offset:{type:Number,required:!1,default:0}},setup(A){const m=A,D=[{label:"Service",key:"name"},{label:"Type",key:"serviceType"},{label:"Address",key:"addressPort"},{label:"Status",key:"status"},{label:"DP proxies (online / total)",key:"dpProxiesStatus"}],x=50,E={title:"No Data",message:"There are no service insights present."},p=q(),v=r(!0),d=r(null),h=r(null),b=r(m.offset),l=r(null),w=r(null),i=r({headers:D,data:[]});L(()=>p.params.mesh,function(){p.name==="service-list-view"&&f(0)}),f(m.offset);async function f(e){var o;b.value=e,_("offset",e>0?e:null),v.value=!0,d.value=null;const t=p.params.mesh,s=x;try{const{items:a,next:y}=await S.getAllServiceInsightsFromMesh({mesh:t},{size:s,offset:e});if(h.value=y,Array.isArray(a)&&a.length>0){a.sort((n,c)=>n.name>c.name?1:n.name<c.name?-1:0),i.value.data=a.map(n=>C(n));const u=(o=m.name)!=null?o:a[0].name;await g({name:u,mesh:t})}else i.value.data=[]}catch(a){a instanceof Error?d.value=a:console.error(a)}finally{v.value=!1}}function C(e){var u;const t={name:"service-detail-view",params:{mesh:e.mesh,service:e.name}},s={name:"mesh-detail-view",params:{mesh:e.mesh}};let o="\u2014";if(e.dataplanes){const{online:n=0,total:c=0}=e.dataplanes;o=`${n} / ${c}`}const a=e.addressPort,y=(u=e.serviceType)!=null?u:"internal";return{...e,serviceType:y,nameRoute:t,meshRoute:s,dpProxiesStatus:o,addressPort:a}}async function g({mesh:e,name:t}){l.value=await S.getServiceInsight({mesh:e,name:t}),l.value.serviceType==="external"&&(w.value=await S.getExternalService({mesh:e,name:t})),_("name",t)}return(e,t)=>(k(),T(z,null,{content:P(()=>{var s;return[R(B,{"selected-entity-name":(s=l.value)==null?void 0:s.name,"page-size":x,error:d.value,"is-loading":v.value,"empty-state":E,"table-data":i.value,"table-data-is-empty":i.value.data.length===0,next:h.value,"page-offset":b.value,onTableAction:g,onLoadData:f},null,8,["selected-entity-name","error","is-loading","table-data","table-data-is-empty","next","page-offset"])]}),sidebar:P(()=>[l.value!==null?(k(),T(M,{key:0,service:l.value,"external-service":w.value},null,8,["service","external-service"])):V("",!0)]),_:1}))}});export{X as default};
