import{a as G,A as M}from"./AccordionList-D55xHr5L.js";import{d as z,r as _,c as s,o as e,l as p,e as n,q as j,L as o,M as y,b as l,t as r,w as a,p as g,N as J,_ as T,x as H,m as B,Y as K,a9 as Q,z as Z,k as U,n as W,K as E,F as ee,a4 as te,Z as Y,y as se}from"./index-BkRXKYLT.js";import{T as q}from"./TagList-B2WjM8ZG.js";import{R as ae}from"./RuleMatchers-DwloR93g.js";const ne={class:"policies-list"},le={class:"mesh-gateway-policy-list"},oe={key:0},ie={class:"dataplane-policy-header"},re={key:0,class:"badge-list"},ue={class:"mt-1"},pe=z({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},types:{}},setup(w){const C=w;return(N,t)=>{const x=_("XAction"),X=_("XBadge");return e(),s("div",ne,[p("div",le,[t[11]||(t[11]=p("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),t[12]||(t[12]=n()),w.gatewayDataplane.routePolicies.length>0?(e(),s("ul",oe,[(e(!0),s(o,null,y(w.gatewayDataplane.routePolicies,(m,h)=>(e(),s("li",{key:h},[p("span",null,r(m.type),1),t[0]||(t[0]=n(`:

          `,-1)),l(x,{to:{name:"policy-detail-view",params:{mesh:m.mesh,policyPath:C.types[m.type]?.path??"",policy:m.name}}},{default:a(()=>[n(r(m.name),1)]),_:2},1032,["to"])]))),128))])):j("",!0),t[13]||(t[13]=n()),t[14]||(t[14]=p("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),t[15]||(t[15]=n()),p("div",null,[(e(!0),s(o,null,y(w.gatewayDataplane.listenerEntries,(m,h)=>(e(),s("div",{key:h},[p("div",null,[p("div",null,[t[1]||(t[1]=p("b",null,"Host",-1)),n(": "+r(m.hostName)+":"+r(m.port)+" ("+r(m.protocol)+`)
            `,1)]),t[10]||(t[10]=n()),m.routeEntries.length>0?(e(),s(o,{key:0},[t[8]||(t[8]=p("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),t[9]||(t[9]=n()),l(M,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(o,null,y(m.routeEntries,(u,k)=>(e(),g(G,{key:k},J({"accordion-header":a(()=>[p("div",ie,[p("div",null,[p("div",null,[t[2]||(t[2]=p("b",null,"Route",-1)),t[3]||(t[3]=n(": ",-1)),l(x,{to:{name:"policy-detail-view",params:{mesh:u.route.mesh,policyPath:C.types[u.route.type]?.path??"",policy:u.route.name}}},{default:a(()=>[n(r(u.route.name),1)]),_:2},1032,["to"])]),t[5]||(t[5]=n()),p("div",null,[t[4]||(t[4]=p("b",null,"Service",-1)),n(": "+r(u.service),1)])]),t[6]||(t[6]=n()),u.origins.length>0?(e(),s("div",re,[(e(!0),s(o,null,y(u.origins,(i,f)=>(e(),g(X,{key:`${h}-${f}`},{default:a(()=>[n(r(i.type),1)]),_:2},1024))),128))])):j("",!0)])]),_:2},[u.origins.length>0?{name:"accordion-content",fn:a(()=>[p("ul",ue,[(e(!0),s(o,null,y(u.origins,(i,f)=>(e(),s("li",{key:`${h}-${f}`},[n(r(i.type)+`:

                        `,1),l(x,{to:{name:"policy-detail-view",params:{mesh:i.mesh,policyPath:C.types[i.type]?.path??"",policy:i.name}}},{default:a(()=>[n(r(i.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):j("",!0)])]))),128))])])])}}}),me=T(pe,[["__scopeId","data-v-bc9eeaa7"]]),de={class:"policy-type-heading"},ce={class:"policy-list"},ye={key:0},fe=z({__name:"PolicyTypeEntryList",props:{items:{},types:{}},setup(w){const C=w;function N({headerKey:t}){return{class:`cell-${t}`}}return(t,x)=>{const X=_("XAction"),m=_("XCodeBlock"),h=H("icon-start");return e(),g(M,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(o,null,y(w.items,(u,k)=>(e(),g(G,{key:k},{"accordion-header":a(()=>[Z((e(),s("h3",de,[n(r(u.type)+" ("+r(u.connections.length)+`)
        `,1)])),[[h,{name:u.type,size:"60",default:"policy"}]])]),"accordion-content":a(()=>[p("div",ce,[l(B(Q),{class:"policy-type-table",data:u.connections,headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":N,"hide-pagination":"","is-clickable":""},{sourceTags:a(({row:i})=>[i.sourceTags.length>0?(e(),g(q,{key:0,class:"tag-list","should-truncate":"",tags:i.sourceTags},null,8,["tags"])):(e(),s(o,{key:1},[n(`
                —
              `)],64))]),destinationTags:a(({row:i})=>[i.destinationTags.length>0?(e(),g(q,{key:0,class:"tag-list","should-truncate":"",tags:i.destinationTags},null,8,["tags"])):(e(),s(o,{key:1},[n(`
                —
              `)],64))]),name:a(({row:i})=>[i.name!==null?(e(),s(o,{key:0},[n(r(i.name),1)],64)):(e(),s(o,{key:1},[n(`
                —
              `)],64))]),origins:a(({row:i})=>[i.origins.length>0?(e(),s("ul",ye,[(e(!0),s(o,null,y(i.origins,(f,v)=>(e(),s("li",{key:`${k}-${v}`},[l(X,{to:{name:"policy-detail-view",params:{mesh:f.mesh,policyPath:C.types[f.type]?.path??"",policy:f.name}}},{default:a(()=>[n(r(f.name),1)]),_:2},1032,["to"])]))),128))])):(e(),s(o,{key:1},[n(`
                —
              `)],64))]),config:a(({row:i})=>[i.config?(e(),g(m,{key:0,code:B(K).stringify(i.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(o,{key:1},[n(`
                —
              `)],64))]),_:2},1032,["data"])])]),_:2},1024))),128))]),_:1})}}}),_e=T(fe,[["__scopeId","data-v-57aafe9b"]]),ge={class:"policy-type-heading"},ke={key:0,class:"matcher"},he={key:1},be={key:0},ve=z({__name:"RuleList",props:{rules:{},types:{}},setup(w){const{t:C}=U(),N=w;return(t,x)=>{const X=_("XAction"),m=_("XCodeBlock"),h=H("icon-start");return e(),g(M,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(o,null,y([N.rules.reduce((u,k)=>(typeof u[k.type]>"u"&&(u[k.type]=[]),u[k.type].push(k),u),{})],u=>(e(),s(o,{key:u},[(e(!0),s(o,null,y(u,(k,i)=>(e(),g(G,{key:i},{"accordion-header":a(()=>[Z((e(),s("h3",ge,[n(r(i),1)])),[[h,{name:i,size:"60",default:"policy"}]])]),"accordion-content":a(()=>[(e(!0),s(o,null,y([k.some(f=>f.matchers.length>0)],f=>(e(),s("div",{key:typeof f,class:"policy-list"},[l(E,{class:W(["policy-type-table",{"has-matchers":f}]),items:k,headers:[...f?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:a(({row:v})=>[v.matchers.length>0?(e(),s("span",ke,[l(ae,{items:v.matchers},null,8,["items"])])):(e(),s("i",he,r(B(C)("data-planes.routes.item.matches_everything")),1))]),origins:a(({row:v})=>[v.origins.length>0?(e(),s("ul",be,[(e(!0),s(o,null,y(v.origins,(R,I)=>(e(),s("li",{key:`${i}-${I}`},[l(X,{to:{name:"data-plane-policy-summary-view",params:{mesh:R.mesh,policyPath:N.types[R.type]?.path??"",policy:R.name}}},{default:a(()=>[n(r(R.name),1)]),_:2},1032,["to"])]))),128))])):(e(),s(o,{key:1},[n(r(B(C)("common.collection.none")),1)],64))]),config:a(({row:v})=>[Object.keys(v.raw).length>0?(e(),g(m,{key:0,code:B(K).stringify(v.raw),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(o,{key:1},[n(r(B(C)("common.collection.none")),1)],64))]),_:2},1032,["class","items","headers"])]))),128))]),_:2},1024))),128))],64))),128))]),_:1})}}}),F=T(ve,[["__scopeId","data-v-82734fef"]]),$e={class:"mb-2"},we={class:"mb-2"},Ce={key:0},Pe=z({__name:"DataPlanePoliciesView",props:{data:{}},setup(w){const C=w;return(N,t)=>{const x=_("RouteTitle"),X=_("XCard"),m=_("DataCollection"),h=_("DataLoader"),u=_("XDrawer"),k=_("RouterView"),i=_("DataSource"),f=_("AppView"),v=_("RouteView");return e(),g(v,{name:"data-plane-policies-view",params:{mesh:"",proxy:""}},{default:a(({uri:R,can:I,route:A,t:L})=>[l(x,{render:!1,title:L("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"]),t[11]||(t[11]=n()),l(f,null,{default:a(()=>[l(i,{src:R(B(ee),"/policy-types",{})},{default:a(({data:O,error:S})=>[(e(!0),s(o,null,y([(O?.policyTypes??[]).reduce(($,b)=>Object.assign($,{[b.name]:b}),{})],$=>(e(),s(o,{key:typeof $},[l(h,{src:R(B(te),"/meshes/:mesh/rules/for/:dataplane",{mesh:A.params.mesh,dataplane:A.params.proxy}),data:[O],errors:[S]},{default:a(({data:[b]})=>[l(m,{items:b.rules},{default:a(()=>[(e(),s(o,null,y(["proxy","to"],d=>l(m,{key:d,items:b.rules,predicate:c=>c.ruleType===d,comparator:(c,P)=>c.type.localeCompare(P.type),empty:!1},{default:a(({items:c})=>[l(X,null,{default:a(()=>[p("h3",null,r(L(`data-planes.routes.item.rules.${d}`)),1),t[0]||(t[0]=n()),l(F,{class:"mt-2",rules:c,types:$,"data-testid":`${d}-rule-list`},null,8,["rules","types","data-testid"])]),_:2},1024)]),_:2},1032,["items","predicate","comparator"])),64)),t[5]||(t[5]=n()),l(m,{items:b.rules,predicate:d=>d.ruleType==="from"&&!$[d.type]?.policy.isFromAsRules,comparator:(d,c)=>d.type.localeCompare(c.type),empty:!1},{default:a(({items:d})=>[l(X,null,{default:a(()=>[p("h3",$e,r(L("data-planes.routes.item.rules.from")),1),t[2]||(t[2]=n()),(e(!0),s(o,null,y([Object.groupBy(d,c=>c.inbound.port)],c=>(e(),s(o,{key:c},[(e(!0),s(o,null,y(Object.entries(c).sort(([P],[V])=>Number(V)-Number(P)),([P,V],D)=>(e(),s("div",{key:D},[p("h4",null,r(L("data-planes.routes.item.port",{port:P})),1),t[1]||(t[1]=n()),l(F,{class:"mt-2",rules:V,types:$,"data-testid":`from-rule-list-${D}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","predicate","comparator"]),t[6]||(t[6]=n()),l(m,{items:b.inboundRules,comparator:(d,c)=>d.type.localeCompare(c.type),empty:!1},{default:a(({items:d})=>[l(X,null,{default:a(()=>[p("h3",we,r(L("data-planes.routes.item.rules.inbound")),1),t[4]||(t[4]=n()),(e(!0),s(o,null,y([Object.groupBy(d,c=>c.inbound.port)],c=>(e(),s(o,{key:c},[(e(!0),s(o,null,y(Object.entries(c).sort(([P],[V])=>Number(V)-Number(P)),([P,V],D)=>(e(),s("div",{key:D},[p("h4",null,r(L("data-planes.routes.item.port",{port:P})),1),t[3]||(t[3]=n()),l(F,{class:"mt-2",rules:V,types:$,"data-testid":`inbound-rule-list-${D}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","comparator"])]),_:2},1032,["items"])]),_:2},1032,["src","data","errors"]),t[9]||(t[9]=n()),I("use zones")?j("",!0):(e(),s("div",Ce,[C.data.dataplaneType==="builtin"?(e(),g(h,{key:0,src:R(B(Y),"/meshes/:mesh/dataplanes/:name/gateway-dataplane-policies",{mesh:A.params.mesh,name:A.params.proxy}),data:[O],errors:[S]},{default:a(({data:[b]})=>[l(m,{items:b.routePolicies,empty:!1},{default:a(()=>[p("h3",null,r(L("data-planes.routes.item.legacy_policies")),1),t[7]||(t[7]=n()),l(X,{class:"mt-4"},{default:a(()=>[l(me,{types:$,"gateway-dataplane":b,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["types","gateway-dataplane"])]),_:2},1024)]),_:2},1032,["items"])]),_:2},1032,["src","data","errors"])):(e(),g(h,{key:1,src:R(B(Y),"/meshes/:mesh/dataplanes/:name/sidecar-dataplane-policies",{mesh:A.params.mesh,name:A.params.proxy}),data:[O],errors:[S]},{default:a(({data:[b]})=>[l(m,{empty:!1,items:b.policyTypeEntries,predicate:d=>$[d.type]?.policy.isTargetRef===!1},{default:a(({items:d})=>[p("h3",null,r(L("data-planes.routes.item.legacy_policies")),1),t[8]||(t[8]=n()),l(X,{class:"mt-4"},{default:a(()=>[l(_e,{items:d,types:$,"data-testid":"sidecar-dataplane-policies"},null,8,["items","types"])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1032,["src","data","errors"]))]))],64))),128)),t[10]||(t[10]=n()),l(k,null,{default:a(({Component:$})=>[A.child()&&O?(e(),g(u,{key:0,onClose:b=>A.replace({name:"data-plane-policies-view",params:{mesh:A.params.mesh,proxy:A.params.proxy}})},{default:a(()=>[(e(),g(se($),{"policy-types":O.policyTypes},null,8,["policy-types"]))]),_:2},1032,["onClose"])):j("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1024)]),_:1})}}});export{Pe as default};
