import{d as B,o as p,i as L,w as u,a as g,u as l,m as te,b as c,O as j,bP as a,g as $,h as z,bQ as le,c9 as A,cd as se,c as D,e as o,cC as ne,cI as oe,F as G,bX as J,bV as C,bO as re,cu as ie,f as ue,c5 as Q,ca as ce,cv as pe,ck as me,j as x,cJ as de,ci as W,bY as ye,bZ as ve,k as he}from"./index.2d238a59.js";import{p as Z,D as fe}from"./DataOverview.b81dc292.js";import{F as _e}from"./FrameSkeleton.49890b13.js";import{_ as K}from"./LabelList.vue_vue_type_style_index_0_lang.066e77d8.js";import{T as ge}from"./TabsWidget.bc5189ed.js";import{_ as be}from"./YamlView.vue_vue_type_script_setup_true_lang.196883ed.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.a51bf735.js";import"./ErrorBlock.6d694e33.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.ccaabdfd.js";import"./StatusBadge.ce20a7cd.js";import"./TagList.ebca8e2c.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.f5cf526a.js";import"./_commonjsHelpers.f037b798.js";const ke=B({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(d){const r=d;return(T,E)=>(p(),L(l(j),{class:"docs-link",appearance:"outline",target:"_blank",to:r.href},{default:u(()=>[g(l(te),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),c(`

    Documentation
  `)]),_:1},8,["to"]))}}),we=o("h4",null,"Dataplanes",-1),Pe=B({__name:"PolicyConnections",props:{mesh:{type:String,required:!0},policyType:{type:String,required:!0},policyName:{type:String,required:!0}},setup(d){const r=d,T=a(!1),E=a(!0),y=a(!1),P=a([]),v=a(""),b=$(()=>{const s=v.value.toLowerCase();return P.value.filter(({dataplane:n})=>n.name.toLowerCase().includes(s))});z(()=>r.policyName,function(){h()}),le(function(){h()});async function h(){y.value=!1,E.value=!0;try{const{items:s,total:n}=await A.getPolicyConnections({mesh:r.mesh,policyType:r.policyType,policyName:r.policyName});T.value=n>0,P.value=s!=null?s:[]}catch{y.value=!0}finally{E.value=!1}}return(s,n)=>{const k=se("router-link");return p(),D("div",null,[g(K,{"has-error":y.value,"is-loading":E.value,"is-empty":!T.value},{default:u(()=>[o("ul",null,[o("li",null,[we,c(),ne(o("input",{id:"dataplane-search","onUpdate:modelValue":n[0]||(n[0]=m=>v.value=m),type:"text",class:"k-input mb-4",placeholder:"Filter by name",required:"","data-testid":"dataplane-search-input"},null,512),[[oe,v.value]]),c(),(p(!0),D(G,null,J(l(b),(m,w)=>(p(),D("p",{key:w,class:"my-1","data-testid":"dataplane-name"},[g(k,{to:{name:"data-plane-detail-view",params:{mesh:m.dataplane.mesh,dataPlane:m.dataplane.name}}},{default:u(()=>[c(C(m.dataplane.name),1)]),_:2},1032,["to"])]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])])}}}),De=d=>(ye("data-v-128e83d6"),d=d(),ve(),d),Ee={key:0,class:"mb-4"},Ne=De(()=>o("p",null,[o("strong",null,"Warning"),c(` This policy is experimental. If you encountered any problem please open an
            `),o("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),Se={class:"entity-heading","data-testid":"policy-single-entity"},xe={"data-testid":"policy-overview-tab"},Ce={class:"config-wrapper"},Te=B({__name:"PolicyView",props:{selectedPolicyName:{type:String,required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(d){const r=d,T=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],E=re(),y=ie(),P=ue(),v=a(!0),b=a(!1),h=a(null),s=a(!0),n=a(!1),k=a(!1),m=a(!1),w=a({}),N=a(null),F=a(null),R=a(r.offset),O=a({headers:[{label:"Actions",key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Type",key:"type"}],data:[]}),f=$(()=>P.state.policiesByPath[r.policyPath]),X=$(()=>P.state.policies.map(e=>{var t;return{length:(t=P.state.sidebar.insights.mesh.policies[e.name])!=null?t:0,label:e.pluralDisplayName,value:e.path,selected:e.path===r.policyPath}})),Y=$(()=>`https://kuma.io/docs/${P.getters["config/getKumaDocsVersion"]}/policies/${f.value.path}/`);z(()=>y.params.mesh,function(){y.name===r.policyPath&&(v.value=!0,b.value=!1,s.value=!0,n.value=!1,k.value=!1,m.value=!1,h.value=null,V(0))}),z(()=>y.query.ns,function(){v.value=!0,b.value=!1,s.value=!0,n.value=!1,k.value=!1,m.value=!1,h.value=null,V(0)}),V(r.offset);async function V(e){var U,H;R.value=e,Z("offset",e>0?e:null),v.value=!0,h.value=null;const t=y.query.ns||null,i=y.params.mesh,S=f.value.path;try{let _;if(i!==null&&t!==null)_=[await A.getSinglePolicyEntity({mesh:i,path:S,name:t})],F.value=null;else{const q={size:Q,offset:e},I=await A.getAllPolicyEntitiesFromMesh({mesh:i,path:S},q);_=(U=I.items)!=null?U:[],F.value=I.next}if(_.length>0){O.value.data=_.map(I=>ae(I)),m.value=!1,b.value=!1;const q=(H=r.selectedPolicyName)!=null?H:_[0].name;await M({name:q,mesh:i,path:S})}else O.value.data=[],m.value=!0,b.value=!0,n.value=!0}catch(_){_ instanceof Error?h.value=_:console.error(_),b.value=!0}finally{v.value=!1,s.value=!1}}function ee(e){E.push({name:"policy",params:{...y.params,policyPath:e.value}})}function ae(e){if(!e.mesh)return e;const t=e,i={name:"mesh-detail-view",params:{mesh:e.mesh}};return t.meshRoute=i,t}async function M(e){k.value=!1,s.value=!0,n.value=!1;try{const t=await A.getSinglePolicyEntity({mesh:e.mesh,path:f.value.path,name:e.name});if(t){const i=["type","name","mesh"];w.value=ce(t,i),Z("policy",w.value.name),N.value=pe(t)}else w.value={},n.value=!0}catch(t){k.value=!0,console.error(t)}finally{s.value=!1}}return(e,t)=>l(f)?(p(),D("div",{key:0,class:W(["relative",l(f).path])},[l(f).isExperimental?(p(),D("div",Ee,[g(l(me),{appearance:"warning"},{alertMessage:u(()=>[Ne]),_:1})])):x("",!0),c(),g(_e,null,{default:u(()=>[g(fe,{"selected-entity-name":w.value.name,"page-size":l(Q),error:h.value,"is-loading":v.value,"empty-state":{title:"No Data",message:`There are no ${l(f).pluralDisplayName} present.`},"table-data":O.value,"table-data-is-empty":m.value,next:F.value,"page-offset":R.value,onTableAction:M,onLoadData:V},{additionalControls:u(()=>[g(l(de),{label:"Policies",items:l(X),"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:ee},{"item-template":u(({item:i})=>[o("span",{class:W({"policy-type-empty":i.length===0})},C(i.label),3)]),_:1},8,["items"]),c(),g(ke,{href:l(Y),"data-testid":"policy-documentation-link"},null,8,["href"]),c(),e.$route.query.ns?(p(),L(l(j),{key:0,class:"back-button",appearance:"primary",icon:"arrowLeft",to:{name:"policy",params:{policyPath:d.policyPath}}},{default:u(()=>[c(`
            View all
          `)]),_:1},8,["to"])):x("",!0)]),default:u(()=>[c(`
        >
        `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"]),c(),b.value===!1?(p(),L(ge,{key:0,"has-error":h.value!==null,error:h.value,"is-loading":v.value,tabs:T,"initial-tab-override":"overview"},{tabHeader:u(()=>[o("h1",Se,C(l(f).singularDisplayName)+": "+C(w.value.name),1)]),overview:u(()=>[g(K,{"has-error":k.value,"is-loading":s.value,"is-empty":n.value},{default:u(()=>[o("div",xe,[o("ul",null,[(p(!0),D(G,null,J(w.value,(i,S)=>(p(),D("li",{key:S},[o("h4",null,C(S),1),c(),o("p",null,C(i),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"]),c(),o("div",Ce,[N.value!==null?(p(),L(be,{key:0,id:"code-block-policy","has-error":k.value,"is-loading":s.value,"is-empty":n.value,content:N.value,"is-searchable":""},null,8,["has-error","is-loading","is-empty","content"])):x("",!0)])]),"affected-dpps":u(()=>[N.value!==null?(p(),L(Pe,{key:0,mesh:N.value.mesh,"policy-name":N.value.name,"policy-type":l(f).path},null,8,["mesh","policy-name","policy-type"])):x("",!0)]),_:1},8,["has-error","error","is-loading"])):x("",!0)]),_:1})],2)):x("",!0)}});const Qe=he(Te,[["__scopeId","data-v-128e83d6"]]);export{Qe as default};
