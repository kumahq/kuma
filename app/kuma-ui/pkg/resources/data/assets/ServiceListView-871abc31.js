import{u as E}from"./vue-router-67937a96.js";import{k as y}from"./kumaApi-08f7fc23.js";import{Q as g}from"./QueryParameter-70743f73.js";import{C}from"./ContentWrapper-a5f2521e.js";import{D as L}from"./DataOverview-6ea76f5e.js";import{S as R}from"./ServiceSummary-ea621225.js";import{d as V,r,s as q,a as k,w as T,o as P,e as z,b as M}from"./runtime-dom.esm-bundler-fd3ecc5a.js";import"./production-8efaeab1.js";import"./constants-31fdaf55.js";import"./vuex.esm-bundler-4e6e06ec.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./kongponents.es-7ead79da.js";import"./datadogLogEvents-302eea7b.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-7c04ed58.js";import"./ErrorBlock-04954e92.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-ef489e58.js";import"./StatusBadge-760d0ebe.js";import"./TagList-d36d0a47.js";import"./YamlView.vue_vue_type_script_setup_true_lang-545eb1cb.js";import"./store-ec4aec64.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-2bd08d1e.js";import"./_commonjsHelpers-edff4021.js";import"./toYaml-4e00099e.js";const le=V({__name:"ServiceListView",props:{selectedServiceName:{type:String,required:!1,default:null},offset:{type:Number,required:!1,default:0}},setup(_){const m=_,A=[{label:"Service",key:"name"},{label:"Type",key:"serviceType"},{label:"Address",key:"addressPort"},{label:"Status",key:"status"},{label:"DP proxies (online / total)",key:"dpProxiesStatus"}],S=50,D={title:"No Data",message:"There are no service insights present."},c=E(),u=r(!0),p=r(null),x=r(null),b=r(m.offset),n=r(null),h=r(null),l=r({headers:A,data:[]});q(()=>c.params.mesh,function(){c.name==="service-list-view"&&v(0)}),v(m.offset);async function v(e){b.value=e,g.set("offset",e>0?e:null),u.value=!0,p.value=null;const t=c.params.mesh,s=S;try{const{items:a,next:d}=await y.getAllServiceInsightsFromMesh({mesh:t},{size:s,offset:e});if(x.value=d,Array.isArray(a)&&a.length>0){a.sort((o,i)=>o.name>i.name?1:o.name<i.name?-1:0),l.value.data=a.map(o=>N(o));const f=m.selectedServiceName??a[0].name;await w({name:f,mesh:t})}else l.value.data=[]}catch(a){a instanceof Error?p.value=a:console.error(a)}finally{u.value=!1}}function N(e){const t={name:"service-detail-view",params:{mesh:e.mesh,service:e.name}},s={name:"mesh-detail-view",params:{mesh:e.mesh}};let a="â€”";if(e.dataplanes){const{online:o=0,total:i=0}=e.dataplanes;a=`${o} / ${i}`}const d=e.addressPort,f=e.serviceType??"internal";return{...e,serviceType:f,nameRoute:t,meshRoute:s,dpProxiesStatus:a,addressPort:d}}async function w({mesh:e,name:t}){n.value=await y.getServiceInsight({mesh:e,name:t}),n.value.serviceType==="external"&&(h.value=await y.getExternalService({mesh:e,name:t})),g.set("service",t)}return(e,t)=>(P(),k(C,null,{content:T(()=>{var s;return[z(L,{"selected-entity-name":(s=n.value)==null?void 0:s.name,"page-size":S,error:p.value,"is-loading":u.value,"empty-state":D,"table-data":l.value,"table-data-is-empty":l.value.data.length===0,next:x.value,"page-offset":b.value,onTableAction:w,onLoadData:v},null,8,["selected-entity-name","error","is-loading","table-data","table-data-is-empty","next","page-offset"])]}),sidebar:T(()=>[n.value!==null?(P(),k(R,{key:0,service:n.value,"external-service":h.value},null,8,["service","external-service"])):M("",!0)]),_:1}))}});export{le as default};
