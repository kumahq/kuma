import{d as $,l as O,z,R as B,a as k,o as l,b,w as a,e,a5 as L,f as t,p as d,a6 as p,t as s,q as D,a7 as S,K as F,v as x,c as r,F as _,a3 as T,D as v,_ as H}from"./index-3dc6e8c8.js";import{g as U}from"./data-fbfa50a4.js";import{S as W}from"./StatusBadge-cab5c818.js";import{_ as N}from"./TagList.vue_vue_type_script_setup_true_lang-1782b16c.js";import{_ as Z}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-5a77a297.js";import{a as j,c as q,C as G,I as X,d as J}from"./dataplane-dcd0858b.js";import"./AccordionList-d7e11137.js";const Q={"data-testid":"dataplane-warnings"},Y=["data-testid","innerHTML"],tt={class:"stack","data-testid":"dataplane-details"},at={class:"columns"},et={class:"status-with-reason"},st={key:0,"data-testid":"dataplane-inbounds"},nt={class:"inbound-list"},it={class:"mt-4 columns"},lt={"data-testid":"dataplane-mtls"},ot={class:"columns"},dt=["innerHTML"],rt={key:0,"data-testid":"dataplane-subscriptions"},pt=$({__name:"DataPlaneDetailView",props:{data:{}},setup(M){const{formatIsoDate:E}=O(),P=z(),o=M,A=B(()=>j(o.data.dataplane,o.data.dataplaneInsight)),K=B(()=>{var g;return U(((g=o.data.dataplaneInsight)==null?void 0:g.subscriptions)??[])}),R=B(()=>{var w,C;const g=((w=o.data.dataplaneInsight)==null?void 0:w.subscriptions)??[];if(g.length===0)return[];const f=g[g.length-1];if(!("version"in f)||!f.version)return[];const m=f.version,u=[];if(m.kumaDp&&m.envoy){const h=q(m);h.kind!==G&&h.kind!==X&&u.push(h)}const y=(C=o.data.dataplaneInsight)==null?void 0:C.mTLS;return y&&Date.now()>new Date(y==null?void 0:y.certificateExpirationTime).getTime()&&u.push({kind:"CERT_EXPIRED",payload:{}}),P("use zones")&&J(o.data.dataplane).find(c=>c.label==="kuma.io/zone")&&typeof m.kumaDp.kumaCpCompatible=="boolean"&&!m.kumaDp.kumaCpCompatible&&u.push({kind:"INCOMPATIBLE_ZONE_CP_AND_KUMA_DP_VERSIONS",payload:{kumaDp:m.kumaDp.version}}),u});return(g,f)=>{const m=k("KTooltip"),u=k("KCard"),y=k("KBadge"),w=k("KAlert"),C=k("AppView"),h=k("RouteView");return l(),b(h,{name:"data-plane-detail-view"},{default:a(({t:n})=>[e(C,null,L({default:a(()=>{var c,V;return[t(),d("div",tt,[e(u,null,{body:a(()=>[d("div",at,[e(p,null,{title:a(()=>[t(s(n("http.api.property.status")),1)]),body:a(()=>[d("div",et,[e(W,{status:A.value.status},null,8,["status"]),t(),A.value.reason.length>0?(l(),b(m,{key:0,label:A.value.reason.join(", "),class:"reason-tooltip"},{default:a(()=>[e(D(S),{size:D(F),"hide-title":""},null,8,["size"])]),_:1},8,["label"])):x("",!0)])]),_:2},1024),t(),e(p,null,{title:a(()=>[t(s(n("data-planes.routes.item.last_updated")),1)]),body:a(()=>[K.value?(l(),r(_,{key:0},[t(s(K.value),1)],64)):(l(),r(_,{key:1},[t(s(n("common.detail.none")),1)],64))]),_:2},1024),t(),o.data.dataplane.networking.gateway?(l(),r(_,{key:0},[e(p,null,{title:a(()=>[t(s(n("http.api.property.tags")),1)]),body:a(()=>[e(N,{tags:o.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024),t(),e(p,null,{title:a(()=>[t(s(n("http.api.property.address")),1)]),body:a(()=>[e(T,{text:`${o.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024)],64)):x("",!0)])]),_:2},1024),t(),o.data.dataplane.networking.inbound&&o.data.dataplane.networking.inbound.length>0?(l(),r("div",st,[d("h2",null,s(n("data-planes.routes.item.inbounds")),1),t(),e(u,{class:"mt-4"},{body:a(()=>[d("div",nt,[(l(!0),r(_,null,v(o.data.dataplane.networking.inbound,(i,I)=>(l(),r("div",{key:I,class:"inbound"},[d("h4",null,[e(T,{text:i.tags["kuma.io/service"]},{default:a(()=>[t(s(n("data-planes.routes.item.inbound_name",{service:i.tags["kuma.io/service"]})),1)]),_:2},1032,["text"])]),t(),d("div",it,[e(p,null,{title:a(()=>[t(s(n("http.api.property.status")),1)]),body:a(()=>[!i.health||i.health.ready?(l(),b(y,{key:0,appearance:"success"},{default:a(()=>[t(s(n("data-planes.routes.item.health.ready")),1)]),_:2},1024)):(l(),b(y,{key:1,appearance:"danger"},{default:a(()=>[t(s(n("data-planes.routes.item.health.not_ready")),1)]),_:2},1024))]),_:2},1024),t(),e(p,null,{title:a(()=>[t(s(n("http.api.property.tags")),1)]),body:a(()=>[e(N,{tags:i.tags},null,8,["tags"])]),_:2},1024),t(),e(p,null,{title:a(()=>[t(s(n("http.api.property.address")),1)]),body:a(()=>[e(T,{text:`${i.address??o.data.dataplane.networking.advertisedAddress??o.data.dataplane.networking.address}:${i.port}`},null,8,["text"])]),_:2},1024),t(),e(p,null,{title:a(()=>[t(s(n("http.api.property.serviceAddress")),1)]),body:a(()=>[e(T,{text:`${i.serviceAddress}:${i.servicePort}`},null,8,["text"])]),_:2},1024)])]))),128))])]),_:2},1024)])):x("",!0),t(),d("div",lt,[d("h2",null,s(n("data-planes.routes.item.mtls.title")),1),t(),(c=o.data.dataplaneInsight)!=null&&c.mTLS?(l(!0),r(_,{key:0},v([o.data.dataplaneInsight.mTLS],i=>(l(),b(u,{key:i,class:"mt-4"},{body:a(()=>[d("div",ot,[e(p,null,{title:a(()=>[t(s(n("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:a(()=>[t(s(D(E)(i.certificateExpirationTime)),1)]),_:2},1024),t(),e(p,null,{title:a(()=>[t(s(n("data-planes.routes.item.mtls.generation_time.title")),1)]),body:a(()=>[t(s(D(E)(i.lastCertificateRegeneration)),1)]),_:2},1024),t(),e(p,null,{title:a(()=>[t(s(n("data-planes.routes.item.mtls.regenerations.title")),1)]),body:a(()=>[t(s(n("common.formats.integer",{value:i.certificateRegenerations})),1)]),_:2},1024),t(),e(p,null,{title:a(()=>[t(s(n("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:a(()=>[t(s(i.issuedBackend),1)]),_:2},1024),t(),e(p,null,{title:a(()=>[t(s(n("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:a(()=>[d("ul",null,[(l(!0),r(_,null,v(i.supportedBackends,I=>(l(),r("li",{key:I},s(I),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(l(),b(w,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:a(()=>[d("div",{innerHTML:n("data-planes.routes.item.mtls.disabled")},null,8,dt)]),_:2},1024))]),t(),(l(!0),r(_,null,v([((V=o.data.dataplaneInsight)==null?void 0:V.subscriptions)??[]],i=>(l(),r(_,{key:i},[i.length>0?(l(),r("div",rt,[d("h2",null,s(n("data-planes.routes.item.subscriptions.title")),1),t(),e(u,{class:"mt-4"},{body:a(()=>[e(Z,{subscriptions:i},null,8,["subscriptions"])]),_:2},1024)])):x("",!0)],64))),128))])]}),_:2},[R.value.length>0?{name:"notifications",fn:a(()=>[d("ul",Q,[(l(!0),r(_,null,v(R.value,c=>(l(),r("li",{key:c.kind,"data-testid":`warning-${c.kind}`,innerHTML:n(`common.warnings.${c.kind}`,c.payload)},null,8,Y))),128)),t()])]),key:"0"}:void 0]),1024)]),_:1})}}});const kt=H(pt,[["__scopeId","data-v-347b38bd"]]);export{kt as default};
