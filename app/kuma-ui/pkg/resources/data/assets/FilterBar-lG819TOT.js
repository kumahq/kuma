var se=Object.defineProperty;var ie=(n,o,t)=>o in n?se(n,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[o]=t;var N=(n,o,t)=>(ie(n,typeof o!="symbol"?o+"":o,t),t);import{K as w}from"./index-FZCiQto1.js";import{d as K,l as oe,a as B,o as d,b as A,a1 as le,w as m,r as O,t as f,f as u,e as S,q as c,F as T,c as g,E as R,p as I,m as b,R as re,_ as Q,ah as ue,B as C,I as E,a8 as $,as as ce,at as de,au as fe,n as j,av as pe,aw as me,ax as ge,ay as he,x as ve,y as ye}from"./index-SPSPfmv7.js";import{A as be}from"./AppCollection-6Mo4UviY.js";import{S as ke}from"./StatusBadge-w9-Vv1zp.js";import{T as _e}from"./TextWithCopyButton-lWuYw9Vs.js";import{_ as Se}from"./WarningIcon.vue_vue_type_script_setup_true_lang--WLxH0yR.js";const xe={key:0},Ce={key:1},Te=K({__name:"DataPlaneList",props:{total:{default:0},pageNumber:{},pageSize:{},items:{},error:{},isSelectedRow:{type:[Function,null],default:null},summaryRouteName:{},isGlobalMode:{type:Boolean}},emits:["change"],setup(n,{emit:o}){const{t,formatIsoDate:x}=oe(),l=n,s=o;return(i,k)=>{const p=B("RouterLink"),v=B("KTruncate"),_=B("KTooltip");return d(),A(be,{class:"data-plane-collection","empty-state-message":c(t)("common.emptyState.message",{type:"Data Plane Proxies"}),"empty-state-cta-to":c(t)("data-planes.href.docs.data_plane_proxy"),"empty-state-cta-text":c(t)("common.documentation"),headers:[{label:"Name",key:"name"},{label:"Type",key:"type"},{label:"Services",key:"services"},...l.isGlobalMode?[{label:"Zone",key:"zone"}]:[],{label:"Certificate Info",key:"certificate"},{label:"Status",key:"status"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Details",key:"details",hideLabel:!0}],"page-number":l.pageNumber,"page-size":l.pageSize,total:l.total,items:l.items,error:l.error,"is-selected-row":l.isSelectedRow,onChange:k[0]||(k[0]=e=>s("change",e))},le({name:m(({row:e})=>[S(p,{class:"name-link",title:e.name,to:{name:l.summaryRouteName,params:{mesh:e.mesh,dataPlane:e.name},query:{page:l.pageNumber,size:l.pageSize}}},{default:m(()=>[u(f(e.name),1)]),_:2},1032,["title","to"])]),type:m(({row:e})=>[u(f(c(t)(`data-planes.type.${e.dataplaneType}`)),1)]),services:m(({row:e})=>[e.services.length>0?(d(),A(v,{key:0,width:"auto"},{default:m(()=>[(d(!0),g(T,null,R(e.services,(y,z)=>(d(),g("div",{key:z},[S(_e,{text:y},{default:m(()=>[S(p,{to:{name:"service-detail-view",params:{service:y}}},{default:m(()=>[u(f(y),1)]),_:2},1032,["to"])]),_:2},1032,["text"])]))),128))]),_:2},1024)):(d(),g(T,{key:1},[u(f(c(t)("common.collection.none")),1)],64))]),zone:m(({row:e})=>[e.zone?(d(),A(p,{key:0,to:{name:"zone-cp-detail-view",params:{zone:e.zone}}},{default:m(()=>[u(f(e.zone),1)]),_:2},1032,["to"])):(d(),g(T,{key:1},[u(f(c(t)("common.collection.none")),1)],64))]),certificate:m(({row:e})=>{var y;return[(y=e.dataplaneInsight.mTLS)!=null&&y.certificateExpirationTime?(d(),g(T,{key:0},[u(f(c(x)(e.dataplaneInsight.mTLS.certificateExpirationTime)),1)],64)):(d(),g(T,{key:1},[u(f(c(t)("data-planes.components.data-plane-list.certificate.none")),1)],64))]}),status:m(({row:e})=>[S(ke,{status:e.status},null,8,["status"])]),warnings:m(({row:e})=>[e.isCertExpired||e.warnings.length>0?(d(),A(_,{key:0},{content:m(()=>[b("ul",null,[e.warnings.length>0?(d(),g("li",xe,f(c(t)("data-planes.components.data-plane-list.version_mismatch")),1)):I("",!0),u(),e.isCertExpired?(d(),g("li",Ce,f(c(t)("data-planes.components.data-plane-list.cert_expired")),1)):I("",!0)])]),default:m(()=>[u(),S(Se,{class:"mr-1",size:c(w),"hide-title":""},null,8,["size"])]),_:2},1024)):(d(),g(T,{key:1},[u(f(c(t)("common.collection.none")),1)],64))]),details:m(({row:e})=>[S(p,{class:"details-link","data-testid":"details-link",to:{name:"data-plane-detail-view",params:{dataPlane:e.name}}},{default:m(()=>[u(f(c(t)("common.collection.details_link"))+" ",1),S(c(re),{display:"inline-block",decorative:"",size:c(w)},null,8,["size"])]),_:2},1032,["to"])]),_:2},[i.$slots.toolbar?{name:"toolbar",fn:m(()=>[O(i.$slots,"toolbar",{},void 0,!0)]),key:"0"}:void 0]),1032,["empty-state-message","empty-state-cta-to","empty-state-cta-text","headers","page-number","page-size","total","items","error","is-selected-row"])}}}),Ye=Q(Te,[["__scopeId","data-v-4ee5ee9a"]]);function we(n,o,t){return Math.max(o,Math.min(n,t))}const Ie=["ControlLeft","ControlRight","ShiftLeft","ShiftRight","AltLeft"];class ze{constructor(o,t){N(this,"commands");N(this,"keyMap");N(this,"boundTriggerShortcuts");this.commands=t,this.keyMap=Object.fromEntries(Object.entries(o).map(([x,l])=>[x.toLowerCase(),l])),this.boundTriggerShortcuts=this.triggerShortcuts.bind(this)}registerListener(){document.addEventListener("keydown",this.boundTriggerShortcuts)}unRegisterListener(){document.removeEventListener("keydown",this.boundTriggerShortcuts)}triggerShortcuts(o){Le(o,this.keyMap,this.commands)}}function Le(n,o,t){const x=Fe(n.code),l=[n.ctrlKey?"ctrl":"",n.shiftKey?"shift":"",n.altKey?"alt":"",x].filter(k=>k!=="").join("+"),s=o[l];if(!s)return;const i=t[s];i.isAllowedContext&&!i.isAllowedContext(n)||(i.shouldPreventDefaultAction&&n.preventDefault(),!(i.isDisabled&&i.isDisabled())&&i.trigger(n))}function Fe(n){return Ie.includes(n)?"":n.replace(/^Key/,"").toLowerCase()}function Ne(n,o){const t=" "+n,x=t.matchAll(/ ([-\s\w]+):\s*/g),l=[];for(const s of Array.from(x)){if(s.index===void 0)continue;const i=Ae(s[1]);if(o.length>0&&!o.includes(i))throw new Error(`Unknown field “${i}”. Known fields: ${o.join(", ")}`);const k=s.index+s[0].length,p=t.substring(k);let v;if(/^\s*["']/.test(p)){const e=p.match(/['"](.*?)['"]/);if(e!==null)v=e[1];else throw new Error(`Quote mismatch for field “${i}”.`)}else{const e=p.indexOf(" "),y=e===-1?p.length:e;v=p.substring(0,y)}v!==""&&l.push([i,v])}return l}function Ae(n){return n.trim().replace(/\s+/g,"-").replace(/-[a-z]/g,(o,t)=>t===0?o:o.substring(1).toUpperCase())}const V=n=>(ve("data-v-d51e0350"),n=n(),ye(),n),Ee=V(()=>b("span",{class:"visually-hidden"},"Focus filter",-1)),Pe={class:"k-filter-icon"},Be=["for"],Me=["id","placeholder"],qe={key:0,class:"k-suggestion-box","data-testid":"k-filter-bar-suggestion-box"},De={class:"k-suggestion-list"},$e={key:0,class:"k-filter-bar-error"},je={key:0},Ke=["title","data-filter-field"],Oe={class:"visually-hidden"},Re=V(()=>b("span",{class:"visually-hidden"},"Clear query",-1)),Qe=K({__name:"FilterBar",props:{id:{type:String,required:!1,default:()=>ue("k-filter-bar")},fields:{type:Object,required:!0},placeholder:{type:String,required:!1,default:null},query:{type:String,required:!1,default:""}},emits:["fields-change"],setup(n,{emit:o}){const t=n,x=o,l=C(null),s=C(null),i=C(t.query),k=C([]),p=C(null),v=C(!1),_=C(-1),e=E(()=>Object.keys(t.fields)),y=E(()=>Object.entries(t.fields).slice(0,5).map(([a,r])=>({fieldName:a,...r}))),z=E(()=>e.value.length>0?`Filter by ${e.value.join(", ")}`:"Filter"),U=E(()=>t.placeholder??z.value);$(()=>k.value,function(a,r){ne(a,r)||(p.value=null,x("fields-change",{fields:a,query:i.value}))}),$(()=>i.value,function(){i.value===""&&(p.value=null),v.value=!0});const H={Enter:"submitQuery",Escape:"closeSuggestionBox",ArrowDown:"jumpToNextSuggestion",ArrowUp:"jumpToPreviousSuggestion"},W={submitQuery:{trigger:M,isAllowedContext(a){return s.value!==null&&a.composedPath().includes(s.value)},shouldPreventDefaultAction:!0},jumpToNextSuggestion:{trigger:Z,isAllowedContext(a){return s.value!==null&&a.composedPath().includes(s.value)},shouldPreventDefaultAction:!0},jumpToPreviousSuggestion:{trigger:Y,isAllowedContext(a){return s.value!==null&&a.composedPath().includes(s.value)},shouldPreventDefaultAction:!0},closeSuggestionBox:{trigger:P,isAllowedContext(a){return l.value!==null&&a.composedPath().includes(l.value)}}};function G(){const a=new ze(H,W);ge(function(){a.registerListener()}),he(function(){a.unRegisterListener()}),L(i.value)}G();function J(a){const r=a.target;L(r.value)}function M(){if(s.value instanceof HTMLInputElement)if(_.value===-1)L(s.value.value),v.value=!1;else{const a=y.value[_.value].fieldName;a&&D(s.value,a)}}function Z(){q(1)}function Y(){q(-1)}function q(a){_.value=we(_.value+a,-1,y.value.length-1)}function X(){s.value instanceof HTMLInputElement&&s.value.focus()}function ee(a){const h=a.currentTarget.getAttribute("data-filter-field");h&&s.value instanceof HTMLInputElement&&D(s.value,h)}function D(a,r){const h=i.value===""||i.value.endsWith(" ")?"":" ";i.value+=h+r+":",a.focus(),_.value=-1}function te(){i.value="",s.value instanceof HTMLInputElement&&(s.value.value="",s.value.focus(),L(""))}function ae(a){a.relatedTarget===null&&P(),l.value instanceof HTMLElement&&a.relatedTarget instanceof Node&&!l.value.contains(a.relatedTarget)&&P()}function P(){v.value=!1}function L(a){p.value=null;try{const r=Ne(a,e.value);r.sort((h,F)=>h[0].localeCompare(F[0])),k.value=r}catch(r){if(r instanceof Error)p.value=r,v.value=!0;else throw r}}function ne(a,r){return JSON.stringify(a)===JSON.stringify(r)}return(a,r)=>(d(),g("div",{ref_key:"filterBar",ref:l,class:"k-filter-bar","data-testid":"k-filter-bar"},[b("button",{class:"k-focus-filter-input-button",title:"Focus filter",type:"button","data-testid":"k-filter-bar-focus-filter-input-button",onClick:X},[Ee,u(),b("span",Pe,[S(c(ce),{decorative:"","data-testid":"k-filter-bar-filter-icon","hide-title":"",size:c(w)},null,8,["size"])])]),u(),b("label",{for:`${t.id}-filter-bar-input`,class:"visually-hidden"},[O(a.$slots,"default",{},()=>[u(f(z.value),1)],!0)],8,Be),u(),de(b("input",{id:`${t.id}-filter-bar-input`,ref_key:"filterInput",ref:s,"onUpdate:modelValue":r[0]||(r[0]=h=>i.value=h),class:"k-filter-bar-input",type:"text",placeholder:U.value,"data-testid":"k-filter-bar-filter-input",onFocus:r[1]||(r[1]=h=>v.value=!0),onBlur:ae,onChange:J},null,40,Me),[[fe,i.value]]),u(),v.value?(d(),g("div",qe,[b("div",De,[p.value!==null?(d(),g("p",$e,f(p.value.message),1)):(d(),g("button",{key:1,class:j(["k-submit-query-button",{"k-submit-query-button-is-selected":_.value===-1}]),title:"Submit query",type:"button","data-testid":"k-filter-bar-submit-query-button",onClick:M},`
          Submit `+f(i.value),3)),u(),(d(!0),g(T,null,R(y.value,(h,F)=>(d(),g("div",{key:`${t.id}-${F}`,class:j(["k-suggestion-list-item",{"k-suggestion-list-item-is-selected":_.value===F}])},[b("b",null,f(h.fieldName),1),h.description!==""?(d(),g("span",je,": "+f(h.description),1)):I("",!0),u(),b("button",{class:"k-apply-suggestion-button",title:`Add ${h.fieldName}:`,type:"button","data-filter-field":h.fieldName,"data-testid":"k-filter-bar-apply-suggestion-button",onClick:ee},[b("span",Oe,"Add "+f(h.fieldName)+":",1),u(),S(c(pe),{decorative:"","hide-title":"",size:c(w)},null,8,["size"])],8,Ke)],2))),128))])])):I("",!0),u(),i.value!==""?(d(),g("button",{key:1,class:"k-clear-query-button",title:"Clear query",type:"button","data-testid":"k-filter-bar-clear-query-button",onClick:te},[Re,u(),S(c(me),{decorative:"","hide-title":"",size:c(w)},null,8,["size"])])):I("",!0)],512))}}),Xe=Q(Qe,[["__scopeId","data-v-d51e0350"]]);export{Ye as D,Xe as F};
