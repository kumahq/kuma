import{K as x}from"./index-fce48c05.js";import{d as V,k as L,z as I,G as N,a as g,o as s,c as b,e as r,w as a,F as B,C as E,n as K,l,f as i,t as y,m as u,b as c,p as v,Z as A,_ as F,B as G}from"./index-bbd71513.js";import{D as M,A as Z}from"./AppCollection-426d3daa.js";import{E as $}from"./ErrorBlock-d87f5562.js";import{P as q}from"./PolicyTypeTag-2ae5f2ec.js";import{_ as D}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-6ca86ba2.js";import{_ as O}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-7d6086d0.js";import{S as U}from"./SummaryView-e2b7a7a6.js";import"./TextWithCopyButton-a63dc99b.js";import"./CopyButton-83eb3594.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-ad740151.js";const j={class:"policy-list-content"},H={class:"policy-count"},J={class:"policy-list"},Q={class:"stack"},W={class:"description"},X={class:"description-content"},Y={class:"description-actions"},ee={class:"visually-hidden"},te={key:0},ae=V({__name:"PolicyList",props:{pageNumber:{},pageSize:{},policyTypes:{},currentPolicyType:{},policyCollection:{},policyError:{},meshInsight:{},isSelectedRow:{type:[Function,null],default:null}},emits:["change"],setup(T,{emit:S}){const{t:n}=L(),C=I(),e=T,P=S,z=N(()=>{const R=e.policyTypes.filter(m=>!m.isTargetRefBased||m.name!=="MeshGateway").some(m=>{var t,h,p;return(((p=(h=(t=e.meshInsight)==null?void 0:t.policies)==null?void 0:h[m.name])==null?void 0:p.total)??0)>0});return e.policyTypes.filter(m=>m.isTargetRefBased||m.name==="MeshGateway"?!0:R)});return(R,m)=>{const t=g("RouterLink"),h=g("KCard"),p=g("KBadge");return s(),b("div",j,[r(h,{class:"policy-type-list","data-testid":"policy-type-list"},{default:a(()=>[(s(!0),b(B,null,E(z.value,(d,_)=>{var o,k,f;return s(),b("div",{key:_,class:K(["policy-type-link-wrapper",{"policy-type-link-wrapper--is-active":d.path===e.currentPolicyType.path}])},[r(t,{class:"policy-type-link",to:{name:"policy-list-view",params:{mesh:l(C).params.mesh,policyPath:d.path}},"data-testid":`policy-type-link-${d.name}`},{default:a(()=>[i(y(d.name),1)]),_:2},1032,["to","data-testid"]),i(),u("div",H,y(((f=(k=(o=e.meshInsight)==null?void 0:o.policies)==null?void 0:k[d.name])==null?void 0:f.total)??0),1)],2)}),128))]),_:1}),i(),u("div",J,[u("div",Q,[r(h,null,{default:a(()=>[u("div",W,[u("div",X,[u("h3",null,[r(q,{"policy-type":e.currentPolicyType.name},{default:a(()=>[i(y(l(n)("policies.collection.title",{name:e.currentPolicyType.name})),1)]),_:1},8,["policy-type"])]),i(),u("p",null,y(l(n)(`policies.type.${e.currentPolicyType.name}.description`,void 0,{defaultMessage:l(n)("policies.collection.description")})),1)]),i(),u("div",Y,[e.currentPolicyType.isExperimental?(s(),c(p,{key:0,appearance:"warning"},{default:a(()=>[i(y(l(n)("policies.collection.beta")),1)]),_:1})):v("",!0),i(),e.currentPolicyType.isInbound?(s(),c(p,{key:1,appearance:"neutral"},{default:a(()=>[i(y(l(n)("policies.collection.inbound")),1)]),_:1})):v("",!0),i(),e.currentPolicyType.isOutbound?(s(),c(p,{key:2,appearance:"neutral"},{default:a(()=>[i(y(l(n)("policies.collection.outbound")),1)]),_:1})):v("",!0),i(),r(M,{href:l(n)("policies.href.docs",{name:e.currentPolicyType.name}),"data-testid":"policy-documentation-link"},{default:a(()=>[u("span",ee,y(l(n)("common.documentation")),1)]),_:1},8,["href"])])])]),_:1}),i(),r(h,null,{default:a(()=>{var d,_;return[e.policyError!==void 0?(s(),c($,{key:0,error:e.policyError},null,8,["error"])):(s(),c(Z,{key:1,class:"policy-collection","data-testid":"policy-collection","empty-state-message":l(n)("common.emptyState.message",{type:`${e.currentPolicyType.name} policies`}),"empty-state-cta-to":l(n)("policies.href.docs",{name:e.currentPolicyType.name}),"empty-state-cta-text":l(n)("common.documentation"),headers:[{label:"Name",key:"name"},...e.currentPolicyType.isTargetRefBased?[{label:"Target ref",key:"targetRef"}]:[],{label:"Details",key:"details",hideLabel:!0}],"page-number":e.pageNumber,"page-size":e.pageSize,total:(d=e.policyCollection)==null?void 0:d.total,items:(_=e.policyCollection)==null?void 0:_.items,error:e.policyError,"is-selected-row":e.isSelectedRow,onChange:m[0]||(m[0]=o=>P("change",o))},{name:a(({row:o})=>[r(t,{to:{name:"policy-summary-view",params:{mesh:o.mesh,policyPath:e.currentPolicyType.path,policy:o.name},query:{page:e.pageNumber,size:e.pageSize}}},{default:a(()=>[i(y(o.name),1)]),_:2},1032,["to"])]),targetRef:a(({row:o})=>{var k;return[e.currentPolicyType.isTargetRefBased&&typeof((k=o.spec)==null?void 0:k.targetRef)<"u"?(s(),c(p,{key:0,appearance:"neutral"},{default:a(()=>[i(y(o.spec.targetRef.kind),1),o.spec.targetRef.name?(s(),b("span",te,[i(":"),u("b",null,y(o.spec.targetRef.name),1)])):v("",!0)]),_:2},1024)):(s(),b(B,{key:1},[i(y(l(n)("common.detail.none")),1)],64))]}),details:a(({row:o})=>[r(t,{class:"details-link","data-testid":"details-link",to:{name:"policy-detail-view",params:{mesh:o.mesh,policyPath:e.currentPolicyType.path,policy:o.name}}},{default:a(()=>[i(y(l(n)("common.collection.details_link"))+" ",1),r(l(A),{display:"inline-block",decorative:"",size:l(x)},null,8,["size"])]),_:2},1032,["to"])]),_:1},8,["empty-state-message","empty-state-cta-to","empty-state-cta-text","headers","page-number","page-size","total","items","error","is-selected-row"]))]}),_:1})])])])}}});const ie=F(ae,[["__scopeId","data-v-e65b9726"]]),_e=V({__name:"PolicyListView",setup(T){return(S,n)=>{const C=g("RouteTitle"),e=g("RouterView"),P=g("DataSource"),z=g("AppView"),R=g("RouteView");return s(),c(P,{src:"/me"},{default:a(({data:m})=>[m?(s(),c(R,{key:0,name:"policy-list-view",params:{page:1,size:m.pageSize,mesh:"",policyPath:"",policy:""}},{default:a(({route:t,t:h})=>[r(z,null,{title:a(()=>[u("h2",null,[r(C,{title:h("policies.routes.items.title")},null,8,["title"])])]),default:a(()=>[i(),r(P,{src:"/*/policy-types"},{default:a(({data:p,error:d})=>[d?(s(),c($,{key:0,error:d},null,8,["error"])):p===void 0?(s(),c(O,{key:1})):p.policies.length===0?(s(),c(D,{key:2})):(s(),c(P,{key:3,src:`/meshes/${t.params.mesh}/policy-path/${t.params.policyPath}?page=${t.params.page}&size=${t.params.size}`},{default:a(({data:_,error:o})=>[r(P,{src:`/mesh-insights/${t.params.mesh}`},{default:a(({data:k})=>[(s(),c(ie,{key:t.params.policyPath,"page-number":t.params.page,"page-size":t.params.size,"current-policy-type":p.policies.find(f=>f.path===t.params.policyPath)??p.policies[0],"policy-types":p.policies,"mesh-insight":k,"policy-collection":_,"policy-error":o,"is-selected-row":f=>f.name===t.params.policy,onChange:t.update},null,8,["page-number","page-size","current-policy-type","policy-types","mesh-insight","policy-collection","policy-error","is-selected-row","onChange"])),i(),t.params.policy?(s(),c(e,{key:0},{default:a(f=>[r(U,{onClose:w=>t.replace({name:"policy-list-view",params:{mesh:t.params.mesh,policyPath:t.params.policyPath},query:{page:t.params.page,size:t.params.size}})},{default:a(()=>[(s(),c(G(f.Component),{policy:_==null?void 0:_.items.find(w=>w.name===t.params.policy),"policy-type":p.policies.find(w=>w.path===t.params.policyPath)},null,8,["policy","policy-type"]))]),_:2},1032,["onClose"])]),_:2},1024)):v("",!0)]),_:2},1032,["src"])]),_:2},1032,["src"]))]),_:2},1024)]),_:2},1024)]),_:2},1032,["params"])):v("",!0)]),_:1})}}});export{_e as default};
