import{d as V,c as v,r as F,o as s,a as c,w as i,q as x,g as t,h as l,t as f,f as p,e as k,F as q,b as y,G as L,s as I,L as N}from"./index-3a142bd5.js";import{D as E,a as b}from"./DefinitionListItem-e3979580.js";import{_ as K}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-e2c3b52a.js";import{S as O}from"./StatusBadge-c54fa150.js";import{T as G}from"./TagList-5a70d5cd.js";import{T as J}from"./TextWithCopyButton-5cda1463.js";import{m as R,f as A,g as W,A as j,q as H,_ as M}from"./RouteView.vue_vue_type_script_setup_true_lang-6e394197.js";import{_ as C}from"./DataSource.vue_vue_type_script_setup_true_lang-69141f89.js";import{_ as Q}from"./RouteTitle.vue_vue_type_script_setup_true_lang-727c485b.js";import{_ as U}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-363ede6e.js";import{E as X}from"./ErrorBlock-bfc4eea4.js";import{D as Y,K as Z}from"./KFilterBar-b7134331.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-6a962fb5.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-23750b8a.js";import"./AppCollection-7dd9601e.js";import"./notEmpty-7f452b20.js";const D={class:"entity-section-list"},ee={class:"entity-title"},re=V({__name:"ServiceSummary",props:{service:{},externalService:{default:null}},setup(S){const e=S,_=R(),z=v(()=>({name:"service-detail-view",params:{service:e.service.name,mesh:e.service.mesh}})),w=v(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.networking.address:e.service.addressPort??null),a=v(()=>{var o;return e.service.serviceType==="external"&&e.externalService!==null?(o=e.externalService.networking.tls)!=null&&o.enabled?"Enabled":"Disabled":null}),m=v(()=>{var o,u;if(e.service.serviceType==="external")return null;{const r=((o=e.service.dataplanes)==null?void 0:o.online)??0,T=((u=e.service.dataplanes)==null?void 0:u.total)??0;return`${r} online / ${T} total`}}),g=v(()=>e.service.serviceType==="external"?null:e.service.status??null),d=v(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.tags:null);async function h(o){if(e.service.serviceType==="external"&&e.externalService!==null){const{mesh:u,name:r}=e.externalService;return await _.getExternalService({mesh:u,name:r},o)}else{const{mesh:u,name:r}=e.service;return await _.getServiceInsight({mesh:u,name:r},o)}}return(o,u)=>{const r=F("router-link");return s(),c(y(L),null,{body:i(()=>[x("div",D,[x("section",null,[x("h1",ee,[x("span",null,[t(`
              Service:

              `),l(J,{text:e.service.name},{default:i(()=>[l(r,{to:z.value},{default:i(()=>[t(f(e.service.name),1)]),_:1},8,["to"])]),_:1},8,["text"])]),t(),g.value?(s(),c(O,{key:0,status:g.value},null,8,["status"])):p("",!0)]),t(),l(E,{class:"mt-4"},{default:i(()=>[l(b,{term:"Address"},{default:i(()=>[w.value!==null?(s(),k(q,{key:0},[t(f(w.value),1)],64)):(s(),k(q,{key:1},[t(`
                —
              `)],64))]),_:1}),t(),a.value!==null?(s(),c(b,{key:0,term:"TLS"},{default:i(()=>[t(f(a.value),1)]),_:1})):p("",!0),t(),m.value!==null?(s(),c(b,{key:1,term:"Data Plane Proxies"},{default:i(()=>[t(f(m.value),1)]),_:1})):p("",!0),t(),d.value!==null?(s(),c(b,{key:2,term:"Tags"},{default:i(()=>[l(G,{tags:d.value},null,8,["tags"])]),_:1})):p("",!0)]),_:1})]),t(),l(K,{id:"code-block-service","resource-fetcher":h,"resource-fetcher-watch-key":e.service.name,"is-searchable":"","show-copy-as-kubernetes-button":e.service.serviceType==="external"&&e.externalService!==null,"code-max-height":"250px"},null,8,["resource-fetcher-watch-key","show-copy-as-kubernetes-button"])])]),_:1})}}});const te=A(re,[["__scopeId","data-v-31d05cbc"]]),se={key:3,class:"stack"},ie=V({__name:"ServiceDetailView",props:{page:{},size:{},search:{},query:{},gatewayType:{},mesh:{},service:{}},setup(S){const e=S,{t:_}=W();return(z,w)=>(s(),c(M,{name:"service-detail-view"},{default:i(({route:a})=>[l(Q,{title:y(_)("services.routes.item.title",{name:a.params.service})},null,8,["title"]),t(),l(j,{breadcrumbs:[{to:{name:"services-list-view",params:{mesh:a.params.mesh}},text:y(_)("services.routes.item.breadcrumbs")}]},{default:i(()=>[l(C,{src:`/${a.params.mesh}/service-insights/${a.params.service}`},{default:i(({data:m,isLoading:g,error:d})=>[l(C,{src:`/${a.params.mesh}/external-services/${a.params.service}`},{default:i(({data:h,isLoading:o,error:u})=>[g||o?(s(),c(H,{key:0})):d??u?(s(),c(X,{key:1,error:d??u},null,8,["error"])):m===void 0||h===void 0?(s(),c(U,{key:2})):(s(),k("div",se,[l(te,{service:m,"external-service":h},null,8,["service","external-service"]),t(),(m==null?void 0:m.serviceType)!=="external"?(s(),c(C,{key:0,src:`/${a.params.mesh}/dataplanes/for/${a.params.service}/of/${e.gatewayType}?page=${e.page}&size=${e.size}&search=${e.search}`},{default:i(({data:r,error:T})=>{var B;return[(s(!0),k(q,null,I([typeof((B=r==null?void 0:r.items)==null?void 0:B[0].dataplane.networking.gateway)>"u"],$=>(s(),c(y(L),{key:$},{body:i(()=>[l(Y,{"data-testid":"data-plane-collection",class:"data-plane-collection","page-number":e.page,"page-size":e.size,total:r==null?void 0:r.total,items:r==null?void 0:r.items,error:T,gateways:$,onChange:({page:n,size:P})=>{a.update({page:String(n),size:String(P)})}},{toolbar:i(()=>[l(Z,{class:"data-plane-proxy-filter",placeholder:"tag: 'kuma.io/protocol: http'",query:e.query,fields:{name:{description:"filter by name or parts of a name"},protocol:{description:"filter by “kuma.io/protocol” value"},tag:{description:"filter by tags (e.g. “tag: version:2”)"},zone:{description:"filter by “kuma.io/zone” value"}},onFieldsChange:n=>a.update({query:n.query,s:n.query.length>0?JSON.stringify(n.fields):""})},null,8,["placeholder","query","fields","onFieldsChange"]),t(),$?(s(),c(y(N),{key:0,label:"Type","overlay-label":!0,items:[{label:"All",value:"all"},{label:"Builtin",value:"builtin"},{label:"Delegated",value:"delegated"}].map(n=>({...n,selected:n.value===e.gatewayType})),appearance:"select",onSelected:n=>a.update({gatewayType:String(n.value)})},{"item-template":i(({item:n})=>[t(f(n.label),1)]),_:2},1032,["items","onSelected"])):p("",!0)]),_:2},1032,["page-number","page-size","total","items","error","gateways","onChange"])]),_:2},1024))),128))]}),_:2},1032,["src"])):p("",!0)]))]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["breadcrumbs"])]),_:1}))}});const be=A(ie,[["__scopeId","data-v-283c0722"]]);export{be as default};
