import{d as K,k as c,l as Y,o as l,f as i,a as d,n as t,x as $,e as q,u as Q,j as C,s as U,cq as L,K as P,c as B,w as _,p as R,F as b,g as u,i as D,t as h,Q as S,b as N}from"./index.f4381a04.js";import{D as T,V as O,M as W}from"./MeshResources.608317f5.js";import{L as F}from"./LabelList.9a976194.js";import{T as z}from"./TabsWidget.7caab1f8.js";import{Y as G}from"./YamlView.8ed40dd6.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.a081fa47.js";import"./ErrorBlock.3c391f50.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.52c551fa.js";import"./index.58caa11d.js";import"./CodeBlock.2eccb873.js";import"./_commonjsHelpers.f037b798.js";const H={class:"chart-container mt-16"},J=K({__name:"MeshCharts",setup(A){const s=$(),f=c(()=>s.getters.getServiceResourcesFetching),y=c(()=>s.getters.getMeshInsightsFetching),m=c(()=>s.getters.getChart("services")),p=c(()=>s.getters.getChart("dataplanes")),g=c(()=>s.getters.getChart("kumaDPVersions")),o=c(()=>s.getters.getChart("envoyVersions"));Y(()=>s.state.selectedMesh,function(){k()}),k();function k(){s.dispatch("fetchMeshInsights",s.state.selectedMesh),s.dispatch("fetchServices",s.state.selectedMesh)}return(V,x)=>(l(),i("div",H,[d(T,{class:"chart chart-1/4",title:{singular:"SERVICE",plural:"SERVICES"},data:t(m).data,"is-loading":t(f),"save-chart":""},null,8,["data","is-loading"]),d(T,{class:"chart chart-1/4",title:{singular:"DP PROXY",plural:"DP PROXIES"},data:t(p).data,url:{name:"data-plane-list-view",params:{mesh:t(s).state.selectedMesh}},"is-loading":t(y)},null,8,["data","url","is-loading"]),d(O,{class:"chart chart-1/4",title:"KUMA DP",data:t(g).data,"is-loading":t(y)},null,8,["data","is-loading"]),d(O,{class:"chart chart-1/4",title:"ENVOY",data:t(o).data,"is-loading":t(y),"display-am-charts-logo":""},null,8,["data","is-loading"])]))}});const Z=q(J,[["__scopeId","data-v-0ea59e37"]]),ee={key:1},ae={key:1},te={key:1,class:"mt-8"},pe=K({__name:"MeshOverviewView",setup(A){const s=Q(),f=$(),y=[{hash:"#overview",title:"Overview"},{hash:"#resources",title:"Resources"}],m=C(!0),p=C(!1),g=C(!1),o=C(null),k=C(null),V=c(()=>o.value!==null?U(o.value):null),x=c(()=>{if(o.value===null)return null;const{name:n,type:r,creationTime:e,modificationTime:a}=o.value;return{name:n,type:r,created:L(e),modified:L(a)}}),X=c(()=>{var M;if(o.value===null)return null;const n=w(o.value,"mtls"),r=w(o.value,"logging"),e=w(o.value,"metrics"),a=w(o.value,"tracing"),v=Boolean((M=o.value.routing)==null?void 0:M.localityAwareLoadBalancing);return{mtls:n,logging:r,metrics:e,tracing:a,localityAwareLoadBalancing:v}}),E=c(()=>{const n=f.state.policies.map(r=>{var e,a;return{title:r.pluralDisplayName,value:(a=(e=f.state.meshInsight.policies[r.name])==null?void 0:e.total)!=null?a:0}});return[{title:"Data Plane Proxies",value:f.state.meshInsight.dataplanes.total},...n]});Y(()=>s.params.mesh,function(){s.name==="single-mesh-overview"&&(m.value=!0,g.value=!1,p.value=!1,I())}),I();async function I(){m.value=!0,g.value=!1;const n=s.params.mesh;try{o.value=await P.getMesh({name:n}),k.value=await P.getMeshInsights({name:n})}catch(r){p.value=!0,g.value=!0,console.error(r)}finally{m.value=!1}}function w(n,r){var v,M;if(n===null||n[r]===void 0)return!1;const e=(M=(v=n[r].enabledBackend)!=null?v:n[r].defaultBackend)!=null?M:n[r].backends[0].name,a=n[r].backends.find(j=>j.name===e);return`${a.type} / ${a.name}`}return(n,r)=>(l(),i(b,null,[d(Z),d(W,{class:"mt-8"}),o.value!==null?(l(),B(z,{key:0,class:"mt-8","has-error":p.value,"is-loading":m.value,tabs:y,"initial-tab-override":"overview"},{overview:_(()=>[d(F,null,{default:_(()=>[u("div",null,[u("ul",null,[(l(!0),i(b,null,D(t(x),(e,a)=>(l(),i("li",{key:a},[u("h4",null,h(a),1),typeof e=="boolean"?(l(),B(t(S),{key:0,appearance:e?"success":"danger"},{default:_(()=>[N(h(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),i("p",ee,h(e),1))]))),128))])]),u("div",null,[u("ul",null,[(l(!0),i(b,null,D(t(X),(e,a)=>(l(),i("li",{key:a},[u("h4",null,h(a),1),typeof e=="boolean"?(l(),B(t(S),{key:0,appearance:e?"success":"danger"},{default:_(()=>[N(h(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),i("p",ae,h(e),1))]))),128))])])]),_:1})]),resources:_(()=>[d(F,{"has-error":p.value,"is-loading":m.value,"is-empty":g.value},{default:_(()=>[(l(!0),i(b,null,D(Math.ceil(t(E).length/3),e=>(l(),i("div",{key:e},[u("ul",null,[(l(!0),i(b,null,D(t(E).slice((e-1)*3,e*3),(a,v)=>(l(),i("li",{key:v},[u("h4",null,h(a.title),1),u("p",null,h(a.value),1)]))),128))])]))),128))]),_:1},8,["has-error","is-loading","is-empty"])]),_:1},8,["has-error","is-loading"])):R("",!0),t(V)!==null?(l(),i("div",te,[d(G,{id:"code-block-mesh",content:t(V)},null,8,["content"])])):R("",!0)],64))}});export{pe as default};
