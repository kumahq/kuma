import{_ as B,P as M,aa as A,ab as V,A as H,B as z,K as E,l as T,s as F,a2 as K,a4 as N,e as s,a as b,w as h,r as f,o as a,b as k,c as w,f as o,t as m,n as C,F as I,h as L,x as P,y as O}from"./index.04875eef.js";import{g as R}from"./tableDataUtils.29bbdc2c.js";import{F as Y}from"./FrameSkeleton.49389b31.js";import{D as W}from"./DataOverview.cb1ff33f.js";import{T as j}from"./TabsWidget.0ad3f108.js";import{Y as q}from"./YamlView.eaa3134f.js";import{L as G}from"./LabelList.ba2075c7.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.0fcd7b43.js";import"./ErrorBlock.08062bd2.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.4361c91d.js";import"./index.58caa11d.js";import"./CodeBlock.58f32651.js";import"./_commonjsHelpers.712cc82f.js";const U={name:"MeshesView",components:{FrameSkeleton:Y,DataOverview:W,TabsWidget:j,YamlView:q,LabelList:G},data(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,empty_state:{title:"No Data",message:"There are no Meshes present."},tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Type",key:"type"}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#resources",title:"Resources"}],entity:{},rawEntity:{},pageSize:M,next:null,itemsPerCol:3,meshInsight:A()}},computed:{...V({policies:t=>t.policies}),counts(){const t=this.policies.map(i=>{var p;return{title:i.pluralDisplayName,value:((p=this.meshInsight.policies[i.name])==null?void 0:p.total)||0}});return[{title:"Data plane proxies",value:this.meshInsight.dataplanes.total},...t]},countCols(){return Math.ceil(this.counts.length/this.itemsPerCol)}},watch:{$route(){this.isLoading=!0,this.isEmpty=!1,this.hasError=!1,this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,this.tableDataIsEmpty=!1,this.loadData()}},beforeMount(){this.init()},methods:{init(){this.loadData()},onCreateClick(){H.logger.info(z.CREATE_MESH_CLICKED)},tableAction(t){const i=t;this.getEntity(i)},async loadData(t="0"){this.isLoading=!0,this.isEmpty=!1;const i=this.$route.params.mesh;let p;i!=="all"&&(p=this.$route.params.mesh);try{const{data:y,next:e}=await R({getSingleEntity:E.getMesh.bind(E),getAllEntities:E.getAllMeshes.bind(E),size:this.pageSize,offset:t,query:p});this.next=e,y.length?(this.tableData.data=[...y],this.tableDataIsEmpty=!1,this.isEmpty=!1,this.getEntity({name:y[0].name})):(this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.entityIsEmpty=!0)}catch(y){this.hasError=!0,this.isEmpty=!0,console.error(y)}finally{this.isLoading=!1}},getEntity(t){if(this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,t&&t!==null)return E.getMesh({name:t.name}).then(i=>{if(i){E.getMeshInsights({name:t.name}).then(n=>{this.meshInsight=n});const p=T(i,["type","name"]),y=()=>{const n=Object.entries(T(i,["mtls","logging","metrics","tracing"])),_=[];return n.forEach(v=>{const g=v[0],l=v[1]||null;if(l&&l.enabledBackend){const d=l.enabledBackend,u=l.backends.find(D=>D.name===d);u&&_.push({label:g,value:{type:u.type,name:u.name}})}else if(l&&l.defaultBackend){const d=l.defaultBackend,u=l.backends.find(D=>D.name===d);u&&_.push({label:g,value:{type:u.type,name:u.name}})}else if(l&&l.backends){const d=l.backends[0];d&&_.push({label:g,value:{type:d.type,name:d.name}})}else _.push({label:g,value:null})}),_},e=()=>{const{routing:n}=i;return n&&n.localityAwareLoadBalancing};this.entity={basicData:p,extendedData:y(),localityEnabled:e()},this.rawEntity=F(i)}else this.entity={},this.entityIsEmpty=!0}).catch(i=>{this.entityHasError=!0,console.error(i)}).finally(()=>{setTimeout(()=>{this.entityIsLoading=!1},"500")});setTimeout(()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1},"500")},formatValue(t){return t?t.toLocaleString("en").toString():0},readableDate(t){return K(t)},rawDate(t){return N(t)}}},x=t=>(P("data-v-2a8b2214"),t=t(),O(),t),Z={class:"all-meshes"},J=x(()=>o("span",{class:"custom-control-icon"}," + ",-1)),Q={key:0},X={key:0},$={key:1},ee={key:2},te={key:3},ae={key:4},se={key:0},ie={key:0,class:"label-cols"},ne=x(()=>o("h4",null,"Locality Aware Loadbalancing",-1)),oe={key:0},le={class:"config-wrapper"};function re(t,i,p,y,e,n){const _=f("KButton"),v=f("DataOverview"),g=f("KBadge"),l=f("LabelList"),d=f("YamlView"),u=f("TabsWidget"),D=f("FrameSkeleton");return a(),s("div",Z,[b(D,null,{default:h(()=>[b(v,{"page-size":e.pageSize,"has-error":e.hasError,"is-loading":e.isLoading,"empty-state":e.empty_state,"table-data":e.tableData,"table-data-is-empty":e.tableDataIsEmpty,next:e.next,onTableAction:n.tableAction,onLoadData:i[0]||(i[0]=r=>n.loadData(r))},{additionalControls:h(()=>[b(_,{class:"add-mesh-button",appearance:"primary",to:{path:"/wizard/mesh"},onClick:n.onCreateClick},{default:h(()=>[J,k(" Create Mesh ")]),_:1},8,["onClick"])]),_:1},8,["page-size","has-error","is-loading","empty-state","table-data","table-data-is-empty","next","onTableAction"]),e.isEmpty===!1?(a(),w(u,{key:0,"has-error":e.hasError,"is-loading":e.isLoading,tabs:e.tabs,"initial-tab-override":"overview"},{tabHeader:h(()=>[e.entity.basicData?(a(),s("div",Q,[o("h3",null," Mesh: "+m(e.entity.basicData.name),1)])):C("",!0)]),overview:h(()=>[b(l,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:h(()=>[o("div",null,[o("ul",null,[(a(!0),s(I,null,L(e.entity.basicData,(r,c)=>(a(),s("li",{key:c},[c==="creationTime"?(a(),s("h4",X," Created ")):c==="modificationTime"?(a(),s("h4",$," Last Modified ")):(a(),s("h4",ee,m(c),1)),c==="creationTime"||c==="modificationTime"?(a(),s("p",te,[k(m(n.readableDate(r))+" ",1),o("em",null,"("+m(n.rawDate(r))+")",1)])):(a(),s("p",ae,m(r),1))]))),128))])]),e.entity.extendedData&&e.entity.extendedData.length?(a(),s("div",se,[o("ul",null,[(a(!0),s(I,null,L(e.entity.extendedData,(r,c)=>(a(),s("li",{key:c},[o("h4",null,m(r.label),1),r.value?(a(),s("p",ie,[o("span",null,m(r.value.type),1),o("span",null,m(r.value.name),1)])):(a(),w(g,{key:1,appearance:"danger"},{default:h(()=>[k(" Disabled ")]),_:1}))]))),128)),o("li",null,[ne,e.entity.localityEnabled?(a(),s("p",oe,[b(g,{appearance:"success"},{default:h(()=>[k(" Enabled ")]),_:1})])):(a(),w(g,{key:1,appearance:"danger"},{default:h(()=>[k(" Disabled ")]),_:1}))])])])):C("",!0)]),_:1},8,["has-error","is-loading","is-empty"]),o("div",le,[b(d,{id:"code-block-mesh","has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty,content:e.rawEntity},null,8,["has-error","is-loading","is-empty","content"])])]),resources:h(()=>[b(l,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:h(()=>[(a(!0),s(I,null,L(n.countCols,r=>(a(),s("div",{key:r},[o("ul",null,[(a(!0),s(I,null,L(n.counts.slice((r-1)*e.itemsPerCol,r*e.itemsPerCol),(c,S)=>(a(),s("li",{key:S},[o("h4",null,m(c.title),1),o("p",null,m(n.formatValue(c.value)),1)]))),128))])]))),128))]),_:1},8,["has-error","is-loading","is-empty"])]),_:1},8,["has-error","is-loading","tabs"])):C("",!0)]),_:1})])}const ke=B(U,[["render",re],["__scopeId","data-v-2a8b2214"]]);export{ke as default};
