import{d as F,u as q,k as v,c as _,o as u,e as g,h as s,g as c,r as H,a as y,w as i,b as f,s as O,j as S,F as C,v as N,R as K,t as b,f as J}from"./index-2a9ba339.js";import{g as W,n as z,s as R,q as Q,D as B,f as G,e as U,A as X,_ as Y}from"./RouteView.vue_vue_type_script_setup_true_lang-5d6806ed.js";import{_ as Z}from"./RouteTitle.vue_vue_type_script_setup_true_lang-4859e7c4.js";import{D as j,a as A}from"./DefinitionListItem-f89cab16.js";import{_ as ee}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-d2063a86.js";import{_ as te}from"./StatusInfo.vue_vue_type_script_setup_true_lang-1cb23237.js";import{T as ae}from"./TextWithCopyButton-ce458937.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-d3825514.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-f5999d2a.js";import"./ErrorBlock-972a2bbe.js";const ne={class:"chart-box-list"},le=F({__name:"MeshCharts",setup(M){const o=W(),V=z(),w=q(),D=v(!1),x=v({total:0,online:0,partiallyDegraded:0,offline:0}),h=v({total:0,internal:0,external:0}),p=v({kumaDp:{},envoy:{}}),r=_(()=>{const n=[],{internal:t,external:e}=h.value;return t&&n.push({title:o.t("common.charts.services.internalLabel"),data:t}),e&&n.push({title:o.t("common.charts.services.externalLabel"),data:e}),{title:o.t("common.charts.services.title"),showTotal:!0,dataPoints:n}}),m=_(()=>{const n=[],{total:t,online:e,partiallyDegraded:l}=x.value;if(t>0){n.push({title:o.t("http.api.value.online"),statusKeyword:"online",data:e}),l>0&&n.push({title:o.t("http.api.value.partially_degraded"),statusKeyword:"partially_degraded",data:l});const a=t-l-e;a>0&&n.push({title:o.t("http.api.value.offline"),statusKeyword:"offline",data:a})}return{title:o.t("common.charts.dataPlaneProxies.title"),showTotal:!0,dataPoints:n}}),P=_(()=>{const n=Object.entries(p.value.kumaDp).map(([t,e])=>({title:t,data:e.total??0}));return n.sort((t,e)=>t.title==="unknown"?1:e.title==="unknown"?-1:R(t.title,e.title)),{title:o.t("common.charts.kumaDp.title"),subtitle:o.t("common.charts.kumaDp.subtitle"),dataPoints:n}}),I=_(()=>{const n=Object.entries(p.value.envoy).map(([t,e])=>({title:t,data:e.total??0}));return n.sort((t,e)=>t.title==="unknown"?1:e.title==="unknown"?-1:R(t.title,e.title)),{title:o.t("common.charts.envoy.title"),subtitle:o.t("common.charts.envoy.subtitle"),dataPoints:n}});$();async function $(){D.value=!0;const n=w.params.mesh;try{const t=await V.getMeshInsights({name:n}),e=Q([t]);L(e),T(e),k(e)}catch{x.value={total:0,online:0,partiallyDegraded:0,offline:0},h.value={total:0,internal:0,external:0},p.value={kumaDp:{},envoy:{}}}finally{D.value=!1}}function L(n){const{total:t,online:e,partiallyDegraded:l}=n.dataplanes;x.value={total:t,online:e,partiallyDegraded:l,offline:t-e-l}}function T(n){const{total:t,internal:e,external:l}=n.services;h.value={total:t,internal:e,external:l}}function k(n){p.value=n.dpVersions}return(n,t)=>(u(),g("div",ne,[s(B,{data:r.value},null,8,["data"]),c(),s(B,{data:m.value},null,8,["data"]),c(),s(B,{data:P.value},null,8,["data"]),c(),s(B,{data:I.value},null,8,["data"])]))}});const se=G(le,[["__scopeId","data-v-375c50a1"]]);function oe(M){return M!=null}const re={class:"stack"},ie={class:"columns"},ue=F({__name:"MeshOverviewView",setup(M){const{t:o,formatIsoDate:V}=W(),w=z(),D=q(),x=U(),h=v(!0),p=v(null),r=v(null),m=v(null),P=_(()=>{if(r.value===null||m.value===null)return null;const{name:t,creationTime:e,modificationTime:l}=r.value;return{name:t,created:V(e),modified:V(l),"Data Plane Proxies":m.value.dataplanes.total}}),I=_(()=>{var E;if(r.value===null)return null;const t=k(r.value,"mtls"),e=k(r.value,"logging"),l=k(r.value,"metrics"),a=k(r.value,"tracing"),d=!!((E=r.value.routing)!=null&&E.localityAwareLoadBalancing);return{mtls:t,logging:e,metrics:l,tracing:a,localityAwareLoadBalancing:d}}),$=_(()=>m.value===null?0:Object.values(m.value.policies).reduce((t,e)=>t+e.total,0)),L=_(()=>m.value===null?[]:Object.entries(m.value.policies).map(([t,e])=>{const l=x.state.policyTypesByName[t];return l&&e.total!==0?{name:l.name,path:l.path,total:e.total}:null}).filter(oe));T();async function T(){h.value=!0,p.value=null;const t=D.params.mesh;try{r.value=await w.getMesh({name:t}),m.value=await w.getMeshInsights({name:t})}catch(e){e instanceof Error?p.value=e:console.error(p),r.value=null,m.value=null}finally{h.value=!1}}function k(t,e){if(t===null||t[e]===void 0)return!1;const l=t[e].enabledBackend??t[e].defaultBackend??t[e].backends[0].name,a=t[e].backends.find(d=>d.name===l);return`${a.type} / ${a.name}`}async function n(t){const e=D.params.mesh;return await w.getMesh({name:e},t)}return(t,e)=>{const l=H("router-link");return u(),y(Y,null,{default:i(()=>[s(Z,{title:f(o)("meshes.routes.overview.title")},null,8,["title"]),c(),s(X,null,{default:i(()=>[O("div",re,[s(f(S),null,{body:i(()=>[s(se)]),_:1}),c(),r.value!==null?(u(),y(f(S),{key:0},{body:i(()=>[O("div",ie,[s(te,{"is-loading":h.value,error:p.value,"is-empty":r.value===null||m.value===null},{default:i(()=>[s(j,null,{default:i(()=>[(u(!0),g(C,null,N(P.value,(a,d)=>(u(),y(A,{key:d,term:f(o)(`http.api.property.${d}`)},{default:i(()=>[typeof a=="boolean"?(u(),y(f(K),{key:0,appearance:a?"success":"danger"},{default:i(()=>[c(b(a?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):d==="name"&&typeof a=="string"?(u(),y(ae,{key:1,text:a},null,8,["text"])):(u(),g(C,{key:2},[c(b(a),1)],64))]),_:2},1032,["term"]))),128))]),_:1})]),_:1},8,["is-loading","error","is-empty"]),c(),s(j,null,{default:i(()=>[(u(!0),g(C,null,N(I.value,(a,d)=>(u(),y(A,{key:d,term:f(o)(`http.api.property.${d}`)},{default:i(()=>[typeof a=="boolean"?(u(),y(f(K),{key:0,appearance:a?"success":"danger"},{default:i(()=>[c(b(a?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(u(),g(C,{key:1},[c(b(a),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),c(),s(j,null,{default:i(()=>[s(A,{term:`Policies (${$.value})`},{default:i(()=>[O("ul",null,[(u(!0),g(C,null,N(L.value,(a,d)=>(u(),g("li",{key:d},[s(l,{to:{name:"policies-list-view",params:{policyPath:a.path}}},{default:i(()=>[c(b(a.name)+": "+b(a.total),1)]),_:2},1032,["to"])]))),128))])]),_:1},8,["term"])]),_:1})])]),_:1})):J("",!0),c(),s(f(S),null,{body:i(()=>{var a;return[s(ee,{id:"code-block-mesh","resource-fetcher":n,"resource-fetcher-watch-key":((a=r.value)==null?void 0:a.name)||null},null,8,["resource-fetcher-watch-key"])]}),_:1})])]),_:1})]),_:1})}}});const ke=G(ue,[["__scopeId","data-v-95ae0e56"]]);export{ke as default};
