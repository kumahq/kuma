import{K as L}from"./index-9dd3e7d3.js";import{d as O,l as $,x as z,N as K,a as v,o as d,b,w as a,e,a0 as S,f as t,p as r,a1 as p,t as n,q as s,a2 as U,s as D,c as u,F as k,B as w,_ as H}from"./index-2f3df39b.js";import{g as F}from"./index-7ae2b68e.js";import{S as W}from"./StatusBadge-5b1394da.js";import{T as V}from"./TagList-89aa6a40.js";import{T as A}from"./TextWithCopyButton-669c3405.js";import{_ as Z}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-fe5894a5.js";import{a as j,c as q,C as G,I as X,d as J}from"./dataplane-dcd0858b.js";import"./CopyButton-b8af4b3e.js";import"./AccordionList-e1c5802c.js";const Q={"data-testid":"dataplane-warnings"},Y=["data-testid","innerHTML"],tt={class:"stack","data-testid":"dataplane-details"},at={class:"columns"},et={class:"status-with-reason"},st={key:0,"data-testid":"dataplane-inbounds"},nt={class:"inbound-list"},it={class:"mt-4 columns"},ot={"data-testid":"dataplane-mtls"},lt={class:"columns"},dt=["innerHTML"],rt={key:0,"data-testid":"dataplane-subscriptions"},pt=O({__name:"DataPlaneDetailView",props:{data:{}},setup(R){const{t:i,formatIsoDate:B}=$(),M=z(),l=R,E=K(()=>j(l.data.dataplane,l.data.dataplaneInsight)),P=K(()=>{var y;const g=F(((y=l.data.dataplaneInsight)==null?void 0:y.subscriptions)??[]);return g!==void 0?B(g):i("common.detail.none")}),N=K(()=>{var T,C;const g=((T=l.data.dataplaneInsight)==null?void 0:T.subscriptions)??[];if(g.length===0)return[];const y=g[g.length-1];if(!("version"in y)||!y.version)return[];const _=y.version,c=[];if(_.kumaDp&&_.envoy){const f=q(_);f.kind!==G&&f.kind!==X&&c.push(f)}const h=(C=l.data.dataplaneInsight)==null?void 0:C.mTLS;return h&&Date.now()>new Date(h==null?void 0:h.certificateExpirationTime).getTime()&&c.push({kind:"CERT_EXPIRED",payload:{}}),M("use zones")&&J(l.data.dataplane).find(I=>I.label==="kuma.io/zone")&&typeof _.kumaDp.kumaCpCompatible=="boolean"&&!_.kumaDp.kumaCpCompatible&&c.push({kind:"INCOMPATIBLE_ZONE_CP_AND_KUMA_DP_VERSIONS",payload:{kumaDp:_.kumaDp.version}}),c});return(g,y)=>{const _=v("KTooltip"),c=v("KCard"),h=v("KBadge"),T=v("KAlert"),C=v("AppView"),f=v("RouteView");return d(),b(f,{name:"data-plane-detail-view"},{default:a(()=>[e(C,null,S({default:a(()=>{var m,I;return[t(),r("div",tt,[e(c,null,{body:a(()=>[r("div",at,[e(p,null,{title:a(()=>[t(n(s(i)("http.api.property.status")),1)]),body:a(()=>[r("div",et,[e(W,{status:E.value.status},null,8,["status"]),t(),E.value.reason.length>0?(d(),b(_,{key:0,label:E.value.reason.join(", "),class:"reason-tooltip"},{default:a(()=>[e(s(U),{size:s(L),"hide-title":""},null,8,["size"])]),_:1},8,["label"])):D("",!0)])]),_:1}),t(),e(p,null,{title:a(()=>[t(n(s(i)("data-planes.routes.item.last_updated")),1)]),body:a(()=>[t(n(P.value),1)]),_:1}),t(),l.data.dataplane.networking.gateway?(d(),u(k,{key:0},[e(p,null,{title:a(()=>[t(n(s(i)("http.api.property.tags")),1)]),body:a(()=>[e(V,{tags:l.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:1}),t(),e(p,null,{title:a(()=>[t(n(s(i)("http.api.property.address")),1)]),body:a(()=>[e(A,{text:`${l.data.dataplane.networking.address}`},null,8,["text"])]),_:1})],64)):D("",!0)])]),_:1}),t(),l.data.dataplane.networking.inbound&&l.data.dataplane.networking.inbound.length>0?(d(),u("div",st,[r("h2",null,n(s(i)("data-planes.routes.item.inbounds")),1),t(),e(c,{class:"mt-4"},{body:a(()=>[r("div",nt,[(d(!0),u(k,null,w(l.data.dataplane.networking.inbound,(o,x)=>(d(),u("div",{key:x,class:"inbound"},[r("h4",null,[e(A,{text:o.tags["kuma.io/service"]},{default:a(()=>[t(n(s(i)("data-planes.routes.item.inbound_name",{service:o.tags["kuma.io/service"]})),1)]),_:2},1032,["text"])]),t(),r("div",it,[e(p,null,{title:a(()=>[t(n(s(i)("http.api.property.status")),1)]),body:a(()=>[!o.health||o.health.ready?(d(),b(h,{key:0,appearance:"success"},{default:a(()=>[t(n(s(i)("data-planes.routes.item.health.ready")),1)]),_:1})):(d(),b(h,{key:1,appearance:"danger"},{default:a(()=>[t(n(s(i)("data-planes.routes.item.health.not_ready")),1)]),_:1}))]),_:2},1024),t(),e(p,null,{title:a(()=>[t(n(s(i)("http.api.property.tags")),1)]),body:a(()=>[e(V,{tags:o.tags},null,8,["tags"])]),_:2},1024),t(),e(p,null,{title:a(()=>[t(n(s(i)("http.api.property.address")),1)]),body:a(()=>[e(A,{text:`${o.address??l.data.dataplane.networking.advertisedAddress??l.data.dataplane.networking.address}:${o.port}`},null,8,["text"])]),_:2},1024),t(),e(p,null,{title:a(()=>[t(n(s(i)("http.api.property.serviceAddress")),1)]),body:a(()=>[e(A,{text:`${o.serviceAddress??o.address??l.data.dataplane.networking.address}:${o.servicePort??o.port}`},null,8,["text"])]),_:2},1024)])]))),128))])]),_:1})])):D("",!0),t(),r("div",ot,[r("h2",null,n(s(i)("data-planes.routes.item.mtls.title")),1),t(),(m=l.data.dataplaneInsight)!=null&&m.mTLS?(d(!0),u(k,{key:0},w([l.data.dataplaneInsight.mTLS],o=>(d(),b(c,{key:o,class:"mt-4"},{body:a(()=>[r("div",lt,[e(p,null,{title:a(()=>[t(n(s(i)("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:a(()=>[t(n(s(B)(o.certificateExpirationTime)),1)]),_:2},1024),t(),e(p,null,{title:a(()=>[t(n(s(i)("data-planes.routes.item.mtls.generation_time.title")),1)]),body:a(()=>[t(n(s(B)(o.lastCertificateRegeneration)),1)]),_:2},1024),t(),e(p,null,{title:a(()=>[t(n(s(i)("data-planes.routes.item.mtls.regenerations.title")),1)]),body:a(()=>[t(n(s(i)("common.formats.integer",{value:o.certificateRegenerations})),1)]),_:2},1024),t(),e(p,null,{title:a(()=>[t(n(s(i)("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:a(()=>[t(n(o.issuedBackend),1)]),_:2},1024),t(),e(p,null,{title:a(()=>[t(n(s(i)("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:a(()=>[r("ul",null,[(d(!0),u(k,null,w(o.supportedBackends,x=>(d(),u("li",{key:x},n(x),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(d(),b(T,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:a(()=>[r("div",{innerHTML:s(i)("data-planes.routes.item.mtls.disabled")},null,8,dt)]),_:1}))]),t(),(d(!0),u(k,null,w([((I=l.data.dataplaneInsight)==null?void 0:I.subscriptions)??[]],o=>(d(),u(k,{key:o},[o.length>0?(d(),u("div",rt,[r("h2",null,n(s(i)("data-planes.routes.item.subscriptions.title")),1),t(),e(c,{class:"mt-4"},{body:a(()=>[e(Z,{subscriptions:o},null,8,["subscriptions"])]),_:2},1024)])):D("",!0)],64))),128))])]}),_:2},[N.value.length>0?{name:"notifications",fn:a(()=>[r("ul",Q,[(d(!0),u(k,null,w(N.value,m=>(d(),u("li",{key:m.kind,"data-testid":`warning-${m.kind}`,innerHTML:s(i)(`common.warnings.${m.kind}`,m.payload)},null,8,Y))),128)),t()])]),key:"0"}:void 0]),1024)]),_:1})}}});const bt=H(pt,[["__scopeId","data-v-72b3b983"]]);export{bt as default};
