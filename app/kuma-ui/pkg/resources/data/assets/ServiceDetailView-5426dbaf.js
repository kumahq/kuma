import{d as z,c as h,r as R,o as s,e as V,h as l,w as r,q as A,a as i,g as t,t as p,b as u,f,G as L,B as I,F as K,s as W,W as G}from"./index-f1d26a4d.js";import{m as J,g as F,D as g,S as O,R as j,A as H,o as $,q as B,E as C,r as P,_ as M,f as Q}from"./RouteView.vue_vue_type_script_setup_true_lang-658e86d1.js";import{_ as U}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-1e4cced9.js";import{T as X}from"./TagList-43a0341d.js";import{T as Y}from"./TextWithCopyButton-8730651e.js";import{_ as Z}from"./RouteTitle.vue_vue_type_script_setup_true_lang-a47c6428.js";import{D,K as ee}from"./KFilterBar-d62ecb5e.js";import{T as re}from"./TabsWidget-36b2492a.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-d695b393.js";import"./CopyButton-51a400ca.js";import"./AppCollection-557f1696.js";import"./dataplane-30467516.js";import"./notEmpty-7f452b20.js";const te={class:"stack"},se={class:"variable-columns"},ie=z({__name:"ServiceSummary",props:{service:{},externalService:{default:null}},setup(k){const e=k,y=J(),{t:m}=F(),S=h(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.networking.address:e.service.addressPort??null),T=h(()=>{var v;return e.service.serviceType==="external"&&e.externalService!==null?(v=e.externalService.networking.tls)!=null&&v.enabled?"Enabled":"Disabled":null}),a=h(()=>e.service.serviceType==="external"?null:e.service.dataplanes??null),n=h(()=>e.service.serviceType==="external"?null:e.service.status??null),x=h(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.tags:null);async function b(v){if(e.service.serviceType==="external"&&e.externalService!==null){const{mesh:_,name:d}=e.externalService;return await y.getExternalService({mesh:_,name:d},v)}else{const{mesh:_,name:d}=e.service;return await y.getServiceInsight({mesh:_,name:d},v)}}return(v,_)=>{const d=R("RouterLink");return s(),V("div",te,[l(u(L),null,{body:r(()=>[A("div",se,[n.value!==null?(s(),i(g,{key:0},{title:r(()=>[t(p(u(m)("http.api.property.status")),1)]),body:r(()=>[l(O,{status:n.value},null,8,["status"])]),_:1})):f("",!0),t(),l(g,null,{title:r(()=>[t(p(u(m)("http.api.property.name")),1)]),body:r(()=>[l(Y,{text:e.service.name},{default:r(()=>[l(d,{to:{name:"service-detail-view",params:{service:e.service.name,mesh:e.service.mesh}}},{default:r(()=>[t(p(e.service.name),1)]),_:1},8,["to"])]),_:1},8,["text"])]),_:1}),t(),S.value!==null?(s(),i(g,{key:1},{title:r(()=>[t(p(u(m)("http.api.property.address")),1)]),body:r(()=>[t(p(S.value),1)]),_:1})):f("",!0),t(),T.value!==null?(s(),i(g,{key:2},{title:r(()=>[t(p(u(m)("http.api.property.tls")),1)]),body:r(()=>[t(p(T.value),1)]),_:1})):f("",!0),t(),a.value!==null?(s(),i(j,{key:3,online:a.value.online??0,total:a.value.total??0},{title:r(()=>[t(p(u(m)("http.api.property.dataPlaneProxies")),1)]),_:1},8,["online","total"])):f("",!0),t(),x.value!==null?(s(),i(g,{key:4},{title:r(()=>[t(p(u(m)("http.api.property.tags")),1)]),body:r(()=>[l(X,{tags:x.value},null,8,["tags"])]),_:1})):f("",!0)])]),_:1}),t(),l(U,{id:"code-block-service",resource:e.service,"resource-fetcher":b,"is-searchable":"","show-copy-as-kubernetes-button":e.service.serviceType==="external"&&e.externalService!==null,"code-max-height":"250px"},null,8,["resource","show-copy-as-kubernetes-button"])])}}}),ae=z({__name:"ServiceDetailView",props:{page:{},size:{},search:{},query:{},gatewayType:{},mesh:{},service:{}},setup(k){const e=k,{t:y}=F(),m=[{hash:"#overview",title:y("services.routes.item.tabs.overview")},{hash:"#dataPlaneProxies",title:y("services.routes.item.tabs.data_plane_proxies")}];return(S,T)=>(s(),i(M,{name:"service-detail-view","data-testid":"service-detail-view"},{default:r(({route:a})=>[l(H,{breadcrumbs:[{to:{name:"services-list-view",params:{mesh:a.params.mesh}},text:u(y)("services.routes.item.breadcrumbs")}]},{title:r(()=>[A("h2",null,[l(Z,{title:u(y)("services.routes.item.title",{name:a.params.service}),render:!0},null,8,["title"])])]),default:r(()=>[t(),l($,{src:`/meshes/${a.params.mesh}/service-insights/${a.params.service}`},{default:r(({data:n,isLoading:x,error:b})=>[x?(s(),i(B,{key:0})):b?(s(),i(C,{key:1,error:b},null,8,["error"])):n===void 0?(s(),i(P,{key:2})):(s(),i($,{key:3,"should-make-request":n.serviceType==="external",src:`/meshes/${a.params.mesh}/external-services/${a.params.service}`},{default:r(({data:v,isLoading:_,error:d})=>[n.serviceType==="external"&&_?(s(),i(B,{key:0})):n.serviceType==="external"&&d?(s(),i(C,{key:1,error:d},null,8,["error"])):n.serviceType==="external"&&v===void 0?(s(),i(P,{key:2})):(s(),i(re,{key:3,tabs:m.filter(c=>c.hash==="#overview"?!0:n.serviceType!=="external")},I({overview:r(()=>[l(ie,{service:n,"external-service":v},null,8,["service","external-service"])]),_:2},[(n==null?void 0:n.serviceType)!=="external"?{name:"dataPlaneProxies",fn:r(()=>[l($,{src:`/meshes/${a.params.mesh}/dataplanes/for/${a.params.service}/of/${e.gatewayType}?page=${e.page}&size=${e.size}&search=${e.search}`},{default:r(({data:c,error:N})=>{var q;return[(s(!0),V(K,null,W([typeof((q=c==null?void 0:c.items)==null?void 0:q[0].dataplane.networking.gateway)>"u"],w=>(s(),i(u(L),{key:w},{body:r(()=>[l(D,{"data-testid":"data-plane-collection",class:"data-plane-collection","page-number":e.page,"page-size":e.size,total:c==null?void 0:c.total,items:c==null?void 0:c.items,error:N,gateways:w,onChange:({page:o,size:E})=>{a.update({page:String(o),size:String(E)})}},{toolbar:r(()=>[l(ee,{class:"data-plane-proxy-filter",placeholder:"tag: 'kuma.io/protocol: http'",query:e.query,fields:{name:{description:"filter by name or parts of a name"},protocol:{description:"filter by “kuma.io/protocol” value"},tag:{description:"filter by tags (e.g. “tag: version:2”)"},zone:{description:"filter by “kuma.io/zone” value"}},onFieldsChange:o=>a.update({query:o.query,s:o.query.length>0?JSON.stringify(o.fields):""})},null,8,["placeholder","query","fields","onFieldsChange"]),t(),w?(s(),i(u(G),{key:0,label:"Type","overlay-label":!0,items:[{label:"All",value:"all"},{label:"Builtin",value:"builtin"},{label:"Delegated",value:"delegated"}].map(o=>({...o,selected:o.value===e.gatewayType})),appearance:"select",onSelected:o=>a.update({gatewayType:String(o.value)})},{"item-template":r(({item:o})=>[t(p(o.label),1)]),_:2},1032,["items","onSelected"])):f("",!0)]),_:2},1032,["page-number","page-size","total","items","error","gateways","onChange"])]),_:2},1024))),128))]}),_:2},1032,["src"])]),key:"0"}:void 0]),1032,["tabs"]))]),_:2},1032,["should-make-request","src"]))]),_:2},1032,["src"])]),_:2},1032,["breadcrumbs"])]),_:1}))}});const ge=Q(ae,[["__scopeId","data-v-d18c1836"]]);export{ge as default};
