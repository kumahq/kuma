import{d as x,r as M,o as t,g as d,w as i,j as a,F as y,G as B,m as $,h as u,l,D as v,i as N,W,q as w,k as q,f as I,L as K,A as Q,C as U,a5 as X,p as S,E as D,s as Z,_ as V}from"./index-cf0727dc.js";import{A as G,a as J}from"./AccordionList-6ce6736a.js";import{_ as Y}from"./CodeBlock.vue_vue_type_style_index_0_lang-ca4abdee.js";import{P as z}from"./PolicyTypeTag-b78066df.js";import{T as j}from"./TagList-ae0077fe.js";import{t as H}from"./toYaml-4e00099e.js";const ee={class:"policy-type-heading"},te={class:"policy-list"},se={key:0},ne=x({__name:"PolicyTypeEntryList",props:{id:{type:String,required:!1,default:"entry-list"},policyTypeEntries:{type:Object,required:!0}},setup(E){const _=E,P=[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}];function T({headerKey:m}){return{class:`cell-${m}`}}return(m,C)=>{const b=M("router-link");return t(),d(J,{"initially-open":[],"multiple-open":""},{default:i(()=>[(t(!0),a(y,null,B(_.policyTypeEntries,(r,n)=>(t(),d(G,{key:n},{"accordion-header":i(()=>[$("h3",ee,[u(z,{"policy-type":r.type},{default:i(()=>[l(v(r.type)+" ("+v(r.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":i(()=>[$("div",te,[u(N(W),{class:"policy-type-table",fetcher:()=>({data:r.connections,total:r.connections.length}),headers:P,"cell-attrs":T,"disable-pagination":"","is-clickable":""},{sourceTags:i(({rowValue:e})=>[e.length>0?(t(),d(j,{key:0,class:"tag-list",tags:e},null,8,["tags"])):(t(),a(y,{key:1},[l(`
                —
              `)],64))]),destinationTags:i(({rowValue:e})=>[e.length>0?(t(),d(j,{key:0,class:"tag-list",tags:e},null,8,["tags"])):(t(),a(y,{key:1},[l(`
                —
              `)],64))]),name:i(({rowValue:e})=>[e!==null?(t(),a(y,{key:0},[l(v(e),1)],64)):(t(),a(y,{key:1},[l(`
                —
              `)],64))]),origins:i(({rowValue:e})=>[e.length>0?(t(),a("ul",se,[(t(!0),a(y,null,B(e,(o,s)=>(t(),a("li",{key:`${n}-${s}`},[u(b,{to:o.route},{default:i(()=>[l(v(o.name),1)]),_:2},1032,["to"])]))),128))])):(t(),a(y,{key:1},[l(`
                —
              `)],64))]),config:i(({rowValue:e,rowKey:o})=>[e!==null?(t(),d(Y,{key:0,id:`${_.id}-${n}-${o}-code-block`,code:e,language:"yaml","show-copy-button":!1},null,8,["id","code"])):(t(),a(y,{key:1},[l(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}});const oe=w(ne,[["__scopeId","data-v-9a1971d5"]]),ae={class:"policy-type-heading"},ie={class:"policy-list"},le={key:1,class:"tag-list-wrapper"},ce={key:0},re={key:1},pe={key:0},ye={key:0},ue=x({__name:"RuleEntryList",props:{id:{type:String,required:!1,default:"entry-list"},ruleEntries:{type:Object,required:!0}},setup(E){const _=E,P=[{label:"Type",key:"type"},{label:"Addresses",key:"addresses"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}];function T({headerKey:m}){return{class:`cell-${m}`}}return(m,C)=>{const b=M("router-link");return t(),d(J,{"initially-open":[],"multiple-open":""},{default:i(()=>[(t(!0),a(y,null,B(_.ruleEntries,(r,n)=>(t(),d(G,{key:n},{"accordion-header":i(()=>[$("h3",ae,[u(z,{"policy-type":r.type},{default:i(()=>[l(v(r.type)+" ("+v(r.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":i(()=>[$("div",ie,[u(N(W),{class:"policy-type-table",fetcher:()=>({data:r.connections,total:r.connections.length}),headers:P,"cell-attrs":T,"disable-pagination":"","is-clickable":""},{type:i(({rowValue:e})=>[e.sourceTags.length===0&&e.destinationTags.length===0?(t(),a(y,{key:0},[l(`
                —
              `)],64)):(t(),a("div",le,[e.sourceTags.length>0?(t(),a("div",ce,[l(`
                  From

                  `),u(j,{class:"tag-list",tags:e.sourceTags},null,8,["tags"])])):q("",!0),l(),e.destinationTags.length>0?(t(),a("div",re,[l(`
                  To

                  `),u(j,{class:"tag-list",tags:e.destinationTags},null,8,["tags"])])):q("",!0)]))]),addresses:i(({rowValue:e})=>[e.length>0?(t(),a("ul",pe,[(t(!0),a(y,null,B(e,(o,s)=>(t(),a("li",{key:`${n}-${s}`},v(o),1))),128))])):(t(),a(y,{key:1},[l(`
                —
              `)],64))]),origins:i(({rowValue:e})=>[e.length>0?(t(),a("ul",ye,[(t(!0),a(y,null,B(e,(o,s)=>(t(),a("li",{key:`${n}-${s}`},[u(b,{to:o.route},{default:i(()=>[l(v(o.name),1)]),_:2},1032,["to"])]))),128))])):(t(),a(y,{key:1},[l(`
                —
              `)],64))]),config:i(({rowValue:e,rowKey:o})=>[e!==null?(t(),d(Y,{key:0,id:`${_.id}-${n}-${o}-code-block`,code:e,language:"yaml","show-copy-button":!1},null,8,["id","code"])):(t(),a(y,{key:1},[l(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}});const de=w(ue,[["__scopeId","data-v-3e59037c"]]),_e=$("h2",{class:"visually-hidden"},`
    Policies
  `,-1),me={key:0,class:"mt-2"},ge=$("h2",{class:"mb-2"},`
      Rules
    `,-1),fe=x({__name:"SidecarDataplanePolicyList",props:{sidecarDataplanes:{},rules:{},policyTypesByName:{}},setup(E){const _=E,P=I(()=>m(_.sidecarDataplanes)),T=I(()=>b(_.rules));function m(n){const e=new Map;for(const s of n){const{type:c,service:g}=s,f=typeof g=="string"&&g!==""?[{label:"kuma.io/service",value:g}]:[],h=c==="inbound"||c==="outbound"?s.name:null;for(const[p,L]of Object.entries(s.matchedPolicies)){e.has(p)||e.set(p,{type:p,connections:[]});const A=e.get(p),O=_.policyTypesByName[p];for(const F of L){const k=C(F,O,s,f,h);A.connections.push(...k)}}}const o=Array.from(e.values());return o.sort((s,c)=>s.type.localeCompare(c.type)),o}function C(n,e,o,s,c){const g=n.conf&&Object.keys(n.conf).length>0?H(n.conf):null,h=[{name:n.name,route:{name:"policy-detail-view",params:{mesh:n.mesh,policyPath:e.path,policy:n.name}}}],p=[];if(o.type==="inbound"&&Array.isArray(n.sources))for(const{match:L}of n.sources){const O={sourceTags:[{label:"kuma.io/service",value:L["kuma.io/service"]}],destinationTags:s,name:c,config:g,origins:h};p.push(O)}else{const A={sourceTags:[],destinationTags:s,name:c,config:g,origins:h};p.push(A)}return p}function b(n){const e=new Map;for(const s of n){e.has(s.policyType)||e.set(s.policyType,{type:s.policyType,connections:[]});const c=e.get(s.policyType),g=_.policyTypesByName[s.policyType],f=r(s,g);c.connections.push(...f)}const o=Array.from(e.values());return o.sort((s,c)=>s.type.localeCompare(c.type)),o}function r(n,e){const{type:o,service:s,subset:c,conf:g}=n,f=c?Object.entries(c):[];let h,p;o==="ClientSubset"?f.length>0?h=f.map(([k,R])=>({label:k,value:R})):h=[{label:"kuma.io/service",value:"*"}]:h=[],o==="DestinationSubset"?f.length>0?p=f.map(([k,R])=>({label:k,value:R})):typeof s=="string"&&s!==""?p=[{label:"kuma.io/service",value:s}]:p=[{label:"kuma.io/service",value:"*"}]:o==="ClientSubset"&&typeof s=="string"&&s!==""?p=[{label:"kuma.io/service",value:s}]:p=[];const L=n.addresses??[],A=g&&Object.keys(g).length>0?H(g):null,O=[];for(const k of n.origins)O.push({name:k.name,route:{name:"policy-detail-view",params:{mesh:k.mesh,policyPath:e.path,policy:k.name}}});return[{type:{sourceTags:h,destinationTags:p},addresses:L,config:A,origins:O}]}return(n,e)=>(t(),a(y,null,[_e,l(),u(oe,{id:"policies","policy-type-entries":P.value,"data-testid":"policy-list"},null,8,["policy-type-entries"]),l(),T.value.length>0?(t(),a("div",me,[ge,l(),u(de,{id:"rules","rule-entries":T.value,"data-testid":"rule-list"},null,8,["rule-entries"])])):q("",!0)],64))}}),Ee=x({__name:"DataPlanePoliciesView",setup(E){const{t:_}=K();return(P,T)=>(t(),d(V,{name:"data-plane-policies-view","data-testid":"data-plane-policies-view"},{default:i(({route:m})=>[u(Q,null,{title:i(()=>[$("h2",null,[u(U,{title:N(_)("data-planes.routes.item.navigation.data-plane-policies-view"),render:!0},null,8,["title"])])]),default:i(()=>[l(),u(N(X),null,{body:i(()=>[u(S,{src:"/*/policy-types"},{default:i(({data:C,error:b})=>[u(S,{src:`/meshes/${m.params.mesh}/dataplanes/${m.params.dataPlane}/sidecar-dataplanes-policies`},{default:i(({data:r,error:n})=>[u(S,{src:`/meshes/${m.params.mesh}/dataplanes/${m.params.dataPlane}/rules`},{default:i(({data:e,error:o})=>[b?(t(),d(D,{key:0,error:b},null,8,["error"])):n?(t(),d(D,{key:1,error:n},null,8,["error"])):o?(t(),d(D,{key:2,error:o},null,8,["error"])):C===void 0||r===void 0||e===void 0?(t(),d(Z,{key:3})):(t(),d(fe,{key:4,"policy-types-by-name":C.policies.reduce((s,c)=>Object.assign(s,{[c.name]:c}),{}),"sidecar-dataplanes":r.items,rules:e.items},null,8,["policy-types-by-name","sidecar-dataplanes","rules"]))]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}))}});export{Ee as default};
