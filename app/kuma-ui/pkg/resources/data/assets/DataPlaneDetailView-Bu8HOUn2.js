import{d as et,a2 as nt,v as ot,r as f,p as u,o,w as a,b as n,c as p,e,L as y,M as b,q as g,l as i,t as d,T as st,m as X,F as it,$ as dt,a3 as lt,a4 as j,y as rt,_ as pt}from"./index-szMgaLoV.js";import{T as ut}from"./TagList-DKzy1oZ7.js";import{C as K,a as F,b as P}from"./ConnectionTraffic-BLWWfeZm.js";const mt={key:0},ft={key:1},yt={key:2},kt={key:0},vt={key:1},gt={key:2},ct=et({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(M){const U=nt(),s=M,$=ot();return(bt,t)=>{const R=f("XI18n"),N=f("XNotification"),B=f("XIcon"),G=f("DataCollection"),k=f("XLayout"),_=f("XAction"),c=f("XBadge"),Z=f("XCopyButton"),V=f("XDl"),S=f("DataSource"),H=f("XAboutCard"),J=f("XEmptyState"),Q=f("DataLoader"),W=f("XCard"),Y=f("XDrawer"),L=f("RouterView"),h=f("AppView"),tt=f("RouteView");return o(),u(tt,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:""},name:"data-plane-detail-view"},{default:a(({route:m,t:r,can:E,uri:q})=>[n(h,{notifications:!0},{default:a(()=>[(o(!0),p(y,null,b([{bool:s.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:s.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:s.data.dataplaneInsight.version?.envoy.version??"",kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!(E("use zones")&&s.data.zone&&s.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:s.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:s.data.isCertExpired,key:"certificate-expired"},{bool:!s.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:s.data.dataplane.networking.gateway?.type!=="BUILTIN"&&!E("use transparent-proxying",s.data),key:"networking-transparent-proxying",variant:"info"}],({bool:l,key:v,params:T,variant:D})=>(o(),u(N,{key:v,notify:l,"data-testid":`warning-${v}`,uri:`data-planes.notifications.${v}.${s.data.id}`,variant:D},{default:a(()=>[n(R,{path:`data-planes.notifications.${v}`,params:Object.fromEntries(Object.entries(T??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),t[52]||(t[52]=e()),n(k,{type:"stack","data-testid":"dataplane-details"},{default:a(()=>[n(H,{title:r("data-planes.routes.item.about.title"),created:s.data.creationTime,modified:s.data.modificationTime,class:"about-section"},{default:a(()=>[n(k,null,{default:a(()=>[n(V,{variant:"x-stack"},{default:a(()=>[i("div",null,[i("dt",null,d(r("http.api.property.status")),1),t[2]||(t[2]=e()),i("dd",null,[n(k,{type:"separated"},{default:a(()=>[n(st,{status:s.data.status},null,8,["status"]),t[1]||(t[1]=e()),n(G,{items:s.data.dataplane.networking.inbounds,predicate:l=>l.state!=="Ready",empty:!1},{default:a(({items:l})=>[n(B,{name:"info"},{default:a(()=>[i("ul",null,[(o(!0),p(y,null,b(l,v=>(o(),p("li",{key:`${v.service}:${v.port}`},d(r("data-planes.routes.item.unhealthy_inbound",{port:v.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1024)])]),t[8]||(t[8]=e()),E("use zones")&&s.data.zone?(o(),p("div",mt,[i("dt",null,d(r("http.api.property.zone")),1),t[3]||(t[3]=e()),i("dd",null,[n(c,{appearance:"decorative"},{default:a(()=>[n(_,{to:{name:"zone-cp-detail-view",params:{zone:s.data.zone}}},{default:a(()=>[e(d(s.data.zone),1)]),_:1},8,["to"])]),_:1})])])):g("",!0),t[9]||(t[9]=e()),i("div",null,[i("dt",null,d(r("http.api.property.type")),1),t[4]||(t[4]=e()),i("dd",null,[n(c,{appearance:"decorative"},{default:a(()=>[e(d(r(`data-planes.type.${s.data.dataplaneType}`)),1)]),_:2},1024)])]),t[10]||(t[10]=e()),s.data.namespace.length>0?(o(),p("div",ft,[i("dt",null,d(r("http.api.property.namespace")),1),t[5]||(t[5]=e()),i("dd",null,[n(c,{appearance:"decorative"},{default:a(()=>[e(d(s.data.namespace),1)]),_:1})])])):g("",!0),t[11]||(t[11]=e()),i("div",null,[i("dt",null,d(r("http.api.property.address")),1),t[6]||(t[6]=e()),i("dd",null,[n(Z,{variant:"badge",format:"default",text:`${s.data.dataplane.networking.address}`},null,8,["text"])])]),t[12]||(t[12]=e()),s.data.dataplane.networking.gateway?(o(),p("div",yt,[i("dt",null,d(r("http.api.property.tags")),1),t[7]||(t[7]=e()),i("dd",null,[n(ut,{tags:s.data.dataplane.networking.gateway.tags},null,8,["tags"])])])):g("",!0)]),_:2},1024),t[31]||(t[31]=e()),s.data.dataplaneInsight.mTLS?(o(),u(k,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:a(()=>[i("h3",null,d(r("data-planes.routes.item.mtls.title")),1),t[22]||(t[22]=e()),n(k,{size:"small"},{default:a(()=>[(o(!0),p(y,null,b([s.data.dataplaneInsight.mTLS],l=>(o(),p(y,{key:typeof l},[typeof l.lastCertificateRegeneration<"u"&&typeof l.certificateExpirationTime<"u"&&typeof l.issuedBackend<"u"?(o(),u(V,{key:0,variant:"x-stack"},{default:a(()=>[i("div",null,[i("dt",null,d(r("data-planes.routes.item.mtls.generation_time.title")),1),t[13]||(t[13]=e()),i("dd",null,[n(c,{appearance:"neutral"},{default:a(()=>[e(d(r("common.formats.datetime",{value:Date.parse(l.lastCertificateRegeneration)})),1)]),_:2},1024)])]),t[15]||(t[15]=e()),i("div",null,[i("dt",null,d(r("data-planes.routes.item.mtls.expiration_time.title")),1),t[14]||(t[14]=e()),i("dd",null,[n(c,{appearance:"neutral"},{default:a(()=>[e(d(r("common.formats.datetime",{value:Date.parse(l.certificateExpirationTime)})),1)]),_:2},1024)])])]),_:2},1024)):(o(),u(R,{key:1,path:"data-planes.routes.item.mtls.managed_externally"})),t[21]||(t[21]=e()),n(V,{variant:"x-stack"},{default:a(()=>[typeof l.certificateRegenerations<"u"?(o(),p("div",kt,[i("dt",null,d(r("data-planes.routes.item.mtls.regenerations.title")),1),t[16]||(t[16]=e()),i("dd",null,[n(c,{appearance:"info"},{default:a(()=>[e(d(r("common.formats.integer",{value:l.certificateRegenerations})),1)]),_:2},1024)])])):g("",!0),t[19]||(t[19]=e()),typeof l.issuedBackend<"u"?(o(),p("div",vt,[i("dt",null,d(r("data-planes.routes.item.mtls.issued_backend.title")),1),t[17]||(t[17]=e()),i("dd",null,[n(c,{appearance:"decorative"},{default:a(()=>[e(d(l.issuedBackend),1)]),_:2},1024)])])):g("",!0),t[20]||(t[20]=e()),typeof l.supportedBackends<"u"?(o(),p("div",gt,[i("dt",null,d(r("data-planes.routes.item.mtls.supported_backends.title")),1),t[18]||(t[18]=e()),i("dd",null,[n(k,{type:"separated",truncate:""},{default:a(()=>[(o(!0),p(y,null,b(l.supportedBackends,v=>(o(),u(c,{key:v,appearance:v===l.issuedBackend?"decorative":"info"},{default:a(()=>[e(d(v),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)])])):g("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):g("",!0),t[32]||(t[32]=e()),s.data.dataplaneInsight.subscriptions.length>0?(o(),u(k,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:a(()=>[n(k,{type:"separated"},{default:a(()=>[i("h3",null,d(r("data-planes.routes.item.subscriptions.title")),1),t[23]||(t[23]=e()),n(_,{appearance:"anchor",to:{name:"data-plane-subscriptions-list-view",params:{mesh:m.params.mesh,proxy:m.params.proxy},query:{inactive:m.params.inactive}}},{default:a(()=>[e(`
                  (`+d(r("data-planes.routes.item.xds.show-details"))+`)
                `,1)]),_:2},1032,["to"])]),_:2},1024),t[29]||(t[29]=e()),s.data.dataplaneInsight.connectedSubscription?(o(),u(V,{key:0,variant:"x-stack"},{default:a(()=>[i("div",null,[i("dt",null,d(r("data-planes.routes.item.xds.connected")),1),t[24]||(t[24]=e()),i("dd",null,[n(c,{appearance:"neutral"},{default:a(()=>[e(d(r("common.formats.datetime",{value:Date.parse(s.data.dataplaneInsight.connectedSubscription.connectTime??"")})),1)]),_:2},1024)])]),t[27]||(t[27]=e()),i("div",null,[i("dt",null,d(r("data-planes.routes.item.xds.instance")),1),t[25]||(t[25]=e()),i("dd",null,[n(c,null,{default:a(()=>[e(d(s.data.dataplaneInsight.connectedSubscription.controlPlaneInstanceId),1)]),_:1})])]),t[28]||(t[28]=e()),i("div",null,[i("dt",null,d(r("data-planes.routes.item.xds.version")),1),t[26]||(t[26]=e()),i("dd",null,[n(c,null,{default:a(()=>[e(d(s.data.dataplaneInsight.connectedSubscription.version?.kumaDp?.version??r("common.unknown")),1)]),_:2},1024)])])]),_:2},1024)):(o(),u(R,{key:1,path:"data-planes.routes.item.xds.disconnected"}))]),_:2},1024)):g("",!0),t[33]||(t[33]=e()),E("use unified-resource-naming",{mesh:s.mesh,dataplaneOverview:s.data})?(o(),u(S,{key:2,src:q(X(it),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:m.params.mesh,name:m.params.proxy}),onChange:t[0]||(t[0]=l=>$.value=l)},{default:a(()=>[$.value?.policies.length?(o(),u(k,{key:0,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:a(()=>[i("h3",null,d(r("data-planes.routes.item.policies")),1),t[30]||(t[30]=e()),n(k,{type:"separated"},{default:a(()=>[(o(!0),p(y,null,b($.value?.policies,l=>(o(),u(_,{key:l.kind,to:{name:"data-plane-policy-config-summary-view",params:{mesh:m.params.mesh,proxy:m.params.proxy,policy:l.kind.toLowerCase()}}},{default:a(()=>[n(c,null,{default:a(()=>[e(d(l.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2},1024)):g("",!0)]),_:2},1032,["src"])):g("",!0)]),_:2},1024)]),_:2},1032,["title","created","modified"]),t[51]||(t[51]=e()),n(S,{src:q(X(dt),"/meshes/:mesh/dataplanes/:name/layout",{mesh:m.params.mesh,name:m.params.proxy})},{default:a(({data:l,refresh:v,error:T})=>[n(S,{src:q(X(lt),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[m.params.proxyType]??"dataplane",name:m.params.proxy,mesh:m.params.mesh||"*",socketAddress:"self_inbound"})},{default:a(({data:D,error:O,refresh:at})=>[n(N,{notify:!!O,"data-testid":"warning-stats-not-enhanced",uri:`data-planes.notifications.stats-not-enhanced.${s.data.id}`},{default:a(()=>[n(R,{path:"data-planes.notifications.stats-not-enhanced",params:{error:O?.toString()??""}},null,8,["params"])]),_:2},1032,["notify","uri"]),t[49]||(t[49]=e()),n(W,{class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[n(Q,{data:[l,D]},{default:a(()=>[n(k,{type:"columns"},{default:a(()=>[n(K,null,{title:a(()=>[n(k,{type:"separated"},{default:a(()=>[n(B,{name:"inbound"}),t[34]||(t[34]=e()),t[35]||(t[35]=i("span",null,"Inbounds",-1))]),_:1})]),default:a(()=>[t[38]||(t[38]=e()),(o(!0),p(y,null,b([Object.groupBy(s.data.dataplane.networking.inbounds,w=>w.port)],(w,C)=>(o(),p(y,{key:C},[(o(!0),p(y,null,b([l.inbounds],x=>(o(),u(F,{key:typeof x,type:"inbound","data-testid":"dataplane-inbounds"},{default:a(()=>[n(k,{type:"stack",size:"small"},{default:a(()=>[(o(!0),p(y,null,b(x,I=>(o(),p(y,{key:`${I.kri}`},[(o(!0),p(y,null,b([w[I.port]?.[0]],A=>(o(),u(P,{key:A?.port,"data-testid":"dataplane-inbound",protocol:I.protocol,"port-name":A?.portName,traffic:D?.inbounds[I.stat_prefix],"data-actionable":""},{state:a(()=>[A?.state!=="Ready"?(o(),u(B,{key:0,name:"danger",size:X(j),placement:"right"},{default:a(()=>[e(d(r("data-planes.routes.item.unhealthy_inbound",{port:A?.port})),1)]),_:2},1032,["size"])):(o(!0),p(y,{key:1},b([D?.inbounds[I.stat_prefix]?.$meta.alerts.reports??[]],z=>(o(),p(y,{key:typeof z},[n(N,{notify:z.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${s.data.id}`},{default:a(()=>[n(R,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[36]||(t[36]=e()),z.length?(o(),u(_,{key:0,"data-action":"",to:{name:"data-plane-connection-inbound-summary-stats-view",params:{connection:I.stat_prefix},query:{codeSearch:z.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:a(()=>[n(B,{name:"warning",size:X(j),placement:"right"},null,8,["size"])]),_:1},8,["to"])):g("",!0)],64))),128))]),default:a(()=>[t[37]||(t[37]=e()),n(_,{"data-action":"",to:{name:(z=>z.includes("bound")?z.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(X(U).name)),params:{connection:I.proxyResourceName},query:{inactive:m.params.inactive}}},{default:a(()=>[e(d(I.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:2},1024),t[48]||(t[48]=e()),n(K,null,{actions:a(()=>[n(_,{action:"refresh",appearance:"primary",onClick:()=>{v(),at()}},{default:a(()=>[...t[39]||(t[39]=[e(`
                        Refresh
                      `,-1)])]),_:1},8,["onClick"])]),title:a(()=>[n(k,{type:"separated"},{default:a(()=>[n(B,{name:"outbound"}),t[40]||(t[40]=e()),t[41]||(t[41]=i("span",null,"Outbounds",-1))]),_:1})]),default:a(()=>[t[46]||(t[46]=e()),t[47]||(t[47]=e()),typeof T>"u"&&typeof O>"u"&&l?.outbounds.length?(o(),p(y,{key:0},[n(F,{type:"passthrough"},{default:a(()=>[n(P,{protocol:"passthrough",traffic:D?.passthrough},{default:a(()=>[...t[42]||(t[42]=[e(`
                          Non mesh traffic
                        `,-1)])]),_:1},8,["traffic"])]),_:2},1024),t[45]||(t[45]=e()),n(G,{type:"outbounds",items:l?.outbounds},{default:a(({items:w})=>[n(F,{type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[n(k,{type:"stack",size:"small"},{default:a(()=>[(o(!0),p(y,null,b(w,C=>(o(),u(P,{key:C.kri,"data-testid":"dataplane-outbound",protocol:C.protocol,traffic:D?.outbounds[C.kri],"data-actionable":""},{state:a(()=>[(o(!0),p(y,null,b([D?.outbounds[C.proxyResourceName]?.$meta.alerts.reports??[]],x=>(o(),p(y,{key:typeof x},[n(N,{notify:x.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${s.data.id}`},{default:a(()=>[n(R,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[43]||(t[43]=e()),x.length?(o(),u(_,{key:0,"data-action":"",to:{name:"data-plane-connection-outbound-summary-stats-view",params:{connection:C.proxyResourceName},query:{codeSearch:x.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:a(()=>[n(B,{name:"warning",size:X(j),placement:"right"},null,8,["size"])]),_:1},8,["to"])):g("",!0)],64))),128))]),default:a(()=>[t[44]||(t[44]=e()),n(_,{"data-action":"",to:{name:(x=>x.includes("bound")?x.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(X(U).name)),params:{connection:C.proxyResourceName},query:{inactive:m.params.inactive}}},{default:a(()=>[e(d(C.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(o(),u(J,{key:1}))]),_:2},1024)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1024),t[50]||(t[50]=e()),n(L,null,{default:a(w=>[w.route.name!==m.name?(o(),u(Y,{key:0,width:"670px",onClose:()=>{m.replace({name:"data-plane-detail-view",params:{mesh:m.params.mesh,proxy:m.params.proxy},query:{inactive:m.params.inactive?null:void 0}})}},{default:a(()=>[(o(),u(rt(w.Component),{data:w.route.name.includes("-inbound-")?l?.inbounds:l?.outbounds,"data-plane-overview":s.data,networking:s.data.dataplane.networking,policies:$.value?.policies},null,8,["data","data-plane-overview","networking","policies"]))]),_:2},1032,["onClose"])):g("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1024)]),_:2},1024)]),_:1})}}}),_t=pt(ct,[["__scopeId","data-v-1bc9e1c7"]]);export{_t as default};
