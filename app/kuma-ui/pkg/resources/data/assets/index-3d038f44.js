function g(e=[]){return e.length>0&&[e[e.length-1]].every(t=>{var a;return((a=t.connectTime)==null?void 0:a.length)&&!t.disconnectTime})}function d(e){var o;const t=((o=e.dataplaneInsight)==null?void 0:o.subscriptions)??[];return t.length===0?void 0:t[t.length-1].status.lastUpdateTime}function f(e){var s;const t=g((s=e.dataplaneInsight)==null?void 0:s.subscriptions);if(e.dataplane.networking.gateway)return{status:t?"online":"offline",reason:[]};const a=e.dataplane.networking.inbound??[],o=a.filter(n=>n.health&&!n.health.ready).map(n=>`Inbound on port ${n.port} is not ready (kuma.io/service: ${n.tags["kuma.io/service"]})`);let i;switch(!0){case o.length===a.length:i="offline";break;case o.length>0:i="partially_degraded";break;default:i=t?"online":"offline"}return{status:i,reason:o}}function m(e){let t=[];const a="=",{gateway:o,inbound:i}=e.dataplane.networking;i&&(t=i.flatMap(n=>Object.entries(n.tags)).map(([n,r])=>`${n}${a}${r}`)),o&&(t=Object.entries(o.tags).map(([n,r])=>`${n}${a}${r}`));const s=Array.from(new Set(t));return s.sort((n,r)=>n.localeCompare(r)),s.map(n=>{const[r,u]=n.split(a);return{label:r,value:u}})}function k(e){var a;const t=(a=e.dataplaneInsight)==null?void 0:a.mTLS;return t===void 0?!1:Date.now()>new Date(t.certificateExpirationTime).getTime()}function b(e,t){var n,r,u;const a=((n=e.dataplaneInsight)==null?void 0:n.subscriptions)??[];if(a.length===0)return[];const o=a[a.length-1];if(!("version"in o)||!o.version)return[];const i=[],s=o.version;return s.kumaDp&&s.envoy&&((((r=s.kumaDp)==null?void 0:r.kumaCpCompatible)??!0)||i.push({kind:"INCOMPATIBLE_UNSUPPORTED_KUMA_DP",payload:{kumaDp:s.kumaDp.version}}),(((u=s.envoy)==null?void 0:u.kumaDpCompatible)??!0)||i.push({kind:"INCOMPATIBLE_UNSUPPORTED_ENVOY",payload:{envoy:s.envoy.version,kumaDp:s.kumaDp.version}})),t&&m(e).find(c=>c.label==="kuma.io/zone")&&typeof s.kumaDp.kumaCpCompatible=="boolean"&&!s.kumaDp.kumaCpCompatible&&i.push({kind:"INCOMPATIBLE_ZONE_CP_AND_KUMA_DP_VERSIONS",payload:{kumaDp:s.kumaDp.version}}),i}function h(e){const{gateway:t}=e.dataplane.networking;return t?t.type?t.type.toLowerCase():"delegated":"standard"}export{d as a,b,k as c,h as d,m as e,f as g};
