import{d as G,O as H,D as X,r as d,o,m as g,w as e,b as i,k as C,e as s,l as D,z as P,P as O,c as _,F as y,t as r,p as b,A as Q,s as V,Q as W,S as j,E as J,q as U}from"./index-DxrN05KS.js";import{_ as Y}from"./DeleteResourceModal.vue_vue_type_script_setup_true_lang-C_P086zZ.js";import{S as ee}from"./SummaryView-jGgfzaaj.js";const ne=["innerHTML"],te=["data-testid"],oe=G({__name:"ZoneListView",setup(se){const T=H(),I=X({}),S=X({}),L=h=>{const w="zoneIngress";I.value=h.items.reduce((p,u)=>{var z;const l=(z=u[w])==null?void 0:z.zone;if(typeof l<"u"){typeof p[l]>"u"&&(p[l]={online:[],offline:[]});const k=typeof u[`${w}Insight`].connectedSubscription<"u"?"online":"offline";p[l][k].push(u)}return p},{})},R=h=>{const w="zoneEgress";S.value=h.items.reduce((p,u)=>{var z;const l=(z=u[w])==null?void 0:z.zone;if(typeof l<"u"){typeof p[l]>"u"&&(p[l]={online:[],offline:[]});const k=typeof u[`${w}Insight`].connectedSubscription<"u"?"online":"offline";p[l][k].push(u)}return p},{})};async function Z(h){await T.deleteZone({name:h})}return(h,w)=>{const p=d("RouteTitle"),u=d("DataSource"),l=d("XAction"),z=d("XTeleportTemplate"),k=d("XIcon"),$=d("XDisclosure"),B=d("XActionGroup"),E=d("KCard"),N=d("RouterView"),q=d("AppView"),K=d("RouteView");return o(),g(K,{name:"zone-cp-list-view",params:{page:1,size:50,zone:""}},{default:e(({route:c,t:a,can:v,uri:M,me:f})=>[i(q,{docs:a("zones.href.docs.cta")},{title:e(()=>[C("h1",null,[i(p,{title:a("zone-cps.routes.items.title")},null,8,["title"])])]),default:e(()=>[s(),i(u,{src:M(D(P),"/zone-cps",{},{page:c.params.page,size:c.params.size})},{default:e(({data:m,error:x,refresh:F})=>[i(u,{src:"/zone-ingress-overviews?page=1&size=100",onChange:L}),s(),i(u,{src:"/zone-egress-overviews?page=1&size=100",onChange:R}),s(),C("div",{innerHTML:a("zone-cps.routes.items.intro",{},{defaultMessage:""})},null,8,ne),s(),i(E,null,{default:e(()=>[x!==void 0?(o(),g(O,{key:0,error:x},null,8,["error"])):(o(),_(y,{key:1},[v("create zones")&&((m==null?void 0:m.items)??[]).length>0?(o(),g(z,{key:0,to:{name:"zone-cp-list-view-actions"}},{default:e(()=>[i(l,{type:"create",appearance:"primary",to:{name:"zone-create-view"},"data-testid":"create-zone-link"},{default:e(()=>[s(r(a("zones.index.create")),1)]),_:2},1024)]),_:2},1024)):b("",!0),s(),i(Q,{class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{...f.get("headers.type"),label:"Â ",key:"type"},{...f.get("headers.name"),label:"Name",key:"name"},{...f.get("headers.zoneCpVersion"),label:"Zone Leader CP Version",key:"zoneCpVersion"},{...f.get("headers.ingress"),label:"Ingresses (online / total)",key:"ingress"},{...f.get("headers.egress"),label:"Egresses (online / total)",key:"egress"},{...f.get("headers.state"),label:"Status",key:"state"},{...f.get("headers.warnings"),label:"Warnings",key:"warnings",hideLabel:!0},{...f.get("headers.actions"),label:"Actions",key:"actions",hideLabel:!0}],"page-number":c.params.page,"page-size":c.params.size,total:m==null?void 0:m.total,items:m==null?void 0:m.items,error:x,"empty-state-title":v("create zones")?a("zone-cps.empty_state.title"):void 0,"empty-state-message":v("create zones")?a("zone-cps.empty_state.message"):void 0,"empty-state-cta-to":v("create zones")?{name:"zone-create-view"}:void 0,"empty-state-cta-text":v("create zones")?a("zones.index.create"):void 0,"is-selected-row":n=>n.name===c.params.zone,onChange:c.update,onResize:f.set},{type:e(({row:n})=>[(o(!0),_(y,null,V([["kubernetes","universal"].find(t=>t===n.zoneInsight.environment)??"kubernetes"],t=>(o(),g(k,{key:t,name:t},{default:e(()=>[s(r(a(`common.product.environment.${t}`)),1)]),_:2},1032,["name"]))),128))]),name:e(({row:n})=>[i(l,{"data-action":"",to:{name:"zone-cp-detail-view",params:{zone:n.name},query:{page:c.params.page,size:c.params.size}}},{default:e(()=>[s(r(n.name),1)]),_:2},1032,["to"])]),zoneCpVersion:e(({row:n})=>[s(r(D(W)(n.zoneInsight,"version.kumaCp.version",a("common.collection.none"))),1)]),ingress:e(({row:n})=>[(o(!0),_(y,null,V([I.value[n.name]||{online:[],offline:[]}],t=>(o(),_(y,null,[s(r(t.online.length)+" / "+r(t.online.length+t.offline.length),1)],64))),256))]),egress:e(({row:n})=>[(o(!0),_(y,null,V([S.value[n.name]||{online:[],offline:[]}],t=>(o(),_(y,null,[s(r(t.online.length)+" / "+r(t.online.length+t.offline.length),1)],64))),256))]),state:e(({row:n})=>[i(j,{status:n.state},null,8,["status"])]),warnings:e(({row:n})=>[n.warnings.length>0?(o(),g(k,{key:0,name:"warning","data-testid":"warning"},{default:e(()=>[C("ul",null,[(o(!0),_(y,null,V(n.warnings,t=>(o(),_("li",{key:t.kind,"data-testid":`warning-${t.kind}`},r(a(`zone-cps.list.${t.kind}`)),9,te))),128))])]),_:2},1024)):(o(),_(y,{key:1},[s(r(a("common.collection.none")),1)],64))]),actions:e(({row:n})=>[i(B,null,{default:e(()=>[i($,null,{default:e(({expanded:t,toggle:A})=>[i(l,{to:{name:"zone-cp-detail-view",params:{zone:n.name}}},{default:e(()=>[s(r(a("common.collection.actions.view")),1)]),_:2},1032,["to"]),s(),v("create zones")?(o(),g(l,{key:0,appearance:"danger",onClick:A},{default:e(()=>[s(r(a("common.collection.actions.delete")),1)]),_:2},1032,["onClick"])):b("",!0),s(),i(z,{to:{name:"modal-layer"}},{default:e(()=>[t?(o(),g(Y,{key:0,"confirmation-text":n.name,"delete-function":()=>Z(n.name),"is-visible":"","action-button-text":a("common.delete_modal.proceed_button"),title:a("common.delete_modal.title",{type:"Zone"}),"data-testid":"delete-zone-modal",onCancel:A,onDelete:()=>{A(),F()}},{default:e(()=>[C("p",null,r(a("common.delete_modal.text1",{type:"Zone",name:n.name})),1),s(),C("p",null,r(a("common.delete_modal.text2")),1)]),_:2},1032,["confirmation-text","delete-function","action-button-text","title","onCancel","onDelete"])):b("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["headers","page-number","page-size","total","items","error","empty-state-title","empty-state-message","empty-state-cta-to","empty-state-cta-text","is-selected-row","onChange","onResize"])],64))]),_:2},1024),s(),c.params.zone?(o(),g(N,{key:0},{default:e(n=>[i(ee,{onClose:t=>c.replace({name:"zone-cp-list-view",query:{page:c.params.page,size:c.params.size}})},{default:e(()=>[(o(),g(J(n.Component),{name:c.params.zone,"zone-overview":m==null?void 0:m.items.find(t=>t.name===c.params.zone)},null,8,["name","zone-overview"]))]),_:2},1032,["onClose"])]),_:2},1024)):b("",!0)]),_:2},1032,["src"])]),_:2},1032,["docs"])]),_:1})}}}),ce=U(oe,[["__scopeId","data-v-60e724a6"]]);export{ce as default};
