import{A as G,a as M}from"./AccordionList-5bdc553d.js";import{d as S,a as k,o as e,c as s,m as o,f as a,F as r,C as $,t as i,e as _,w as l,p as B,b as n,X as D,s as H,v as X,_ as j,H as U,l as R,k as Y,n as W,O as A}from"./index-a842a987.js";import{C as q}from"./CodeBlock-5115e1e1.js";import{P as J}from"./PolicyTypeTag-b9619d1b.js";import{T as z}from"./TagList-49a5e521.js";import{t as Q}from"./toYaml-4e00099e.js";import{E as K}from"./ErrorBlock-bb22d425.js";import{_ as V}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-2d9106c6.js";import"./uniqueId-90cc9b93.js";import"./index-fce48c05.js";import"./TextWithCopyButton-a77a996b.js";import"./CopyButton-19f871c3.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-190e6f2a.js";const L=m=>(H("data-v-f3e7afbb"),m=m(),X(),m),Z={class:"policies-list"},E={class:"mesh-gateway-policy-list"},ee=L(()=>o("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),te={key:0},se=L(()=>o("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),ae=L(()=>o("b",null,"Host",-1)),le=L(()=>o("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),ne={class:"dataplane-policy-header"},oe=L(()=>o("b",null,"Route",-1)),ie=L(()=>o("b",null,"Service",-1)),ce={key:0,class:"badge-list"},re={class:"mt-1"},pe=S({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},policyTypesByName:{}},setup(m){const d=m;return(c,P)=>{const f=k("RouterLink"),h=k("KBadge");return e(),s("div",Z,[o("div",E,[ee,a(),c.gatewayDataplane.routePolicies.length>0?(e(),s("ul",te,[(e(!0),s(r,null,$(c.gatewayDataplane.routePolicies,(y,g)=>(e(),s("li",{key:g},[o("span",null,i(y.type),1),a(`:

          `),_(f,{to:{name:"policy-detail-view",params:{mesh:y.mesh,policyPath:d.policyTypesByName[y.type].path,policy:y.name}}},{default:l(()=>[a(i(y.name),1)]),_:2},1032,["to"])]))),128))])):B("",!0),a(),se,a(),o("div",null,[(e(!0),s(r,null,$(c.gatewayDataplane.listenerEntries,(y,g)=>(e(),s("div",{key:g},[o("div",null,[o("div",null,[ae,a(": "+i(y.hostName)+":"+i(y.port)+" ("+i(y.protocol)+`)
            `,1)]),a(),y.routeEntries.length>0?(e(),s(r,{key:0},[le,a(),_(M,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),s(r,null,$(y.routeEntries,(p,b)=>(e(),n(G,{key:b},D({"accordion-header":l(()=>[o("div",ne,[o("div",null,[o("div",null,[oe,a(": "),_(f,{to:{name:"policy-detail-view",params:{mesh:p.route.mesh,policyPath:d.policyTypesByName[p.route.type].path,policy:p.route.name}}},{default:l(()=>[a(i(p.route.name),1)]),_:2},1032,["to"])]),a(),o("div",null,[ie,a(": "+i(p.service),1)])]),a(),p.origins.length>0?(e(),s("div",ce,[(e(!0),s(r,null,$(p.origins,(t,u)=>(e(),n(h,{key:`${g}-${u}`},{default:l(()=>[a(i(t.type),1)]),_:2},1024))),128))])):B("",!0)])]),_:2},[p.origins.length>0?{name:"accordion-content",fn:l(()=>[o("ul",re,[(e(!0),s(r,null,$(p.origins,(t,u)=>(e(),s("li",{key:`${g}-${u}`},[a(i(t.type)+`:

                        `,1),_(f,{to:{name:"policy-detail-view",params:{mesh:t.mesh,policyPath:d.policyTypesByName[t.type].path,policy:t.name}}},{default:l(()=>[a(i(t.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):B("",!0)])]))),128))])])])}}});const ue=j(pe,[["__scopeId","data-v-f3e7afbb"]]),de={class:"policy-type-heading"},ye={class:"policy-list"},_e={key:0},me=S({__name:"PolicyTypeEntryList",props:{id:{},policyTypeEntries:{},policyTypesByName:{}},setup(m){const d=m,c=U(()=>d.policyTypeEntries.filter(f=>{var h;return((h=d.policyTypesByName[f.type])==null?void 0:h.isTargetRefBased)===!1}));function P({headerKey:f}){return{class:`cell-${f}`}}return(f,h)=>{const y=k("RouterLink"),g=k("KTable");return e(),n(M,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),s(r,null,$(c.value,(p,b)=>(e(),n(G,{key:b},{"accordion-header":l(()=>[o("h3",de,[_(J,{"policy-type":p.type},{default:l(()=>[a(i(p.type)+" ("+i(p.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":l(()=>[o("div",ye,[_(g,{class:"policy-type-table",fetcher:()=>({data:p.connections,total:p.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":P,"disable-pagination":"","is-clickable":""},{sourceTags:l(({row:t})=>[t.sourceTags.length>0?(e(),n(z,{key:0,class:"tag-list","should-truncate":"",tags:t.sourceTags},null,8,["tags"])):(e(),s(r,{key:1},[a(`
                —
              `)],64))]),destinationTags:l(({row:t})=>[t.destinationTags.length>0?(e(),n(z,{key:0,class:"tag-list","should-truncate":"",tags:t.destinationTags},null,8,["tags"])):(e(),s(r,{key:1},[a(`
                —
              `)],64))]),name:l(({row:t})=>[t.name!==null?(e(),s(r,{key:0},[a(i(t.name),1)],64)):(e(),s(r,{key:1},[a(`
                —
              `)],64))]),origins:l(({row:t})=>[t.origins.length>0?(e(),s("ul",_e,[(e(!0),s(r,null,$(t.origins,(u,v)=>(e(),s("li",{key:`${b}-${v}`},[_(y,{to:{name:"policy-detail-view",params:{mesh:u.mesh,policyPath:d.policyTypesByName[u.type].path,policy:u.name}}},{default:l(()=>[a(i(u.name),1)]),_:2},1032,["to"])]))),128))])):(e(),s(r,{key:1},[a(`
                —
              `)],64))]),config:l(({row:t,rowKey:u})=>[t.config?(e(),n(q,{key:0,id:`${d.id}-${b}-${u}-code-block`,code:R(Q)(t.config),language:"yaml","show-copy-button":!1},null,8,["id","code"])):(e(),s(r,{key:1},[a(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}});const he=j(me,[["__scopeId","data-v-e09f94c7"]]),ge=m=>(H("data-v-2b6b806e"),m=m(),X(),m),fe={class:"policy-type-heading"},ke={class:"policy-list"},be={key:0,class:"matcher"},ve={key:0,class:"matcher__and"},$e=ge(()=>o("br",null,null,-1)),Te={key:1,class:"matcher__not"},Re={class:"matcher__term"},Be={key:1},Pe={key:0},we=S({__name:"RuleEntryList",props:{id:{},ruleEntries:{},policyTypesByName:{},showMatchers:{type:Boolean,default:!0}},setup(m){const{t:d}=Y(),c=m;function P({headerKey:f}){return{class:`cell-${f}`}}return(f,h)=>{const y=k("RouterLink"),g=k("KTable");return e(),n(M,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),s(r,null,$(c.ruleEntries,(p,b)=>(e(),n(G,{key:b},{"accordion-header":l(()=>[o("h3",fe,[_(J,{"policy-type":p.type},{default:l(()=>[a(i(p.type),1)]),_:2},1032,["policy-type"])])]),"accordion-content":l(()=>[o("div",ke,[_(g,{class:W(["policy-type-table",{"has-matchers":c.showMatchers}]),fetcher:()=>({data:p.rules,total:p.rules.length}),headers:[...c.showMatchers?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}],"cell-attrs":P,"disable-pagination":""},D({origins:l(({row:t})=>[t.origins.length>0?(e(),s("ul",Pe,[(e(!0),s(r,null,$(t.origins,(u,v)=>(e(),s("li",{key:`${b}-${v}`},[_(y,{to:{name:"policy-detail-view",params:{mesh:u.mesh,policyPath:c.policyTypesByName[u.type].path,policy:u.name}}},{default:l(()=>[a(i(u.name),1)]),_:2},1032,["to"])]))),128))])):(e(),s(r,{key:1},[a(i(R(d)("common.collection.none")),1)],64))]),config:l(({row:t,rowKey:u})=>[t.config?(e(),n(q,{key:0,id:`${c.id}-${b}-${u}-code-block`,code:R(Q)(t.config),language:"yaml","show-copy-button":!1},null,8,["id","code"])):(e(),s(r,{key:1},[a(i(R(d)("common.collection.none")),1)],64))]),_:2},[c.showMatchers?{name:"matchers",fn:l(({row:t})=>[t.matchers&&t.matchers.length>0?(e(),s("span",be,[(e(!0),s(r,null,$(t.matchers,({key:u,value:v,not:w},T)=>(e(),s(r,{key:T},[T>0?(e(),s("span",ve,[a(" and"),$e])):B("",!0),w?(e(),s("span",Te,"!")):B("",!0),o("span",Re,i(`${u}:${v}`),1)],64))),128))])):(e(),s("i",Be,i(R(d)("data-planes.routes.item.matches_everything")),1))]),key:"0"}:void 0]),1032,["class","fetcher","headers"])])]),_:2},1024))),128))]),_:1})}}});const O=j(we,[["__scopeId","data-v-2b6b806e"]]),Ne={class:"stack"},Le={class:"mb-2"},Ce=S({__name:"StandardDataplanePolicies",props:{inspectRulesForDataplane:{},policyTypesByName:{}},setup(m){const{t:d}=Y(),c=m;return(P,f)=>{const h=k("KCard");return e(),s("div",Ne,[c.inspectRulesForDataplane.proxyRules.length>0?(e(),n(h,{key:0},{default:l(()=>[o("h3",null,i(R(d)("data-planes.routes.item.proxy_rule")),1),a(),_(O,{id:"proxy-rules",class:"mt-2","rule-entries":c.inspectRulesForDataplane.proxyRules,"policy-types-by-name":c.policyTypesByName,"show-matchers":!1,"data-testid":"proxy-rule-list"},null,8,["rule-entries","policy-types-by-name"])]),_:1})):B("",!0),a(),c.inspectRulesForDataplane.toRules.length>0?(e(),n(h,{key:1},{default:l(()=>[o("h3",null,i(R(d)("data-planes.routes.item.to_rules")),1),a(),_(O,{id:"to-rules",class:"mt-2","rule-entries":c.inspectRulesForDataplane.toRules,"policy-types-by-name":c.policyTypesByName,"data-testid":"to-rule-list"},null,8,["rule-entries","policy-types-by-name"])]),_:1})):B("",!0),a(),c.inspectRulesForDataplane.fromRuleInbounds.length>0?(e(),n(h,{key:2},{default:l(()=>[o("h3",Le,i(R(d)("data-planes.routes.item.from_rules")),1),a(),(e(!0),s(r,null,$(c.inspectRulesForDataplane.fromRuleInbounds,(y,g)=>(e(),s("div",{key:g},[o("h4",null,i(R(d)("data-planes.routes.item.port",{port:y.port})),1),a(),_(O,{id:`from-rules-${g}`,class:"mt-2","rule-entries":y.ruleEntries,"policy-types-by-name":c.policyTypesByName,"data-testid":`from-rule-list-${g}`},null,8,["id","rule-entries","policy-types-by-name","data-testid"])]))),128))]),_:1})):B("",!0)])}}}),Fe={class:"stack"},Xe=S({__name:"DataPlanePoliciesView",props:{data:{}},setup(m){const d=m;return(c,P)=>{const f=k("RouteTitle"),h=k("DataSource"),y=k("KCard"),g=k("AppView"),p=k("RouteView");return e(),n(p,{name:"data-plane-policies-view",params:{mesh:"",dataPlane:""}},{default:l(({can:b,route:t,t:u})=>[_(g,null,{title:l(()=>[o("h2",null,[_(f,{title:u("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"])])]),default:l(()=>[a(),o("div",Fe,[_(h,{src:"/*/policy-types"},{default:l(({data:v,error:w})=>[_(h,{src:`/meshes/${t.params.mesh}/dataplanes/${t.params.dataPlane}/rules`},{default:l(({data:T,error:C})=>[w?(e(),n(K,{key:0,error:w},null,8,["error"])):C?(e(),n(K,{key:1,error:C},null,8,["error"])):v===void 0||T===void 0?(e(),n(V,{key:2})):T.rules.length===0?(e(),n(A,{key:3})):(e(),n(Ce,{key:4,"policy-types-by-name":v.policies.reduce((N,F)=>Object.assign(N,{[F.name]:F}),{}),"inspect-rules-for-dataplane":T,"data-testid":"rules-based-policies"},null,8,["policy-types-by-name","inspect-rules-for-dataplane"]))]),_:2},1032,["src"]),a(),b("use zones")?B("",!0):(e(),n(h,{key:0,src:d.data.dataplaneType!=="builtin"?`/meshes/${t.params.mesh}/dataplanes/${t.params.dataPlane}/sidecar-dataplane-policies`:""},{default:l(({data:T,error:C})=>[_(h,{src:d.data.dataplaneType==="builtin"?`/meshes/${t.params.mesh}/dataplanes/${t.params.dataPlane}/gateway-dataplane-policies`:""},{default:l(({data:N,error:F})=>[o("div",null,[o("h3",null,i(u("data-planes.routes.item.legacy_policies")),1),a(),w?(e(),n(K,{key:0,error:w},null,8,["error"])):C?(e(),n(K,{key:1,error:C},null,8,["error"])):F?(e(),n(K,{key:2,error:F},null,8,["error"])):v===void 0?(e(),n(V,{key:3})):d.data.dataplaneType==="builtin"?(e(),s(r,{key:4},[N===void 0?(e(),n(V,{key:0})):N.routePolicies.length===0&&N.listenerEntries.length===0?(e(),n(A,{key:1})):(e(),n(y,{key:2,class:"mt-4"},{default:l(()=>[_(ue,{"policy-types-by-name":v.policies.reduce((x,I)=>Object.assign(x,{[I.name]:I}),{}),"gateway-dataplane":N,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["policy-types-by-name","gateway-dataplane"])]),_:2},1024))],64)):(e(),s(r,{key:5},[T===void 0?(e(),n(V,{key:0})):T.policyTypeEntries.length===0?(e(),n(A,{key:1})):(e(),n(y,{key:2,class:"mt-4"},{default:l(()=>[_(he,{id:"policies","policy-type-entries":T.policyTypeEntries,"policy-types-by-name":v.policies.reduce((x,I)=>Object.assign(x,{[I.name]:I}),{}),"data-testid":"sidecar-dataplane-policies"},null,8,["policy-type-entries","policy-types-by-name"])]),_:2},1024))],64))])]),_:2},1032,["src"])]),_:2},1032,["src"]))]),_:2},1024)])]),_:2},1024)]),_:1})}}});export{Xe as default};
