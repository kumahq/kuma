import{a as tt,K as A}from"./index-fce48c05.js";import{_ as M,a as g,o,b as v,w as a,m as s,r as K,f as t,d as G,c as u,e as r,k as J,t as i,l as n,F as f,D as x,p as I,n as et,A as at,I as nt,X as H,Y as C,Z as st,$ as ot,a0 as it,S as lt,a1 as rt,C as dt,x as ct,y as ut}from"./index-4198b723.js";import{_ as _t}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-86ef811e.js";import{S as pt}from"./StatusBadge-0690352e.js";import{S as ft}from"./SummaryView-ab46da9b.js";import{T as X}from"./TagList-eaff6ee8.js";import{T as mt}from"./TextWithCopyButton-a2a0b3a9.js";import{_ as vt}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-9e40fbf5.js";import"./CopyButton-62945dfc.js";import"./AccordionList-e0ee6154.js";const yt={},gt={class:"card"},ht={class:"title"},bt={class:"body"};function kt(c,e){const l=g("KCard");return o(),v(l,{class:"data-card"},{default:a(()=>[s("dl",null,[s("div",gt,[s("dt",ht,[K(c.$slots,"title",{},void 0,!0)]),t(),s("dd",bt,[K(c.$slots,"default",{},void 0,!0)])])])]),_:3})}const Q=M(yt,[["render",kt],["__scopeId","data-v-6e083223"]]),xt={class:"service-traffic"},wt={class:"actions"},$t=G({__name:"DataPlaneTraffic",setup(c){return(e,l)=>(o(),u("div",xt,[s("div",wt,[K(e.$slots,"actions",{},void 0,!0)]),t(),r(Q,{class:"header"},{title:a(()=>[K(e.$slots,"title",{},void 0,!0)]),_:3}),t(),K(e.$slots,"default",{},void 0,!0)]))}});const j=M($t,[["__scopeId","data-v-5bd1dbf9"]]),Bt=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],Tt=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],St=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Ct=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],W=(c,e,l)=>{let b=c;return typeof e=="string"||Array.isArray(e)?b=c.toLocaleString(e,l):(e===!0||l!==void 0)&&(b=c.toLocaleString(void 0,l)),b};function F(c,e){if(!Number.isFinite(c))throw new TypeError(`Expected a finite number, got ${typeof c}: ${c}`);e={bits:!1,binary:!1,space:!0,...e};const l=e.bits?e.binary?Ct:St:e.binary?Tt:Bt,b=e.space?" ":"";if(e.signed&&c===0)return` 0${b}${l[0]}`;const _=c<0,B=_?"-":e.signed?"+":"";_&&(c=-c);let h;if(e.minimumFractionDigits!==void 0&&(h={minimumFractionDigits:e.minimumFractionDigits}),e.maximumFractionDigits!==void 0&&(h={maximumFractionDigits:e.maximumFractionDigits,...h}),c<1){const D=W(c,e.locale,h);return B+D+b+l[0]}const w=Math.min(Math.floor(e.binary?Math.log(c)/Math.log(1024):Math.log10(c)/3),l.length-1);c/=(e.binary?1024:1e3)**w,h||(c=c.toPrecision(3));const N=W(Number(c),e.locale,h),T=l[w];return B+N+b+T}const It={class:"title"},Dt={key:0},Kt=G({__name:"ServiceTrafficCard",props:{protocol:{},traffic:{}},setup(c){const{t:e}=J(),l=c,b=_=>{const B=_.target;if(_.isTrusted&&B.nodeName.toLowerCase()!=="a"){const h=B.closest(".service-traffic-card, a");if(h){const w=h.nodeName.toLowerCase()==="a"?h:h.querySelector("a");w!==null&&"click"in w&&typeof w.click=="function"&&w.click()}}};return(_,B)=>{const h=g("KBadge"),w=g("KSkeletonBox");return o(),v(Q,{class:"service-traffic-card",onClick:b},{title:a(()=>[r(h,{appearance:l.protocol==="passthrough"?"success":"info"},{default:a(()=>[t(i(n(e)(`data-planes.components.service_traffic_card.protocol.${l.protocol}`,{},{defaultMessage:n(e)(`http.api.value.${l.protocol}`)})),1)]),_:1},8,["appearance"]),t(),s("div",It,[K(_.$slots,"default",{},void 0,!0)])]),default:a(()=>{var N,T,D,V,R,L,U,q,z;return[t(),l.traffic?(o(),u(f,{key:0},[l.traffic.name.length>0?(o(),u("dl",Dt,[l.protocol==="passthrough"?(o(!0),u(f,{key:0},x([["http","tcp"].reduce((m,E)=>{var k;const y="downstream";return Object.entries(((k=l.traffic)==null?void 0:k[E])||{}).reduce((S,[P,d])=>[`${y}_cx_tx_bytes_total`,`${y}_cx_rx_bytes_total`].includes(P)?{...S,[P]:d+(S[P]??0)}:S,m)},{})],(m,E)=>(o(),u(f,{key:E},[s("div",null,[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,i(n(F)(m.downstream_cx_rx_bytes_total??0)),1)]),t(),s("div",null,[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,i(n(F)(m.downstream_cx_tx_bytes_total??0)),1)])],64))),128)):l.protocol==="grpc"?(o(),u(f,{key:1},[s("div",null,[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.grpc_success")),1),t(),s("dd",null,i(n(e)("common.formats.integer",{value:((N=l.traffic.grpc)==null?void 0:N.success)??0})),1)]),t(),s("div",null,[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.grpc_failure")),1),t(),s("dd",null,i(n(e)("common.formats.integer",{value:((T=l.traffic.grpc)==null?void 0:T.failure)??0})),1)])],64)):l.protocol==="http"?(o(),u(f,{key:2},[(o(!0),u(f,null,x([((D=l.traffic.http)==null?void 0:D.downstream_rq_1xx)??0].filter(m=>m!==0),m=>(o(),u("div",{key:m},[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.1xx")),1),t(),s("dd",null,i(n(e)("common.formats.integer",{value:m})),1)]))),128)),t(),s("div",null,[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.2xx")),1),t(),s("dd",null,i(n(e)("common.formats.integer",{value:((V=l.traffic.http)==null?void 0:V.downstream_rq_2xx)??0})),1)]),t(),(o(!0),u(f,null,x([((R=l.traffic.http)==null?void 0:R.downstream_rq_3xx)??0].filter(m=>m!==0),m=>(o(),u("div",{key:m},[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.3xx")),1),t(),s("dd",null,i(n(e)("common.formats.integer",{value:m})),1)]))),128)),t(),s("div",null,[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.4xx")),1),t(),s("dd",null,i(n(e)("common.formats.integer",{value:((L=l.traffic.http)==null?void 0:L.downstream_rq_4xx)??0})),1)]),t(),s("div",null,[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.5xx")),1),t(),s("dd",null,i(n(e)("common.formats.integer",{value:((U=l.traffic.http)==null?void 0:U.downstream_rq_5xx)??0})),1)])],64)):(o(),u(f,{key:3},[s("div",null,[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,i(n(F)(((q=l.traffic.tcp)==null?void 0:q.downstream_cx_rx_bytes_total)??0)),1)]),t(),s("div",null,[s("dt",null,i(n(e)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,i(n(F)(((z=l.traffic.tcp)==null?void 0:z.downstream_cx_tx_bytes_total)??0)),1)])],64))])):I("",!0)],64)):(o(),v(w,{key:1,width:"10"}))]}),_:3})}}});const O=M(Kt,[["__scopeId","data-v-c99fad9b"]]),Nt={class:"body"},Vt=G({__name:"ServiceTrafficGroup",props:{type:{}},setup(c){const e=c;return(l,b)=>{const _=g("KCard");return o(),v(_,{class:et(["service-traffic-group",`type-${e.type}`])},{default:a(()=>[s("div",Nt,[K(l.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}});const Y=M(Vt,[["__scopeId","data-v-baf4abf7"]]),Et=c=>(ct("data-v-5a7bf611"),c=c(),ut(),c),Pt={"data-testid":"dataplane-warnings"},Mt=["data-testid","innerHTML"],Rt={key:0,"data-testid":"warning-stats-loading"},Lt={class:"stack","data-testid":"dataplane-details"},Ut={class:"columns"},qt={class:"status-with-reason"},zt={class:"columns"},At=Et(()=>s("span",null,"Outbounds",-1)),Ft={"data-testid":"dataplane-mtls"},Gt={class:"columns"},Ot=["innerHTML"],Yt={key:1,"data-testid":"dataplane-subscriptions"},Zt=G({__name:"DataPlaneDetailView",props:{data:{}},setup(c){const{t:e,formatIsoDate:l}=J(),b=at(),_=c,B=nt(()=>_.data.warnings.concat(..._.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(h,w)=>{const N=g("KTooltip"),T=g("KCard"),D=g("RouterLink"),V=g("DataCollection"),R=g("KInputSwitch"),L=g("KButton"),U=g("RouterView"),q=g("KAlert"),z=g("AppView"),m=g("DataSource"),E=g("RouteView");return o(),v(E,{params:{mesh:"",dataPlane:"",inactive:!1},name:"data-plane-detail-view"},{default:a(({route:y})=>[r(m,{src:_.data.dataplaneType==="standard"?`/meshes/${y.params.mesh}/dataplanes/${y.params.dataPlane}/stats`:""},{default:a(({data:k,error:S,refresh:P})=>[r(z,null,H({default:a(()=>[t(),s("div",Lt,[r(T,null,{default:a(()=>[s("div",Ut,[r(C,null,{title:a(()=>[t(i(n(e)("http.api.property.status")),1)]),body:a(()=>[s("div",qt,[r(pt,{status:_.data.status},null,8,["status"]),t(),(o(!0),u(f,null,x([_.data.dataplane.networking.inbounds.filter(d=>!d.health.ready)],d=>(o(),u(f,{key:d},[d.length>0?(o(),v(N,{key:0,class:"reason-tooltip","position-fixed":""},{content:a(()=>[s("ul",null,[(o(!0),u(f,null,x(d,p=>(o(),u("li",{key:`${p.service}:${p.port}`},i(n(e)("data-planes.routes.item.unhealthy_inbound",{service:p.service,port:p.port})),1))),128))])]),default:a(()=>[r(n(st),{color:n(tt),size:n(A),"hide-title":""},null,8,["color","size"]),t()]),_:2},1024)):I("",!0)],64))),128))])]),_:1}),t(),r(C,null,{title:a(()=>[t(i(n(e)("data-planes.routes.item.last_updated")),1)]),body:a(()=>[t(i(n(l)(_.data.modificationTime)),1)]),_:1}),t(),_.data.dataplane.networking.gateway?(o(),u(f,{key:0},[r(C,null,{title:a(()=>[t(i(n(e)("http.api.property.tags")),1)]),body:a(()=>[r(X,{tags:_.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:1}),t(),r(C,null,{title:a(()=>[t(i(n(e)("http.api.property.address")),1)]),body:a(()=>[r(mt,{text:`${_.data.dataplane.networking.address}`},null,8,["text"])]),_:1})],64)):I("",!0)])]),_:1}),t(),_.data.dataplaneType==="standard"?(o(),v(T,{key:0,class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[s("div",zt,[r(j,null,{title:a(()=>[r(n(ot),{display:"inline-block",decorative:"",size:n(A)},null,8,["size"]),t(`
                  Inbounds
                `)]),default:a(()=>[t(),r(Y,{type:"inbound"},{default:a(()=>[r(V,{items:_.data.dataplane.networking.inbounds},{default:a(({items:d})=>[(o(!0),u(f,null,x(d,p=>(o(),u(f,{key:`${p.port}`},[(o(!0),u(f,null,x([(k||{inbounds:[]}).inbounds.find($=>`${$.port}`==`${p.port}`)],$=>(o(),v(O,{key:$,protocol:p.protocol,traffic:typeof S>"u"?$:{name:"",protocol:p.protocol,port:`${p.port}`}},{default:a(()=>[r(D,{to:{name:(Z=>Z.includes("bound")?Z.replace("-outbound-","-inbound-"):"data-plane-inbound-summary-overview-view")(String(n(b).name)),params:{service:p.port},query:{inactive:y.params.inactive?null:void 0}}},{default:a(()=>[t(`
                            :`+i(p.port),1)]),_:2},1032,["to"]),t(),r(X,{tags:[{label:"kuma.io/service",value:p.tags["kuma.io/service"]}]},null,8,["tags"])]),_:2},1032,["protocol","traffic"]))),128))],64))),128))]),_:2},1032,["items"])]),_:2},1024)]),_:2},1024),t(),r(j,null,H({title:a(()=>[r(n(it),{display:"inline-block",decorative:"",size:n(A)},null,8,["size"]),t(),At]),default:a(()=>[t(),t(),typeof S>"u"?(o(),u(f,{key:0},[typeof k>"u"?(o(),v(_t,{key:0})):(o(),u(f,{key:1},[r(Y,{type:"passthrough"},{default:a(()=>[r(O,{protocol:"passthrough",traffic:k.passthrough},{default:a(()=>[t(`
                        Non mesh traffic
                      `)]),_:2},1032,["traffic"])]),_:2},1024),t(),r(V,{predicate:y.params.inactive?void 0:d=>{var p,$;return((d.protocol==="tcp"?(p=d.tcp)==null?void 0:p.downstream_cx_rx_bytes_total:($=d.http)==null?void 0:$.downstream_rq_total)??0)>0},items:k.outbounds},{default:a(({items:d})=>[d.length>0?(o(),v(Y,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[(o(!0),u(f,null,x(d,p=>(o(),v(O,{key:`${p.name}`,protocol:p.protocol,traffic:p},{default:a(()=>[r(D,{to:{name:($=>$.includes("bound")?$.replace("-inbound-","-outbound-"):"data-plane-outbound-summary-overview-view")(String(n(b).name)),params:{service:p.name},query:{inactive:y.params.inactive?null:void 0}}},{default:a(()=>[t(i(p.name),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic"]))),128))]),_:2},1024)):I("",!0)]),_:2},1032,["predicate","items"])],64))],64)):(o(),v(lt,{key:1}))]),_:2},[k?{name:"actions",fn:a(()=>[r(R,{modelValue:y.params.inactive,"onUpdate:modelValue":d=>y.params.inactive=d,"data-testid":"dataplane-outbounds-inactive-toggle"},{label:a(()=>[t(`
                      Show inactive
                    `)]),_:2},1032,["modelValue","onUpdate:modelValue"]),t(),r(L,{appearance:"primary",onClick:P},{default:a(()=>[r(n(rt),{size:n(A)},null,8,["size"]),t(`

                    Refresh
                  `)]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)])]),_:2},1024)):I("",!0),t(),r(U,null,{default:a(d=>[d.route.name!==y.name?(o(),v(ft,{key:0,width:"670px",onClose:function(p){y.replace({name:"data-plane-detail-view",params:{mesh:y.params.mesh,dataPlane:y.params.dataPlane},query:{inactive:y.params.inactive?null:void 0}})}},{default:a(()=>[(o(),v(dt(d.Component),{data:String(d.route.name).includes("-inbound-")?_.data.dataplane.networking.inbounds||[]:(k==null?void 0:k.outbounds)||[]},null,8,["data"]))]),_:2},1032,["onClose"])):I("",!0)]),_:2},1024),t(),s("div",Ft,[s("h2",null,i(n(e)("data-planes.routes.item.mtls.title")),1),t(),_.data.dataplaneInsight.mTLS?(o(!0),u(f,{key:0},x([_.data.dataplaneInsight.mTLS],d=>(o(),v(T,{key:d,class:"mt-4"},{default:a(()=>[s("div",Gt,[r(C,null,{title:a(()=>[t(i(n(e)("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:a(()=>[t(i(n(l)(d.certificateExpirationTime)),1)]),_:2},1024),t(),r(C,null,{title:a(()=>[t(i(n(e)("data-planes.routes.item.mtls.generation_time.title")),1)]),body:a(()=>[t(i(n(l)(d.lastCertificateRegeneration)),1)]),_:2},1024),t(),r(C,null,{title:a(()=>[t(i(n(e)("data-planes.routes.item.mtls.regenerations.title")),1)]),body:a(()=>[t(i(n(e)("common.formats.integer",{value:d.certificateRegenerations})),1)]),_:2},1024),t(),r(C,null,{title:a(()=>[t(i(n(e)("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:a(()=>[t(i(d.issuedBackend),1)]),_:2},1024),t(),r(C,null,{title:a(()=>[t(i(n(e)("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:a(()=>[s("ul",null,[(o(!0),u(f,null,x(d.supportedBackends,p=>(o(),u("li",{key:p},i(p),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(o(),v(q,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:a(()=>[s("div",{innerHTML:n(e)("data-planes.routes.item.mtls.disabled")},null,8,Ot)]),_:1}))]),t(),_.data.dataplaneInsight.subscriptions.length>0?(o(),u("div",Yt,[s("h2",null,i(n(e)("data-planes.routes.item.subscriptions.title")),1),t(),r(T,{class:"mt-4"},{default:a(()=>[r(vt,{subscriptions:_.data.dataplaneInsight.subscriptions},null,8,["subscriptions"])]),_:1})])):I("",!0)])]),_:2},[B.value.length>0||S?{name:"notifications",fn:a(()=>[s("ul",Pt,[(o(!0),u(f,null,x(B.value,d=>(o(),u("li",{key:d.kind,"data-testid":`warning-${d.kind}`,innerHTML:n(e)(`common.warnings.${d.kind}`,d.payload)},null,8,Mt))),128)),t(),S?(o(),u("li",Rt,[t(`
              The below view is not enhanced with runtime stats (Error loading stats: `),s("strong",null,i(S.toString()),1),t(`)
            `)])):I("",!0),t()])]),key:"0"}:void 0]),1024)]),_:2},1032,["src"])]),_:1})}}});const se=M(Zt,[["__scopeId","data-v-5a7bf611"]]);export{se as default};
