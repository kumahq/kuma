import{_ as M,P as B,a8 as A,m as V,u as H,x as z,K as E,l as T,s as F,a0 as K,a2 as N,o as a,f as s,d as b,w as c,b as w,h as r,t as m,n as C,F as k,j as v,e as I,r as f,C as P,D as O}from"./index.b4c50a9a.js";import{g as R}from"./tableDataUtils.d6a29fca.js";import{F as Y}from"./FrameSkeleton.04ef524c.js";import{D as W}from"./DataOverview.57d630c5.js";import{T as j}from"./TabsWidget.a658e878.js";import{Y as q}from"./YamlView.fd70f1b8.js";import{L as G}from"./LabelList.2e2a2df8.js";import"./ErrorBlock.63ee7be4.js";import"./CodeBlock.250aca45.js";import"./index.58caa11d.js";const U={name:"MeshesView",components:{FrameSkeleton:Y,DataOverview:W,TabsWidget:j,YamlView:q,LabelList:G},data(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,empty_state:{title:"No Data",message:"There are no Meshes present."},tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Type",key:"type"}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#resources",title:"Resources"},{hash:"#yaml",title:"YAML"}],entity:{},rawEntity:{},pageSize:B,next:null,itemsPerCol:3,meshInsight:A()}},computed:{...V({policies:t=>t.policies}),counts(){const t=this.policies.map(i=>{var p;return{title:i.pluralDisplayName,value:((p=this.meshInsight.policies[i.name])==null?void 0:p.total)||0}});return[{title:"Data plane proxies",value:this.meshInsight.dataplanes.total},...t]},countCols(){return Math.ceil(this.counts.length/this.itemsPerCol)}},watch:{$route(){this.isLoading=!0,this.isEmpty=!1,this.hasError=!1,this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,this.tableDataIsEmpty=!1,this.loadData()}},beforeMount(){this.init()},methods:{init(){this.loadData()},onCreateClick(){H.logger.info(z.CREATE_MESH_CLICKED)},tableAction(t){const i=t;this.getEntity(i)},async loadData(t="0"){this.isLoading=!0,this.isEmpty=!1;const i=this.$route.params.mesh;let p;i!=="all"&&(p=this.$route.params.mesh);try{const{data:y,next:e}=await R({getSingleEntity:E.getMesh.bind(E),getAllEntities:E.getAllMeshes.bind(E),size:this.pageSize,offset:t,query:p});this.next=e,y.length?(this.tableData.data=[...y],this.tableDataIsEmpty=!1,this.isEmpty=!1,this.getEntity({name:y[0].name})):(this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.entityIsEmpty=!0)}catch(y){this.hasError=!0,this.isEmpty=!0,console.error(y)}finally{this.isLoading=!1}},getEntity(t){if(this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,t&&t!==null)return E.getMesh({name:t.name}).then(i=>{if(i){E.getMeshInsights({name:t.name}).then(n=>{this.meshInsight=n});const p=T(i,["type","name"]),y=()=>{const n=Object.entries(T(i,["mtls","logging","metrics","tracing"])),g=[];return n.forEach(L=>{const _=L[0],o=L[1]||null;if(o&&o.enabledBackend){const d=o.enabledBackend,u=o.backends.find(D=>D.name===d);u&&g.push({label:_,value:{type:u.type,name:u.name}})}else if(o&&o.defaultBackend){const d=o.defaultBackend,u=o.backends.find(D=>D.name===d);u&&g.push({label:_,value:{type:u.type,name:u.name}})}else if(o&&o.backends){const d=o.backends[0];d&&g.push({label:_,value:{type:d.type,name:d.name}})}else g.push({label:_,value:null})}),g},e=()=>{const{routing:n}=i;return n&&n.localityAwareLoadBalancing};this.entity={basicData:p,extendedData:y(),localityEnabled:e()},this.rawEntity=F(i)}else this.entity={},this.entityIsEmpty=!0}).catch(i=>{this.entityHasError=!0,console.error(i)}).finally(()=>{setTimeout(()=>{this.entityIsLoading=!1},"500")});setTimeout(()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1},"500")},formatValue(t){return t?t.toLocaleString("en").toString():0},readableDate(t){return K(t)},rawDate(t){return N(t)}}},x=t=>(P("data-v-206bc34a"),t=t(),O(),t),Z={class:"all-meshes"},J=x(()=>r("span",{class:"custom-control-icon"}," + ",-1)),Q=I(" Create Mesh "),X={key:0},$={key:0},ee={key:1},te={key:2},ae={key:3},se={key:4},ie={key:0},ne={key:0,class:"label-cols"},oe=I(" Disabled "),le=x(()=>r("h4",null,"Locality Aware Loadbalancing",-1)),re={key:0},ce=I(" Enabled "),he=I(" Disabled ");function me(t,i,p,y,e,n){const g=f("KButton"),L=f("DataOverview"),_=f("KBadge"),o=f("LabelList"),d=f("YamlView"),u=f("TabsWidget"),D=f("FrameSkeleton");return a(),s("div",Z,[b(D,null,{default:c(()=>[b(L,{"page-size":e.pageSize,"has-error":e.hasError,"is-loading":e.isLoading,"empty-state":e.empty_state,"table-data":e.tableData,"table-data-is-empty":e.tableDataIsEmpty,next:e.next,onTableAction:n.tableAction,onLoadData:i[0]||(i[0]=l=>n.loadData(l))},{additionalControls:c(()=>[b(g,{class:"add-mesh-button",appearance:"primary",to:{path:"/wizard/mesh"},onClick:n.onCreateClick},{default:c(()=>[J,Q]),_:1},8,["onClick"])]),_:1},8,["page-size","has-error","is-loading","empty-state","table-data","table-data-is-empty","next","onTableAction"]),e.isEmpty===!1?(a(),w(u,{key:0,"has-error":e.hasError,"is-loading":e.isLoading,tabs:e.tabs,"initial-tab-override":"overview"},{tabHeader:c(()=>[e.entity.basicData?(a(),s("div",X,[r("h3",null," Mesh: "+m(e.entity.basicData.name),1)])):C("",!0)]),overview:c(()=>[b(o,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:c(()=>[r("div",null,[r("ul",null,[(a(!0),s(k,null,v(e.entity.basicData,(l,h)=>(a(),s("li",{key:h},[h==="creationTime"?(a(),s("h4",$," Created ")):h==="modificationTime"?(a(),s("h4",ee," Last Modified ")):(a(),s("h4",te,m(h),1)),h==="creationTime"||h==="modificationTime"?(a(),s("p",ae,[I(m(n.readableDate(l))+" ",1),r("em",null,"("+m(n.rawDate(l))+")",1)])):(a(),s("p",se,m(l),1))]))),128))])]),e.entity.extendedData&&e.entity.extendedData.length?(a(),s("div",ie,[r("ul",null,[(a(!0),s(k,null,v(e.entity.extendedData,(l,h)=>(a(),s("li",{key:h},[r("h4",null,m(l.label),1),l.value?(a(),s("p",ne,[r("span",null,m(l.value.type),1),r("span",null,m(l.value.name),1)])):(a(),w(_,{key:1,appearance:"danger"},{default:c(()=>[oe]),_:1}))]))),128)),r("li",null,[le,e.entity.localityEnabled?(a(),s("p",re,[b(_,{appearance:"success"},{default:c(()=>[ce]),_:1})])):(a(),w(_,{key:1,appearance:"danger"},{default:c(()=>[he]),_:1}))])])])):C("",!0)]),_:1},8,["has-error","is-loading","is-empty"])]),yaml:c(()=>[b(d,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty,content:e.rawEntity},null,8,["has-error","is-loading","is-empty","content"])]),resources:c(()=>[b(o,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:c(()=>[(a(!0),s(k,null,v(n.countCols,l=>(a(),s("div",{key:l},[r("ul",null,[(a(!0),s(k,null,v(n.counts.slice((l-1)*e.itemsPerCol,l*e.itemsPerCol),(h,S)=>(a(),s("li",{key:S},[r("h4",null,m(h.title),1),r("p",null,m(n.formatValue(h.value)),1)]))),128))])]))),128))]),_:1},8,["has-error","is-loading","is-empty"])]),_:1},8,["has-error","is-loading","tabs"])):C("",!0)]),_:1})])}const Ie=M(U,[["render",me],["__scopeId","data-v-206bc34a"]]);export{Ie as default};
