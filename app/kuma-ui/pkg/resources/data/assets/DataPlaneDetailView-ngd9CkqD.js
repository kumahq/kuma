import{a as J,K as z}from"./index-FZCiQto1.js";import{_ as V,a as g,o,b as v,w as e,r as K,m as s,f as t,d as F,c as p,e as l,l as Q,q as d,t as i,F as f,E as $,p as S,n as tt,A as et,I as at,T,U as nt,V as st,W as ot,X as it,Y as lt,$ as Z,C as rt,x as dt,y as ct}from"./index-CqXGLTiP.js";import{_ as ut}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-CfFDkdxQ.js";import{S as pt}from"./StatusBadge-OJUndbhX.js";import{S as _t}from"./SummaryView-DgqOrci4.js";import{T as H}from"./TagList-PazD_DgS.js";import{T as mt}from"./TextWithCopyButton-3lrZWnHN.js";import{_ as ft}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-KtzQ0DUp.js";import"./CopyButton-MfTze-YE.js";import"./AccordionList-dqcAI3e2.js";const vt={},yt={class:"card"},gt={class:"title"},ht={class:"body"};function bt(c,n){const a=g("KCard");return o(),v(a,{class:"data-card"},{default:e(()=>[s("dl",null,[s("div",yt,[s("dt",gt,[K(c.$slots,"title",{},void 0,!0)]),t(),s("dd",ht,[K(c.$slots,"default",{},void 0,!0)])])])]),_:3})}const j=V(vt,[["render",bt],["__scopeId","data-v-6e083223"]]),kt={class:"service-traffic"},wt={class:"actions"},xt=F({__name:"DataPlaneTraffic",setup(c){return(n,a)=>(o(),p("div",kt,[s("div",wt,[K(n.$slots,"actions",{},void 0,!0)]),t(),l(j,{class:"header"},{title:e(()=>[K(n.$slots,"title",{},void 0,!0)]),_:3}),t(),K(n.$slots,"default",{},void 0,!0)]))}}),W=V(xt,[["__scopeId","data-v-5bd1dbf9"]]),$t=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],Bt=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],Tt=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Ct=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],X=(c,n,a)=>{let b=c;return typeof n=="string"||Array.isArray(n)?b=c.toLocaleString(n,a):(n===!0||a!==void 0)&&(b=c.toLocaleString(void 0,a)),b};function A(c,n){if(!Number.isFinite(c))throw new TypeError(`Expected a finite number, got ${typeof c}: ${c}`);n={bits:!1,binary:!1,space:!0,...n};const a=n.bits?n.binary?Ct:Tt:n.binary?Bt:$t,b=n.space?" ":"";if(n.signed&&c===0)return` 0${b}${a[0]}`;const x=c<0,I=x?"-":n.signed?"+":"";x&&(c=-c);let y;if(n.minimumFractionDigits!==void 0&&(y={minimumFractionDigits:n.minimumFractionDigits}),n.maximumFractionDigits!==void 0&&(y={maximumFractionDigits:n.maximumFractionDigits,...y}),c<1){const N=X(c,n.locale,y);return I+N+b+a[0]}const k=Math.min(Math.floor(n.binary?Math.log(c)/Math.log(1024):Math.log10(c)/3),a.length-1);c/=(n.binary?1024:1e3)**k,y||(c=c.toPrecision(3));const B=X(Number(c),n.locale,y),D=a[k];return I+B+b+D}const St={class:"title"},It={key:0},Dt=F({__name:"ServiceTrafficCard",props:{protocol:{},traffic:{}},setup(c){const{t:n}=Q(),a=c,b=x=>{const I=x.target;if(x.isTrusted&&I.nodeName.toLowerCase()!=="a"){const y=I.closest(".service-traffic-card, a");if(y){const k=y.nodeName.toLowerCase()==="a"?y:y.querySelector("a");k!==null&&"click"in k&&typeof k.click=="function"&&k.click()}}};return(x,I)=>{const y=g("KBadge"),k=g("KSkeletonBox");return o(),v(j,{class:"service-traffic-card",onClick:b},{title:e(()=>[l(y,{appearance:a.protocol==="passthrough"?"success":"info"},{default:e(()=>[t(i(d(n)(`data-planes.components.service_traffic_card.protocol.${a.protocol}`,{},{defaultMessage:d(n)(`http.api.value.${a.protocol}`)})),1)]),_:1},8,["appearance"]),t(),s("div",St,[K(x.$slots,"default",{},void 0,!0)])]),default:e(()=>{var B,D,N,M,R,P,L,U,q;return[t(),a.traffic?(o(),p(f,{key:0},[a.traffic.name.length>0?(o(),p("dl",It,[a.protocol==="passthrough"?(o(!0),p(f,{key:0},$([["http","tcp"].reduce((_,m)=>{var C;const h="downstream";return Object.entries(((C=a.traffic)==null?void 0:C[m])||{}).reduce((E,[r,u])=>[`${h}_cx_tx_bytes_total`,`${h}_cx_rx_bytes_total`].includes(r)?{...E,[r]:u+(E[r]??0)}:E,_)},{})],(_,m)=>(o(),p(f,{key:m},[s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,i(d(A)(_.downstream_cx_rx_bytes_total??0)),1)]),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,i(d(A)(_.downstream_cx_tx_bytes_total??0)),1)])],64))),128)):a.protocol==="grpc"?(o(),p(f,{key:1},[s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.grpc_success")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:((B=a.traffic.grpc)==null?void 0:B.success)??0})),1)]),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.grpc_failure")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:((D=a.traffic.grpc)==null?void 0:D.failure)??0})),1)])],64)):a.protocol==="http"?(o(),p(f,{key:2},[(o(!0),p(f,null,$([((N=a.traffic.http)==null?void 0:N.downstream_rq_1xx)??0].filter(_=>_!==0),_=>(o(),p("div",{key:_},[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.1xx")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:_})),1)]))),128)),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.2xx")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:((M=a.traffic.http)==null?void 0:M.downstream_rq_2xx)??0})),1)]),t(),(o(!0),p(f,null,$([((R=a.traffic.http)==null?void 0:R.downstream_rq_3xx)??0].filter(_=>_!==0),_=>(o(),p("div",{key:_},[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.3xx")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:_})),1)]))),128)),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.4xx")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:((P=a.traffic.http)==null?void 0:P.downstream_rq_4xx)??0})),1)]),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.5xx")),1),t(),s("dd",null,i(d(n)("common.formats.integer",{value:((L=a.traffic.http)==null?void 0:L.downstream_rq_5xx)??0})),1)])],64)):(o(),p(f,{key:3},[s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,i(d(A)(((U=a.traffic.tcp)==null?void 0:U.downstream_cx_rx_bytes_total)??0)),1)]),t(),s("div",null,[s("dt",null,i(d(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,i(d(A)(((q=a.traffic.tcp)==null?void 0:q.downstream_cx_tx_bytes_total)??0)),1)])],64))])):S("",!0)],64)):(o(),v(k,{key:1,width:"10"}))]}),_:3})}}}),G=V(Dt,[["__scopeId","data-v-c99fad9b"]]),Kt={class:"body"},Nt=F({__name:"ServiceTrafficGroup",props:{type:{}},setup(c){const n=c;return(a,b)=>{const x=g("KCard");return o(),v(x,{class:tt(["service-traffic-group",`type-${n.type}`])},{default:e(()=>[s("div",Kt,[K(a.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}}),O=V(Nt,[["__scopeId","data-v-baf4abf7"]]),Et=c=>(dt("data-v-fce75f89"),c=c(),ct(),c),Vt={"data-testid":"dataplane-warnings"},Mt=["data-testid","innerHTML"],Rt={key:0,"data-testid":"warning-stats-loading"},Pt={class:"stack","data-testid":"dataplane-details"},Lt={class:"columns"},Ut={class:"status-with-reason"},qt={class:"columns"},zt=Et(()=>s("span",null,"Outbounds",-1)),At={"data-testid":"dataplane-mtls"},Ft={class:"columns"},Gt=["innerHTML"],Ot={key:1,"data-testid":"dataplane-subscriptions"},Yt=F({__name:"DataPlaneDetailView",props:{data:{}},setup(c){const n=et(),a=c,b=at(()=>a.data.warnings.concat(...a.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(x,I)=>{const y=g("KTooltip"),k=g("DataCollection"),B=g("KCard"),D=g("RouterLink"),N=g("KInputSwitch"),M=g("KButton"),R=g("RouterView"),P=g("KAlert"),L=g("AppView"),U=g("DataSource"),q=g("RouteView");return o(),v(q,{params:{mesh:"",dataPlane:"",inactive:!1},name:"data-plane-detail-view"},{default:e(({route:_,t:m})=>[l(U,{src:a.data.dataplane.networking.type!=="delegated"?`/meshes/${_.params.mesh}/dataplanes/${_.params.dataPlane}/stats/${a.data.dataplane.networking.inboundName}`:""},{default:e(({data:h,error:C,refresh:E})=>[l(L,null,Z({default:e(()=>[t(),s("div",Pt,[l(B,null,{default:e(()=>[s("div",Lt,[l(T,null,{title:e(()=>[t(i(m("http.api.property.status")),1)]),body:e(()=>[s("div",Ut,[l(pt,{status:a.data.status},null,8,["status"]),t(),a.data.dataplane.networking.type==="standard"?(o(),v(k,{key:0,items:a.data.dataplane.networking.inbounds,predicate:r=>!r.health.ready,empty:!1},{default:e(({items:r})=>[l(y,{class:"reason-tooltip"},{content:e(()=>[s("ul",null,[(o(!0),p(f,null,$(r,u=>(o(),p("li",{key:`${u.service}:${u.port}`},i(m("data-planes.routes.item.unhealthy_inbound",{service:u.service,port:u.port})),1))),128))])]),default:e(()=>[l(d(nt),{color:d(J),size:d(z),"hide-title":""},null,8,["color","size"]),t()]),_:2},1024)]),_:2},1032,["items","predicate"])):S("",!0)])]),_:2},1024),t(),l(T,null,{title:e(()=>[t(i(m("data-planes.routes.item.last_updated")),1)]),body:e(()=>[t(i(m("common.formats.datetime",{value:Date.parse(a.data.modificationTime)})),1)]),_:2},1024),t(),a.data.dataplane.networking.gateway?(o(),p(f,{key:0},[l(T,null,{title:e(()=>[t(i(m("http.api.property.tags")),1)]),body:e(()=>[l(H,{tags:a.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024),t(),l(T,null,{title:e(()=>[t(i(m("http.api.property.address")),1)]),body:e(()=>[l(mt,{text:`${a.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024)],64)):S("",!0)])]),_:2},1024),t(),a.data.dataplane.networking.type!=="delegated"?(o(),v(B,{key:0,class:"traffic","data-testid":"dataplane-traffic"},{default:e(()=>[s("div",qt,[l(W,null,{title:e(()=>[l(d(st),{display:"inline-block",decorative:"",size:d(z)},null,8,["size"]),t(`
                  Inbounds
                `)]),default:e(()=>[t(),l(O,{type:"inbound"},{default:e(()=>[l(k,{items:a.data.dataplane.networking.inbounds},{default:e(({items:r})=>[(o(!0),p(f,null,$(r,u=>(o(),p(f,{key:`${u.name}`},[(o(!0),p(f,null,$([(h||{inbounds:[]}).inbounds.find(w=>`${w.name}`==`${u.name}`)],w=>(o(),v(G,{key:w,protocol:(w==null?void 0:w.protocol)??u.protocol,traffic:typeof C>"u"?w:{name:"",protocol:u.protocol,port:`${u.port}`}},{default:e(()=>[l(D,{to:{name:(Y=>Y.includes("bound")?Y.replace("-outbound-","-inbound-"):"data-plane-inbound-summary-overview-view")(String(d(n).name)),params:{service:u.name},query:{inactive:_.params.inactive?null:void 0}}},{default:e(()=>[t(i(u.name.replace("localhost_",":")),1)]),_:2},1032,["to"]),t(),l(H,{tags:[{label:"kuma.io/service",value:u.tags["kuma.io/service"]}]},null,8,["tags"])]),_:2},1032,["protocol","traffic"]))),128))],64))),128))]),_:2},1032,["items"])]),_:2},1024)]),_:2},1024),t(),l(W,null,Z({title:e(()=>[l(d(ot),{display:"inline-block",decorative:"",size:d(z)},null,8,["size"]),t(),zt]),default:e(()=>[t(),t(),typeof C>"u"?(o(),p(f,{key:0},[typeof h>"u"?(o(),v(ut,{key:0})):(o(),p(f,{key:1},[l(O,{type:"passthrough"},{default:e(()=>[l(G,{protocol:"passthrough",traffic:h.passthrough},{default:e(()=>[t(`
                        Non mesh traffic
                      `)]),_:2},1032,["traffic"])]),_:2},1024),t(),l(k,{predicate:_.params.inactive?void 0:r=>{var u,w;return((r.protocol==="tcp"?(u=r.tcp)==null?void 0:u.downstream_cx_rx_bytes_total:(w=r.http)==null?void 0:w.downstream_rq_total)??0)>0},items:h.outbounds},{default:e(({items:r})=>[r.length>0?(o(),v(O,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:e(()=>[(o(!0),p(f,null,$(r,u=>(o(),v(G,{key:`${u.name}`,protocol:u.protocol,traffic:u},{default:e(()=>[l(D,{to:{name:(w=>w.includes("bound")?w.replace("-inbound-","-outbound-"):"data-plane-outbound-summary-overview-view")(String(d(n).name)),params:{service:u.name},query:{inactive:_.params.inactive?null:void 0}}},{default:e(()=>[t(i(u.name),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic"]))),128))]),_:2},1024)):S("",!0)]),_:2},1032,["predicate","items"])],64))],64)):(o(),v(it,{key:1}))]),_:2},[h?{name:"actions",fn:e(()=>[l(N,{modelValue:_.params.inactive,"onUpdate:modelValue":r=>_.params.inactive=r,"data-testid":"dataplane-outbounds-inactive-toggle"},{label:e(()=>[t(`
                      Show inactive
                    `)]),_:2},1032,["modelValue","onUpdate:modelValue"]),t(),l(M,{appearance:"primary",onClick:E},{default:e(()=>[l(d(lt),{size:d(z)},null,8,["size"]),t(`

                    Refresh
                  `)]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)])]),_:2},1024)):S("",!0),t(),l(R,null,{default:e(r=>[r.route.name!==_.name?(o(),v(_t,{key:0,width:"670px",onClose:function(u){_.replace({name:"data-plane-detail-view",params:{mesh:_.params.mesh,dataPlane:_.params.dataPlane},query:{inactive:_.params.inactive?null:void 0}})}},{default:e(()=>[(o(),v(rt(r.Component),{"dataplane-type":a.data.dataplaneType,gateway:a.data.dataplane.networking.gateway,inbounds:r.route.name.includes("-inbound-")?a.data.dataplane.networking.inbounds:[],data:r.route.name.includes("-inbound-")?(h==null?void 0:h.inbounds)||[]:(h==null?void 0:h.outbounds)||[]},null,8,["dataplane-type","gateway","inbounds","data"]))]),_:2},1032,["onClose"])):S("",!0)]),_:2},1024),t(),s("div",At,[s("h2",null,i(m("data-planes.routes.item.mtls.title")),1),t(),a.data.dataplaneInsight.mTLS?(o(!0),p(f,{key:0},$([a.data.dataplaneInsight.mTLS],r=>(o(),v(B,{key:r,class:"mt-4"},{default:e(()=>[s("div",Ft,[l(T,null,{title:e(()=>[t(i(m("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:e(()=>[t(i(m("common.formats.datetime",{value:Date.parse(r.certificateExpirationTime)})),1)]),_:2},1024),t(),l(T,null,{title:e(()=>[t(i(m("data-planes.routes.item.mtls.generation_time.title")),1)]),body:e(()=>[t(i(m("common.formats.datetime",{value:Date.parse(r.lastCertificateRegeneration)})),1)]),_:2},1024),t(),l(T,null,{title:e(()=>[t(i(m("data-planes.routes.item.mtls.regenerations.title")),1)]),body:e(()=>[t(i(m("common.formats.integer",{value:r.certificateRegenerations})),1)]),_:2},1024),t(),l(T,null,{title:e(()=>[t(i(m("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:e(()=>[t(i(r.issuedBackend),1)]),_:2},1024),t(),l(T,null,{title:e(()=>[t(i(m("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:e(()=>[s("ul",null,[(o(!0),p(f,null,$(r.supportedBackends,u=>(o(),p("li",{key:u},i(u),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(o(),v(P,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:e(()=>[s("div",{innerHTML:m("data-planes.routes.item.mtls.disabled")},null,8,Gt)]),_:2},1024))]),t(),a.data.dataplaneInsight.subscriptions.length>0?(o(),p("div",Ot,[s("h2",null,i(m("data-planes.routes.item.subscriptions.title")),1),t(),l(B,{class:"mt-4"},{default:e(()=>[l(ft,{subscriptions:a.data.dataplaneInsight.subscriptions},null,8,["subscriptions"])]),_:1})])):S("",!0)])]),_:2},[b.value.length>0||C?{name:"notifications",fn:e(()=>[s("ul",Vt,[(o(!0),p(f,null,$(b.value,r=>(o(),p("li",{key:r.kind,"data-testid":`warning-${r.kind}`,innerHTML:m(`common.warnings.${r.kind}`,r.payload)},null,8,Mt))),128)),t(),C?(o(),p("li",Rt,[t(`
              The below view is not enhanced with runtime stats (Error loading stats: `),s("strong",null,i(C.toString()),1),t(`)
            `)])):S("",!0)])]),key:"0"}:void 0]),1024)]),_:2},1032,["src"])]),_:1})}}}),ne=V(Yt,[["__scopeId","data-v-fce75f89"]]);export{ne as default};
