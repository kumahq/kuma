import{d as P,v as D,S as U,p as y,o as a,w as n,b as l,r as i,e as r,q as V,m as v,l as b,I as W,K as j,t as u,c as d,L as w,N as z,T as H,U as J,y as O,G as Q,_ as Y}from"./index-CHUyLuna.js";import{S as ee}from"./SummaryView-B_VTmqHS.js";const ne=["data-testid"],oe=P({__name:"ZoneListView",setup(te){const I=D({}),X=D({}),S=U(),R=C=>{const o="zoneIngress";I.value=C.items.reduce((p,c)=>{const m=c[o]?.zone;if(typeof m<"u"){typeof p[m]>"u"&&(p[m]={online:[],offline:[]});const h=typeof c[`${o}Insight`].connectedSubscription<"u"?"online":"offline";p[m][h].push(c)}return p},{})},T=C=>{const o="zoneEgress";X.value=C.items.reduce((p,c)=>{const m=c[o]?.zone;if(typeof m<"u"){typeof p[m]>"u"&&(p[m]={online:[],offline:[]});const h=typeof c[`${o}Insight`].connectedSubscription<"u"?"online":"offline";p[m][h].push(c)}return p},{})};return(C,o)=>{const p=i("RouteTitle"),c=i("DataSource"),m=i("XI18n"),h=i("XTeleportTemplate"),N=i("XSearch"),L=i("XIcon"),A=i("XAction"),$=i("DataCollection"),B=i("DataLoader"),Z=i("XLayout"),E=i("XCard"),G=i("RouterView"),q=i("AppView"),x=i("RouteView");return a(),y(x,{name:"zone-cp-list-view",params:{page:1,size:Number,zone:"",s:""}},{default:n(({route:s,t:_,uri:F,me:g})=>[l(c,{src:F(v(Q),"/zone-cps",{},{page:s.params.page,size:s.params.size,search:s.params.s})},{default:n(({data:f,error:K,refresh:M})=>[l(q,{docs:f&&f?.items?.length?_("zones.href.docs.cta"):""},{title:n(()=>[b("h1",null,[l(p,{title:_("zone-cps.routes.items.title")},null,8,["title"])])]),default:n(()=>[o[9]||(o[9]=r()),l(c,{src:"/zone-ingress-overviews?page=1&size=100",onChange:R}),o[10]||(o[10]=r()),l(c,{src:"/zone-egress-overviews?page=1&size=100",onChange:T}),o[11]||(o[11]=r()),f?.items.length?(a(),y(m,{key:0,path:"zone-cps.routes.items.intro","default-path":"common.i18n.ignore-error"})):V("",!0),o[12]||(o[12]=r()),(f?.items??[]).length>0?(a(),y(h,{key:1,to:{name:"zone-cp-list-view-actions"}},{default:n(()=>[l(v(S))]),_:1})):V("",!0),o[13]||(o[13]=r()),l(E,null,{default:n(()=>[l(Z,null,{default:n(()=>[b("search",null,[b("form",{onSubmit:o[0]||(o[0]=W(()=>{},["prevent"]))},[l(N,{class:"search-field",keys:["name"],value:s.params.s,onChange:e=>s.update({page:1,s:e})},null,8,["value","onChange"])],32)]),o[8]||(o[8]=r()),l(B,{data:[f],errors:[K],variant:"list"},{default:n(()=>[l($,{type:"zone-cps",items:f?.items??[void 0],page:s.params.page,"page-size":s.params.size,total:f?.total,onChange:s.update},{default:n(()=>[l(j,{class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{...g.get("headers.type"),label:"Â ",key:"type"},{...g.get("headers.name"),label:"Name",key:"name"},{...g.get("headers.zoneCpVersion"),label:"Zone leader CP version",key:"zoneCpVersion"},{...g.get("headers.ingress"),label:"Ingresses (online / total)",key:"ingress"},{...g.get("headers.egress"),label:"Egresses (online / total)",key:"egress"},{...g.get("headers.state"),label:"Status",key:"state"},{...g.get("headers.warnings"),label:"Warnings",key:"warnings",hideLabel:!0},{...g.get("headers.actions"),label:"Actions",key:"actions",hideLabel:!0}],items:f?.items,"is-selected-row":e=>e.name===s.params.zone,onResize:g.set},{type:n(({row:e})=>[(a(!0),d(z,null,w([["kubernetes","universal"].find(t=>t===e.zoneInsight.environment)??"kubernetes"],t=>(a(),y(L,{key:t,name:t},{default:n(()=>[r(u(_(`common.product.environment.${t}`)),1)]),_:2},1032,["name"]))),128))]),name:n(({row:e})=>[l(A,{"data-action":"",to:{name:"zone-cp-detail-view",params:{zone:e.name},query:{page:s.params.page,size:s.params.size,s:s.params.s}}},{default:n(()=>[r(u(e.name),1)]),_:2},1032,["to"])]),zoneCpVersion:n(({row:e})=>[r(u(v(J)(e.zoneInsight,"version.kumaCp.version",_("common.collection.none"))),1)]),ingress:n(({row:e})=>[(a(!0),d(z,null,w([I.value[e.name]||{online:[],offline:[]}],t=>(a(),d(z,null,[r(u(t.online.length)+" / "+u(t.online.length+t.offline.length),1)],64))),256))]),egress:n(({row:e})=>[(a(!0),d(z,null,w([X.value[e.name]||{online:[],offline:[]}],t=>(a(),d(z,null,[r(u(t.online.length)+" / "+u(t.online.length+t.offline.length),1)],64))),256))]),state:n(({row:e})=>[l(H,{status:e.state},null,8,["status"])]),warnings:n(({row:e})=>[(a(!0),d(z,null,w([[{bool:e.zoneInsight.store==="memory",key:"store-memory"},{bool:!e.zoneInsight.version?.kumaCp?.kumaCpGlobalCompatible,key:"global-cp-incompatible"}].filter(({bool:t})=>t)],t=>(a(),d(z,{key:typeof t},[t.length>0?(a(),y(L,{key:0,name:"warning","data-testid":"warning"},{default:n(()=>[b("ul",null,[(a(!0),d(z,null,w(t,({key:k})=>(a(),d("li",{key:k,"data-testid":`warning-${k}`},u(_(`zone-cps.list.warnings.${k}`)),9,ne))),128))])]),_:2},1024)):(a(),d(z,{key:1},[r(u(_("common.collection.none")),1)],64))],64))),128))]),actions:n(({row:e})=>[l(v(S),{item:e,onChange:M},{default:n(()=>[l(A,{to:{name:"zone-cp-detail-view",params:{zone:e.name}}},{default:n(()=>[r(u(_("common.collection.actions.view")),1)]),_:2},1032,["to"])]),_:2},1032,["item","onChange"])]),_:2},1032,["headers","items","is-selected-row","onResize"])]),_:2},1032,["items","page","page-size","total","onChange"])]),_:2},1032,["data","errors"])]),_:2},1024)]),_:2},1024),o[14]||(o[14]=r()),s.params.zone?(a(),y(G,{key:2},{default:n(e=>[l(ee,{onClose:t=>s.replace({name:"zone-cp-list-view",query:{page:s.params.page,size:s.params.size,s:s.params.s}})},{default:n(()=>[(a(),y(O(e.Component),{name:s.params.zone,"zone-overview":f?.items.find(t=>t.name===s.params.zone)},null,8,["name","zone-overview"]))]),_:2},1032,["onClose"])]),_:2},1024)):V("",!0)]),_:2},1032,["docs"])]),_:2},1032,["src"])]),_:1})}}}),le=Y(oe,[["__scopeId","data-v-886ac0bb"]]);export{le as default};
