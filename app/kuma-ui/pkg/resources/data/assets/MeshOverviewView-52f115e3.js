import{u as K}from"./vue-router-573afc44.js";import{_ as O}from"./kongponents.es-3df60cd6.js";import{C as U}from"./ContentWrapper-b0fa1a61.js";import{u as F,k as R,n as W,i as $}from"./store-ee651251.js";import{_ as P,a as N,M as j}from"./MeshResources-816ff597.js";import{d as T,c as d,y as Y,o as l,h as i,e as p,u as t,f as o,r as C,l as q,w as M,b as S,F as k,g as u,v as B,t as m,a as A,p as z,m as G}from"./runtime-dom.esm-bundler-91b41870.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as H}from"./LabelList.vue_vue_type_style_index_0_lang-d1feb263.js";import{_ as J}from"./YamlView.vue_vue_type_script_setup_true_lang-06f05d2a.js";import"./vuex.esm-bundler-df5bd11e.js";import"./constants-31fdaf55.js";import"./Instance-8f7e680d.js";import"./index-427ec66a.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-4047971f.js";import"./ErrorBlock-c2bb5142.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-d3176fee.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-23b6441e.js";import"./_commonjsHelpers-87174ba5.js";import"./toYaml-4e00099e.js";const Q={class:"chart-container mt-24"},Z=T({__name:"MeshCharts",setup(v){const a=F(),f=d(()=>a.getters.getServiceResourcesFetching),h=d(()=>a.getters.getMeshInsightsFetching),y=d(()=>a.getters.getChart("services")),g=d(()=>a.getters.getChart("dataplanes")),r=d(()=>a.getters.getChart("policies")),V=d(()=>a.getters.getChart("kumaDPVersions")),b=d(()=>a.getters.getChart("envoyVersions"));Y(()=>a.state.selectedMesh,function(){I()}),I();function I(){a.dispatch("fetchMeshInsights",a.state.selectedMesh),a.dispatch("fetchServices",a.state.selectedMesh)}return(D,E)=>(l(),i("div",Q,[p(P,{class:"chart",title:{singular:"SERVICE",plural:"SERVICES"},data:t(y).data,"is-loading":t(f),"save-chart":""},null,8,["data","is-loading"]),o(),p(P,{class:"chart",title:{singular:"DP PROXY",plural:"DP PROXIES"},data:t(g).data,url:{name:"data-plane-list-view",params:{mesh:t(a).state.selectedMesh}},"is-loading":t(h)},null,8,["data","url","is-loading"]),o(),p(P,{class:"chart",title:{singular:"POLICY",plural:"POLICIES"},data:t(r).data,url:{name:"policies",params:{mesh:t(a).state.selectedMesh}},"is-loading":t(h)},null,8,["data","url","is-loading"]),o(),p(N,{class:"chart",title:"KUMA DP",data:t(V).data,"is-loading":t(h)},null,8,["data","is-loading"]),o(),p(N,{class:"chart",title:"ENVOY",data:t(b).data,"is-loading":t(h),"display-am-charts-logo":""},null,8,["data","is-loading"])]))}});const ee=X(Z,[["__scopeId","data-v-2a02347c"]]),te=v=>(z("data-v-b0e2f340"),v=v(),G(),v),ae={key:0},se={key:1},ne={key:1},le={class:"policy-counts"},oe=te(()=>u("h4",null,`
                  Policies
                `,-1)),re={key:0},ie={key:0,class:"mt-4"},ce=T({__name:"MeshOverviewView",setup(v){const a=K(),f=F(),h=C(!0),y=C(!1),g=C(!1),r=C(null),V=C(null),b=d(()=>r.value!==null?W(r.value):null),I=d(()=>{if(r.value===null)return null;const{name:s,type:n,creationTime:_,modificationTime:e}=r.value;return{name:s,type:n,created:$(_),modified:$(e),"Data Plane Proxies":f.state.meshInsight.dataplanes.total}}),D=d(()=>{var L;if(r.value===null)return null;const s=w(r.value,"mtls"),n=w(r.value,"logging"),_=w(r.value,"metrics"),e=w(r.value,"tracing"),c=Boolean((L=r.value.routing)==null?void 0:L.localityAwareLoadBalancing);return{mtls:s,logging:n,metrics:_,tracing:e,localityAwareLoadBalancing:c}}),E=d(()=>f.state.policyTypes.map(s=>{var n;return{...s,length:((n=f.state.meshInsight.policies[s.name])==null?void 0:n.total)??0}}));Y(()=>a.params.mesh,function(){a.name==="single-mesh-overview"&&(h.value=!0,g.value=!1,y.value=!1,x())}),x();async function x(){h.value=!0,g.value=!1;const s=a.params.mesh;try{r.value=await R.getMesh({name:s}),V.value=await R.getMeshInsights({name:s})}catch(n){y.value=!0,g.value=!0,console.error(n)}finally{h.value=!1}}function w(s,n){if(s===null||s[n]===void 0)return!1;const _=s[n].enabledBackend??s[n].defaultBackend??s[n].backends[0].name,e=s[n].backends.find(c=>c.name===_);return`${e.type} / ${e.name}`}return(s,n)=>{const _=q("router-link");return l(),i(k,null,[p(ee),o(),p(U,{class:"mt-8"},{content:M(()=>[r.value!==null?(l(),i("div",ae,[p(H,{"has-error":y.value,"is-loading":h.value,"is-empty":g.value},{default:M(()=>[u("div",null,[u("ul",null,[(l(!0),i(k,null,B(t(I),(e,c)=>(l(),i("li",{key:c},[u("h4",null,m(c),1),o(),typeof e=="boolean"?(l(),A(t(O),{key:0,appearance:e?"success":"danger"},{default:M(()=>[o(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),i("p",se,m(e),1))]))),128))])]),o(),u("div",null,[u("ul",null,[(l(!0),i(k,null,B(t(D),(e,c)=>(l(),i("li",{key:c},[u("h4",null,m(c),1),o(),typeof e=="boolean"?(l(),A(t(O),{key:0,appearance:e?"success":"danger"},{default:M(()=>[o(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),i("p",ne,m(e),1))]))),128))])]),o(),u("div",null,[u("ul",le,[u("li",null,[oe,o(),u("ul",null,[(l(!0),i(k,null,B(t(E),(e,c)=>(l(),i(k,{key:c},[e.length!==0?(l(),i("li",re,[p(_,{to:{name:"policy",params:{policyPath:e.path}}},{default:M(()=>[o(m(e.name)+": "+m(e.length),1)]),_:2},1032,["to"])])):S("",!0)],64))),128))])])])])]),_:1},8,["has-error","is-loading","is-empty"])])):S("",!0)]),_:1}),o(),t(b)!==null?(l(),i("div",ie,[p(J,{id:"code-block-mesh",content:t(b)},null,8,["content"])])):S("",!0),o(),p(j,{class:"mt-6"})],64)}}});const Be=X(ce,[["__scopeId","data-v-b0e2f340"]]);export{Be as default};
