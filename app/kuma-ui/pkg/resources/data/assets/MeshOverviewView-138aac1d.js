import{_ as E}from"./kongponents.es-3ba46133.js";import{u as W,s as j,l as T}from"./production-554ae9d4.js";import{D as w}from"./DoughnutChart-861842b2.js";import{u as N}from"./store-f2021894.js";import{d as S,c as p,q as A,o as s,h as l,e as d,u as c,f as n,r as k,s as z,w as C,g as u,F as b,l as D,t as m,a as $,b as x}from"./runtime-dom.esm-bundler-9284044f.js";import{_ as L}from"./_plugin-vue_export-helper-c27b6911.js";import{C as G}from"./ContentWrapper-3e2f16cb.js";import{_ as H}from"./LabelList.vue_vue_type_style_index_0_lang-45f41bec.js";import{M as J}from"./MeshResources-6334b57b.js";import{_ as Q}from"./YamlView.vue_vue_type_script_setup_true_lang-36e8b31a.js";import{u as U}from"./index-36b3783c.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-1dc4f3b2.js";import"./ErrorBlock-53b18c33.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-55aeae37.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-c7bd4e33.js";import"./toYaml-4e00099e.js";const X={class:"chart-box-list"},Y=S({__name:"MeshCharts",setup(O){const r=N(),g=p(()=>r.getters.getChart("services",{title:"Services",showTotal:!0})),v=p(()=>r.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),f=p(()=>r.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),y=p(()=>r.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));A(()=>r.state.selectedMesh,function(){h()}),h();function h(){r.dispatch("fetchMeshInsights",r.state.selectedMesh),r.dispatch("fetchServices",r.state.selectedMesh)}return(o,B)=>(s(),l("div",X,[d(w,{data:c(g)},null,8,["data"]),n(),d(w,{data:c(v)},null,8,["data"]),n(),d(w,{data:c(f)},null,8,["data"]),n(),d(w,{data:c(y)},null,8,["data"])]))}});const Z=L(Y,[["__scopeId","data-v-0f054518"]]),ee={key:0},te={key:1},ae={key:1},se={class:"policy-counts"},ne={key:0},oe={key:0,class:"mt-4"},le=S({__name:"MeshOverviewView",setup(O){const r=U(),g=W(),v=N(),f=k(!0),y=k(!1),h=k(!1),o=k(null),B=k(null),V=p(()=>o.value!==null?j(o.value):null),R=p(()=>{if(o.value===null)return null;const{name:t,type:a,creationTime:_,modificationTime:e}=o.value;return{name:t,type:a,created:T(_),modified:T(e),"Data Plane Proxies":v.state.meshInsight.dataplanes.total}}),F=p(()=>{var I;if(o.value===null)return null;const t=M(o.value,"mtls"),a=M(o.value,"logging"),_=M(o.value,"metrics"),e=M(o.value,"tracing"),i=Boolean((I=o.value.routing)==null?void 0:I.localityAwareLoadBalancing);return{mtls:t,logging:a,metrics:_,tracing:e,localityAwareLoadBalancing:i}}),K=p(()=>v.state.sidebar.insights.mesh.policies.total),q=p(()=>v.state.policyTypes.map(t=>{var a;return{...t,length:((a=v.state.meshInsight.policies[t.name])==null?void 0:a.total)??0}}));A(()=>g.params.mesh,function(){g.name==="single-mesh-overview"&&(f.value=!0,h.value=!1,y.value=!1,P())}),P();async function P(){f.value=!0,h.value=!1;const t=g.params.mesh;try{o.value=await r.getMesh({name:t}),B.value=await r.getMeshInsights({name:t})}catch(a){y.value=!0,h.value=!0,console.error(a)}finally{f.value=!1}}function M(t,a){if(t===null||t[a]===void 0)return!1;const _=t[a].enabledBackend??t[a].defaultBackend??t[a].backends[0].name,e=t[a].backends.find(i=>i.name===_);return`${e.type} / ${e.name}`}return(t,a)=>{const _=z("router-link");return s(),l(b,null,[d(Z,{class:"mt-24"}),n(),d(G,{class:"mt-8"},{content:C(()=>[o.value!==null?(s(),l("div",ee,[d(H,{"has-error":y.value,"is-loading":f.value,"is-empty":h.value},{default:C(()=>[u("div",null,[u("ul",null,[(s(!0),l(b,null,D(c(R),(e,i)=>(s(),l("li",{key:i},[u("h4",null,m(i),1),n(),typeof e=="boolean"?(s(),$(c(E),{key:0,appearance:e?"success":"danger"},{default:C(()=>[n(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),l("p",te,m(e),1))]))),128))])]),n(),u("div",null,[u("ul",null,[(s(!0),l(b,null,D(c(F),(e,i)=>(s(),l("li",{key:i},[u("h4",null,m(i),1),n(),typeof e=="boolean"?(s(),$(c(E),{key:0,appearance:e?"success":"danger"},{default:C(()=>[n(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),l("p",ae,m(e),1))]))),128))])]),n(),u("div",null,[u("ul",se,[u("li",null,[u("h4",null,`
                  Policies (`+m(c(K))+`)
                `,1),n(),u("ul",null,[(s(!0),l(b,null,D(c(q),(e,i)=>(s(),l(b,{key:i},[e.length!==0?(s(),l("li",ne,[d(_,{to:{name:"policy",params:{policyPath:e.path}}},{default:C(()=>[n(m(e.name)+": "+m(e.length),1)]),_:2},1032,["to"])])):x("",!0)],64))),128))])])])])]),_:1},8,["has-error","is-loading","is-empty"])])):x("",!0)]),_:1}),n(),c(V)!==null?(s(),l("div",oe,[d(Q,{id:"code-block-mesh",content:c(V)},null,8,["content"])])):x("",!0),n(),d(J,{class:"mt-6"})],64)}}});const Me=L(le,[["__scopeId","data-v-d6142749"]]);export{Me as default};
