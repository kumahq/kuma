import{d as q,c as v,r as F,o as t,a as c,w as a,q as x,g as r,h as l,t as f,f as p,e as k,F as z,b as y,G as L,s as I,U as N}from"./index-752f8547.js";import{D as E,a as b}from"./DefinitionListItem-e2c7b774.js";import{_ as K}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-ac66d340.js";import{m as O,S as G,f as A,g as J,A as R,p as C,r as U,E as W,s as j,_ as H}from"./RouteView.vue_vue_type_script_setup_true_lang-8b3edb98.js";import{T as M}from"./TagList-75a2568b.js";import{T as Q}from"./TextWithCopyButton-5b416952.js";import{_ as X}from"./RouteTitle.vue_vue_type_script_setup_true_lang-397fac77.js";import{D as Y,K as Z}from"./KFilterBar-0996ec1c.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-81e465b8.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-62e6e66f.js";import"./AppCollection-4f7fdf0b.js";import"./notEmpty-7f452b20.js";const D={class:"entity-section-list"},ee={class:"entity-title"},se=q({__name:"ServiceSummary",props:{service:{},externalService:{default:null}},setup(S){const e=S,d=O(),B=v(()=>({name:"service-detail-view",params:{service:e.service.name,mesh:e.service.mesh}})),w=v(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.networking.address:e.service.addressPort??null),i=v(()=>{var o;return e.service.serviceType==="external"&&e.externalService!==null?(o=e.externalService.networking.tls)!=null&&o.enabled?"Enabled":"Disabled":null}),m=v(()=>{var o,u;if(e.service.serviceType==="external")return null;{const s=((o=e.service.dataplanes)==null?void 0:o.online)??0,T=((u=e.service.dataplanes)==null?void 0:u.total)??0;return`${s} online / ${T} total`}}),g=v(()=>e.service.serviceType==="external"?null:e.service.status??null),_=v(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.tags:null);async function h(o){if(e.service.serviceType==="external"&&e.externalService!==null){const{mesh:u,name:s}=e.externalService;return await d.getExternalService({mesh:u,name:s},o)}else{const{mesh:u,name:s}=e.service;return await d.getServiceInsight({mesh:u,name:s},o)}}return(o,u)=>{const s=F("router-link");return t(),c(y(L),null,{body:a(()=>[x("div",D,[x("section",null,[x("h1",ee,[x("span",null,[r(`
              Service:

              `),l(Q,{text:e.service.name},{default:a(()=>[l(s,{to:B.value},{default:a(()=>[r(f(e.service.name),1)]),_:1},8,["to"])]),_:1},8,["text"])]),r(),g.value?(t(),c(G,{key:0,status:g.value},null,8,["status"])):p("",!0)]),r(),l(E,{class:"mt-4"},{default:a(()=>[l(b,{term:"Address"},{default:a(()=>[w.value!==null?(t(),k(z,{key:0},[r(f(w.value),1)],64)):(t(),k(z,{key:1},[r(`
                —
              `)],64))]),_:1}),r(),i.value!==null?(t(),c(b,{key:0,term:"TLS"},{default:a(()=>[r(f(i.value),1)]),_:1})):p("",!0),r(),m.value!==null?(t(),c(b,{key:1,term:"Data Plane Proxies"},{default:a(()=>[r(f(m.value),1)]),_:1})):p("",!0),r(),_.value!==null?(t(),c(b,{key:2,term:"Tags"},{default:a(()=>[l(M,{tags:_.value},null,8,["tags"])]),_:1})):p("",!0)]),_:1})]),r(),l(K,{id:"code-block-service","resource-fetcher":h,"resource-fetcher-watch-key":e.service.name,"is-searchable":"","show-copy-as-kubernetes-button":e.service.serviceType==="external"&&e.externalService!==null,"code-max-height":"250px"},null,8,["resource-fetcher-watch-key","show-copy-as-kubernetes-button"])])]),_:1})}}});const re=A(se,[["__scopeId","data-v-31d05cbc"]]),te={key:3,class:"stack"},ae=q({__name:"ServiceDetailView",props:{page:{},size:{},search:{},query:{},gatewayType:{},mesh:{},service:{}},setup(S){const e=S,{t:d}=J();return(B,w)=>(t(),c(H,{name:"service-detail-view"},{default:a(({route:i})=>[l(X,{title:y(d)("services.routes.item.title",{name:i.params.service})},null,8,["title"]),r(),l(R,{breadcrumbs:[{to:{name:"services-list-view",params:{mesh:i.params.mesh}},text:y(d)("services.routes.item.breadcrumbs")}]},{default:a(()=>[l(C,{src:`/meshes/${i.params.mesh}/service-insights/${i.params.service}`},{default:a(({data:m,isLoading:g,error:_})=>[l(C,{src:`/meshes/${i.params.mesh}/external-services/${i.params.service}`},{default:a(({data:h,isLoading:o,error:u})=>[g||o?(t(),c(U,{key:0})):_??u?(t(),c(W,{key:1,error:_??u},null,8,["error"])):m===void 0||h===void 0?(t(),c(j,{key:2})):(t(),k("div",te,[l(re,{service:m,"external-service":h},null,8,["service","external-service"]),r(),(m==null?void 0:m.serviceType)!=="external"?(t(),c(C,{key:0,src:`/meshes/${i.params.mesh}/dataplanes/for/${i.params.service}/of/${e.gatewayType}?page=${e.page}&size=${e.size}&search=${e.search}`},{default:a(({data:s,error:T})=>{var V;return[(t(!0),k(z,null,I([typeof((V=s==null?void 0:s.items)==null?void 0:V[0].dataplane.networking.gateway)>"u"],$=>(t(),c(y(L),{key:$},{body:a(()=>[l(Y,{"data-testid":"data-plane-collection",class:"data-plane-collection","page-number":e.page,"page-size":e.size,total:s==null?void 0:s.total,items:s==null?void 0:s.items,error:T,gateways:$,onChange:({page:n,size:P})=>{i.update({page:String(n),size:String(P)})}},{toolbar:a(()=>[l(Z,{class:"data-plane-proxy-filter",placeholder:"tag: 'kuma.io/protocol: http'",query:e.query,fields:{name:{description:"filter by name or parts of a name"},protocol:{description:"filter by “kuma.io/protocol” value"},tag:{description:"filter by tags (e.g. “tag: version:2”)"},zone:{description:"filter by “kuma.io/zone” value"}},onFieldsChange:n=>i.update({query:n.query,s:n.query.length>0?JSON.stringify(n.fields):""})},null,8,["placeholder","query","fields","onFieldsChange"]),r(),$?(t(),c(y(N),{key:0,label:"Type","overlay-label":!0,items:[{label:"All",value:"all"},{label:"Builtin",value:"builtin"},{label:"Delegated",value:"delegated"}].map(n=>({...n,selected:n.value===e.gatewayType})),appearance:"select",onSelected:n=>i.update({gatewayType:String(n.value)})},{"item-template":a(({item:n})=>[r(f(n.label),1)]),_:2},1032,["items","onSelected"])):p("",!0)]),_:2},1032,["page-number","page-size","total","items","error","gateways","onChange"])]),_:2},1024))),128))]}),_:2},1032,["src"])):p("",!0)]))]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["breadcrumbs"])]),_:1}))}});const ye=A(ae,[["__scopeId","data-v-09f39329"]]);export{ye as default};
