import{_ as x,P as A,K as c,cN as F,cO as T,cP as k,l as N,s as b,r as l,o as p,f as E,d as y,w as r,b as _,n as L,h as o,t as g,F as O,j as V,e as I}from"./index.2f6d90b0.js";import{E as C}from"./EntityURLControl.97461fef.js";import{F as H}from"./FormatForCLI.72422f2d.js";import{F as B}from"./FrameSkeleton.ef3c14b1.js";import{D as M}from"./DataOverview.cd1778b1.js";import{T as P}from"./TabsWidget.37f6a0c6.js";import{Y as z}from"./YamlView.25baae1a.js";import{L as R}from"./LabelList.27a15810.js";const Y={methods:{sortEntities(t){return t.sort((a,i)=>a.name>i.name||a.name===i.name&&a.mesh>i.mesh?1:-1)}}},q={name:"ServicesView",components:{EntityURLControl:C,FrameSkeleton:B,DataOverview:M,TabsWidget:P,YamlView:z,LabelList:R},mixins:[H,Y],props:{routeName:{type:String,required:!0},name:{type:String,default:""},tabHeaders:{type:Array,required:!0}},data(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,empty_state:{title:"No Data",message:`There are not ${this.name} present.`},tableData:{headers:this.tabHeaders,data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#yaml",title:"YAML"}],entity:{},rawEntity:{},pageSize:A,next:null}},computed:{formattedRawEntity(){return this.formatForCLI(this.rawEntity)}},watch:{$route(){this.isLoading=!0,this.isEmpty=!1,this.hasError=!1,this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,this.tableDataIsEmpty=!1,this.init()}},beforeMount(){this.init()},methods:{getAllServices(t){return this.name==="Internal Services"?c.getAllServiceInsights(t):c.getAllExternalServices(t)},getService(t,s,a){return this.name==="Internal Services"?c.getServiceInsight({mesh:t,name:s},a):c.getExternalService({mesh:t,name:s},a)},getServiceFromMesh(t){return this.name==="Internal Services"?c.getAllServiceInsightsFromMesh({mesh:t}):c.getAllExternalServicesFromMesh({mesh:t})},parseData(t){if(this.name==="Internal Services"){const{dataplanes:i={}}=t,{online:e=0,total:u=0}=i;switch(t.totalOnline=`${e} / ${u}`,t.status){case"online":t.status=k;break;case"partially_degraded":t.status=T;break;case"offline":default:t.status=F}return t}const{networking:s={}}=t,{tls:a={}}=s;return t.address=s.address,t.tlsEnabled=a.enabled?"Enabled":"Disabled",t},init(){this.loadData()},goToPreviousPage(){this.pageOffset=this.previous.pop(),this.next=null,this.loadData()},goToNextPage(){this.previous.push(this.pageOffset),this.pageOffset=this.next,this.next=null,this.loadData()},tableAction(t){const s=t;this.getEntity(s)},loadData(t="0"){this.isLoading=!0;const s=this.$route.params.mesh||null,a=this.$route.query.ns||null,i={size:this.pageSize,offset:t},e=()=>s==="all"?this.getAllServices(i):a&&a.length&&s!=="all"?this.getService(s,a,i):this.getServiceFromMesh(s);(()=>e().then(m=>{const d=()=>{const n=m;return"total"in n?n.total!==0&&n.items&&n.items.length>0?this.sortEntities(n.items):null:n},h=d();if(d()){const n=a?h:h[0];this.getEntity(b(n)),this.tableData.data=a?[h]:h,this.next=Boolean(m.next),this.tableData.data=this.tableData.data.map(this.parseData),this.tableDataIsEmpty=!1,this.isEmpty=!1}else this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.getEntity(null)}).catch(m=>{this.hasError=!0,this.isEmpty=!0,console.error(m)}).finally(()=>{setTimeout(()=>{this.isLoading=!1},"500")}))()},getEntity(t){this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1;const s=this.$route.params.mesh;if(t&&t!==null){const a=s==="all"?t.mesh:s;return this.getService(a,t.name).then(i=>{if(i){const e=["type","name","mesh"];this.entity=N(i,e),this.rawEntity=b(i)}else this.entity={},this.entityIsEmpty=!0}).catch(i=>{this.entityHasError=!0,console.error(i)}).finally(()=>{setTimeout(()=>{this.entityIsLoading=!1},"500")})}else setTimeout(()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1},"500")}}},K=I(" > "),U=o("span",{class:"custom-control-icon"}," \u2190 ",-1),W=I(" View All ");function G(t,s,a,i,e,u){const m=l("KButton"),d=l("DataOverview"),h=l("EntityURLControl"),n=l("LabelList"),S=l("YamlView"),D=l("TabsWidget"),w=l("FrameSkeleton");return p(),E("div",null,[y(w,null,{default:r(()=>[y(d,{"page-size":e.pageSize,"has-error":e.hasError,"is-loading":e.isLoading,"empty-state":e.empty_state,"table-data":e.tableData,"table-data-is-empty":e.tableDataIsEmpty,next:e.next,onTableAction:u.tableAction,onLoadData:s[0]||(s[0]=f=>u.loadData(f))},{additionalControls:r(()=>[t.$route.query.ns?(p(),_(m,{key:0,class:"back-button",appearance:"primary",to:{name:a.routeName}},{default:r(()=>[U,W]),_:1},8,["to"])):L("",!0)]),default:r(()=>[K]),_:1},8,["page-size","has-error","is-loading","empty-state","table-data","table-data-is-empty","next","onTableAction"]),e.isEmpty===!1?(p(),_(D,{key:0,"has-error":e.hasError,"is-loading":e.isLoading,tabs:e.tabs,"initial-tab-override":"overview"},{tabHeader:r(()=>[o("div",null,[o("h3",null,g(a.name)+": "+g(e.entity.name),1)]),o("div",null,[y(h,{name:e.entity.name,mesh:e.entity.mesh},null,8,["name","mesh"])])]),overview:r(()=>[y(n,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:r(()=>[o("div",null,[o("ul",null,[(p(!0),E(O,null,V(e.entity,(f,v)=>(p(),E("li",{key:v},[o("h4",null,g(v),1),o("p",null,g(f),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])]),yaml:r(()=>[y(S,{lang:"yaml","has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty,content:e.rawEntity},null,8,["has-error","is-loading","is-empty","content"])]),_:1},8,["has-error","is-loading","tabs"])):L("",!0)]),_:1})])}const st=x(q,[["render",G]]);export{st as S};
