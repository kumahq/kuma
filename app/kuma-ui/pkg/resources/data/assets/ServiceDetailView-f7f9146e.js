import{d as L,c as d,r as N,o as a,a as i,w as l,s as g,g as r,h as o,t as h,f,e as $,F as D,b as T,j as P,k,v as F,L as K}from"./index-2a9ba339.js";import{D as O,a as w}from"./DefinitionListItem-f89cab16.js";import{_ as j}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-d2063a86.js";import{S as J}from"./StatusBadge-4403951c.js";import{T as R}from"./TagList-00620fab.js";import{T as W}from"./TextWithCopyButton-ce458937.js";import{n as q,f as A,g as G,A as H,h as M,_ as Q}from"./RouteView.vue_vue_type_script_setup_true_lang-5d6806ed.js";import{_ as U}from"./DataSource.vue_vue_type_script_setup_true_lang-c18fdd22.js";import{_ as X}from"./RouteTitle.vue_vue_type_script_setup_true_lang-4859e7c4.js";import{_ as Y}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-f5999d2a.js";import{E as Z}from"./ErrorBlock-972a2bbe.js";import{D as ee,K as te}from"./KFilterBar-5b962dd6.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-d3825514.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-1cb23237.js";const re={class:"entity-section-list"},ae={class:"entity-title"},se=L({__name:"ServiceSummary",props:{service:{},externalService:{default:null}},setup(B){const e=B,y=q(),x=d(()=>({name:"service-detail-view",params:{service:e.service.name,mesh:e.service.mesh}})),u=d(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.networking.address:e.service.addressPort??null),p=d(()=>{var s;return e.service.serviceType==="external"&&e.externalService!==null?(s=e.externalService.networking.tls)!=null&&s.enabled?"Enabled":"Disabled":null}),_=d(()=>{var s,c;if(e.service.serviceType==="external")return null;{const t=((s=e.service.dataplanes)==null?void 0:s.online)??0,b=((c=e.service.dataplanes)==null?void 0:c.total)??0;return`${t} online / ${b} total`}}),m=d(()=>e.service.serviceType==="external"?null:e.service.status??null),S=d(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.tags:null);async function C(s){if(e.service.serviceType==="external"&&e.externalService!==null){const{mesh:c,name:t}=e.externalService;return await y.getExternalService({mesh:c,name:t},s)}else{const{mesh:c,name:t}=e.service;return await y.getServiceInsight({mesh:c,name:t},s)}}return(s,c)=>{const t=N("router-link");return a(),i(T(P),null,{body:l(()=>[g("div",re,[g("section",null,[g("h1",ae,[g("span",null,[r(`
              Service:

              `),o(W,{text:e.service.name},{default:l(()=>[o(t,{to:x.value},{default:l(()=>[r(h(e.service.name),1)]),_:1},8,["to"])]),_:1},8,["text"])]),r(),m.value?(a(),i(J,{key:0,status:m.value},null,8,["status"])):f("",!0)]),r(),o(O,{class:"mt-4"},{default:l(()=>[o(w,{term:"Address"},{default:l(()=>[u.value!==null?(a(),$(D,{key:0},[r(h(u.value),1)],64)):(a(),$(D,{key:1},[r(`
                —
              `)],64))]),_:1}),r(),p.value!==null?(a(),i(w,{key:0,term:"TLS"},{default:l(()=>[r(h(p.value),1)]),_:1})):f("",!0),r(),_.value!==null?(a(),i(w,{key:1,term:"Data Plane Proxies"},{default:l(()=>[r(h(_.value),1)]),_:1})):f("",!0),r(),S.value!==null?(a(),i(w,{key:2,term:"Tags"},{default:l(()=>[o(R,{tags:S.value},null,8,["tags"])]),_:1})):f("",!0)]),_:1})]),r(),o(j,{id:"code-block-service","resource-fetcher":C,"resource-fetcher-watch-key":e.service.name,"is-searchable":"","show-copy-as-kubernetes-button":e.service.serviceType==="external"&&e.externalService!==null,"code-max-height":"250px"},null,8,["resource-fetcher-watch-key","show-copy-as-kubernetes-button"])])]),_:1})}}});const le=A(se,[["__scopeId","data-v-31d05cbc"]]),ne={class:"service-details"},ie=L({__name:"ServiceDetailView",props:{page:{},size:{},search:{},query:{},gatewayType:{},mesh:{},service:{}},setup(B){const e=B,y=q(),{t:x}=G(),u=k(null),p=k(null),_=k(!0),m=k(null);S();function S(){C()}async function C(){_.value=!0,m.value=null,u.value=null,p.value=null;const s=e.mesh,c=e.service;try{u.value=await y.getServiceInsight({mesh:s,name:c}),u.value.serviceType==="external"&&(p.value=await y.getExternalServiceByServiceInsightName(s,c))}catch(t){t instanceof Error?m.value=t:console.error(t)}finally{_.value=!1}}return(s,c)=>(a(),i(Q,null,{default:l(({route:t})=>[o(X,{title:T(x)("services.routes.item.title",{name:t.params.service})},null,8,["title"]),r(),o(H,{breadcrumbs:[{to:{name:"services-list-view",params:{mesh:t.params.mesh}},text:T(x)("services.routes.item.breadcrumbs")}]},{default:l(()=>{var b;return[g("div",ne,[_.value?(a(),i(M,{key:0})):m.value!==null?(a(),i(Z,{key:1,error:m.value},null,8,["error"])):u.value===null?(a(),i(Y,{key:2})):(a(),$(D,{key:3},[o(le,{service:u.value,"external-service":p.value},null,8,["service","external-service"]),r(),((b=u.value)==null?void 0:b.serviceType)!=="external"?(a(),i(U,{key:0,src:`/${t.params.mesh}/dataplanes/for/${t.params.service}/of/${e.gatewayType}?page=${e.page}&size=${e.size}&search=${e.search}`},{default:l(({data:v,error:E})=>{var z;return[(a(!0),$(D,null,F([typeof((z=v==null?void 0:v.items)==null?void 0:z[0].dataplane.networking.gateway)>"u"],V=>(a(),i(ee,{key:V,"data-testid":"data-plane-collection",class:"data-plane-collection","page-number":e.page,"page-size":e.size,total:v==null?void 0:v.total,items:v==null?void 0:v.items,error:E,gateways:V,onChange:({page:n,size:I})=>{t.update({page:String(n),size:String(I)})}},{toolbar:l(()=>[o(te,{class:"data-plane-proxy-filter",placeholder:"tag: 'kuma.io/protocol: http'",query:e.query,fields:{name:{description:"filter by name or parts of a name"},protocol:{description:"filter by “kuma.io/protocol” value"},tag:{description:"filter by tags (e.g. “tag: version:2”)"},zone:{description:"filter by “kuma.io/zone” value"}},onFieldsChange:n=>t.update({query:n.query,s:n.query.length>0?JSON.stringify(n.fields):""})},null,8,["placeholder","query","fields","onFieldsChange"]),r(),V?(a(),i(T(K),{key:0,label:"Type","overlay-label":!0,items:[{label:"All",value:"all"},{label:"Builtin",value:"builtin"},{label:"Delegated",value:"delegated"}].map(n=>({...n,selected:n.value===e.gatewayType})),appearance:"select",onSelected:n=>t.update({gatewayType:String(n.value)})},{"item-template":l(({item:n})=>[r(h(n.label),1)]),_:2},1032,["items","onSelected"])):f("",!0)]),_:2},1032,["page-number","page-size","total","items","error","gateways","onChange"]))),128))]}),_:2},1032,["src"])):f("",!0)],64))])]}),_:2},1032,["breadcrumbs"])]),_:1}))}});const be=A(ie,[["__scopeId","data-v-31a8675c"]]);export{be as default};
