import{d as me,a7 as ye,a6 as fe,r as f,p,o,w as e,b as t,m as _,F as Z,a0 as ce,a8 as ke,c,e as n,N as b,L as z,q as x,O as g,T as be,l as X,t as d,M as ge,y as ve,_ as _e}from"./index-DvzRYi53.js";import{S as xe}from"./SummaryView-BFpL6Jzr.js";import{T as we}from"./TagList-C4t2Qcf3.js";import{C as P,a as A,b as E}from"./ConnectionTraffic-DtmVPQnS.js";import{K as T,C as S}from"./kri-CjUta6FR.js";const Ce=me({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(L){const q=ye(),r=L;return fe("data-plane-overview",r.data),(ze,a)=>{const h=f("XI18n"),ee=f("XNotification"),R=f("XIcon"),V=f("DataCollection"),m=f("XLayout"),D=f("XAction"),v=f("XBadge"),te=f("XCopyButton"),ae=f("XAboutCard"),K=f("XEmptyState"),ne=f("XCard"),oe=f("RouterView"),se=f("AppView"),re=f("DataLoader"),B=f("DataSource"),ie=f("RouteView");return o(),p(ie,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:e(({route:u,t:l,can:$,uri:N})=>[t(B,{src:N(_(Z),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:u.params.mesh,name:u.params.proxy})},{default:e(({data:w})=>[t(B,{src:N(_(ce),"/meshes/:mesh/dataplanes/:name/layout",{mesh:u.params.mesh,name:u.params.proxy})},{default:e(({data:y,refresh:de,error:pe})=>[t(B,{src:N(_(Z),"/policy-types",{})},{default:e(({data:O})=>[t(B,{src:N(_(ke),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[u.params.proxyType]??"dataplane",name:u.params.proxy,mesh:u.params.mesh||"*",socketAddress:"self_inbound"})},{default:e(({data:C,error:le,refresh:ue})=>[t(re,{data:[y,w,O,C]},{default:e(()=>[t(se,{notifications:!0},{default:e(()=>{var j,F,G,M,H,J,Q,U,W,Y;return[(o(!0),c(b,null,z([{bool:((F=(j=r.data.dataplaneInsight.version)==null?void 0:j.kumaDp)==null?void 0:F.kumaCpCompatible)===!1,key:"dp-cp-incompatible",params:{kumaDp:((G=r.data.dataplaneInsight.version)==null?void 0:G.kumaDp.version)??""}},{bool:((H=(M=r.data.dataplaneInsight.version)==null?void 0:M.envoy)==null?void 0:H.kumaDpCompatible)===!1,key:"envoy-dp-incompatible",params:{envoy:((J=r.data.dataplaneInsight.version)==null?void 0:J.envoy.version)??"",kumaDp:((Q=r.data.dataplaneInsight.version)==null?void 0:Q.kumaDp.version)??""}},{bool:!!($("use zones")&&r.data.zone&&((W=(U=r.data.dataplaneInsight.version)==null?void 0:U.kumaDp)==null?void 0:W.kumaCpCompatible)===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:((Y=r.data.dataplaneInsight.version)==null?void 0:Y.kumaDp.version)??""}},{bool:r.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:r.data.isCertExpired,key:"certificate-expired"},{bool:!r.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!$("use transparent-proxying",r.data),key:"networking-transparent-proxying",variant:"info"}],({bool:s,key:i,params:k,variant:I})=>(o(),p(ee,{key:i,notify:s,"data-testid":`warning-${i}`,uri:`data-planes.notifications.${i}.${r.data.id}`,variant:I},{default:e(()=>[t(h,{path:`data-planes.notifications.${i}`,params:Object.fromEntries(Object.entries(k??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),a[47]||(a[47]=n()),t(m,{type:"stack","data-testid":"dataplane-details"},{default:e(()=>[t(ae,{title:l("data-planes.routes.item.about.title"),created:r.data.creationTime,modified:r.data.modificationTime,class:"about-section"},{default:e(()=>[t(m,null,{default:e(()=>[t(m,{type:"separated"},{default:e(()=>[t(g,{layout:"horizontal"},{title:e(()=>[n(d(l("http.api.property.status")),1)]),body:e(()=>[t(m,{type:"separated"},{default:e(()=>[t(be,{status:r.data.status},null,8,["status"]),a[0]||(a[0]=n()),r.data.dataplaneType==="standard"?(o(),p(V,{key:0,items:r.data.dataplane.networking.inbounds,predicate:s=>s.state!=="Ready",empty:!1},{default:e(({items:s})=>[t(R,{name:"info"},{default:e(()=>[X("ul",null,[(o(!0),c(b,null,z(s,i=>(o(),c("li",{key:`${i.service}:${i.port}`},d(l("data-planes.routes.item.unhealthy_inbound",{service:i.service,port:i.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):x("",!0)]),_:2},1024)]),_:2},1024),a[7]||(a[7]=n()),$("use zones")&&r.data.zone?(o(),p(g,{key:0,layout:"horizontal"},{title:e(()=>[n(d(l("http.api.property.zone")),1)]),body:e(()=>[t(v,{appearance:"decorative"},{default:e(()=>[t(D,{to:{name:"zone-cp-detail-view",params:{zone:r.data.zone}}},{default:e(()=>[n(d(r.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2},1024)):x("",!0),a[8]||(a[8]=n()),t(g,{layout:"horizontal"},{title:e(()=>[n(d(l("http.api.property.type")),1)]),body:e(()=>[t(v,{appearance:"decorative"},{default:e(()=>[n(d(l(`data-planes.type.${r.data.dataplaneType}`)),1)]),_:2},1024)]),_:2},1024),a[9]||(a[9]=n()),r.data.namespace.length>0?(o(),p(g,{key:1,layout:"horizontal"},{title:e(()=>[n(d(l("http.api.property.namespace")),1)]),body:e(()=>[t(v,{appearance:"decorative"},{default:e(()=>[n(d(r.data.namespace),1)]),_:1})]),_:2},1024)):x("",!0),a[10]||(a[10]=n()),t(g,{layout:"horizontal"},{title:e(()=>[n(d(l("http.api.property.address")),1)]),body:e(()=>[t(te,{variant:"badge",format:"default",text:`${r.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024),a[11]||(a[11]=n()),r.data.dataplane.networking.gateway?(o(),p(g,{key:2,layout:"horizontal"},{title:e(()=>[n(d(l("http.api.property.tags")),1)]),body:e(()=>[t(we,{tags:r.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024)):x("",!0)]),_:2},1024),a[30]||(a[30]=n()),r.data.dataplaneInsight.mTLS?(o(),p(m,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:e(()=>[X("h3",null,d(l("data-planes.routes.item.mtls.title")),1),a[21]||(a[21]=n()),t(m,{size:"small"},{default:e(()=>[(o(!0),c(b,null,z([r.data.dataplaneInsight.mTLS],s=>(o(),c(b,{key:s},[t(m,{type:"separated"},{default:e(()=>[typeof s.lastCertificateRegeneration<"u"&&typeof s.certificateExpirationTime<"u"&&typeof s.issuedBackend<"u"?(o(),c(b,{key:0},[t(g,{layout:"horizontal"},{title:e(()=>[t(h,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:e(()=>[t(v,{appearance:"neutral"},{default:e(()=>[n(d(l("common.formats.datetime",{value:Date.parse(s.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2},1024),a[14]||(a[14]=n()),t(g,{layout:"horizontal"},{title:e(()=>[t(h,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:e(()=>[t(v,{appearance:"neutral"},{default:e(()=>[n(d(l("common.formats.datetime",{value:Date.parse(s.certificateExpirationTime)})),1)]),_:2},1024)]),_:2},1024)],64)):(o(),p(h,{key:1,path:"data-planes.routes.item.mtls.managed_externally"}))]),_:2},1024),a[20]||(a[20]=n()),t(m,{type:"separated"},{default:e(()=>[typeof s.certificateRegenerations<"u"?(o(),p(g,{key:0,layout:"horizontal"},{title:e(()=>[n(d(l("data-planes.routes.item.mtls.regenerations.title")),1)]),body:e(()=>[t(v,{appearance:"info"},{default:e(()=>[n(d(l("common.formats.integer",{value:s.certificateRegenerations})),1)]),_:2},1024)]),_:2},1024)):x("",!0),a[18]||(a[18]=n()),s.issuedBackend?(o(),p(g,{key:1,layout:"horizontal"},{title:e(()=>[n(d(l("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:e(()=>[_(T).isKri(s.issuedBackend)?(o(),p(D,{key:0,to:{name:"data-plane-mesh-identity-summary-view",params:{..._(T).fromString(s.issuedBackend)}}},{default:e(()=>[t(v,{appearance:"decorative"},{default:e(()=>[n(d(s.issuedBackend),1)]),_:2},1024)]),_:2},1032,["to"])):(o(),p(v,{key:1,appearance:"decorative"},{default:e(()=>[n(d(s.issuedBackend),1)]),_:2},1024))]),_:2},1024)):x("",!0),a[19]||(a[19]=n()),typeof s.supportedBackends<"u"?(o(),p(g,{key:2,layout:"horizontal"},{title:e(()=>[n(d(l("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:e(()=>[t(m,{type:"separated",truncate:""},{default:e(()=>[(o(!0),c(b,null,z(s.supportedBackends,i=>(o(),p(v,{key:i,appearance:i===s.issuedBackend?"decorative":"info"},{default:e(()=>[n(d(i),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2},1024)):x("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):x("",!0),a[31]||(a[31]=n()),r.data.dataplaneInsight.subscriptions.length>0?(o(),p(m,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:e(()=>[t(m,{type:"separated"},{default:e(()=>[X("h3",null,d(l("data-planes.routes.item.subscriptions.title")),1),a[22]||(a[22]=n()),t(D,{"data-action":"",appearance:"anchor",to:{name:"data-plane-subscriptions-summary-view",params:{mesh:u.params.mesh,proxy:u.params.proxy},query:{inactive:u.params.inactive}}},{default:e(()=>[n(`
                            (`+d(l("data-planes.routes.item.xds.show-details"))+`)
                          `,1)]),_:2},1032,["to"])]),_:2},1024),a[28]||(a[28]=n()),(o(!0),c(b,null,z([[...r.data.dataplaneInsight.subscriptions].reverse()],s=>(o(),p(m,{key:typeof s,type:"separated"},{default:e(()=>[(o(!0),c(b,null,z([s.find(i=>!i.disconnectTime)??s[0]],i=>(o(),c(b,{key:i.id},[!i.disconnectTime&&i.connectTime?(o(),c(b,{key:0},[t(g,{layout:"horizontal"},{title:e(()=>[t(h,{path:"data-planes.routes.item.xds.connected"})]),body:e(()=>[t(v,{appearance:"neutral"},{default:e(()=>[n(d(l("common.formats.datetime",{value:Date.parse(i.connectTime)})),1)]),_:2},1024)]),_:2},1024),a[26]||(a[26]=n()),t(g,{layout:"horizontal"},{title:e(()=>[t(h,{path:"data-planes.routes.item.xds.instance"})]),body:e(()=>[t(v,{appearance:"info"},{default:e(()=>[n(d(i.controlPlaneInstanceId),1)]),_:2},1024)]),_:2},1024),a[27]||(a[27]=n()),t(g,{layout:"horizontal"},{title:e(()=>[t(h,{path:"data-planes.routes.item.xds.version"})]),body:e(()=>[t(v,{appearance:"info"},{default:e(()=>{var k,I;return[n(d(((I=(k=i.version)==null?void 0:k.kumaDp)==null?void 0:I.version)??l("common.unknown")),1)]}),_:2},1024)]),_:2},1024)],64)):(o(),p(h,{key:1,path:"data-planes.routes.item.xds.disconnected"}))],64))),128))]),_:2},1024))),128))]),_:2},1024)):x("",!0),a[32]||(a[32]=n()),w!=null&&w.policies.length?(o(),p(m,{key:2,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:e(()=>[X("h3",null,d(l("data-planes.routes.item.policies")),1),a[29]||(a[29]=n()),t(m,{type:"separated"},{default:e(()=>[(o(!0),c(b,null,z(w==null?void 0:w.policies,s=>(o(),p(D,{key:s.kind,"data-action":"",appearance:"anchor",to:{name:"data-plane-policy-config-summary-view",params:{mesh:u.params.mesh,proxy:u.params.proxy,policy:s.kind.toLowerCase()}}},{default:e(()=>[t(v,null,{default:e(()=>[n(d(s.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2},1024)):x("",!0)]),_:2},1024)]),_:2},1032,["title","created","modified"]),a[45]||(a[45]=n()),t(ne,{class:"traffic","data-testid":"dataplane-traffic"},{default:e(()=>[t(m,{type:"columns"},{default:e(()=>[t(P,null,{title:e(()=>[t(m,{type:"separated"},{default:e(()=>[t(R,{name:"inbound"}),a[33]||(a[33]=n()),a[34]||(a[34]=X("span",null,"Inbounds",-1))]),_:1})]),default:e(()=>[a[36]||(a[36]=n()),(o(!0),c(b,null,z([(y==null?void 0:y.inbounds)??[]],s=>(o(),p(A,{key:typeof s,type:"inbound","data-testid":"dataplane-inbounds"},{default:e(()=>[t(V,{type:"inbounds",items:s,predicate:i=>i.port!==49151},ge({default:e(({items:i})=>[t(m,{type:"stack",size:"small"},{default:e(()=>[(o(!0),c(b,null,z(i,k=>(o(),p(E,{key:`${k.kri}`,"data-testid":"dataplane-inbound",protocol:k.protocol,"port-name":_(S).fromString(k.proxyResourceName).sectionName,traffic:C==null?void 0:C.inbounds[_(S).toString({..._(S).fromString(k.proxyResourceName),sectionName:k.port.toString()})]},{default:e(()=>[t(D,{"data-action":"",to:{name:(I=>I.includes("bound")?I.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(_(q).name)),params:{connection:k.proxyResourceName},query:{inactive:u.params.inactive}}},{default:e(()=>[n(d(k.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},[r.data.dataplaneType==="delegated"?{name:"empty",fn:e(()=>[t(K,null,{default:e(()=>[X("p",null,`
                                    This proxy is a delegated gateway therefore `+d(l("common.product.name"))+` does not have any
                                    visibility into inbounds for this gateway.
                                  `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),a[44]||(a[44]=n()),t(P,null,{actions:e(()=>[t(D,{action:"refresh",appearance:"primary",onClick:()=>{de(),ue()}},{default:e(()=>[...a[37]||(a[37]=[n(`
                            Refresh
                          `,-1)])]),_:2},1032,["onClick"])]),title:e(()=>[t(m,{type:"separated"},{default:e(()=>[t(R,{name:"outbound"}),a[38]||(a[38]=n()),a[39]||(a[39]=X("span",null,"Outbounds",-1))]),_:1})]),default:e(()=>[a[42]||(a[42]=n()),a[43]||(a[43]=n()),typeof pe>"u"&&typeof le>"u"&&(y!=null&&y.outbounds.length)?(o(),c(b,{key:0},[t(A,{type:"passthrough"},{default:e(()=>[t(E,{protocol:"passthrough",traffic:C==null?void 0:C.passthrough},{default:e(()=>[...a[40]||(a[40]=[n(`
                              Non mesh traffic
                            `,-1)])]),_:2},1032,["traffic"])]),_:2},1024),a[41]||(a[41]=n()),t(V,{type:"outbounds",items:y==null?void 0:y.outbounds},{default:e(({items:s})=>[t(A,{type:"outbound","data-testid":"dataplane-outbounds"},{default:e(()=>[t(m,{type:"stack",size:"small"},{default:e(()=>[(o(!0),c(b,null,z(s,i=>(o(),p(E,{key:i.kri,"data-testid":"dataplane-outbound",protocol:i.protocol,"port-name":_(T).fromString(i.proxyResourceName).sectionName,traffic:C==null?void 0:C.outbounds[i.proxyResourceName]},{default:e(()=>[t(D,{"data-action":"",to:{name:(k=>k.includes("bound")?k.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(_(q).name)),params:{connection:i.proxyResourceName},query:{inactive:u.params.inactive}}},{default:e(()=>[n(d(i.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(o(),p(K,{key:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024),a[46]||(a[46]=n()),t(oe,null,{default:e(s=>[s.route.name!==u.name?(o(),p(xe,{key:0,width:s.route.name==="data-plane-subscriptions-summary-view"?"900px":"670px",onClose:function(){u.replace({name:"data-plane-detail-view",params:{mesh:u.params.mesh,proxy:u.params.proxy},query:{inactive:u.params.inactive?null:void 0}})}},{default:e(()=>[(o(),p(ve(s.Component),{data:u.params.subscription.length>0?r.data.dataplaneInsight.subscriptions:s.route.name.includes("-inbound-")?y==null?void 0:y.inbounds:y==null?void 0:y.outbounds,"data-plane-overview":r.data,networking:r.data.dataplane.networking,subscriptions:r.data.dataplaneInsight.subscriptions,policies:(w==null?void 0:w.policies)??[],"policy-types-data":O},null,8,["data","data-plane-overview","networking","subscriptions","policies","policy-types-data"]))]),_:2},1032,["width","onClose"])):x("",!0)]),_:2},1024)]),_:2},1024)]}),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:1})}}}),Ne=_e(Ce,[["__scopeId","data-v-b940e4d8"]]);export{Ne as default};
