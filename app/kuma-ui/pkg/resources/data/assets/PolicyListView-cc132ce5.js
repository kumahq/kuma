import{K as I}from"./index-fce48c05.js";import{d as $,k as B,A as L,a as d,o as s,c as v,e as r,w as a,F as V,D as N,n as E,l,f as o,t as m,m as y,b as n,p as k,R as K,_ as A,C as D}from"./index-0b4678e0.js";import{D as F,A as q}from"./AppCollection-d7519f8c.js";import{E as x}from"./ErrorBlock-1570e211.js";import{P as O}from"./PolicyTypeTag-073578b3.js";import{_ as M}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-3b71f9a1.js";import{_ as U}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-6507e090.js";import{S as Z}from"./SummaryView-337bb597.js";import"./TextWithCopyButton-bc8c6ef3.js";import"./CopyButton-18f43ddc.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-0acf695d.js";const j={class:"policy-list-content"},G={class:"policy-count"},H={class:"policy-list"},J={class:"stack"},Q={class:"description"},W={class:"description-content"},X={class:"description-actions"},Y={class:"visually-hidden"},ee={key:0},te=$({__name:"PolicyList",props:{pageNumber:{},pageSize:{},policyTypes:{},currentPolicyType:{},policyCollection:{},policyError:{},meshInsight:{},isSelectedRow:{type:[Function,null],default:null}},emits:["change"],setup(z,{emit:T}){const{t:p}=B(),w=L(),e=z,h=T;return(S,b)=>{const f=d("RouterLink"),t=d("KCard"),g=d("KBadge");return s(),v("div",j,[r(t,{class:"policy-type-list","data-testid":"policy-type-list"},{default:a(()=>[(s(!0),v(V,null,N(e.policyTypes,(c,u)=>{var i,_,C;return s(),v("div",{key:u,class:E(["policy-type-link-wrapper",{"policy-type-link-wrapper--is-active":c.path===e.currentPolicyType.path}])},[r(f,{class:"policy-type-link",to:{name:"policy-list-view",params:{mesh:l(w).params.mesh,policyPath:c.path}},"data-testid":`policy-type-link-${c.name}`},{default:a(()=>[o(m(c.name),1)]),_:2},1032,["to","data-testid"]),o(),y("div",G,m(((C=(_=(i=e.meshInsight)==null?void 0:i.policies)==null?void 0:_[c.name])==null?void 0:C.total)??0),1)],2)}),128))]),_:1}),o(),y("div",H,[y("div",J,[r(t,null,{default:a(()=>[y("div",Q,[y("div",W,[y("h3",null,[r(O,{"policy-type":e.currentPolicyType.name},{default:a(()=>[o(m(l(p)("policies.collection.title",{name:e.currentPolicyType.name})),1)]),_:1},8,["policy-type"])]),o(),y("p",null,m(l(p)(`policies.type.${e.currentPolicyType.name}.description`,void 0,{defaultMessage:l(p)("policies.collection.description")})),1)]),o(),y("div",X,[e.currentPolicyType.isExperimental?(s(),n(g,{key:0,appearance:"warning"},{default:a(()=>[o(m(l(p)("policies.collection.beta")),1)]),_:1})):k("",!0),o(),e.currentPolicyType.isInbound?(s(),n(g,{key:1,appearance:"neutral"},{default:a(()=>[o(m(l(p)("policies.collection.inbound")),1)]),_:1})):k("",!0),o(),e.currentPolicyType.isOutbound?(s(),n(g,{key:2,appearance:"neutral"},{default:a(()=>[o(m(l(p)("policies.collection.outbound")),1)]),_:1})):k("",!0),o(),r(F,{href:l(p)("policies.href.docs",{name:e.currentPolicyType.name}),"data-testid":"policy-documentation-link"},{default:a(()=>[y("span",Y,m(l(p)("common.documentation")),1)]),_:1},8,["href"])])])]),_:1}),o(),r(t,null,{default:a(()=>{var c,u;return[e.policyError!==void 0?(s(),n(x,{key:0,error:e.policyError},null,8,["error"])):(s(),n(q,{key:1,class:"policy-collection","data-testid":"policy-collection","empty-state-message":l(p)("common.emptyState.message",{type:`${e.currentPolicyType.name} policies`}),"empty-state-cta-to":l(p)("policies.href.docs",{name:e.currentPolicyType.name}),"empty-state-cta-text":l(p)("common.documentation"),headers:[{label:"Name",key:"name"},...e.currentPolicyType.isTargetRefBased?[{label:"Target ref",key:"targetRef"}]:[],{label:"Details",key:"details",hideLabel:!0}],"page-number":e.pageNumber,"page-size":e.pageSize,total:(c=e.policyCollection)==null?void 0:c.total,items:(u=e.policyCollection)==null?void 0:u.items,error:e.policyError,"is-selected-row":e.isSelectedRow,onChange:b[0]||(b[0]=i=>h("change",i))},{name:a(({row:i})=>[r(f,{to:{name:"policy-summary-view",params:{mesh:i.mesh,policyPath:e.currentPolicyType.path,policy:i.name},query:{page:e.pageNumber,size:e.pageSize}}},{default:a(()=>[o(m(i.name),1)]),_:2},1032,["to"])]),targetRef:a(({row:i})=>{var _;return[e.currentPolicyType.isTargetRefBased&&typeof((_=i.spec)==null?void 0:_.targetRef)<"u"?(s(),n(g,{key:0,appearance:"neutral"},{default:a(()=>[o(m(i.spec.targetRef.kind),1),i.spec.targetRef.name?(s(),v("span",ee,[o(":"),y("b",null,m(i.spec.targetRef.name),1)])):k("",!0)]),_:2},1024)):(s(),v(V,{key:1},[o(m(l(p)("common.detail.none")),1)],64))]}),details:a(({row:i})=>[r(f,{class:"details-link","data-testid":"details-link",to:{name:"policy-detail-view",params:{mesh:i.mesh,policyPath:e.currentPolicyType.path,policy:i.name}}},{default:a(()=>[o(m(l(p)("common.collection.details_link"))+" ",1),r(l(K),{display:"inline-block",decorative:"",size:l(I)},null,8,["size"])]),_:2},1032,["to"])]),_:1},8,["empty-state-message","empty-state-cta-to","empty-state-cta-text","headers","page-number","page-size","total","items","error","is-selected-row"]))]}),_:1})])])])}}});const ae=A(te,[["__scopeId","data-v-097a281b"]]),ue=$({__name:"PolicyListView",setup(z){return(T,p)=>{const w=d("RouteTitle"),e=d("RouterView"),h=d("DataSource"),S=d("AppView"),b=d("RouteView");return s(),n(h,{src:"/me"},{default:a(({data:f})=>[f?(s(),n(b,{key:0,name:"policy-list-view",params:{page:1,size:f.pageSize,mesh:"",policyPath:"",policy:""}},{default:a(({route:t,t:g})=>[r(S,null,{title:a(()=>[y("h2",null,[r(w,{title:g("policies.routes.items.title")},null,8,["title"])])]),default:a(()=>[o(),r(h,{src:"/*/policy-types"},{default:a(({data:c,error:u})=>[u?(s(),n(x,{key:0,error:u},null,8,["error"])):c===void 0?(s(),n(U,{key:1})):c.policies.length===0?(s(),n(M,{key:2})):(s(),n(h,{key:3,src:`/meshes/${t.params.mesh}/policy-path/${t.params.policyPath}?page=${t.params.page}&size=${t.params.size}`},{default:a(({data:i,error:_})=>[r(h,{src:`/mesh-insights/${t.params.mesh}`},{default:a(({data:C})=>[(s(),n(ae,{key:t.params.policyPath,"page-number":parseInt(t.params.page),"page-size":parseInt(t.params.size),"current-policy-type":c.policies.find(P=>P.path===t.params.policyPath)??c.policies[0],"policy-types":c.policies,"mesh-insight":C,"policy-collection":i,"policy-error":_,"is-selected-row":P=>P.name===t.params.policy,onChange:t.update},null,8,["page-number","page-size","current-policy-type","policy-types","mesh-insight","policy-collection","policy-error","is-selected-row","onChange"])),o(),t.params.policy?(s(),n(e,{key:0},{default:a(P=>[r(Z,{onClose:R=>t.replace({name:"policy-list-view",params:{mesh:t.params.mesh,policyPath:t.params.policyPath},query:{page:t.params.page,size:t.params.size}})},{default:a(()=>[(s(),n(D(P.Component),{name:t.params.policy,policy:i==null?void 0:i.items.find(R=>R.name===t.params.policy),"policy-type":c.policies.find(R=>R.path===t.params.policyPath)},null,8,["name","policy","policy-type"]))]),_:2},1032,["onClose"])]),_:2},1024)):k("",!0)]),_:2},1032,["src"])]),_:2},1032,["src"]))]),_:2},1024)]),_:2},1024)]),_:2},1032,["params"])):k("",!0)]),_:1})}}});export{ue as default};
