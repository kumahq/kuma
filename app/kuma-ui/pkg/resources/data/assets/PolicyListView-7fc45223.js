import{d as W,M as J,I as Y,x as j,J as G}from"./kongponents.es-5adaddec.js";import{d as U,o as r,e as v,w as l,g as _,b as t,h as c,a as H,u as Z,r as f,c as A,v as X,a5 as ee,E as te,j as M,i as p,f as P,Y as V,B as C,t as x,F as ae,q as se,p as oe,m as le}from"./index-a24b4f04.js";import{_ as ne}from"./PolicyConnections.vue_vue_type_script_setup_true_lang-788a118e.js";import{D as ie}from"./DataOverview-8bfe7e82.js";import{D as re,a as ce}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-8ed542ca.js";import{T as pe}from"./TabsWidget-6a5a1765.js";import{_ as ue}from"./YamlView.vue_vue_type_script_setup_true_lang-e4ffe560.js";import{u as me}from"./store-07fabdaf.js";import{u as de,a as ye}from"./index-f7ac63b4.js";import{Q as L}from"./QueryParameter-70743f73.js";import{_ as he}from"./_plugin-vue_export-helper-c27b6911.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-b3124157.js";import"./ErrorBlock-8e1d70a5.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-4f020979.js";import"./datadogLogEvents-302eea7b.js";import"./TagList-67c1d0cb.js";import"./StatusBadge-ab90d1ed.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-7b080a3a.js";import"./toYaml-4e00099e.js";const fe=U({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(u){const i=u;return(D,S)=>(r(),v(t(J),{class:"docs-link",appearance:"outline",target:"_blank",to:i.href},{default:l(()=>[_(t(W),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),c(`

    Documentation
  `)]),_:1},8,["to"]))}}),ve=u=>(oe("data-v-690d747e"),u=u(),le(),u),_e={class:"kcard-stack"},ge={class:"kcard-border"},be=ve(()=>p("p",null,[p("strong",null,"Warning"),c(` This policy is experimental. If you encountered any problem please open an
                  `),p("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),ke={class:"kcard-border"},Pe={class:"entity-heading","data-testid":"policy-single-entity"},we=U({__name:"PolicyListView",props:{selectedPolicyName:{type:[String,null],required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(u){const i=u,D=de(),S=ye(),$=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],q=H(),w=Z(),g=me(),T=f(!0),b=f(null),m=f(null),d=f(null),N=f(null),I=f(i.offset),k=f({headers:[{label:"Name",key:"entity"},{label:"Type",key:"type"}],data:[]}),n=A(()=>g.state.policyTypesByPath[i.policyPath]),R=A(()=>g.state.policyTypes.map(e=>({label:e.name,value:e.path,selected:e.path===i.policyPath}))),z=A(()=>g.state.policyTypes.filter(e=>(g.state.sidebar.insights.mesh.policies[e.name]??0)===0).map(e=>e.name));X(()=>w.params.mesh,function(){w.name===i.policyPath&&E(0)}),E(i.offset);async function E(e){var y;I.value=e,L.set("offset",e>0?e:null),T.value=!0,b.value=null;const o=w.params.mesh,s=n.value.path,a=C;try{const{items:h,next:Q}=await D.getAllPolicyEntitiesFromMesh({mesh:o,path:s},{size:a,offset:e});N.value=Q,k.value.data=F(h??[]),await B({name:i.selectedPolicyName??((y=k.value.data[0])==null?void 0:y.entity.name),mesh:o,path:s})}catch(h){k.value.data=[],m.value=null,h instanceof Error?b.value=h:console.error(h)}finally{T.value=!1}}function F(e){return e.map(o=>{const{type:s,name:a}=o,y=g.state.policyTypesByName[s],h={name:"policy-detail-view",params:{mesh:o.mesh,policyPath:y.path,policy:a}};return{entity:o,detailViewRoute:h,type:s}})}async function O(e){const{name:o,mesh:s}=e,a=n.value.path;await B({name:o,mesh:s,path:a})}async function B({name:e,mesh:o,path:s}){if(e===void 0){m.value=null,d.value=null,L.set("policy",null);return}try{const a=await D.getSinglePolicyEntity({mesh:o,path:s,name:e});m.value=ee(a,["type","name","mesh"]),L.set("policy",a.name),d.value=te(a)}catch(a){console.error(a)}}function K(e){q.push({name:"policy",params:{...w.params,policyPath:e.value}})}return(e,o)=>{var s;return t(n)?(r(),M("div",{key:0,class:V(["relative",t(n).path])},[p("div",_e,[p("div",ge,[t(n).isExperimental?(r(),v(t(j),{key:0,"border-variant":"noBorder",class:"mb-4"},{body:l(()=>[_(t(Y),{appearance:"warning"},{alertMessage:l(()=>[be]),_:1})]),_:1})):P("",!0),c(),_(ie,{"selected-entity-name":(s=m.value)==null?void 0:s.name,"page-size":t(C),error:b.value,"is-loading":T.value,"empty-state":{title:"No Data",message:`There are no ${t(n).name} policies present.`},"table-data":k.value,"table-data-is-empty":k.value.data.length===0,next:N.value,"page-offset":I.value,onTableAction:O,onLoadData:E},{additionalControls:l(()=>[_(t(G),{label:"Policies",items:t(R),"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:K},{"item-template":l(({item:a})=>[p("span",{class:V({"policy-type-empty":t(z).includes(a.label)})},x(a.label),3)]),_:1},8,["items"]),c(),_(fe,{href:`${t(S)("KUMA_DOCS_URL")}/policies/${t(n).path}/?${t(S)("KUMA_UTM_QUERY_PARAMS")}`,"data-testid":"policy-documentation-link"},null,8,["href"])]),default:l(()=>[c(`
          >
          `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"])]),c(),p("div",ke,[m.value!==null?(r(),v(pe,{key:0,"has-error":b.value!==null,error:b.value,"is-loading":T.value,tabs:$},{tabHeader:l(()=>[p("h1",Pe,x(t(n).name)+": "+x(m.value.name),1)]),overview:l(()=>[_(ce,{"data-testid":"policy-detail-label-list"},{default:l(()=>[(r(!0),M(ae,null,se(m.value,(a,y)=>(r(),v(re,{key:y,term:y},{default:l(()=>[c(x(a),1)]),_:2},1032,["term"]))),128))]),_:1}),c(),d.value!==null?(r(),v(ue,{key:0,id:"code-block-policy",class:"mt-4",content:d.value,"is-searchable":""},null,8,["content"])):P("",!0)]),"affected-dpps":l(()=>[d.value!==null?(r(),v(ne,{key:0,mesh:d.value.mesh,"policy-name":d.value.name,"policy-type":t(n).path},null,8,["mesh","policy-name","policy-type"])):P("",!0)]),_:1},8,["has-error","error","is-loading"])):P("",!0)])])],2)):P("",!0)}}});const Oe=he(we,[["__scopeId","data-v-690d747e"]]);export{Oe as default};
