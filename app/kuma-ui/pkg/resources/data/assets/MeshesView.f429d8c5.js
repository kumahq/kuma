import{_ as M,P as B,a4 as V,m as A,u as H,x as z,K as E,j as T,s as F,X as K,Z as N,e as s,a as f,w as m,r as b,o as a,b as k,c as w,f as o,t as h,k as C,F as I,h as L,p as P,l as O}from"./index.dbfc69fe.js";import{g as R}from"./tableDataUtils.76735c08.js";import{F as Y}from"./FrameSkeleton.525fa295.js";import{D as W}from"./DataOverview.e98f79d2.js";import{T as j}from"./TabsWidget.ad5c32a1.js";import{Y as Z}from"./YamlView.aa325bb9.js";import{L as q}from"./LabelList.9e6f9cac.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.5dc5cc90.js";import"./ErrorBlock.f52010c3.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.f2781028.js";import"./index.58caa11d.js";import"./CodeBlock.83ca39be.js";import"./_commonjsHelpers.712cc82f.js";const G={name:"MeshesView",components:{FrameSkeleton:Y,DataOverview:W,TabsWidget:j,YamlView:Z,LabelList:q},data(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,empty_state:{title:"No Data",message:"There are no Meshes present."},tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Type",key:"type"}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#resources",title:"Resources"}],entity:{},rawEntity:{},pageSize:B,next:null,itemsPerCol:3,meshInsight:V()}},computed:{...A({policies:t=>t.policies}),counts(){const t=this.policies.map(i=>{var p;return{title:i.pluralDisplayName,value:((p=this.meshInsight.policies[i.name])==null?void 0:p.total)||0}});return[{title:"Data plane proxies",value:this.meshInsight.dataplanes.total},...t]},countCols(){return Math.ceil(this.counts.length/this.itemsPerCol)}},watch:{$route(){this.isLoading=!0,this.isEmpty=!1,this.hasError=!1,this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,this.tableDataIsEmpty=!1,this.loadData()}},beforeMount(){this.init()},methods:{init(){this.loadData()},onCreateClick(){H.logger.info(z.CREATE_MESH_CLICKED)},tableAction(t){const i=t;this.getEntity(i)},async loadData(t="0"){this.isLoading=!0,this.isEmpty=!1;const i=this.$route.params.mesh;let p;i!=="all"&&(p=this.$route.params.mesh);try{const{data:y,next:e}=await R({getSingleEntity:E.getMesh.bind(E),getAllEntities:E.getAllMeshes.bind(E),size:this.pageSize,offset:t,query:p});this.next=e,y.length?(this.tableData.data=[...y],this.tableDataIsEmpty=!1,this.isEmpty=!1,this.getEntity({name:y[0].name})):(this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.entityIsEmpty=!0)}catch(y){this.hasError=!0,this.isEmpty=!0,console.error(y)}finally{this.isLoading=!1}},getEntity(t){if(this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,t&&t!==null)return E.getMesh({name:t.name}).then(i=>{if(i){E.getMeshInsights({name:t.name}).then(n=>{this.meshInsight=n});const p=T(i,["type","name"]),y=()=>{const n=Object.entries(T(i,["mtls","logging","metrics","tracing"])),_=[];return n.forEach(v=>{const g=v[0],l=v[1]||null;if(l&&l.enabledBackend){const d=l.enabledBackend,u=l.backends.find(D=>D.name===d);u&&_.push({label:g,value:{type:u.type,name:u.name}})}else if(l&&l.defaultBackend){const d=l.defaultBackend,u=l.backends.find(D=>D.name===d);u&&_.push({label:g,value:{type:u.type,name:u.name}})}else if(l&&l.backends){const d=l.backends[0];d&&_.push({label:g,value:{type:d.type,name:d.name}})}else _.push({label:g,value:null})}),_},e=()=>{const{routing:n}=i;return n&&n.localityAwareLoadBalancing};this.entity={basicData:p,extendedData:y(),localityEnabled:e()},this.rawEntity=F(i)}else this.entity={},this.entityIsEmpty=!0}).catch(i=>{this.entityHasError=!0,console.error(i)}).finally(()=>{setTimeout(()=>{this.entityIsLoading=!1},"500")});setTimeout(()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1},"500")},formatValue(t){return t?t.toLocaleString("en").toString():0},readableDate(t){return K(t)},rawDate(t){return N(t)}}},x=t=>(P("data-v-0fe9e439"),t=t(),O(),t),U={class:"all-meshes"},X=x(()=>o("span",{class:"custom-control-icon"}," + ",-1)),J={key:0},Q={key:0},$={key:1},ee={key:2},te={key:3},ae={key:4},se={key:0},ie={key:0,class:"label-cols"},ne=x(()=>o("h4",null,"Locality Aware Loadbalancing",-1)),oe={key:0},le={class:"config-wrapper"};function re(t,i,p,y,e,n){const _=b("KButton"),v=b("DataOverview"),g=b("KBadge"),l=b("LabelList"),d=b("YamlView"),u=b("TabsWidget"),D=b("FrameSkeleton");return a(),s("div",U,[f(D,null,{default:m(()=>[f(v,{"page-size":e.pageSize,"has-error":e.hasError,"is-loading":e.isLoading,"empty-state":e.empty_state,"table-data":e.tableData,"table-data-is-empty":e.tableDataIsEmpty,next:e.next,onTableAction:n.tableAction,onLoadData:i[0]||(i[0]=r=>n.loadData(r))},{additionalControls:m(()=>[f(_,{class:"add-mesh-button",appearance:"primary",to:{path:"/wizard/mesh"},onClick:n.onCreateClick},{default:m(()=>[X,k(" Create Mesh ")]),_:1},8,["onClick"])]),_:1},8,["page-size","has-error","is-loading","empty-state","table-data","table-data-is-empty","next","onTableAction"]),e.isEmpty===!1?(a(),w(u,{key:0,"has-error":e.hasError,"is-loading":e.isLoading,tabs:e.tabs,"initial-tab-override":"overview"},{tabHeader:m(()=>[e.entity.basicData?(a(),s("div",J,[o("h3",null," Mesh: "+h(e.entity.basicData.name),1)])):C("",!0)]),overview:m(()=>[f(l,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:m(()=>[o("div",null,[o("ul",null,[(a(!0),s(I,null,L(e.entity.basicData,(r,c)=>(a(),s("li",{key:c},[c==="creationTime"?(a(),s("h4",Q," Created ")):c==="modificationTime"?(a(),s("h4",$," Last Modified ")):(a(),s("h4",ee,h(c),1)),c==="creationTime"||c==="modificationTime"?(a(),s("p",te,[k(h(n.readableDate(r))+" ",1),o("em",null,"("+h(n.rawDate(r))+")",1)])):(a(),s("p",ae,h(r),1))]))),128))])]),e.entity.extendedData&&e.entity.extendedData.length?(a(),s("div",se,[o("ul",null,[(a(!0),s(I,null,L(e.entity.extendedData,(r,c)=>(a(),s("li",{key:c},[o("h4",null,h(r.label),1),r.value?(a(),s("p",ie,[o("span",null,h(r.value.type),1),o("span",null,h(r.value.name),1)])):(a(),w(g,{key:1,appearance:"danger"},{default:m(()=>[k(" Disabled ")]),_:1}))]))),128)),o("li",null,[ne,e.entity.localityEnabled?(a(),s("p",oe,[f(g,{appearance:"success"},{default:m(()=>[k(" Enabled ")]),_:1})])):(a(),w(g,{key:1,appearance:"danger"},{default:m(()=>[k(" Disabled ")]),_:1}))])])])):C("",!0)]),_:1},8,["has-error","is-loading","is-empty"]),o("div",le,[f(d,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty,content:e.rawEntity},null,8,["has-error","is-loading","is-empty","content"])])]),resources:m(()=>[f(l,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:m(()=>[(a(!0),s(I,null,L(n.countCols,r=>(a(),s("div",{key:r},[o("ul",null,[(a(!0),s(I,null,L(n.counts.slice((r-1)*e.itemsPerCol,r*e.itemsPerCol),(c,S)=>(a(),s("li",{key:S},[o("h4",null,h(c.title),1),o("p",null,h(n.formatValue(c.value)),1)]))),128))])]))),128))]),_:1},8,["has-error","is-loading","is-empty"])]),_:1},8,["has-error","is-loading","tabs"])):C("",!0)]),_:1})])}const ke=M(G,[["render",re],["__scopeId","data-v-0fe9e439"]]);export{ke as default};
