import{A as K,a as V}from"./AccordionList-3382dfcc.js";import{d as D,a as k,o as e,c as a,p as i,f as s,F as u,I as b,t as p,e as y,w as t,s as T,b as o,a0 as O,y as z,z as j,_ as x,q as w,l as q,n as Q}from"./index-ea965263.js";import{_ as H}from"./CodeBlock.vue_vue_type_style_index_0_lang-3c0b83fa.js";import{P as Y}from"./PolicyTypeTag-7fca4c63.js";import{T as G}from"./TagList-dcb139e4.js";import{t as E}from"./toYaml-4e00099e.js";import{_ as U}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-e773073b.js";import{E as S}from"./ErrorBlock-3fedc145.js";import{_ as M}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-8506545c.js";import"./index-fce48c05.js";import"./TextWithCopyButton-a4811d0e.js";import"./CopyButton-4688f896.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-9e6ee0cb.js";const N=h=>(z("data-v-ab96b2ac"),h=h(),j(),h),W={class:"policies-list","data-testid":"builtin-gateway-dataplane-policies"},X={class:"mesh-gateway-policy-list"},Z=N(()=>i("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),ee={key:0},te=N(()=>i("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),ae=N(()=>i("b",null,"Host",-1)),se=N(()=>i("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),le={class:"dataplane-policy-header"},ne=N(()=>i("b",null,"Route",-1)),oe=N(()=>i("b",null,"Service",-1)),ie={key:0,class:"badge-list"},ce={class:"mt-1"},pe=D({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},policyTypesByName:{}},setup(h){const m=h;return(n,P)=>{const v=k("RouterLink"),g=k("KBadge");return e(),a("div",W,[i("div",X,[Z,s(),n.gatewayDataplane.routePolicies.length>0?(e(),a("ul",ee,[(e(!0),a(u,null,b(n.gatewayDataplane.routePolicies,(c,_)=>(e(),a("li",{key:_},[i("span",null,p(c.type),1),s(`:

          `),y(v,{to:{name:"policy-detail-view",params:{mesh:c.mesh,policyPath:m.policyTypesByName[c.type].path,policy:c.name}}},{default:t(()=>[s(p(c.name),1)]),_:2},1032,["to"])]))),128))])):T("",!0),s(),te,s(),i("div",null,[(e(!0),a(u,null,b(n.gatewayDataplane.listenerEntries,(c,_)=>(e(),a("div",{key:_},[i("div",null,[i("div",null,[ae,s(": "+p(c.hostName)+":"+p(c.port)+" ("+p(c.protocol)+`)
            `,1)]),s(),c.routeEntries.length>0?(e(),a(u,{key:0},[se,s(),y(V,{"initially-open":[],"multiple-open":""},{default:t(()=>[(e(!0),a(u,null,b(c.routeEntries,(d,r)=>(e(),o(K,{key:r},O({"accordion-header":t(()=>[i("div",le,[i("div",null,[i("div",null,[ne,s(": "),y(v,{to:{name:"policy-detail-view",params:{mesh:d.route.mesh,policyPath:m.policyTypesByName[d.route.type].path,policy:d.route.name}}},{default:t(()=>[s(p(d.route.name),1)]),_:2},1032,["to"])]),s(),i("div",null,[oe,s(": "+p(d.service),1)])]),s(),d.origins.length>0?(e(),a("div",ie,[(e(!0),a(u,null,b(d.origins,(l,f)=>(e(),o(g,{key:`${_}-${f}`},{default:t(()=>[s(p(l.type),1)]),_:2},1024))),128))])):T("",!0)])]),_:2},[d.origins.length>0?{name:"accordion-content",fn:t(()=>[i("ul",ce,[(e(!0),a(u,null,b(d.origins,(l,f)=>(e(),a("li",{key:`${_}-${f}`},[s(p(l.type)+`:

                        `,1),y(v,{to:{name:"policy-detail-view",params:{mesh:l.mesh,policyPath:m.policyTypesByName[l.type].path,policy:l.name}}},{default:t(()=>[s(p(l.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):T("",!0)])]))),128))])])])}}});const re=x(pe,[["__scopeId","data-v-ab96b2ac"]]),ue={class:"policy-type-heading"},ye={class:"policy-list"},de={key:0},_e=D({__name:"PolicyTypeEntryList",props:{id:{},policyTypeEntries:{},policyTypesByName:{}},setup(h){const m=h;function n({headerKey:P}){return{class:`cell-${P}`}}return(P,v)=>{const g=k("RouterLink"),c=k("KTable");return e(),o(V,{"initially-open":[],"multiple-open":""},{default:t(()=>[(e(!0),a(u,null,b(m.policyTypeEntries,(_,d)=>(e(),o(K,{key:d},{"accordion-header":t(()=>[i("h3",ue,[y(Y,{"policy-type":_.type},{default:t(()=>[s(p(_.type)+" ("+p(_.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":t(()=>[i("div",ye,[y(c,{class:"policy-type-table",fetcher:()=>({data:_.connections,total:_.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":n,"disable-pagination":"","is-clickable":""},{sourceTags:t(({row:r})=>[r.sourceTags.length>0?(e(),o(G,{key:0,class:"tag-list","should-truncate":"",tags:r.sourceTags},null,8,["tags"])):(e(),a(u,{key:1},[s(`
                —
              `)],64))]),destinationTags:t(({row:r})=>[r.destinationTags.length>0?(e(),o(G,{key:0,class:"tag-list","should-truncate":"",tags:r.destinationTags},null,8,["tags"])):(e(),a(u,{key:1},[s(`
                —
              `)],64))]),name:t(({row:r})=>[r.name!==null?(e(),a(u,{key:0},[s(p(r.name),1)],64)):(e(),a(u,{key:1},[s(`
                —
              `)],64))]),origins:t(({row:r})=>[r.origins.length>0?(e(),a("ul",de,[(e(!0),a(u,null,b(r.origins,(l,f)=>(e(),a("li",{key:`${d}-${f}`},[y(g,{to:{name:"policy-detail-view",params:{mesh:l.mesh,policyPath:m.policyTypesByName[l.type].path,policy:l.name}}},{default:t(()=>[s(p(l.name),1)]),_:2},1032,["to"])]))),128))])):(e(),a(u,{key:1},[s(`
                —
              `)],64))]),config:t(({row:r,rowKey:l})=>[r.config?(e(),o(H,{key:0,id:`${m.id}-${d}-${l}-code-block`,code:w(E)(r.config),language:"yaml","show-copy-button":!1},null,8,["id","code"])):(e(),a(u,{key:1},[s(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}});const me=x(_e,[["__scopeId","data-v-3e719841"]]),he=h=>(z("data-v-1d0bcfcf"),h=h(),j(),h),fe={class:"policy-type-heading"},ge={class:"policy-list"},ke={key:0,class:"matcher"},be={key:0,class:"matcher__and"},ve=he(()=>i("br",null,null,-1)),$e={key:1,class:"matcher__not"},Te={class:"matcher__term"},we={key:1},Re={key:0},Pe=D({__name:"RuleEntryList",props:{id:{},ruleEntries:{},policyTypesByName:{},showMatchers:{type:Boolean,default:!0}},setup(h){const{t:m}=q(),n=h;function P({headerKey:v}){return{class:`cell-${v}`}}return(v,g)=>{const c=k("RouterLink"),_=k("KTable");return e(),o(V,{"initially-open":[],"multiple-open":""},{default:t(()=>[(e(!0),a(u,null,b(n.ruleEntries,(d,r)=>(e(),o(K,{key:r},{"accordion-header":t(()=>[i("h3",fe,[y(Y,{"policy-type":d.type},{default:t(()=>[s(p(d.type),1)]),_:2},1032,["policy-type"])])]),"accordion-content":t(()=>[i("div",ge,[y(_,{class:Q(["policy-type-table",{"has-matchers":n.showMatchers}]),fetcher:()=>({data:d.rules,total:d.rules.length}),headers:[...n.showMatchers?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}],"cell-attrs":P,"disable-pagination":""},O({origins:t(({row:l})=>[l.origins.length>0?(e(),a("ul",Re,[(e(!0),a(u,null,b(l.origins,(f,$)=>(e(),a("li",{key:`${r}-${$}`},[y(c,{to:{name:"policy-detail-view",params:{mesh:f.mesh,policyPath:n.policyTypesByName[f.type].path,policy:f.name}}},{default:t(()=>[s(p(f.name),1)]),_:2},1032,["to"])]))),128))])):(e(),a(u,{key:1},[s(p(w(m)("common.collection.none")),1)],64))]),config:t(({row:l,rowKey:f})=>[l.config?(e(),o(H,{key:0,id:`${n.id}-${r}-${f}-code-block`,code:w(E)(l.config),language:"yaml","show-copy-button":!1},null,8,["id","code"])):(e(),a(u,{key:1},[s(p(w(m)("common.collection.none")),1)],64))]),_:2},[n.showMatchers?{name:"matchers",fn:t(({row:l})=>[l.matchers&&l.matchers.length>0?(e(),a("span",ke,[(e(!0),a(u,null,b(l.matchers,({key:f,value:$,not:B},R)=>(e(),a(u,{key:R},[R>0?(e(),a("span",be,[s(" and"),ve])):T("",!0),B?(e(),a("span",$e,"!")):T("",!0),i("span",Te,p(`${f}:${$}`),1)],64))),128))])):(e(),a("i",we,p(w(m)("data-planes.routes.item.matches_everything")),1))]),key:"0"}:void 0]),1032,["class","fetcher","headers"])])]),_:2},1024))),128))]),_:1})}}});const I=x(Pe,[["__scopeId","data-v-1d0bcfcf"]]),Be={"data-testid":"standard-dataplane-policies",class:"stack"},Ne={class:"mb-2"},Le=D({__name:"StandardDataplanePolicies",props:{policyTypeEntries:{},inspectRulesForDataplane:{},policyTypesByName:{},showPoliciesSection:{type:Boolean}},setup(h){const{t:m}=q(),n=h;return(P,v)=>{const g=k("KCard");return e(),a("div",Be,[(!n.showPoliciesSection||n.policyTypeEntries.length===0)&&n.inspectRulesForDataplane.rules.length===0?(e(),o(g,{key:0},{default:t(()=>[y(U)]),_:1})):(e(),a(u,{key:1},[n.showPoliciesSection?(e(),o(g,{key:0},{default:t(()=>[y(me,{id:"policies","policy-type-entries":n.policyTypeEntries,"policy-types-by-name":n.policyTypesByName,"data-testid":"policy-list"},null,8,["policy-type-entries","policy-types-by-name"])]),_:1})):T("",!0),s(),n.inspectRulesForDataplane.proxyRule?(e(),o(g,{key:1},{default:t(()=>[i("h3",null,p(w(m)("data-planes.routes.item.proxy_rule")),1),s(),y(I,{id:"proxy-rules",class:"mt-2","rule-entries":[n.inspectRulesForDataplane.proxyRule],"policy-types-by-name":n.policyTypesByName,"show-matchers":!1,"data-testid":"proxy-rule-list"},null,8,["rule-entries","policy-types-by-name"])]),_:1})):T("",!0),s(),n.inspectRulesForDataplane.toRules.length>0?(e(),o(g,{key:2},{default:t(()=>[i("h3",null,p(w(m)("data-planes.routes.item.to_rules")),1),s(),y(I,{id:"to-rules",class:"mt-2","rule-entries":n.inspectRulesForDataplane.toRules,"policy-types-by-name":n.policyTypesByName,"data-testid":"to-rule-list"},null,8,["rule-entries","policy-types-by-name"])]),_:1})):T("",!0),s(),n.inspectRulesForDataplane.fromRuleInbounds.length>0?(e(),o(g,{key:3},{default:t(()=>[i("h3",Ne,p(w(m)("data-planes.routes.item.from_rules")),1),s(),(e(!0),a(u,null,b(n.inspectRulesForDataplane.fromRuleInbounds,(c,_)=>(e(),a("div",{key:_},[i("h4",null,p(w(m)("data-planes.routes.item.port",{port:c.port})),1),s(),y(I,{id:`from-rules-${_}`,class:"mt-2","rule-entries":c.ruleEntries,"policy-types-by-name":n.policyTypesByName,"data-testid":`from-rule-list-${_}`},null,8,["id","rule-entries","policy-types-by-name","data-testid"])]))),128))]),_:1})):T("",!0)],64))])}}}),je=D({__name:"DataPlanePoliciesView",props:{data:{}},setup(h){const m=h;return(n,P)=>{const v=k("RouteTitle"),g=k("KCard"),c=k("DataSource"),_=k("AppView"),d=k("RouteView");return e(),o(d,{name:"data-plane-policies-view",params:{mesh:"",dataPlane:""}},{default:t(({can:r,route:l,t:f})=>[y(_,null,{title:t(()=>[i("h2",null,[y(v,{title:f("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"])])]),default:t(()=>[s(),m.data.dataplaneType==="builtin"?(e(),o(c,{key:0,src:"/*/policy-types"},{default:t(({data:$,error:B})=>[y(c,{src:`/meshes/${l.params.mesh}/dataplanes/${l.params.dataPlane}/gateway-dataplane-policies`},{default:t(({data:R,error:L})=>[B?(e(),o(S,{key:0,error:B},null,8,["error"])):L?(e(),o(S,{key:1,error:L},null,8,["error"])):R===void 0||$===void 0?(e(),o(M,{key:2})):(e(),o(g,{key:3},{default:t(()=>[y(re,{"policy-types-by-name":$.policies.reduce((F,C)=>Object.assign(F,{[C.name]:C}),{}),"gateway-dataplane":R},null,8,["policy-types-by-name","gateway-dataplane"])]),_:2},1024))]),_:2},1032,["src"])]),_:2},1024)):(e(),o(c,{key:1,src:"/*/policy-types"},{default:t(({data:$,error:B})=>[y(c,{src:`/meshes/${l.params.mesh}/dataplanes/${l.params.dataPlane}/sidecar-dataplane-policies`},{default:t(({data:R,error:L})=>[y(c,{src:`/meshes/${l.params.mesh}/dataplanes/${l.params.dataPlane}/rules`},{default:t(({data:F,error:C})=>[B?(e(),o(S,{key:0,error:B},null,8,["error"])):L?(e(),o(S,{key:1,error:L},null,8,["error"])):C?(e(),o(S,{key:2,error:C},null,8,["error"])):$===void 0||R===void 0||F===void 0?(e(),o(M,{key:3})):(e(),o(Le,{key:4,"policy-types-by-name":$.policies.reduce((J,A)=>Object.assign(J,{[A.name]:A}),{}),"policy-type-entries":R.policyTypeEntries,"inspect-rules-for-dataplane":F,"show-policies-section":!r("use zones")},null,8,["policy-types-by-name","policy-type-entries","inspect-rules-for-dataplane","show-policies-section"]))]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1024))]),_:2},1024)]),_:1})}}});export{je as default};
