import{_ as M,P as B,a6 as V,m as A,k as z,q as F,K as E,l as T,s as H,V as K,X as N,o as a,f as s,d as b,w as c,b as w,h as r,t as m,n as C,F as L,j as v,e as k,r as f,z as P,B as O}from"./index.6180ff6f.js";import{g as R}from"./tableDataUtils.9642ba3f.js";import{d as Y}from"./datadogEvents.f0c2b8e0.js";import{F as W}from"./FrameSkeleton.9d8fd5de.js";import{D as j,L as q}from"./LabelList.33120ec9.js";import{T as G}from"./TabsWidget.6e628a3c.js";import{Y as U}from"./YamlView.d3fe5dc5.js";import"./index.124532c3.js";import"./CodeBlock.c76d2442.js";const X={name:"MeshesView",components:{FrameSkeleton:W,DataOverview:j,TabsWidget:G,YamlView:U,LabelList:q},data(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,empty_state:{title:"No Data",message:"There are no Meshes present."},tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Type",key:"type"}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#resources",title:"Resources"},{hash:"#yaml",title:"YAML"}],entity:{},rawEntity:{},pageSize:B,next:null,itemsPerCol:3,meshInsight:V()}},computed:{...A({policies:t=>t.policies}),...z({featureFlags:"config/featureFlags"}),counts(){const t=this.policies.map(i=>{var p;return{title:i.pluralDisplayName,value:((p=this.meshInsight.policies[i.name])==null?void 0:p.total)||0}});return[{title:"Data plane proxies",value:this.meshInsight.dataplanes.total},...t]},countCols(){return Math.ceil(this.counts.length/this.itemsPerCol)}},watch:{$route(){this.isLoading=!0,this.isEmpty=!1,this.hasError=!1,this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,this.tableDataIsEmpty=!1,this.loadData()}},beforeMount(){this.init()},methods:{init(){this.loadData()},onCreateClick(){F.logger.info(Y.CREATE_MESH_CLICKED)},tableAction(t){const i=t;this.getEntity(i)},async loadData(t="0"){this.isLoading=!0,this.isEmpty=!1;const i=this.$route.params.mesh;let p;i!=="all"&&(p=this.$route.params.mesh);try{const{data:y,next:e}=await R({getSingleEntity:E.getMesh.bind(E),getAllEntities:E.getAllMeshes.bind(E),size:this.pageSize,offset:t,query:p});this.next=e,y.length?(this.tableData.data=[...y],this.tableDataIsEmpty=!1,this.isEmpty=!1,this.getEntity({name:y[0].name})):(this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.entityIsEmpty=!0)}catch(y){this.hasError=!0,this.isEmpty=!0,console.error(y)}finally{this.isLoading=!1}},getEntity(t){if(this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,t&&t!==null)return E.getMesh({name:t.name}).then(i=>{if(i){E.getMeshInsights({name:t.name}).then(n=>{this.meshInsight=n});const p=T(i,["type","name"]),y=()=>{const n=Object.entries(T(i,["mtls","logging","metrics","tracing"])),_=[];return n.forEach(I=>{const g=I[0],o=I[1]||null;if(o&&o.enabledBackend){const d=o.enabledBackend,u=o.backends.find(D=>D.name===d);u&&_.push({label:g,value:{type:u.type,name:u.name}})}else if(o&&o.defaultBackend){const d=o.defaultBackend,u=o.backends.find(D=>D.name===d);u&&_.push({label:g,value:{type:u.type,name:u.name}})}else if(o&&o.backends){const d=o.backends[0];d&&_.push({label:g,value:{type:d.type,name:d.name}})}else _.push({label:g,value:null})}),_},e=()=>{const{routing:n}=i;return n&&n.localityAwareLoadBalancing};this.entity={basicData:p,extendedData:y(),localityEnabled:e()},this.rawEntity=H(i)}else this.entity={},this.entityIsEmpty=!0}).catch(i=>{this.entityHasError=!0,console.error(i)}).finally(()=>{setTimeout(()=>{this.entityIsLoading=!1},"500")});setTimeout(()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1},"500")},formatValue(t){return t?t.toLocaleString("en").toString():0},readableDate(t){return K(t)},rawDate(t){return N(t)}}},x=t=>(P("data-v-48cd6456"),t=t(),O(),t),Z={class:"all-meshes"},J=x(()=>r("span",{class:"custom-control-icon"}," + ",-1)),Q=k(" Create Mesh "),$={key:0},ee={key:0},te={key:1},ae={key:2},se={key:3},ie={key:4},ne={key:0},oe={key:0,class:"label-cols"},le=k(" Disabled "),re=x(()=>r("h4",null,"Locality Aware Loadbalancing",-1)),ce={key:0},he=k(" Enabled "),me=k(" Disabled ");function de(t,i,p,y,e,n){const _=f("KButton"),I=f("DataOverview"),g=f("KBadge"),o=f("LabelList"),d=f("YamlView"),u=f("TabsWidget"),D=f("FrameSkeleton");return a(),s("div",Z,[b(D,null,{default:c(()=>[b(I,{"page-size":e.pageSize,"has-error":e.hasError,"is-loading":e.isLoading,"empty-state":e.empty_state,"table-data":e.tableData,"table-data-is-empty":e.tableDataIsEmpty,next:e.next,onTableAction:n.tableAction,onLoadData:i[0]||(i[0]=l=>n.loadData(l))},{additionalControls:c(()=>[b(_,{class:"add-mesh-button",appearance:"primary",size:"small",to:{path:"/wizard/mesh"},onClick:n.onCreateClick},{default:c(()=>[J,Q]),_:1},8,["onClick"])]),_:1},8,["page-size","has-error","is-loading","empty-state","table-data","table-data-is-empty","next","onTableAction"]),e.isEmpty===!1?(a(),w(u,{key:0,"has-error":e.hasError,"is-loading":e.isLoading,tabs:e.tabs,"initial-tab-override":"overview"},{tabHeader:c(()=>[e.entity.basicData?(a(),s("div",$,[r("h3",null," Mesh: "+m(e.entity.basicData.name),1)])):C("",!0)]),overview:c(()=>[b(o,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:c(()=>[r("div",null,[r("ul",null,[(a(!0),s(L,null,v(e.entity.basicData,(l,h)=>(a(),s("li",{key:h},[h==="creationTime"?(a(),s("h4",ee," Created ")):h==="modificationTime"?(a(),s("h4",te," Last Modified ")):(a(),s("h4",ae,m(h),1)),h==="creationTime"||h==="modificationTime"?(a(),s("p",se,[k(m(n.readableDate(l))+" ",1),r("em",null,"("+m(n.rawDate(l))+")",1)])):(a(),s("p",ie,m(l),1))]))),128))])]),e.entity.extendedData&&e.entity.extendedData.length?(a(),s("div",ne,[r("ul",null,[(a(!0),s(L,null,v(e.entity.extendedData,(l,h)=>(a(),s("li",{key:h},[r("h4",null,m(l.label),1),l.value?(a(),s("p",oe,[r("span",null,m(l.value.type),1),r("span",null,m(l.value.name),1)])):(a(),w(g,{key:1,appearance:"danger"},{default:c(()=>[le]),_:1}))]))),128)),r("li",null,[re,e.entity.localityEnabled?(a(),s("p",ce,[b(g,{appearance:"success"},{default:c(()=>[he]),_:1})])):(a(),w(g,{key:1,appearance:"danger"},{default:c(()=>[me]),_:1}))])])])):C("",!0)]),_:1},8,["has-error","is-loading","is-empty"])]),yaml:c(()=>[b(d,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty,content:e.rawEntity},null,8,["has-error","is-loading","is-empty","content"])]),resources:c(()=>[b(o,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:c(()=>[(a(!0),s(L,null,v(n.countCols,l=>(a(),s("div",{key:l},[r("ul",null,[(a(!0),s(L,null,v(n.counts.slice((l-1)*e.itemsPerCol,l*e.itemsPerCol),(h,S)=>(a(),s("li",{key:S},[r("h4",null,m(h.title),1),r("p",null,m(n.formatValue(h.value)),1)]))),128))])]))),128))]),_:1},8,["has-error","is-loading","is-empty"])]),_:1},8,["has-error","is-loading","tabs"])):C("",!0)]),_:1})])}const ke=M(X,[["render",de],["__scopeId","data-v-48cd6456"]]);export{ke as default};
