import{d as U,v as T,p as y,o as r,w as e,b as s,r as m,e as l,q as v,t as p,l as V,I as Y,K as ee,c as _,L as X,N as w,S as ne,m as $,P as oe,y as te,G as se,_ as ae}from"./index-Dz3cVcgh.js";import{S as le}from"./SummaryView-F1t-uSFp.js";const ie=["data-testid"],re=U({__name:"ZoneListView",setup(me){const D=T({}),L=T({}),x=S=>{const n="zoneIngress";D.value=S.items.reduce((u,d)=>{var f;const c=(f=d[n])==null?void 0:f.zone;if(typeof c<"u"){typeof u[c]>"u"&&(u[c]={online:[],offline:[]});const k=typeof d[`${n}Insight`].connectedSubscription<"u"?"online":"offline";u[c][k].push(d)}return u},{})},B=S=>{const n="zoneEgress";L.value=S.items.reduce((u,d)=>{var f;const c=(f=d[n])==null?void 0:f.zone;if(typeof c<"u"){typeof u[c]>"u"&&(u[c]={online:[],offline:[]});const k=typeof d[`${n}Insight`].connectedSubscription<"u"?"online":"offline";u[c][k].push(d)}return u},{})};return(S,n)=>{const u=m("RouteTitle"),d=m("DataSource"),c=m("XI18n"),f=m("XAction"),k=m("XTeleportTemplate"),Z=m("XSearch"),A=m("XIcon"),R=m("DataLoader"),E=m("XPrompt"),G=m("DataSink"),P=m("XDisclosure"),q=m("XActionGroup"),F=m("DataCollection"),K=m("XLayout"),M=m("XCard"),W=m("RouterView"),j=m("AppView"),H=m("RouteView");return r(),y(H,{name:"zone-cp-list-view",params:{page:1,size:Number,zone:"",s:""}},{default:e(({route:i,t:g,can:I,uri:J,me:z})=>[s(d,{src:J($(se),"/zone-cps",{},{page:i.params.page,size:i.params.size,search:i.params.s})},{default:e(({data:t,error:O,refresh:Q})=>{var N;return[s(j,{docs:t&&((N=t==null?void 0:t.items)!=null&&N.length)?g("zones.href.docs.cta"):""},{title:e(()=>[V("h1",null,[s(u,{title:g("zone-cps.routes.items.title")},null,8,["title"])])]),default:e(()=>[n[13]||(n[13]=l()),s(d,{src:"/zone-ingress-overviews?page=1&size=100",onChange:x}),n[14]||(n[14]=l()),s(d,{src:"/zone-egress-overviews?page=1&size=100",onChange:B}),n[15]||(n[15]=l()),!I("view growth-new-empty-states")||t!=null&&t.items.length?(r(),y(c,{key:0,path:"zone-cps.routes.items.intro","default-path":"common.i18n.ignore-error"})):v("",!0),n[16]||(n[16]=l()),I("create zones")&&((t==null?void 0:t.items)??[]).length>0?(r(),y(k,{key:1,to:{name:"zone-cp-list-view-actions"}},{default:e(()=>[s(f,{action:"create",appearance:"primary",to:{name:"zone-create-view"},"data-testid":"create-zone-link"},{default:e(()=>[l(p(g("zones.index.create")),1)]),_:2},1024)]),_:2},1024)):v("",!0),n[17]||(n[17]=l()),s(M,null,{default:e(()=>[s(K,null,{default:e(()=>[V("search",null,[V("form",{onSubmit:n[0]||(n[0]=Y(()=>{},["prevent"]))},[s(Z,{class:"search-field",keys:["name"],value:i.params.s,onChange:o=>i.update({page:1,s:o})},null,8,["value","onChange"])],32)]),n[12]||(n[12]=l()),s(R,{data:[t],errors:[O]},{loadable:e(()=>[s(F,{type:"zone-cps",items:(t==null?void 0:t.items)??[void 0],page:i.params.page,"page-size":i.params.size,total:t==null?void 0:t.total,onChange:i.update},{default:e(()=>[s(ee,{class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{...z.get("headers.type"),label:"Â ",key:"type"},{...z.get("headers.name"),label:"Name",key:"name"},{...z.get("headers.zoneCpVersion"),label:"Zone Leader CP Version",key:"zoneCpVersion"},{...z.get("headers.ingress"),label:"Ingresses (online / total)",key:"ingress"},{...z.get("headers.egress"),label:"Egresses (online / total)",key:"egress"},{...z.get("headers.state"),label:"Status",key:"state"},{...z.get("headers.warnings"),label:"Warnings",key:"warnings",hideLabel:!0},{...z.get("headers.actions"),label:"Actions",key:"actions",hideLabel:!0}],items:t==null?void 0:t.items,"is-selected-row":o=>o.name===i.params.zone,onResize:z.set},{type:e(({row:o})=>[(r(!0),_(w,null,X([["kubernetes","universal"].find(a=>a===o.zoneInsight.environment)??"kubernetes"],a=>(r(),y(A,{key:a,name:a},{default:e(()=>[l(p(g(`common.product.environment.${a}`)),1)]),_:2},1032,["name"]))),128))]),name:e(({row:o})=>[s(f,{"data-action":"",to:{name:"zone-cp-detail-view",params:{zone:o.name},query:{page:i.params.page,size:i.params.size,s:i.params.s}}},{default:e(()=>[l(p(o.name),1)]),_:2},1032,["to"])]),zoneCpVersion:e(({row:o})=>[l(p($(oe)(o.zoneInsight,"version.kumaCp.version",g("common.collection.none"))),1)]),ingress:e(({row:o})=>[(r(!0),_(w,null,X([D.value[o.name]||{online:[],offline:[]}],a=>(r(),_(w,null,[l(p(a.online.length)+" / "+p(a.online.length+a.offline.length),1)],64))),256))]),egress:e(({row:o})=>[(r(!0),_(w,null,X([L.value[o.name]||{online:[],offline:[]}],a=>(r(),_(w,null,[l(p(a.online.length)+" / "+p(a.online.length+a.offline.length),1)],64))),256))]),state:e(({row:o})=>[s(ne,{status:o.state},null,8,["status"])]),warnings:e(({row:o})=>{var a,h;return[(r(!0),_(w,null,X([[{bool:o.zoneInsight.store==="memory",key:"store-memory"},{bool:!((h=(a=o.zoneInsight.version)==null?void 0:a.kumaCp)!=null&&h.kumaCpGlobalCompatible),key:"global-cp-incompatible"}].filter(({bool:C})=>C)],C=>(r(),_(w,{key:typeof C},[C.length>0?(r(),y(A,{key:0,name:"warning","data-testid":"warning"},{default:e(()=>[V("ul",null,[(r(!0),_(w,null,X(C,({key:b})=>(r(),_("li",{key:b,"data-testid":`warning-${b}`},p(g(`zone-cps.list.warnings.${b}`)),9,ie))),128))])]),_:2},1024)):(r(),_(w,{key:1},[l(p(g("common.collection.none")),1)],64))],64))),128))]}),actions:e(({row:o})=>[s(q,null,{default:e(()=>[s(P,null,{default:e(({expanded:a,toggle:h})=>[s(f,{to:{name:"zone-cp-detail-view",params:{zone:o.name}}},{default:e(()=>[l(p(g("common.collection.actions.view")),1)]),_:2},1032,["to"]),n[3]||(n[3]=l()),I("create zones")?(r(),y(f,{key:0,appearance:"danger",onClick:h},{default:e(()=>[l(p(g("common.collection.actions.delete")),1)]),_:2},1032,["onClick"])):v("",!0),n[4]||(n[4]=l()),s(k,{to:{name:"modal-layer"}},{default:e(()=>[a?(r(),y(G,{key:0,src:`/zone-cps/${o.name}/delete`,onChange:()=>{h(),Q()}},{default:e(({submit:C,error:b})=>[s(E,{action:g("common.delete_modal.proceed_button"),expected:o.name,"data-testid":"delete-zone-modal",onCancel:h,onSubmit:()=>C({})},{title:e(()=>[l(p(g("common.delete_modal.title",{type:"Zone"})),1)]),default:e(()=>[n[1]||(n[1]=l()),s(c,{path:"common.delete_modal.text",params:{type:"Zone",name:o.name}},null,8,["params"]),n[2]||(n[2]=l()),s(R,{class:"mt-4",errors:[b],loader:!1},null,8,["errors"])]),_:2,__:[1,2]},1032,["action","expected","onCancel","onSubmit"])]),_:2},1032,["src","onChange"])):v("",!0)]),_:2},1024)]),_:2,__:[3,4]},1024)]),_:2},1024)]),_:2,__:[5,6,7,8,9,10,11]},1032,["headers","items","is-selected-row","onResize"])]),_:2},1032,["items","page","page-size","total","onChange"])]),_:2},1032,["data","errors"])]),_:2,__:[12]},1024)]),_:2},1024),n[18]||(n[18]=l()),i.params.zone?(r(),y(W,{key:2},{default:e(o=>[s(le,{onClose:a=>i.replace({name:"zone-cp-list-view",query:{page:i.params.page,size:i.params.size,s:i.params.s}})},{default:e(()=>[(r(),y(te(o.Component),{name:i.params.zone,"zone-overview":t==null?void 0:t.items.find(a=>a.name===i.params.zone)},null,8,["name","zone-overview"]))]),_:2},1032,["onClose"])]),_:2},1024)):v("",!0)]),_:2,__:[13,14,15,16,17,18]},1032,["docs"])]}),_:2},1032,["src"])]),_:1})}}}),ue=ae(re,[["__scopeId","data-v-baf632f9"]]);export{ue as default};
