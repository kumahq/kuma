import{K as I}from"./index-FZCiQto1.js";import{d as V,l as x,A as E,I as L,a as g,o,c as v,e as p,w as a,F as w,n as N,q as l,t as c,f as s,m as d,E as A,b as r,p as b,R as K,_ as q,S as F,C as M}from"./index-SjblyAD_.js";import{D,A as G}from"./AppCollection-Ec1iwpzl.js";import{E as $}from"./ErrorBlock-Wlm-O4Aq.js";import{P as O}from"./PolicyTypeTag-35RzyH0P.js";import{_ as Z}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-aHCbVa36.js";import{S as U}from"./SummaryView-PtIcM7md.js";import"./TextWithCopyButton-xouz8GNx.js";import"./CopyButton-vLkq-cX5.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-nRtoLqYV.js";const j={class:"policy-list-content"},H={class:"policy-count"},J={class:"policy-list"},Q={class:"stack"},W={class:"description"},X={class:"description-content"},Y={class:"description-actions"},ee={class:"visually-hidden"},te={key:0},ae=V({__name:"PolicyList",props:{pageNumber:{},pageSize:{},policyTypes:{},currentPolicyType:{},policyCollection:{},policyError:{},meshInsight:{},isSelectedRow:{type:[Function,null],default:null}},emits:["change"],setup(S,{emit:B}){const{t:n}=x(),C=E(),e=S,P=B,T=L(()=>{var _;if(((_=e.meshInsight)==null?void 0:_.policies)===void 0)return e.policyTypes;const z=e.policyTypes.filter(t=>!t.isTargetRefBased&&t.name!=="MeshGateway").some(t=>{var h,m,y;return(((y=(m=(h=e.meshInsight)==null?void 0:h.policies)==null?void 0:m[t.name])==null?void 0:y.total)??0)>0});return e.policyTypes.filter(t=>t.isTargetRefBased||t.name==="MeshGateway"?!0:z)});return(z,_)=>{const t=g("RouterLink"),h=g("KCard"),m=g("KBadge");return o(),v("div",j,[p(h,{class:"policy-type-list","data-testid":"policy-type-list"},{default:a(()=>[(o(!0),v(w,null,A(T.value,(y,u)=>{var i,k,f;return o(),v("div",{key:u,class:N(["policy-type-link-wrapper",{"policy-type-link-wrapper--is-active":y.path===e.currentPolicyType.path}])},[p(t,{class:"policy-type-link",to:{name:"policy-list-view",params:{mesh:l(C).params.mesh,policyPath:y.path}},"data-testid":`policy-type-link-${y.name}`},{default:a(()=>[s(c(y.name),1)]),_:2},1032,["to","data-testid"]),s(),d("div",H,c(((f=(k=(i=e.meshInsight)==null?void 0:i.policies)==null?void 0:k[y.name])==null?void 0:f.total)??0),1)],2)}),128))]),_:1}),s(),d("div",J,[d("div",Q,[p(h,null,{default:a(()=>[d("div",W,[d("div",X,[d("h3",null,[p(O,{"policy-type":e.currentPolicyType.name},{default:a(()=>[s(c(l(n)("policies.collection.title",{name:e.currentPolicyType.name})),1)]),_:1},8,["policy-type"])]),s(),d("p",null,c(l(n)(`policies.type.${e.currentPolicyType.name}.description`,void 0,{defaultMessage:l(n)("policies.collection.description")})),1)]),s(),d("div",Y,[e.currentPolicyType.isExperimental?(o(),r(m,{key:0,appearance:"warning"},{default:a(()=>[s(c(l(n)("policies.collection.beta")),1)]),_:1})):b("",!0),s(),e.currentPolicyType.isInbound?(o(),r(m,{key:1,appearance:"neutral"},{default:a(()=>[s(c(l(n)("policies.collection.inbound")),1)]),_:1})):b("",!0),s(),e.currentPolicyType.isOutbound?(o(),r(m,{key:2,appearance:"neutral"},{default:a(()=>[s(c(l(n)("policies.collection.outbound")),1)]),_:1})):b("",!0),s(),p(D,{href:l(n)("policies.href.docs",{name:e.currentPolicyType.name}),"data-testid":"policy-documentation-link"},{default:a(()=>[d("span",ee,c(l(n)("common.documentation")),1)]),_:1},8,["href"])])])]),_:1}),s(),p(h,null,{default:a(()=>{var y,u;return[e.policyError!==void 0?(o(),r($,{key:0,error:e.policyError},null,8,["error"])):(o(),r(G,{key:1,class:"policy-collection","data-testid":"policy-collection","empty-state-message":l(n)("common.emptyState.message",{type:`${e.currentPolicyType.name} policies`}),"empty-state-cta-to":l(n)("policies.href.docs",{name:e.currentPolicyType.name}),"empty-state-cta-text":l(n)("common.documentation"),headers:[{label:"Name",key:"name"},...e.currentPolicyType.isTargetRefBased?[{label:"Zone",key:"zone"}]:[],...e.currentPolicyType.isTargetRefBased?[{label:"Target ref",key:"targetRef"}]:[],{label:"Details",key:"details",hideLabel:!0}],"page-number":e.pageNumber,"page-size":e.pageSize,total:(y=e.policyCollection)==null?void 0:y.total,items:(u=e.policyCollection)==null?void 0:u.items,error:e.policyError,"is-selected-row":e.isSelectedRow,onChange:_[0]||(_[0]=i=>P("change",i))},{name:a(({row:i})=>[p(t,{to:{name:"policy-summary-view",params:{mesh:i.mesh,policyPath:e.currentPolicyType.path,policy:i.name},query:{page:e.pageNumber,size:e.pageSize}}},{default:a(()=>[s(c(i.name),1)]),_:2},1032,["to"])]),targetRef:a(({row:i})=>{var k;return[e.currentPolicyType.isTargetRefBased&&typeof((k=i.spec)==null?void 0:k.targetRef)<"u"?(o(),r(m,{key:0,appearance:"neutral"},{default:a(()=>[s(c(i.spec.targetRef.kind),1),i.spec.targetRef.name?(o(),v("span",te,[s(":"),d("b",null,c(i.spec.targetRef.name),1)])):b("",!0)]),_:2},1024)):(o(),v(w,{key:1},[s(c(l(n)("common.detail.none")),1)],64))]}),zone:a(({row:i})=>[i.labels&&i.labels["kuma.io/origin"]==="zone"&&i.labels["kuma.io/zone"]?(o(),r(t,{key:0,to:{name:"zone-cp-detail-view",params:{zone:i.labels["kuma.io/zone"]}}},{default:a(()=>[s(c(i.labels["kuma.io/zone"]),1)]),_:2},1032,["to"])):(o(),v(w,{key:1},[s(c(l(n)("common.detail.none")),1)],64))]),details:a(({row:i})=>[p(t,{class:"details-link","data-testid":"details-link",to:{name:"policy-detail-view",params:{mesh:i.mesh,policyPath:e.currentPolicyType.path,policy:i.name}}},{default:a(()=>[s(c(l(n)("common.collection.details_link"))+" ",1),p(l(K),{display:"inline-block",decorative:"",size:l(I)},null,8,["size"])]),_:2},1032,["to"])]),_:1},8,["empty-state-message","empty-state-cta-to","empty-state-cta-text","headers","page-number","page-size","total","items","error","is-selected-row"]))]}),_:1})])])])}}}),ie=q(ae,[["__scopeId","data-v-572959c8"]]),ue=V({__name:"PolicyListView",setup(S){return(B,n)=>{const C=g("RouteTitle"),e=g("RouterView"),P=g("DataSource"),T=g("AppView"),z=g("RouteView");return o(),r(P,{src:"/me"},{default:a(({data:_})=>[_?(o(),r(z,{key:0,name:"policy-list-view",params:{page:1,size:_.pageSize,mesh:"",policyPath:"",policy:""}},{default:a(({route:t,t:h})=>[p(T,null,{title:a(()=>[d("h2",null,[p(C,{title:h("policies.routes.items.title")},null,8,["title"])])]),default:a(()=>[s(),p(P,{src:"/*/policy-types"},{default:a(({data:m,error:y})=>[y?(o(),r($,{key:0,error:y},null,8,["error"])):m===void 0?(o(),r(Z,{key:1})):m.policies.length===0?(o(),r(F,{key:2})):(o(),r(P,{key:3,src:`/meshes/${t.params.mesh}/policy-path/${t.params.policyPath}?page=${t.params.page}&size=${t.params.size}`},{default:a(({data:u,error:i})=>[p(P,{src:`/mesh-insights/${t.params.mesh}`},{default:a(({data:k})=>[p(ie,{"page-number":t.params.page,"page-size":t.params.size,"current-policy-type":m.policies.find(f=>f.path===t.params.policyPath)??m.policies[0],"policy-types":m.policies,"mesh-insight":k,"policy-collection":u,"policy-error":i,"is-selected-row":f=>f.name===t.params.policy,onChange:t.update},null,8,["page-number","page-size","current-policy-type","policy-types","mesh-insight","policy-collection","policy-error","is-selected-row","onChange"]),s(),t.params.policy?(o(),r(e,{key:0},{default:a(f=>[p(U,{onClose:R=>t.replace({name:"policy-list-view",params:{mesh:t.params.mesh,policyPath:t.params.policyPath},query:{page:t.params.page,size:t.params.size}})},{default:a(()=>[(o(),r(M(f.Component),{policy:u==null?void 0:u.items.find(R=>R.name===t.params.policy),"policy-type":m.policies.find(R=>R.path===t.params.policyPath)},null,8,["policy","policy-type"]))]),_:2},1032,["onClose"])]),_:2},1024)):b("",!0)]),_:2},1032,["src"])]),_:2},1032,["src"]))]),_:2},1024)]),_:2},1024)]),_:2},1032,["params"])):b("",!0)]),_:1})}}});export{ue as default};
