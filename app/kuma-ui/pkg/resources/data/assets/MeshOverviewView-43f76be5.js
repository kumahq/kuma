import{u as W,p as j,l as E}from"./production-765497f0.js";import{c as T}from"./kongponents.es-881f3b05.js";import{C as z}from"./ContentWrapper-814da4e3.js";import{u as N}from"./store-a30f6d96.js";import{D as w}from"./DoughnutChart-50b3f505.js";import{d as S,c as p,q as A,o as s,h as l,e as d,u as c,f as n,r as b,s as G,w as k,b as D,F as C,g as u,l as x,t as m,a as $}from"./runtime-dom.esm-bundler-8dcf3b23.js";import{_ as L}from"./_plugin-vue_export-helper-c27b6911.js";import{M as H}from"./MeshResources-494ac805.js";import{_ as J}from"./LabelList.vue_vue_type_style_index_0_lang-fcc406f6.js";import{_ as Q}from"./YamlView.vue_vue_type_script_setup_true_lang-37f2f9d1.js";import{u as U}from"./index-5fc45c5b.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-721b93a6.js";import"./ErrorBlock-6f5a1b32.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-58de5058.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-edbce1d0.js";import"./toYaml-4e00099e.js";const X={class:"chart-box-list"},Y=S({__name:"MeshCharts",setup(O){const r=N(),g=p(()=>r.getters.getChart("services",{title:"Services",showTotal:!0})),f=p(()=>r.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),v=p(()=>r.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),y=p(()=>r.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));A(()=>r.state.selectedMesh,function(){h()}),h();function h(){r.dispatch("fetchMeshInsights",r.state.selectedMesh),r.dispatch("fetchServices",r.state.selectedMesh)}return(o,B)=>(s(),l("div",X,[d(w,{data:c(g)},null,8,["data"]),n(),d(w,{data:c(f)},null,8,["data"]),n(),d(w,{data:c(v)},null,8,["data"]),n(),d(w,{data:c(y)},null,8,["data"])]))}});const Z=L(Y,[["__scopeId","data-v-62ff2edc"]]),ee={key:0},te={key:1},ae={key:1},se={class:"policy-counts"},ne={key:0},oe={key:0,class:"mt-4"},le=S({__name:"MeshOverviewView",setup(O){const r=U(),g=W(),f=N(),v=b(!0),y=b(!1),h=b(!1),o=b(null),B=b(null),V=p(()=>o.value!==null?j(o.value):null),R=p(()=>{if(o.value===null)return null;const{name:t,type:a,creationTime:_,modificationTime:e}=o.value;return{name:t,type:a,created:E(_),modified:E(e),"Data Plane Proxies":f.state.meshInsight.dataplanes.total}}),F=p(()=>{var I;if(o.value===null)return null;const t=M(o.value,"mtls"),a=M(o.value,"logging"),_=M(o.value,"metrics"),e=M(o.value,"tracing"),i=Boolean((I=o.value.routing)==null?void 0:I.localityAwareLoadBalancing);return{mtls:t,logging:a,metrics:_,tracing:e,localityAwareLoadBalancing:i}}),K=p(()=>f.state.sidebar.insights.mesh.policies.total),q=p(()=>f.state.policyTypes.map(t=>{var a;return{...t,length:((a=f.state.meshInsight.policies[t.name])==null?void 0:a.total)??0}}));A(()=>g.params.mesh,function(){g.name==="single-mesh-overview"&&(v.value=!0,h.value=!1,y.value=!1,P())}),P();async function P(){v.value=!0,h.value=!1;const t=g.params.mesh;try{o.value=await r.getMesh({name:t}),B.value=await r.getMeshInsights({name:t})}catch(a){y.value=!0,h.value=!0,console.error(a)}finally{v.value=!1}}function M(t,a){if(t===null||t[a]===void 0)return!1;const _=t[a].enabledBackend??t[a].defaultBackend??t[a].backends[0].name,e=t[a].backends.find(i=>i.name===_);return`${e.type} / ${e.name}`}return(t,a)=>{const _=G("router-link");return s(),l(C,null,[d(Z,{class:"mt-24"}),n(),d(z,{class:"mt-8"},{content:k(()=>[o.value!==null?(s(),l("div",ee,[d(J,{"has-error":y.value,"is-loading":v.value,"is-empty":h.value},{default:k(()=>[u("div",null,[u("ul",null,[(s(!0),l(C,null,x(c(R),(e,i)=>(s(),l("li",{key:i},[u("h4",null,m(i),1),n(),typeof e=="boolean"?(s(),$(c(T),{key:0,appearance:e?"success":"danger"},{default:k(()=>[n(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),l("p",te,m(e),1))]))),128))])]),n(),u("div",null,[u("ul",null,[(s(!0),l(C,null,x(c(F),(e,i)=>(s(),l("li",{key:i},[u("h4",null,m(i),1),n(),typeof e=="boolean"?(s(),$(c(T),{key:0,appearance:e?"success":"danger"},{default:k(()=>[n(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),l("p",ae,m(e),1))]))),128))])]),n(),u("div",null,[u("ul",se,[u("li",null,[u("h4",null,`
                  Policies (`+m(c(K))+`)
                `,1),n(),u("ul",null,[(s(!0),l(C,null,x(c(q),(e,i)=>(s(),l(C,{key:i},[e.length!==0?(s(),l("li",ne,[d(_,{to:{name:"policy",params:{policyPath:e.path}}},{default:k(()=>[n(m(e.name)+": "+m(e.length),1)]),_:2},1032,["to"])])):D("",!0)],64))),128))])])])])]),_:1},8,["has-error","is-loading","is-empty"])])):D("",!0)]),_:1}),n(),c(V)!==null?(s(),l("div",oe,[d(Q,{id:"code-block-mesh",content:c(V)},null,8,["content"])])):D("",!0),n(),d(H,{class:"mt-6"})],64)}}});const Me=L(le,[["__scopeId","data-v-cbf1de2e"]]);export{Me as default};
