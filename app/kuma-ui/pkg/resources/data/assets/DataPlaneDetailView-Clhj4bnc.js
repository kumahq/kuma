import{d as at,a2 as et,v as nt,r as f,p as m,o as s,w as a,b as n,c as p,e,N as k,L as c,q as b,l as o,t as i,T as ot,m as I,F as st,$ as dt,a3 as it,a4 as lt,y as rt,_ as pt}from"./index-CX1Qix9F.js";import{T as ut}from"./TagList-B5KQf4tl.js";import{C as K,a as T,b as q}from"./ConnectionTraffic-CJkCUv9L.js";const mt={key:0},ft={key:1},yt={key:2},vt={key:0},kt={key:1},gt={key:2},bt=at({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(U){const j=et(),d=U,z=nt();return(ct,t)=>{const B=f("XI18n"),P=f("XNotification"),R=f("XIcon"),F=f("DataCollection"),y=f("XLayout"),C=f("XAction"),g=f("XBadge"),Z=f("XCopyButton"),N=f("XDl"),A=f("DataSource"),H=f("XAboutCard"),J=f("XEmptyState"),M=f("DataLoader"),Q=f("XCard"),W=f("XDrawer"),Y=f("RouterView"),L=f("AppView"),h=f("RouteView");return s(),m(h,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:""},name:"data-plane-detail-view"},{default:a(({route:u,t:r,can:$,uri:E})=>[n(L,{notifications:!0},{default:a(()=>[(s(!0),p(k,null,c([{bool:d.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:d.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:d.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:d.data.dataplaneInsight.version?.envoy.version??"",kumaDp:d.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!($("use zones")&&d.data.zone&&d.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:d.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:d.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:d.data.isCertExpired,key:"certificate-expired"},{bool:!d.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!$("use transparent-proxying",d.data),key:"networking-transparent-proxying",variant:"info"}],({bool:l,key:v,params:O,variant:_})=>(s(),m(P,{key:v,notify:l,"data-testid":`warning-${v}`,uri:`data-planes.notifications.${v}.${d.data.id}`,variant:_},{default:a(()=>[n(B,{path:`data-planes.notifications.${v}`,params:Object.fromEntries(Object.entries(O??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),t[49]||(t[49]=e()),n(y,{type:"stack","data-testid":"dataplane-details"},{default:a(()=>[n(H,{title:r("data-planes.routes.item.about.title"),created:d.data.creationTime,modified:d.data.modificationTime,class:"about-section"},{default:a(()=>[n(y,null,{default:a(()=>[n(N,{variant:"x-stack"},{default:a(()=>[o("div",null,[o("dt",null,i(r("http.api.property.status")),1),t[2]||(t[2]=e()),o("dd",null,[n(y,{type:"separated"},{default:a(()=>[n(ot,{status:d.data.status},null,8,["status"]),t[1]||(t[1]=e()),n(F,{items:d.data.dataplane.networking.inbounds,predicate:l=>l.state!=="Ready",empty:!1},{default:a(({items:l})=>[n(R,{name:"info"},{default:a(()=>[o("ul",null,[(s(!0),p(k,null,c(l,v=>(s(),p("li",{key:`${v.service}:${v.port}`},i(r("data-planes.routes.item.unhealthy_inbound",{port:v.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1024)])]),t[8]||(t[8]=e()),$("use zones")&&d.data.zone?(s(),p("div",mt,[o("dt",null,i(r("http.api.property.zone")),1),t[3]||(t[3]=e()),o("dd",null,[n(g,{appearance:"decorative"},{default:a(()=>[n(C,{to:{name:"zone-cp-detail-view",params:{zone:d.data.zone}}},{default:a(()=>[e(i(d.data.zone),1)]),_:1},8,["to"])]),_:1})])])):b("",!0),t[9]||(t[9]=e()),o("div",null,[o("dt",null,i(r("http.api.property.type")),1),t[4]||(t[4]=e()),o("dd",null,[n(g,{appearance:"decorative"},{default:a(()=>[e(i(r(`data-planes.type.${d.data.dataplaneType}`)),1)]),_:2},1024)])]),t[10]||(t[10]=e()),d.data.namespace.length>0?(s(),p("div",ft,[o("dt",null,i(r("http.api.property.namespace")),1),t[5]||(t[5]=e()),o("dd",null,[n(g,{appearance:"decorative"},{default:a(()=>[e(i(d.data.namespace),1)]),_:1})])])):b("",!0),t[11]||(t[11]=e()),o("div",null,[o("dt",null,i(r("http.api.property.address")),1),t[6]||(t[6]=e()),o("dd",null,[n(Z,{variant:"badge",format:"default",text:`${d.data.dataplane.networking.address}`},null,8,["text"])])]),t[12]||(t[12]=e()),d.data.dataplane.networking.gateway?(s(),p("div",yt,[o("dt",null,i(r("http.api.property.tags")),1),t[7]||(t[7]=e()),o("dd",null,[n(ut,{tags:d.data.dataplane.networking.gateway.tags},null,8,["tags"])])])):b("",!0)]),_:2},1024),t[31]||(t[31]=e()),d.data.dataplaneInsight.mTLS?(s(),m(y,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:a(()=>[o("h3",null,i(r("data-planes.routes.item.mtls.title")),1),t[22]||(t[22]=e()),n(y,{size:"small"},{default:a(()=>[(s(!0),p(k,null,c([d.data.dataplaneInsight.mTLS],l=>(s(),p(k,{key:typeof l},[typeof l.lastCertificateRegeneration<"u"&&typeof l.certificateExpirationTime<"u"&&typeof l.issuedBackend<"u"?(s(),m(N,{key:0,variant:"x-stack"},{default:a(()=>[o("div",null,[o("dt",null,i(r("data-planes.routes.item.mtls.generation_time.title")),1),t[13]||(t[13]=e()),o("dd",null,[n(g,{appearance:"neutral"},{default:a(()=>[e(i(r("common.formats.datetime",{value:Date.parse(l.lastCertificateRegeneration)})),1)]),_:2},1024)])]),t[15]||(t[15]=e()),o("div",null,[o("dt",null,i(r("data-planes.routes.item.mtls.expiration_time.title")),1),t[14]||(t[14]=e()),o("dd",null,[n(g,{appearance:"neutral"},{default:a(()=>[e(i(r("common.formats.datetime",{value:Date.parse(l.certificateExpirationTime)})),1)]),_:2},1024)])])]),_:2},1024)):(s(),m(B,{key:1,path:"data-planes.routes.item.mtls.managed_externally"})),t[21]||(t[21]=e()),n(N,{variant:"x-stack"},{default:a(()=>[typeof l.certificateRegenerations<"u"?(s(),p("div",vt,[o("dt",null,i(r("data-planes.routes.item.mtls.regenerations.title")),1),t[16]||(t[16]=e()),o("dd",null,[n(g,{appearance:"info"},{default:a(()=>[e(i(r("common.formats.integer",{value:l.certificateRegenerations})),1)]),_:2},1024)])])):b("",!0),t[19]||(t[19]=e()),typeof l.issuedBackend<"u"?(s(),p("div",kt,[o("dt",null,i(r("data-planes.routes.item.mtls.issued_backend.title")),1),t[17]||(t[17]=e()),o("dd",null,[n(g,{appearance:"decorative"},{default:a(()=>[e(i(l.issuedBackend),1)]),_:2},1024)])])):b("",!0),t[20]||(t[20]=e()),typeof l.supportedBackends<"u"?(s(),p("div",gt,[o("dt",null,i(r("data-planes.routes.item.mtls.supported_backends.title")),1),t[18]||(t[18]=e()),o("dd",null,[n(y,{type:"separated",truncate:""},{default:a(()=>[(s(!0),p(k,null,c(l.supportedBackends,v=>(s(),m(g,{key:v,appearance:v===l.issuedBackend?"decorative":"info"},{default:a(()=>[e(i(v),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)])])):b("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):b("",!0),t[32]||(t[32]=e()),d.data.dataplaneInsight.subscriptions.length>0?(s(),m(y,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:a(()=>[n(y,{type:"separated"},{default:a(()=>[o("h3",null,i(r("data-planes.routes.item.subscriptions.title")),1),t[23]||(t[23]=e()),n(C,{appearance:"anchor",to:{name:"data-plane-subscriptions-list-view",params:{mesh:u.params.mesh,proxy:u.params.proxy},query:{inactive:u.params.inactive}}},{default:a(()=>[e(`
                  (`+i(r("data-planes.routes.item.xds.show-details"))+`)
                `,1)]),_:2},1032,["to"])]),_:2},1024),t[29]||(t[29]=e()),d.data.dataplaneInsight.connectedSubscription?(s(),m(N,{key:0,variant:"x-stack"},{default:a(()=>[o("div",null,[o("dt",null,i(r("data-planes.routes.item.xds.connected")),1),t[24]||(t[24]=e()),o("dd",null,[n(g,{appearance:"neutral"},{default:a(()=>[e(i(r("common.formats.datetime",{value:Date.parse(d.data.dataplaneInsight.connectedSubscription.connectTime??"")})),1)]),_:2},1024)])]),t[27]||(t[27]=e()),o("div",null,[o("dt",null,i(r("data-planes.routes.item.xds.instance")),1),t[25]||(t[25]=e()),o("dd",null,[n(g,null,{default:a(()=>[e(i(d.data.dataplaneInsight.connectedSubscription.controlPlaneInstanceId),1)]),_:1})])]),t[28]||(t[28]=e()),o("div",null,[o("dt",null,i(r("data-planes.routes.item.xds.version")),1),t[26]||(t[26]=e()),o("dd",null,[n(g,null,{default:a(()=>[e(i(d.data.dataplaneInsight.connectedSubscription.version?.kumaDp?.version??r("common.unknown")),1)]),_:2},1024)])])]),_:2},1024)):(s(),m(B,{key:1,path:"data-planes.routes.item.xds.disconnected"}))]),_:2},1024)):b("",!0),t[33]||(t[33]=e()),$("use unified-resource-naming",{mesh:d.mesh,dataplaneOverview:d.data})?(s(),m(A,{key:2,src:E(I(st),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:u.params.mesh,name:u.params.proxy}),onChange:t[0]||(t[0]=l=>z.value=l)},{default:a(()=>[z.value?.policies.length?(s(),m(y,{key:0,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:a(()=>[o("h3",null,i(r("data-planes.routes.item.policies")),1),t[30]||(t[30]=e()),n(y,{type:"separated"},{default:a(()=>[(s(!0),p(k,null,c(z.value?.policies,l=>(s(),m(C,{key:l.kind,to:{name:"data-plane-policy-config-summary-view",params:{mesh:u.params.mesh,proxy:u.params.proxy,policy:l.kind.toLowerCase()}}},{default:a(()=>[n(g,null,{default:a(()=>[e(i(l.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2},1024)):b("",!0)]),_:2},1032,["src"])):b("",!0)]),_:2},1024)]),_:2},1032,["title","created","modified"]),t[48]||(t[48]=e()),n(A,{src:E(I(dt),"/meshes/:mesh/dataplanes/:name/layout",{mesh:u.params.mesh,name:u.params.proxy})},{default:a(({data:l,refresh:v,error:O})=>[n(A,{src:E(I(it),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[u.params.proxyType]??"dataplane",name:u.params.proxy,mesh:u.params.mesh||"*",socketAddress:"self_inbound"})},{default:a(({data:_,error:S,refresh:tt})=>[n(P,{notify:!!S,"data-testid":"warning-stats-not-enhanced",uri:`data-planes.notifications.stats-not-enhanced.${d.data.id}`},{default:a(()=>[n(B,{path:"data-planes.notifications.stats-not-enhanced",params:{error:S?.toString()??""}},null,8,["params"])]),_:2},1032,["notify","uri"]),t[46]||(t[46]=e()),n(Q,{class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[n(M,{data:[l,_]},{default:a(()=>[n(y,{type:"columns"},{default:a(()=>[n(K,null,{title:a(()=>[n(y,{type:"separated"},{default:a(()=>[n(R,{name:"inbound"}),t[34]||(t[34]=e()),t[35]||(t[35]=o("span",null,"Inbounds",-1))]),_:1})]),default:a(()=>[t[37]||(t[37]=e()),(s(!0),p(k,null,c([Object.groupBy(d.data.dataplane.networking.inbounds,x=>x.port)],(x,w)=>(s(),p(k,{key:w},[(s(!0),p(k,null,c([l.inbounds],X=>(s(),m(T,{key:typeof X,type:"inbound","data-testid":"dataplane-inbounds"},{default:a(()=>[n(y,{type:"stack",size:"small"},{default:a(()=>[(s(!0),p(k,null,c(X,D=>(s(),p(k,{key:`${D.kri}`},[(s(!0),p(k,null,c([x[D.port]?.[0]],V=>(s(),m(q,{key:V?.port,"data-testid":"dataplane-inbound",protocol:D.protocol,"port-name":V?.portName,traffic:_?.inbounds[D.stat_prefix],"data-actionable":""},{state:a(()=>[V?.state!=="Ready"?(s(),m(R,{key:0,name:"danger",size:I(lt),placement:"right"},{default:a(()=>[e(i(r("data-planes.routes.item.unhealthy_inbound",{port:V?.port})),1)]),_:2},1032,["size"])):b("",!0)]),default:a(()=>[t[36]||(t[36]=e()),n(C,{"data-action":"",to:{name:(G=>G.includes("bound")?G.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(I(j).name)),params:{connection:D.proxyResourceName},query:{inactive:u.params.inactive}}},{default:a(()=>[e(i(D.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:2},1024),t[45]||(t[45]=e()),n(K,null,{actions:a(()=>[n(C,{action:"refresh",appearance:"primary",onClick:()=>{v(),tt()}},{default:a(()=>[...t[38]||(t[38]=[e(`
                        Refresh
                      `,-1)])]),_:1},8,["onClick"])]),title:a(()=>[n(y,{type:"separated"},{default:a(()=>[n(R,{name:"outbound"}),t[39]||(t[39]=e()),t[40]||(t[40]=o("span",null,"Outbounds",-1))]),_:1})]),default:a(()=>[t[43]||(t[43]=e()),t[44]||(t[44]=e()),typeof O>"u"&&typeof S>"u"&&l?.outbounds.length?(s(),p(k,{key:0},[n(T,{type:"passthrough"},{default:a(()=>[n(q,{protocol:"passthrough",traffic:_?.passthrough},{default:a(()=>[...t[41]||(t[41]=[e(`
                          Non mesh traffic
                        `,-1)])]),_:1},8,["traffic"])]),_:2},1024),t[42]||(t[42]=e()),n(F,{type:"outbounds",items:l?.outbounds},{default:a(({items:x})=>[n(T,{type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[n(y,{type:"stack",size:"small"},{default:a(()=>[(s(!0),p(k,null,c(x,w=>(s(),m(q,{key:w.kri,"data-testid":"dataplane-outbound",protocol:w.protocol,traffic:_?.outbounds[w.kri],"data-actionable":""},{default:a(()=>[n(C,{"data-action":"",to:{name:(X=>X.includes("bound")?X.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(I(j).name)),params:{connection:w.proxyResourceName},query:{inactive:u.params.inactive}}},{default:a(()=>[e(i(w.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(s(),m(J,{key:1}))]),_:2},1024)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1024),t[47]||(t[47]=e()),n(Y,null,{default:a(x=>[x.route.name!==u.name?(s(),m(W,{key:0,width:"670px",onClose:()=>{u.replace({name:"data-plane-detail-view",params:{mesh:u.params.mesh,proxy:u.params.proxy},query:{inactive:u.params.inactive?null:void 0}})}},{default:a(()=>[(s(),m(rt(x.Component),{data:x.route.name.includes("-inbound-")?l?.inbounds:l?.outbounds,"data-plane-overview":d.data,networking:d.data.dataplane.networking,policies:z.value?.policies},null,8,["data","data-plane-overview","networking","policies"]))]),_:2},1032,["onClose"])):b("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1024)]),_:2},1024)]),_:1})}}}),_t=pt(bt,[["__scopeId","data-v-aa6cfbca"]]);export{_t as default};
