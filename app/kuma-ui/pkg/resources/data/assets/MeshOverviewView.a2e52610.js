import{d as O,e as u,f as F,o as l,j as i,a as h,u as t,b as c,s as X,H,q as K,r as b,y as U,ct as P,k as R,c as E,w as f,l as d,F as C,n as D,t as m,S as $,B as N}from"./index.782e29ff.js";import{_ as L,a as T,M as W}from"./MeshResources.45d72c0a.js";import{_ as A}from"./LabelList.vue_vue_type_style_index_0_lang.bff9dfc9.js";import{T as z}from"./TabsWidget.d5dfcc63.js";import{_ as G}from"./YamlView.vue_vue_type_script_setup_true_lang.c215dd4f.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.fe3464f0.js";import"./ErrorBlock.e7a95361.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.10b3a197.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.7bd622f2.js";import"./_commonjsHelpers.f037b798.js";const J={class:"chart-container mt-16"},Q=O({__name:"MeshCharts",setup(Y){const s=X(),y=u(()=>s.getters.getServiceResourcesFetching),M=u(()=>s.getters.getMeshInsightsFetching),p=u(()=>s.getters.getChart("services")),g=u(()=>s.getters.getChart("dataplanes")),_=u(()=>s.getters.getChart("kumaDPVersions")),o=u(()=>s.getters.getChart("envoyVersions"));F(()=>s.state.selectedMesh,function(){w()}),w();function w(){s.dispatch("fetchMeshInsights",s.state.selectedMesh),s.dispatch("fetchServices",s.state.selectedMesh)}return(V,I)=>(l(),i("div",J,[h(L,{class:"chart chart-1/4",title:{singular:"SERVICE",plural:"SERVICES"},data:t(p).data,"is-loading":t(y),"save-chart":""},null,8,["data","is-loading"]),c(),h(L,{class:"chart chart-1/4",title:{singular:"DP PROXY",plural:"DP PROXIES"},data:t(g).data,url:{name:"data-plane-list-view",params:{mesh:t(s).state.selectedMesh}},"is-loading":t(M)},null,8,["data","url","is-loading"]),c(),h(T,{class:"chart chart-1/4",title:"KUMA DP",data:t(_).data,"is-loading":t(M)},null,8,["data","is-loading"]),c(),h(T,{class:"chart chart-1/4",title:"ENVOY",data:t(o).data,"is-loading":t(M),"display-am-charts-logo":""},null,8,["data","is-loading"])]))}});const Z=H(Q,[["__scopeId","data-v-da78099c"]]),ee={key:1},ae={key:1},te={key:1,class:"mt-8"},pe=O({__name:"MeshOverviewView",setup(Y){const s=K(),y=X(),M=[{hash:"#overview",title:"Overview"},{hash:"#resources",title:"Resources"}],p=b(!0),g=b(!1),_=b(!1),o=b(null),w=b(null),V=u(()=>o.value!==null?U(o.value):null),I=u(()=>{if(o.value===null)return null;const{name:n,type:r,creationTime:e,modificationTime:a}=o.value;return{name:n,type:r,created:P(e),modified:P(a)}}),j=u(()=>{var k;if(o.value===null)return null;const n=B(o.value,"mtls"),r=B(o.value,"logging"),e=B(o.value,"metrics"),a=B(o.value,"tracing"),v=Boolean((k=o.value.routing)==null?void 0:k.localityAwareLoadBalancing);return{mtls:n,logging:r,metrics:e,tracing:a,localityAwareLoadBalancing:v}}),x=u(()=>{const n=y.state.policies.map(r=>{var e,a;return{title:r.pluralDisplayName,value:(a=(e=y.state.meshInsight.policies[r.name])==null?void 0:e.total)!=null?a:0}});return[{title:"Data Plane Proxies",value:y.state.meshInsight.dataplanes.total},...n]});F(()=>s.params.mesh,function(){s.name==="single-mesh-overview"&&(p.value=!0,_.value=!1,g.value=!1,S())}),S();async function S(){p.value=!0,_.value=!1;const n=s.params.mesh;try{o.value=await R.getMesh({name:n}),w.value=await R.getMeshInsights({name:n})}catch(r){g.value=!0,_.value=!0,console.error(r)}finally{p.value=!1}}function B(n,r){var v,k;if(n===null||n[r]===void 0)return!1;const e=(k=(v=n[r].enabledBackend)!=null?v:n[r].defaultBackend)!=null?k:n[r].backends[0].name,a=n[r].backends.find(q=>q.name===e);return`${a.type} / ${a.name}`}return(n,r)=>(l(),i(C,null,[h(Z),c(),h(W,{class:"mt-8"}),c(),o.value!==null?(l(),E(z,{key:0,class:"mt-8","has-error":g.value,"is-loading":p.value,tabs:M,"initial-tab-override":"overview"},{overview:f(()=>[h(A,null,{default:f(()=>[d("div",null,[d("ul",null,[(l(!0),i(C,null,D(t(I),(e,a)=>(l(),i("li",{key:a},[d("h4",null,m(a),1),c(),typeof e=="boolean"?(l(),E(t($),{key:0,appearance:e?"success":"danger"},{default:f(()=>[c(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),i("p",ee,m(e),1))]))),128))])]),c(),d("div",null,[d("ul",null,[(l(!0),i(C,null,D(t(j),(e,a)=>(l(),i("li",{key:a},[d("h4",null,m(a),1),c(),typeof e=="boolean"?(l(),E(t($),{key:0,appearance:e?"success":"danger"},{default:f(()=>[c(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),i("p",ae,m(e),1))]))),128))])])]),_:1})]),resources:f(()=>[h(A,{"has-error":g.value,"is-loading":p.value,"is-empty":_.value},{default:f(()=>[(l(!0),i(C,null,D(Math.ceil(t(x).length/3),e=>(l(),i("div",{key:e},[d("ul",null,[(l(!0),i(C,null,D(t(x).slice((e-1)*3,e*3),(a,v)=>(l(),i("li",{key:v},[d("h4",null,m(a.title),1),c(),d("p",null,m(a.value),1)]))),128))])]))),128))]),_:1},8,["has-error","is-loading","is-empty"])]),_:1},8,["has-error","is-loading"])):N("",!0),c(),t(V)!==null?(l(),i("div",te,[h(G,{id:"code-block-mesh",content:t(V)},null,8,["content"])])):N("",!0)],64))}});export{pe as default};
