import{d as et,a2 as nt,v as ot,r as y,p as u,o,w as a,b as n,m as X,a3 as st,c as p,e,L as f,M as b,q as g,l as s,t as d,T as it,F as dt,$ as lt,a4 as j,y as rt,_ as pt}from"./index-B99ecjhH.js";import{T as ut}from"./TagList-De8uOK9a.js";import{C as M,a as F,b as P}from"./ConnectionTraffic-Bo9lQTzf.js";const mt={key:0},ft={key:1},yt={key:2},kt={key:0},vt={key:1},gt={key:2},ct=et({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(Z){const U=nt(),i=Z,N=ot();return(bt,t)=>{const R=y("XI18n"),V=y("XNotification"),$=y("XIcon"),G=y("DataCollection"),k=y("XLayout"),D=y("XAction"),c=y("XBadge"),H=y("XCopyButton"),B=y("XDl"),A=y("DataSource"),K=y("DataLoader"),J=y("XAboutCard"),Q=y("XEmptyState"),W=y("XCard"),Y=y("XDrawer"),L=y("RouterView"),h=y("AppView"),tt=y("RouteView");return o(),u(tt,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:""},name:"data-plane-detail-view"},{default:a(({route:m,t:r,can:E,uri:S})=>[n(A,{src:S(X(st),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[m.params.proxyType]??"dataplane",name:m.params.proxy,mesh:m.params.mesh||"*",socketAddress:"self_inbound"})},{default:a(({data:C,error:q,refresh:at})=>[n(h,{notifications:!0},{default:a(()=>[(o(!0),p(f,null,b([{bool:i.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:i.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:i.data.dataplaneInsight.version?.envoy.version??"",kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!(E("use zones")&&i.data.zone&&i.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:i.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:i.data.isCertExpired,key:"certificate-expired"},{bool:!i.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:i.data.dataplane.networking.gateway?.type!=="BUILTIN"&&!E("use transparent-proxying",i.data),key:"networking-transparent-proxying",variant:"info"}],({bool:l,key:v,params:O,variant:x})=>(o(),u(V,{key:v,notify:l,"data-testid":`warning-${v}`,uri:`data-planes.notifications.${v}.${i.data.id}`,variant:x},{default:a(()=>[n(R,{path:`data-planes.notifications.${v}`,params:Object.fromEntries(Object.entries(O??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),t[54]||(t[54]=e()),n(k,{type:"stack","data-testid":"dataplane-details"},{default:a(()=>[n(J,{title:r("data-planes.routes.item.about.title"),created:i.data.creationTime,modified:i.data.modificationTime,class:"about-section"},{default:a(()=>[n(K,{data:[C]},{default:a(()=>[n(k,null,{default:a(()=>[n(B,{variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,d(r("http.api.property.status")),1),t[2]||(t[2]=e()),s("dd",null,[n(k,{type:"separated"},{default:a(()=>[n(it,{status:i.data.status},null,8,["status"]),t[1]||(t[1]=e()),n(G,{items:i.data.dataplane.networking.inbounds,predicate:l=>l.state!=="Ready",empty:!1},{default:a(({items:l})=>[n($,{name:"info"},{default:a(()=>[s("ul",null,[(o(!0),p(f,null,b(l,v=>(o(),p("li",{key:`${v.service}:${v.port}`},d(r("data-planes.routes.item.unhealthy_inbound",{port:v.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1024)])]),t[8]||(t[8]=e()),E("use zones")&&i.data.zone?(o(),p("div",mt,[s("dt",null,d(r("http.api.property.zone")),1),t[3]||(t[3]=e()),s("dd",null,[n(c,{appearance:"decorative"},{default:a(()=>[n(D,{to:{name:"zone-cp-detail-view",params:{zone:i.data.zone}}},{default:a(()=>[e(d(i.data.zone),1)]),_:1},8,["to"])]),_:1})])])):g("",!0),t[9]||(t[9]=e()),s("div",null,[s("dt",null,d(r("http.api.property.type")),1),t[4]||(t[4]=e()),s("dd",null,[n(c,{appearance:"decorative"},{default:a(()=>[e(d(r(`data-planes.type.${i.data.dataplaneType}`)),1)]),_:2},1024)])]),t[10]||(t[10]=e()),i.data.namespace.length>0?(o(),p("div",ft,[s("dt",null,d(r("http.api.property.namespace")),1),t[5]||(t[5]=e()),s("dd",null,[n(c,{appearance:"decorative"},{default:a(()=>[e(d(i.data.namespace),1)]),_:1})])])):g("",!0),t[11]||(t[11]=e()),s("div",null,[s("dt",null,d(r("http.api.property.address")),1),t[6]||(t[6]=e()),s("dd",null,[n(H,{variant:"badge",format:"default",text:`${i.data.dataplane.networking.address}`},null,8,["text"])])]),t[12]||(t[12]=e()),i.data.dataplane.networking.gateway?(o(),p("div",yt,[s("dt",null,d(r("http.api.property.tags")),1),t[7]||(t[7]=e()),s("dd",null,[n(ut,{tags:i.data.dataplane.networking.gateway.tags},null,8,["tags"])])])):g("",!0)]),_:2},1024),t[33]||(t[33]=e()),i.data.dataplaneInsight.mTLS?(o(),u(k,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:a(()=>[s("h3",null,d(r("data-planes.routes.item.mtls.title")),1),t[24]||(t[24]=e()),n(k,{size:"small"},{default:a(()=>[(o(!0),p(f,null,b([i.data.dataplaneInsight.mTLS],l=>(o(),p(f,{key:typeof l},[typeof l.lastCertificateRegeneration<"u"&&typeof l.certificateExpirationTime<"u"&&typeof l.issuedBackend<"u"?(o(),u(B,{key:0,variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,d(r("data-planes.routes.item.mtls.generation_time.title")),1),t[13]||(t[13]=e()),s("dd",null,[n(c,{appearance:"neutral"},{default:a(()=>[e(d(r("common.formats.datetime",{value:Date.parse(l.lastCertificateRegeneration)})),1)]),_:2},1024)])]),t[15]||(t[15]=e()),s("div",null,[s("dt",null,d(r("data-planes.routes.item.mtls.expiration_time.title")),1),t[14]||(t[14]=e()),s("dd",null,[n(c,{appearance:"neutral"},{default:a(()=>[e(d(r("common.formats.datetime",{value:Date.parse(l.certificateExpirationTime)})),1)]),_:2},1024)])])]),_:2},1024)):(o(),p(f,{key:1},[n(R,{path:"data-planes.routes.item.mtls.managed_externally"}),t[17]||(t[17]=e()),typeof C?.$meta?.tls?.certificateExpirationTime<"u"?(o(),u(B,{key:0,variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,d(r("data-planes.routes.item.mtls.expiration_time.title")),1),t[16]||(t[16]=e()),s("dd",null,[n(c,{appearance:"neutral"},{default:a(()=>[e(d(r("common.formats.datetime",{value:C?.$meta?.tls?.certificateExpirationTime})),1)]),_:2},1024)])])]),_:2},1024)):g("",!0)],64)),t[23]||(t[23]=e()),n(B,{variant:"x-stack"},{default:a(()=>[typeof l.certificateRegenerations<"u"?(o(),p("div",kt,[s("dt",null,d(r("data-planes.routes.item.mtls.regenerations.title")),1),t[18]||(t[18]=e()),s("dd",null,[n(c,{appearance:"info"},{default:a(()=>[e(d(r("common.formats.integer",{value:l.certificateRegenerations})),1)]),_:2},1024)])])):g("",!0),t[21]||(t[21]=e()),typeof l.issuedBackend<"u"?(o(),p("div",vt,[s("dt",null,d(r("data-planes.routes.item.mtls.issued_backend.title")),1),t[19]||(t[19]=e()),s("dd",null,[n(c,{appearance:"decorative"},{default:a(()=>[e(d(l.issuedBackend),1)]),_:2},1024)])])):g("",!0),t[22]||(t[22]=e()),typeof l.supportedBackends<"u"?(o(),p("div",gt,[s("dt",null,d(r("data-planes.routes.item.mtls.supported_backends.title")),1),t[20]||(t[20]=e()),s("dd",null,[n(k,{type:"separated",truncate:""},{default:a(()=>[(o(!0),p(f,null,b(l.supportedBackends,v=>(o(),u(c,{key:v,appearance:v===l.issuedBackend?"decorative":"info"},{default:a(()=>[e(d(v),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)])])):g("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):g("",!0),t[34]||(t[34]=e()),i.data.dataplaneInsight.subscriptions.length>0?(o(),u(k,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:a(()=>[n(k,{type:"separated"},{default:a(()=>[s("h3",null,d(r("data-planes.routes.item.subscriptions.title")),1),t[25]||(t[25]=e()),n(D,{appearance:"anchor",to:{name:"data-plane-subscriptions-list-view",params:{mesh:m.params.mesh,proxy:m.params.proxy},query:{inactive:m.params.inactive}}},{default:a(()=>[e(`
                      (`+d(r("data-planes.routes.item.xds.show-details"))+`)
                    `,1)]),_:2},1032,["to"])]),_:2},1024),t[31]||(t[31]=e()),i.data.dataplaneInsight.connectedSubscription?(o(),u(B,{key:0,variant:"x-stack"},{default:a(()=>[s("div",null,[s("dt",null,d(r("data-planes.routes.item.xds.connected")),1),t[26]||(t[26]=e()),s("dd",null,[n(c,{appearance:"neutral"},{default:a(()=>[e(d(r("common.formats.datetime",{value:Date.parse(i.data.dataplaneInsight.connectedSubscription.connectTime??"")})),1)]),_:2},1024)])]),t[29]||(t[29]=e()),s("div",null,[s("dt",null,d(r("data-planes.routes.item.xds.instance")),1),t[27]||(t[27]=e()),s("dd",null,[n(c,null,{default:a(()=>[e(d(i.data.dataplaneInsight.connectedSubscription.controlPlaneInstanceId),1)]),_:1})])]),t[30]||(t[30]=e()),s("div",null,[s("dt",null,d(r("data-planes.routes.item.xds.version")),1),t[28]||(t[28]=e()),s("dd",null,[n(c,null,{default:a(()=>[e(d(i.data.dataplaneInsight.connectedSubscription.version?.kumaDp?.version??r("common.unknown")),1)]),_:2},1024)])])]),_:2},1024)):(o(),u(R,{key:1,path:"data-planes.routes.item.xds.disconnected"}))]),_:2},1024)):g("",!0),t[35]||(t[35]=e()),E("use unified-resource-naming",{mesh:i.mesh,dataplaneOverview:i.data})?(o(),u(A,{key:2,src:S(X(dt),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:m.params.mesh,name:m.params.proxy}),onChange:t[0]||(t[0]=l=>N.value=l)},{default:a(()=>[N.value?.policies.length?(o(),u(k,{key:0,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:a(()=>[s("h3",null,d(r("data-planes.routes.item.policies")),1),t[32]||(t[32]=e()),n(k,{type:"separated"},{default:a(()=>[(o(!0),p(f,null,b(N.value?.policies,l=>(o(),u(D,{key:l.kind,to:{name:"data-plane-policy-config-summary-view",params:{mesh:m.params.mesh,proxy:m.params.proxy,policy:l.kind.toLowerCase()}}},{default:a(()=>[n(c,null,{default:a(()=>[e(d(l.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2},1024)):g("",!0)]),_:2},1032,["src"])):g("",!0)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["title","created","modified"]),t[53]||(t[53]=e()),n(A,{src:S(X(lt),"/meshes/:mesh/dataplanes/:name/layout",{mesh:m.params.mesh,name:m.params.proxy})},{default:a(({data:l,refresh:v,error:O})=>[n(V,{notify:!!q,"data-testid":"warning-stats-not-enhanced",uri:`data-planes.notifications.stats-not-enhanced.${i.data.id}`},{default:a(()=>[n(R,{path:"data-planes.notifications.stats-not-enhanced",params:{error:q?.toString()??""}},null,8,["params"])]),_:2},1032,["notify","uri"]),t[51]||(t[51]=e()),n(W,{class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[n(K,{data:[l,C]},{default:a(()=>[n(k,{type:"columns"},{default:a(()=>[n(M,null,{title:a(()=>[n(k,{type:"separated"},{default:a(()=>[n($,{name:"inbound"}),t[36]||(t[36]=e()),t[37]||(t[37]=s("span",null,"Inbounds",-1))]),_:1})]),default:a(()=>[t[40]||(t[40]=e()),(o(!0),p(f,null,b([Object.groupBy(i.data.dataplane.networking.inbounds,x=>x.port)],(x,_)=>(o(),p(f,{key:_},[(o(!0),p(f,null,b([l.inbounds],w=>(o(),u(F,{key:typeof w,type:"inbound","data-testid":"dataplane-inbounds"},{default:a(()=>[n(k,{type:"stack",size:"small"},{default:a(()=>[(o(!0),p(f,null,b(w,I=>(o(),p(f,{key:`${I.kri}`},[(o(!0),p(f,null,b([x[I.port]?.[0]],T=>(o(),u(P,{key:T?.port,"data-testid":"dataplane-inbound",protocol:I.protocol,"port-name":T?.portName,traffic:C?.inbounds[I.stat_prefix],"data-actionable":""},{state:a(()=>[T?.state!=="Ready"?(o(),u($,{key:0,name:"danger",size:X(j),placement:"right"},{default:a(()=>[e(d(r("data-planes.routes.item.unhealthy_inbound",{port:T?.port})),1)]),_:2},1032,["size"])):(o(!0),p(f,{key:1},b([C?.inbounds[I.stat_prefix]?.$meta.alerts.reports??[]],z=>(o(),p(f,{key:typeof z},[n(V,{notify:z.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${i.data.id}`},{default:a(()=>[n(R,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[38]||(t[38]=e()),z.length?(o(),u(D,{key:0,"data-action":"",to:{name:"data-plane-connection-inbound-summary-stats-view",params:{connection:I.stat_prefix},query:{codeSearch:z.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:a(()=>[n($,{name:"warning",size:X(j),placement:"right"},null,8,["size"])]),_:1},8,["to"])):g("",!0)],64))),128))]),default:a(()=>[t[39]||(t[39]=e()),n(D,{"data-action":"",to:{name:(z=>z.includes("bound")?z.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(X(U).name)),params:{connection:I.proxyResourceName},query:{inactive:m.params.inactive}}},{default:a(()=>[e(d(I.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:2},1024),t[50]||(t[50]=e()),n(M,null,{actions:a(()=>[n(D,{action:"refresh",appearance:"primary",onClick:()=>{v(),at()}},{default:a(()=>[...t[41]||(t[41]=[e(`
                        Refresh
                      `,-1)])]),_:1},8,["onClick"])]),title:a(()=>[n(k,{type:"separated"},{default:a(()=>[n($,{name:"outbound"}),t[42]||(t[42]=e()),t[43]||(t[43]=s("span",null,"Outbounds",-1))]),_:1})]),default:a(()=>[t[48]||(t[48]=e()),t[49]||(t[49]=e()),typeof O>"u"&&typeof q>"u"&&l?.outbounds.length?(o(),p(f,{key:0},[n(F,{type:"passthrough"},{default:a(()=>[n(P,{protocol:"passthrough",traffic:C?.passthrough},{default:a(()=>[...t[44]||(t[44]=[e(`
                          Non mesh traffic
                        `,-1)])]),_:1},8,["traffic"])]),_:2},1024),t[47]||(t[47]=e()),n(G,{type:"outbounds",items:l?.outbounds},{default:a(({items:x})=>[n(F,{type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[n(k,{type:"stack",size:"small"},{default:a(()=>[(o(!0),p(f,null,b(x,_=>(o(),u(P,{key:_.kri,"data-testid":"dataplane-outbound",protocol:_.protocol,traffic:C?.outbounds[_.kri],"data-actionable":""},{state:a(()=>[(o(!0),p(f,null,b([C?.outbounds[_.proxyResourceName]?.$meta.alerts.reports??[]],w=>(o(),p(f,{key:typeof w},[n(V,{notify:w.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${i.data.id}`},{default:a(()=>[n(R,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[45]||(t[45]=e()),w.length?(o(),u(D,{key:0,"data-action":"",to:{name:"data-plane-connection-outbound-summary-stats-view",params:{connection:_.proxyResourceName},query:{codeSearch:w.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:a(()=>[n($,{name:"warning",size:X(j),placement:"right"},null,8,["size"])]),_:1},8,["to"])):g("",!0)],64))),128))]),default:a(()=>[t[46]||(t[46]=e()),n(D,{"data-action":"",to:{name:(w=>w.includes("bound")?w.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(X(U).name)),params:{connection:_.proxyResourceName},query:{inactive:m.params.inactive}}},{default:a(()=>[e(d(_.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(o(),u(Q,{key:1}))]),_:2},1024)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1024),t[52]||(t[52]=e()),n(L,null,{default:a(x=>[x.route.name!==m.name?(o(),u(Y,{key:0,width:"670px",onClose:()=>{m.replace({name:"data-plane-detail-view",params:{mesh:m.params.mesh,proxy:m.params.proxy},query:{inactive:m.params.inactive?null:void 0}})}},{default:a(()=>[(o(),u(rt(x.Component),{data:x.route.name.includes("-inbound-")?l?.inbounds:l?.outbounds,"data-plane-overview":i.data,networking:i.data.dataplane.networking,policies:N.value?.policies},null,8,["data","data-plane-overview","networking","policies"]))]),_:2},1032,["onClose"])):g("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),_t=pt(ct,[["__scopeId","data-v-ee65ced1"]]);export{_t as default};
