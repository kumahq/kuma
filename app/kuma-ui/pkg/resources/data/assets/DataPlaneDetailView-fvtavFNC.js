import{d as oa,a2 as sa,a9 as ra,r as c,p,o,w as a,b as t,m as C,F as K,$ as ia,a3 as pa,c as y,e as n,N as f,L as v,q as _,O as b,T as da,l as z,t as i,M as la,a5 as ua,a4 as ma,y as ya,_ as fa}from"./index-DyXXWg22.js";import{T as ca}from"./TagList-DHHCy3hR.js";import{C as G,a as A,b as O}from"./ConnectionTraffic-p5bsJpNU.js";const ba=oa({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(M){const q=sa(),s=M;return ra("data-plane-overview",s.data),(ka,e)=>{const w=c("XI18n"),P=c("XNotification"),X=c("XIcon"),T=c("DataCollection"),m=c("XLayout"),D=c("XAction"),k=c("XBadge"),U=c("XCopyButton"),Z=c("XAboutCard"),j=c("XEmptyState"),H=c("XCard"),J=c("XDrawer"),Q=c("RouterView"),W=c("AppView"),Y=c("DataLoader"),R=c("DataSource"),L=c("RouteView");return o(),p(L,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:a(({route:u,t:d,can:E,uri:N})=>[t(R,{src:N(C(K),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:u.params.mesh,name:u.params.proxy})},{default:a(({data:B})=>[t(R,{src:N(C(ia),"/meshes/:mesh/dataplanes/:name/layout",{mesh:u.params.mesh,name:u.params.proxy})},{default:a(({data:h,refresh:aa,error:ea})=>[t(R,{src:N(C(K),"/policy-types",{})},{default:a(({data:S})=>[t(R,{src:N(C(pa),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[u.params.proxyType]??"dataplane",name:u.params.proxy,mesh:u.params.mesh||"*",socketAddress:"self_inbound"})},{default:a(({data:V,error:ta,refresh:na})=>[t(Y,{data:[h,B,S,V]},{default:a(()=>[t(W,{notifications:!0},{default:a(()=>[(o(!0),y(f,null,v([{bool:s.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:s.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:s.data.dataplaneInsight.version?.envoy.version??"",kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!(E("use zones")&&s.data.zone&&s.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:s.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:s.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:s.data.isCertExpired,key:"certificate-expired"},{bool:!s.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!E("use transparent-proxying",s.data),key:"networking-transparent-proxying",variant:"info"}],({bool:r,key:l,params:I,variant:g})=>(o(),p(P,{key:l,notify:r,"data-testid":`warning-${l}`,uri:`data-planes.notifications.${l}.${s.data.id}`,variant:g},{default:a(()=>[t(w,{path:`data-planes.notifications.${l}`,params:Object.fromEntries(Object.entries(I??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),e[48]||(e[48]=n()),t(m,{type:"stack","data-testid":"dataplane-details"},{default:a(()=>[t(Z,{title:d("data-planes.routes.item.about.title"),created:s.data.creationTime,modified:s.data.modificationTime,class:"about-section"},{default:a(()=>[t(m,null,{default:a(()=>[t(m,{type:"separated"},{default:a(()=>[t(b,{layout:"horizontal"},{title:a(()=>[n(i(d("http.api.property.status")),1)]),body:a(()=>[t(m,{type:"separated"},{default:a(()=>[t(da,{status:s.data.status},null,8,["status"]),e[0]||(e[0]=n()),s.data.dataplaneType==="standard"?(o(),p(T,{key:0,items:s.data.dataplane.networking.inbounds,predicate:r=>r.state!=="Ready",empty:!1},{default:a(({items:r})=>[t(X,{name:"info"},{default:a(()=>[z("ul",null,[(o(!0),y(f,null,v(r,l=>(o(),y("li",{key:`${l.service}:${l.port}`},i(d("data-planes.routes.item.unhealthy_inbound",{port:l.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):_("",!0)]),_:2},1024)]),_:2},1024),e[7]||(e[7]=n()),E("use zones")&&s.data.zone?(o(),p(b,{key:0,layout:"horizontal"},{title:a(()=>[n(i(d("http.api.property.zone")),1)]),body:a(()=>[t(k,{appearance:"decorative"},{default:a(()=>[t(D,{to:{name:"zone-cp-detail-view",params:{zone:s.data.zone}}},{default:a(()=>[n(i(s.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2},1024)):_("",!0),e[8]||(e[8]=n()),t(b,{layout:"horizontal"},{title:a(()=>[n(i(d("http.api.property.type")),1)]),body:a(()=>[t(k,{appearance:"decorative"},{default:a(()=>[n(i(d(`data-planes.type.${s.data.dataplaneType}`)),1)]),_:2},1024)]),_:2},1024),e[9]||(e[9]=n()),s.data.namespace.length>0?(o(),p(b,{key:1,layout:"horizontal"},{title:a(()=>[n(i(d("http.api.property.namespace")),1)]),body:a(()=>[t(k,{appearance:"decorative"},{default:a(()=>[n(i(s.data.namespace),1)]),_:1})]),_:2},1024)):_("",!0),e[10]||(e[10]=n()),t(b,{layout:"horizontal"},{title:a(()=>[n(i(d("http.api.property.address")),1)]),body:a(()=>[t(U,{variant:"badge",format:"default",text:`${s.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024),e[11]||(e[11]=n()),s.data.dataplane.networking.gateway?(o(),p(b,{key:2,layout:"horizontal"},{title:a(()=>[n(i(d("http.api.property.tags")),1)]),body:a(()=>[t(ca,{tags:s.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024)):_("",!0)]),_:2},1024),e[30]||(e[30]=n()),s.data.dataplaneInsight.mTLS?(o(),p(m,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:a(()=>[z("h3",null,i(d("data-planes.routes.item.mtls.title")),1),e[21]||(e[21]=n()),t(m,{size:"small"},{default:a(()=>[(o(!0),y(f,null,v([s.data.dataplaneInsight.mTLS],r=>(o(),y(f,{key:r},[t(m,{type:"separated"},{default:a(()=>[typeof r.lastCertificateRegeneration<"u"&&typeof r.certificateExpirationTime<"u"&&typeof r.issuedBackend<"u"?(o(),y(f,{key:0},[t(b,{layout:"horizontal"},{title:a(()=>[t(w,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:a(()=>[t(k,{appearance:"neutral"},{default:a(()=>[n(i(d("common.formats.datetime",{value:Date.parse(r.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2},1024),e[14]||(e[14]=n()),t(b,{layout:"horizontal"},{title:a(()=>[t(w,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:a(()=>[t(k,{appearance:"neutral"},{default:a(()=>[n(i(d("common.formats.datetime",{value:Date.parse(r.certificateExpirationTime)})),1)]),_:2},1024)]),_:2},1024)],64)):(o(),p(w,{key:1,path:"data-planes.routes.item.mtls.managed_externally"}))]),_:2},1024),e[20]||(e[20]=n()),t(m,{type:"separated"},{default:a(()=>[typeof r.certificateRegenerations<"u"?(o(),p(b,{key:0,layout:"horizontal"},{title:a(()=>[n(i(d("data-planes.routes.item.mtls.regenerations.title")),1)]),body:a(()=>[t(k,{appearance:"info"},{default:a(()=>[n(i(d("common.formats.integer",{value:r.certificateRegenerations})),1)]),_:2},1024)]),_:2},1024)):_("",!0),e[18]||(e[18]=n()),r.issuedBackend?(o(),p(b,{key:1,layout:"horizontal"},{title:a(()=>[n(i(d("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:a(()=>[t(k,{appearance:"decorative"},{default:a(()=>[n(i(r.issuedBackend),1)]),_:2},1024)]),_:2},1024)):_("",!0),e[19]||(e[19]=n()),typeof r.supportedBackends<"u"?(o(),p(b,{key:2,layout:"horizontal"},{title:a(()=>[n(i(d("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:a(()=>[t(m,{type:"separated",truncate:""},{default:a(()=>[(o(!0),y(f,null,v(r.supportedBackends,l=>(o(),p(k,{key:l,appearance:l===r.issuedBackend?"decorative":"info"},{default:a(()=>[n(i(l),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2},1024)):_("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):_("",!0),e[31]||(e[31]=n()),s.data.dataplaneInsight.subscriptions.length>0?(o(),p(m,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:a(()=>[t(m,{type:"separated"},{default:a(()=>[z("h3",null,i(d("data-planes.routes.item.subscriptions.title")),1),e[22]||(e[22]=n()),t(D,{"data-action":"",appearance:"anchor",to:{name:"data-plane-subscriptions-summary-view",params:{mesh:u.params.mesh,proxy:u.params.proxy},query:{inactive:u.params.inactive}}},{default:a(()=>[n(`
                            (`+i(d("data-planes.routes.item.xds.show-details"))+`)
                          `,1)]),_:2},1032,["to"])]),_:2},1024),e[28]||(e[28]=n()),(o(!0),y(f,null,v([[...s.data.dataplaneInsight.subscriptions].reverse()],r=>(o(),p(m,{key:typeof r,type:"separated"},{default:a(()=>[(o(!0),y(f,null,v([r.find(l=>!l.disconnectTime)??r[0]],l=>(o(),y(f,{key:l.id},[!l.disconnectTime&&l.connectTime?(o(),y(f,{key:0},[t(b,{layout:"horizontal"},{title:a(()=>[t(w,{path:"data-planes.routes.item.xds.connected"})]),body:a(()=>[t(k,{appearance:"neutral"},{default:a(()=>[n(i(d("common.formats.datetime",{value:Date.parse(l.connectTime)})),1)]),_:2},1024)]),_:2},1024),e[26]||(e[26]=n()),t(b,{layout:"horizontal"},{title:a(()=>[t(w,{path:"data-planes.routes.item.xds.instance"})]),body:a(()=>[t(k,{appearance:"info"},{default:a(()=>[n(i(l.controlPlaneInstanceId),1)]),_:2},1024)]),_:2},1024),e[27]||(e[27]=n()),t(b,{layout:"horizontal"},{title:a(()=>[t(w,{path:"data-planes.routes.item.xds.version"})]),body:a(()=>[t(k,{appearance:"info"},{default:a(()=>[n(i(l.version?.kumaDp?.version??d("common.unknown")),1)]),_:2},1024)]),_:2},1024)],64)):(o(),p(w,{key:1,path:"data-planes.routes.item.xds.disconnected"}))],64))),128))]),_:2},1024))),128))]),_:2},1024)):_("",!0),e[32]||(e[32]=n()),B?.policies.length?(o(),p(m,{key:2,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:a(()=>[z("h3",null,i(d("data-planes.routes.item.policies")),1),e[29]||(e[29]=n()),t(m,{type:"separated"},{default:a(()=>[(o(!0),y(f,null,v(B?.policies,r=>(o(),p(D,{key:r.kind,"data-action":"",appearance:"anchor",to:{name:"data-plane-policy-config-summary-view",params:{mesh:u.params.mesh,proxy:u.params.proxy,policy:r.kind.toLowerCase()}}},{default:a(()=>[t(k,null,{default:a(()=>[n(i(r.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2},1024)):_("",!0)]),_:2},1024)]),_:2},1032,["title","created","modified"]),e[46]||(e[46]=n()),(o(!0),y(f,null,v([Object.groupBy(s.data.dataplane.networking.inbounds,r=>r.port)],(r,l)=>(o(),p(H,{key:l,class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[t(m,{type:"columns"},{default:a(()=>[t(G,null,{title:a(()=>[t(m,{type:"separated"},{default:a(()=>[t(X,{name:"inbound"}),e[33]||(e[33]=n()),e[34]||(e[34]=z("span",null,"Inbounds",-1))]),_:1})]),default:a(()=>[e[37]||(e[37]=n()),(o(!0),y(f,null,v([h?.inbounds??[]],I=>(o(),p(A,{key:typeof I,type:"inbound","data-testid":"dataplane-inbounds"},{default:a(()=>[t(T,{type:"inbounds",items:I,predicate:g=>g.port!==49151},la({default:a(({items:g})=>[t(m,{type:"stack",size:"small"},{default:a(()=>[(o(!0),y(f,null,v(g,x=>(o(),y(f,{key:`${x.kri}`},[(o(!0),y(f,null,v([r[x.port]?.[0]],$=>(o(),p(O,{key:$?.port,"data-testid":"dataplane-inbound",protocol:x.protocol,"port-name":$?.portName,traffic:V?.inbounds[x.proxyResourcePortName],"data-actionable":""},{state:a(()=>[$?.state!=="Ready"?(o(),p(X,{key:0,name:"danger",size:C(ua),placement:"right"},{default:a(()=>[n(i(d("data-planes.routes.item.unhealthy_inbound",{port:$?.port})),1)]),_:2},1032,["size"])):_("",!0)]),default:a(()=>[e[35]||(e[35]=n()),t(D,{"data-action":"",to:{name:(F=>F.includes("bound")?F.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(C(q).name)),params:{connection:x.proxyResourceName},query:{inactive:u.params.inactive}}},{default:a(()=>[n(i(x.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},[s.data.dataplaneType==="delegated"?{name:"empty",fn:a(()=>[t(j,null,{default:a(()=>[z("p",null,`
                                      This proxy is a delegated gateway therefore `+i(d("common.product.name"))+` does not have any
                                      visibility into inbounds for this gateway.
                                    `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),e[45]||(e[45]=n()),t(G,null,{actions:a(()=>[t(D,{action:"refresh",appearance:"primary",onClick:()=>{aa(),na()}},{default:a(()=>[...e[38]||(e[38]=[n(`
                              Refresh
                            `,-1)])]),_:1},8,["onClick"])]),title:a(()=>[t(m,{type:"separated"},{default:a(()=>[t(X,{name:"outbound"}),e[39]||(e[39]=n()),e[40]||(e[40]=z("span",null,"Outbounds",-1))]),_:1})]),default:a(()=>[e[43]||(e[43]=n()),e[44]||(e[44]=n()),typeof ea>"u"&&typeof ta>"u"&&h?.outbounds.length?(o(),y(f,{key:0},[t(A,{type:"passthrough"},{default:a(()=>[t(O,{protocol:"passthrough",traffic:V?.passthrough},{default:a(()=>[...e[41]||(e[41]=[n(`
                                Non mesh traffic
                              `,-1)])]),_:1},8,["traffic"])]),_:2},1024),e[42]||(e[42]=n()),t(T,{type:"outbounds",items:h?.outbounds},{default:a(({items:I})=>[t(A,{type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[t(m,{type:"stack",size:"small"},{default:a(()=>[(o(!0),y(f,null,v(I,g=>(o(),p(O,{key:g.kri,"data-testid":"dataplane-outbound",protocol:g.protocol,"port-name":C(ma).fromString(g.proxyResourceName).sectionName,traffic:V?.outbounds[g.proxyResourceName],"data-actionable":""},{default:a(()=>[t(D,{"data-action":"",to:{name:(x=>x.includes("bound")?x.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(C(q).name)),params:{connection:g.proxyResourceName},query:{inactive:u.params.inactive}}},{default:a(()=>[n(i(g.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(o(),p(j,{key:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e[47]||(e[47]=n()),t(Q,null,{default:a(r=>[r.route.name!==u.name?(o(),p(J,{key:0,width:r.route.name==="data-plane-subscriptions-summary-view"?"900px":"670px",onClose:function(){u.replace({name:"data-plane-detail-view",params:{mesh:u.params.mesh,proxy:u.params.proxy},query:{inactive:u.params.inactive?null:void 0}})}},{default:a(()=>[(o(),p(ya(r.Component),{data:u.params.subscription.length>0?s.data.dataplaneInsight.subscriptions:r.route.name.includes("-inbound-")?h?.inbounds:h?.outbounds,"data-plane-overview":s.data,networking:s.data.dataplane.networking,subscriptions:s.data.dataplaneInsight.subscriptions,policies:B?.policies??[],"policy-types-data":S},null,8,["data","data-plane-overview","networking","subscriptions","policies","policy-types-data"]))]),_:2},1032,["width","onClose"])):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:1})}}}),xa=fa(ba,[["__scopeId","data-v-94297fbc"]]);export{xa as default};
