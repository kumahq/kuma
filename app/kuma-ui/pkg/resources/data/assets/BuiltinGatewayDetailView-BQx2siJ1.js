import{d as T,F as L,e as k,o as t,c as a,m as b,w as d,a as m,r as q,b as e,p as u,k as s,l as p,K as H,t as l,q as P,H as o,J as y,L as E,M as N,j as V,n as A,ap as F,ao as D}from"./index-uDOFM6ir.js";import{T as X}from"./TagList-DYv0PxS4.js";import{R as G}from"./RuleMatchers-OsQ19QN9.js";function j(f,n){for(const _ of n)if(_.not&&f[_.key]===_.value||!_.not&&f[_.key]!==_.value)return!1;return!0}const z="data:image/svg+xml,%3csvg%20width='11'%20height='12'%20viewBox='0%200%2011%2012'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.66661%202.66667C5.8555%202.66667%206.01384%202.60278%206.14161%202.475C6.26939%202.34722%206.33328%202.18889%206.33328%202C6.33328%201.81111%206.26939%201.65278%206.14161%201.525C6.01384%201.39722%205.8555%201.33333%205.66661%201.33333C5.47773%201.33333%205.31939%201.39722%205.19161%201.525C5.06384%201.65278%204.99995%201.81111%204.99995%202C4.99995%202.18889%205.06384%202.34722%205.19161%202.475C5.31939%202.60278%205.47773%202.66667%205.66661%202.66667ZM7.54995%202.66667H8.71661C9.04995%202.66667%209.33884%202.77778%209.58328%203C9.82773%203.22222%209.97773%203.49444%2010.0333%203.81667L10.9833%2010.4833C11.0388%2010.8833%2010.9361%2011.2361%2010.6749%2011.5417C10.4138%2011.8472%2010.0777%2012%209.66661%2012H1.66661C1.2555%2012%200.919392%2011.8472%200.65828%2011.5417C0.397169%2011.2361%200.294391%2010.8833%200.349947%2010.4833L1.29995%203.81667C1.3555%203.49444%201.5055%203.22222%201.74995%203C1.99439%202.77778%202.28328%202.66667%202.61661%202.66667H3.78328C3.74995%202.55556%203.72217%202.44722%203.69995%202.34167C3.67772%202.23611%203.66661%202.12222%203.66661%202C3.66661%201.44444%203.86106%200.972222%204.24995%200.583333C4.63884%200.194444%205.11106%200%205.66661%200C6.22217%200%206.69439%200.194444%207.08328%200.583333C7.47217%200.972222%207.66661%201.44444%207.66661%202C7.66661%202.12222%207.6555%202.23611%207.63328%202.34167C7.61106%202.44722%207.58328%202.55556%207.54995%202.66667Z'%20fill='%236c7489'/%3e%3c/svg%3e",Z={class:"target-ref"},K={key:3,class:"weight"},O=["width"],U=T({__name:"TargetRef",props:{targetRef:{}},setup(f){const n=f,_=L(()=>{if(!n.targetRef.name)return null;switch(n.targetRef.kind){case"MeshService":case"MeshServiceSubset":return{name:"service-detail-view",params:{service:n.targetRef.name}};case"MeshGateway":return{name:"builtin-gateway-detail-view",params:{gateway:n.targetRef.name}};default:throw new Error(`Unsupported targetRef ${n.targetRef.kind}.`)}});return($,v)=>{const r=k("XBadge"),i=k("XAction");return t(),a("span",Z,[_.value!==null?(t(),b(i,{key:0,to:_.value},{default:d(()=>[m(r,null,{default:d(()=>[q($.$slots,"default",{},void 0,!0)]),_:3})]),_:3},8,["to"])):(t(),b(r,{key:1},{default:d(()=>[q($.$slots,"default",{},void 0,!0)]),_:3})),e(),n.targetRef.kind==="MeshServiceSubset"&&n.targetRef.tags?(t(),b(X,{key:2,tags:n.targetRef.tags},null,8,["tags"])):u("",!0),e(),n.targetRef.weight!==void 0&&n.targetRef.weight!==1?(t(),a("span",K,[s("img",{src:z,alt:"Weight",width:p(H)},null,8,O),e(" "+l(n.targetRef.weight),1)])):u("",!0)])}}}),B=P(U,[["__scopeId","data-v-fb5c5475"]]),J={class:"filter"},Q={key:0,class:"list"},W={class:"text-neutral"},Y={key:1,class:"list"},ee={class:"text-neutral"},te={key:3,class:"list"},se={class:"text-neutral"},ae={key:4,class:"list"},ne={class:"text-neutral"},le=T({__name:"RuleFilter",props:{filter:{}},setup(f){const n=f;return(_,$)=>{const v=k("XBadge");return t(),a("div",J,[m(v,{appearance:"neutral"},{default:d(()=>[e(l(n.filter.type),1)]),_:1}),e(),s("div",null,[n.filter.type==="RequestHeaderModifier"?(t(),a("div",Q,[(t(!0),a(o,null,y(n.filter.requestHeaderModifier,(r,i)=>(t(),a(o,{key:i},[r?(t(!0),a(o,{key:0},y(r,(g,w)=>(t(),a("span",{key:w},[s("span",W,l(i)+`:
                `,1),e(" "+l(typeof g=="string"?g:`${g.name}:${g.value}`),1)]))),128)):u("",!0)],64))),128))])):n.filter.type==="ResponseHeaderModifier"?(t(),a("div",Y,[(t(!0),a(o,null,y(n.filter.responseHeaderModifier,(r,i)=>(t(),a(o,{key:i},[r?(t(!0),a(o,{key:0},y(r,(g,w)=>(t(),a("span",{key:w},[s("span",ee,l(i)+`:
                `,1),e(" "+l(typeof g=="string"?g:`${g.name}:${g.value}`),1)]))),128)):u("",!0)],64))),128))])):n.filter.type==="RequestMirror"?(t(),a(o,{key:2},[m(B,{"target-ref":n.filter.requestMirror.backendRef},{default:d(()=>[e(l(n.filter.requestMirror.backendRef.name),1)]),_:1},8,["target-ref"]),e(),n.filter.requestMirror.percentage?(t(),a(o,{key:0},[e(`
          (`+l(n.filter.requestMirror.percentage)+`%)
        `,1)],64)):u("",!0)],64)):n.filter.type==="RequestRedirect"?(t(),a("div",te,[(t(!0),a(o,null,y(n.filter.requestRedirect,(r,i)=>(t(),a("div",{key:i},[r?(t(),a(o,{key:0},[s("span",se,l(i)+`:
              `,1),e(),typeof r=="object"?(t(),a(o,{key:0},[e(l(r.type==="ReplaceFullPath"?r.replaceFullPath:r.replacePrefixMatch),1)],64)):(t(),a(o,{key:1},[e(l(r),1)],64))],64)):u("",!0)]))),128))])):(t(),a("div",ae,[(t(!0),a(o,null,y(n.filter.urlRewrite,(r,i)=>(t(),a("div",{key:i},[r?(t(),a(o,{key:0},[s("span",ne,l(i)+`:
              `,1),e(),typeof r=="object"?(t(),a(o,{key:0},[e(l(r.type==="ReplaceFullPath"?r.replaceFullPath:r.replacePrefixMatch),1)],64)):(t(),a(o,{key:1},[e(l(r),1)],64))],64)):u("",!0)]))),128))]))])])}}}),re=P(le,[["__scopeId","data-v-9f3b1269"]]),I=f=>(E("data-v-512100d9"),f=f(),N(),f),ie={class:"stack-small"},ce={key:0,class:"match"},oe={key:1,class:"match"},de=I(()=>s("span",{class:"text-neutral"},"type:",-1)),ue={class:"match"},_e={class:"list"},he=I(()=>s("span",{class:"text-neutral"},"type:",-1)),pe={class:"list"},me=I(()=>s("span",{class:"text-neutral"},"type:",-1)),fe={key:0},ye=T({__name:"RuleMatch",props:{match:{}},setup(f){const n=f;return(_,$)=>{const v=k("XBadge");return t(),a("dl",ie,[n.match.method?(t(),a("div",ce,[s("dt",null,[m(v,{appearance:"neutral"},{default:d(()=>[e(`
            Method
          `)]),_:1})]),e(),s("dd",null,[m(v,null,{default:d(()=>[e(l(n.match.method),1)]),_:1})])])):u("",!0),e(),n.match.path?(t(),a("div",oe,[s("dt",null,[m(v,{appearance:"neutral"},{default:d(()=>[e(`
            Path
          `)]),_:1})]),e(),s("dd",null,[s("span",null,[de,e(" "+l(n.match.path.type),1)]),e(),s("code",null,l(n.match.path.value),1)])])):u("",!0),e(),n.match.queryParams&&n.match.queryParams.length>0?(t(!0),a(o,{key:2},y(n.match.queryParams,(r,i)=>(t(),a("div",{key:i},[s("div",ue,[s("dt",null,[m(v,{appearance:"neutral"},{default:d(()=>[e(`
              QueryParameter
            `)]),_:1})]),e(),s("dd",null,[s("div",_e,[s("span",null,[he,e(" "+l(r.type),1)]),e(),s("span",null,l(r.name)+":"+l(r.value),1)])])])]))),128)):u("",!0),e(),n.match.headers&&n.match.headers.length>0?(t(!0),a(o,{key:3},y(n.match.headers,(r,i)=>(t(),a("div",{key:i,class:"match"},[s("dt",null,[m(v,{appearance:"neutral"},{default:d(()=>[e(`
            Header
          `)]),_:1})]),e(),s("dd",null,[s("div",pe,[s("span",null,[me,e(" "+l(r.type??"Exact"),1)]),e(),s("span",null,[e(l(r.name),1),r.value?(t(),a("span",fe,":"+l(r.value),1)):u("",!0)])])])]))),128)):u("",!0)])}}}),ge=P(ye,[["__scopeId","data-v-512100d9"]]),ve={class:"listener-routes-card"},ke={class:"listener-routes"},we={class:"column"},be={class:"header"},$e={class:"title"},Ce={class:"count"},Re={class:"content"},xe={class:"listener-list"},Me={class:"listener-card-header"},Te={key:0,class:"definition-list definition-list--horizontal mt-2"},Se={key:0},Pe={class:"text-neutral"},Be={key:1},Ie={class:"text-neutral"},qe={class:"column"},Le={class:"header"},Xe={class:"title"},He={class:"count"},Ee={class:"content"},Ne={class:"to-rule-list"},Ve={class:"stack-with-borders"},Ae={class:"definition-list definition-list--horizontal mt-2"},Fe={class:"text-neutral visually-hidden"},De={key:0},Ge={class:"text-neutral"},je={class:"text-neutral"},ze={key:1},Ze={class:"text-neutral"},Ke={class:"list"},Oe={key:0},Ue={class:"stack-small mt-2"},Je={class:"stack-small mt-2"},Qe={key:0},We={class:"stack-small mt-2"},Ye={key:1},et={class:"stack-small mt-2"},tt={key:1},st={key:0,class:"stack-small mt-2"},at={class:"rule stack-small"},nt={class:"stack-small mt-2"},lt=T({__name:"ListenerRoutes",props:{meshGateway:{},selectedListenerIndex:{},policyTypesByName:{},inspectRules:{}},setup(f){const{t:n}=V(),_=f,$=L(()=>{const r=_.meshGateway.conf.listeners[_.selectedListenerIndex];return r?_.inspectRules.filter(i=>!!(i.ruleType==="to"&&j(r.tags??{},i.matchers)&&(i.type==="MeshHTTPRoute"&&["HTTP","HTTPS"].includes(r.protocol)||i.type==="MeshTCPRoute"&&["TCP","TLS"].includes(r.protocol)))):[]});function v(r){if(r.isTrusted){const i=r.currentTarget.querySelector("[data-action]");i instanceof HTMLElement&&typeof i.click=="function"&&i.click()}}return(r,i)=>{const g=k("XBadge"),w=k("XAction"),S=k("XEmptyState");return t(),a("div",ve,[s("div",ke,[s("div",we,[s("div",be,[s("h2",$e,l(p(n)("builtin-gateways.detail.listeners")),1),e(),s("p",Ce,l(r.meshGateway.conf.listeners.length),1)]),e(),s("div",Re,[s("div",xe,[(t(!0),a(o,null,y(r.meshGateway.conf.listeners,(c,x)=>(t(),a("div",{key:x,class:A(["card listener-card",{active:x===_.selectedListenerIndex}]),"data-testid":"listener-card",onClick:v},[s("div",Me,[m(g,{appearance:"info"},{default:d(()=>[e(l(p(n)(`http.api.value.${c.protocol}`)),1)]),_:2},1024),e(),m(w,{to:{name:"builtin-gateway-detail-view",query:{listener:x}},class:"listener-hostname","data-action":""},{default:d(()=>[e(l(c.hostname)+":"+l(c.port),1)]),_:2},1032,["to"])]),e(),c.tags||c.tls?(t(),a("dl",Te,[c.tags?(t(),a("div",Se,[s("dt",Pe,l(p(n)("builtin-gateways.detail.tags"))+`:
                    `,1),e(),s("dd",null,[m(X,{tags:c.tags},null,8,["tags"])])])):u("",!0),e(),c.tls?(t(),a("div",Be,[s("dt",Ie,l(p(n)("http.api.property.tls"))+`:
                    `,1),e(),s("dd",null,l(c.tls.mode??"TERMINATE"),1)])):u("",!0)])):u("",!0)],2))),128))])])]),e(),s("div",qe,[s("div",Le,[s("h2",Xe,l(p(n)("builtin-gateways.detail.routes")),1),e(),s("p",He,l($.value.length),1)]),e(),s("div",Ee,[s("div",Ne,[$.value.length===0?(t(),b(S,{key:0},{default:d(()=>[e(l(p(n)("builtin-gateways.detail.no_rules",{listener:_.selectedListenerIndex+1})),1)]),_:1})):(t(!0),a(o,{key:1},y($.value,(c,x)=>(t(),a("div",{key:x,class:"card route-card","data-testid":"route-card"},[s("div",Ve,[s("dl",Ae,[s("div",null,[s("dt",Fe,l(p(n)("builtin-gateways.detail.type"))+`:
                        `,1),e(),s("dd",null,[m(g,null,{default:d(()=>[e(l(c.type),1)]),_:2},1024)])]),e(),c.config.hostnames.includes("*")?u("",!0):(t(),a("div",De,[s("dt",Ge,l(p(n)("builtin-gateways.detail.hostnames"))+`:
                          `,1),e(),s("dd",null,l(c.config.hostnames.join(", ")),1)])),e(),s("div",null,[s("dt",je,l(p(n)("builtin-gateways.detail.matchers"))+`:
                        `,1),e(),s("dd",null,[c.matchers.length>0?(t(),b(G,{key:0,items:c.matchers},null,8,["items"])):(t(),a("code",ze,"*"))])]),e(),s("div",null,[s("dt",Ze,l(p(n)("builtin-gateways.detail.origins"))+`:
                        `,1),e(),s("dd",null,[s("div",Ke,[(t(!0),a(o,null,y(c.origins,(h,M)=>(t(),b(g,{key:M},{default:d(()=>[m(w,{to:{name:"policy-detail-view",params:{mesh:h.mesh,policyPath:_.policyTypesByName[h.type].path,policy:h.name}}},{default:d(()=>[e(l(h.name),1)]),_:2},1032,["to"])]),_:2},1024))),128))])])])]),e(),c.config.rules.length>0?(t(),a("div",Oe,[s("b",null,l(p(n)("builtin-gateways.detail.rules")),1),e(`:

                      `),s("div",Ue,[(t(!0),a(o,null,y(c.config.rules,(h,M)=>(t(),a("div",{key:M,class:"rule stack-small"},[s("div",null,[e(l(p(n)("builtin-gateways.detail.matches"))+`:

                            `,1),s("div",Je,[(t(!0),a(o,null,y(h.matches,(C,R)=>(t(),b(ge,{key:R,match:C},null,8,["match"]))),128))])]),e(),h.default.filters.length>0?(t(),a("div",Qe,[e(l(p(n)("builtin-gateways.detail.filters"))+`:

                            `,1),s("div",We,[(t(!0),a(o,null,y(h.default.filters,(C,R)=>(t(),b(re,{key:R,filter:C},null,8,["filter"]))),128))])])):u("",!0),e(),h.default.backendRefs.length>0?(t(),a("div",Ye,[e(l(p(n)("builtin-gateways.detail.services"))+`:

                            `,1),s("div",et,[(t(!0),a(o,null,y(h.default.backendRefs,(C,R)=>(t(),a("div",{key:R},[m(B,{"target-ref":C},{default:d(()=>[e(l(C.name),1)]),_:2},1032,["target-ref"])]))),128))])])):u("",!0)]))),128))])])):u("",!0),e(),(h=>"default"in h.config)(c)?(t(),a("div",tt,[s("b",null,l(p(n)("builtin-gateways.detail.default")),1),e(`:

                      `),c.config.default.backendRefs&&c.config.default.backendRefs.length>0?(t(),a("div",st,[s("div",at,[s("div",null,[e(l(p(n)("builtin-gateways.detail.services"))+`:

                            `,1),s("div",nt,[(t(!0),a(o,null,y(c.config.default.backendRefs,(h,M)=>(t(),a("div",{key:M},[m(B,{"target-ref":h},{default:d(()=>[e(l(h.name),1)]),_:2},1032,["target-ref"])]))),128))])])])])):u("",!0)])):u("",!0)])]))),128))])])])])])}}}),rt=P(lt,[["__scopeId","data-v-092b3fa5"]]),dt=T({__name:"BuiltinGatewayDetailView",props:{gateway:{}},setup(f){const n=f;return(_,$)=>{const v=k("DataLoader"),r=k("DataSource"),i=k("AppView"),g=k("RouteView");return t(),b(g,{name:"builtin-gateway-detail-view",params:{mesh:"",gateway:"",listener:"0"}},{default:d(({route:w,uri:S})=>[m(i,null,{default:d(()=>[m(r,{src:S(p(F),"/policy-types",{})},{default:d(({data:c,error:x})=>[m(r,{src:S(p(D),"/meshes/:mesh/mesh-gateways/:name/rules",{mesh:w.params.mesh,name:w.params.gateway})},{default:d(({data:h,error:M})=>[m(v,{data:[c,h],errors:[x,M]},{default:d(()=>[h&&c?(t(),b(rt,{key:0,"mesh-gateway":n.gateway,"selected-listener-index":Number(w.params.listener),"policy-types-by-name":c.policies.reduce((C,R)=>Object.assign(C,{[R.name]:R}),{}),"inspect-rules":h.rules},null,8,["mesh-gateway","selected-listener-index","policy-types-by-name","inspect-rules"])):u("",!0)]),_:2},1032,["data","errors"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1024)]),_:1})}}});export{dt as default};
