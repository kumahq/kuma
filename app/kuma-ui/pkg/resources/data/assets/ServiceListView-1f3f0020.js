import{d as P,u as C,r as l,v as L,b as g,w,G as T,o as h,g as V,e as z,f as B}from"./index-ff8f00ce.js";import{S as q}from"./ServiceSummary-2a9e153c.js";import{C as F}from"./ContentWrapper-8536d83e.js";import{D as G}from"./DataOverview-40f12b14.js";import{u as M}from"./index-e77322c8.js";import{Q as y}from"./QueryParameter-70743f73.js";import"./kongponents.es-f7d67eb2.js";import"./DefinitionListItem-ef94942e.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./StatusBadge-16fb9416.js";import"./TagList-fad15eb7.js";import"./store-c25c3bc2.js";import"./YamlView.vue_vue_type_script_setup_true_lang-1ada5a94.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-73bd2930.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-6ea2d4b8.js";import"./ErrorBlock-fb5de6a0.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-ccbf9197.js";import"./toYaml-4e00099e.js";import"./datadogLogEvents-302eea7b.js";const se=P({__name:"ServiceListView",props:{selectedServiceName:{type:String,required:!1,default:null},offset:{type:Number,required:!1,default:0}},setup(_){const c=_,m=M(),k=[{label:"Name",key:"entity"},{label:"Type",key:"serviceType"},{label:"Address",key:"addressPort"},{label:"Status",key:"status"},{label:"DP proxies (online / total)",key:"dpProxiesStatus"}],D={title:"No Data",message:"There are no service insights present."},p=C(),v=l(!0),d=l(null),S=l(null),b=l(c.offset),t=l(null),o=l(null),n=l({headers:k,data:[]});L(()=>p.params.mesh,function(){p.name==="service-list-view"&&f(0)}),f(c.offset);async function f(a){var i;b.value=a,y.set("offset",a>0?a:null),v.value=!0,d.value=null;const e=p.params.mesh,s=T;try{const{items:r,next:u}=await m.getAllServiceInsightsFromMesh({mesh:e},{size:s,offset:a});S.value=u,n.value.data=A(r??[]),await x({name:c.selectedServiceName??((i=n.value.data[0])==null?void 0:i.entity.name),mesh:e})}catch(r){n.value.data=[],t.value=null,o.value=null,r instanceof Error?d.value=r:console.error(r)}finally{v.value=!1}}function A(a){return a.map(e=>{const{serviceType:s="internal",addressPort:i}=e,r={name:"service-detail-view",params:{mesh:e.mesh,service:e.name}};let u="â€”";if(e.dataplanes){const{online:E=0,total:N=0}=e.dataplanes;u=`${E} / ${N}`}return{entity:e,detailViewRoute:r,serviceType:s,dpProxiesStatus:u,addressPort:i}})}async function x({name:a,mesh:e}){a!==void 0?(t.value=await m.getServiceInsight({mesh:e,name:a}),t.value.serviceType==="external"&&(o.value=await m.getExternalServiceByServiceInsightName(e,a)),y.set("service",a)):(t.value=null,o.value=null,y.set("service",null))}return(a,e)=>(h(),g(F,null,{content:w(()=>{var s;return[V(G,{"selected-entity-name":(s=t.value)==null?void 0:s.name,"page-size":z(T),error:d.value,"is-loading":v.value,"empty-state":D,"table-data":n.value,"table-data-is-empty":n.value.data.length===0,next:S.value,"page-offset":b.value,onTableAction:x,onLoadData:f},null,8,["selected-entity-name","page-size","error","is-loading","table-data","table-data-is-empty","next","page-offset"])]}),sidebar:w(()=>[t.value!==null?(h(),g(q,{key:0,service:t.value,"external-service":o.value},null,8,["service","external-service"])):B("",!0)]),_:1}))}});export{se as default};
