import{a as K,A as T}from"./AccordionList-BaN8MhRT.js";import{d as F,r as k,o as e,c as s,s as u,e as l,F as i,v as f,t as p,b as o,w as a,q as j,m as g,T as M,_ as z,p as O,a2 as D,k as Y,C as J,n as Q,a0 as U,a1 as W,K as Z}from"./index-CmjH8zP2.js";import{S as E}from"./SummaryView-DfO-4M2h.js";import{P as H}from"./PolicyTypeTag-Dy8ny9Lt.js";import{T as q}from"./TagList-VEU9r1DS.js";import{R as ee}from"./RuleMatchers--V8xz9x8.js";const te={class:"policies-list"},se={class:"mesh-gateway-policy-list"},ae={key:0},le={class:"dataplane-policy-header"},ne={key:0,class:"badge-list"},oe={class:"mt-1"},ie=F({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},types:{}},setup(V){const $=V;return(A,t)=>{const L=k("XAction"),w=k("XBadge");return e(),s("div",te,[u("div",se,[t[11]||(t[11]=u("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),t[12]||(t[12]=l()),A.gatewayDataplane.routePolicies.length>0?(e(),s("ul",ae,[(e(!0),s(i,null,f(A.gatewayDataplane.routePolicies,(m,c)=>{var r;return e(),s("li",{key:c},[u("span",null,p(m.type),1),t[0]||(t[0]=l(`:

          `)),o(L,{to:{name:"policy-detail-view",params:{mesh:m.mesh,policyPath:((r=$.types[m.type])==null?void 0:r.path)??"",policy:m.name}}},{default:a(()=>[l(p(m.name),1)]),_:2},1032,["to"])])}),128))])):j("",!0),t[13]||(t[13]=l()),t[14]||(t[14]=u("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),t[15]||(t[15]=l()),u("div",null,[(e(!0),s(i,null,f(A.gatewayDataplane.listenerEntries,(m,c)=>(e(),s("div",{key:c},[u("div",null,[u("div",null,[t[1]||(t[1]=u("b",null,"Host",-1)),l(": "+p(m.hostName)+":"+p(m.port)+" ("+p(m.protocol)+`)
            `,1)]),t[10]||(t[10]=l()),m.routeEntries.length>0?(e(),s(i,{key:0},[t[8]||(t[8]=u("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),t[9]||(t[9]=l()),o(T,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(i,null,f(m.routeEntries,(r,C)=>(e(),g(K,{key:C},M({"accordion-header":a(()=>{var n;return[u("div",le,[u("div",null,[u("div",null,[t[2]||(t[2]=u("b",null,"Route",-1)),t[3]||(t[3]=l(": ")),o(L,{to:{name:"policy-detail-view",params:{mesh:r.route.mesh,policyPath:((n=$.types[r.route.type])==null?void 0:n.path)??"",policy:r.route.name}}},{default:a(()=>[l(p(r.route.name),1)]),_:2},1032,["to"])]),t[5]||(t[5]=l()),u("div",null,[t[4]||(t[4]=u("b",null,"Service",-1)),l(": "+p(r.service),1)])]),t[6]||(t[6]=l()),r.origins.length>0?(e(),s("div",ne,[(e(!0),s(i,null,f(r.origins,(y,h)=>(e(),g(w,{key:`${c}-${h}`},{default:a(()=>[l(p(y.type),1)]),_:2},1024))),128))])):j("",!0)])]}),_:2},[r.origins.length>0?{name:"accordion-content",fn:a(()=>[u("ul",oe,[(e(!0),s(i,null,f(r.origins,(n,y)=>{var h;return e(),s("li",{key:`${c}-${y}`},[l(p(n.type)+`:

                        `,1),o(L,{to:{name:"policy-detail-view",params:{mesh:n.mesh,policyPath:((h=$.types[n.type])==null?void 0:h.path)??"",policy:n.name}}},{default:a(()=>[l(p(n.name),1)]),_:2},1032,["to"])])}),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):j("",!0)])]))),128))])])])}}}),re=z(ie,[["__scopeId","data-v-a5c76432"]]),ue={class:"policy-type-heading"},pe={class:"policy-list"},de={key:0},me=F({__name:"PolicyTypeEntryList",props:{items:{},types:{}},setup(V){const $=V;function A({headerKey:t}){return{class:`cell-${t}`}}return(t,L)=>{const w=k("XAction"),m=k("XCodeBlock"),c=k("KTable");return e(),g(T,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(i,null,f(t.items,(r,C)=>(e(),g(K,{key:C},{"accordion-header":a(()=>[u("h3",ue,[o(H,{"policy-type":r.type},{default:a(()=>[l(p(r.type)+" ("+p(r.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[u("div",pe,[o(c,{class:"policy-type-table",fetcher:()=>({data:r.connections,total:r.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":A,"disable-pagination":"","is-clickable":""},{sourceTags:a(({row:n})=>[n.sourceTags.length>0?(e(),g(q,{key:0,class:"tag-list","should-truncate":"",tags:n.sourceTags},null,8,["tags"])):(e(),s(i,{key:1},[l(`
                —
              `)],64))]),destinationTags:a(({row:n})=>[n.destinationTags.length>0?(e(),g(q,{key:0,class:"tag-list","should-truncate":"",tags:n.destinationTags},null,8,["tags"])):(e(),s(i,{key:1},[l(`
                —
              `)],64))]),name:a(({row:n})=>[n.name!==null?(e(),s(i,{key:0},[l(p(n.name),1)],64)):(e(),s(i,{key:1},[l(`
                —
              `)],64))]),origins:a(({row:n})=>[n.origins.length>0?(e(),s("ul",de,[(e(!0),s(i,null,f(n.origins,(y,h)=>{var S;return e(),s("li",{key:`${C}-${h}`},[o(w,{to:{name:"policy-detail-view",params:{mesh:y.mesh,policyPath:((S=$.types[y.type])==null?void 0:S.path)??"",policy:y.name}}},{default:a(()=>[l(p(y.name),1)]),_:2},1032,["to"])])}),128))])):(e(),s(i,{key:1},[l(`
                —
              `)],64))]),config:a(({row:n})=>[n.config?(e(),g(m,{key:0,code:O(D).stringify(n.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(i,{key:1},[l(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}}),ce=z(me,[["__scopeId","data-v-3dd03e37"]]),ye={class:"policy-type-heading"},_e={key:0,class:"matcher"},fe={key:1},ge={key:0},ke=F({__name:"RuleList",props:{rules:{},types:{}},setup(V){const{t:$}=Y(),A=V;return(t,L)=>{const w=k("XAction"),m=k("XCodeBlock");return e(),g(T,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(i,null,f([A.rules.reduce((c,r)=>(typeof c[r.type]>"u"&&(c[r.type]=[]),c[r.type].push(r),c),{})],c=>(e(),s(i,{key:c},[(e(!0),s(i,null,f(c,(r,C)=>(e(),g(K,{key:C},{"accordion-header":a(()=>[u("h3",ye,[o(H,{"policy-type":C},{default:a(()=>[l(p(C),1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[(e(!0),s(i,null,f([r.some(n=>n.matchers.length>0)],n=>(e(),s("div",{key:n,class:"policy-list"},[o(J,{class:Q(["policy-type-table",{"has-matchers":n}]),items:r,headers:[...n?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:a(({row:y})=>[y.matchers.length>0?(e(),s("span",_e,[o(ee,{items:y.matchers},null,8,["items"])])):(e(),s("i",fe,p(O($)("data-planes.routes.item.matches_everything")),1))]),origins:a(({row:y})=>[y.origins.length>0?(e(),s("ul",ge,[(e(!0),s(i,null,f(y.origins,(h,S)=>{var b;return e(),s("li",{key:`${C}-${S}`},[o(w,{to:{name:"data-plane-policy-summary-view",params:{mesh:h.mesh,policyPath:((b=A.types[h.type])==null?void 0:b.path)??"",policy:h.name}}},{default:a(()=>[l(p(h.name),1)]),_:2},1032,["to"])])}),128))])):(e(),s(i,{key:1},[l(p(O($)("common.collection.none")),1)],64))]),config:a(({row:y})=>[Object.keys(y.raw).length>0?(e(),g(m,{key:0,code:O(D).stringify(y.raw),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(i,{key:1},[l(p(O($)("common.collection.none")),1)],64))]),_:2},1032,["class","items","headers"])]))),128))]),_:2},1024))),128))],64))),128))]),_:1})}}}),G=z(ke,[["__scopeId","data-v-8b58b2bd"]]),he={class:"stack"},be={class:"mb-2"},ve={class:"mb-2"},$e={key:0},Xe=F({__name:"DataPlanePoliciesView",props:{data:{}},setup(V){const $=V;return(A,t)=>{const L=k("RouteTitle"),w=k("XCard"),m=k("DataCollection"),c=k("DataLoader"),r=k("DataSource"),C=k("RouterView"),n=k("AppView"),y=k("RouteView");return e(),g(y,{name:"data-plane-policies-view",params:{mesh:"",proxy:""}},{default:a(({uri:h,can:S,route:b,t:R})=>[o(L,{render:!1,title:R("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"]),t[11]||(t[11]=l()),o(n,null,{default:a(()=>[u("div",he,[o(r,{src:h(O(U),"/policy-types",{})},{default:a(({data:X,error:I})=>[(e(!0),s(i,null,f([((X==null?void 0:X.policyTypes)??[]).reduce((P,v)=>Object.assign(P,{[v.name]:v}),{})],P=>(e(),s(i,{key:typeof P},[o(c,{src:h(O(W),"/meshes/:mesh/rules/for/:dataplane",{mesh:b.params.mesh,dataplane:b.params.proxy}),data:[X],errors:[I]},{default:a(({data:v})=>[o(m,{items:v.rules},{default:a(()=>[(e(),s(i,null,f(["proxy","to"],_=>o(m,{key:_,items:v.rules,predicate:d=>d.ruleType===_,comparator:(d,B)=>d.type.localeCompare(B.type),empty:!1},{default:a(({items:d})=>[o(w,null,{default:a(()=>[u("h3",null,p(R(`data-planes.routes.item.rules.${_}`)),1),t[0]||(t[0]=l()),o(G,{class:"mt-2",rules:d,types:P,"data-testid":`${_}-rule-list`},null,8,["rules","types","data-testid"])]),_:2},1024)]),_:2},1032,["items","predicate","comparator"])),64)),t[5]||(t[5]=l()),o(m,{items:v.rules,predicate:_=>{var d;return _.ruleType==="from"&&!((d=P[_.type])!=null&&d.policy.isFromAsRules)},comparator:(_,d)=>_.type.localeCompare(d.type),empty:!1},{default:a(({items:_})=>[o(w,null,{default:a(()=>[u("h3",be,p(R("data-planes.routes.item.rules.from")),1),t[2]||(t[2]=l()),(e(!0),s(i,null,f([Object.groupBy(_,d=>d.inbound.port)],d=>(e(),s(i,{key:d},[(e(!0),s(i,null,f(Object.entries(d).sort(([B],[N])=>Number(N)-Number(B)),([B,N],x)=>(e(),s("div",{key:x},[u("h4",null,p(R("data-planes.routes.item.port",{port:B})),1),t[1]||(t[1]=l()),o(G,{class:"mt-2",rules:N,types:P,"data-testid":`from-rule-list-${x}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","predicate","comparator"]),t[6]||(t[6]=l()),o(m,{items:v.inboundRules,comparator:(_,d)=>_.type.localeCompare(d.type),empty:!1},{default:a(({items:_})=>[o(w,null,{default:a(()=>[u("h3",ve,p(R("data-planes.routes.item.rules.inbound")),1),t[4]||(t[4]=l()),(e(!0),s(i,null,f([Object.groupBy(_,d=>d.inbound.port)],d=>(e(),s(i,{key:d},[(e(!0),s(i,null,f(Object.entries(d).sort(([B],[N])=>Number(N)-Number(B)),([B,N],x)=>(e(),s("div",{key:x},[u("h4",null,p(R("data-planes.routes.item.port",{port:B})),1),t[3]||(t[3]=l()),o(G,{class:"mt-2",rules:N,types:P,"data-testid":`inbound-rule-list-${x}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","comparator"])]),_:2},1032,["items"])]),_:2},1032,["src","data","errors"]),t[9]||(t[9]=l()),S("use zones")?j("",!0):(e(),s("div",$e,[$.data.dataplaneType==="builtin"?(e(),g(c,{key:0,src:`/meshes/${b.params.mesh}/dataplanes/${b.params.proxy}/gateway-dataplane-policies`,data:[X],errors:[I]},{default:a(({data:v})=>[v?(e(),g(m,{key:0,items:v.routePolicies,empty:!1},{default:a(()=>[u("h3",null,p(R("data-planes.routes.item.legacy_policies")),1),t[7]||(t[7]=l()),o(w,{class:"mt-4"},{default:a(()=>[o(re,{types:P,"gateway-dataplane":v,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["types","gateway-dataplane"])]),_:2},1024)]),_:2},1032,["items"])):j("",!0)]),_:2},1032,["src","data","errors"])):(e(),g(c,{key:1,src:`/meshes/${b.params.mesh}/dataplanes/${b.params.proxy}/sidecar-dataplane-policies`,data:[X],errors:[I]},{default:a(({data:v})=>[o(m,{predicate:_=>{var d;return((d=P[_.type])==null?void 0:d.policy.isTargetRef)===!1},items:v.policyTypeEntries,empty:!1},{default:a(({items:_})=>[u("h3",null,p(R("data-planes.routes.item.legacy_policies")),1),t[8]||(t[8]=l()),o(w,{class:"mt-4"},{default:a(()=>[o(ce,{items:_,types:P,"data-testid":"sidecar-dataplane-policies"},null,8,["items","types"])]),_:2},1024)]),_:2},1032,["predicate","items"])]),_:2},1032,["src","data","errors"]))]))],64))),128))]),_:2},1032,["src"])]),t[10]||(t[10]=l()),o(C,null,{default:a(({Component:X})=>[b.child()?(e(),g(E,{key:0,onClose:I=>b.replace({name:"data-plane-policies-view",params:{mesh:b.params.mesh,proxy:b.params.proxy}})},{default:a(()=>[(e(),g(Z(X)))]),_:2},1032,["onClose"])):j("",!0)]),_:2},1024)]),_:2},1024)]),_:1})}}});export{Xe as default};
