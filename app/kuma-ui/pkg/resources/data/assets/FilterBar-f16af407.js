var ie=Object.defineProperty;var le=(a,l,t)=>l in a?ie(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;var P=(a,l,t)=>(le(a,typeof l!="symbol"?l+"":l,t),t);import{K as w}from"./index-fce48c05.js";import{d as O,l as oe,a as E,o as d,b as q,Y as re,w as v,r as Q,e as S,f as c,t as m,q as u,c as g,F as T,I as R,p as b,s as I,T as ue,_ as V,m as C,M as z,a9 as M,ar as ce,as as de,at as fe,n as j,au as pe,av as me,E as ge,aw as ve,y as he,z as ye}from"./index-19354c6c.js";import{A as be}from"./AppCollection-51b301ae.js";import{S as _e}from"./StatusBadge-be265ce4.js";import{T as ke}from"./TextWithCopyButton-1c7354cf.js";import{_ as Se}from"./WarningIcon.vue_vue_type_script_setup_true_lang-706de663.js";const xe={key:0},Ce={key:1},Te=O({__name:"DataPlaneList",props:{total:{default:0},pageNumber:{},pageSize:{},items:{},error:{},isSelectedRow:{type:[Function,null],default:null},summaryRouteName:{}},emits:["change"],setup(a,{emit:l}){const{t,formatIsoDate:x}=oe(),r=a,n=l;return(i,_)=>{const f=E("RouterLink"),h=E("KTruncate"),k=E("KTooltip");return d(),q(be,{class:"data-plane-collection","empty-state-message":u(t)("common.emptyState.message",{type:"Data Plane Proxies"}),"empty-state-cta-to":u(t)("data-planes.href.docs.data_plane_proxy"),"empty-state-cta-text":u(t)("common.documentation"),headers:[{label:"Name",key:"name"},{label:"Type",key:"type"},{label:"Services",key:"services"},{label:"Certificate Info",key:"certificate"},{label:"Status",key:"status"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Details",key:"details",hideLabel:!0}],"page-number":r.pageNumber,"page-size":r.pageSize,total:r.total,items:r.items,error:r.error,"is-selected-row":r.isSelectedRow,onChange:_[0]||(_[0]=s=>n("change",s))},re({name:v(({row:s})=>[S(f,{class:"name-link",title:s.name,to:{name:r.summaryRouteName,params:{mesh:s.mesh,dataPlane:s.name},query:{page:r.pageNumber,size:r.pageSize}}},{default:v(()=>[c(m(s.name),1)]),_:2},1032,["title","to"])]),type:v(({row:s})=>[c(m(u(t)(`data-planes.type.${s.dataplaneType}`)),1)]),services:v(({row:s})=>[s.services.length>0?(d(),q(h,{key:0,width:"auto"},{default:v(()=>[(d(!0),g(T,null,R(s.services,(y,L)=>(d(),g("div",{key:L},[S(ke,{text:y},{default:v(()=>[S(f,{to:{name:"service-detail-view",params:{service:y}}},{default:v(()=>[c(m(y),1)]),_:2},1032,["to"])]),_:2},1032,["text"])]))),128))]),_:2},1024)):(d(),g(T,{key:1},[c(m(u(t)("common.collection.none")),1)],64))]),certificate:v(({row:s})=>{var y;return[(y=s.dataplaneInsight.mTLS)!=null&&y.certificateExpirationTime?(d(),g(T,{key:0},[c(m(u(x)(s.dataplaneInsight.mTLS.certificateExpirationTime)),1)],64)):(d(),g(T,{key:1},[c(m(u(t)("data-planes.components.data-plane-list.certificate.none")),1)],64))]}),status:v(({row:s})=>[S(_e,{status:s.status},null,8,["status"])]),warnings:v(({row:s})=>[s.isCertExpired||s.warnings.length>0?(d(),q(k,{key:0},{content:v(()=>[b("ul",null,[s.warnings.length>0?(d(),g("li",xe,m(u(t)("data-planes.components.data-plane-list.version_mismatch")),1)):I("",!0),c(),s.isCertExpired?(d(),g("li",Ce,m(u(t)("data-planes.components.data-plane-list.cert_expired")),1)):I("",!0)])]),default:v(()=>[c(),S(Se,{class:"mr-1",size:u(w),"hide-title":""},null,8,["size"])]),_:2},1024)):(d(),g(T,{key:1},[c(m(u(t)("common.collection.none")),1)],64))]),details:v(({row:s})=>[S(f,{class:"details-link","data-testid":"details-link",to:{name:"data-plane-detail-view",params:{dataPlane:s.name}}},{default:v(()=>[c(m(u(t)("common.collection.details_link"))+" ",1),S(u(ue),{display:"inline-block",decorative:"",size:u(w)},null,8,["size"])]),_:2},1032,["to"])]),_:2},[i.$slots.toolbar?{name:"toolbar",fn:v(()=>[Q(i.$slots,"toolbar",{},void 0,!0)]),key:"0"}:void 0]),1032,["empty-state-message","empty-state-cta-to","empty-state-cta-text","page-number","page-size","total","items","error","is-selected-row"])}}});const Xe=V(Te,[["__scopeId","data-v-30b7e9ba"]]);function we(a,l,t){return Math.max(l,Math.min(a,t))}const Ie=["ControlLeft","ControlRight","ShiftLeft","ShiftRight","AltLeft"];class Le{constructor(l,t){P(this,"commands");P(this,"keyMap");P(this,"boundTriggerShortcuts");this.commands=t,this.keyMap=Object.fromEntries(Object.entries(l).map(([x,r])=>[x.toLowerCase(),r])),this.boundTriggerShortcuts=this.triggerShortcuts.bind(this)}registerListener(){document.addEventListener("keydown",this.boundTriggerShortcuts)}unRegisterListener(){document.removeEventListener("keydown",this.boundTriggerShortcuts)}triggerShortcuts(l){Fe(l,this.keyMap,this.commands)}}function Fe(a,l,t){const x=Ne(a.code),r=[a.ctrlKey?"ctrl":"",a.shiftKey?"shift":"",a.altKey?"alt":"",x].filter(_=>_!=="").join("+"),n=l[r];if(!n)return;const i=t[n];i.isAllowedContext&&!i.isAllowedContext(a)||(i.shouldPreventDefaultAction&&a.preventDefault(),!(i.isDisabled&&i.isDisabled())&&i.trigger(a))}function Ne(a){return Ie.includes(a)?"":a.replace(/^Key/,"").toLowerCase()}function Pe(a,l){const t=" "+a,x=t.matchAll(/ ([-\s\w]+):\s*/g),r=[];for(const n of Array.from(x)){if(n.index===void 0)continue;const i=ze(n[1]);if(l.length>0&&!l.includes(i))throw new Error(`Unknown field “${i}”. Known fields: ${l.join(", ")}`);const _=n.index+n[0].length,f=t.substring(_);let h;if(/^\s*["']/.test(f)){const s=f.match(/['"](.*?)['"]/);if(s!==null)h=s[1];else throw new Error(`Quote mismatch for field “${i}”.`)}else{const s=f.indexOf(" "),y=s===-1?f.length:s;h=f.substring(0,y)}h!==""&&r.push([i,h])}return r}function ze(a){return a.trim().replace(/\s+/g,"-").replace(/-[a-z]/g,(l,t)=>t===0?l:l.substring(1).toUpperCase())}let K=0;const Ae=(a="unique")=>(K++,`${a}-${K}`),U=a=>(he("data-v-349996e3"),a=a(),ye(),a),Ee=U(()=>b("span",{class:"visually-hidden"},"Focus filter",-1)),qe={class:"k-filter-icon"},Be=["for"],$e=["id","placeholder"],De={key:0,class:"k-suggestion-box","data-testid":"k-filter-bar-suggestion-box"},Me={class:"k-suggestion-list"},je={key:0,class:"k-filter-bar-error"},Ke={key:0},Oe=["title","data-filter-field"],Qe={class:"visually-hidden"},Re=U(()=>b("span",{class:"visually-hidden"},"Clear query",-1)),Ve=O({__name:"FilterBar",props:{id:{type:String,required:!1,default:()=>Ae("k-filter-bar")},fields:{type:Object,required:!0},placeholder:{type:String,required:!1,default:null},query:{type:String,required:!1,default:""}},emits:["fields-change"],setup(a,{emit:l}){const t=a,x=l,r=C(null),n=C(null),i=C(t.query),_=C([]),f=C(null),h=C(!1),k=C(-1),s=z(()=>Object.keys(t.fields)),y=z(()=>Object.entries(t.fields).slice(0,5).map(([e,o])=>({fieldName:e,...o}))),L=z(()=>s.value.length>0?`Filter by ${s.value.join(", ")}`:"Filter"),H=z(()=>t.placeholder??L.value);M(()=>_.value,function(e,o){ne(e,o)||(f.value=null,x("fields-change",{fields:e,query:i.value}))}),M(()=>i.value,function(){i.value===""&&(f.value=null),h.value=!0});const W={Enter:"submitQuery",Escape:"closeSuggestionBox",ArrowDown:"jumpToNextSuggestion",ArrowUp:"jumpToPreviousSuggestion"},J={submitQuery:{trigger:B,isAllowedContext(e){return n.value!==null&&e.composedPath().includes(n.value)},shouldPreventDefaultAction:!0},jumpToNextSuggestion:{trigger:G,isAllowedContext(e){return n.value!==null&&e.composedPath().includes(n.value)},shouldPreventDefaultAction:!0},jumpToPreviousSuggestion:{trigger:X,isAllowedContext(e){return n.value!==null&&e.composedPath().includes(n.value)},shouldPreventDefaultAction:!0},closeSuggestionBox:{trigger:A,isAllowedContext(e){return r.value!==null&&e.composedPath().includes(r.value)}}};function Y(){const e=new Le(W,J);ge(function(){e.registerListener()}),ve(function(){e.unRegisterListener()}),F(i.value)}Y();function Z(e){const o=e.target;F(o.value)}function B(){if(n.value instanceof HTMLInputElement)if(k.value===-1)F(n.value.value),h.value=!1;else{const e=y.value[k.value].fieldName;e&&D(n.value,e)}}function G(){$(1)}function X(){$(-1)}function $(e){k.value=we(k.value+e,-1,y.value.length-1)}function ee(){n.value instanceof HTMLInputElement&&n.value.focus()}function te(e){const p=e.currentTarget.getAttribute("data-filter-field");p&&n.value instanceof HTMLInputElement&&D(n.value,p)}function D(e,o){const p=i.value===""||i.value.endsWith(" ")?"":" ";i.value+=p+o+":",e.focus(),k.value=-1}function ae(){i.value="",n.value instanceof HTMLInputElement&&(n.value.value="",n.value.focus(),F(""))}function se(e){e.relatedTarget===null&&A(),r.value instanceof HTMLElement&&e.relatedTarget instanceof Node&&!r.value.contains(e.relatedTarget)&&A()}function A(){h.value=!1}function F(e){f.value=null;try{const o=Pe(e,s.value);o.sort((p,N)=>p[0].localeCompare(N[0])),_.value=o}catch(o){if(o instanceof Error)f.value=o,h.value=!0;else throw o}}function ne(e,o){return JSON.stringify(e)===JSON.stringify(o)}return(e,o)=>(d(),g("div",{ref_key:"filterBar",ref:r,class:"k-filter-bar","data-testid":"k-filter-bar"},[b("button",{class:"k-focus-filter-input-button",title:"Focus filter",type:"button","data-testid":"k-filter-bar-focus-filter-input-button",onClick:ee},[Ee,c(),b("span",qe,[S(u(ce),{decorative:"","data-testid":"k-filter-bar-filter-icon","hide-title":"",size:u(w)},null,8,["size"])])]),c(),b("label",{for:`${t.id}-filter-bar-input`,class:"visually-hidden"},[Q(e.$slots,"default",{},()=>[c(m(L.value),1)],!0)],8,Be),c(),de(b("input",{id:`${t.id}-filter-bar-input`,ref_key:"filterInput",ref:n,"onUpdate:modelValue":o[0]||(o[0]=p=>i.value=p),class:"k-filter-bar-input",type:"text",placeholder:H.value,"data-testid":"k-filter-bar-filter-input",onFocus:o[1]||(o[1]=p=>h.value=!0),onBlur:se,onChange:Z},null,40,$e),[[fe,i.value]]),c(),h.value?(d(),g("div",De,[b("div",Me,[f.value!==null?(d(),g("p",je,m(f.value.message),1)):(d(),g("button",{key:1,class:j(["k-submit-query-button",{"k-submit-query-button-is-selected":k.value===-1}]),title:"Submit query",type:"button","data-testid":"k-filter-bar-submit-query-button",onClick:B},`
          Submit `+m(i.value),3)),c(),(d(!0),g(T,null,R(y.value,(p,N)=>(d(),g("div",{key:`${t.id}-${N}`,class:j(["k-suggestion-list-item",{"k-suggestion-list-item-is-selected":k.value===N}])},[b("b",null,m(p.fieldName),1),p.description!==""?(d(),g("span",Ke,": "+m(p.description),1)):I("",!0),c(),b("button",{class:"k-apply-suggestion-button",title:`Add ${p.fieldName}:`,type:"button","data-filter-field":p.fieldName,"data-testid":"k-filter-bar-apply-suggestion-button",onClick:te},[b("span",Qe,"Add "+m(p.fieldName)+":",1),c(),S(u(pe),{decorative:"","hide-title":"",size:u(w)},null,8,["size"])],8,Oe)],2))),128))])])):I("",!0),c(),i.value!==""?(d(),g("button",{key:1,class:"k-clear-query-button",title:"Clear query",type:"button","data-testid":"k-filter-bar-clear-query-button",onClick:ae},[Re,c(),S(u(me),{decorative:"","hide-title":"",size:u(w)},null,8,["size"])])):I("",!0)],512))}});const et=V(Ve,[["__scopeId","data-v-349996e3"]]);export{Xe as D,et as F};
