import{d as A,u as C,i as o,k as E,K as y,cB as P,c as S,w as b,o as T,a as L,n as M}from"./index.ff83acd2.js";import{C as N}from"./ContentWrapper.e0e4aa44.js";import{D as R}from"./DataOverview.e89d4fb7.js";import{S as V}from"./ServiceDetails.4c50aabb.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.a3bd4170.js";import"./ErrorBlock.f11c1f94.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.3473bd21.js";import"./EntityTag.94d06403.js";import"./EntityURLControl.c728919a.js";import"./YamlView.c808cec1.js";import"./index.58caa11d.js";import"./CodeBlock.9a481ee8.js";import"./_commonjsHelpers.712cc82f.js";const J=A({__name:"ServiceListView",setup(K){const _=[{label:"Service",key:"name"},{label:"Mesh",key:"mesh"},{label:"Type",key:"serviceType"},{label:"Address",key:"address"},{label:"Status",key:"status"},{label:"Data planes (online / total)",key:"dataPlanesStatus"}],p=50,k={title:"No Data",message:"There are no service insights present."},v=C(),m=o(!0),n=o(null),d=o(null),l=o(null),u=o({headers:_,data:[]});E(()=>v.params.mesh,function(){c(0)}),c(0);async function c(e){m.value=!0,n.value=null;const s=v.params.mesh||null;try{const{items:a=[],next:i}=await x(s,p,e);d.value=i,a.sort((t,r)=>t.name>r.name?1:t.name<r.name?-1:t.mesh.localeCompare(r.mesh)),a.length>0?(h(a[0]),u.value.data=a.map(t=>w(t))):(l.value=null,u.value.data=[])}catch(a){l.value=null,a instanceof Error&&(n.value=a),console.error(n)}finally{m.value=!1}}async function x(e,s,a){return e==="all"||e===null?y.getAllServiceInsights({size:s,offset:a}):y.getAllServiceInsightsFromMesh({mesh:e})}function w(e){var f;const s={name:e.serviceType==="external"?"external-service-detail-view":"service-insight-detail-view",params:{mesh:e.mesh,service:e.name}},a={name:"mesh-child",params:{mesh:e.mesh}};let i="\u2014";if(e.dataplanes){const{online:D=0,total:g=0}=e.dataplanes;i=`${D} / ${g}`}let t="\u2014";e.status&&(t=P[e.status].title);const r=(f=e.serviceType)!=null?f:"internal";return{...e,serviceType:r,nameRoute:s,meshRoute:a,dataPlanesStatus:i,status:t}}function h(e){l.value=e}return(e,s)=>(T(),S(N,null,{content:b(()=>[L(R,{"page-size":p,error:n.value,"has-error":n.value!==null,"is-loading":m.value,"empty-state":k,"table-data":u.value,"table-data-is-empty":u.value.data.length===0,next:d.value,onTableAction:h,onLoadData:c},null,8,["error","has-error","is-loading","table-data","table-data-is-empty","next"])]),sidebar:b(()=>[l.value!==null?(T(),S(V,{key:0,name:l.value.name,mesh:l.value.mesh,"service-type":l.value.serviceType},null,8,["name","mesh","service-type"])):M("",!0)]),_:1}))}});export{J as default};
