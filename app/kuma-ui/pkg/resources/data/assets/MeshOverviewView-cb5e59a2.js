import{d as A,f as F,g as d,h as Y,o as l,c,a as h,u as a,b as o,k as X,cv as W,bP as C,cw as j,cm as O,c8 as R,cc as K,w as M,e as u,F as k,cd as P,bW as _,i as $,c3 as N,j as S,bX as U,bY as q}from"./index-6fa74533.js";import{C as z}from"./ContentWrapper-73b34078.js";import{_ as B,a as T,M as G}from"./MeshResources-6b263147.js";import{_ as H}from"./LabelList.vue_vue_type_style_index_0_lang-0d4f6a8d.js";import{_ as J}from"./YamlView.vue_vue_type_script_setup_true_lang-d108a9f0.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-3399abcf.js";import"./ErrorBlock-d89befd9.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-e85776a3.js";import"./index-a8834e9c.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-eb1f7563.js";import"./_commonjsHelpers-87174ba5.js";const Q={class:"chart-container mt-24"},Z=A({__name:"MeshCharts",setup(v){const t=F(),f=d(()=>t.getters.getServiceResourcesFetching),p=d(()=>t.getters.getMeshInsightsFetching),y=d(()=>t.getters.getChart("services")),g=d(()=>t.getters.getChart("dataplanes")),r=d(()=>t.getters.getChart("policies")),V=d(()=>t.getters.getChart("kumaDPVersions")),b=d(()=>t.getters.getChart("envoyVersions"));Y(()=>t.state.selectedMesh,function(){w()}),w();function w(){t.dispatch("fetchMeshInsights",t.state.selectedMesh),t.dispatch("fetchServices",t.state.selectedMesh)}return(D,E)=>(l(),c("div",Q,[h(B,{class:"chart",title:{singular:"SERVICE",plural:"SERVICES"},data:a(y).data,"is-loading":a(f),"save-chart":""},null,8,["data","is-loading"]),o(),h(B,{class:"chart",title:{singular:"DP PROXY",plural:"DP PROXIES"},data:a(g).data,url:{name:"data-plane-list-view",params:{mesh:a(t).state.selectedMesh}},"is-loading":a(p)},null,8,["data","url","is-loading"]),o(),h(B,{class:"chart",title:{singular:"POLICY",plural:"POLICIES"},data:a(r).data,url:{name:"policies",params:{mesh:a(t).state.selectedMesh}},"is-loading":a(p)},null,8,["data","url","is-loading"]),o(),h(T,{class:"chart",title:"KUMA DP",data:a(V).data,"is-loading":a(p)},null,8,["data","is-loading"]),o(),h(T,{class:"chart",title:"ENVOY",data:a(b).data,"is-loading":a(p),"display-am-charts-logo":""},null,8,["data","is-loading"])]))}});const ee=X(Z,[["__scopeId","data-v-2a02347c"]]),ae=v=>(U("data-v-fd1a3799"),v=v(),q(),v),te={key:0},se={key:1},ne={key:1},le={class:"policy-counts"},oe=ae(()=>u("h4",null,`
                  Policies
                `,-1)),re={key:0},ce={key:0,class:"mt-4"},ie=A({__name:"MeshOverviewView",setup(v){const t=W(),f=F(),p=C(!0),y=C(!1),g=C(!1),r=C(null),V=C(null),b=d(()=>r.value!==null?j(r.value):null),w=d(()=>{if(r.value===null)return null;const{name:s,type:n,creationTime:m,modificationTime:e}=r.value;return{name:s,type:n,created:O(m),modified:O(e),"Data Plane Proxies":f.state.meshInsight.dataplanes.total}}),D=d(()=>{var L;if(r.value===null)return null;const s=I(r.value,"mtls"),n=I(r.value,"logging"),m=I(r.value,"metrics"),e=I(r.value,"tracing"),i=Boolean((L=r.value.routing)==null?void 0:L.localityAwareLoadBalancing);return{mtls:s,logging:n,metrics:m,tracing:e,localityAwareLoadBalancing:i}}),E=d(()=>f.state.policyTypes.map(s=>{var n;return{...s,length:((n=f.state.meshInsight.policies[s.name])==null?void 0:n.total)??0}}));Y(()=>t.params.mesh,function(){t.name==="single-mesh-overview"&&(p.value=!0,g.value=!1,y.value=!1,x())}),x();async function x(){p.value=!0,g.value=!1;const s=t.params.mesh;try{r.value=await R.getMesh({name:s}),V.value=await R.getMeshInsights({name:s})}catch(n){y.value=!0,g.value=!0,console.error(n)}finally{p.value=!1}}function I(s,n){if(s===null||s[n]===void 0)return!1;const m=s[n].enabledBackend??s[n].defaultBackend??s[n].backends[0].name,e=s[n].backends.find(i=>i.name===m);return`${e.type} / ${e.name}`}return(s,n)=>{const m=K("router-link");return l(),c(k,null,[h(ee),o(),h(z,{class:"mt-8"},{content:M(()=>[r.value!==null?(l(),c("div",te,[h(H,{"has-error":y.value,"is-loading":p.value,"is-empty":g.value},{default:M(()=>[u("div",null,[u("ul",null,[(l(!0),c(k,null,P(a(w),(e,i)=>(l(),c("li",{key:i},[u("h4",null,_(i),1),o(),typeof e=="boolean"?(l(),$(a(N),{key:0,appearance:e?"success":"danger"},{default:M(()=>[o(_(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),c("p",se,_(e),1))]))),128))])]),o(),u("div",null,[u("ul",null,[(l(!0),c(k,null,P(a(D),(e,i)=>(l(),c("li",{key:i},[u("h4",null,_(i),1),o(),typeof e=="boolean"?(l(),$(a(N),{key:0,appearance:e?"success":"danger"},{default:M(()=>[o(_(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),c("p",ne,_(e),1))]))),128))])]),o(),u("div",null,[u("ul",le,[u("li",null,[oe,o(),u("ul",null,[(l(!0),c(k,null,P(a(E),(e,i)=>(l(),c(k,{key:i},[e.length!==0?(l(),c("li",re,[h(m,{to:{name:"policies",params:{policyType:e.path}}},{default:M(()=>[o(_(e.name)+": "+_(e.length),1)]),_:2},1032,["to"])])):S("",!0)],64))),128))])])])])]),_:1},8,["has-error","is-loading","is-empty"])])):S("",!0)]),_:1}),o(),a(b)!==null?(l(),c("div",ce,[h(J,{id:"code-block-mesh",content:a(b)},null,8,["content"])])):S("",!0),o(),h(G,{class:"mt-6"})],64)}}});const Me=X(ie,[["__scopeId","data-v-fd1a3799"]]);export{Me as default};
