import{d as T,F as q,r as $,o as t,c as a,m as w,w as d,b as p,a as S,e,p as u,k as s,l as h,K,t as l,q as L,H as c,J as f,L as N,M as V,j as E,n as F,a3 as D,aw as G,av as j}from"./index-BCWKeKPs.js";import{T as H}from"./TagList-BvzJb1AZ.js";import{R as A}from"./RuleMatchers-DjWRLJ1f.js";function z(m,n){for(const _ of n)if(_.not&&m[_.key]===_.value||!_.not&&m[_.key]!==_.value)return!1;return!0}const Z="data:image/svg+xml,%3csvg%20width='11'%20height='12'%20viewBox='0%200%2011%2012'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.66661%202.66667C5.8555%202.66667%206.01384%202.60278%206.14161%202.475C6.26939%202.34722%206.33328%202.18889%206.33328%202C6.33328%201.81111%206.26939%201.65278%206.14161%201.525C6.01384%201.39722%205.8555%201.33333%205.66661%201.33333C5.47773%201.33333%205.31939%201.39722%205.19161%201.525C5.06384%201.65278%204.99995%201.81111%204.99995%202C4.99995%202.18889%205.06384%202.34722%205.19161%202.475C5.31939%202.60278%205.47773%202.66667%205.66661%202.66667ZM7.54995%202.66667H8.71661C9.04995%202.66667%209.33884%202.77778%209.58328%203C9.82773%203.22222%209.97773%203.49444%2010.0333%203.81667L10.9833%2010.4833C11.0388%2010.8833%2010.9361%2011.2361%2010.6749%2011.5417C10.4138%2011.8472%2010.0777%2012%209.66661%2012H1.66661C1.2555%2012%200.919392%2011.8472%200.65828%2011.5417C0.397169%2011.2361%200.294391%2010.8833%200.349947%2010.4833L1.29995%203.81667C1.3555%203.49444%201.5055%203.22222%201.74995%203C1.99439%202.77778%202.28328%202.66667%202.61661%202.66667H3.78328C3.74995%202.55556%203.72217%202.44722%203.69995%202.34167C3.67772%202.23611%203.66661%202.12222%203.66661%202C3.66661%201.44444%203.86106%200.972222%204.24995%200.583333C4.63884%200.194444%205.11106%200%205.66661%200C6.22217%200%206.69439%200.194444%207.08328%200.583333C7.47217%200.972222%207.66661%201.44444%207.66661%202C7.66661%202.12222%207.6555%202.23611%207.63328%202.34167C7.61106%202.44722%207.58328%202.55556%207.54995%202.66667Z'%20fill='%236c7489'/%3e%3c/svg%3e",O={class:"target-ref"},U={key:3,class:"weight"},J=["width"],Q=T({__name:"TargetRef",props:{targetRef:{}},setup(m){const n=m,_=q(()=>{if(!n.targetRef.name)return null;switch(n.targetRef.kind){case"MeshService":case"MeshServiceSubset":return{name:"service-detail-view",params:{service:n.targetRef.name}};case"MeshGateway":return{name:"builtin-gateway-detail-view",params:{gateway:n.targetRef.name}};default:throw new Error(`Unsupported targetRef ${n.targetRef.kind}.`)}});return(b,v)=>{const r=$("KBadge"),i=$("RouterLink");return t(),a("span",O,[_.value!==null?(t(),w(i,{key:0,to:_.value},{default:d(()=>[p(r,null,{default:d(()=>[S(b.$slots,"default",{},void 0,!0)]),_:3})]),_:3},8,["to"])):(t(),w(r,{key:1},{default:d(()=>[S(b.$slots,"default",{},void 0,!0)]),_:3})),e(),n.targetRef.kind==="MeshServiceSubset"&&n.targetRef.tags?(t(),w(H,{key:2,tags:n.targetRef.tags},null,8,["tags"])):u("",!0),e(),n.targetRef.weight!==void 0&&n.targetRef.weight!==1?(t(),a("span",U,[s("img",{src:Z,alt:"Weight",width:h(K)},null,8,J),e(" "+l(n.targetRef.weight),1)])):u("",!0)])}}}),P=L(Q,[["__scopeId","data-v-d9c911dc"]]),W={class:"filter"},X={key:0,class:"list"},Y={class:"text-neutral"},ee={key:1,class:"list"},te={class:"text-neutral"},se={key:3,class:"list"},ae={class:"text-neutral"},ne={key:4,class:"list"},le={class:"text-neutral"},re=T({__name:"RuleFilter",props:{filter:{}},setup(m){const n=m;return(_,b)=>{const v=$("KBadge");return t(),a("div",W,[p(v,{appearance:"neutral"},{default:d(()=>[e(l(n.filter.type),1)]),_:1}),e(),s("div",null,[n.filter.type==="RequestHeaderModifier"?(t(),a("div",X,[(t(!0),a(c,null,f(n.filter.requestHeaderModifier,(r,i)=>(t(),a(c,{key:i},[r?(t(!0),a(c,{key:0},f(r,(y,k)=>(t(),a("span",{key:k},[s("span",Y,l(i)+`:
                `,1),e(" "+l(typeof y=="string"?y:`${y.name}:${y.value}`),1)]))),128)):u("",!0)],64))),128))])):n.filter.type==="ResponseHeaderModifier"?(t(),a("div",ee,[(t(!0),a(c,null,f(n.filter.responseHeaderModifier,(r,i)=>(t(),a(c,{key:i},[r?(t(!0),a(c,{key:0},f(r,(y,k)=>(t(),a("span",{key:k},[s("span",te,l(i)+`:
                `,1),e(" "+l(typeof y=="string"?y:`${y.name}:${y.value}`),1)]))),128)):u("",!0)],64))),128))])):n.filter.type==="RequestMirror"?(t(),a(c,{key:2},[p(P,{"target-ref":n.filter.requestMirror.backendRef},{default:d(()=>[e(l(n.filter.requestMirror.backendRef.name),1)]),_:1},8,["target-ref"]),e(),n.filter.requestMirror.percentage?(t(),a(c,{key:0},[e(`
          (`+l(n.filter.requestMirror.percentage)+`%)
        `,1)],64)):u("",!0)],64)):n.filter.type==="RequestRedirect"?(t(),a("div",se,[(t(!0),a(c,null,f(n.filter.requestRedirect,(r,i)=>(t(),a("div",{key:i},[r?(t(),a(c,{key:0},[s("span",ae,l(i)+`:
              `,1),e(),typeof r=="object"?(t(),a(c,{key:0},[e(l(r.type==="ReplaceFullPath"?r.replaceFullPath:r.replacePrefixMatch),1)],64)):(t(),a(c,{key:1},[e(l(r),1)],64))],64)):u("",!0)]))),128))])):(t(),a("div",ne,[(t(!0),a(c,null,f(n.filter.urlRewrite,(r,i)=>(t(),a("div",{key:i},[r?(t(),a(c,{key:0},[s("span",le,l(i)+`:
              `,1),e(),typeof r=="object"?(t(),a(c,{key:0},[e(l(r.type==="ReplaceFullPath"?r.replaceFullPath:r.replacePrefixMatch),1)],64)):(t(),a(c,{key:1},[e(l(r),1)],64))],64)):u("",!0)]))),128))]))])])}}}),ie=L(re,[["__scopeId","data-v-2f06ac55"]]),B=m=>(N("data-v-fee24663"),m=m(),V(),m),ce={class:"stack-small"},oe={key:0,class:"match"},de={key:1,class:"match"},ue=B(()=>s("span",{class:"text-neutral"},"type:",-1)),_e={class:"match"},he={class:"list"},pe=B(()=>s("span",{class:"text-neutral"},"type:",-1)),me={class:"list"},fe=B(()=>s("span",{class:"text-neutral"},"type:",-1)),ye={key:0},ge=T({__name:"RuleMatch",props:{match:{}},setup(m){const n=m;return(_,b)=>{const v=$("KBadge");return t(),a("dl",ce,[n.match.method?(t(),a("div",oe,[s("dt",null,[p(v,{appearance:"neutral"},{default:d(()=>[e(`
            Method
          `)]),_:1})]),e(),s("dd",null,[p(v,null,{default:d(()=>[e(l(n.match.method),1)]),_:1})])])):u("",!0),e(),n.match.path?(t(),a("div",de,[s("dt",null,[p(v,{appearance:"neutral"},{default:d(()=>[e(`
            Path
          `)]),_:1})]),e(),s("dd",null,[s("span",null,[ue,e(" "+l(n.match.path.type),1)]),e(),s("code",null,l(n.match.path.value),1)])])):u("",!0),e(),n.match.queryParams&&n.match.queryParams.length>0?(t(!0),a(c,{key:2},f(n.match.queryParams,(r,i)=>(t(),a("div",{key:i},[s("div",_e,[s("dt",null,[p(v,{appearance:"neutral"},{default:d(()=>[e(`
              QueryParameter
            `)]),_:1})]),e(),s("dd",null,[s("div",he,[s("span",null,[pe,e(" "+l(r.type),1)]),e(),s("span",null,l(r.name)+":"+l(r.value),1)])])])]))),128)):u("",!0),e(),n.match.headers&&n.match.headers.length>0?(t(!0),a(c,{key:3},f(n.match.headers,(r,i)=>(t(),a("div",{key:i,class:"match"},[s("dt",null,[p(v,{appearance:"neutral"},{default:d(()=>[e(`
            Header
          `)]),_:1})]),e(),s("dd",null,[s("div",me,[s("span",null,[fe,e(" "+l(r.type??"Exact"),1)]),e(),s("span",null,[e(l(r.name),1),r.value?(t(),a("span",ye,":"+l(r.value),1)):u("",!0)])])])]))),128)):u("",!0)])}}}),ve=L(ge,[["__scopeId","data-v-fee24663"]]),ke={class:"listener-routes-card"},we={class:"listener-routes"},$e={class:"column"},be={class:"header"},Re={class:"title"},Ce={class:"count"},xe={class:"content"},Me={class:"listener-list"},Te={class:"listener-card-header"},Le={key:0,class:"definition-list definition-list--horizontal mt-2"},Pe={key:0},Be={class:"text-neutral"},Ie={key:1},Se={class:"text-neutral"},qe={class:"column"},He={class:"header"},Ke={class:"title"},Ne={class:"count"},Ve={class:"content"},Ee={class:"to-rule-list"},Fe={class:"stack-with-borders"},De={class:"definition-list definition-list--horizontal mt-2"},Ge={class:"text-neutral visually-hidden"},je={key:0},Ae={class:"text-neutral"},ze={class:"text-neutral"},Ze={key:1},Oe={class:"text-neutral"},Ue={class:"list"},Je={key:0},Qe={class:"stack-small mt-2"},We={class:"stack-small mt-2"},Xe={key:0},Ye={class:"stack-small mt-2"},et={key:1},tt={class:"stack-small mt-2"},st={key:1},at={key:0,class:"stack-small mt-2"},nt={class:"rule stack-small"},lt={class:"stack-small mt-2"},rt=T({__name:"ListenerRoutes",props:{meshGateway:{},selectedListenerIndex:{},policyTypesByName:{},inspectRules:{}},setup(m){const{t:n}=E(),_=m,b=q(()=>{const r=_.meshGateway.conf.listeners[_.selectedListenerIndex];return r?_.inspectRules.filter(i=>!!(i.ruleType==="to"&&z(r.tags??{},i.matchers)&&(i.type==="MeshHTTPRoute"&&["HTTP","HTTPS"].includes(r.protocol)||i.type==="MeshTCPRoute"&&["TCP","TLS"].includes(r.protocol)))):[]});function v(r){if(r.isTrusted){const i=r.currentTarget.querySelector("[data-action]");i instanceof HTMLElement&&typeof i.click=="function"&&i.click()}}return(r,i)=>{const y=$("KBadge"),k=$("RouterLink");return t(),a("div",ke,[s("div",we,[s("div",$e,[s("div",be,[s("h2",Re,l(h(n)("builtin-gateways.detail.listeners")),1),e(),s("p",Ce,l(r.meshGateway.conf.listeners.length),1)]),e(),s("div",xe,[s("div",Me,[(t(!0),a(c,null,f(r.meshGateway.conf.listeners,(o,R)=>(t(),a("div",{key:R,class:F(["card listener-card",{active:R===_.selectedListenerIndex}]),"data-testid":"listener-card",onClick:v},[s("div",Te,[p(y,{appearance:"info"},{default:d(()=>[e(l(h(n)(`http.api.value.${o.protocol}`)),1)]),_:2},1024),e(),p(k,{to:{name:"builtin-gateway-detail-view",query:{listener:R}},class:"listener-hostname","data-action":""},{default:d(()=>[e(l(o.hostname)+":"+l(o.port),1)]),_:2},1032,["to"])]),e(),o.tags||o.tls?(t(),a("dl",Le,[o.tags?(t(),a("div",Pe,[s("dt",Be,l(h(n)("builtin-gateways.detail.tags"))+`:
                    `,1),e(),s("dd",null,[p(H,{tags:o.tags},null,8,["tags"])])])):u("",!0),e(),o.tls?(t(),a("div",Ie,[s("dt",Se,l(h(n)("http.api.property.tls"))+`:
                    `,1),e(),s("dd",null,l(o.tls.mode??"TERMINATE"),1)])):u("",!0)])):u("",!0)],2))),128))])])]),e(),s("div",qe,[s("div",He,[s("h2",Ke,l(h(n)("builtin-gateways.detail.routes")),1),e(),s("p",Ne,l(b.value.length),1)]),e(),s("div",Ve,[s("div",Ee,[b.value.length===0?(t(),w(D,{key:0},{title:d(()=>[e(l(h(n)("builtin-gateways.detail.no_rules",{listener:_.selectedListenerIndex+1})),1)]),_:1})):(t(!0),a(c,{key:1},f(b.value,(o,R)=>(t(),a("div",{key:R,class:"card route-card","data-testid":"route-card"},[s("div",Fe,[s("dl",De,[s("div",null,[s("dt",Ge,l(h(n)("builtin-gateways.detail.type"))+`:
                        `,1),e(),s("dd",null,[p(y,null,{default:d(()=>[e(l(o.type),1)]),_:2},1024)])]),e(),o.config.hostnames.includes("*")?u("",!0):(t(),a("div",je,[s("dt",Ae,l(h(n)("builtin-gateways.detail.hostnames"))+`:
                          `,1),e(),s("dd",null,l(o.config.hostnames.join(", ")),1)])),e(),s("div",null,[s("dt",ze,l(h(n)("builtin-gateways.detail.matchers"))+`:
                        `,1),e(),s("dd",null,[o.matchers.length>0?(t(),w(A,{key:0,items:o.matchers},null,8,["items"])):(t(),a("code",Ze,"*"))])]),e(),s("div",null,[s("dt",Oe,l(h(n)("builtin-gateways.detail.origins"))+`:
                        `,1),e(),s("dd",null,[s("div",Ue,[(t(!0),a(c,null,f(o.origins,(g,C)=>(t(),w(y,{key:C},{default:d(()=>[p(k,{to:{name:"policy-detail-view",params:{mesh:g.mesh,policyPath:_.policyTypesByName[g.type].path,policy:g.name}}},{default:d(()=>[e(l(g.name),1)]),_:2},1032,["to"])]),_:2},1024))),128))])])])]),e(),o.config.rules.length>0?(t(),a("div",Je,[s("b",null,l(h(n)("builtin-gateways.detail.rules")),1),e(`:

                      `),s("div",Qe,[(t(!0),a(c,null,f(o.config.rules,(g,C)=>(t(),a("div",{key:C,class:"rule stack-small"},[s("div",null,[e(l(h(n)("builtin-gateways.detail.matches"))+`:

                            `,1),s("div",We,[(t(!0),a(c,null,f(g.matches,(x,M)=>(t(),w(ve,{key:M,match:x},null,8,["match"]))),128))])]),e(),g.default.filters.length>0?(t(),a("div",Xe,[e(l(h(n)("builtin-gateways.detail.filters"))+`:

                            `,1),s("div",Ye,[(t(!0),a(c,null,f(g.default.filters,(x,M)=>(t(),w(ie,{key:M,filter:x},null,8,["filter"]))),128))])])):u("",!0),e(),g.default.backendRefs.length>0?(t(),a("div",et,[e(l(h(n)("builtin-gateways.detail.services"))+`:

                            `,1),s("div",tt,[(t(!0),a(c,null,f(g.default.backendRefs,(x,M)=>(t(),a("div",{key:M},[p(P,{"target-ref":x},{default:d(()=>[e(l(x.name),1)]),_:2},1032,["target-ref"])]))),128))])])):u("",!0)]))),128))])])):u("",!0),e(),o.config.default?(t(),a("div",st,[s("b",null,l(h(n)("builtin-gateways.detail.default")),1),e(`:

                      `),o.config.default.backendRefs&&o.config.default.backendRefs.length>0?(t(),a("div",at,[s("div",nt,[s("div",null,[e(l(h(n)("builtin-gateways.detail.services"))+`:

                            `,1),s("div",lt,[(t(!0),a(c,null,f(o.config.default.backendRefs,(g,C)=>(t(),a("div",{key:C},[p(P,{"target-ref":g},{default:d(()=>[e(l(g.name),1)]),_:2},1032,["target-ref"])]))),128))])])])])):u("",!0)])):u("",!0)])]))),128))])])])])])}}}),it=L(rt,[["__scopeId","data-v-bd2da63a"]]),ut=T({__name:"BuiltinGatewayDetailView",props:{gateway:{}},setup(m){const n=m;return(_,b)=>{const v=$("DataLoader"),r=$("DataSource"),i=$("AppView"),y=$("RouteView");return t(),w(y,{name:"builtin-gateway-detail-view",params:{mesh:"",gateway:"",listener:"0"}},{default:d(({route:k,uri:o})=>[p(i,null,{default:d(()=>[p(r,{src:o(h(G),"/policy-types",{})},{default:d(({data:R,error:g})=>[p(r,{src:o(h(j),"/meshes/:mesh/mesh-gateways/:name/rules",{mesh:k.params.mesh,name:k.params.gateway})},{default:d(({data:C,error:x})=>[p(v,{data:[R,C],errors:[g,x]},{default:d(()=>[C&&R?(t(),w(it,{key:0,"mesh-gateway":n.gateway,"selected-listener-index":Number(k.params.listener),"policy-types-by-name":R.policies.reduce((M,I)=>Object.assign(M,{[I.name]:I}),{}),"inspect-rules":C.rules},null,8,["mesh-gateway","selected-listener-index","policy-types-by-name","inspect-rules"])):u("",!0)]),_:2},1032,["data","errors"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1024)]),_:1})}}});export{ut as default};
