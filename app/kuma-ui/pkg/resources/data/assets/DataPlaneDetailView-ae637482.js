import{a as Y,K as L}from"./index-fce48c05.js";import{_ as B,a as y,o as l,b as f,w as e,m as s,r as I,f as t,d as O,c as i,e as r,k as X,t as o,l as a,F as u,D as k,n as J,H as Q,W as tt,X as g,Y as et,p as T,Z as at,$ as st,a0 as nt,C as ot,v as lt,x as rt}from"./index-5f4feb06.js";import{E as dt}from"./ErrorBlock-558c0398.js";import{_ as it}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-e7fd5a8b.js";import{S as ct}from"./StatusBadge-2db39c5c.js";import{S as ut}from"./SummaryView-46a73d2c.js";import{T as U}from"./TagList-679e2f0e.js";import{T as H}from"./TextWithCopyButton-1098d691.js";import{_ as _t}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-cd9cb397.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-cab7af3a.js";import"./CopyButton-2ffc661c.js";import"./AccordionList-5331d528.js";const pt={},mt={class:"card"},ft={class:"title"},vt={class:"body"};function yt(h,n){const c=y("KCard");return l(),f(c,{class:"data-card"},{default:e(()=>[s("dl",null,[s("div",mt,[s("dt",ft,[I(h.$slots,"title",{},void 0,!0)]),t(),s("dd",vt,[I(h.$slots,"default",{},void 0,!0)])])])]),_:3})}const Z=B(pt,[["render",yt],["__scopeId","data-v-6e083223"]]),ht={class:"service-traffic"},gt={class:"actions"},kt=O({__name:"DataPlaneTraffic",setup(h){return(n,c)=>(l(),i("div",ht,[s("div",gt,[I(n.$slots,"actions",{},void 0,!0)]),t(),r(Z,{class:"header"},{title:e(()=>[I(n.$slots,"title",{},void 0,!0)]),_:3}),t(),I(n.$slots,"default",{},void 0,!0)]))}});const W=B(kt,[["__scopeId","data-v-5bd1dbf9"]]),bt={class:"title"},xt=O({__name:"ServiceTrafficCard",props:{protocol:{},traffic:{}},setup(h){const{t:n}=X(),c=h,_=$=>{if(!$.isTrusted)return;const q=$.target.closest(".service-traffic-card");if(q){const K=q.querySelector("a");K!==null&&window.requestAnimationFrame(()=>{K.click()})}};return($,q)=>{const K=y("KBadge");return l(),f(Z,{class:"service-traffic-card",onClick:_},{title:e(()=>[r(K,{appearance:c.protocol==="passthrough"?"success":"info"},{default:e(()=>[t(o(a(n)(`data-planes.components.service_traffic_card.protocol.${c.protocol}`,{},{defaultMessage:a(n)(`http.api.value.${c.protocol}`)})),1)]),_:1},8,["appearance"]),t(),s("div",bt,[I($.$slots,"default",{},void 0,!0)])]),default:e(()=>{var P,C,D,M,E,z,A;return[t(),s("dl",null,[c.protocol==="passthrough"?(l(!0),i(u,{key:0},k([["http","tcp"].reduce((m,S)=>{const N="downstream";return Object.entries(c.traffic[S]||{}).reduce((V,[R,v])=>[`${N}_cx_tx_bytes_total`,`${N}_cx_rx_bytes_total`].includes(R)?{...V,[R]:v+(V[R]??0)}:V,m)},{})],(m,S)=>(l(),i(u,{key:S},[s("div",null,[s("dt",null,o(a(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,o(a(n)("common.formats.bytes",{value:m.downstream_cx_rx_bytes_total??0})),1)]),t(),s("div",null,[s("dt",null,o(a(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,o(a(n)("common.formats.bytes",{value:m.downstream_cx_tx_bytes_total??0})),1)])],64))),128)):c.protocol==="http"?(l(),i(u,{key:1},[(l(!0),i(u,null,k([((P=c.traffic.http)==null?void 0:P.downstream_rq_1xx)??0].filter(m=>m!==0),m=>(l(),i("div",{key:m},[s("dt",null,o(a(n)("data-planes.components.service_traffic_card.1xx")),1),t(),s("dd",null,o(a(n)("common.formats.integer",{value:m})),1)]))),128)),t(),s("div",null,[s("dt",null,o(a(n)("data-planes.components.service_traffic_card.2xx")),1),t(),s("dd",null,o(a(n)("common.formats.integer",{value:((C=c.traffic.http)==null?void 0:C.downstream_rq_2xx)??0})),1)]),t(),(l(!0),i(u,null,k([((D=c.traffic.http)==null?void 0:D.downstream_rq_3xx)??0].filter(m=>m!==0),m=>(l(),i("div",{key:m},[s("dt",null,o(a(n)("data-planes.components.service_traffic_card.3xx")),1),t(),s("dd",null,o(a(n)("common.formats.integer",{value:m})),1)]))),128)),t(),s("div",null,[s("dt",null,o(a(n)("data-planes.components.service_traffic_card.4xx")),1),t(),s("dd",null,o(a(n)("common.formats.integer",{value:((M=c.traffic.http)==null?void 0:M.downstream_rq_4xx)??0})),1)]),t(),s("div",null,[s("dt",null,o(a(n)("data-planes.components.service_traffic_card.5xx")),1),t(),s("dd",null,o(a(n)("common.formats.integer",{value:((E=c.traffic.http)==null?void 0:E.downstream_rq_5xx)??0})),1)])],64)):(l(),i(u,{key:2},[s("div",null,[s("dt",null,o(a(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,o(a(n)("common.formats.bytes",{value:((z=c.traffic.tcp)==null?void 0:z.downstream_cx_rx_bytes_total)??0})),1)]),t(),s("div",null,[s("dt",null,o(a(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,o(a(n)("common.formats.bytes",{value:((A=c.traffic.tcp)==null?void 0:A.downstream_cx_tx_bytes_total)??0})),1)])],64))])]}),_:3})}}});const G=B(xt,[["__scopeId","data-v-a9db5dc7"]]),wt={class:"body"},$t=O({__name:"ServiceTrafficGroup",props:{type:{}},setup(h){const n=h;return(c,_)=>{const $=y("KCard");return l(),f($,{class:J(["service-traffic-group",`type-${n.type}`])},{default:e(()=>[s("div",wt,[I(c.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}});const F=B($t,[["__scopeId","data-v-baf4abf7"]]),Ct=h=>(lt("data-v-079733d9"),h=h(),rt(),h),Tt={"data-testid":"dataplane-warnings"},It=["data-testid","innerHTML"],Kt={class:"stack","data-testid":"dataplane-details"},Dt={class:"columns"},St={class:"status-with-reason"},Vt={class:"columns"},Rt=Ct(()=>s("span",null,"Outbounds",-1)),Bt={class:"passthrough"},qt={class:"outbounds"},Pt={key:1,"data-testid":"dataplane-inbounds"},Mt={class:"inbound-list"},Et={class:"mt-4 columns"},zt={"data-testid":"dataplane-mtls"},At={class:"columns"},Nt=["innerHTML"],Lt={key:2,"data-testid":"dataplane-subscriptions"},Ht=O({__name:"DataPlaneDetailView",props:{data:{}},setup(h){const{t:n,formatIsoDate:c}=X(),_=h,$=Q(()=>_.data.warnings.concat(..._.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(q,K)=>{const P=y("KTooltip"),C=y("KCard"),D=y("RouterLink"),M=y("KInputSwitch"),E=y("KButton"),z=y("RouterView"),A=y("DataSource"),m=y("KBadge"),S=y("KAlert"),N=y("AppView"),V=y("RouteView");return l(),f(V,{params:{mesh:"",dataPlane:"",service:"",inactive:!1},name:"data-plane-detail-view"},{default:e(({can:R,route:v})=>[r(N,null,tt({default:e(()=>[t(),s("div",Kt,[r(C,null,{default:e(()=>[s("div",Dt,[r(g,null,{title:e(()=>[t(o(a(n)("http.api.property.status")),1)]),body:e(()=>[s("div",St,[r(ct,{status:_.data.status},null,8,["status"]),t(),(l(!0),i(u,null,k([_.data.dataplane.networking.inbounds.filter(d=>!d.health.ready)],d=>(l(),i(u,{key:d},[d.length>0?(l(),f(P,{key:0,class:"reason-tooltip","position-fixed":""},{content:e(()=>[s("ul",null,[(l(!0),i(u,null,k(d,b=>(l(),i("li",{key:`${b.service}:${b.port}`},o(a(n)("data-planes.routes.item.unhealthy_inbound",{service:b.service,port:b.port})),1))),128))])]),default:e(()=>[r(a(et),{color:a(Y),size:a(L),"hide-title":""},null,8,["color","size"]),t()]),_:2},1024)):T("",!0)],64))),128))])]),_:1}),t(),r(g,null,{title:e(()=>[t(o(a(n)("data-planes.routes.item.last_updated")),1)]),body:e(()=>[t(o(a(c)(_.data.modificationTime)),1)]),_:1}),t(),_.data.dataplane.networking.gateway?(l(),i(u,{key:0},[r(g,null,{title:e(()=>[t(o(a(n)("http.api.property.tags")),1)]),body:e(()=>[r(U,{tags:_.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:1}),t(),r(g,null,{title:e(()=>[t(o(a(n)("http.api.property.address")),1)]),body:e(()=>[r(H,{text:`${_.data.dataplane.networking.address}`},null,8,["text"])]),_:1})],64)):T("",!0)])]),_:1}),t(),R("read traffic")&&_.data.dataplaneType==="standard"?(l(),f(A,{key:0,src:`/meshes/${v.params.mesh}/dataplanes/${v.params.dataPlane}/traffic`},{default:e(({data:d,error:b,refresh:j})=>[b?(l(),f(dt,{key:0,error:b},null,8,["error"])):d===void 0?(l(),f(it,{key:1})):(l(),f(C,{key:2,class:"traffic"},{default:e(()=>[s("div",Vt,[r(W,null,{title:e(()=>[r(a(at),{display:"inline-block",decorative:"",size:a(L)},null,8,["size"]),t(`
                  Inbounds
                `)]),data:e(()=>[s("dl",null,[s("div",null,[s("dt",null,o(a(n)("services.components.service_traffic.inbound",{},{defaultMessage:"Requests"})),1),t(),s("dd",null,o(a(n)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),r(F,{type:"inbound"},{default:e(()=>[(l(!0),i(u,null,k(d.inbounds,p=>(l(),i(u,{key:`${p.name}`},[(l(!0),i(u,null,k([p.name.split("_").at(-1)],x=>(l(),i(u,{key:x},[(l(!0),i(u,null,k([_.data.dataplane.networking.inbounds.find(w=>`${w.port}`==`${x}`)],w=>(l(),i(u,{key:w},[w?(l(),f(G,{key:0,protocol:p.protocol,traffic:p},{default:e(()=>[r(D,{to:{name:"data-plane-inbound-summary-overview-view",params:{service:w.port},query:{inactive:v.params.inactive?null:void 0}}},{default:e(()=>[t(`
                            :`+o(w.port),1)]),_:2},1032,["to"]),t(),r(U,{tags:[{label:"kuma.io/service",value:w.tags["kuma.io/service"]}]},null,8,["tags"])]),_:2},1032,["protocol","traffic"])):T("",!0)],64))),128))],64))),128))],64))),128))]),_:2},1024)]),_:2},1024),t(),r(W,null,{actions:e(()=>[r(M,{modelValue:v.params.inactive,"onUpdate:modelValue":p=>v.params.inactive=p},{label:e(()=>[t(`
                      Show inactive
                    `)]),_:2},1032,["modelValue","onUpdate:modelValue"]),t(),r(E,{appearance:"primary",onClick:j},{default:e(()=>[r(a(st),{size:a(L)},null,8,["size"]),t(`

                    Refresh
                  `)]),_:2},1032,["onClick"])]),title:e(()=>[r(a(nt),{display:"inline-block",decorative:"",size:a(L)},null,8,["size"]),t(),Rt]),data:e(()=>[s("dl",null,[s("div",null,[s("dt",Bt,o(a(n)("services.components.service_traffic.passthrough",{},{defaultMessage:"Passthrough Requests"})),1),t(),s("dd",null,o(a(n)("common.formats.integer",{value:1e3})),1)]),t(),s("div",null,[s("dt",qt,o(a(n)("services.components.service_traffic.mesh",{},{defaultMessage:"Mesh Requests"})),1),t(),s("dd",null,o(a(n)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),t(),r(F,{type:"passthrough"},{default:e(()=>[r(G,{protocol:"passthrough",traffic:d.passthrough},{default:e(()=>[t(`
                    Non mesh traffic
                  `)]),_:2},1032,["traffic"])]),_:2},1024),t(),r(F,{type:"outbound"},{default:e(()=>[(l(!0),i(u,null,k(d.outbounds,p=>{var x,w;return l(),i(u,{key:`${p.name}`},[v.params.inactive||((p.protocol!=="http"?(x=p.tcp)==null?void 0:x.downstream_cx_rx_bytes_total:(w=p.http)==null?void 0:w.downstream_rq_total)??0>0)?(l(),f(G,{key:0,protocol:p.protocol,traffic:p},{default:e(()=>[r(D,{to:{name:"data-plane-outbound-summary-overview-view",params:{service:p.name},query:{inactive:v.params.inactive?null:void 0}}},{default:e(()=>[t(o(p.name),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic"])):T("",!0)],64)}),128))]),_:2},1024)]),_:2},1024)])]),_:2},1024)),t(),v.params.service&&[d==null?void 0:d.outbounds,_.data.dataplane.networking.inbounds].every(p=>typeof p<"u")?(l(),f(z,{key:3},{default:e(p=>[r(ut,{onClose:function(x){v.replace({name:"data-plane-detail-view",params:{mesh:v.params.mesh,dataPlane:v.params.dataPlane},query:{inactive:v.params.inactive?null:void 0}})}},{default:e(()=>[(l(),f(ot(p.Component),{data:p.route.name==="data-plane-inbound-summary-overview-view"?_.data.dataplane.networking.inbounds.find(x=>`${x.port}`===v.params.service):d.outbounds.find(x=>x.name===v.params.service)},null,8,["data"]))]),_:2},1032,["onClose"])]),_:2},1024)):T("",!0)]),_:2},1032,["src"])):T("",!0),t(),_.data.dataplane.networking.inbounds.length>0?(l(),i("div",Pt,[s("h2",null,o(a(n)("data-planes.routes.item.inbounds")),1),t(),r(C,{class:"mt-4"},{default:e(()=>[s("div",Mt,[(l(!0),i(u,null,k(_.data.dataplane.networking.inbounds,(d,b)=>(l(),i("div",{key:b,class:"inbound"},[s("h4",null,[r(H,{text:d.tags["kuma.io/service"]},{default:e(()=>[t(o(a(n)("data-planes.routes.item.inbound_name",{service:d.tags["kuma.io/service"]})),1)]),_:2},1032,["text"])]),t(),s("div",Et,[r(g,null,{title:e(()=>[t(o(a(n)("http.api.property.status")),1)]),body:e(()=>[d.health.ready?(l(),f(m,{key:0,appearance:"success"},{default:e(()=>[t(o(a(n)("data-planes.routes.item.health.ready")),1)]),_:1})):(l(),f(m,{key:1,appearance:"danger"},{default:e(()=>[t(o(a(n)("data-planes.routes.item.health.not_ready")),1)]),_:1}))]),_:2},1024),t(),r(g,null,{title:e(()=>[t(o(a(n)("http.api.property.tags")),1)]),body:e(()=>[r(U,{tags:d.tags},null,8,["tags"])]),_:2},1024),t(),r(g,null,{title:e(()=>[t(o(a(n)("http.api.property.address")),1)]),body:e(()=>[r(H,{text:d.addressPort},null,8,["text"])]),_:2},1024),t(),r(g,null,{title:e(()=>[t(o(a(n)("http.api.property.serviceAddress")),1)]),body:e(()=>[r(H,{text:d.serviceAddressPort},null,8,["text"])]),_:2},1024)])]))),128))])]),_:1})])):T("",!0),t(),s("div",zt,[s("h2",null,o(a(n)("data-planes.routes.item.mtls.title")),1),t(),_.data.dataplaneInsight.mTLS?(l(!0),i(u,{key:0},k([_.data.dataplaneInsight.mTLS],d=>(l(),f(C,{key:d,class:"mt-4"},{default:e(()=>[s("div",At,[r(g,null,{title:e(()=>[t(o(a(n)("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:e(()=>[t(o(a(c)(d.certificateExpirationTime)),1)]),_:2},1024),t(),r(g,null,{title:e(()=>[t(o(a(n)("data-planes.routes.item.mtls.generation_time.title")),1)]),body:e(()=>[t(o(a(c)(d.lastCertificateRegeneration)),1)]),_:2},1024),t(),r(g,null,{title:e(()=>[t(o(a(n)("data-planes.routes.item.mtls.regenerations.title")),1)]),body:e(()=>[t(o(a(n)("common.formats.integer",{value:d.certificateRegenerations})),1)]),_:2},1024),t(),r(g,null,{title:e(()=>[t(o(a(n)("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:e(()=>[t(o(d.issuedBackend),1)]),_:2},1024),t(),r(g,null,{title:e(()=>[t(o(a(n)("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:e(()=>[s("ul",null,[(l(!0),i(u,null,k(d.supportedBackends,b=>(l(),i("li",{key:b},o(b),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(l(),f(S,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:e(()=>[s("div",{innerHTML:a(n)("data-planes.routes.item.mtls.disabled")},null,8,Nt)]),_:1}))]),t(),_.data.dataplaneInsight.subscriptions.length>0?(l(),i("div",Lt,[s("h2",null,o(a(n)("data-planes.routes.item.subscriptions.title")),1),t(),r(C,{class:"mt-4"},{default:e(()=>[r(_t,{subscriptions:_.data.dataplaneInsight.subscriptions},null,8,["subscriptions"])]),_:1})])):T("",!0)])]),_:2},[$.value.length>0?{name:"notifications",fn:e(()=>[s("ul",Tt,[(l(!0),i(u,null,k($.value,d=>(l(),i("li",{key:d.kind,"data-testid":`warning-${d.kind}`,innerHTML:a(n)(`common.warnings.${d.kind}`,d.payload)},null,8,It))),128)),t()])]),key:"0"}:void 0]),1024)]),_:1})}}});const ee=B(Ht,[["__scopeId","data-v-079733d9"]]);export{ee as default};
