import{A as T,a as z}from"./AccordionList-DsraDpRZ.js";import{d as j,r as b,o as e,c as a,k as c,e as s,H as i,J as y,t as r,b as n,w as t,p as S,m as _,R as X,L as Y,M as Q,q as D,l as O,a6 as q,j as U,A as W,n as Z,a7 as E,E as ee}from"./index-_1cV718N.js";import{S as te}from"./SummaryView-BvDTSyzB.js";import{C as x}from"./CodeBlock-CdARjImN.js";import{P as J}from"./PolicyTypeTag-DAX5mZo5.js";import{T as H}from"./TagList-sExQAAJz.js";import{R as ae}from"./RuleMatchers-BjAc3989.js";const I=v=>(Y("data-v-184c6d72"),v=v(),Q(),v),se={class:"policies-list"},ne={class:"mesh-gateway-policy-list"},le=I(()=>c("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),oe={key:0},ie=I(()=>c("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),ce=I(()=>c("b",null,"Host",-1)),re=I(()=>c("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),de={class:"dataplane-policy-header"},ue=I(()=>c("b",null,"Route",-1)),pe=I(()=>c("b",null,"Service",-1)),me={key:0,class:"badge-list"},_e={class:"mt-1"},he=j({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},types:{}},setup(v){const $=v;return(P,B)=>{const V=b("RouterLink"),m=b("KBadge");return e(),a("div",se,[c("div",ne,[le,s(),P.gatewayDataplane.routePolicies.length>0?(e(),a("ul",oe,[(e(!0),a(i,null,y(P.gatewayDataplane.routePolicies,(l,u)=>{var d;return e(),a("li",{key:u},[c("span",null,r(l.type),1),s(`:

          `),n(V,{to:{name:"policy-detail-view",params:{mesh:l.mesh,policyPath:((d=$.types[l.type])==null?void 0:d.path)??"",policy:l.name}}},{default:t(()=>[s(r(l.name),1)]),_:2},1032,["to"])])}),128))])):S("",!0),s(),ie,s(),c("div",null,[(e(!0),a(i,null,y(P.gatewayDataplane.listenerEntries,(l,u)=>(e(),a("div",{key:u},[c("div",null,[c("div",null,[ce,s(": "+r(l.hostName)+":"+r(l.port)+" ("+r(l.protocol)+`)
            `,1)]),s(),l.routeEntries.length>0?(e(),a(i,{key:0},[re,s(),n(z,{"initially-open":[],"multiple-open":""},{default:t(()=>[(e(!0),a(i,null,y(l.routeEntries,(d,o)=>(e(),_(T,{key:o},X({"accordion-header":t(()=>{var p;return[c("div",de,[c("div",null,[c("div",null,[ue,s(": "),n(V,{to:{name:"policy-detail-view",params:{mesh:d.route.mesh,policyPath:((p=$.types[d.route.type])==null?void 0:p.path)??"",policy:d.route.name}}},{default:t(()=>[s(r(d.route.name),1)]),_:2},1032,["to"])]),s(),c("div",null,[pe,s(": "+r(d.service),1)])]),s(),d.origins.length>0?(e(),a("div",me,[(e(!0),a(i,null,y(d.origins,(C,g)=>(e(),_(m,{key:`${u}-${g}`},{default:t(()=>[s(r(C.type),1)]),_:2},1024))),128))])):S("",!0)])]}),_:2},[d.origins.length>0?{name:"accordion-content",fn:t(()=>[c("ul",_e,[(e(!0),a(i,null,y(d.origins,(p,C)=>{var g;return e(),a("li",{key:`${u}-${C}`},[s(r(p.type)+`:

                        `,1),n(V,{to:{name:"policy-detail-view",params:{mesh:p.mesh,policyPath:((g=$.types[p.type])==null?void 0:g.path)??"",policy:p.name}}},{default:t(()=>[s(r(p.name),1)]),_:2},1032,["to"])])}),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):S("",!0)])]))),128))])])])}}}),ye=D(he,[["__scopeId","data-v-184c6d72"]]),fe={class:"policy-type-heading"},ge={class:"policy-list"},ke={key:0},be=j({__name:"PolicyTypeEntryList",props:{items:{},types:{}},setup(v){const $=v;function P({headerKey:B}){return{class:`cell-${B}`}}return(B,V)=>{const m=b("RouterLink"),l=b("KTable");return e(),_(z,{"initially-open":[],"multiple-open":""},{default:t(()=>[(e(!0),a(i,null,y(B.items,(u,d)=>(e(),_(T,{key:d},{"accordion-header":t(()=>[c("h3",fe,[n(J,{"policy-type":u.type},{default:t(()=>[s(r(u.type)+" ("+r(u.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":t(()=>[c("div",ge,[n(l,{class:"policy-type-table",fetcher:()=>({data:u.connections,total:u.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":P,"disable-pagination":"","is-clickable":""},{sourceTags:t(({row:o})=>[o.sourceTags.length>0?(e(),_(H,{key:0,class:"tag-list","should-truncate":"",tags:o.sourceTags},null,8,["tags"])):(e(),a(i,{key:1},[s(`
                —
              `)],64))]),destinationTags:t(({row:o})=>[o.destinationTags.length>0?(e(),_(H,{key:0,class:"tag-list","should-truncate":"",tags:o.destinationTags},null,8,["tags"])):(e(),a(i,{key:1},[s(`
                —
              `)],64))]),name:t(({row:o})=>[o.name!==null?(e(),a(i,{key:0},[s(r(o.name),1)],64)):(e(),a(i,{key:1},[s(`
                —
              `)],64))]),origins:t(({row:o})=>[o.origins.length>0?(e(),a("ul",ke,[(e(!0),a(i,null,y(o.origins,(p,C)=>{var g;return e(),a("li",{key:`${d}-${C}`},[n(m,{to:{name:"policy-detail-view",params:{mesh:p.mesh,policyPath:((g=$.types[p.type])==null?void 0:g.path)??"",policy:p.name}}},{default:t(()=>[s(r(p.name),1)]),_:2},1032,["to"])])}),128))])):(e(),a(i,{key:1},[s(`
                —
              `)],64))]),config:t(({row:o})=>[o.config?(e(),_(x,{key:0,code:O(q).stringify(o.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),a(i,{key:1},[s(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}}),ve=D(be,[["__scopeId","data-v-81949352"]]),$e={class:"policy-type-heading"},we={key:0,class:"matcher"},Pe={key:1},Ce={key:0},Re=j({__name:"RuleList",props:{rules:{},types:{}},setup(v){const{t:$}=U(),P=v;return(B,V)=>(e(),_(z,{"initially-open":[],"multiple-open":""},{default:t(()=>[(e(!0),a(i,null,y([P.rules.reduce((m,l)=>(typeof m[l.type]>"u"&&(m[l.type]=[]),m[l.type].push(l),m),{})],m=>(e(),a(i,{key:m},[(e(!0),a(i,null,y(m,(l,u)=>(e(),_(T,{key:u},{"accordion-header":t(()=>[c("h3",$e,[n(J,{"policy-type":u},{default:t(()=>[s(r(u),1)]),_:2},1032,["policy-type"])])]),"accordion-content":t(()=>[(e(!0),a(i,null,y([l.some(d=>d.matchers.length>0)],d=>(e(),a("div",{key:d,class:"policy-list"},[n(W,{class:Z(["policy-type-table",{"has-matchers":d}]),items:l,headers:[...d?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:t(({row:o})=>[o.matchers.length>0?(e(),a("span",we,[n(ae,{items:o.matchers},null,8,["items"])])):(e(),a("i",Pe,r(O($)("data-planes.routes.item.matches_everything")),1))]),origins:t(({row:o})=>[o.origins.length>0?(e(),a("ul",Ce,[(e(!0),a(i,null,y(o.origins,(p,C)=>{var g;return e(),a("li",{key:`${u}-${C}`},[n(E,{to:{name:"data-plane-policy-summary-view",params:{mesh:p.mesh,policyPath:((g=P.types[p.type])==null?void 0:g.path)??"",policy:p.name}}},{default:t(()=>[s(r(p.name),1)]),_:2},1032,["to"])])}),128))])):(e(),a(i,{key:1},[s(r(O($)("common.collection.none")),1)],64))]),config:t(({row:o})=>[Object.keys(o.raw).length>0?(e(),_(x,{key:0,code:O(q).stringify(o.raw),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),a(i,{key:1},[s(r(O($)("common.collection.none")),1)],64))]),_:2},1032,["class","items","headers"])]))),128))]),_:2},1024))),128))],64))),128))]),_:1}))}}),M=D(Re,[["__scopeId","data-v-6f5bd94d"]]),Le={class:"stack"},Ve={class:"mb-2"},Be={key:0},Ge=j({__name:"DataPlanePoliciesView",props:{data:{}},setup(v){const $=v;return(P,B)=>{const V=b("RouteTitle"),m=b("KCard"),l=b("DataCollection"),u=b("DataLoader"),d=b("DataSource"),o=b("RouterView"),p=b("AppView"),C=b("RouteView");return e(),_(C,{name:"data-plane-policies-view",params:{mesh:"",dataPlane:""}},{default:t(({can:g,route:w,t:A})=>[n(V,{render:!1,title:A("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"]),s(),n(p,null,{default:t(()=>[c("div",Le,[n(d,{src:"/policy-types"},{default:t(({data:R,error:K})=>[(e(!0),a(i,null,y([((R==null?void 0:R.policies)??[]).reduce((L,k)=>Object.assign(L,{[k.name]:k}),{})],L=>(e(),a(i,{key:typeof L},[n(u,{src:`/meshes/${w.params.mesh}/rules/for/${w.params.dataPlane}`,data:[R],errors:[K]},{default:t(({data:k})=>[n(l,{items:k.rules},{default:t(()=>[(e(),a(i,null,y(["proxy","to"],f=>n(l,{key:f,items:k.rules,predicate:h=>h.ruleType===f,comparator:(h,N)=>h.type.localeCompare(N.type),empty:!1},{default:t(({items:h})=>[n(m,null,{default:t(()=>[c("h3",null,r(A(`data-planes.routes.item.rules.${f}`)),1),s(),n(M,{class:"mt-2",rules:h,types:L,"data-testid":`${f}-rule-list`},null,8,["rules","types","data-testid"])]),_:2},1024)]),_:2},1032,["items","predicate","comparator"])),64)),s(),n(l,{items:k.rules,predicate:f=>f.ruleType==="from",comparator:(f,h)=>f.type.localeCompare(h.type),empty:!1},{default:t(({items:f})=>[n(m,null,{default:t(()=>[c("h3",Ve,r(A("data-planes.routes.item.rules.from")),1),s(),(e(!0),a(i,null,y([Object.groupBy(f,h=>h.inbound.port)],h=>(e(),a(i,{key:h},[(e(!0),a(i,null,y(Object.entries(h).sort(([N],[G])=>Number(G)-Number(N)),([N,G],F)=>(e(),a("div",{key:F},[c("h4",null,r(A("data-planes.routes.item.port",{port:N})),1),s(),n(M,{class:"mt-2",rules:G,types:L,"data-testid":`from-rule-list-${F}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","predicate","comparator"])]),_:2},1032,["items"])]),_:2},1032,["src","data","errors"]),s(),g("use zones")?S("",!0):(e(),a("div",Be,[$.data.dataplaneType==="builtin"?(e(),_(u,{key:0,src:`/meshes/${w.params.mesh}/dataplanes/${w.params.dataPlane}/gateway-dataplane-policies`,data:[R],errors:[K]},{default:t(({data:k})=>[k?(e(),_(l,{key:0,items:k.routePolicies,empty:!1},{default:t(()=>[c("h3",null,r(A("data-planes.routes.item.legacy_policies")),1),s(),n(m,{class:"mt-4"},{default:t(()=>[n(ye,{types:L,"gateway-dataplane":k,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["types","gateway-dataplane"])]),_:2},1024)]),_:2},1032,["items"])):S("",!0)]),_:2},1032,["src","data","errors"])):(e(),_(u,{key:1,src:`/meshes/${w.params.mesh}/dataplanes/${w.params.dataPlane}/sidecar-dataplane-policies`,data:[R],errors:[K]},{default:t(({data:k})=>[n(l,{predicate:f=>{var h;return((h=L[f.type])==null?void 0:h.isTargetRefBased)===!1},items:k.policyTypeEntries,empty:!1},{default:t(({items:f})=>[c("h3",null,r(A("data-planes.routes.item.legacy_policies")),1),s(),n(m,{class:"mt-4"},{default:t(()=>[n(ve,{items:f,types:L,"data-testid":"sidecar-dataplane-policies"},null,8,["items","types"])]),_:2},1024)]),_:2},1032,["predicate","items"])]),_:2},1032,["src","data","errors"]))]))],64))),128))]),_:2},1024)]),s(),n(o,null,{default:t(({Component:R})=>[w.child()?(e(),_(te,{key:0,onClose:K=>w.replace({name:"data-plane-policies-view",params:{mesh:w.params.mesh,dataPlane:w.params.dataPlane}})},{default:t(()=>[(e(),_(ee(R)))]),_:2},1032,["onClose"])):S("",!0)]),_:2},1024)]),_:2},1024)]),_:1})}}});export{Ge as default};
