import{_ as R,a as x,o,b as v,w as a,m as s,r as E,f as t,d as z,l as et,q as D,e as d,t as i,p as r,c as u,F as f,G as B,n as at,B as nt,M as st,X as Y,Z as I,$ as ot,a0 as it,K as Z,W as dt,a1 as lt,a2 as W,a3 as rt,A as ct,a4 as ut,D as pt,x as _t,y as ft}from"./index-Bezvh5_m.js";import{S as mt}from"./StatusBadge-xLs33dZM.js";import{S as yt}from"./SummaryView-N5yZTGe3.js";import{T as Q}from"./TagList-vf_Uko3N.js";import{_ as vt}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-p7b3a48m.js";import"./AccordionList-BznvfcWz.js";const gt=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],ht=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],bt=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],kt=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],X=(c,n,e)=>{let $=c;return typeof n=="string"||Array.isArray(n)?$=c.toLocaleString(n,e):(n===!0||e!==void 0)&&($=c.toLocaleString(void 0,e)),$};function O(c,n){if(!Number.isFinite(c))throw new TypeError(`Expected a finite number, got ${typeof c}: ${c}`);n={bits:!1,binary:!1,space:!0,...n};const e=n.bits?n.binary?kt:bt:n.binary?ht:gt,$=n.space?" ":"";if(n.signed&&c===0)return` 0${$}${e[0]}`;const C=c<0,K=C?"-":n.signed?"+":"";C&&(c=-c);let h;if(n.minimumFractionDigits!==void 0&&(h={minimumFractionDigits:n.minimumFractionDigits}),n.maximumFractionDigits!==void 0&&(h={maximumFractionDigits:n.maximumFractionDigits,...h}),c<1){const V=X(c,n.locale,h);return K+V+$+e[0]}const w=Math.min(Math.floor(n.binary?Math.log(c)/Math.log(1024):Math.log10(c)/3),e.length-1);c/=(n.binary?1024:1e3)**w,h||(c=c.toPrecision(3));const S=X(Number(c),n.locale,h),N=e[w];return K+S+$+N}const xt={},$t={class:"card"},wt={class:"title"},Bt={class:"body"};function Ct(c,n){const e=x("KCard");return o(),v(e,{class:"data-card"},{default:a(()=>[s("dl",null,[s("div",$t,[s("dt",wt,[E(c.$slots,"title",{},void 0,!0)]),t(),s("dd",Bt,[E(c.$slots,"default",{},void 0,!0)])])])]),_:3})}const tt=R(xt,[["render",Ct],["__scopeId","data-v-3f9a3cf3"]]),Tt={class:"title"},It={key:0},St={"data-testid":"grpc-success"},Dt={"data-testid":"grpc-failure"},Kt={"data-testid":"rq-2xx"},Nt={"data-testid":"rq-4xx"},Et={"data-testid":"rq-5xx"},Vt={"data-testid":"connections-total"},qt={key:0,"data-testid":"bytes-received"},Mt={key:1,"data-testid":"bytes-sent"},Rt=z({__name:"ConnectionCard",props:{protocol:{},service:{default:""},traffic:{default:void 0},direction:{default:"downstream"}},setup(c){const{t:n}=et(),e=c,$=C=>{const K=C.target;if(C.isTrusted&&K.nodeName.toLowerCase()!=="a"){const h=K.closest(".service-traffic-card, a");if(h){const w=h.nodeName.toLowerCase()==="a"?h:h.querySelector("[data-action]");w!==null&&"click"in w&&typeof w.click=="function"&&w.click()}}};return(C,K)=>{const h=x("KBadge"),w=x("KSkeletonBox");return o(),v(tt,{class:"service-traffic-card",onClick:$},{title:a(()=>[e.service.length>0?(o(),v(Q,{key:0,tags:[{label:"kuma.io/service",value:e.service}]},null,8,["tags"])):D("",!0),t(),s("div",Tt,[d(h,{class:"protocol",appearance:e.protocol==="passthrough"?"success":"info"},{default:a(()=>[t(i(r(n)(`data-planes.components.service_traffic_card.protocol.${e.protocol}`,{},{defaultMessage:r(n)(`http.api.value.${e.protocol}`)})),1)]),_:1},8,["appearance"]),t(),E(C.$slots,"default",{},void 0,!0)])]),default:a(()=>{var S,N,V,P,L,U,A,F,G,b,_,g;return[t(),e.traffic?(o(),u("dl",It,[e.protocol==="passthrough"?(o(!0),u(f,{key:0},B([["http","tcp"].reduce((m,M)=>{var p;const l=e.direction;return Object.entries(((p=e.traffic)==null?void 0:p[M])||{}).reduce((k,[y,T])=>[`${l}_cx_tx_bytes_total`,`${l}_cx_rx_bytes_total`].includes(y)?{...k,[y]:T+(k[y]??0)}:k,m)},{})],(m,M)=>(o(),u(f,{key:M},[s("div",null,[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,i(r(O)(m.downstream_cx_rx_bytes_total??0)),1)]),t(),s("div",null,[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,i(r(O)(m.downstream_cx_tx_bytes_total??0)),1)])],64))),128)):e.protocol==="grpc"?(o(),u(f,{key:1},[s("div",St,[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.grpc_success")),1),t(),s("dd",null,i(r(n)("common.formats.integer",{value:(S=e.traffic.grpc)==null?void 0:S.success})),1)]),t(),s("div",Dt,[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.grpc_failure")),1),t(),s("dd",null,i(r(n)("common.formats.integer",{value:(N=e.traffic.grpc)==null?void 0:N.failure})),1)])],64)):e.protocol.startsWith("http")?(o(),u(f,{key:2},[(o(!0),u(f,null,B([((V=e.traffic.http)==null?void 0:V[`${e.direction}_rq_1xx`])??0].filter(m=>m!==0),m=>(o(),u("div",{key:m,"data-testid":"rq-1xx"},[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.1xx")),1),t(),s("dd",null,i(r(n)("common.formats.integer",{value:m})),1)]))),128)),t(),s("div",Kt,[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.2xx")),1),t(),s("dd",null,i(r(n)("common.formats.integer",{value:(P=e.traffic.http)==null?void 0:P[`${e.direction}_rq_2xx`]})),1)]),t(),(o(!0),u(f,null,B([((L=e.traffic.http)==null?void 0:L[`${e.direction}_rq_3xx`])??0].filter(m=>m!==0),m=>(o(),u("div",{key:m,"data-testid":"rq-3xx"},[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.3xx")),1),t(),s("dd",null,i(r(n)("common.formats.integer",{value:m})),1)]))),128)),t(),s("div",Nt,[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.4xx")),1),t(),s("dd",null,i(r(n)("common.formats.integer",{value:(U=e.traffic.http)==null?void 0:U[`${e.direction}_rq_4xx`]})),1)]),t(),s("div",Et,[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.5xx")),1),t(),s("dd",null,i(r(n)("common.formats.integer",{value:(A=e.traffic.http)==null?void 0:A[`${e.direction}_rq_5xx`]})),1)])],64)):(o(),u(f,{key:3},[s("div",Vt,[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.cx")),1),t(),s("dd",null,i(r(n)("common.formats.integer",{value:(F=e.traffic.tcp)==null?void 0:F[`${e.direction}_cx_total`]})),1)]),t(),typeof((G=e.traffic.tcp)==null?void 0:G[`${e.direction}_cx_tx_bytes_total`])<"u"?(o(),u("div",qt,[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.rx")),1),t(),s("dd",null,i(r(O)((b=e.traffic.tcp)==null?void 0:b[`${e.direction}_cx_tx_bytes_total`])),1)])):D("",!0),t(),typeof((_=e.traffic.tcp)==null?void 0:_[`${e.direction}_cx_rx_bytes_total`])<"u"?(o(),u("div",Mt,[s("dt",null,i(r(n)("data-planes.components.service_traffic_card.tx")),1),t(),s("dd",null,i(r(O)((g=e.traffic.tcp)==null?void 0:g[`${e.direction}_cx_rx_bytes_total`])),1)])):D("",!0)],64))])):(o(),v(w,{key:1,width:"10"}))]}),_:3})}}}),H=R(Rt,[["__scopeId","data-v-f7ef7711"]]),Pt={class:"body"},Lt=z({__name:"ConnectionGroup",props:{type:{}},setup(c){const n=c;return(e,$)=>{const C=x("KCard");return o(),v(C,{class:at(["service-traffic-group",`type-${n.type}`])},{default:a(()=>[s("div",Pt,[E(e.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}}),j=R(Lt,[["__scopeId","data-v-9402d5d1"]]),Ut={class:"service-traffic"},At={class:"actions"},Ft=z({__name:"ConnectionTraffic",setup(c){return(n,e)=>(o(),u("div",Ut,[s("div",At,[E(n.$slots,"actions",{},void 0,!0)]),t(),d(tt,{class:"header"},{title:a(()=>[E(n.$slots,"title",{},void 0,!0)]),_:3}),t(),E(n.$slots,"default",{},void 0,!0)]))}}),J=R(Ft,[["__scopeId","data-v-e6bd176c"]]),Gt=c=>(_t("data-v-68f3348d"),c=c(),ft(),c),Ot={"data-testid":"dataplane-warnings"},zt=["data-testid","innerHTML"],Yt={key:0,"data-testid":"warning-stats-loading"},Zt={class:"stack","data-testid":"dataplane-details"},Ht={class:"columns"},jt={class:"status-with-reason"},Wt={class:"columns"},Xt=Gt(()=>s("span",null,"Outbounds",-1)),Jt={"data-testid":"dataplane-mtls"},Qt={class:"columns"},te=["innerHTML"],ee={key:0,"data-testid":"dataplane-subscriptions"},ae=z({__name:"DataPlaneDetailView",props:{data:{}},setup(c){const n=nt(),e=c,$=st(()=>e.data.warnings.concat(...e.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(C,K)=>{const h=x("KTooltip"),w=x("DataCollection"),S=x("KCard"),N=x("RouterLink"),V=x("KInputSwitch"),P=x("KButton"),L=x("RouterView"),U=x("KAlert"),A=x("AppView"),F=x("DataSource"),G=x("RouteView");return o(),v(G,{params:{mesh:"",dataPlane:"",inactive:!1},name:"data-plane-detail-view"},{default:a(({route:b,t:_})=>[d(F,{src:`/meshes/${b.params.mesh}/dataplanes/${b.params.dataPlane}/stats/${e.data.dataplane.networking.inboundAddress}`},{default:a(({data:g,error:m,refresh:M})=>[d(A,null,Y({default:a(()=>[t(),s("div",Zt,[d(S,null,{default:a(()=>[s("div",Ht,[d(I,null,{title:a(()=>[t(i(_("http.api.property.status")),1)]),body:a(()=>[s("div",jt,[d(mt,{status:e.data.status},null,8,["status"]),t(),e.data.dataplaneType==="standard"?(o(),v(w,{key:0,items:e.data.dataplane.networking.inbounds,predicate:l=>!l.health.ready,empty:!1},{default:a(({items:l})=>[d(h,{class:"reason-tooltip"},{content:a(()=>[s("ul",null,[(o(!0),u(f,null,B(l,p=>(o(),u("li",{key:`${p.service}:${p.port}`},i(_("data-planes.routes.item.unhealthy_inbound",{service:p.service,port:p.port})),1))),128))])]),default:a(()=>[d(r(ot),{color:r(it),size:r(Z)},null,8,["color","size"]),t()]),_:2},1024)]),_:2},1032,["items","predicate"])):D("",!0)])]),_:2},1024),t(),d(I,null,{title:a(()=>[t(`
                  Type
                `)]),body:a(()=>[t(i(_(`data-planes.type.${e.data.dataplaneType}`)),1)]),_:2},1024),t(),d(I,null,{title:a(()=>[t(i(_("data-planes.routes.item.last_updated")),1)]),body:a(()=>[t(i(_("common.formats.datetime",{value:Date.parse(e.data.modificationTime)})),1)]),_:2},1024),t(),e.data.dataplane.networking.gateway?(o(),u(f,{key:0},[d(I,null,{title:a(()=>[t(i(_("http.api.property.tags")),1)]),body:a(()=>[d(Q,{tags:e.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024),t(),d(I,null,{title:a(()=>[t(i(_("http.api.property.address")),1)]),body:a(()=>[d(dt,{text:`${e.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024)],64)):D("",!0)])]),_:2},1024),t(),d(S,{class:"traffic","data-testid":"dataplane-traffic"},{default:a(()=>[s("div",Wt,[d(J,null,{title:a(()=>[d(r(lt),{display:"inline-block",decorative:"",size:r(Z)},null,8,["size"]),t(`
                  Inbounds
                `)]),default:a(()=>[t(),d(j,{type:"inbound","data-testid":"dataplane-inbounds"},{default:a(()=>[(o(!0),u(f,null,B([e.data.dataplane.networking.type==="gateway"?Object.entries((g==null?void 0:g.inbounds)??{}).reduce((l,[p,k])=>{var T;const y=p.split("_").at(-1);return y===(((T=e.data.dataplane.networking.admin)==null?void 0:T.port)??"9901")?l:l.concat([{...e.data.dataplane.networking.inbounds[0],name:p,port:Number(y),protocol:["http","tcp"].find(q=>typeof k[q]<"u")??"tcp",addressPort:`${e.data.dataplane.networking.inbounds[0].address}:${y}`}])},[]):e.data.dataplane.networking.inbounds],l=>(o(),v(w,{key:l,items:l},Y({default:a(()=>[(o(!0),u(f,null,B(l,p=>(o(),u(f,{key:`${p.name}`},[(o(!0),u(f,null,B([g==null?void 0:g.inbounds[p.name]],k=>(o(),v(H,{key:k,"data-testid":"dataplane-inbound",protocol:p.protocol,service:p.tags["kuma.io/service"],traffic:typeof m>"u"?k:{name:"",protocol:p.protocol,port:`${p.port}`}},{default:a(()=>[d(N,{"data-action":"",to:{name:(y=>y.includes("bound")?y.replace("-outbound-","-inbound-"):"connection-inbound-summary-overview-view")(String(r(n).name)),params:{connection:p.name},query:{inactive:b.params.inactive?null:void 0}}},{default:a(()=>[t(i(p.name.replace("localhost","").replace("_",":")),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","service","traffic"]))),128))],64))),128))]),_:2},[e.data.dataplaneType==="delegated"?{name:"empty",fn:a(()=>[d(W,null,{default:a(()=>[t(`
                          This proxy is a delegated gateway therefore `+i(_("common.product.name"))+` does not have any visibility into inbounds for this gateway
                        `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items"]))),128))]),_:2},1024)]),_:2},1024),t(),d(J,null,Y({title:a(()=>[d(r(rt),{display:"inline-block",decorative:"",size:r(Z)},null,8,["size"]),t(),Xt]),default:a(()=>[t(),t(),typeof m>"u"?(o(),u(f,{key:0},[typeof g>"u"?(o(),v(ct,{key:0})):(o(),u(f,{key:1},B(["upstream"],l=>(o(),u(f,{key:l},[d(j,{type:"passthrough"},{default:a(()=>[d(H,{protocol:"passthrough",traffic:g.passthrough},{default:a(()=>[t(`
                          Non mesh traffic
                        `)]),_:2},1032,["traffic"])]),_:2},1024),t(),d(w,{predicate:b.params.inactive?void 0:([p,k])=>{var y,T;return((typeof k.tcp<"u"?(y=k.tcp)==null?void 0:y[`${l}_cx_rx_bytes_total`]:(T=k.http)==null?void 0:T[`${l}_rq_total`])??0)>0},items:Object.entries(g.outbounds)},{default:a(({items:p})=>[p.length>0?(o(),v(j,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:a(()=>[(o(),u(f,null,B([/-([a-f0-9]){16}$/],k=>(o(),u(f,{key:k},[(o(!0),u(f,null,B(p,([y,T])=>(o(),v(H,{key:`${y}`,"data-testid":"dataplane-outbound",protocol:["grpc","http","tcp"].find(q=>typeof T[q]<"u")??"tcp",traffic:T,service:y.replace(k,""),direction:l},{default:a(()=>[d(N,{"data-action":"",to:{name:(q=>q.includes("bound")?q.replace("-inbound-","-outbound-"):"connection-outbound-summary-overview-view")(String(r(n).name)),params:{connection:y},query:{inactive:b.params.inactive?null:void 0}}},{default:a(()=>[t(i(y),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","service","direction"]))),128))],64))),64))]),_:2},1024)):D("",!0)]),_:2},1032,["predicate","items"])],64))),64))],64)):(o(),v(W,{key:1}))]),_:2},[g?{name:"actions",fn:a(()=>[d(V,{modelValue:b.params.inactive,"onUpdate:modelValue":l=>b.params.inactive=l,"data-testid":"dataplane-outbounds-inactive-toggle"},{label:a(()=>[t(`
                      Show inactive
                    `)]),_:2},1032,["modelValue","onUpdate:modelValue"]),t(),d(P,{appearance:"primary",onClick:M},{default:a(()=>[d(r(ut)),t(`

                    Refresh
                  `)]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)])]),_:2},1024),t(),d(L,null,{default:a(l=>[l.route.name!==b.name?(o(),v(yt,{key:0,width:"670px",onClose:function(p){b.replace({name:"data-plane-detail-view",params:{mesh:b.params.mesh,dataPlane:b.params.dataPlane},query:{inactive:b.params.inactive?null:void 0}})}},{default:a(()=>[(o(),v(pt(l.Component),{data:l.route.name.includes("-inbound-")?e.data.dataplane.networking.inbounds:(g==null?void 0:g.outbounds)||{},"dataplane-overview":e.data},null,8,["data","dataplane-overview"]))]),_:2},1032,["onClose"])):D("",!0)]),_:2},1024),t(),s("div",Jt,[s("h2",null,i(_("data-planes.routes.item.mtls.title")),1),t(),e.data.dataplaneInsight.mTLS?(o(!0),u(f,{key:0},B([e.data.dataplaneInsight.mTLS],l=>(o(),v(S,{key:l,class:"mt-4"},{default:a(()=>[s("div",Qt,[d(I,null,{title:a(()=>[t(i(_("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:a(()=>[t(i(_("common.formats.datetime",{value:Date.parse(l.certificateExpirationTime)})),1)]),_:2},1024),t(),d(I,null,{title:a(()=>[t(i(_("data-planes.routes.item.mtls.generation_time.title")),1)]),body:a(()=>[t(i(_("common.formats.datetime",{value:Date.parse(l.lastCertificateRegeneration)})),1)]),_:2},1024),t(),d(I,null,{title:a(()=>[t(i(_("data-planes.routes.item.mtls.regenerations.title")),1)]),body:a(()=>[t(i(_("common.formats.integer",{value:l.certificateRegenerations})),1)]),_:2},1024),t(),d(I,null,{title:a(()=>[t(i(_("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:a(()=>[t(i(l.issuedBackend),1)]),_:2},1024),t(),d(I,null,{title:a(()=>[t(i(_("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:a(()=>[s("ul",null,[(o(!0),u(f,null,B(l.supportedBackends,p=>(o(),u("li",{key:p},i(p),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(o(),v(U,{key:1,class:"mt-4",appearance:"warning"},{default:a(()=>[s("div",{innerHTML:_("data-planes.routes.item.mtls.disabled")},null,8,te)]),_:2},1024))]),t(),e.data.dataplaneInsight.subscriptions.length>0?(o(),u("div",ee,[s("h2",null,i(_("data-planes.routes.item.subscriptions.title")),1),t(),d(S,{class:"mt-4"},{default:a(()=>[d(vt,{subscriptions:e.data.dataplaneInsight.subscriptions},null,8,["subscriptions"])]),_:1})])):D("",!0)])]),_:2},[$.value.length>0||m?{name:"notifications",fn:a(()=>[s("ul",Ot,[(o(!0),u(f,null,B($.value,l=>(o(),u("li",{key:l.kind,"data-testid":`warning-${l.kind}`,innerHTML:_(`common.warnings.${l.kind}`,l.payload)},null,8,zt))),128)),t(),m?(o(),u("li",Yt,[t(`
              The below view is not enhanced with runtime stats (Error loading stats: `),s("strong",null,i(m.toString()),1),t(`)
            `)])):D("",!0)])]),key:"0"}:void 0]),1024)]),_:2},1032,["src"])]),_:1})}}}),re=R(ae,[["__scopeId","data-v-68f3348d"]]);export{re as default};
