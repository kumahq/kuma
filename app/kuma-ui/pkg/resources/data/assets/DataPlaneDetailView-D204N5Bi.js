import{d as et,a2 as at,r as m,p as d,o as i,w as t,b as a,c as y,e as n,N as f,L as k,q as w,O as c,S as nt,l as D,t as r,m as ot,ap as st,M as it,y as rt,K as lt,_ as pt}from"./index-e-rHSYgt.js";import{S as dt}from"./SummaryView--7RbdteC.js";import{T as ut}from"./TagList-BfaDFjRd.js";import{C as F,a as G,b as K}from"./ConnectionTraffic-BF1MgtzS.js";const mt={key:0,"data-testid":"dataplane-subscriptions"},yt=et({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(M){at();const s=M;return(_t,e)=>{const I=m("XI18n"),H=m("XNotification"),x=m("XIcon"),X=m("DataCollection"),u=m("XLayout"),T=m("XAction"),g=m("XBadge"),J=m("XCopyButton"),Q=m("XAboutCard"),R=m("XEmptyState"),U=m("DataLoader"),V=m("XCard"),W=m("RouterView"),Y=m("AppView"),Z=m("RouteView");return i(),d(Z,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:t(({route:b,t:p,can:B,me:C,uri:tt})=>[a(Y,{notifications:!0},{default:t(()=>{var $,N,S,A,E,O,P,j,q,L;return[(i(!0),y(f,null,k([{bool:((N=($=s.data.dataplaneInsight.version)==null?void 0:$.kumaDp)==null?void 0:N.kumaCpCompatible)===!1,key:"dp-cp-incompatible",params:{kumaDp:((S=s.data.dataplaneInsight.version)==null?void 0:S.kumaDp.version)??""}},{bool:((E=(A=s.data.dataplaneInsight.version)==null?void 0:A.envoy)==null?void 0:E.kumaDpCompatible)===!1,key:"envoy-dp-incompatible",params:{envoy:((O=s.data.dataplaneInsight.version)==null?void 0:O.envoy.version)??"",kumaDp:((P=s.data.dataplaneInsight.version)==null?void 0:P.kumaDp.version)??""}},{bool:!!(B("use zones")&&s.data.zone&&((q=(j=s.data.dataplaneInsight.version)==null?void 0:j.kumaDp)==null?void 0:q.kumaCpCompatible)===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:((L=s.data.dataplaneInsight.version)==null?void 0:L.kumaDp.version)??""}},{bool:s.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:s.data.isCertExpired,key:"certificate-expired"},{bool:!s.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!B("use transparent-proxying",s.data),key:"networking-transparent-proxying",variant:"info"}],({bool:o,key:l,params:_,variant:z})=>(i(),d(H,{key:l,notify:o,"data-testid":`warning-${l}`,uri:`data-planes.notifications.${l}.${s.data.id}`,variant:z},{default:t(()=>[a(I,{path:`data-planes.notifications.${l}`,params:Object.fromEntries(Object.entries(_??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),e[43]||(e[43]=n()),a(u,{type:"stack","data-testid":"dataplane-details"},{default:t(()=>[a(Q,{title:p("data-planes.routes.item.about.title"),created:s.data.creationTime,modified:s.data.modificationTime,class:"about-section"},{default:t(()=>[a(u,null,{default:t(()=>[a(u,{type:"separated"},{default:t(()=>[a(c,{layout:"horizontal"},{title:t(()=>[n(r(p("http.api.property.status")),1)]),body:t(()=>[a(u,{type:"separated"},{default:t(()=>[a(nt,{status:s.data.status},null,8,["status"]),e[0]||(e[0]=n()),s.data.dataplaneType==="standard"?(i(),d(X,{key:0,items:s.data.dataplane.networking.inbounds,predicate:o=>o.state!=="Ready",empty:!1},{default:t(({items:o})=>[a(x,{name:"info"},{default:t(()=>[D("ul",null,[(i(!0),y(f,null,k(o,l=>(i(),y("li",{key:`${l.service}:${l.port}`},r(p("data-planes.routes.item.unhealthy_inbound",{service:l.service,port:l.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):w("",!0)]),_:2,__:[0]},1024)]),_:2,__:[1]},1024),e[7]||(e[7]=n()),B("use zones")&&s.data.zone?(i(),d(c,{key:0,layout:"horizontal"},{title:t(()=>[n(r(p("http.api.property.zone")),1)]),body:t(()=>[a(g,{appearance:"decorative"},{default:t(()=>[a(T,{to:{name:"zone-cp-detail-view",params:{zone:s.data.zone}}},{default:t(()=>[n(r(s.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2,__:[2]},1024)):w("",!0),e[8]||(e[8]=n()),a(c,{layout:"horizontal"},{title:t(()=>[n(r(p("http.api.proptery.type")),1)]),body:t(()=>[a(g,{appearance:"decorative"},{default:t(()=>[n(r(p(`data-planes.type.${s.data.dataplaneType}`)),1)]),_:2},1024)]),_:2,__:[3]},1024),e[9]||(e[9]=n()),s.data.namespace.length>0?(i(),d(c,{key:1,layout:"horizontal"},{title:t(()=>[n(r(p("http.api.property.namespace")),1)]),body:t(()=>[a(g,{appearance:"decorative"},{default:t(()=>[n(r(s.data.namespace),1)]),_:1})]),_:2,__:[4]},1024)):w("",!0),e[10]||(e[10]=n()),a(c,{layout:"horizontal"},{title:t(()=>[n(r(p("http.api.property.address")),1)]),body:t(()=>[a(J,{variant:"badge",format:"default",text:`${s.data.dataplane.networking.address}`},null,8,["text"])]),_:2,__:[5]},1024),e[11]||(e[11]=n()),s.data.dataplane.networking.gateway?(i(),d(c,{key:2,layout:"horizontal"},{title:t(()=>[n(r(p("http.api.property.tags")),1)]),body:t(()=>[a(ut,{tags:s.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2,__:[6]},1024)):w("",!0)]),_:2,__:[7,8,9,10,11]},1024),e[22]||(e[22]=n()),s.data.dataplaneInsight.mTLS?(i(),d(u,{key:0,"data-testid":"dataplane-mtls",class:"dataplane-mtls",size:"small"},{default:t(()=>[D("h3",null,r(p("data-planes.routes.item.mtls.title")),1),e[21]||(e[21]=n()),a(u,{size:"small"},{default:t(()=>[(i(!0),y(f,null,k([s.data.dataplaneInsight.mTLS],o=>(i(),y(f,{key:o},[a(u,{type:"separated"},{default:t(()=>[a(c,{layout:"horizontal"},{title:t(()=>[a(I,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:t(()=>[a(g,{appearance:"neutral"},{default:t(()=>[n(r(p("common.formats.datetime",{value:Date.parse(o.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2,__:[12]},1024),e[14]||(e[14]=n()),a(c,{layout:"horizontal"},{title:t(()=>[a(I,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:t(()=>[a(g,{appearance:"neutral"},{default:t(()=>[n(r(p("common.formats.datetime",{value:Date.parse(o.certificateExpirationTime)})),1)]),_:2},1024)]),_:2,__:[13]},1024)]),_:2,__:[14]},1024),e[20]||(e[20]=n()),a(u,{type:"separated"},{default:t(()=>[a(c,{layout:"horizontal"},{title:t(()=>[n(r(p("data-planes.routes.item.mtls.regenerations.title")),1)]),body:t(()=>[a(g,{appearance:"info"},{default:t(()=>[n(r(p("common.formats.integer",{value:o.certificateRegenerations})),1)]),_:2},1024)]),_:2,__:[15]},1024),e[18]||(e[18]=n()),a(c,{layout:"horizontal"},{title:t(()=>[n(r(p("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:t(()=>[a(g,{appearance:"decorative"},{default:t(()=>[n(r(o.issuedBackend),1)]),_:2},1024)]),_:2,__:[16]},1024),e[19]||(e[19]=n()),a(c,{layout:"horizontal"},{title:t(()=>[n(r(p("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:t(()=>[a(u,{type:"separated",truncate:""},{default:t(()=>[(i(!0),y(f,null,k(o.supportedBackends,l=>(i(),d(g,{key:l,appearance:l===o.issuedBackend?"decorative":"info"},{default:t(()=>[n(r(l),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2,__:[17]},1024)]),_:2,__:[18,19]},1024)],64))),128))]),_:2},1024)]),_:2,__:[21]},1024)):w("",!0)]),_:2,__:[22]},1024)]),_:2},1032,["title","created","modified"]),e[40]||(e[40]=n()),a(V,{class:"traffic","data-testid":"dataplane-traffic"},{default:t(()=>[a(U,{src:tt(ot(st),"/meshes/:mesh/dataplanes/:name/layout",{mesh:b.params.mesh,name:b.params.proxy})},{default:t(({data:o,refresh:l,error:_})=>[a(u,{type:"columns"},{default:t(()=>[a(F,null,{title:t(()=>[a(u,{type:"separated"},{default:t(()=>[a(x,{name:"inbound"}),e[23]||(e[23]=n()),e[24]||(e[24]=D("span",null,"Inbounds",-1))]),_:1,__:[23,24]})]),default:t(()=>[e[26]||(e[26]=n()),(i(!0),y(f,null,k([o.inbounds],z=>(i(),d(G,{key:typeof z,type:"inbound","data-testid":"dataplane-inbounds"},{default:t(()=>[a(X,{type:"inbounds",items:z,predicate:v=>v.port!==49151},it({default:t(({items:v})=>[a(u,{type:"stack",size:"small"},{default:t(()=>[(i(!0),y(f,null,k(v,h=>(i(),d(K,{key:`${h.kri}`,"data-testid":"dataplane-inbound",protocol:h.protocol,"port-name":h.port.toString()},{default:t(()=>[n(r(h.proxyResourceName),1)]),_:2},1032,["protocol","port-name"]))),128))]),_:2},1024)]),_:2},[s.data.dataplaneType==="delegated"?{name:"empty",fn:t(()=>[a(R,null,{default:t(()=>[D("p",null,`
                            This proxy is a delegated gateway therefore `+r(p("common.product.name"))+` does not have any
                            visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2,__:[26]},1024),e[32]||(e[32]=n()),a(F,null,{actions:t(()=>[a(T,{action:"refresh",appearance:"primary",onClick:l},{default:t(()=>e[27]||(e[27]=[n(`
                    Refresh
                  `,-1)])),_:2,__:[27]},1032,["onClick"])]),title:t(()=>[a(u,{type:"separated"},{default:t(()=>[a(x,{name:"outbound"}),e[28]||(e[28]=n()),e[29]||(e[29]=D("span",null,"Outbounds",-1))]),_:1,__:[28,29]})]),default:t(()=>[e[30]||(e[30]=n()),e[31]||(e[31]=n()),typeof _>"u"&&o.outbounds.length>0?(i(),d(X,{key:0,type:"outbounds",items:o.outbounds},{default:t(({items:z})=>[a(G,{type:"outbound","data-testid":"dataplane-outbounds"},{default:t(()=>[a(u,{type:"stack",size:"small"},{default:t(()=>[(i(!0),y(f,null,k(z,v=>(i(),d(K,{key:v.kri,"data-testid":"dataplane-outbound",protocol:v.protocol,"port-name":v.port.toString()},{default:t(()=>[n(r(v.proxyResourceName),1)]),_:2},1032,["protocol","port-name"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])):(i(),d(R,{key:1}))]),_:2,__:[30,31]},1024)]),_:2,__:[32]},1024)]),_:2},1032,["src"])]),_:2},1024),e[41]||(e[41]=n()),a(W,null,{default:t(o=>[o.route.name!==b.name?(i(),d(dt,{key:0,width:"670px",onClose:function(){b.replace({name:"data-plane-detail-view",params:{mesh:b.params.mesh,proxy:b.params.proxy},query:{inactive:b.params.inactive?null:void 0}})}},{default:t(()=>[(i(),d(rt(o.Component),{data:b.params.subscription.length>0?s.data.dataplaneInsight.subscriptions:o.route.name.includes("-inbound-")?s.data.dataplane.networking.inbounds:{},networking:s.data.dataplane.networking},null,8,["data","networking"]))]),_:2},1032,["onClose"])):w("",!0)]),_:2},1024),e[42]||(e[42]=n()),s.data.dataplaneInsight.subscriptions.length>0?(i(),y("div",mt,[a(V,null,{title:t(()=>[D("h2",null,r(p("data-planes.routes.item.subscriptions.title")),1)]),default:t(()=>[e[39]||(e[39]=n()),a(u,null,{default:t(()=>[a(I,{path:"data-planes.routes.item.subscriptions.description"}),e[38]||(e[38]=n()),a(lt,{headers:[{...C.get("headers.connection"),label:"Â ",key:"connection"},{...C.get("headers.instanceId"),label:p("http.api.property.instanceId"),key:"instanceId"},{...C.get("headers.version"),label:p("http.api.property.version"),key:"version"},{...C.get("headers.connected"),label:p("http.api.property.connected"),key:"connected"},{...C.get("headers.disconnected"),label:p("http.api.property.disconnected"),key:"disconnected"},{...C.get("headers.responses"),label:p("http.api.property.responses"),key:"responses"}],"is-selected-row":o=>o.id===b.params.subscription,items:s.data.dataplaneInsight.subscriptions.map((o,l,_)=>_[_.length-(l+1)]),onResize:C.set},{connection:t(({row:o})=>[(i(!0),y(f,null,k([o.connectTime&&!o.disconnectTime?"healthy":"unhealthy"],l=>(i(),d(x,{key:`${l}`,name:l},{default:t(()=>[n(r(p(`common.connection.${l}`)),1)]),_:2},1032,["name"]))),128))]),instanceId:t(({row:o})=>[a(T,{"data-action":"",to:{name:"data-plane-subscription-summary-view",params:{subscription:o.id}}},{default:t(()=>[n(r(o.controlPlaneInstanceId),1)]),_:2},1032,["to"])]),version:t(({row:o})=>{var l,_;return[n(r(((_=(l=o.version)==null?void 0:l.kumaDp)==null?void 0:_.version)??"-"),1)]}),connected:t(({row:o})=>[n(r(p("common.formats.datetime",{value:Date.parse(o.connectTime??"")})),1)]),disconnected:t(({row:o})=>[o.disconnectTime?(i(),y(f,{key:0},[n(r(p("common.formats.datetime",{value:Date.parse(o.disconnectTime)})),1)],64)):w("",!0)]),responses:t(({row:o})=>{var l;return[(i(!0),y(f,null,k([((l=o.status)==null?void 0:l.total)??{}],_=>(i(),y(f,null,[n(r(_.responsesSent)+"/"+r(_.responsesAcknowledged),1)],64))),256))]}),_:2,__:[33,34,35,36,37]},1032,["headers","is-selected-row","items","onResize"])]),_:2,__:[38]},1024)]),_:2,__:[39]},1024)])):w("",!0)]),_:2,__:[40,41,42]},1024)]}),_:2,__:[43]},1024)]),_:1})}}}),gt=pt(yt,[["__scopeId","data-v-c11b20bc"]]);export{gt as default};
