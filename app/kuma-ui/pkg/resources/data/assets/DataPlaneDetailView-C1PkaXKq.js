import{d as pt,a3 as rt,r as b,p as y,o as s,w as t,b as e,m as B,a4 as lt,c as m,e as n,N as _,L as w,q as z,O as v,T as ut,l as I,t as p,M as K,y as mt,_ as yt}from"./index-GFWvH1vH.js";import{S as _t}from"./SummaryView-IpLItP5N.js";import{T as ft}from"./TagList-CQ7OYedf.js";import{C as Q,a as V,b as N}from"./ConnectionTraffic--36wr69E.js";const ct=pt({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(U){const A=rt(),o=U;return(bt,a)=>{const C=b("XI18n"),R=b("XNotification"),T=b("XIcon"),S=b("DataCollection"),f=b("XLayout"),X=b("XAction"),x=b("XBadge"),W=b("XCopyButton"),Y=b("XAboutCard"),q=b("XEmptyState"),Z=b("XInputSwitch"),tt=b("XProgress"),at=b("XCard"),et=b("RouterView"),nt=b("AppView"),ot=b("DataSource"),st=b("RouteView");return s(),y(st,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:t(({route:c,t:u,can:$,uri:it})=>[e(ot,{src:it(B(lt),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[c.params.proxyType]??"dataplane",name:c.params.proxy,mesh:c.params.mesh||"*",socketAddress:o.data.dataplane.networking.inboundAddress})},{default:t(({data:g,error:h,refresh:dt})=>[e(nt,{notifications:!0},{default:t(()=>{var E,O,P,j,L,M,F,G,H,J;return[(s(!0),m(_,null,w([{bool:((O=(E=o.data.dataplaneInsight.version)==null?void 0:E.kumaDp)==null?void 0:O.kumaCpCompatible)===!1,key:"dp-cp-incompatible",params:{kumaDp:((P=o.data.dataplaneInsight.version)==null?void 0:P.kumaDp.version)??""}},{bool:((L=(j=o.data.dataplaneInsight.version)==null?void 0:j.envoy)==null?void 0:L.kumaDpCompatible)===!1,key:"envoy-dp-incompatible",params:{envoy:((M=o.data.dataplaneInsight.version)==null?void 0:M.envoy.version)??"",kumaDp:((F=o.data.dataplaneInsight.version)==null?void 0:F.kumaDp.version)??""}},{bool:!!($("use zones")&&o.data.zone&&((H=(G=o.data.dataplaneInsight.version)==null?void 0:G.kumaDp)==null?void 0:H.kumaCpCompatible)===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:((J=o.data.dataplaneInsight.version)==null?void 0:J.kumaDp.version)??""}},{bool:o.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:o.data.isCertExpired,key:"certificate-expired"},{bool:!o.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!!h,key:"stats-not-enhanced",params:{error:(h==null?void 0:h.toString())??""}},{bool:!$("use transparent-proxying",o.data),key:"networking-transparent-proxying",variant:"info"}],({bool:d,key:i,params:r,variant:l})=>(s(),y(R,{key:i,notify:d,"data-testid":`warning-${i}`,uri:`data-planes.notifications.${i}.${o.data.id}`,variant:l},{default:t(()=>[e(C,{path:`data-planes.notifications.${i}`,params:Object.fromEntries(Object.entries(r??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),a[48]||(a[48]=n()),e(f,{type:"stack","data-testid":"dataplane-details"},{default:t(()=>[e(Y,{title:u("data-planes.routes.item.about.title"),created:o.data.creationTime,modified:o.data.modificationTime,class:"about-section"},{default:t(()=>[e(f,null,{default:t(()=>[e(f,{type:"separated"},{default:t(()=>[e(v,{layout:"horizontal"},{title:t(()=>[n(p(u("http.api.property.status")),1)]),body:t(()=>[e(f,{type:"separated"},{default:t(()=>[e(ut,{status:o.data.status},null,8,["status"]),a[0]||(a[0]=n()),o.data.dataplaneType==="standard"?(s(),y(S,{key:0,items:o.data.dataplane.networking.inbounds,predicate:d=>d.state!=="Ready",empty:!1},{default:t(({items:d})=>[e(T,{name:"info"},{default:t(()=>[I("ul",null,[(s(!0),m(_,null,w(d,i=>(s(),m("li",{key:`${i.service}:${i.port}`},p(u("data-planes.routes.item.unhealthy_inbound",{service:i.service,port:i.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):z("",!0)]),_:2,__:[0]},1024)]),_:2,__:[1]},1024),a[7]||(a[7]=n()),$("use zones")&&o.data.zone?(s(),y(v,{key:0,layout:"horizontal"},{title:t(()=>[n(p(u("http.api.property.zone")),1)]),body:t(()=>[e(x,{appearance:"decorative"},{default:t(()=>[e(X,{to:{name:"zone-cp-detail-view",params:{zone:o.data.zone}}},{default:t(()=>[n(p(o.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2,__:[2]},1024)):z("",!0),a[8]||(a[8]=n()),e(v,{layout:"horizontal"},{title:t(()=>[n(p(u("http.api.property.type")),1)]),body:t(()=>[e(x,{appearance:"decorative"},{default:t(()=>[n(p(u(`data-planes.type.${o.data.dataplaneType}`)),1)]),_:2},1024)]),_:2,__:[3]},1024),a[9]||(a[9]=n()),o.data.namespace.length>0?(s(),y(v,{key:1,layout:"horizontal"},{title:t(()=>[n(p(u("http.api.property.namespace")),1)]),body:t(()=>[e(x,{appearance:"decorative"},{default:t(()=>[n(p(o.data.namespace),1)]),_:1})]),_:2,__:[4]},1024)):z("",!0),a[10]||(a[10]=n()),e(v,{layout:"horizontal"},{title:t(()=>[n(p(u("http.api.property.address")),1)]),body:t(()=>[e(W,{variant:"badge",format:"default",text:`${o.data.dataplane.networking.address}`},null,8,["text"])]),_:2,__:[5]},1024),a[11]||(a[11]=n()),o.data.dataplane.networking.gateway?(s(),y(v,{key:2,layout:"horizontal"},{title:t(()=>[n(p(u("http.api.property.tags")),1)]),body:t(()=>[e(ft,{tags:o.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2,__:[6]},1024)):z("",!0)]),_:2,__:[7,8,9,10,11]},1024),a[29]||(a[29]=n()),o.data.dataplaneInsight.mTLS?(s(),y(f,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:t(()=>[I("h3",null,p(u("data-planes.routes.item.mtls.title")),1),a[21]||(a[21]=n()),e(f,{size:"small"},{default:t(()=>[(s(!0),m(_,null,w([o.data.dataplaneInsight.mTLS],d=>(s(),m(_,{key:d},[e(f,{type:"separated"},{default:t(()=>[e(v,{layout:"horizontal"},{title:t(()=>[e(C,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:t(()=>[e(x,{appearance:"neutral"},{default:t(()=>[n(p(u("common.formats.datetime",{value:Date.parse(d.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2,__:[12]},1024),a[14]||(a[14]=n()),e(v,{layout:"horizontal"},{title:t(()=>[e(C,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:t(()=>[e(x,{appearance:"neutral"},{default:t(()=>[n(p(u("common.formats.datetime",{value:Date.parse(d.certificateExpirationTime)})),1)]),_:2},1024)]),_:2,__:[13]},1024)]),_:2,__:[14]},1024),a[20]||(a[20]=n()),e(f,{type:"separated"},{default:t(()=>[e(v,{layout:"horizontal"},{title:t(()=>[n(p(u("data-planes.routes.item.mtls.regenerations.title")),1)]),body:t(()=>[e(x,{appearance:"info"},{default:t(()=>[n(p(u("common.formats.integer",{value:d.certificateRegenerations})),1)]),_:2},1024)]),_:2,__:[15]},1024),a[18]||(a[18]=n()),e(v,{layout:"horizontal"},{title:t(()=>[n(p(u("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:t(()=>[e(x,{appearance:"decorative"},{default:t(()=>[n(p(d.issuedBackend),1)]),_:2},1024)]),_:2,__:[16]},1024),a[19]||(a[19]=n()),e(v,{layout:"horizontal"},{title:t(()=>[n(p(u("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:t(()=>[e(f,{type:"separated",truncate:""},{default:t(()=>[(s(!0),m(_,null,w(d.supportedBackends,i=>(s(),y(x,{key:i,appearance:i===d.issuedBackend?"decorative":"info"},{default:t(()=>[n(p(i),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2,__:[17]},1024)]),_:2,__:[18,19]},1024)],64))),128))]),_:2},1024)]),_:2,__:[21]},1024)):z("",!0),a[30]||(a[30]=n()),o.data.dataplaneInsight.subscriptions.length>0?(s(),y(f,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:t(()=>[e(f,{type:"separated"},{default:t(()=>[I("h3",null,p(u("data-planes.routes.item.subscriptions.title")),1),a[22]||(a[22]=n()),e(X,{"data-action":"",appearance:"anchor",to:{name:"data-plane-subscriptions-summary-view",params:{mesh:c.params.mesh,proxy:c.params.proxy},query:{inactive:c.params.inactive}}},{default:t(()=>[n(`
                    (`+p(u("data-planes.routes.item.xds.show-details"))+`)
                  `,1)]),_:2},1032,["to"])]),_:2,__:[22]},1024),a[28]||(a[28]=n()),(s(!0),m(_,null,w([[...o.data.dataplaneInsight.subscriptions].reverse()],d=>(s(),y(f,{key:typeof d,type:"separated"},{default:t(()=>[(s(!0),m(_,null,w([d.find(i=>!i.disconnectTime)??d[0]],i=>(s(),m(_,{key:i.id},[!i.disconnectTime&&i.connectTime?(s(),m(_,{key:0},[e(v,{layout:"horizontal"},{title:t(()=>[e(C,{path:"data-planes.routes.item.xds.connected"})]),body:t(()=>[e(x,{appearance:"neutral"},{default:t(()=>[n(p(u("common.formats.datetime",{value:Date.parse(i.connectTime)})),1)]),_:2},1024)]),_:2,__:[23]},1024),a[26]||(a[26]=n()),e(v,{layout:"horizontal"},{title:t(()=>[e(C,{path:"data-planes.routes.item.xds.instance"})]),body:t(()=>[e(x,{appearance:"info"},{default:t(()=>[n(p(i.controlPlaneInstanceId),1)]),_:2},1024)]),_:2,__:[24]},1024),a[27]||(a[27]=n()),e(v,{layout:"horizontal"},{title:t(()=>[e(C,{path:"data-planes.routes.item.xds.version"})]),body:t(()=>[e(x,{appearance:"info"},{default:t(()=>{var r,l;return[n(p(((l=(r=i.version)==null?void 0:r.kumaDp)==null?void 0:l.version)??u("common.unknown")),1)]}),_:2},1024)]),_:2,__:[25]},1024)],64)):(s(),y(C,{key:1,path:"data-planes.routes.item.xds.disconnected"}))],64))),128))]),_:2},1024))),128))]),_:2,__:[28]},1024)):z("",!0)]),_:2,__:[29,30]},1024)]),_:2},1032,["title","created","modified"]),a[46]||(a[46]=n()),e(at,{class:"traffic","data-testid":"dataplane-traffic"},{default:t(()=>[e(f,{type:"columns"},{default:t(()=>[e(Q,null,{title:t(()=>[e(f,{type:"separated"},{default:t(()=>[e(T,{name:"inbound"}),a[31]||(a[31]=n()),a[32]||(a[32]=I("span",null,"Inbounds",-1))]),_:1,__:[31,32]})]),default:t(()=>[a[34]||(a[34]=n()),(s(!0),m(_,null,w([o.data.dataplane.networking.type==="gateway"?Object.entries((g==null?void 0:g.inbounds)??{}).reduce((d,[i,r])=>{var k;const l=i.split("_").at(-1);return l===(((k=o.data.dataplane.networking.admin)==null?void 0:k.port)??"9901")?d:d.concat([{...o.data.dataplane.networking.inbounds[0],name:i,clusterName:i,port:Number(l),protocol:["http","tcp"].find(D=>typeof r[D]<"u")??"tcp",addressPort:`${o.data.dataplane.networking.inbounds[0].address}:${l}`}])},[]):o.data.dataplane.networking.inbounds],d=>(s(),y(V,{key:d,type:"inbound","data-testid":"dataplane-inbounds"},{default:t(()=>[e(S,{type:"inbounds",items:d,predicate:i=>i.port!==49151},K({default:t(({items:i})=>[e(f,{type:"stack",size:"small"},{default:t(()=>[(s(!0),m(_,null,w(i,r=>(s(),m(_,{key:`${r.name}`},[(s(!0),m(_,null,w([g==null?void 0:g.inbounds[r.clusterName]],l=>(s(),y(N,{key:l,"data-testid":"dataplane-inbound",protocol:r.protocol,"port-name":r.portName,service:$("use service-insights",o.mesh)?r.tags["kuma.io/service"]:"",traffic:typeof h>"u"?l:{name:"",protocol:r.protocol,port:`${r.port}`}},{default:t(()=>[e(X,{"data-action":"",to:{name:(k=>k.includes("bound")?k.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(B(A).name)),params:{connection:r.name},query:{inactive:c.params.inactive}}},{default:t(()=>[n(p(r.name.replace("localhost","").replace("_",":")),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","service","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},[o.data.dataplaneType==="delegated"?{name:"empty",fn:t(()=>[e(q,null,{default:t(()=>[I("p",null,`
                            This proxy is a delegated gateway therefore `+p(u("common.product.name"))+` does not have any
                            visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2,__:[34]},1024),a[45]||(a[45]=n()),e(Q,null,K({title:t(()=>[e(f,{type:"separated"},{default:t(()=>[e(T,{name:"outbound"}),a[38]||(a[38]=n()),a[39]||(a[39]=I("span",null,"Outbounds",-1))]),_:1,__:[38,39]})]),default:t(()=>[a[43]||(a[43]=n()),a[44]||(a[44]=n()),typeof h>"u"?(s(),m(_,{key:0},[typeof g>"u"?(s(),y(tt,{key:0})):(s(),m(_,{key:1},[e(V,{type:"passthrough"},{default:t(()=>[e(N,{protocol:"passthrough",traffic:g.passthrough},{default:t(()=>a[40]||(a[40]=[n(`
                        Non mesh traffic
                      `,-1)])),_:2,__:[40]},1032,["traffic"])]),_:2},1024),a[42]||(a[42]=n()),(s(),m(_,null,w(["upstream"],d=>(s(),m(_,{key:d},[e(R,{notify:!!Object.values(g.outbounds).find(i=>{var r,l;return(typeof i.tcp<"u"?(r=i.tcp)==null?void 0:r[`${d}_cx_rx_bytes_total`]:(l=i.http)==null?void 0:l[`${d}_rq_total`])??!1}),variant:"info",uri:`data-planes.notifications.recommend-reachable-services:${o.data.id}`},{default:t(()=>[e(C,{path:"data-planes.notifications.recommend-reachable",params:{mode:o.mesh.meshServices.mode}},null,8,["params"])]),_:2},1032,["notify","uri"]),a[41]||(a[41]=n()),e(S,{type:"outbounds",predicate:c.params.inactive?void 0:([i,r])=>{var l,k;return((typeof r.tcp<"u"?(l=r.tcp)==null?void 0:l[`${d}_cx_rx_bytes_total`]:(k=r.http)==null?void 0:k[`${d}_rq_total`])??0)>0},items:Object.entries(g.outbounds)},{default:t(({items:i})=>[i.length>0?(s(),y(V,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:t(()=>[(s(),m(_,null,w([/-([a-f0-9]){16}$/],r=>e(f,{key:r,type:"stack",size:"small"},{default:t(()=>[(s(!0),m(_,null,w(i,([l,k])=>(s(),y(N,{key:`${l}`,"data-testid":"dataplane-outbound",protocol:["grpc","http","tcp"].find(D=>typeof k[D]<"u")??"tcp",traffic:k,service:k.$resourceMeta.type===""?l.replace(r,""):void 0,direction:d},{default:t(()=>[e(X,{"data-action":"",to:{name:(D=>D.includes("bound")?D.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(B(A).name)),params:{connection:l},query:{inactive:c.params.inactive}}},{default:t(()=>[n(p(l),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","service","direction"]))),128))]),_:2},1024)),64))]),_:2},1024)):z("",!0)]),_:2},1032,["predicate","items"])],64))),64))],64))],64)):(s(),y(q,{key:1}))]),_:2},[g?{name:"actions",fn:t(()=>[e(Z,{checked:c.params.inactive,"data-testid":"dataplane-outbounds-inactive-toggle",onChange:d=>c.update({inactive:d})},{label:t(()=>a[35]||(a[35]=[n(`
                      Show inactive
                    `,-1)])),_:2},1032,["checked","onChange"]),a[37]||(a[37]=n()),e(X,{action:"refresh",appearance:"primary",onClick:dt},{default:t(()=>a[36]||(a[36]=[n(`
                    Refresh
                  `,-1)])),_:2,__:[36]},1032,["onClick"])]),key:"0"}:void 0]),1024)]),_:2,__:[45]},1024)]),_:2},1024),a[47]||(a[47]=n()),e(et,null,{default:t(d=>[d.route.name!==c.name?(s(),y(_t,{key:0,width:d.route.name==="data-plane-subscriptions-summary-view"?"900px":"670px",onClose:function(){c.replace({name:"data-plane-detail-view",params:{mesh:c.params.mesh,proxy:c.params.proxy},query:{inactive:c.params.inactive?null:void 0}})}},{default:t(()=>[(s(),y(mt(d.Component),{data:c.params.subscription.length>0?o.data.dataplaneInsight.subscriptions:d.route.name.includes("-inbound-")?o.data.dataplane.networking.inbounds:(g==null?void 0:g.outbounds)||{},networking:o.data.dataplane.networking,subscriptions:o.data.dataplaneInsight.subscriptions},null,8,["data","networking","subscriptions"]))]),_:2},1032,["width","onClose"])):z("",!0)]),_:2},1024)]),_:2,__:[46,47]},1024)]}),_:2,__:[48]},1024)]),_:2},1032,["src"])]),_:1})}}}),xt=yt(ct,[["__scopeId","data-v-1ba204a5"]]);export{xt as default};
