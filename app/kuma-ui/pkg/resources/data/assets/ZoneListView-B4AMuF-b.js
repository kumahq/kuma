import{d as H,v as $,Q as J,p as y,o as i,w as n,b as l,r,e as p,q as X,m as k,l as V,I as O,K as U,t as g,c as f,L as v,N as z,S as Y,T as ee,y as ne,G as oe,_ as se}from"./index-BsSN3CyG.js";import{S as te}from"./SummaryView-CINfZcxW.js";const ae=["data-testid"],ie=H({__name:"ZoneListView",setup(le){const S=$({}),L=$({}),A=J(),B=b=>{const s="zoneIngress";S.value=b.items.reduce((m,c)=>{var _;const u=(_=c[s])==null?void 0:_.zone;if(typeof u<"u"){typeof m[u]>"u"&&(m[u]={online:[],offline:[]});const h=typeof c[`${s}Insight`].connectedSubscription<"u"?"online":"offline";m[u][h].push(c)}return m},{})},Z=b=>{const s="zoneEgress";L.value=b.items.reduce((m,c)=>{var _;const u=(_=c[s])==null?void 0:_.zone;if(typeof u<"u"){typeof m[u]>"u"&&(m[u]={online:[],offline:[]});const h=typeof c[`${s}Insight`].connectedSubscription<"u"?"online":"offline";m[u][h].push(c)}return m},{})};return(b,s)=>{const m=r("RouteTitle"),c=r("DataSource"),u=r("XI18n"),_=r("XTeleportTemplate"),h=r("XSearch"),D=r("XIcon"),R=r("XAction"),E=r("DataCollection"),G=r("DataLoader"),q=r("XLayout"),x=r("XCard"),F=r("RouterView"),K=r("AppView"),M=r("RouteView");return i(),y(M,{name:"zone-cp-list-view",params:{page:1,size:Number,zone:"",s:""}},{default:n(({route:t,t:w,can:P,uri:Q,me:d})=>[l(c,{src:Q(k(oe),"/zone-cps",{},{page:t.params.page,size:t.params.size,search:t.params.s})},{default:n(({data:o,error:W,refresh:j})=>{var T;return[l(K,{docs:o&&((T=o==null?void 0:o.items)!=null&&T.length)?w("zones.href.docs.cta"):""},{title:n(()=>[V("h1",null,[l(m,{title:w("zone-cps.routes.items.title")},null,8,["title"])])]),default:n(()=>[s[9]||(s[9]=p()),l(c,{src:"/zone-ingress-overviews?page=1&size=100",onChange:B}),s[10]||(s[10]=p()),l(c,{src:"/zone-egress-overviews?page=1&size=100",onChange:Z}),s[11]||(s[11]=p()),!P("view growth-new-empty-states")||o!=null&&o.items.length?(i(),y(u,{key:0,path:"zone-cps.routes.items.intro","default-path":"common.i18n.ignore-error"})):X("",!0),s[12]||(s[12]=p()),((o==null?void 0:o.items)??[]).length>0?(i(),y(_,{key:1,to:{name:"zone-cp-list-view-actions"}},{default:n(()=>[l(k(A))]),_:1})):X("",!0),s[13]||(s[13]=p()),l(x,null,{default:n(()=>[l(q,null,{default:n(()=>[V("search",null,[V("form",{onSubmit:s[0]||(s[0]=O(()=>{},["prevent"]))},[l(h,{class:"search-field",keys:["name"],value:t.params.s,onChange:e=>t.update({page:1,s:e})},null,8,["value","onChange"])],32)]),s[8]||(s[8]=p()),l(G,{data:[o],errors:[W],variant:"list"},{default:n(()=>[l(E,{type:"zone-cps",items:(o==null?void 0:o.items)??[void 0],page:t.params.page,"page-size":t.params.size,total:o==null?void 0:o.total,onChange:t.update},{default:n(()=>[l(U,{class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{...d.get("headers.type"),label:"Â ",key:"type"},{...d.get("headers.name"),label:"Name",key:"name"},{...d.get("headers.zoneCpVersion"),label:"Zone leader CP version",key:"zoneCpVersion"},{...d.get("headers.ingress"),label:"Ingresses (online / total)",key:"ingress"},{...d.get("headers.egress"),label:"Egresses (online / total)",key:"egress"},{...d.get("headers.state"),label:"Status",key:"state"},{...d.get("headers.warnings"),label:"Warnings",key:"warnings",hideLabel:!0},{...d.get("headers.actions"),label:"Actions",key:"actions",hideLabel:!0}],items:o==null?void 0:o.items,"is-selected-row":e=>e.name===t.params.zone,onResize:d.set},{type:n(({row:e})=>[(i(!0),f(z,null,v([["kubernetes","universal"].find(a=>a===e.zoneInsight.environment)??"kubernetes"],a=>(i(),y(D,{key:a,name:a},{default:n(()=>[p(g(w(`common.product.environment.${a}`)),1)]),_:2},1032,["name"]))),128))]),name:n(({row:e})=>[l(R,{"data-action":"",to:{name:"zone-cp-detail-view",params:{zone:e.name},query:{page:t.params.page,size:t.params.size,s:t.params.s}}},{default:n(()=>[p(g(e.name),1)]),_:2},1032,["to"])]),zoneCpVersion:n(({row:e})=>[p(g(k(ee)(e.zoneInsight,"version.kumaCp.version",w("common.collection.none"))),1)]),ingress:n(({row:e})=>[(i(!0),f(z,null,v([S.value[e.name]||{online:[],offline:[]}],a=>(i(),f(z,null,[p(g(a.online.length)+" / "+g(a.online.length+a.offline.length),1)],64))),256))]),egress:n(({row:e})=>[(i(!0),f(z,null,v([L.value[e.name]||{online:[],offline:[]}],a=>(i(),f(z,null,[p(g(a.online.length)+" / "+g(a.online.length+a.offline.length),1)],64))),256))]),state:n(({row:e})=>[l(Y,{status:e.state},null,8,["status"])]),warnings:n(({row:e})=>{var a,N;return[(i(!0),f(z,null,v([[{bool:e.zoneInsight.store==="memory",key:"store-memory"},{bool:!((N=(a=e.zoneInsight.version)==null?void 0:a.kumaCp)!=null&&N.kumaCpGlobalCompatible),key:"global-cp-incompatible"}].filter(({bool:C})=>C)],C=>(i(),f(z,{key:typeof C},[C.length>0?(i(),y(D,{key:0,name:"warning","data-testid":"warning"},{default:n(()=>[V("ul",null,[(i(!0),f(z,null,v(C,({key:I})=>(i(),f("li",{key:I,"data-testid":`warning-${I}`},g(w(`zone-cps.list.warnings.${I}`)),9,ae))),128))])]),_:2},1024)):(i(),f(z,{key:1},[p(g(w("common.collection.none")),1)],64))],64))),128))]}),actions:n(({row:e})=>[l(k(A),{item:e,onChange:j},{default:n(()=>[l(R,{to:{name:"zone-cp-detail-view",params:{zone:e.name}}},{default:n(()=>[p(g(w("common.collection.actions.view")),1)]),_:2},1032,["to"])]),_:2},1032,["item","onChange"])]),_:2,__:[1,2,3,4,5,6,7]},1032,["headers","items","is-selected-row","onResize"])]),_:2},1032,["items","page","page-size","total","onChange"])]),_:2},1032,["data","errors"])]),_:2,__:[8]},1024)]),_:2},1024),s[14]||(s[14]=p()),t.params.zone?(i(),y(F,{key:2},{default:n(e=>[l(te,{onClose:a=>t.replace({name:"zone-cp-list-view",query:{page:t.params.page,size:t.params.size,s:t.params.s}})},{default:n(()=>[(i(),y(ne(e.Component),{name:t.params.zone,"zone-overview":o==null?void 0:o.items.find(a=>a.name===t.params.zone)},null,8,["name","zone-overview"]))]),_:2},1032,["onClose"])]),_:2},1024)):X("",!0)]),_:2,__:[9,10,11,12,13,14]},1032,["docs"])]}),_:2},1032,["src"])]),_:1})}}}),me=se(ie,[["__scopeId","data-v-c20f7ab6"]]);export{me as default};
