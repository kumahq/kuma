import{d as R,o as m,i as q,w as u,a as g,u as a,m as te,b as c,O as j,bP as t,g as F,h as O,bQ as le,c8 as $,cc as se,c as k,e as r,cA as ne,cB as oe,F as G,cd as X,bV as N,bO as re,cv as ie,f as ue,c4 as W,c9 as ce,cw as pe,cl as me,j as C,cK as de,ci as H,bW as ve,bX as ye,bY as fe,k as he}from"./index.f9d2d6e1.js";import{Q as Y,D as _e}from"./DataOverview.65b29a11.js";import{F as ge}from"./FrameSkeleton.ae53a1b0.js";import{_ as Z}from"./LabelList.vue_vue_type_style_index_0_lang.e38ed795.js";import{T as be}from"./TabsWidget.a6d4064e.js";import{_ as we}from"./YamlView.vue_vue_type_script_setup_true_lang.03379c2e.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.d2009474.js";import"./ErrorBlock.8f129a2d.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.fb0553b6.js";import"./StatusBadge.d3b1a2a6.js";import"./TagList.0cfcc420.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.a0466e29.js";import"./_commonjsHelpers.f037b798.js";const Pe=R({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(d){const s=d;return(E,S)=>(m(),q(a(j),{class:"docs-link",appearance:"outline",target:"_blank",to:s.href},{default:u(()=>[g(a(te),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),c(`

    Documentation
  `)]),_:1},8,["to"]))}}),ke=r("h4",null,"Dataplanes",-1),Ee=R({__name:"PolicyConnections",props:{mesh:{type:String,required:!0},policyType:{type:String,required:!0},policyName:{type:String,required:!0}},setup(d){const s=d,E=t(!1),S=t(!0),L=t(!1),v=t([]),w=t(""),b=F(()=>{const n=w.value.toLowerCase();return v.value.filter(({dataplane:o})=>o.name.toLowerCase().includes(n))});O(()=>s.policyName,function(){y()}),le(function(){y()});async function y(){L.value=!1,S.value=!0;try{const{items:n,total:o}=await $.getPolicyConnections({mesh:s.mesh,policyType:s.policyType,policyName:s.policyName});E.value=o>0,v.value=n!=null?n:[]}catch{L.value=!0}finally{S.value=!1}}return(n,o)=>{const f=se("router-link");return m(),k("div",null,[g(Z,{"has-error":L.value,"is-loading":S.value,"is-empty":!E.value},{default:u(()=>[r("ul",null,[r("li",null,[ke,c(),ne(r("input",{id:"dataplane-search","onUpdate:modelValue":o[0]||(o[0]=p=>w.value=p),type:"text",class:"k-input mb-4",placeholder:"Filter by name",required:"","data-testid":"dataplane-search-input"},null,512),[[oe,w.value]]),c(),(m(!0),k(G,null,X(a(b),(p,P)=>(m(),k("p",{key:P,class:"my-1","data-testid":"dataplane-name"},[g(f,{to:{name:"data-plane-detail-view",params:{mesh:p.dataplane.mesh,dataPlane:p.dataplane.name}}},{default:u(()=>[c(N(p.dataplane.name),1)]),_:2},1032,["to"])]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])])}}}),Se=d=>(ye("data-v-43b9d0f6"),d=d(),fe(),d),De={key:0,class:"mb-4"},xe=Se(()=>r("p",null,[r("strong",null,"Warning"),c(` This policy is experimental. If you encountered any problem please open an
            `),r("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),Te={class:"entity-heading","data-testid":"policy-single-entity"},Ce={"data-testid":"policy-overview-tab"},Ne={class:"config-wrapper"},Le=R({__name:"PolicyView",props:{selectedPolicyName:{type:String,required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(d){const s=d,E=ve(),S=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],L=re(),v=ie(),w=ue(),b=t(!0),y=t(!1),n=t(null),o=t(!0),f=t(!1),p=t(!1),P=t(!1),D=t({}),x=t(null),M=t(null),B=t(s.offset),U=t({headers:[{label:"Actions",key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Type",key:"type"}],data:[]}),h=F(()=>w.state.policyTypesByPath[s.policyPath]),J=F(()=>w.state.policyTypes.map(e=>{var l;return{length:(l=w.state.sidebar.insights.mesh.policies[e.name])!=null?l:0,label:e.name,value:e.path,selected:e.path===s.policyPath}}));O(()=>v.params.mesh,function(){v.name===s.policyPath&&(b.value=!0,y.value=!1,o.value=!0,f.value=!1,p.value=!1,P.value=!1,n.value=null,A(0))}),O(()=>v.query.ns,function(){b.value=!0,y.value=!1,o.value=!0,f.value=!1,p.value=!1,P.value=!1,n.value=null,A(0)}),A(s.offset);async function A(e){var Q,K;B.value=e,Y.set("offset",e>0?e:null),b.value=!0,n.value=null;const l=v.query.ns||null,i=v.params.mesh,T=h.value.path;try{let _;if(i!==null&&l!==null)_=[await $.getSinglePolicyEntity({mesh:i,path:T,name:l})],M.value=null;else{const I={size:W,offset:e},V=await $.getAllPolicyEntitiesFromMesh({mesh:i,path:T},I);_=(Q=V.items)!=null?Q:[],M.value=V.next}if(_.length>0){U.value.data=_.map(V=>ae(V)),P.value=!1,y.value=!1;const I=(K=s.selectedPolicyName)!=null?K:_[0].name;await z({name:I,mesh:i,path:T})}else U.value.data=[],P.value=!0,y.value=!0,f.value=!0}catch(_){_ instanceof Error?n.value=_:console.error(_),y.value=!0}finally{b.value=!1,o.value=!1}}function ee(e){L.push({name:"policy",params:{...v.params,policyPath:e.value}})}function ae(e){if(!e.mesh)return e;const l=e,i={name:"mesh-detail-view",params:{mesh:e.mesh}};return l.meshRoute=i,l}async function z(e){p.value=!1,o.value=!0,f.value=!1;try{const l=await $.getSinglePolicyEntity({mesh:e.mesh,path:h.value.path,name:e.name});if(l){const i=["type","name","mesh"];D.value=ce(l,i),Y.set("policy",D.value.name),x.value=pe(l)}else D.value={},f.value=!0}catch(l){p.value=!0,console.error(l)}finally{o.value=!1}}return(e,l)=>a(h)?(m(),k("div",{key:0,class:H(["relative",a(h).path])},[a(h).isExperimental?(m(),k("div",De,[g(a(me),{appearance:"warning"},{alertMessage:u(()=>[xe]),_:1})])):C("",!0),c(),g(ge,null,{default:u(()=>[g(_e,{"selected-entity-name":D.value.name,"page-size":a(W),error:n.value,"is-loading":b.value,"empty-state":{title:"No Data",message:`There are no ${a(h).name} policies present.`},"table-data":U.value,"table-data-is-empty":P.value,next:M.value,"page-offset":B.value,onTableAction:z,onLoadData:A},{additionalControls:u(()=>[g(a(de),{label:"Policies",items:a(J),"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:ee},{"item-template":u(({item:i})=>[r("span",{class:H({"policy-type-empty":i.length===0})},N(i.label),3)]),_:1},8,["items"]),c(),g(Pe,{href:`${a(E)("KUMA_DOCS_URL")}/policies/${a(h).path}/?${a(E)("KUMA_UTM_QUERY_PARAMS")}`,"data-testid":"policy-documentation-link"},null,8,["href"]),c(),e.$route.query.ns?(m(),q(a(j),{key:0,class:"back-button",appearance:"primary",icon:"arrowLeft",to:{name:"policy",params:{policyPath:s.policyPath}}},{default:u(()=>[c(`
            View all
          `)]),_:1},8,["to"])):C("",!0)]),default:u(()=>[c(`
        >
        `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"]),c(),y.value===!1?(m(),q(be,{key:0,"has-error":n.value!==null,error:n.value,"is-loading":b.value,tabs:S,"initial-tab-override":"overview"},{tabHeader:u(()=>[r("h1",Te,N(a(h).name)+": "+N(D.value.name),1)]),overview:u(()=>[g(Z,{"has-error":p.value,"is-loading":o.value,"is-empty":f.value},{default:u(()=>[r("div",Ce,[r("ul",null,[(m(!0),k(G,null,X(D.value,(i,T)=>(m(),k("li",{key:T},[r("h4",null,N(T),1),c(),r("p",null,N(i),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"]),c(),r("div",Ne,[x.value!==null?(m(),q(we,{key:0,id:"code-block-policy","has-error":p.value,"is-loading":o.value,"is-empty":f.value,content:x.value,"is-searchable":""},null,8,["has-error","is-loading","is-empty","content"])):C("",!0)])]),"affected-dpps":u(()=>[x.value!==null?(m(),q(Ee,{key:0,mesh:x.value.mesh,"policy-name":x.value.name,"policy-type":a(h).path},null,8,["mesh","policy-name","policy-type"])):C("",!0)]),_:1},8,["has-error","error","is-loading"])):C("",!0)]),_:1})],2)):C("",!0)}});const We=he(Le,[["__scopeId","data-v-43b9d0f6"]]);export{We as default};
