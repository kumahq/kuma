import{m as J,a as H,b as X,j as ee}from"./kongponents.es-3ba46133.js";import{a as ae,u as te,k as M,i as se,s as le}from"./production-4c848fca.js";import{_ as oe}from"./PolicyConnections.vue_vue_type_script_setup_true_lang-72c41d86.js";import{D as ne}from"./DataOverview-7a799dab.js";import{d as K,o as p,a as x,w as o,e as v,u as a,f as n,r as l,c as R,q as z,h as q,b as E,g as r,t as T,H as B,F as re,l as ie,p as ue,k as ce}from"./runtime-dom.esm-bundler-9284044f.js";import{F as pe}from"./FrameSkeleton-2cb333d2.js";import{_ as me}from"./LabelList.vue_vue_type_style_index_0_lang-8d6c26c5.js";import{T as de}from"./TabsWidget-f99fd53d.js";import{_ as ye}from"./YamlView.vue_vue_type_script_setup_true_lang-b8cc5ebe.js";import{u as fe}from"./store-e9d4becb.js";import{u as ve,a as he}from"./index-86d1ef67.js";import{Q as O}from"./QueryParameter-70743f73.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-1dc4f3b2.js";import"./ErrorBlock-ffcf2e0c.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-55aeae37.js";import"./datadogLogEvents-302eea7b.js";import"./TagList-7b5a0741.js";import"./StatusBadge-832cc4dd.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-1071fcf3.js";import"./toYaml-4e00099e.js";const ge=K({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(m){const i=m;return(D,$)=>(p(),x(a(H),{class:"docs-link",appearance:"outline",target:"_blank",to:i.href},{default:o(()=>[v(a(J),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),n(`

    Documentation
  `)]),_:1},8,["to"]))}}),be=m=>(ue("data-v-38386bed"),m=m(),ce(),m),ke={key:0,class:"mb-4"},Pe=be(()=>r("p",null,[r("strong",null,"Warning"),n(` This policy is experimental. If you encountered any problem please open an
            `),r("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),we={class:"entity-heading","data-testid":"policy-single-entity"},Ee={"data-testid":"policy-overview-tab"},Se={class:"config-wrapper"},Te=K({__name:"PolicyListView",props:{selectedPolicyName:{type:String,required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(m){const i=m,D=ve(),$=he(),Q=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],W=ae(),h=te(),L=fe(),_=l(!0),g=l(!1),d=l(null),y=l(!0),f=l(!1),b=l(!1),S=l(!1),k=l({}),P=l(null),V=l(null),U=l(i.offset),C=l({headers:[{label:"Actions",key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Type",key:"type"}],data:[]}),u=R(()=>L.state.policyTypesByPath[i.policyPath]),j=R(()=>L.state.policyTypes.map(e=>({label:e.name,value:e.path,selected:e.path===i.policyPath}))),G=R(()=>L.state.policyTypes.filter(e=>(L.state.sidebar.insights.mesh.policies[e.name]??0)===0).map(e=>e.name));z(()=>h.params.mesh,function(){h.name===i.policyPath&&(_.value=!0,g.value=!1,y.value=!0,f.value=!1,b.value=!1,S.value=!1,d.value=null,A(0))}),z(()=>h.query.ns,function(){_.value=!0,g.value=!1,y.value=!0,f.value=!1,b.value=!1,S.value=!1,d.value=null,A(0)}),A(i.offset);async function A(e){U.value=e,O.set("offset",e>0?e:null),_.value=!0,d.value=null;const s=h.query.ns||null,t=h.params.mesh,w=u.value.path;try{let c;if(t!==null&&s!==null)c=[await D.getSinglePolicyEntity({mesh:t,path:w,name:s})],V.value=null;else{const N={size:M,offset:e},I=await D.getAllPolicyEntitiesFromMesh({mesh:t,path:w},N);c=I.items??[],V.value=I.next}if(c.length>0){C.value.data=c.map(I=>Z(I)),S.value=!1,g.value=!1;const N=i.selectedPolicyName??c[0].name;await F({name:N,mesh:t,path:w})}else C.value.data=[],S.value=!0,g.value=!0,f.value=!0}catch(c){c instanceof Error?d.value=c:console.error(c),g.value=!0}finally{_.value=!1,y.value=!1}}function Y(e){W.push({name:"policy",params:{...h.params,policyPath:e.value}})}function Z(e){if(!e.mesh)return e;const s=e,t={name:"mesh-detail-view",params:{mesh:e.mesh}};return s.meshRoute=t,s}async function F(e){b.value=!1,y.value=!0,f.value=!1;try{const s=await D.getSinglePolicyEntity({mesh:e.mesh,path:u.value.path,name:e.name});if(s){const t=["type","name","mesh"];k.value=se(s,t),O.set("policy",k.value.name),P.value=le(s)}else k.value={},f.value=!0}catch(s){b.value=!0,console.error(s)}finally{y.value=!1}}return(e,s)=>a(u)?(p(),q("div",{key:0,class:B(["relative",a(u).path])},[a(u).isExperimental?(p(),q("div",ke,[v(a(X),{appearance:"warning"},{alertMessage:o(()=>[Pe]),_:1})])):E("",!0),n(),v(pe,null,{default:o(()=>[v(ne,{"selected-entity-name":k.value.name,"page-size":a(M),error:d.value,"is-loading":_.value,"empty-state":{title:"No Data",message:`There are no ${a(u).name} policies present.`},"table-data":C.value,"table-data-is-empty":S.value,next:V.value,"page-offset":U.value,onTableAction:F,onLoadData:A},{additionalControls:o(()=>[v(a(ee),{label:"Policies",items:a(j),"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:Y},{"item-template":o(({item:t})=>[r("span",{class:B({"policy-type-empty":a(G).includes(t.label)})},T(t.label),3)]),_:1},8,["items"]),n(),v(ge,{href:`${a($)("KUMA_DOCS_URL")}/policies/${a(u).path}/?${a($)("KUMA_UTM_QUERY_PARAMS")}`,"data-testid":"policy-documentation-link"},null,8,["href"]),n(),e.$route.query.ns?(p(),x(a(H),{key:0,class:"back-button",appearance:"primary",icon:"arrowLeft",to:{name:"policy",params:{policyPath:i.policyPath}}},{default:o(()=>[n(`
            View all
          `)]),_:1},8,["to"])):E("",!0)]),default:o(()=>[n(`
        >
        `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"]),n(),g.value===!1?(p(),x(de,{key:0,"has-error":d.value!==null,error:d.value,"is-loading":_.value,tabs:Q},{tabHeader:o(()=>[r("h1",we,T(a(u).name)+": "+T(k.value.name),1)]),overview:o(()=>[v(me,{"has-error":b.value,"is-loading":y.value,"is-empty":f.value},{default:o(()=>[r("div",Ee,[r("ul",null,[(p(!0),q(re,null,ie(k.value,(t,w)=>(p(),q("li",{key:w},[r("h4",null,T(w),1),n(),r("p",null,T(t),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"]),n(),r("div",Se,[P.value!==null?(p(),x(ye,{key:0,id:"code-block-policy","has-error":b.value,"is-loading":y.value,"is-empty":f.value,content:P.value,"is-searchable":""},null,8,["has-error","is-loading","is-empty","content"])):E("",!0)])]),"affected-dpps":o(()=>[P.value!==null?(p(),x(oe,{key:0,mesh:P.value.mesh,"policy-name":P.value.name,"policy-type":a(u).path},null,8,["mesh","policy-name","policy-type"])):E("",!0)]),_:1},8,["has-error","error","is-loading"])):E("",!0)]),_:1})],2)):E("",!0)}});const je=_e(Te,[["__scopeId","data-v-38386bed"]]);export{je as default};
