import{d as O,y as L,r as i,o as r,m as _,w as e,b as s,p as R,H as Q,s as T,e as l,t as p,q as v,C as U,c as y,F as w,v as b,W as Y,S as ee,K as ne,_ as oe}from"./index-8SjAY088.js";import{S as te}from"./SummaryView-DLGIgcs7.js";const se=["data-testid"],ae=O({__name:"ZoneListView",setup(le){const V=L({}),X=L({}),$=C=>{const n="zoneIngress";V.value=C.items.reduce((u,d)=>{var f;const m=(f=d[n])==null?void 0:f.zone;if(typeof m<"u"){typeof u[m]>"u"&&(u[m]={online:[],offline:[]});const k=typeof d[`${n}Insight`].connectedSubscription<"u"?"online":"offline";u[m][k].push(d)}return u},{})},N=C=>{const n="zoneEgress";X.value=C.items.reduce((u,d)=>{var f;const m=(f=d[n])==null?void 0:f.zone;if(typeof m<"u"){typeof u[m]>"u"&&(u[m]={online:[],offline:[]});const k=typeof d[`${n}Insight`].connectedSubscription<"u"?"online":"offline";u[m][k].push(d)}return u},{})};return(C,n)=>{const u=i("RouteTitle"),d=i("DataSource"),m=i("XI18n"),f=i("XAction"),k=i("XTeleportTemplate"),S=i("XIcon"),D=i("DataLoader"),x=i("XPrompt"),B=i("DataSink"),Z=i("XDisclosure"),E=i("XActionGroup"),q=i("DataCollection"),P=i("XCard"),F=i("RouterView"),G=i("AppView"),W=i("RouteView");return r(),_(W,{name:"zone-cp-list-view",params:{page:1,size:Number,zone:""}},{default:e(({route:c,t:g,can:I,uri:H,me:z})=>[s(d,{src:H(R(Q),"/zone-cps",{},{page:c.params.page,size:c.params.size})},{default:e(({data:a,error:K,refresh:j})=>{var A;return[s(G,{docs:a&&((A=a==null?void 0:a.items)!=null&&A.length)?g("zones.href.docs.cta"):""},{title:e(()=>[T("h1",null,[s(u,{title:g("zone-cps.routes.items.title")},null,8,["title"])])]),default:e(()=>[n[12]||(n[12]=l()),s(d,{src:"/zone-ingress-overviews?page=1&size=100",onChange:$}),n[13]||(n[13]=l()),s(d,{src:"/zone-egress-overviews?page=1&size=100",onChange:N}),n[14]||(n[14]=l()),s(m,{path:"zone-cps.routes.items.intro","default-path":"common.i18n.ignore-error"}),n[15]||(n[15]=l()),s(P,null,{default:e(()=>[I("create zones")&&((a==null?void 0:a.items)??[]).length>0?(r(),_(k,{key:0,to:{name:"zone-cp-list-view-actions"}},{default:e(()=>[s(f,{action:"create",appearance:"primary",to:{name:"zone-create-view"},"data-testid":"create-zone-link"},{default:e(()=>[l(p(g("zones.index.create")),1)]),_:2},1024)]),_:2},1024)):v("",!0),n[11]||(n[11]=l()),s(D,{data:[a],errors:[K]},{loadable:e(()=>[s(q,{type:"zone-cps",items:(a==null?void 0:a.items)??[void 0],page:c.params.page,"page-size":c.params.size,total:a==null?void 0:a.total,onChange:c.update},{default:e(()=>[s(U,{class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{...z.get("headers.type"),label:"Â ",key:"type"},{...z.get("headers.name"),label:"Name",key:"name"},{...z.get("headers.zoneCpVersion"),label:"Zone Leader CP Version",key:"zoneCpVersion"},{...z.get("headers.ingress"),label:"Ingresses (online / total)",key:"ingress"},{...z.get("headers.egress"),label:"Egresses (online / total)",key:"egress"},{...z.get("headers.state"),label:"Status",key:"state"},{...z.get("headers.warnings"),label:"Warnings",key:"warnings",hideLabel:!0},{...z.get("headers.actions"),label:"Actions",key:"actions",hideLabel:!0}],items:a==null?void 0:a.items,"is-selected-row":o=>o.name===c.params.zone,onResize:z.set},{type:e(({row:o})=>[(r(!0),y(w,null,b([["kubernetes","universal"].find(t=>t===o.zoneInsight.environment)??"kubernetes"],t=>(r(),_(S,{key:t,name:t},{default:e(()=>[l(p(g(`common.product.environment.${t}`)),1)]),_:2},1032,["name"]))),128))]),name:e(({row:o})=>[s(f,{"data-action":"",to:{name:"zone-cp-detail-view",params:{zone:o.name},query:{page:c.params.page,size:c.params.size}}},{default:e(()=>[l(p(o.name),1)]),_:2},1032,["to"])]),zoneCpVersion:e(({row:o})=>[l(p(R(Y)(o.zoneInsight,"version.kumaCp.version",g("common.collection.none"))),1)]),ingress:e(({row:o})=>[(r(!0),y(w,null,b([V.value[o.name]||{online:[],offline:[]}],t=>(r(),y(w,null,[l(p(t.online.length)+" / "+p(t.online.length+t.offline.length),1)],64))),256))]),egress:e(({row:o})=>[(r(!0),y(w,null,b([X.value[o.name]||{online:[],offline:[]}],t=>(r(),y(w,null,[l(p(t.online.length)+" / "+p(t.online.length+t.offline.length),1)],64))),256))]),state:e(({row:o})=>[s(ee,{status:o.state},null,8,["status"])]),warnings:e(({row:o})=>[o.warnings.length>0?(r(),_(S,{key:0,name:"warning","data-testid":"warning"},{default:e(()=>[T("ul",null,[(r(!0),y(w,null,b(o.warnings,t=>(r(),y("li",{key:t.kind,"data-testid":`warning-${t.kind}`},p(g(`zone-cps.list.${t.kind}`)),9,se))),128))])]),_:2},1024)):(r(),y(w,{key:1},[l(p(g("common.collection.none")),1)],64))]),actions:e(({row:o})=>[s(E,null,{default:e(()=>[s(Z,null,{default:e(({expanded:t,toggle:h})=>[s(f,{to:{name:"zone-cp-detail-view",params:{zone:o.name}}},{default:e(()=>[l(p(g("common.collection.actions.view")),1)]),_:2},1032,["to"]),n[2]||(n[2]=l()),I("create zones")?(r(),_(f,{key:0,appearance:"danger",onClick:h},{default:e(()=>[l(p(g("common.collection.actions.delete")),1)]),_:2},1032,["onClick"])):v("",!0),n[3]||(n[3]=l()),s(k,{to:{name:"modal-layer"}},{default:e(()=>[t?(r(),_(B,{key:0,src:`/zone-cps/${o.name}/delete`,onChange:()=>{h(),j()}},{default:e(({submit:J,error:M})=>[s(x,{action:g("common.delete_modal.proceed_button"),expected:o.name,"data-testid":"delete-zone-modal",onCancel:h,onSubmit:()=>J({})},{title:e(()=>[l(p(g("common.delete_modal.title",{type:"Zone"})),1)]),default:e(()=>[n[0]||(n[0]=l()),s(m,{path:"common.delete_modal.text",params:{type:"Zone",name:o.name}},null,8,["params"]),n[1]||(n[1]=l()),s(D,{class:"mt-4",errors:[M],loader:!1},null,8,["errors"])]),_:2},1032,["action","expected","onCancel","onSubmit"])]),_:2},1032,["src","onChange"])):v("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["headers","items","is-selected-row","onResize"])]),_:2},1032,["items","page","page-size","total","onChange"])]),_:2},1032,["data","errors"])]),_:2},1024),n[16]||(n[16]=l()),c.params.zone?(r(),_(F,{key:0},{default:e(o=>[s(te,{onClose:t=>c.replace({name:"zone-cp-list-view",query:{page:c.params.page,size:c.params.size}})},{default:e(()=>[(r(),_(ne(o.Component),{name:c.params.zone,"zone-overview":a==null?void 0:a.items.find(t=>t.name===c.params.zone)},null,8,["name","zone-overview"]))]),_:2},1032,["onClose"])]),_:2},1024)):v("",!0)]),_:2},1032,["docs"])]}),_:2},1032,["src"])]),_:1})}}}),ce=oe(ae,[["__scopeId","data-v-b66a816a"]]);export{ce as default};
