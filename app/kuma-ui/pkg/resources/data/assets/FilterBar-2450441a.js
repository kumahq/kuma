var se=Object.defineProperty;var oe=(n,i,t)=>i in n?se(n,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[i]=t;var N=(n,i,t)=>(oe(n,typeof i!="symbol"?i+"":i,t),t);import{K as w}from"./index-fce48c05.js";import{d as K,k as ie,a as B,o as d,b as P,X as le,w as m,r as O,e as S,f as u,t as f,l as c,c as g,F as T,C as Q,m as b,p as z,T as re,_ as R,z as C,H as A,a8 as $,ar as ue,as as ce,at as de,n as j,au as fe,av as pe,aw as me,ax as ge,s as ve,v as he}from"./index-a842a987.js";import{A as ye}from"./AppCollection-2b92908a.js";import{S as be}from"./StatusBadge-29a8623e.js";import{T as _e}from"./TextWithCopyButton-a77a996b.js";import{_ as ke}from"./WarningIcon.vue_vue_type_script_setup_true_lang-190e6f2a.js";import{u as Se}from"./uniqueId-90cc9b93.js";const xe={key:0},Ce={key:1},Te=K({__name:"DataPlaneList",props:{total:{default:0},pageNumber:{},pageSize:{},items:{},error:{},isSelectedRow:{type:[Function,null],default:null},summaryRouteName:{},isGlobalMode:{type:Boolean}},emits:["change"],setup(n,{emit:i}){const{t,formatIsoDate:x}=ie(),l=n,s=i;return(o,_)=>{const p=B("RouterLink"),h=B("KTruncate"),k=B("KTooltip");return d(),P(ye,{class:"data-plane-collection","empty-state-message":c(t)("common.emptyState.message",{type:"Data Plane Proxies"}),"empty-state-cta-to":c(t)("data-planes.href.docs.data_plane_proxy"),"empty-state-cta-text":c(t)("common.documentation"),headers:[{label:"Name",key:"name"},{label:"Type",key:"type"},{label:"Services",key:"services"},...l.isGlobalMode?[{label:"Zone",key:"zone"}]:[],{label:"Certificate Info",key:"certificate"},{label:"Status",key:"status"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Details",key:"details",hideLabel:!0}],"page-number":l.pageNumber,"page-size":l.pageSize,total:l.total,items:l.items,error:l.error,"is-selected-row":l.isSelectedRow,onChange:_[0]||(_[0]=e=>s("change",e))},le({name:m(({row:e})=>[S(p,{class:"name-link",title:e.name,to:{name:l.summaryRouteName,params:{mesh:e.mesh,dataPlane:e.name},query:{page:l.pageNumber,size:l.pageSize}}},{default:m(()=>[u(f(e.name),1)]),_:2},1032,["title","to"])]),type:m(({row:e})=>[u(f(c(t)(`data-planes.type.${e.dataplaneType}`)),1)]),services:m(({row:e})=>[e.services.length>0?(d(),P(h,{key:0,width:"auto"},{default:m(()=>[(d(!0),g(T,null,Q(e.services,(y,I)=>(d(),g("div",{key:I},[S(_e,{text:y},{default:m(()=>[S(p,{to:{name:"service-detail-view",params:{service:y}}},{default:m(()=>[u(f(y),1)]),_:2},1032,["to"])]),_:2},1032,["text"])]))),128))]),_:2},1024)):(d(),g(T,{key:1},[u(f(c(t)("common.collection.none")),1)],64))]),zone:m(({row:e})=>[e.zone?(d(),P(p,{key:0,to:{name:"zone-cp-detail-view",params:{zone:e.zone}}},{default:m(()=>[u(f(e.zone),1)]),_:2},1032,["to"])):(d(),g(T,{key:1},[u(f(c(t)("common.collection.none")),1)],64))]),certificate:m(({row:e})=>{var y;return[(y=e.dataplaneInsight.mTLS)!=null&&y.certificateExpirationTime?(d(),g(T,{key:0},[u(f(c(x)(e.dataplaneInsight.mTLS.certificateExpirationTime)),1)],64)):(d(),g(T,{key:1},[u(f(c(t)("data-planes.components.data-plane-list.certificate.none")),1)],64))]}),status:m(({row:e})=>[S(be,{status:e.status},null,8,["status"])]),warnings:m(({row:e})=>[e.isCertExpired||e.warnings.length>0?(d(),P(k,{key:0},{content:m(()=>[b("ul",null,[e.warnings.length>0?(d(),g("li",xe,f(c(t)("data-planes.components.data-plane-list.version_mismatch")),1)):z("",!0),u(),e.isCertExpired?(d(),g("li",Ce,f(c(t)("data-planes.components.data-plane-list.cert_expired")),1)):z("",!0)])]),default:m(()=>[u(),S(ke,{class:"mr-1",size:c(w),"hide-title":""},null,8,["size"])]),_:2},1024)):(d(),g(T,{key:1},[u(f(c(t)("common.collection.none")),1)],64))]),details:m(({row:e})=>[S(p,{class:"details-link","data-testid":"details-link",to:{name:"data-plane-detail-view",params:{dataPlane:e.name}}},{default:m(()=>[u(f(c(t)("common.collection.details_link"))+" ",1),S(c(re),{display:"inline-block",decorative:"",size:c(w)},null,8,["size"])]),_:2},1032,["to"])]),_:2},[o.$slots.toolbar?{name:"toolbar",fn:m(()=>[O(o.$slots,"toolbar",{},void 0,!0)]),key:"0"}:void 0]),1032,["empty-state-message","empty-state-cta-to","empty-state-cta-text","headers","page-number","page-size","total","items","error","is-selected-row"])}}});const Ye=R(Te,[["__scopeId","data-v-4ee5ee9a"]]);function we(n,i,t){return Math.max(i,Math.min(n,t))}const ze=["ControlLeft","ControlRight","ShiftLeft","ShiftRight","AltLeft"];class Ie{constructor(i,t){N(this,"commands");N(this,"keyMap");N(this,"boundTriggerShortcuts");this.commands=t,this.keyMap=Object.fromEntries(Object.entries(i).map(([x,l])=>[x.toLowerCase(),l])),this.boundTriggerShortcuts=this.triggerShortcuts.bind(this)}registerListener(){document.addEventListener("keydown",this.boundTriggerShortcuts)}unRegisterListener(){document.removeEventListener("keydown",this.boundTriggerShortcuts)}triggerShortcuts(i){Le(i,this.keyMap,this.commands)}}function Le(n,i,t){const x=Fe(n.code),l=[n.ctrlKey?"ctrl":"",n.shiftKey?"shift":"",n.altKey?"alt":"",x].filter(_=>_!=="").join("+"),s=i[l];if(!s)return;const o=t[s];o.isAllowedContext&&!o.isAllowedContext(n)||(o.shouldPreventDefaultAction&&n.preventDefault(),!(o.isDisabled&&o.isDisabled())&&o.trigger(n))}function Fe(n){return ze.includes(n)?"":n.replace(/^Key/,"").toLowerCase()}function Ne(n,i){const t=" "+n,x=t.matchAll(/ ([-\s\w]+):\s*/g),l=[];for(const s of Array.from(x)){if(s.index===void 0)continue;const o=Pe(s[1]);if(i.length>0&&!i.includes(o))throw new Error(`Unknown field “${o}”. Known fields: ${i.join(", ")}`);const _=s.index+s[0].length,p=t.substring(_);let h;if(/^\s*["']/.test(p)){const e=p.match(/['"](.*?)['"]/);if(e!==null)h=e[1];else throw new Error(`Quote mismatch for field “${o}”.`)}else{const e=p.indexOf(" "),y=e===-1?p.length:e;h=p.substring(0,y)}h!==""&&l.push([o,h])}return l}function Pe(n){return n.trim().replace(/\s+/g,"-").replace(/-[a-z]/g,(i,t)=>t===0?i:i.substring(1).toUpperCase())}const V=n=>(ve("data-v-349996e3"),n=n(),he(),n),Ae=V(()=>b("span",{class:"visually-hidden"},"Focus filter",-1)),Ee={class:"k-filter-icon"},Be=["for"],Me=["id","placeholder"],De={key:0,class:"k-suggestion-box","data-testid":"k-filter-bar-suggestion-box"},qe={class:"k-suggestion-list"},$e={key:0,class:"k-filter-bar-error"},je={key:0},Ke=["title","data-filter-field"],Oe={class:"visually-hidden"},Qe=V(()=>b("span",{class:"visually-hidden"},"Clear query",-1)),Re=K({__name:"FilterBar",props:{id:{type:String,required:!1,default:()=>Se("k-filter-bar")},fields:{type:Object,required:!0},placeholder:{type:String,required:!1,default:null},query:{type:String,required:!1,default:""}},emits:["fields-change"],setup(n,{emit:i}){const t=n,x=i,l=C(null),s=C(null),o=C(t.query),_=C([]),p=C(null),h=C(!1),k=C(-1),e=A(()=>Object.keys(t.fields)),y=A(()=>Object.entries(t.fields).slice(0,5).map(([a,r])=>({fieldName:a,...r}))),I=A(()=>e.value.length>0?`Filter by ${e.value.join(", ")}`:"Filter"),H=A(()=>t.placeholder??I.value);$(()=>_.value,function(a,r){ne(a,r)||(p.value=null,x("fields-change",{fields:a,query:o.value}))}),$(()=>o.value,function(){o.value===""&&(p.value=null),h.value=!0});const U={Enter:"submitQuery",Escape:"closeSuggestionBox",ArrowDown:"jumpToNextSuggestion",ArrowUp:"jumpToPreviousSuggestion"},W={submitQuery:{trigger:M,isAllowedContext(a){return s.value!==null&&a.composedPath().includes(s.value)},shouldPreventDefaultAction:!0},jumpToNextSuggestion:{trigger:Z,isAllowedContext(a){return s.value!==null&&a.composedPath().includes(s.value)},shouldPreventDefaultAction:!0},jumpToPreviousSuggestion:{trigger:X,isAllowedContext(a){return s.value!==null&&a.composedPath().includes(s.value)},shouldPreventDefaultAction:!0},closeSuggestionBox:{trigger:E,isAllowedContext(a){return l.value!==null&&a.composedPath().includes(l.value)}}};function G(){const a=new Ie(U,W);me(function(){a.registerListener()}),ge(function(){a.unRegisterListener()}),L(o.value)}G();function J(a){const r=a.target;L(r.value)}function M(){if(s.value instanceof HTMLInputElement)if(k.value===-1)L(s.value.value),h.value=!1;else{const a=y.value[k.value].fieldName;a&&q(s.value,a)}}function Z(){D(1)}function X(){D(-1)}function D(a){k.value=we(k.value+a,-1,y.value.length-1)}function Y(){s.value instanceof HTMLInputElement&&s.value.focus()}function ee(a){const v=a.currentTarget.getAttribute("data-filter-field");v&&s.value instanceof HTMLInputElement&&q(s.value,v)}function q(a,r){const v=o.value===""||o.value.endsWith(" ")?"":" ";o.value+=v+r+":",a.focus(),k.value=-1}function te(){o.value="",s.value instanceof HTMLInputElement&&(s.value.value="",s.value.focus(),L(""))}function ae(a){a.relatedTarget===null&&E(),l.value instanceof HTMLElement&&a.relatedTarget instanceof Node&&!l.value.contains(a.relatedTarget)&&E()}function E(){h.value=!1}function L(a){p.value=null;try{const r=Ne(a,e.value);r.sort((v,F)=>v[0].localeCompare(F[0])),_.value=r}catch(r){if(r instanceof Error)p.value=r,h.value=!0;else throw r}}function ne(a,r){return JSON.stringify(a)===JSON.stringify(r)}return(a,r)=>(d(),g("div",{ref_key:"filterBar",ref:l,class:"k-filter-bar","data-testid":"k-filter-bar"},[b("button",{class:"k-focus-filter-input-button",title:"Focus filter",type:"button","data-testid":"k-filter-bar-focus-filter-input-button",onClick:Y},[Ae,u(),b("span",Ee,[S(c(ue),{decorative:"","data-testid":"k-filter-bar-filter-icon","hide-title":"",size:c(w)},null,8,["size"])])]),u(),b("label",{for:`${t.id}-filter-bar-input`,class:"visually-hidden"},[O(a.$slots,"default",{},()=>[u(f(I.value),1)],!0)],8,Be),u(),ce(b("input",{id:`${t.id}-filter-bar-input`,ref_key:"filterInput",ref:s,"onUpdate:modelValue":r[0]||(r[0]=v=>o.value=v),class:"k-filter-bar-input",type:"text",placeholder:H.value,"data-testid":"k-filter-bar-filter-input",onFocus:r[1]||(r[1]=v=>h.value=!0),onBlur:ae,onChange:J},null,40,Me),[[de,o.value]]),u(),h.value?(d(),g("div",De,[b("div",qe,[p.value!==null?(d(),g("p",$e,f(p.value.message),1)):(d(),g("button",{key:1,class:j(["k-submit-query-button",{"k-submit-query-button-is-selected":k.value===-1}]),title:"Submit query",type:"button","data-testid":"k-filter-bar-submit-query-button",onClick:M},`
          Submit `+f(o.value),3)),u(),(d(!0),g(T,null,Q(y.value,(v,F)=>(d(),g("div",{key:`${t.id}-${F}`,class:j(["k-suggestion-list-item",{"k-suggestion-list-item-is-selected":k.value===F}])},[b("b",null,f(v.fieldName),1),v.description!==""?(d(),g("span",je,": "+f(v.description),1)):z("",!0),u(),b("button",{class:"k-apply-suggestion-button",title:`Add ${v.fieldName}:`,type:"button","data-filter-field":v.fieldName,"data-testid":"k-filter-bar-apply-suggestion-button",onClick:ee},[b("span",Oe,"Add "+f(v.fieldName)+":",1),u(),S(c(fe),{decorative:"","hide-title":"",size:c(w)},null,8,["size"])],8,Ke)],2))),128))])])):z("",!0),u(),o.value!==""?(d(),g("button",{key:1,class:"k-clear-query-button",title:"Clear query",type:"button","data-testid":"k-filter-bar-clear-query-button",onClick:te},[Qe,u(),S(c(pe),{decorative:"","hide-title":"",size:c(w)},null,8,["size"])])):z("",!0)],512))}});const et=R(Re,[["__scopeId","data-v-349996e3"]]);export{Ye as D,et as F};
