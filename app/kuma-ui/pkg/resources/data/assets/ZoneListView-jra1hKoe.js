import{d as H,R as M,L as R,h as c,o,a as z,w as e,j as s,g as V,k as a,z as k,H as P,T as J,b as d,F as f,U as Q,t as r,e as C,C as Y,V as ee,B as I,W as $,S as ne,M as te,r as oe,A as se}from"./index-ChMk9xbI.js";import{e as ae}from"./kong-icons.es249-BqzxpUAd.js";import{p as le}from"./kong-icons.es337-BAuZ5XWy.js";import{_ as ie}from"./DeleteResourceModal.vue_vue_type_script_setup_true_lang-rIrZi3gT.js";import{S as re}from"./SummaryView-awjXeDWd.js";const ce=["data-testid"],me=H({__name:"ZoneListView",setup(pe){const T=M(),x=R({}),K=R({}),Z=w=>{const v="zoneIngress";x.value=w.items.reduce((_,m)=>{var g;const p=(g=m[v])==null?void 0:g.zone;if(typeof p<"u"){typeof _[p]>"u"&&(_[p]={online:[],offline:[]});const h=typeof m[`${v}Insight`].connectedSubscription<"u"?"online":"offline";_[p][h].push(m)}return _},{})},A=w=>{const v="zoneEgress";K.value=w.items.reduce((_,m)=>{var g;const p=(g=m[v])==null?void 0:g.zone;if(typeof p<"u"){typeof _[p]>"u"&&(_[p]={online:[],offline:[]});const h=typeof m[`${v}Insight`].connectedSubscription<"u"?"online":"offline";_[p][h].push(m)}return _},{})};async function E(w){await T.deleteZone({name:w})}return(w,v)=>{const _=c("RouteTitle"),m=c("DataSource"),p=c("KButton"),g=c("XTeleportTemplate"),h=c("XIcon"),B=c("RouterLink"),N=c("KDropdownItem"),X=c("XDisclosure"),j=c("KDropdown"),q=c("KCard"),F=c("RouterView"),O=c("AppView"),U=c("RouteView");return o(),z(m,{src:"/me"},{default:e(({data:L})=>[L?(o(),z(U,{key:0,name:"zone-cp-list-view",params:{page:1,size:L.pageSize,zone:""}},{default:e(({route:i,t:l,can:b,uri:W})=>[s(O,null,{title:e(()=>[V("h1",null,[s(_,{title:l("zone-cps.routes.items.title")},null,8,["title"])])]),default:e(()=>[a(),s(m,{src:W(k(P),"/zone-cps",{},{page:i.params.page,size:i.params.size})},{default:e(({data:u,error:D,refresh:G})=>[s(m,{src:"/zone-ingress-overviews?page=1&size=100",onChange:Z}),a(),s(m,{src:"/zone-egress-overviews?page=1&size=100",onChange:A}),a(),s(q,null,{default:e(()=>[D!==void 0?(o(),z(J,{key:0,error:D},null,8,["error"])):(o(),d(f,{key:1},[b("create zones")&&((u==null?void 0:u.items)??[]).length>0?(o(),z(g,{key:0,to:{name:"zone-cp-list-view-actions"}},{default:e(()=>[s(p,{appearance:"primary",to:{name:"zone-create-view"},"data-testid":"create-zone-link"},{default:e(()=>[s(k(Q)),a(" "+r(l("zones.index.create")),1)]),_:2},1024)]),_:2},1024)):C("",!0),a(),s(Y,{class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{label:"Â ",key:"type"},{label:"Name",key:"name"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Ingresses (online / total)",key:"ingress"},{label:"Egresses (online / total)",key:"egress"},{label:"Status",key:"state"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Details",key:"details",hideLabel:!0},{label:"Actions",key:"actions",hideLabel:!0}],"page-number":i.params.page,"page-size":i.params.size,total:u==null?void 0:u.total,items:u==null?void 0:u.items,error:D,"empty-state-title":b("create zones")?l("zone-cps.empty_state.title"):void 0,"empty-state-message":b("create zones")?l("zone-cps.empty_state.message"):void 0,"empty-state-cta-to":b("create zones")?{name:"zone-create-view"}:void 0,"empty-state-cta-text":b("create zones")?l("zones.index.create"):void 0,"is-selected-row":n=>n.name===i.params.zone,onChange:i.update},ee({type:e(({row:n})=>[(o(!0),d(f,null,I([["kubernetes","universal"].find(t=>t===n.zoneInsight.environment)??"kubernetes"],t=>(o(),z(h,{key:t,name:t},{default:e(()=>[a(r(l(`common.product.environment.${t}`)),1)]),_:2},1032,["name"]))),128))]),name:e(({row:n})=>[s(B,{"data-action":"",to:{name:"zone-cp-detail-view",params:{zone:n.name},query:{page:i.params.page,size:i.params.size}}},{default:e(()=>[a(r(n.name),1)]),_:2},1032,["to"])]),zoneCpVersion:e(({row:n})=>[a(r(k($)(n.zoneInsight,"version.kumaCp.version",l("common.collection.none"))),1)]),ingress:e(({row:n})=>[(o(!0),d(f,null,I([x.value[n.name]||{online:[],offline:[]}],t=>(o(),d(f,null,[a(r(t.online.length)+" / "+r(t.online.length+t.offline.length),1)],64))),256))]),egress:e(({row:n})=>[(o(!0),d(f,null,I([K.value[n.name]||{online:[],offline:[]}],t=>(o(),d(f,null,[a(r(t.online.length)+" / "+r(t.online.length+t.offline.length),1)],64))),256))]),state:e(({row:n})=>[s(ne,{status:n.state},null,8,["status"])]),warnings:e(({row:n})=>[(o(!0),d(f,null,I([{version_mismatch:!k($)(n.zoneInsight,"version.kumaCp.kumaCpGlobalCompatible","true"),store_memory:n.zoneInsight.store==="memory"}],t=>(o(),d(f,{key:`${t.version_mismatch}-${t.store_memory}`},[Object.values(t).some(y=>y)?(o(),z(h,{key:0,name:"warning","data-testid":"warning"},{default:e(()=>[V("ul",null,[(o(!0),d(f,null,I(t,(y,S)=>(o(),d(f,{key:S},[y?(o(),d("li",{key:0,"data-testid":`warning-${S}`},r(l(`zone-cps.list.${S}`)),9,ce)):C("",!0)],64))),128))])]),_:2},1024)):(o(),d(f,{key:1},[a(r(l("common.collection.none")),1)],64))],64))),128))]),details:e(({row:n})=>[s(B,{class:"details-link","data-testid":"details-link",to:{name:"zone-cp-detail-view",params:{zone:n.name}}},{default:e(()=>[a(r(l("common.collection.details_link"))+" ",1),s(k(ae),{decorative:"",size:k(te)},null,8,["size"])]),_:2},1032,["to"])]),_:2},[b("create zones")?{name:"actions",fn:e(({row:n})=>[s(j,{class:"actions-dropdown","kpop-attributes":{placement:"bottomEnd",popoverClasses:"mt-5 more-actions-popover"},width:"150"},{default:e(()=>[s(p,{class:"non-visual-button",appearance:"secondary",icon:""},{default:e(()=>[s(k(le))]),_:1})]),items:e(()=>[s(X,null,{default:e(({expanded:t,toggle:y})=>[s(N,{danger:"","data-testid":"dropdown-delete-item",onClick:y},{default:e(()=>[a(r(l("common.collection.actions.delete")),1)]),_:2},1032,["onClick"]),a(),s(g,{to:{name:"modal-layer"}},{default:e(()=>[t?(o(),z(ie,{key:0,"confirmation-text":n.name,"delete-function":()=>E(n.name),"is-visible":"","action-button-text":l("common.delete_modal.proceed_button"),title:l("common.delete_modal.title",{type:"Zone"}),"data-testid":"delete-zone-modal",onCancel:y,onDelete:()=>{y(),G()}},{default:e(()=>[V("p",null,r(l("common.delete_modal.text1",{type:"Zone",name:n.name})),1),a(),V("p",null,r(l("common.delete_modal.text2")),1)]),_:2},1032,["confirmation-text","delete-function","action-button-text","title","onCancel","onDelete"])):C("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["page-number","page-size","total","items","error","empty-state-title","empty-state-message","empty-state-cta-to","empty-state-cta-text","is-selected-row","onChange"])],64))]),_:2},1024),a(),i.params.zone?(o(),z(F,{key:0},{default:e(n=>[s(re,{onClose:t=>i.replace({name:"zone-cp-list-view",query:{page:i.params.page,size:i.params.size}})},{default:e(()=>[(o(),z(oe(n.Component),{name:i.params.zone,"zone-overview":u==null?void 0:u.items.find(t=>t.name===i.params.zone)},null,8,["name","zone-overview"]))]),_:2},1032,["onClose"])]),_:2},1024)):C("",!0)]),_:2},1032,["src"])]),_:2},1024)]),_:2},1032,["params"])):C("",!0)]),_:1})}}}),ge=se(me,[["__scopeId","data-v-15493547"]]);export{ge as default};
