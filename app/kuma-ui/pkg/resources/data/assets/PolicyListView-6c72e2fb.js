import{d as W,M as j,Y as G,F as H,i as Z}from"./kongponents.es-00e47166.js";import{d as U,o as r,e as _,w as n,g as b,b as t,h as c,a as J,u as X,r as f,c as A,v as ee,a5 as te,E as ae,j as M,i as p,f as P,Y as V,B as C,t as D,F as se,q as le,p as oe,m as ne}from"./index-78b8321a.js";import{_ as ie}from"./PolicyConnections.vue_vue_type_script_setup_true_lang-5d80323e.js";import{D as re}from"./DataOverview-467cd009.js";import{D as ce,a as pe}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-f1ae2cb1.js";import{T as ue}from"./TabsWidget-3315287c.js";import{_ as me}from"./YamlView.vue_vue_type_script_setup_true_lang-554542a0.js";import{u as de}from"./store-554912aa.js";import{u as ye,a as he}from"./index-c3f84c05.js";import{Q as L}from"./QueryParameter-70743f73.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-1292bdd6.js";import"./ErrorBlock-aec5b3c8.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-314c9b25.js";import"./datadogLogEvents-302eea7b.js";import"./TagList-0921b996.js";import"./StatusBadge-3a48e619.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-ce4db486.js";import"./toYaml-4e00099e.js";const ve=U({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(u){const i=u;return(S,x)=>(r(),_(t(j),{class:"docs-link",appearance:"outline",target:"_blank",to:i.href},{default:n(()=>[b(t(W),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),c(`

    Documentation
  `)]),_:1},8,["to"]))}}),_e=u=>(oe("data-v-b02d3602"),u=u(),ne(),u),be={class:"kcard-stack"},ge={class:"kcard-border"},ke=_e(()=>p("p",null,[p("strong",null,"Warning"),c(` This policy is experimental. If you encountered any problem please open an
                  `),p("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),Pe={class:"kcard-border"},we={class:"entity-heading","data-testid":"policy-single-entity"},Te=U({__name:"PolicyListView",props:{selectedPolicyName:{type:[String,null],required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(u){const i=u,S=ye(),x=he(),$=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],q=J(),w=X(),v=de(),T=f(!0),g=f(null),m=f(null),d=f(null),N=f(null),B=f(i.offset),k=f({headers:[{label:"Name",key:"entity"},{label:"Type",key:"type"}],data:[]}),l=A(()=>v.state.policyTypesByPath[i.policyPath]),F=A(()=>v.state.policyTypes.map(e=>({label:e.name,value:e.path,selected:e.path===i.policyPath}))),R=A(()=>v.state.policyTypes.filter(e=>(v.state.sidebar.insights.mesh.policies[e.name]??0)===0).map(e=>e.name));ee(()=>w.params.mesh,function(){w.name===i.policyPath&&E(0)}),z();function z(){l.value!==void 0&&v.dispatch("updatePageTitle",l.value.name),E(i.offset)}async function E(e){var y;B.value=e,L.set("offset",e>0?e:null),T.value=!0,g.value=null;const o=w.params.mesh,s=l.value.path,a=C;try{const{items:h,next:Q}=await S.getAllPolicyEntitiesFromMesh({mesh:o,path:s},{size:a,offset:e});N.value=Q,k.value.data=O(h??[]),await I({name:i.selectedPolicyName??((y=k.value.data[0])==null?void 0:y.entity.name),mesh:o,path:s})}catch(h){k.value.data=[],m.value=null,h instanceof Error?g.value=h:console.error(h)}finally{T.value=!1}}function O(e){return e.map(o=>{const{type:s,name:a}=o,y=v.state.policyTypesByName[s],h={name:"policy-detail-view",params:{mesh:o.mesh,policyPath:y.path,policy:a}};return{entity:o,detailViewRoute:h,type:s}})}async function Y(e){const{name:o,mesh:s}=e,a=l.value.path;await I({name:o,mesh:s,path:a})}async function I({name:e,mesh:o,path:s}){if(e===void 0){m.value=null,d.value=null,L.set("policy",null);return}try{const a=await S.getSinglePolicyEntity({mesh:o,path:s,name:e});m.value=te(a,["type","name","mesh"]),L.set("policy",a.name),d.value=ae(a)}catch(a){console.error(a)}}function K(e){q.push({name:"policy-list-view",params:{...w.params,policyPath:e.value}})}return(e,o)=>{var s;return t(l)?(r(),M("div",{key:0,class:V(["relative",t(l).path])},[p("div",be,[p("div",ge,[t(l).isExperimental?(r(),_(t(H),{key:0,"border-variant":"noBorder",class:"mb-4"},{body:n(()=>[b(t(G),{appearance:"warning"},{alertMessage:n(()=>[ke]),_:1})]),_:1})):P("",!0),c(),b(re,{"selected-entity-name":(s=m.value)==null?void 0:s.name,"page-size":t(C),error:g.value,"is-loading":T.value,"empty-state":{title:"No Data",message:`There are no ${t(l).name} policies present.`},"table-data":k.value,"table-data-is-empty":k.value.data.length===0,next:N.value,"page-offset":B.value,onTableAction:Y,onLoadData:E},{additionalControls:n(()=>[b(t(Z),{label:"Policies",items:t(F),"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:K},{"item-template":n(({item:a})=>[p("span",{class:V({"policy-type-empty":t(R).includes(a.label)})},D(a.label),3)]),_:1},8,["items"]),c(),b(ve,{href:`${t(x)("KUMA_DOCS_URL")}/policies/${t(l).path}/?${t(x)("KUMA_UTM_QUERY_PARAMS")}`,"data-testid":"policy-documentation-link"},null,8,["href"])]),default:n(()=>[c(`
          >
          `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"])]),c(),p("div",Pe,[m.value!==null?(r(),_(ue,{key:0,"has-error":g.value!==null,error:g.value,"is-loading":T.value,tabs:$},{tabHeader:n(()=>[p("h1",we,D(t(l).name)+": "+D(m.value.name),1)]),overview:n(()=>[b(pe,{"data-testid":"policy-detail-label-list"},{default:n(()=>[(r(!0),M(se,null,le(m.value,(a,y)=>(r(),_(ce,{key:y,term:y},{default:n(()=>[c(D(a),1)]),_:2},1032,["term"]))),128))]),_:1}),c(),d.value!==null?(r(),_(me,{key:0,id:"code-block-policy",class:"mt-4",content:d.value,"is-searchable":""},null,8,["content"])):P("",!0)]),"affected-dpps":n(()=>[d.value!==null?(r(),_(ie,{key:0,mesh:d.value.mesh,"policy-name":d.value.name,"policy-type":t(l).path},null,8,["mesh","policy-name","policy-type"])):P("",!0)]),_:1},8,["has-error","error","is-loading"])):P("",!0)])])],2)):P("",!0)}}});const Ye=fe(Te,[["__scopeId","data-v-b02d3602"]]);export{Ye as default};
