import{a as Y,K as L}from"./index-fce48c05.js";import{_ as R,a as h,o as l,b as f,w as a,m as e,r as T,f as t,d as U,c as i,e as r,k as X,t as o,l as s,F as u,C as b,n as Z,G as Q,V as tt,W as k,X as et,p as $,Y as at,$ as st,a0 as nt,B as ot,v as lt,x as rt}from"./index-bbd71513.js";import{E as dt}from"./ErrorBlock-d87f5562.js";import{_ as it}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-7d6086d0.js";import{S as ct}from"./StatusBadge-e869507c.js";import{S as ut}from"./SummaryView-e2b7a7a6.js";import{T as G}from"./TagList-faf8e2a1.js";import{T as O}from"./TextWithCopyButton-a63dc99b.js";import{_ as _t}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-9eca7e2a.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-ad740151.js";import"./CopyButton-83eb3594.js";import"./AccordionList-f1f69b07.js";const pt={},mt={class:"card"},ft={class:"title"},vt={class:"body"};function yt(g,n){const c=h("KCard");return l(),f(c,{class:"data-card"},{default:a(()=>[e("dl",null,[e("div",mt,[e("dt",ft,[T(g.$slots,"title",{},void 0,!0)]),t(),e("dd",vt,[T(g.$slots,"default",{},void 0,!0)])])])]),_:3})}const j=R(pt,[["render",yt],["__scopeId","data-v-6e083223"]]),ht={class:"service-traffic"},gt={class:"actions"},kt=U({__name:"DataPlaneTraffic",setup(g){return(n,c)=>(l(),i("div",ht,[e("div",gt,[T(n.$slots,"actions",{},void 0,!0)]),t(),r(j,{class:"header"},{title:a(()=>[T(n.$slots,"title",{},void 0,!0)]),_:3}),t(),T(n.$slots,"default",{},void 0,!0)]))}});const W=R(kt,[["__scopeId","data-v-5bd1dbf9"]]),bt={class:"title"},xt=U({__name:"ServiceTrafficCard",props:{protocol:{},traffic:{}},setup(g){const{t:n}=X(),c=g,_=C=>{const P=C.target;if(P.nodeName.toLowerCase()!=="a"){const S=P.closest(".service-traffic-card");if(S){const K=S.querySelector("a");K!==null&&K.click()}}};return(C,P)=>{const S=h("KBadge");return l(),f(j,{class:"service-traffic-card",onClick:_},{title:a(()=>[r(S,{appearance:c.protocol==="passthrough"?"success":"info"},{default:a(()=>[t(o(s(n)(`data-planes.components.service_traffic_card.protocol.${c.protocol}`,{},{defaultMessage:s(n)(`http.api.value.${c.protocol}`)})),1)]),_:1},8,["appearance"]),t(),e("div",bt,[T(C.$slots,"default",{},void 0,!0)])]),default:a(()=>{var K,I,D,q,E,M,z,V,N;return[t(),e("dl",null,[c.protocol==="passthrough"?(l(!0),i(u,{key:0},b([["http","tcp"].reduce((v,B)=>{const A="downstream";return Object.entries(c.traffic[B]||{}).reduce((m,[d,y])=>[`${A}_cx_tx_bytes_total`,`${A}_cx_rx_bytes_total`].includes(d)?{...m,[d]:y+(m[d]??0)}:m,v)},{})],(v,B)=>(l(),i(u,{key:B},[e("div",null,[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.tx")),1),t(),e("dd",null,o(s(n)("common.formats.bytes",{value:v.downstream_cx_rx_bytes_total??0})),1)]),t(),e("div",null,[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.rx")),1),t(),e("dd",null,o(s(n)("common.formats.bytes",{value:v.downstream_cx_tx_bytes_total??0})),1)])],64))),128)):c.protocol==="grpc"?(l(),i(u,{key:1},[e("div",null,[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.grpc_success")),1),t(),e("dd",null,o(s(n)("common.formats.integer",{value:((K=c.traffic.grpc)==null?void 0:K.success)??0})),1)]),t(),e("div",null,[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.grpc_failure")),1),t(),e("dd",null,o(s(n)("common.formats.integer",{value:((I=c.traffic.grpc)==null?void 0:I.failure)??0})),1)])],64)):c.protocol==="http"?(l(),i(u,{key:2},[(l(!0),i(u,null,b([((D=c.traffic.http)==null?void 0:D.downstream_rq_1xx)??0].filter(v=>v!==0),v=>(l(),i("div",{key:v},[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.1xx")),1),t(),e("dd",null,o(s(n)("common.formats.integer",{value:v})),1)]))),128)),t(),e("div",null,[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.2xx")),1),t(),e("dd",null,o(s(n)("common.formats.integer",{value:((q=c.traffic.http)==null?void 0:q.downstream_rq_2xx)??0})),1)]),t(),(l(!0),i(u,null,b([((E=c.traffic.http)==null?void 0:E.downstream_rq_3xx)??0].filter(v=>v!==0),v=>(l(),i("div",{key:v},[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.3xx")),1),t(),e("dd",null,o(s(n)("common.formats.integer",{value:v})),1)]))),128)),t(),e("div",null,[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.4xx")),1),t(),e("dd",null,o(s(n)("common.formats.integer",{value:((M=c.traffic.http)==null?void 0:M.downstream_rq_4xx)??0})),1)]),t(),e("div",null,[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.5xx")),1),t(),e("dd",null,o(s(n)("common.formats.integer",{value:((z=c.traffic.http)==null?void 0:z.downstream_rq_5xx)??0})),1)])],64)):(l(),i(u,{key:3},[e("div",null,[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.tx")),1),t(),e("dd",null,o(s(n)("common.formats.bytes",{value:((V=c.traffic.tcp)==null?void 0:V.downstream_cx_rx_bytes_total)??0})),1)]),t(),e("div",null,[e("dt",null,o(s(n)("data-planes.components.service_traffic_card.rx")),1),t(),e("dd",null,o(s(n)("common.formats.bytes",{value:((N=c.traffic.tcp)==null?void 0:N.downstream_cx_tx_bytes_total)??0})),1)])],64))])]}),_:3})}}});const H=R(xt,[["__scopeId","data-v-9d3f1e11"]]),wt={class:"body"},$t=U({__name:"ServiceTrafficGroup",props:{type:{}},setup(g){const n=g;return(c,_)=>{const C=h("KCard");return l(),f(C,{class:Z(["service-traffic-group",`type-${n.type}`])},{default:a(()=>[e("div",wt,[T(c.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}});const F=R($t,[["__scopeId","data-v-baf4abf7"]]),Ct=g=>(lt("data-v-1aa8d39b"),g=g(),rt(),g),It={"data-testid":"dataplane-warnings"},Kt=["data-testid","innerHTML"],Tt={class:"stack","data-testid":"dataplane-details"},St={class:"columns"},Dt={class:"status-with-reason"},Vt={class:"columns"},Bt=Ct(()=>e("span",null,"Outbounds",-1)),Rt={class:"passthrough"},Pt={class:"outbounds"},qt={key:1,"data-testid":"dataplane-inbounds"},Et={class:"inbound-list"},Mt={class:"mt-4 columns"},zt={"data-testid":"dataplane-mtls"},Nt={class:"columns"},At=["innerHTML"],Lt={key:2,"data-testid":"dataplane-subscriptions"},Ot=U({__name:"DataPlaneDetailView",props:{data:{}},setup(g){const{t:n,formatIsoDate:c}=X(),_=g,C=Q(()=>_.data.warnings.concat(..._.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(P,S)=>{const K=h("KTooltip"),I=h("KCard"),D=h("RouterLink"),q=h("KInputSwitch"),E=h("KButton"),M=h("RouterView"),z=h("DataSource"),V=h("KBadge"),N=h("KAlert"),v=h("AppView"),B=h("RouteView");return l(),f(B,{params:{mesh:"",dataPlane:"",service:"",inactive:!1},name:"data-plane-detail-view"},{default:a(({can:A,route:m})=>[r(v,null,tt({default:a(()=>[t(),e("div",Tt,[r(I,null,{default:a(()=>[e("div",St,[r(k,null,{title:a(()=>[t(o(s(n)("http.api.property.status")),1)]),body:a(()=>[e("div",Dt,[r(ct,{status:_.data.status},null,8,["status"]),t(),(l(!0),i(u,null,b([_.data.dataplane.networking.inbounds.filter(d=>!d.health.ready)],d=>(l(),i(u,{key:d},[d.length>0?(l(),f(K,{key:0,class:"reason-tooltip","position-fixed":""},{content:a(()=>[e("ul",null,[(l(!0),i(u,null,b(d,y=>(l(),i("li",{key:`${y.service}:${y.port}`},o(s(n)("data-planes.routes.item.unhealthy_inbound",{service:y.service,port:y.port})),1))),128))])]),default:a(()=>[r(s(et),{color:s(Y),size:s(L),"hide-title":""},null,8,["color","size"]),t()]),_:2},1024)):$("",!0)],64))),128))])]),_:1}),t(),r(k,null,{title:a(()=>[t(o(s(n)("data-planes.routes.item.last_updated")),1)]),body:a(()=>[t(o(s(c)(_.data.modificationTime)),1)]),_:1}),t(),_.data.dataplane.networking.gateway?(l(),i(u,{key:0},[r(k,null,{title:a(()=>[t(o(s(n)("http.api.property.tags")),1)]),body:a(()=>[r(G,{tags:_.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:1}),t(),r(k,null,{title:a(()=>[t(o(s(n)("http.api.property.address")),1)]),body:a(()=>[r(O,{text:`${_.data.dataplane.networking.address}`},null,8,["text"])]),_:1})],64)):$("",!0)])]),_:1}),t(),A("read traffic")&&_.data.dataplaneType==="standard"?(l(),f(z,{key:0,src:`/meshes/${m.params.mesh}/dataplanes/${m.params.dataPlane}/traffic`},{default:a(({data:d,error:y,refresh:J})=>[y?(l(),f(dt,{key:0,error:y},null,8,["error"])):d===void 0?(l(),f(it,{key:1})):(l(),f(I,{key:2,class:"traffic"},{default:a(()=>[e("div",Vt,[r(W,null,{title:a(()=>[r(s(at),{display:"inline-block",decorative:"",size:s(L)},null,8,["size"]),t(`
                  Inbounds
                `)]),data:a(()=>[e("dl",null,[e("div",null,[e("dt",null,o(s(n)("services.components.service_traffic.inbound",{},{defaultMessage:"Requests"})),1),t(),e("dd",null,o(s(n)("common.formats.integer",{value:1e3})),1)])])]),default:a(()=>[t(),t(),r(F,{type:"inbound"},{default:a(()=>[(l(!0),i(u,null,b(d.inbounds,p=>(l(),i(u,{key:`${p.name}`},[(l(!0),i(u,null,b([p.name.split("_").at(-1)],x=>(l(),i(u,{key:x},[(l(!0),i(u,null,b([_.data.dataplane.networking.inbounds.find(w=>`${w.port}`==`${x}`)],w=>(l(),i(u,{key:w},[w?(l(),f(H,{key:0,protocol:p.protocol,traffic:p},{default:a(()=>[r(D,{to:{name:"data-plane-inbound-summary-overview-view",params:{service:w.port},query:{inactive:m.params.inactive?null:void 0}}},{default:a(()=>[t(`
                            :`+o(w.port),1)]),_:2},1032,["to"]),t(),r(G,{tags:[{label:"kuma.io/service",value:w.tags["kuma.io/service"]}]},null,8,["tags"])]),_:2},1032,["protocol","traffic"])):$("",!0)],64))),128))],64))),128))],64))),128))]),_:2},1024)]),_:2},1024),t(),r(W,null,{actions:a(()=>[r(q,{modelValue:m.params.inactive,"onUpdate:modelValue":p=>m.params.inactive=p},{label:a(()=>[t(`
                      Show inactive
                    `)]),_:2},1032,["modelValue","onUpdate:modelValue"]),t(),r(E,{appearance:"primary",onClick:J},{default:a(()=>[r(s(st),{size:s(L)},null,8,["size"]),t(`

                    Refresh
                  `)]),_:2},1032,["onClick"])]),title:a(()=>[r(s(nt),{display:"inline-block",decorative:"",size:s(L)},null,8,["size"]),t(),Bt]),data:a(()=>[e("dl",null,[e("div",null,[e("dt",Rt,o(s(n)("services.components.service_traffic.passthrough",{},{defaultMessage:"Passthrough Requests"})),1),t(),e("dd",null,o(s(n)("common.formats.integer",{value:1e3})),1)]),t(),e("div",null,[e("dt",Pt,o(s(n)("services.components.service_traffic.mesh",{},{defaultMessage:"Mesh Requests"})),1),t(),e("dd",null,o(s(n)("common.formats.integer",{value:1e3})),1)])])]),default:a(()=>[t(),t(),t(),r(F,{type:"passthrough"},{default:a(()=>[r(H,{protocol:"passthrough",traffic:d.passthrough},{default:a(()=>[t(`
                    Non mesh traffic
                  `)]),_:2},1032,["traffic"])]),_:2},1024),t(),d.outbounds.length>0?(l(),f(F,{key:0,type:"outbound"},{default:a(()=>[(l(!0),i(u,null,b(d.outbounds,p=>{var x,w;return l(),i(u,{key:`${p.name}`},[m.params.inactive||((p.protocol==="tcp"?(x=p.tcp)==null?void 0:x.downstream_cx_rx_bytes_total:(w=p.http)==null?void 0:w.downstream_rq_total)??0>0)?(l(),f(H,{key:0,protocol:p.protocol,traffic:p},{default:a(()=>[r(D,{to:{name:"data-plane-outbound-summary-overview-view",params:{service:p.name},query:{inactive:m.params.inactive?null:void 0}}},{default:a(()=>[t(o(p.name),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic"])):$("",!0)],64)}),128))]),_:2},1024)):$("",!0)]),_:2},1024)])]),_:2},1024)),t(),m.params.service&&[d==null?void 0:d.outbounds,_.data.dataplane.networking.inbounds].every(p=>typeof p<"u")?(l(),f(M,{key:3},{default:a(p=>[r(ut,{onClose:function(x){m.replace({name:"data-plane-detail-view",params:{mesh:m.params.mesh,dataPlane:m.params.dataPlane},query:{inactive:m.params.inactive?null:void 0}})}},{default:a(()=>[(l(),f(ot(p.Component),{data:p.route.name==="data-plane-inbound-summary-overview-view"?_.data.dataplane.networking.inbounds.find(x=>`${x.port}`===m.params.service):d.outbounds.find(x=>x.name===m.params.service)},null,8,["data"]))]),_:2},1032,["onClose"])]),_:2},1024)):$("",!0)]),_:2},1032,["src"])):$("",!0),t(),_.data.dataplane.networking.inbounds.length>0?(l(),i("div",qt,[e("h2",null,o(s(n)("data-planes.routes.item.inbounds")),1),t(),r(I,{class:"mt-4"},{default:a(()=>[e("div",Et,[(l(!0),i(u,null,b(_.data.dataplane.networking.inbounds,(d,y)=>(l(),i("div",{key:y,class:"inbound"},[e("h4",null,[r(O,{text:d.tags["kuma.io/service"]},{default:a(()=>[t(o(s(n)("data-planes.routes.item.inbound_name",{service:d.tags["kuma.io/service"]})),1)]),_:2},1032,["text"])]),t(),e("div",Mt,[r(k,null,{title:a(()=>[t(o(s(n)("http.api.property.status")),1)]),body:a(()=>[d.health.ready?(l(),f(V,{key:0,appearance:"success"},{default:a(()=>[t(o(s(n)("data-planes.routes.item.health.ready")),1)]),_:1})):(l(),f(V,{key:1,appearance:"danger"},{default:a(()=>[t(o(s(n)("data-planes.routes.item.health.not_ready")),1)]),_:1}))]),_:2},1024),t(),r(k,null,{title:a(()=>[t(o(s(n)("http.api.property.tags")),1)]),body:a(()=>[r(G,{tags:d.tags},null,8,["tags"])]),_:2},1024),t(),r(k,null,{title:a(()=>[t(o(s(n)("http.api.property.address")),1)]),body:a(()=>[r(O,{text:d.addressPort},null,8,["text"])]),_:2},1024),t(),r(k,null,{title:a(()=>[t(o(s(n)("http.api.property.serviceAddress")),1)]),body:a(()=>[r(O,{text:d.serviceAddressPort},null,8,["text"])]),_:2},1024)])]))),128))])]),_:1})])):$("",!0),t(),e("div",zt,[e("h2",null,o(s(n)("data-planes.routes.item.mtls.title")),1),t(),_.data.dataplaneInsight.mTLS?(l(!0),i(u,{key:0},b([_.data.dataplaneInsight.mTLS],d=>(l(),f(I,{key:d,class:"mt-4"},{default:a(()=>[e("div",Nt,[r(k,null,{title:a(()=>[t(o(s(n)("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:a(()=>[t(o(s(c)(d.certificateExpirationTime)),1)]),_:2},1024),t(),r(k,null,{title:a(()=>[t(o(s(n)("data-planes.routes.item.mtls.generation_time.title")),1)]),body:a(()=>[t(o(s(c)(d.lastCertificateRegeneration)),1)]),_:2},1024),t(),r(k,null,{title:a(()=>[t(o(s(n)("data-planes.routes.item.mtls.regenerations.title")),1)]),body:a(()=>[t(o(s(n)("common.formats.integer",{value:d.certificateRegenerations})),1)]),_:2},1024),t(),r(k,null,{title:a(()=>[t(o(s(n)("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:a(()=>[t(o(d.issuedBackend),1)]),_:2},1024),t(),r(k,null,{title:a(()=>[t(o(s(n)("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:a(()=>[e("ul",null,[(l(!0),i(u,null,b(d.supportedBackends,y=>(l(),i("li",{key:y},o(y),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(l(),f(N,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:a(()=>[e("div",{innerHTML:s(n)("data-planes.routes.item.mtls.disabled")},null,8,At)]),_:1}))]),t(),_.data.dataplaneInsight.subscriptions.length>0?(l(),i("div",Lt,[e("h2",null,o(s(n)("data-planes.routes.item.subscriptions.title")),1),t(),r(I,{class:"mt-4"},{default:a(()=>[r(_t,{subscriptions:_.data.dataplaneInsight.subscriptions},null,8,["subscriptions"])]),_:1})])):$("",!0)])]),_:2},[C.value.length>0?{name:"notifications",fn:a(()=>[e("ul",It,[(l(!0),i(u,null,b(C.value,d=>(l(),i("li",{key:d.kind,"data-testid":`warning-${d.kind}`,innerHTML:s(n)(`common.warnings.${d.kind}`,d.payload)},null,8,Kt))),128)),t()])]),key:"0"}:void 0]),1024)]),_:1})}}});const ee=R(Ot,[["__scopeId","data-v-1aa8d39b"]]);export{ee as default};
