import{l as Z,S as F,U as W,Z as j,h as G}from"./kongponents.es-6a217637.js";import{d as I,o as _,a as P,w as i,h as r,b as t,g as d,u as H,D as Y,q as m,c as b,s as J,e as X,k as y,f as x,P as L,H as U,t as ee,p as ae,m as te}from"./index-57976cc5.js";import{_ as se}from"./PolicyDetails.vue_vue_type_script_setup_true_lang-8a9c227c.js";import{l as le,j as oe,f as ne,k as ie,g as re,_ as ce,h as pe}from"./RouteView.vue_vue_type_script_setup_true_lang-d5ea41b6.js";import{_ as ue}from"./RouteTitle.vue_vue_type_script_setup_true_lang-a5e4ade2.js";import{D as me}from"./DataOverview-0c95570c.js";import{Q as $}from"./QueryParameter-70743f73.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-a9c726fa.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-5da94dd3.js";import"./ErrorBlock-0aaa3aac.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-0bdb3742.js";import"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-af4c3454.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-c75dfa2e.js";import"./TextWithCopyButton-720b5192.js";import"./toYaml-4e00099e.js";import"./TabsWidget-5675fe60.js";import"./TagList-65d7505c.js";import"./StatusBadge-a387954c.js";const de=I({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(l){const a=l;return(k,N)=>(_(),P(t(F),{class:"docs-link",appearance:"outline",target:"_blank",to:a.href},{default:i(()=>[r(t(Z),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),d(`

    Documentation
  `)]),_:1},8,["to"]))}}),ye=l=>(ae("data-v-290f5505"),l=l(),te(),l),he={class:"kcard-stack"},fe={class:"kcard-border"},_e=ye(()=>y("p",null,[y("strong",null,"Warning"),d(` This policy is experimental. If you encountered any problem please open an
                      `),y("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),ve=I({__name:"PolicyListView",props:{selectedPolicyName:{type:[String,null],required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(l){const a=l,k=le(),N=oe(),o=H(),V=Y(),n=ne(),{t:B}=ie(),T=m(!0),w=m(null),D=m(null),A=m(a.offset),v=m(a.selectedPolicyName),h=m({headers:[{label:"Name",key:"entity"},{label:"Type",key:"type"}],data:[]}),C=b(()=>o.params.mesh),s=b(()=>n.state.policyTypesByPath[a.policyPath]),M=b(()=>n.state.policyTypes.map(e=>({label:e.name,value:e.path,selected:e.path===a.policyPath}))),q=b(()=>n.state.policyTypes.filter(e=>(n.state.sidebar.insights.mesh.policies[e.name]??0)===0).map(e=>e.name));J(()=>o.params.mesh,function(){o.name===a.policyPath&&S(0)}),R();async function R(){const e=n.state.policyTypesByPath[a.policyPath];e!==void 0&&(await n.dispatch("updatePageTitle",""),await n.dispatch("updatePageTitle",e.name)),S(a.offset)}async function S(e){var g;A.value=e,$.set("offset",e>0?e:null),T.value=!0,w.value=null;const c=o.params.mesh,p=o.params.policyPath,u=L;try{const{items:f,next:Q}=await N.getAllPolicyEntitiesFromMesh({mesh:c,path:p},{size:u,offset:e});D.value=Q,h.value.data=z(f??[]),E({name:a.selectedPolicyName??((g=h.value.data[0])==null?void 0:g.entity.name)})}catch(f){h.value.data=[],f instanceof Error?w.value=f:console.error(f)}finally{T.value=!1}}function z(e){return e.map(c=>{const{type:p,name:u}=c,g={name:"policy-detail-view",params:{mesh:c.mesh,policyPath:o.params.policyPath,policy:u}};return{entity:c,detailViewRoute:g,type:p}})}function K(e){E({name:e.name})}function E({name:e}){v.value=e??null,$.set("policy",e??null)}function O(e){V.push({name:"policies-list-view",params:{...o.params,policyPath:e.value}})}return(e,c)=>(_(),P(ce,{module:"policies"},{default:i(()=>{var p;return[r(ue,{title:t(B)("policies.routes.items.title",{name:(p=s.value)==null?void 0:p.name})},null,8,["title"]),d(),r(re,null,{default:i(()=>[s.value?(_(),X("div",{key:0,class:U(["relative",s.value.path])},[y("div",he,[y("div",fe,[s.value.isExperimental?(_(),P(t(W),{key:0,"border-variant":"noBorder",class:"mb-4"},{body:i(()=>[r(t(j),{appearance:"warning"},{alertMessage:i(()=>[_e]),_:1})]),_:1})):x("",!0),d(),r(me,{"selected-entity-name":v.value??void 0,"page-size":t(L),error:w.value,"is-loading":T.value,"empty-state":{title:"No Data",message:`There are no ${s.value.name} policies present.`},"table-data":h.value,"table-data-is-empty":h.value.data.length===0,next:D.value,"page-offset":A.value,onTableAction:K,onLoadData:S},{additionalControls:i(()=>[r(t(G),{label:"Policies",items:M.value,"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:O},{"item-template":i(({item:u})=>[y("span",{class:U({"policy-type-empty":q.value.includes(u.label)})},ee(u.label),3)]),_:1},8,["items"]),d(),r(de,{href:`${t(k)("KUMA_DOCS_URL")}/policies/${s.value.path}/?${t(k)("KUMA_UTM_QUERY_PARAMS")}`,"data-testid":"policy-documentation-link"},null,8,["href"])]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"])]),d(),v.value!==null?(_(),P(se,{key:0,name:v.value,mesh:C.value,path:s.value.path,type:s.value.name},null,8,["name","mesh","path","type"])):x("",!0)])],2)):x("",!0)]),_:1})]}),_:1}))}});const Ce=pe(ve,[["__scopeId","data-v-290f5505"]]);export{Ce as default};
