import{d as B,S as N,W as T,K as A,k as R}from"./kongponents.es-32169022.js";import{d as $,q as P,s as z,A as F,o as l,e as E,n as W,g as h,F as I,k as d,a as f,w as n,h as c,b as a,u as j,L as K,j as M,f as L,P as U,x as D,t as C,p as G,m as O}from"./index-231ca628.js";import{_ as Z}from"./PolicyDetails.vue_vue_type_script_setup_true_lang-434c43ce.js";import{M as H,j as J,i as Q,f as X,_ as Y,g as ee}from"./RouteView.vue_vue_type_script_setup_true_lang-ed887f62.js";import{_ as ae}from"./RouteTitle.vue_vue_type_script_setup_true_lang-9b835b14.js";import{D as te}from"./DataOverview-9a5c1552.js";import{_ as oe}from"./EmptyBlock.vue_vue_type_script_setup_true_lang-2ab70067.js";import{E as se}from"./ErrorBlock-0f3c57b7.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-2ea01004.js";import"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-fd5e1c64.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-65286b52.js";import"./TextWithCopyButton-289007e3.js";import"./TabsWidget-2ad3bb32.js";import"./QueryParameter-70743f73.js";import"./TagList-3247a166.js";import"./StatusBadge-1ef51ddb.js";const re=d("span",null,null,-1),q=$({__name:"DataSource",props:{src:{type:String,required:!0}},emits:["change","error"],setup(m,{emit:s}){const u=m,v=H(),g=P(void 0),_=P(void 0);let t={};const i=Symbol(""),y=async e=>{if(t=k(t),t.src=e,e==="")return;t.controller=new AbortController;const r=v.source(e,i);r.addEventListener("message",b=>{g.value=b.data,s("change",g.value)},{signal:t.controller.signal}),r.addEventListener("error",b=>{_.value=b.error,s("error",_.value)},{signal:t.controller.signal})},k=e=>(typeof e.controller<"u"&&e.controller.abort(),typeof e.src<"u"&&v.close(e.src,i),{});z(()=>u.src,e=>y(e),{immediate:!0}),F(()=>{t=k(t)});const w=()=>{y(u.src)};return(e,r)=>(l(),E(I,null,[W(e.$slots,"default",{data:g.value,error:_.value,refresh:w}),h(),re],64))}}),ne=$({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(m){const s=m;return(u,v)=>(l(),f(a(N),{class:"docs-link",appearance:"outline",target:"_blank",to:s.href},{default:n(()=>[c(a(B),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),h(`

    Documentation
  `)]),_:1},8,["to"]))}}),le=m=>(G("data-v-efee80b2"),m=m(),O(),m),ie={class:"kcard-stack"},pe={class:"kcard-border"},ce=le(()=>d("p",null,[d("strong",null,"Warning"),h(` This policy is experimental. If you encountered any problem please open an
                              `),d("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),me=$({__name:"PolicyListView",setup(m){const s=j(),u=K(),{t:v}=J(),g=function(_){_.items.length>0&&!s.query.policy&&u.push({name:"policies-list-view",query:{policy:_.items[0].name}})};return(_,t)=>(l(),f(Y,null,{default:n(({route:i})=>[c(q,{src:"/*/policy-types"},{default:n(({data:y,error:k,refresh:w})=>[k?(l(),f(se,{key:0,error:k},null,8,["error"])):y===void 0?(l(),f(Q,{key:1})):y.policies.length===0?(l(),f(oe,{key:2})):(l(!0),E(I,{key:3},M([y.policies.find(e=>e.path===i.params.policyPath)??y.policies[0]],e=>(l(),f(q,{key:e.path,src:`/${i.params.mesh}/policy-type/${e.path}?offset=${a(s).query.offset||"0"}`,onChange:g},{default:n(({data:r,error:b,refresh:V})=>[c(ae,{title:a(v)("policies.routes.items.title",{name:e.name})},null,8,["title"]),h(),c(X,null,{default:n(()=>[d("div",{class:D(["relative",e.path])},[d("div",ie,[d("div",pe,[e.isExperimental?(l(),f(a(T),{key:0,"border-variant":"noBorder",class:"mb-4"},{body:n(()=>[c(a(A),{appearance:"warning"},{alertMessage:n(()=>[ce]),_:1})]),_:1})):L("",!0),h(),c(te,{"selected-entity-name":a(s).query.policy??void 0,"page-size":a(U),error:b,"is-loading":typeof r>"u"&&typeof b>"u","empty-state":{title:"No Data",message:`There are no ${e.name} policies present.`},"table-data":{headers:[{label:"Name",key:"entity"},{label:"Type",key:"type"}],data:((r==null?void 0:r.items)||[]).map(o=>({entity:o,type:o.type,detailViewRoute:{name:"policy-detail-view",params:{mesh:o.mesh,policyPath:i.params.policyPath,policy:o.name}}}))},"table-data-is-empty":r&&r.items.length===0,next:r==null?void 0:r.next,"page-offset":a(s).query.offset?parseInt(a(s).query.offset):0,onTableAction:t[1]||(t[1]=o=>{a(u).push({name:"policies-list-view",query:{policy:o.name}})}),onRefresh:()=>{V(),w()},onLoadData:t[2]||(t[2]=o=>{a(u).push({name:"policies-list-view",query:{policy:a(s).query.policy,offset:o}})})},{additionalControls:n(()=>[c(q,{src:`/${i.params.mesh}/insights`},{default:n(({data:o})=>[c(a(R),{label:"Policies",items:y.policies.map(p=>({label:p.name,value:p.path,selected:p.path===i.params.policyPath})),"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:t[0]||(t[0]=p=>a(u).push({name:"policies-list-view",params:{...a(s).params,policyPath:p.value}}))},{"item-template":n(({item:p})=>{var x,S;return[d("span",{class:D({"policy-type-empty":!((x=o==null?void 0:o.policies[p.label])!=null&&x.total)})},C(p.label)+" ("+C(((S=o==null?void 0:o.policies[p.label])==null?void 0:S.total)||"0")+`)
                              `,3)]}),_:2},1032,["items"])]),_:2},1032,["src"]),h(),c(ne,{href:a(v)("policies.href.docs",{name:e.name}),"data-testid":"policy-documentation-link"},null,8,["href"])]),_:2},1032,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset","onRefresh"])]),h(),a(s).query.policy?(l(),f(Z,{key:0,name:a(s).query.policy,mesh:i.params.mesh,path:e.path,type:e.name},null,8,["name","mesh","path","type"])):L("",!0)])],2)]),_:2},1024)]),_:2},1032,["src"]))),128))]),_:2},1024)]),_:1}))}});const Le=ee(me,[["__scopeId","data-v-efee80b2"]]);export{Le as default};
