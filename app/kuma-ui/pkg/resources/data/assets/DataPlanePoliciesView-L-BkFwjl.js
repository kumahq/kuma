import{A as j,a as x}from"./AccordionList-vIWJe12F.js";import{d as K,a as f,o as e,c as a,m as o,f as s,F as r,E as v,t as i,e as m,w as l,p as B,b as n,a1 as D,x as q,y as H,_ as G,I as W,q as R,l as Y,n as X,S as O}from"./index-SjblyAD_.js";import{C as J}from"./CodeBlock-8RNyIist.js";import{P as Q}from"./PolicyTypeTag-35RzyH0P.js";import{T as z}from"./TagList-DnbGyPUs.js";import{t as U}from"./toYaml-sPaYOD3i.js";import{E as F}from"./ErrorBlock-Wlm-O4Aq.js";import{_ as V}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-aHCbVa36.js";import"./uniqueId-8UY6iQFp.js";import"./index-FZCiQto1.js";import"./TextWithCopyButton-xouz8GNx.js";import"./CopyButton-vLkq-cX5.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-nRtoLqYV.js";const C=_=>(q("data-v-f3e7afbb"),_=_(),H(),_),Z={class:"policies-list"},E={class:"mesh-gateway-policy-list"},ee=C(()=>o("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),te={key:0},ae=C(()=>o("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),se=C(()=>o("b",null,"Host",-1)),le=C(()=>o("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),ne={class:"dataplane-policy-header"},oe=C(()=>o("b",null,"Route",-1)),ie=C(()=>o("b",null,"Service",-1)),ce={key:0,class:"badge-list"},re={class:"mt-1"},pe=K({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},policyTypesByName:{}},setup(_){const d=_;return(c,w)=>{const k=f("RouterLink"),h=f("KBadge");return e(),a("div",Z,[o("div",E,[ee,s(),c.gatewayDataplane.routePolicies.length>0?(e(),a("ul",te,[(e(!0),a(r,null,v(c.gatewayDataplane.routePolicies,(y,g)=>(e(),a("li",{key:g},[o("span",null,i(y.type),1),s(`:

          `),m(k,{to:{name:"policy-detail-view",params:{mesh:y.mesh,policyPath:d.policyTypesByName[y.type].path,policy:y.name}}},{default:l(()=>[s(i(y.name),1)]),_:2},1032,["to"])]))),128))])):B("",!0),s(),ae,s(),o("div",null,[(e(!0),a(r,null,v(c.gatewayDataplane.listenerEntries,(y,g)=>(e(),a("div",{key:g},[o("div",null,[o("div",null,[se,s(": "+i(y.hostName)+":"+i(y.port)+" ("+i(y.protocol)+`)
            `,1)]),s(),y.routeEntries.length>0?(e(),a(r,{key:0},[le,s(),m(x,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),a(r,null,v(y.routeEntries,(p,b)=>(e(),n(j,{key:b},D({"accordion-header":l(()=>[o("div",ne,[o("div",null,[o("div",null,[oe,s(": "),m(k,{to:{name:"policy-detail-view",params:{mesh:p.route.mesh,policyPath:d.policyTypesByName[p.route.type].path,policy:p.route.name}}},{default:l(()=>[s(i(p.route.name),1)]),_:2},1032,["to"])]),s(),o("div",null,[ie,s(": "+i(p.service),1)])]),s(),p.origins.length>0?(e(),a("div",ce,[(e(!0),a(r,null,v(p.origins,(t,u)=>(e(),n(h,{key:`${g}-${u}`},{default:l(()=>[s(i(t.type),1)]),_:2},1024))),128))])):B("",!0)])]),_:2},[p.origins.length>0?{name:"accordion-content",fn:l(()=>[o("ul",re,[(e(!0),a(r,null,v(p.origins,(t,u)=>(e(),a("li",{key:`${g}-${u}`},[s(i(t.type)+`:

                        `,1),m(k,{to:{name:"policy-detail-view",params:{mesh:t.mesh,policyPath:d.policyTypesByName[t.type].path,policy:t.name}}},{default:l(()=>[s(i(t.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):B("",!0)])]))),128))])])])}}}),ue=G(pe,[["__scopeId","data-v-f3e7afbb"]]),de={class:"policy-type-heading"},ye={class:"policy-list"},me={key:0},_e=K({__name:"PolicyTypeEntryList",props:{id:{},policyTypeEntries:{},policyTypesByName:{}},setup(_){const d=_,c=W(()=>d.policyTypeEntries.filter(k=>{var h;return((h=d.policyTypesByName[k.type])==null?void 0:h.isTargetRefBased)===!1}));function w({headerKey:k}){return{class:`cell-${k}`}}return(k,h)=>{const y=f("RouterLink"),g=f("KTable");return e(),n(x,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),a(r,null,v(c.value,(p,b)=>(e(),n(j,{key:b},{"accordion-header":l(()=>[o("h3",de,[m(Q,{"policy-type":p.type},{default:l(()=>[s(i(p.type)+" ("+i(p.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":l(()=>[o("div",ye,[m(g,{class:"policy-type-table",fetcher:()=>({data:p.connections,total:p.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":w,"disable-pagination":"","is-clickable":""},{sourceTags:l(({row:t})=>[t.sourceTags.length>0?(e(),n(z,{key:0,class:"tag-list","should-truncate":"",tags:t.sourceTags},null,8,["tags"])):(e(),a(r,{key:1},[s(`
                —
              `)],64))]),destinationTags:l(({row:t})=>[t.destinationTags.length>0?(e(),n(z,{key:0,class:"tag-list","should-truncate":"",tags:t.destinationTags},null,8,["tags"])):(e(),a(r,{key:1},[s(`
                —
              `)],64))]),name:l(({row:t})=>[t.name!==null?(e(),a(r,{key:0},[s(i(t.name),1)],64)):(e(),a(r,{key:1},[s(`
                —
              `)],64))]),origins:l(({row:t})=>[t.origins.length>0?(e(),a("ul",me,[(e(!0),a(r,null,v(t.origins,(u,$)=>(e(),a("li",{key:`${b}-${$}`},[m(y,{to:{name:"policy-detail-view",params:{mesh:u.mesh,policyPath:d.policyTypesByName[u.type].path,policy:u.name}}},{default:l(()=>[s(i(u.name),1)]),_:2},1032,["to"])]))),128))])):(e(),a(r,{key:1},[s(`
                —
              `)],64))]),config:l(({row:t,rowKey:u})=>[t.config?(e(),n(J,{key:0,id:`${d.id}-${b}-${u}-code-block`,code:R(U)(t.config),language:"yaml","show-copy-button":!1},null,8,["id","code"])):(e(),a(r,{key:1},[s(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}}),he=G(_e,[["__scopeId","data-v-e09f94c7"]]),ge=_=>(q("data-v-2b6b806e"),_=_(),H(),_),ke={class:"policy-type-heading"},fe={class:"policy-list"},be={key:0,class:"matcher"},$e={key:0,class:"matcher__and"},ve=ge(()=>o("br",null,null,-1)),Te={key:1,class:"matcher__not"},Re={class:"matcher__term"},Be={key:1},we={key:0},Pe=K({__name:"RuleEntryList",props:{id:{},ruleEntries:{},policyTypesByName:{},showMatchers:{type:Boolean,default:!0}},setup(_){const{t:d}=Y(),c=_;function w({headerKey:k}){return{class:`cell-${k}`}}return(k,h)=>{const y=f("RouterLink"),g=f("KTable");return e(),n(x,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),a(r,null,v(c.ruleEntries,(p,b)=>(e(),n(j,{key:b},{"accordion-header":l(()=>[o("h3",ke,[m(Q,{"policy-type":p.type},{default:l(()=>[s(i(p.type),1)]),_:2},1032,["policy-type"])])]),"accordion-content":l(()=>[o("div",fe,[m(g,{class:X(["policy-type-table",{"has-matchers":c.showMatchers}]),fetcher:()=>({data:p.rules,total:p.rules.length}),headers:[...c.showMatchers?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}],"cell-attrs":w,"disable-pagination":""},D({origins:l(({row:t})=>[t.origins.length>0?(e(),a("ul",we,[(e(!0),a(r,null,v(t.origins,(u,$)=>(e(),a("li",{key:`${b}-${$}`},[m(y,{to:{name:"policy-detail-view",params:{mesh:u.mesh,policyPath:c.policyTypesByName[u.type].path,policy:u.name}}},{default:l(()=>[s(i(u.name),1)]),_:2},1032,["to"])]))),128))])):(e(),a(r,{key:1},[s(i(R(d)("common.collection.none")),1)],64))]),config:l(({row:t,rowKey:u})=>[t.config?(e(),n(J,{key:0,id:`${c.id}-${b}-${u}-code-block`,code:R(U)(t.config),language:"yaml","show-copy-button":!1},null,8,["id","code"])):(e(),a(r,{key:1},[s(i(R(d)("common.collection.none")),1)],64))]),_:2},[c.showMatchers?{name:"matchers",fn:l(({row:t})=>[t.matchers&&t.matchers.length>0?(e(),a("span",be,[(e(!0),a(r,null,v(t.matchers,({key:u,value:$,not:P},T)=>(e(),a(r,{key:T},[T>0?(e(),a("span",$e,[s(" and"),ve])):B("",!0),P?(e(),a("span",Te,"!")):B("",!0),o("span",Re,i(`${u}:${$}`),1)],64))),128))])):(e(),a("i",Be,i(R(d)("data-planes.routes.item.matches_everything")),1))]),key:"0"}:void 0]),1032,["class","fetcher","headers"])])]),_:2},1024))),128))]),_:1})}}}),M=G(Pe,[["__scopeId","data-v-2b6b806e"]]),Ne={class:"stack"},Ce={class:"mb-2"},Le=K({__name:"StandardDataplanePolicies",props:{inspectRulesForDataplane:{},policyTypesByName:{}},setup(_){const{t:d}=Y(),c=_;return(w,k)=>{const h=f("KCard");return e(),a("div",Ne,[c.inspectRulesForDataplane.proxyRules.length>0?(e(),n(h,{key:0},{default:l(()=>[o("h3",null,i(R(d)("data-planes.routes.item.proxy_rule")),1),s(),m(M,{id:"proxy-rules",class:"mt-2","rule-entries":c.inspectRulesForDataplane.proxyRules,"policy-types-by-name":c.policyTypesByName,"show-matchers":!1,"data-testid":"proxy-rule-list"},null,8,["rule-entries","policy-types-by-name"])]),_:1})):B("",!0),s(),c.inspectRulesForDataplane.toRules.length>0?(e(),n(h,{key:1},{default:l(()=>[o("h3",null,i(R(d)("data-planes.routes.item.to_rules")),1),s(),m(M,{id:"to-rules",class:"mt-2","rule-entries":c.inspectRulesForDataplane.toRules,"policy-types-by-name":c.policyTypesByName,"data-testid":"to-rule-list"},null,8,["rule-entries","policy-types-by-name"])]),_:1})):B("",!0),s(),c.inspectRulesForDataplane.fromRuleInbounds.length>0?(e(),n(h,{key:2},{default:l(()=>[o("h3",Ce,i(R(d)("data-planes.routes.item.from_rules")),1),s(),(e(!0),a(r,null,v(c.inspectRulesForDataplane.fromRuleInbounds,(y,g)=>(e(),a("div",{key:g},[o("h4",null,i(R(d)("data-planes.routes.item.port",{port:y.port})),1),s(),m(M,{id:`from-rules-${g}`,class:"mt-2","rule-entries":y.ruleEntries,"policy-types-by-name":c.policyTypesByName,"data-testid":`from-rule-list-${g}`},null,8,["id","rule-entries","policy-types-by-name","data-testid"])]))),128))]),_:1})):B("",!0)])}}}),Ie={class:"stack"},He=K({__name:"DataPlanePoliciesView",props:{data:{}},setup(_){const d=_;return(c,w)=>{const k=f("RouteTitle"),h=f("DataSource"),y=f("KCard"),g=f("AppView"),p=f("RouteView");return e(),n(p,{name:"data-plane-policies-view",params:{mesh:"",dataPlane:""}},{default:l(({can:b,route:t,t:u})=>[m(g,null,{title:l(()=>[o("h2",null,[m(k,{title:u("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"])])]),default:l(()=>[s(),o("div",Ie,[m(h,{src:"/*/policy-types"},{default:l(({data:$,error:P})=>[m(h,{src:`/meshes/${t.params.mesh}/dataplanes/${t.params.dataPlane}/rules`},{default:l(({data:T,error:L})=>[P?(e(),n(F,{key:0,error:P},null,8,["error"])):L?(e(),n(F,{key:1,error:L},null,8,["error"])):$===void 0||T===void 0?(e(),n(V,{key:2})):T.rules.length===0?(e(),n(O,{key:3})):(e(),n(Le,{key:4,"policy-types-by-name":$.policies.reduce((N,I)=>Object.assign(N,{[I.name]:I}),{}),"inspect-rules-for-dataplane":T,"data-testid":"rules-based-policies"},null,8,["policy-types-by-name","inspect-rules-for-dataplane"]))]),_:2},1032,["src"]),s(),b("use zones")?B("",!0):(e(),n(h,{key:0,src:d.data.dataplaneType!=="builtin"?`/meshes/${t.params.mesh}/dataplanes/${t.params.dataPlane}/sidecar-dataplane-policies`:""},{default:l(({data:T,error:L})=>[m(h,{src:d.data.dataplaneType==="builtin"?`/meshes/${t.params.mesh}/dataplanes/${t.params.dataPlane}/gateway-dataplane-policies`:""},{default:l(({data:N,error:I})=>[o("div",null,[o("h3",null,i(u("data-planes.routes.item.legacy_policies")),1),s(),P?(e(),n(F,{key:0,error:P},null,8,["error"])):L?(e(),n(F,{key:1,error:L},null,8,["error"])):I?(e(),n(F,{key:2,error:I},null,8,["error"])):$===void 0?(e(),n(V,{key:3})):d.data.dataplaneType==="builtin"?(e(),a(r,{key:4},[N===void 0?(e(),n(V,{key:0})):N.routePolicies.length===0&&N.listenerEntries.length===0?(e(),n(O,{key:1})):(e(),n(y,{key:2,class:"mt-4"},{default:l(()=>[m(ue,{"policy-types-by-name":$.policies.reduce((A,S)=>Object.assign(A,{[S.name]:S}),{}),"gateway-dataplane":N,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["policy-types-by-name","gateway-dataplane"])]),_:2},1024))],64)):(e(),a(r,{key:5},[T===void 0?(e(),n(V,{key:0})):T.policyTypeEntries.length===0?(e(),n(O,{key:1})):(e(),n(y,{key:2,class:"mt-4"},{default:l(()=>[m(he,{id:"policies","policy-type-entries":T.policyTypeEntries,"policy-types-by-name":$.policies.reduce((A,S)=>Object.assign(A,{[S.name]:S}),{}),"data-testid":"sidecar-dataplane-policies"},null,8,["policy-type-entries","policy-types-by-name"])]),_:2},1024))],64))])]),_:2},1032,["src"])]),_:2},1032,["src"]))]),_:2},1024)])]),_:2},1024)]),_:1})}}});export{He as default};
