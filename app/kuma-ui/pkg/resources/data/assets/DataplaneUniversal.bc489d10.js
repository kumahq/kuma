import{_ as C,o as c,c as T,w as l,f as e,E as F,r as v,a5 as V,Y as K,cS as f,K as B,e as D,a as i,t as k,g as p,cI as S,F as b,h as N,b as u,cT as P,v as _,n as I}from"./index.04875eef.js";import{j as z}from"./index.58caa11d.js";import{k as W}from"./configUrl.b3f5cf10.js";import{C as G}from"./CodeBlock.58f32651.js";import{F as O,S as j,E as q}from"./EntityScanner.0988384f.js";import{E as H}from"./EnvironmentSwitcher.ebc4efbf.js";import"./_commonjsHelpers.712cc82f.js";const Y={},R=e("a",null,"?",-1);function L(n,t,s,h,a,r){const m=v("KPop");return c(),T(m,{trigger:"hover",class:"help-icon"},{content:l(()=>[e("div",null,[F(n.$slots,"default")])]),default:l(()=>[R]),_:3})}const Z=C(Y,[["render",L]]),J={type:"Dataplane",mesh:null,name:null,networking:{}},Q={name:"DataplaneWizardUniversal",components:{CodeBlock:G,FormFragment:O,StepSkeleton:j,EnvironmentSwitcher:H,HelperTooltip:Z,EntityScanner:q},data(){return{productName:V,randString:Math.random().toString(36).substring(2,8),schema:J,steps:[{label:"General",slug:"general"},{label:"Topology",slug:"topology"},{label:"Networking",slug:"networking"},{label:"Install",slug:"complete"}],tabs:[{hash:"#universal",title:"Universal"}],sidebarContent:[{name:"dataplane"},{name:"example"},{name:"switch"}],startScanner:!1,scanFound:!1,hideScannerSiblings:!1,scanError:!1,isComplete:!1,validate:{meshName:"",univDataplaneType:"dataplane-type-service",univDataplaneServiceName:"",univDataplaneId:"",univDataplaneCustomIdDisabled:!0,univDataplaneNetworkAddress:null,univDataplaneNetworkServicePort:null,univDataplaneNetworkServiceAddress:"127.0.0.1",univDataplaneNetworkDPPort:null,univDataplaneNetworkProtocol:"tcp"},formFields:{protocols:["tcp","http","grpc"]}}},computed:{...K({title:"config/getTagline",version:"config/getVersion",environment:"config/getEnvironment",meshes:"getMeshList"}),getDataplaneSchema(){const n=Object.assign({},this.schema),{meshName:t,univDataplaneType:s,univDataplaneServiceName:h,univDataplaneId:a,univDataplaneNetworkAddress:r,univDataplaneNetworkServicePort:m,univDataplaneNetworkServiceAddress:d,univDataplaneNetworkDPPort:g,univDataplaneNetworkProtocol:w}=this.validate;if(!!t)return n.name=a,n.mesh=t,s==="dataplane-type-service"?(n.networking.gateway&&delete n.networking.gateway,n.networking={address:r,inbound:[{port:g,servicePort:m,serviceAddress:d,tags:{"kuma.io/service":h,"kuma.io/protocol":w}}]}):s==="dataplane-type-gateway"&&(n.networking.inbound&&delete n.networking.inbound,n.networking={address:r,gateway:{tags:{"kuma.io/service":h}}}),n},generateDpTokenCodeOutput(){const{univDataplaneId:n}=this.validate;return`kumactl generate dataplane-token --name=${n} > kuma-token-${n}`},startDpCodeOutput(){const{univDataplaneId:n}=this.validate;return`kuma-dp run \\
      --cp-address=${W()} \\
      --dataplane=${`"${z(this.getDataplaneSchema)}"`} \\
      --dataplane-token-file=kuma-token-${n}`},nextDisabled(){const{meshName:n,univDataplaneServiceName:t,univDataplaneId:s,univDataplaneNetworkAddress:h,univDataplaneNetworkServicePort:a,univDataplaneNetworkDPPort:r,univDataplaneNetworkProtocol:m}=this.validate;return n.length?this.$route.query.step==="1"?!(t&&s):this.$route.query.step==="2"?!(h&&a&&r&&m):!1:!0}},watch:{"validate.univDataplaneId"(n){this.validate.univDataplaneId=f(n)},"validate.univDataplaneServiceName"(n){const t=f(n);this.validate.univDataplaneServiceName=t,this.validate.univDataplaneServiceName===""?this.validate.univDataplaneId="":this.validate.univDataplaneId=f(`${n}-${this.randString}`)},"validate.univDataplaneNetworkServicePort"(n){const t=n.replace(/[a-zA-Z]*$/g,"").trim();this.validate.univDataplaneNetworkServicePort=t},"validate.univDataplaneNetworkDPPort"(n){const t=n.replace(/[a-zA-Z]*$/g,"").trim();this.validate.univDataplaneNetworkDPPort=t}},methods:{hideSiblings(){this.hideScannerSiblings=!0},scanForEntity(){const{meshName:n,univDataplaneId:t}=this.validate;this.scanComplete=!1,this.scanError=!1,!(!n||!t)&&B.getDataplaneFromMesh({mesh:n,name:t}).then(s=>{var h;((h=s==null?void 0:s.name)==null?void 0:h.length)>0?(this.isRunning=!0,this.scanFound=!0):this.scanError=!0}).catch(s=>{this.scanError=!0,console.error(s)}).finally(()=>{this.scanComplete=!0})},compeleteDataPlaneSetup(){this.$store.dispatch("updateSelectedMesh",this.validate.meshName),this.$router.push({name:"data-plane-list-view",params:{mesh:this.validate.meshName}})}}},X={class:"wizard"},$={class:"wizard__content"},ee=e("h3",null," Create Universal Dataplane ",-1),te=e("h3",null," To get started, please select on what Mesh you would like to add the Dataplane: ",-1),ae=e("p",null," If you've got an existing Mesh that you would like to associate with your Dataplane, you can select it below, or create a new one using our Mesh Wizard. ",-1),ne=e("small",null,"Would you like to see instructions for Kubernetes? Use sidebar to change wizard!",-1),le=e("option",{disabled:"",value:""}," Select an existing Mesh\u2026 ",-1),oe=["value"],ie=e("label",{class:"k-input-label mr-4"}," or ",-1),se=e("h3",null," Setup Dataplane Mode ",-1),re=e("p",null," You can create a data plane for a service or a data plane for a Gateway. ",-1),de={for:"service-dataplane"},ue=e("span",null," Service Dataplane ",-1),pe={for:"gateway-dataplane"},ce=e("span",null," Gateway Dataplane ",-1),ve=["disabled"],he=e("h3",null," Networking ",-1),me=e("p",null," It's time to now configure the networking settings so that the Dataplane can connect to the local service, and other data planes can consume your service. ",-1),we=e("p",null,[e("strong",null,"All fields below are required to proceed.")],-1),De=["value","selected"],ke={key:0},_e={key:0},ge=e("h3",null," Auto-Inject DPP ",-1),fe=e("h4",null,"Generate Dataplane Token",-1),ye=e("h4",null,"Start Dataplane Process",-1),Se=e("h3",null,"Searching\u2026",-1),be=e("p",null,"We are looking for your dataplane.",-1),Ne=e("h3",null,"Done!",-1),Pe={key:0},Ie=e("p",null," Proceed to the next step where we will show you your new Dataplane. ",-1),Ce=e("h3",null,"Dataplane not found",-1),Te=e("p",null,"We were unable to find your dataplane.",-1),Ee=e("p",null," Please return to the first step and make sure to select an existing Mesh, or create a new one. ",-1),xe=e("h3",null,"Dataplane",-1),Ae=e("h3",null,"Example",-1),Me=e("p",null," Below is an example of a Dataplane resource output: ",-1),Ue=e("code",{class:"block"},[e("pre",null,`type: Dataplane
mesh: default
name: dp-echo-1
networking:
  address: 10.0.0.1
  inbound:
  - port: 10000
    servicePort: 9000
    tags:
      kuma.io/service: echo`)],-1);function Fe(n,t,s,h,a,r){const m=v("KButton"),d=v("FormFragment"),g=v("KCard"),w=v("HelperTooltip"),y=v("CodeBlock"),E=v("EntityScanner"),x=v("KAlert"),A=v("EnvironmentSwitcher"),M=v("StepSkeleton");return c(),D("div",X,[e("div",$,[i(M,{steps:a.steps,"sidebar-content":a.sidebarContent,"footer-enabled":a.hideScannerSiblings===!1,"next-disabled":r.nextDisabled},{general:l(()=>[ee,e("p",null," Welcome to the wizard to create a new Dataplane resource in "+k(n.title)+". We will be providing you with a few steps that will get you started. ",1),e("p",null," As you know, the "+k(a.productName)+" GUI is read-only. ",1),te,ae,ne,i(g,{class:"my-6","has-shadow":""},{body:l(()=>[i(d,{title:"Choose a Mesh","for-attr":"dp-mesh","all-inline":""},{default:l(()=>[e("div",null,[p(e("select",{id:"dp-mesh","onUpdate:modelValue":t[0]||(t[0]=o=>a.validate.meshName=o),class:"k-input w-100","data-testid":"mesh-select"},[le,(c(!0),D(b,null,N(n.meshes.items,o=>(c(),D("option",{key:o.name,value:o.name},k(o.name),9,oe))),128))],512),[[S,a.validate.meshName]])]),e("div",null,[ie,i(m,{to:{name:"create-mesh"},appearance:"secondary"},{default:l(()=>[u(" Create a new Mesh ")]),_:1})])]),_:1})]),_:1})]),topology:l(()=>[se,re,i(d,{"all-inline":"","equal-cols":"","hide-label-col":"","shift-right":""},{default:l(()=>[e("div",null,[e("label",de,[p(e("input",{id:"service-dataplane","onUpdate:modelValue":t[1]||(t[1]=o=>a.validate.univDataplaneType=o),class:"k-input",type:"radio",name:"dataplane-type",value:"dataplane-type-service",checked:""},null,512),[[P,a.validate.univDataplaneType]]),ue]),e("label",pe,[p(e("input",{id:"gateway-dataplane","onUpdate:modelValue":t[2]||(t[2]=o=>a.validate.univDataplaneType=o),class:"k-input",type:"radio",name:"dataplane-type",value:"dataplane-type-gateway"},null,512),[[P,a.validate.univDataplaneType]]),ce])])]),_:1}),i(d,{"all-inline":"",title:"Service name","for-attr":"service-name"},{default:l(()=>[p(e("input",{id:"service-name","onUpdate:modelValue":t[3]||(t[3]=o=>a.validate.univDataplaneServiceName=o),"data-testid":"service-name",type:"text",class:"k-input w-100 mr-4"},null,512),[[_,a.validate.univDataplaneServiceName]])]),_:1}),i(d,{"all-inline":"",title:"Dataplane ID","for-attr":"dataplane-id"},{default:l(()=>[e("div",null,[p(e("input",{id:"dataplane-id","onUpdate:modelValue":t[4]||(t[4]=o=>a.validate.univDataplaneId=o),type:"text",class:"k-input w-100",disabled:a.validate.univDataplaneCustomIdDisabled},null,8,ve),[[_,a.validate.univDataplaneId]])]),e("div",null,[i(m,{appearance:"secondary",onClick:t[5]||(t[5]=o=>a.validate.univDataplaneCustomIdDisabled=!1)},{default:l(()=>[u(" Edit ")]),_:1}),i(w,null,{default:l(()=>[u(" This is a unique ID for the Dataplane instance. ")]),_:1})])]),_:1})]),networking:l(()=>[he,me,we,i(d,{"all-inline":"",title:"Data Plane IP Address","for-attr":"network-address"},{default:l(()=>[p(e("input",{id:"network-address","onUpdate:modelValue":t[6]||(t[6]=o=>a.validate.univDataplaneNetworkAddress=o),type:"text",class:"k-input w-100"},null,512),[[_,a.validate.univDataplaneNetworkAddress]]),i(w,null,{default:l(()=>[u(" The IP address that other services will use to consume this data plane. ")]),_:1})]),_:1}),i(d,{"all-inline":"","fill-first":"",title:"Data Plane Port","for-attr":"network-dataplane-port"},{default:l(()=>[p(e("input",{id:"network-dataplane-port","onUpdate:modelValue":t[7]||(t[7]=o=>a.validate.univDataplaneNetworkDPPort=o),type:"text",class:"k-input w-100"},null,512),[[_,a.validate.univDataplaneNetworkDPPort]]),i(w,null,{default:l(()=>[u(" The data plane port (that other services will use to consume this service). ")]),_:1})]),_:1}),i(d,{"all-inline":"",title:"Service IP Address","for-attr":"network-service-address"},{default:l(()=>[p(e("input",{id:"network-service-address","onUpdate:modelValue":t[8]||(t[8]=o=>a.validate.univDataplaneNetworkServiceAddress=o),type:"text",class:"k-input w-100"},null,512),[[_,a.validate.univDataplaneNetworkServiceAddress]]),i(w,null,{default:l(()=>[u(" The address where your service is listening on the machine. ")]),_:1})]),_:1}),i(d,{"all-inline":"",title:"Service Port","for-attr":"network-service-port"},{default:l(()=>[p(e("input",{id:"network-service-port","onUpdate:modelValue":t[9]||(t[9]=o=>a.validate.univDataplaneNetworkServicePort=o),type:"text",class:"k-input w-100"},null,512),[[_,a.validate.univDataplaneNetworkServicePort]]),i(w,null,{default:l(()=>[u(" The port where your service is listening on the machine. ")]),_:1})]),_:1}),i(d,{"all-inline":"",title:"Protocol","for-attr":"network-dataplane-protocol"},{default:l(()=>[p(e("select",{id:"network-dataplane-protocol","onUpdate:modelValue":t[10]||(t[10]=o=>a.validate.univDataplaneNetworkProtocol=o),class:"k-input w-100",name:"network-dataplane-protocol"},[(c(!0),D(b,null,N(a.formFields.protocols,(o,U)=>(c(),D("option",{key:U,value:o,selected:a.validate.univDataplaneNetworkProtocol===o},k(o),9,De))),128))],512),[[S,a.validate.univDataplaneNetworkProtocol]]),i(w,null,{default:l(()=>[u(" The protocol of the service. ")]),_:1})]),_:1})]),complete:l(()=>[a.validate.meshName?(c(),D("div",ke,[a.hideScannerSiblings===!1?(c(),D("div",_e,[ge,e("p",null," It's time to first generate the credentials so that "+k(n.title)+" will allow the Dataplane to successfully authenticate itself with the control plane, and then finally install the Dataplane process (powered by Envoy). ",1),fe,i(y,{id:"code-block-generate-token-command",language:"bash",code:r.generateDpTokenCodeOutput},null,8,["code"]),ye,i(y,{id:"code-block-stard-dp-command",language:"bash",code:r.startDpCodeOutput},null,8,["code"])])):I("",!0),i(E,{"loader-function":r.scanForEntity,"should-start":!0,"has-error":a.scanError,"can-complete":a.scanFound,onHideSiblings:r.hideSiblings},{"loading-title":l(()=>[Se]),"loading-content":l(()=>[be]),"complete-title":l(()=>[Ne]),"complete-content":l(()=>[e("p",null,[u(" Your Dataplane "),a.validate.univDataplaneId?(c(),D("strong",Pe,k(a.validate.univDataplaneId),1)):I("",!0),u(" was found! ")]),Ie,e("p",null,[i(m,{appearance:"primary",onClick:r.compeleteDataPlaneSetup},{default:l(()=>[u(" View Your Dataplane ")]),_:1},8,["onClick"])])]),"error-title":l(()=>[Ce]),"error-content":l(()=>[Te]),_:1},8,["loader-function","has-error","can-complete","onHideSiblings"])])):(c(),T(x,{key:1,appearance:"danger"},{alertMessage:l(()=>[Ee]),_:1}))]),dataplane:l(()=>[xe,e("p",null," In "+k(n.title)+", a Dataplane resource represents a data plane proxy running alongside one of your services. Data plane proxies can be added in any Mesh that you may have created, and in Kubernetes, they will be auto-injected by "+k(n.title)+". ",1)]),example:l(()=>[Ae,Me,Ue]),switch:l(()=>[i(A)]),_:1},8,["steps","sidebar-content","footer-enabled","next-disabled"])])])}const je=C(Q,[["render",Fe]]);export{je as default};
