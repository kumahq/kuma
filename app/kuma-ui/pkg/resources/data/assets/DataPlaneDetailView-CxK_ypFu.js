import{d as ot,a2 as st,a8 as it,r as y,p as u,o as r,w as t,b as e,m as T,ap as rt,c,e as n,N as _,L as v,q as g,O as b,S as dt,l as C,t as d,M as lt,y as pt,K as ut,_ as mt}from"./index-C8cHhogd.js";import{S as yt}from"./SummaryView-XiubtMLn.js";import{T as ct}from"./TagList-DEPCw5mT.js";import{C as K,a as M,b as H}from"./ConnectionTraffic-WAchQcrM.js";const _t={key:0,"data-testid":"dataplane-subscriptions"},ft=ot({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(J){const B=st(),s=J;return it("data-plane-overview",s.data),(bt,a)=>{const D=y("XI18n"),L=y("XNotification"),I=y("XIcon"),X=y("DataCollection"),m=y("XLayout"),z=y("XAction"),k=y("XBadge"),Q=y("XCopyButton"),U=y("XAboutCard"),V=y("XEmptyState"),N=y("XCard"),W=y("RouterView"),Y=y("AppView"),Z=y("DataLoader"),tt=y("RouteView");return r(),u(tt,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:t(({route:f,t:l,can:R,me:w,uri:et})=>[e(Z,{src:et(T(rt),"/meshes/:mesh/dataplanes/:name/layout",{mesh:f.params.mesh,name:f.params.proxy})},{default:t(({data:x,refresh:at,error:nt})=>[e(Y,{notifications:!0},{default:t(()=>{var S,$,A,E,q,O,P,j,F,G;return[(r(!0),c(_,null,v([{bool:(($=(S=s.data.dataplaneInsight.version)==null?void 0:S.kumaDp)==null?void 0:$.kumaCpCompatible)===!1,key:"dp-cp-incompatible",params:{kumaDp:((A=s.data.dataplaneInsight.version)==null?void 0:A.kumaDp.version)??""}},{bool:((q=(E=s.data.dataplaneInsight.version)==null?void 0:E.envoy)==null?void 0:q.kumaDpCompatible)===!1,key:"envoy-dp-incompatible",params:{envoy:((O=s.data.dataplaneInsight.version)==null?void 0:O.envoy.version)??"",kumaDp:((P=s.data.dataplaneInsight.version)==null?void 0:P.kumaDp.version)??""}},{bool:!!(R("use zones")&&s.data.zone&&((F=(j=s.data.dataplaneInsight.version)==null?void 0:j.kumaDp)==null?void 0:F.kumaCpCompatible)===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:((G=s.data.dataplaneInsight.version)==null?void 0:G.kumaDp.version)??""}},{bool:s.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:s.data.isCertExpired,key:"certificate-expired"},{bool:!s.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!R("use transparent-proxying",s.data),key:"networking-transparent-proxying",variant:"info"}],({bool:o,key:i,params:p,variant:h})=>(r(),u(L,{key:i,notify:o,"data-testid":`warning-${i}`,uri:`data-planes.notifications.${i}.${s.data.id}`,variant:h},{default:t(()=>[e(D,{path:`data-planes.notifications.${i}`,params:Object.fromEntries(Object.entries(p??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),a[43]||(a[43]=n()),e(m,{type:"stack","data-testid":"dataplane-details"},{default:t(()=>[e(U,{title:l("data-planes.routes.item.about.title"),created:s.data.creationTime,modified:s.data.modificationTime,class:"about-section"},{default:t(()=>[e(m,null,{default:t(()=>[e(m,{type:"separated"},{default:t(()=>[e(b,{layout:"horizontal"},{title:t(()=>[n(d(l("http.api.property.status")),1)]),body:t(()=>[e(m,{type:"separated"},{default:t(()=>[e(dt,{status:s.data.status},null,8,["status"]),a[0]||(a[0]=n()),s.data.dataplaneType==="standard"?(r(),u(X,{key:0,items:s.data.dataplane.networking.inbounds,predicate:o=>o.state!=="Ready",empty:!1},{default:t(({items:o})=>[e(I,{name:"info"},{default:t(()=>[C("ul",null,[(r(!0),c(_,null,v(o,i=>(r(),c("li",{key:`${i.service}:${i.port}`},d(l("data-planes.routes.item.unhealthy_inbound",{service:i.service,port:i.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):g("",!0)]),_:2,__:[0]},1024)]),_:2,__:[1]},1024),a[7]||(a[7]=n()),R("use zones")&&s.data.zone?(r(),u(b,{key:0,layout:"horizontal"},{title:t(()=>[n(d(l("http.api.property.zone")),1)]),body:t(()=>[e(k,{appearance:"decorative"},{default:t(()=>[e(z,{to:{name:"zone-cp-detail-view",params:{zone:s.data.zone}}},{default:t(()=>[n(d(s.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2,__:[2]},1024)):g("",!0),a[8]||(a[8]=n()),e(b,{layout:"horizontal"},{title:t(()=>[n(d(l("http.api.proptery.type")),1)]),body:t(()=>[e(k,{appearance:"decorative"},{default:t(()=>[n(d(l(`data-planes.type.${s.data.dataplaneType}`)),1)]),_:2},1024)]),_:2,__:[3]},1024),a[9]||(a[9]=n()),s.data.namespace.length>0?(r(),u(b,{key:1,layout:"horizontal"},{title:t(()=>[n(d(l("http.api.property.namespace")),1)]),body:t(()=>[e(k,{appearance:"decorative"},{default:t(()=>[n(d(s.data.namespace),1)]),_:1})]),_:2,__:[4]},1024)):g("",!0),a[10]||(a[10]=n()),e(b,{layout:"horizontal"},{title:t(()=>[n(d(l("http.api.property.address")),1)]),body:t(()=>[e(Q,{variant:"badge",format:"default",text:`${s.data.dataplane.networking.address}`},null,8,["text"])]),_:2,__:[5]},1024),a[11]||(a[11]=n()),s.data.dataplane.networking.gateway?(r(),u(b,{key:2,layout:"horizontal"},{title:t(()=>[n(d(l("http.api.property.tags")),1)]),body:t(()=>[e(ct,{tags:s.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2,__:[6]},1024)):g("",!0)]),_:2,__:[7,8,9,10,11]},1024),a[22]||(a[22]=n()),s.data.dataplaneInsight.mTLS?(r(),u(m,{key:0,"data-testid":"dataplane-mtls",class:"dataplane-mtls",size:"small"},{default:t(()=>[C("h3",null,d(l("data-planes.routes.item.mtls.title")),1),a[21]||(a[21]=n()),e(m,{size:"small"},{default:t(()=>[(r(!0),c(_,null,v([s.data.dataplaneInsight.mTLS],o=>(r(),c(_,{key:o},[e(m,{type:"separated"},{default:t(()=>[e(b,{layout:"horizontal"},{title:t(()=>[e(D,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:t(()=>[e(k,{appearance:"neutral"},{default:t(()=>[n(d(l("common.formats.datetime",{value:Date.parse(o.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2,__:[12]},1024),a[14]||(a[14]=n()),e(b,{layout:"horizontal"},{title:t(()=>[e(D,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:t(()=>[e(k,{appearance:"neutral"},{default:t(()=>[n(d(l("common.formats.datetime",{value:Date.parse(o.certificateExpirationTime)})),1)]),_:2},1024)]),_:2,__:[13]},1024)]),_:2,__:[14]},1024),a[20]||(a[20]=n()),e(m,{type:"separated"},{default:t(()=>[e(b,{layout:"horizontal"},{title:t(()=>[n(d(l("data-planes.routes.item.mtls.regenerations.title")),1)]),body:t(()=>[e(k,{appearance:"info"},{default:t(()=>[n(d(l("common.formats.integer",{value:o.certificateRegenerations})),1)]),_:2},1024)]),_:2,__:[15]},1024),a[18]||(a[18]=n()),e(b,{layout:"horizontal"},{title:t(()=>[n(d(l("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:t(()=>[e(k,{appearance:"decorative"},{default:t(()=>[n(d(o.issuedBackend),1)]),_:2},1024)]),_:2,__:[16]},1024),a[19]||(a[19]=n()),e(b,{layout:"horizontal"},{title:t(()=>[n(d(l("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:t(()=>[e(m,{type:"separated",truncate:""},{default:t(()=>[(r(!0),c(_,null,v(o.supportedBackends,i=>(r(),u(k,{key:i,appearance:i===o.issuedBackend?"decorative":"info"},{default:t(()=>[n(d(i),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2,__:[17]},1024)]),_:2,__:[18,19]},1024)],64))),128))]),_:2},1024)]),_:2,__:[21]},1024)):g("",!0)]),_:2,__:[22]},1024)]),_:2},1032,["title","created","modified"]),a[40]||(a[40]=n()),e(N,{class:"traffic","data-testid":"dataplane-traffic"},{default:t(()=>[e(m,{type:"columns"},{default:t(()=>[e(K,null,{title:t(()=>[e(m,{type:"separated"},{default:t(()=>[e(I,{name:"inbound"}),a[23]||(a[23]=n()),a[24]||(a[24]=C("span",null,"Inbounds",-1))]),_:1,__:[23,24]})]),default:t(()=>[a[26]||(a[26]=n()),(r(!0),c(_,null,v([x.inbounds],o=>(r(),u(M,{key:typeof o,type:"inbound","data-testid":"dataplane-inbounds"},{default:t(()=>[e(X,{type:"inbounds",items:o,predicate:i=>i.port!==49151},lt({default:t(({items:i})=>[e(m,{type:"stack",size:"small"},{default:t(()=>[(r(!0),c(_,null,v(i,p=>(r(),u(H,{key:`${p.kri}`,"data-testid":"dataplane-inbound",protocol:p.protocol,"port-name":p.port.toString()},{default:t(()=>[e(z,{"data-action":"",to:{name:(h=>h.includes("bound")?h.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(T(B).name)),params:{connection:p.proxyResourceName},query:{inactive:f.params.inactive}}},{default:t(()=>[n(d(p.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name"]))),128))]),_:2},1024)]),_:2},[s.data.dataplaneType==="delegated"?{name:"empty",fn:t(()=>[e(V,null,{default:t(()=>[C("p",null,`
                            This proxy is a delegated gateway therefore `+d(l("common.product.name"))+` does not have any
                            visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2,__:[26]},1024),a[32]||(a[32]=n()),e(K,null,{actions:t(()=>[e(z,{action:"refresh",appearance:"primary",onClick:at},{default:t(()=>a[27]||(a[27]=[n(`
                    Refresh
                  `,-1)])),_:2,__:[27]},1032,["onClick"])]),title:t(()=>[e(m,{type:"separated"},{default:t(()=>[e(I,{name:"outbound"}),a[28]||(a[28]=n()),a[29]||(a[29]=C("span",null,"Outbounds",-1))]),_:1,__:[28,29]})]),default:t(()=>[a[30]||(a[30]=n()),a[31]||(a[31]=n()),typeof nt>"u"&&x.outbounds.length>0?(r(),u(X,{key:0,type:"outbounds",items:x.outbounds},{default:t(({items:o})=>[e(M,{type:"outbound","data-testid":"dataplane-outbounds"},{default:t(()=>[e(m,{type:"stack",size:"small"},{default:t(()=>[(r(!0),c(_,null,v(o,i=>(r(),u(H,{key:i.kri,"data-testid":"dataplane-outbound",protocol:i.protocol,"port-name":i.port.toString()},{default:t(()=>[e(z,{"data-action":"",to:{name:(p=>p.includes("bound")?p.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(T(B).name)),params:{connection:i.proxyResourceName},query:{inactive:f.params.inactive}}},{default:t(()=>[n(d(i.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])):(r(),u(V,{key:1}))]),_:2,__:[30,31]},1024)]),_:2,__:[32]},1024)]),_:2},1024),a[41]||(a[41]=n()),e(W,null,{default:t(o=>[o.route.name!==f.name?(r(),u(yt,{key:0,width:"670px",onClose:function(){f.replace({name:"data-plane-detail-view",params:{mesh:f.params.mesh,proxy:f.params.proxy},query:{inactive:f.params.inactive?null:void 0}})}},{default:t(()=>[(r(),u(pt(o.Component),{data:f.params.subscription.length>0?s.data.dataplaneInsight.subscriptions:o.route.name.includes("-inbound-")?x.inbounds:x.outbounds,"data-plane-overview":s.data,networking:s.data.dataplane.networking},null,8,["data","data-plane-overview","networking"]))]),_:2},1032,["onClose"])):g("",!0)]),_:2},1024),a[42]||(a[42]=n()),s.data.dataplaneInsight.subscriptions.length>0?(r(),c("div",_t,[e(N,null,{title:t(()=>[C("h2",null,d(l("data-planes.routes.item.subscriptions.title")),1)]),default:t(()=>[a[39]||(a[39]=n()),e(m,null,{default:t(()=>[e(D,{path:"data-planes.routes.item.subscriptions.description"}),a[38]||(a[38]=n()),e(ut,{headers:[{...w.get("headers.connection"),label:" ",key:"connection"},{...w.get("headers.instanceId"),label:l("http.api.property.instanceId"),key:"instanceId"},{...w.get("headers.version"),label:l("http.api.property.version"),key:"version"},{...w.get("headers.connected"),label:l("http.api.property.connected"),key:"connected"},{...w.get("headers.disconnected"),label:l("http.api.property.disconnected"),key:"disconnected"},{...w.get("headers.responses"),label:l("http.api.property.responses"),key:"responses"}],"is-selected-row":o=>o.id===f.params.subscription,items:s.data.dataplaneInsight.subscriptions.map((o,i,p)=>p[p.length-(i+1)]),onResize:w.set},{connection:t(({row:o})=>[(r(!0),c(_,null,v([o.connectTime&&!o.disconnectTime?"healthy":"unhealthy"],i=>(r(),u(I,{key:`${i}`,name:i},{default:t(()=>[n(d(l(`common.connection.${i}`)),1)]),_:2},1032,["name"]))),128))]),instanceId:t(({row:o})=>[e(z,{"data-action":"",to:{name:"data-plane-subscription-summary-view",params:{subscription:o.id}}},{default:t(()=>[n(d(o.controlPlaneInstanceId),1)]),_:2},1032,["to"])]),version:t(({row:o})=>{var i,p;return[n(d(((p=(i=o.version)==null?void 0:i.kumaDp)==null?void 0:p.version)??"-"),1)]}),connected:t(({row:o})=>[n(d(l("common.formats.datetime",{value:Date.parse(o.connectTime??"")})),1)]),disconnected:t(({row:o})=>[o.disconnectTime?(r(),c(_,{key:0},[n(d(l("common.formats.datetime",{value:Date.parse(o.disconnectTime)})),1)],64)):g("",!0)]),responses:t(({row:o})=>{var i;return[(r(!0),c(_,null,v([((i=o.status)==null?void 0:i.total)??{}],p=>(r(),c(_,null,[n(d(p.responsesSent)+"/"+d(p.responsesAcknowledged),1)],64))),256))]}),_:2,__:[33,34,35,36,37]},1032,["headers","is-selected-row","items","onResize"])]),_:2,__:[38]},1024)]),_:2,__:[39]},1024)])):g("",!0)]),_:2,__:[40,41,42]},1024)]}),_:2,__:[43]},1024)]),_:2},1032,["src"])]),_:1})}}}),Ct=mt(ft,[["__scopeId","data-v-80112aa4"]]);export{Ct as default};
