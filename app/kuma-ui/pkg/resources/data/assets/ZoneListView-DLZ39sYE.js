import{d as Q,O as W,D as $,r as m,o,m as y,w as e,b as s,k as V,e as a,l as I,z as H,P as J,c as p,F as f,Q as M,t as r,p as x,A as U,R as Y,s as b,T as B,S as ee,E as ne,q as te}from"./index-DOjcqG3h.js";import{_ as oe}from"./DeleteResourceModal.vue_vue_type_script_setup_true_lang-D78HWNht.js";import{S as se}from"./SummaryView-7OnKmF0m.js";const ae=["data-testid"],le=Q({__name:"ZoneListView",setup(ie){const T=W(),D=$({}),R=$({}),Z=k=>{const w="zoneIngress";D.value=k.items.reduce((u,d)=>{var z;const _=(z=d[w])==null?void 0:z.zone;if(typeof _<"u"){typeof u[_]>"u"&&(u[_]={online:[],offline:[]});const v=typeof d[`${w}Insight`].connectedSubscription<"u"?"online":"offline";u[_][v].push(d)}return u},{})},E=k=>{const w="zoneEgress";R.value=k.items.reduce((u,d)=>{var z;const _=(z=d[w])==null?void 0:z.zone;if(typeof _<"u"){typeof u[_]>"u"&&(u[_]={online:[],offline:[]});const v=typeof d[`${w}Insight`].connectedSubscription<"u"?"online":"offline";u[_][v].push(d)}return u},{})};async function K(k){await T.deleteZone({name:k})}return(k,w)=>{const u=m("RouteTitle"),d=m("DataSource"),_=m("KButton"),z=m("XTeleportTemplate"),v=m("XIcon"),A=m("XAction"),L=m("XDisclosure"),N=m("XActionGroup"),q=m("KCard"),G=m("RouterView"),F=m("AppView"),O=m("RouteView");return o(),y(O,{name:"zone-cp-list-view",params:{page:1,size:50,zone:""}},{default:e(({route:i,t:l,can:C,uri:P,me:g})=>[s(F,null,{title:e(()=>[V("h1",null,[s(u,{title:l("zone-cps.routes.items.title")},null,8,["title"])])]),default:e(()=>[a(),s(d,{src:P(I(H),"/zone-cps",{},{page:i.params.page,size:i.params.size})},{default:e(({data:c,error:S,refresh:j})=>[s(d,{src:"/zone-ingress-overviews?page=1&size=100",onChange:Z}),a(),s(d,{src:"/zone-egress-overviews?page=1&size=100",onChange:E}),a(),s(q,null,{default:e(()=>[S!==void 0?(o(),y(J,{key:0,error:S},null,8,["error"])):(o(),p(f,{key:1},[C("create zones")&&((c==null?void 0:c.items)??[]).length>0?(o(),y(z,{key:0,to:{name:"zone-cp-list-view-actions"}},{default:e(()=>[s(_,{appearance:"primary",to:{name:"zone-create-view"},"data-testid":"create-zone-link"},{default:e(()=>[s(I(M)),a(" "+r(l("zones.index.create")),1)]),_:2},1024)]),_:2},1024)):x("",!0),a(),s(U,{class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{...g.get("headers.type"),label:"Â ",key:"type"},{...g.get("headers.name"),label:"Name",key:"name"},{...g.get("headers.zoneCpVersion"),label:"Zone CP Version",key:"zoneCpVersion"},{...g.get("headers.ingress"),label:"Ingresses (online / total)",key:"ingress"},{...g.get("headers.egress"),label:"Egresses (online / total)",key:"egress"},{...g.get("headers.state"),label:"Status",key:"state"},{...g.get("headers.warnings"),label:"Warnings",key:"warnings",hideLabel:!0},{...g.get("headers.actions"),label:"Actions",key:"actions",hideLabel:!0}],"page-number":i.params.page,"page-size":i.params.size,total:c==null?void 0:c.total,items:c==null?void 0:c.items,error:S,"empty-state-title":C("create zones")?l("zone-cps.empty_state.title"):void 0,"empty-state-message":C("create zones")?l("zone-cps.empty_state.message"):void 0,"empty-state-cta-to":C("create zones")?{name:"zone-create-view"}:void 0,"empty-state-cta-text":C("create zones")?l("zones.index.create"):void 0,"is-selected-row":n=>n.name===i.params.zone,onChange:i.update,onResize:g.set},Y({type:e(({row:n})=>[(o(!0),p(f,null,b([["kubernetes","universal"].find(t=>t===n.zoneInsight.environment)??"kubernetes"],t=>(o(),y(v,{key:t,name:t},{default:e(()=>[a(r(l(`common.product.environment.${t}`)),1)]),_:2},1032,["name"]))),128))]),name:e(({row:n})=>[s(A,{"data-action":"",to:{name:"zone-cp-detail-view",params:{zone:n.name},query:{page:i.params.page,size:i.params.size}}},{default:e(()=>[a(r(n.name),1)]),_:2},1032,["to"])]),zoneCpVersion:e(({row:n})=>[a(r(I(B)(n.zoneInsight,"version.kumaCp.version",l("common.collection.none"))),1)]),ingress:e(({row:n})=>[(o(!0),p(f,null,b([D.value[n.name]||{online:[],offline:[]}],t=>(o(),p(f,null,[a(r(t.online.length)+" / "+r(t.online.length+t.offline.length),1)],64))),256))]),egress:e(({row:n})=>[(o(!0),p(f,null,b([R.value[n.name]||{online:[],offline:[]}],t=>(o(),p(f,null,[a(r(t.online.length)+" / "+r(t.online.length+t.offline.length),1)],64))),256))]),state:e(({row:n})=>[s(ee,{status:n.state},null,8,["status"])]),warnings:e(({row:n})=>[(o(!0),p(f,null,b([{version_mismatch:!I(B)(n.zoneInsight,"version.kumaCp.kumaCpGlobalCompatible","true"),store_memory:n.zoneInsight.store==="memory"}],t=>(o(),p(f,{key:`${t.version_mismatch}-${t.store_memory}`},[Object.values(t).some(h=>h)?(o(),y(v,{key:0,name:"warning","data-testid":"warning"},{default:e(()=>[V("ul",null,[(o(!0),p(f,null,b(t,(h,X)=>(o(),p(f,{key:X},[h?(o(),p("li",{key:0,"data-testid":`warning-${X}`},r(l(`zone-cps.list.${X}`)),9,ae)):x("",!0)],64))),128))])]),_:2},1024)):(o(),p(f,{key:1},[a(r(l("common.collection.none")),1)],64))],64))),128))]),_:2},[C("create zones")?{name:"actions",fn:e(({row:n})=>[s(N,null,{default:e(()=>[s(L,null,{default:e(({expanded:t,toggle:h})=>[s(A,{to:{name:"zone-cp-detail-view",params:{zone:n.name}}},{default:e(()=>[a(r(l("common.collection.actions.view")),1)]),_:2},1032,["to"]),a(),s(A,{appearance:"danger",onClick:h},{default:e(()=>[a(r(l("common.collection.actions.delete")),1)]),_:2},1032,["onClick"]),a(),s(z,{to:{name:"modal-layer"}},{default:e(()=>[t?(o(),y(oe,{key:0,"confirmation-text":n.name,"delete-function":()=>K(n.name),"is-visible":"","action-button-text":l("common.delete_modal.proceed_button"),title:l("common.delete_modal.title",{type:"Zone"}),"data-testid":"delete-zone-modal",onCancel:h,onDelete:()=>{h(),j()}},{default:e(()=>[V("p",null,r(l("common.delete_modal.text1",{type:"Zone",name:n.name})),1),a(),V("p",null,r(l("common.delete_modal.text2")),1)]),_:2},1032,["confirmation-text","delete-function","action-button-text","title","onCancel","onDelete"])):x("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["headers","page-number","page-size","total","items","error","empty-state-title","empty-state-message","empty-state-cta-to","empty-state-cta-text","is-selected-row","onChange","onResize"])],64))]),_:2},1024),a(),i.params.zone?(o(),y(G,{key:0},{default:e(n=>[s(se,{onClose:t=>i.replace({name:"zone-cp-list-view",query:{page:i.params.page,size:i.params.size}})},{default:e(()=>[(o(),y(ne(n.Component),{name:i.params.zone,"zone-overview":c==null?void 0:c.items.find(t=>t.name===i.params.zone)},null,8,["name","zone-overview"]))]),_:2},1032,["onClose"])]),_:2},1024)):x("",!0)]),_:2},1032,["src"])]),_:2},1024)]),_:1})}}}),pe=te(le,[["__scopeId","data-v-3980223e"]]);export{pe as default};
