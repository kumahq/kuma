import{M as te,P as ne}from"./kongponents.es-131ffe48.js";import{d as oe,u as re,r as n,v as ie,y as le,z as G,A as R,B as ue,D as ce,I as fe,j as y,b as I,e as f,i as D,g as v,w as o,h as z,f as O,E as J,o as i,t as T,F as V,q as Y}from"./index-834ac640.js";import{_ as ge}from"./MultizoneInfo.vue_vue_type_script_setup_true_lang-cea0ad2f.js";import{A as me,a as pe}from"./AccordionList-1e1780b1.js";import{_ as ve}from"./CodeBlock.vue_vue_type_style_index_0_lang-82e53469.js";import{D as de}from"./DataOverview-9d4155bf.js";import{D as he,a as ye}from"./DefinitionListItem-e9b95b5e.js";import{_ as be,S as _e}from"./SubscriptionHeader.vue_vue_type_script_setup_true_lang-2d02714a.js";import{T as we}from"./TabsWidget-b8241f4a.js";import{_ as ke}from"./WarningsWidget.vue_vue_type_script_setup_true_lang-ad75eadf.js";import{u as Ee}from"./store-bb95959d.js";import{u as Se}from"./index-0e952743.js";import{Q as j}from"./QueryParameter-70743f73.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./ErrorBlock-42ddf946.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-4325e9aa.js";import"./datadogLogEvents-302eea7b.js";import"./TagList-7389a145.js";import"./StatusBadge-1d0340ff.js";const Ie={class:"zones"},ze={key:1,class:"kcard-stack"},Ce={class:"kcard-border"},Ae={class:"kcard-border"},Ne={class:"entity-heading"},He=oe({__name:"ZonesView",props:{selectedZoneName:{type:String,required:!1,default:null},offset:{type:Number,required:!1,default:0}},setup(H){const C=H,c=Se(),Q={title:"No Data",message:"There are no Zones present."},L=[{hash:"#overview",title:"Overview"},{hash:"#insights",title:"Zone Insights"},{hash:"#config",title:"Config"},{hash:"#warnings",title:"Warnings"}],A=re(),N=Ee(),d=n(!0),g=n(!1),b=n(null),_=n(!0),h=n(!1),w=n(!1),k=n(!1),E=n({headers:[{label:"Status",key:"status"},{label:"Name",key:"name"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Storage type",key:"storeType"},{label:"Ingress",key:"hasIngress"},{label:"Egress",key:"hasEgress"},{label:"Warnings",key:"warnings",hideLabel:!0}],data:[]}),m=n(null),x=n(null),S=n([]),B=n([]),Z=n(null),P=n(C.offset),W=n(new Set),M=n(new Set);ie(()=>A.params.mesh,function(){A.name==="zones"&&(d.value=!0,g.value=!1,_.value=!0,h.value=!1,w.value=!1,k.value=!1,b.value=null,q(0))}),le(function(){q(C.offset)});function q(a){N.getters["config/getMulticlusterStatus"]&&$(a)}function U(){return S.value.length===0?L.filter(a=>a.hash!=="#warnings"):L}function K(a){var p;let t="-",s="",e=!0;(((p=a.zoneInsight)==null?void 0:p.subscriptions)??[]).forEach(u=>{if(u.version&&u.version.kumaCp){t=u.version.kumaCp.version;const{kumaCpGlobalCompatible:se=!0}=u.version.kumaCp;e=se,u.config&&(s=JSON.parse(u.config).store.type)}});const l=R(a.zoneInsight);return{...a,status:l,zoneCpVersion:t,storeType:s,hasIngress:W.value.has(a.name)?"Yes":"No",hasEgress:M.value.has(a.name)?"Yes":"No",withWarnings:!e}}function X(a){const t=new Set;a.forEach(({zoneIngress:{zone:s}})=>{t.add(s)}),W.value=t}function ee(a){const t=new Set;a.forEach(({zoneEgress:{zone:s}})=>{t.add(s)}),M.value=t}async function $(a){P.value=a,j.set("offset",a>0?a:null),d.value=!0,g.value=!1;const t=A.query.ns||null,s=J;try{const[{data:e,next:r},{items:l},{items:p}]=await Promise.all([ae(t,s,a),G(c.getAllZoneIngressOverviews.bind(c)),G(c.getAllZoneEgressOverviews.bind(c))]);x.value=r,e.length?(X(l),ee(p),E.value.data=e.map(K),k.value=!1,g.value=!1,await F({name:C.selectedZoneName??e[0].name})):(E.value.data=[],k.value=!0,g.value=!0,h.value=!0)}catch(e){e instanceof Error?b.value=e:console.error(e),g.value=!0}finally{d.value=!1}}async function F({name:a}){var t;w.value=!1,_.value=!0,h.value=!1,S.value=[];try{const s=await c.getZoneOverview({name:a}),e=((t=s.zoneInsight)==null?void 0:t.subscriptions)??[],r=R(s.zoneInsight);if(m.value={...ue(s,["type","name"]),status:r,"Authentication Type":ce(s)},j.set("zone",a),B.value=Array.from(e).reverse(),e.length>0){const l=e[e.length-1],p=l.version.kumaCp.version||"-",{kumaCpGlobalCompatible:u=!0}=l.version.kumaCp;u||S.value.push({kind:fe,payload:{zoneCpVersion:p,globalCpVersion:N.getters["config/getVersion"]}}),l.config&&(Z.value=JSON.stringify(JSON.parse(l.config),null,2))}}catch(s){console.error(s),m.value=null,w.value=!0,h.value=!0}finally{_.value=!1}}async function ae(a,t,s){if(a)return{data:[await c.getZoneOverview({name:a},{size:t,offset:s})],next:null};{const{items:e,next:r}=await c.getAllZoneOverviews({size:t,offset:s});return{data:e??[],next:r}}}return(a,t)=>{var s;return i(),y("div",Ie,[I(N).getters["config/getMulticlusterStatus"]===!1?(i(),f(ge,{key:0})):(i(),y("div",ze,[D("div",Ce,[v(de,{"selected-entity-name":(s=m.value)==null?void 0:s.name,"page-size":I(J),"is-loading":d.value,error:b.value,"empty-state":Q,"table-data":E.value,"table-data-is-empty":k.value,"show-warnings":E.value.data.some(e=>e.withWarnings),next:x.value,"page-offset":P.value,onTableAction:F,onLoadData:$},{additionalControls:o(()=>[a.$route.query.ns?(i(),f(I(te),{key:0,class:"back-button",appearance:"primary",icon:"arrowLeft",to:{name:"zones"}},{default:o(()=>[z(`
              View all
            `)]),_:1})):O("",!0)]),_:1},8,["selected-entity-name","page-size","is-loading","error","table-data","table-data-is-empty","show-warnings","next","page-offset"])]),z(),D("div",Ae,[g.value===!1&&m.value!==null?(i(),f(we,{key:0,"has-error":b.value!==null,"is-loading":d.value,tabs:U()},{tabHeader:o(()=>[D("h1",Ne,`
              Zone: `+T(m.value.name),1)]),overview:o(()=>[v(ye,{"has-error":w.value,"is-loading":_.value,"is-empty":h.value},{default:o(()=>[(i(!0),y(V,null,Y(m.value,(e,r)=>(i(),f(he,{key:r,term:r},{default:o(()=>[r==="status"?(i(),f(I(ne),{key:0,appearance:e==="Offline"?"danger":"success"},{default:o(()=>[z(T(e),1)]),_:2},1032,["appearance"])):(i(),y(V,{key:1},[z(T(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1},8,["has-error","is-loading","is-empty"])]),insights:o(()=>[v(pe,{"initially-open":0},{default:o(()=>[(i(!0),y(V,null,Y(B.value,(e,r)=>(i(),f(me,{key:r},{"accordion-header":o(()=>[v(be,{details:e},null,8,["details"])]),"accordion-content":o(()=>[v(_e,{details:e},null,8,["details"])]),_:2},1024))),128))]),_:1})]),config:o(()=>[Z.value?(i(),f(ve,{key:0,id:"code-block-zone-config",language:"json",code:Z.value,"is-searchable":"","query-key":"zone-config"},null,8,["code"])):O("",!0)]),warnings:o(()=>[v(ke,{warnings:S.value},null,8,["warnings"])]),_:1},8,["has-error","is-loading","tabs"])):O("",!0)])]))])}}});export{He as default};
