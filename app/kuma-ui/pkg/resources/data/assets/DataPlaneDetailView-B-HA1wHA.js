import{d as ue,a7 as me,a6 as ye,r as _,p as m,o as s,w as e,b as t,m as w,F as Y,aq as _e,a8 as fe,c,e as n,N as b,L as C,q as z,O as v,T as ce,l as I,t as p,M as be,y as ve,_ as ge}from"./index-y0jRV0qi.js";import{S as ke}from"./SummaryView-DU_tu2nI.js";import{T as xe}from"./TagList-6zFdPYnl.js";import{C as Z,a as V,b as $}from"./ConnectionTraffic-pu_6LoyQ.js";import{C as A,K as we}from"./kri-D19gROKk.js";const Ce=ue({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(P){const E=me(),o=P;return ye("data-plane-overview",o.data),(ze,a)=>{const D=_("XI18n"),L=_("XNotification"),T=_("XIcon"),S=_("DataCollection"),u=_("XLayout"),X=_("XAction"),g=_("XBadge"),ee=_("XCopyButton"),te=_("XAboutCard"),q=_("XEmptyState"),ae=_("XCard"),ne=_("RouterView"),oe=_("AppView"),se=_("DataLoader"),N=_("DataSource"),re=_("RouteView");return s(),m(re,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:e(({route:l,t:d,can:B,uri:R})=>[t(N,{src:R(w(Y),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:l.params.mesh,name:l.params.proxy})},{default:e(({data:k})=>[t(N,{src:R(w(_e),"/meshes/:mesh/dataplanes/:name/layout",{mesh:l.params.mesh,name:l.params.proxy})},{default:e(({data:y,refresh:ie,error:pe})=>[t(N,{src:R(w(Y),"/policy-types",{})},{default:e(({data:O})=>[t(N,{src:R(w(fe),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[l.params.proxyType]??"dataplane",name:l.params.proxy,mesh:l.params.mesh||"*",socketAddress:"self_inbound"})},{default:e(({data:x,error:de,refresh:le})=>[t(se,{data:[y,k,O,x]},{default:e(()=>[t(oe,{notifications:!0},{default:e(()=>{var K,j,F,G,M,H,J,Q,U,W;return[(s(!0),c(b,null,C([{bool:((j=(K=o.data.dataplaneInsight.version)==null?void 0:K.kumaDp)==null?void 0:j.kumaCpCompatible)===!1,key:"dp-cp-incompatible",params:{kumaDp:((F=o.data.dataplaneInsight.version)==null?void 0:F.kumaDp.version)??""}},{bool:((M=(G=o.data.dataplaneInsight.version)==null?void 0:G.envoy)==null?void 0:M.kumaDpCompatible)===!1,key:"envoy-dp-incompatible",params:{envoy:((H=o.data.dataplaneInsight.version)==null?void 0:H.envoy.version)??"",kumaDp:((J=o.data.dataplaneInsight.version)==null?void 0:J.kumaDp.version)??""}},{bool:!!(B("use zones")&&o.data.zone&&((U=(Q=o.data.dataplaneInsight.version)==null?void 0:Q.kumaDp)==null?void 0:U.kumaCpCompatible)===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:((W=o.data.dataplaneInsight.version)==null?void 0:W.kumaDp.version)??""}},{bool:o.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:o.data.isCertExpired,key:"certificate-expired"},{bool:!o.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!B("use transparent-proxying",o.data),key:"networking-transparent-proxying",variant:"info"}],({bool:i,key:r,params:f,variant:h})=>(s(),m(L,{key:r,notify:i,"data-testid":`warning-${r}`,uri:`data-planes.notifications.${r}.${o.data.id}`,variant:h},{default:e(()=>[t(D,{path:`data-planes.notifications.${r}`,params:Object.fromEntries(Object.entries(f??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),a[47]||(a[47]=n()),t(u,{type:"stack","data-testid":"dataplane-details"},{default:e(()=>[t(te,{title:d("data-planes.routes.item.about.title"),created:o.data.creationTime,modified:o.data.modificationTime,class:"about-section"},{default:e(()=>[t(u,null,{default:e(()=>[t(u,{type:"separated"},{default:e(()=>[t(v,{layout:"horizontal"},{title:e(()=>[n(p(d("http.api.property.status")),1)]),body:e(()=>[t(u,{type:"separated"},{default:e(()=>[t(ce,{status:o.data.status},null,8,["status"]),a[0]||(a[0]=n()),o.data.dataplaneType==="standard"?(s(),m(S,{key:0,items:o.data.dataplane.networking.inbounds,predicate:i=>i.state!=="Ready",empty:!1},{default:e(({items:i})=>[t(T,{name:"info"},{default:e(()=>[I("ul",null,[(s(!0),c(b,null,C(i,r=>(s(),c("li",{key:`${r.service}:${r.port}`},p(d("data-planes.routes.item.unhealthy_inbound",{service:r.service,port:r.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):z("",!0)]),_:2,__:[0]},1024)]),_:2,__:[1]},1024),a[7]||(a[7]=n()),B("use zones")&&o.data.zone?(s(),m(v,{key:0,layout:"horizontal"},{title:e(()=>[n(p(d("http.api.property.zone")),1)]),body:e(()=>[t(g,{appearance:"decorative"},{default:e(()=>[t(X,{to:{name:"zone-cp-detail-view",params:{zone:o.data.zone}}},{default:e(()=>[n(p(o.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2,__:[2]},1024)):z("",!0),a[8]||(a[8]=n()),t(v,{layout:"horizontal"},{title:e(()=>[n(p(d("http.api.property.type")),1)]),body:e(()=>[t(g,{appearance:"decorative"},{default:e(()=>[n(p(d(`data-planes.type.${o.data.dataplaneType}`)),1)]),_:2},1024)]),_:2,__:[3]},1024),a[9]||(a[9]=n()),o.data.namespace.length>0?(s(),m(v,{key:1,layout:"horizontal"},{title:e(()=>[n(p(d("http.api.property.namespace")),1)]),body:e(()=>[t(g,{appearance:"decorative"},{default:e(()=>[n(p(o.data.namespace),1)]),_:1})]),_:2,__:[4]},1024)):z("",!0),a[10]||(a[10]=n()),t(v,{layout:"horizontal"},{title:e(()=>[n(p(d("http.api.property.address")),1)]),body:e(()=>[t(ee,{variant:"badge",format:"default",text:`${o.data.dataplane.networking.address}`},null,8,["text"])]),_:2,__:[5]},1024),a[11]||(a[11]=n()),o.data.dataplane.networking.gateway?(s(),m(v,{key:2,layout:"horizontal"},{title:e(()=>[n(p(d("http.api.property.tags")),1)]),body:e(()=>[t(xe,{tags:o.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2,__:[6]},1024)):z("",!0)]),_:2,__:[7,8,9,10,11]},1024),a[30]||(a[30]=n()),o.data.dataplaneInsight.mTLS?(s(),m(u,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:e(()=>[I("h3",null,p(d("data-planes.routes.item.mtls.title")),1),a[21]||(a[21]=n()),t(u,{size:"small"},{default:e(()=>[(s(!0),c(b,null,C([o.data.dataplaneInsight.mTLS],i=>(s(),c(b,{key:i},[t(u,{type:"separated"},{default:e(()=>[t(v,{layout:"horizontal"},{title:e(()=>[t(D,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:e(()=>[t(g,{appearance:"neutral"},{default:e(()=>[n(p(d("common.formats.datetime",{value:Date.parse(i.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2,__:[12]},1024),a[14]||(a[14]=n()),t(v,{layout:"horizontal"},{title:e(()=>[t(D,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:e(()=>[t(g,{appearance:"neutral"},{default:e(()=>[n(p(d("common.formats.datetime",{value:Date.parse(i.certificateExpirationTime)})),1)]),_:2},1024)]),_:2,__:[13]},1024)]),_:2,__:[14]},1024),a[20]||(a[20]=n()),t(u,{type:"separated"},{default:e(()=>[t(v,{layout:"horizontal"},{title:e(()=>[n(p(d("data-planes.routes.item.mtls.regenerations.title")),1)]),body:e(()=>[t(g,{appearance:"info"},{default:e(()=>[n(p(d("common.formats.integer",{value:i.certificateRegenerations})),1)]),_:2},1024)]),_:2,__:[15]},1024),a[18]||(a[18]=n()),t(v,{layout:"horizontal"},{title:e(()=>[n(p(d("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:e(()=>[t(g,{appearance:"decorative"},{default:e(()=>[n(p(i.issuedBackend),1)]),_:2},1024)]),_:2,__:[16]},1024),a[19]||(a[19]=n()),t(v,{layout:"horizontal"},{title:e(()=>[n(p(d("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:e(()=>[t(u,{type:"separated",truncate:""},{default:e(()=>[(s(!0),c(b,null,C(i.supportedBackends,r=>(s(),m(g,{key:r,appearance:r===i.issuedBackend?"decorative":"info"},{default:e(()=>[n(p(r),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2,__:[17]},1024)]),_:2,__:[18,19]},1024)],64))),128))]),_:2},1024)]),_:2,__:[21]},1024)):z("",!0),a[31]||(a[31]=n()),o.data.dataplaneInsight.subscriptions.length>0?(s(),m(u,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:e(()=>[t(u,{type:"separated"},{default:e(()=>[I("h3",null,p(d("data-planes.routes.item.subscriptions.title")),1),a[22]||(a[22]=n()),t(X,{"data-action":"",appearance:"anchor",to:{name:"data-plane-subscriptions-summary-view",params:{mesh:l.params.mesh,proxy:l.params.proxy},query:{inactive:l.params.inactive}}},{default:e(()=>[n(`
                            (`+p(d("data-planes.routes.item.xds.show-details"))+`)
                          `,1)]),_:2},1032,["to"])]),_:2,__:[22]},1024),a[28]||(a[28]=n()),(s(!0),c(b,null,C([[...o.data.dataplaneInsight.subscriptions].reverse()],i=>(s(),m(u,{key:typeof i,type:"separated"},{default:e(()=>[(s(!0),c(b,null,C([i.find(r=>!r.disconnectTime)??i[0]],r=>(s(),c(b,{key:r.id},[!r.disconnectTime&&r.connectTime?(s(),c(b,{key:0},[t(v,{layout:"horizontal"},{title:e(()=>[t(D,{path:"data-planes.routes.item.xds.connected"})]),body:e(()=>[t(g,{appearance:"neutral"},{default:e(()=>[n(p(d("common.formats.datetime",{value:Date.parse(r.connectTime)})),1)]),_:2},1024)]),_:2,__:[23]},1024),a[26]||(a[26]=n()),t(v,{layout:"horizontal"},{title:e(()=>[t(D,{path:"data-planes.routes.item.xds.instance"})]),body:e(()=>[t(g,{appearance:"info"},{default:e(()=>[n(p(r.controlPlaneInstanceId),1)]),_:2},1024)]),_:2,__:[24]},1024),a[27]||(a[27]=n()),t(v,{layout:"horizontal"},{title:e(()=>[t(D,{path:"data-planes.routes.item.xds.version"})]),body:e(()=>[t(g,{appearance:"info"},{default:e(()=>{var f,h;return[n(p(((h=(f=r.version)==null?void 0:f.kumaDp)==null?void 0:h.version)??d("common.unknown")),1)]}),_:2},1024)]),_:2,__:[25]},1024)],64)):(s(),m(D,{key:1,path:"data-planes.routes.item.xds.disconnected"}))],64))),128))]),_:2},1024))),128))]),_:2,__:[28]},1024)):z("",!0),a[32]||(a[32]=n()),k!=null&&k.policies.length?(s(),m(u,{key:2,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:e(()=>[I("h3",null,p(d("data-planes.routes.item.policies")),1),a[29]||(a[29]=n()),t(u,{type:"separated"},{default:e(()=>[(s(!0),c(b,null,C(k==null?void 0:k.policies,i=>(s(),m(X,{key:i.kind,"data-action":"",appearance:"anchor",to:{name:"data-plane-policy-config-summary-view",params:{mesh:l.params.mesh,proxy:l.params.proxy,policy:i.kind.toLowerCase()}}},{default:e(()=>[t(g,null,{default:e(()=>[n(p(i.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2,__:[29]},1024)):z("",!0)]),_:2,__:[30,31,32]},1024)]),_:2},1032,["title","created","modified"]),a[45]||(a[45]=n()),t(ae,{class:"traffic","data-testid":"dataplane-traffic"},{default:e(()=>[t(u,{type:"columns"},{default:e(()=>[t(Z,null,{title:e(()=>[t(u,{type:"separated"},{default:e(()=>[t(T,{name:"inbound"}),a[33]||(a[33]=n()),a[34]||(a[34]=I("span",null,"Inbounds",-1))]),_:1,__:[33,34]})]),default:e(()=>[a[36]||(a[36]=n()),(s(!0),c(b,null,C([(y==null?void 0:y.inbounds)??[]],i=>(s(),m(V,{key:typeof i,type:"inbound","data-testid":"dataplane-inbounds"},{default:e(()=>[t(S,{type:"inbounds",items:i,predicate:r=>r.port!==49151},be({default:e(({items:r})=>[t(u,{type:"stack",size:"small"},{default:e(()=>[(s(!0),c(b,null,C(r,f=>(s(),m($,{key:`${f.kri}`,"data-testid":"dataplane-inbound",protocol:f.protocol,"port-name":w(A).fromString(f.proxyResourceName).sectionName,traffic:x==null?void 0:x.inbounds[w(A).toString({...w(A).fromString(f.proxyResourceName),sectionName:f.port.toString()})]},{default:e(()=>[t(X,{"data-action":"",to:{name:(h=>h.includes("bound")?h.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(w(E).name)),params:{connection:f.proxyResourceName},query:{inactive:l.params.inactive}}},{default:e(()=>[n(p(f.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},[o.data.dataplaneType==="delegated"?{name:"empty",fn:e(()=>[t(q,null,{default:e(()=>[I("p",null,`
                                    This proxy is a delegated gateway therefore `+p(d("common.product.name"))+` does not have any
                                    visibility into inbounds for this gateway.
                                  `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2,__:[36]},1024),a[44]||(a[44]=n()),t(Z,null,{actions:e(()=>[t(X,{action:"refresh",appearance:"primary",onClick:()=>{ie(),le()}},{default:e(()=>a[37]||(a[37]=[n(`
                            Refresh
                          `,-1)])),_:2,__:[37]},1032,["onClick"])]),title:e(()=>[t(u,{type:"separated"},{default:e(()=>[t(T,{name:"outbound"}),a[38]||(a[38]=n()),a[39]||(a[39]=I("span",null,"Outbounds",-1))]),_:1,__:[38,39]})]),default:e(()=>[a[42]||(a[42]=n()),a[43]||(a[43]=n()),typeof pe>"u"&&typeof de>"u"&&(y!=null&&y.outbounds.length)?(s(),c(b,{key:0},[t(V,{type:"passthrough"},{default:e(()=>[t($,{protocol:"passthrough",traffic:x==null?void 0:x.passthrough},{default:e(()=>a[40]||(a[40]=[n(`
                              Non mesh traffic
                            `,-1)])),_:2,__:[40]},1032,["traffic"])]),_:2},1024),a[41]||(a[41]=n()),t(S,{type:"outbounds",items:y==null?void 0:y.outbounds},{default:e(({items:i})=>[t(V,{type:"outbound","data-testid":"dataplane-outbounds"},{default:e(()=>[t(u,{type:"stack",size:"small"},{default:e(()=>[(s(!0),c(b,null,C(i,r=>(s(),m($,{key:r.kri,"data-testid":"dataplane-outbound",protocol:r.protocol,"port-name":w(we).fromString(r.proxyResourceName).sectionName,traffic:x==null?void 0:x.outbounds[r.proxyResourceName]},{default:e(()=>[t(X,{"data-action":"",to:{name:(f=>f.includes("bound")?f.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(w(E).name)),params:{connection:r.proxyResourceName},query:{inactive:l.params.inactive}}},{default:e(()=>[n(p(r.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(s(),m(q,{key:1}))]),_:2,__:[42,43]},1024)]),_:2,__:[44]},1024)]),_:2},1024),a[46]||(a[46]=n()),t(ne,null,{default:e(i=>[i.route.name!==l.name?(s(),m(ke,{key:0,width:i.route.name==="data-plane-subscriptions-summary-view"?"900px":"670px",onClose:function(){l.replace({name:"data-plane-detail-view",params:{mesh:l.params.mesh,proxy:l.params.proxy},query:{inactive:l.params.inactive?null:void 0}})}},{default:e(()=>[(s(),m(ve(i.Component),{data:l.params.subscription.length>0?o.data.dataplaneInsight.subscriptions:i.route.name.includes("-inbound-")?y==null?void 0:y.inbounds:y==null?void 0:y.outbounds,"data-plane-overview":o.data,networking:o.data.dataplane.networking,subscriptions:o.data.dataplaneInsight.subscriptions,policies:(k==null?void 0:k.policies)??[],"policy-types-data":O},null,8,["data","data-plane-overview","networking","subscriptions","policies","policy-types-data"]))]),_:2},1032,["width","onClose"])):z("",!0)]),_:2},1024)]),_:2,__:[45,46]},1024)]}),_:2,__:[47]},1024)]),_:2},1032,["data"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:1})}}}),Re=ge(Ce,[["__scopeId","data-v-0e716fc7"]]);export{Re as default};
