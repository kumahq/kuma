import{a as G,A as M}from"./AccordionList-BWJeYYnD.js";import{d as z,r as g,c as s,o as e,l as p,e as n,q as D,N as l,L as y,b as i,t as r,w as a,p as f,M as J,_ as T,x as q,m as R,Y as H,aa as Q,z as K,k as U,n as W,K as Z,F as E,a5 as ee,y as te}from"./index-DIsQPtUy.js";import{T as Y}from"./TagList-CPjSXtzc.js";import{R as se}from"./RuleMatchers-DPWrcDn3.js";const ae={class:"policies-list"},ne={class:"mesh-gateway-policy-list"},le={key:0},oe={class:"dataplane-policy-header"},ie={key:0,class:"badge-list"},re={class:"mt-1"},ue=z({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},types:{}},setup(w){const C=w;return(N,t)=>{const L=g("XAction"),X=g("XBadge");return e(),s("div",ae,[p("div",ne,[t[11]||(t[11]=p("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),t[12]||(t[12]=n()),w.gatewayDataplane.routePolicies.length>0?(e(),s("ul",le,[(e(!0),s(l,null,y(w.gatewayDataplane.routePolicies,(d,b)=>(e(),s("li",{key:b},[p("span",null,r(d.type),1),t[0]||(t[0]=n(`:

          `,-1)),i(L,{to:{name:"policy-detail-view",params:{mesh:d.mesh,policyPath:C.types[d.type]?.path??"",policy:d.name}}},{default:a(()=>[n(r(d.name),1)]),_:2},1032,["to"])]))),128))])):D("",!0),t[13]||(t[13]=n()),t[14]||(t[14]=p("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),t[15]||(t[15]=n()),p("div",null,[(e(!0),s(l,null,y(w.gatewayDataplane.listenerEntries,(d,b)=>(e(),s("div",{key:b},[p("div",null,[p("div",null,[t[1]||(t[1]=p("b",null,"Host",-1)),n(": "+r(d.hostName)+":"+r(d.port)+" ("+r(d.protocol)+`)
            `,1)]),t[10]||(t[10]=n()),d.routeEntries.length>0?(e(),s(l,{key:0},[t[8]||(t[8]=p("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),t[9]||(t[9]=n()),i(M,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(l,null,y(d.routeEntries,(u,k)=>(e(),f(G,{key:k},J({"accordion-header":a(()=>[p("div",oe,[p("div",null,[p("div",null,[t[2]||(t[2]=p("b",null,"Route",-1)),t[3]||(t[3]=n(": ",-1)),i(L,{to:{name:"policy-detail-view",params:{mesh:u.route.mesh,policyPath:C.types[u.route.type]?.path??"",policy:u.route.name}}},{default:a(()=>[n(r(u.route.name),1)]),_:2},1032,["to"])]),t[5]||(t[5]=n()),p("div",null,[t[4]||(t[4]=p("b",null,"Service",-1)),n(": "+r(u.service),1)])]),t[6]||(t[6]=n()),u.origins.length>0?(e(),s("div",ie,[(e(!0),s(l,null,y(u.origins,(o,_)=>(e(),f(X,{key:`${b}-${_}`},{default:a(()=>[n(r(o.type),1)]),_:2},1024))),128))])):D("",!0)])]),_:2},[u.origins.length>0?{name:"accordion-content",fn:a(()=>[p("ul",re,[(e(!0),s(l,null,y(u.origins,(o,_)=>(e(),s("li",{key:`${b}-${_}`},[n(r(o.type)+`:

                        `,1),i(L,{to:{name:"policy-detail-view",params:{mesh:o.mesh,policyPath:C.types[o.type]?.path??"",policy:o.name}}},{default:a(()=>[n(r(o.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):D("",!0)])]))),128))])])])}}}),pe=T(ue,[["__scopeId","data-v-a5c76432"]]),de={class:"policy-type-heading"},me={class:"policy-list"},ce={key:0},ye=z({__name:"PolicyTypeEntryList",props:{items:{},types:{}},setup(w){const C=w;function N({headerKey:t}){return{class:`cell-${t}`}}return(t,L)=>{const X=g("XAction"),d=g("XCodeBlock"),b=q("icon-start");return e(),f(M,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(l,null,y(w.items,(u,k)=>(e(),f(G,{key:k},{"accordion-header":a(()=>[K((e(),s("h3",de,[n(r(u.type)+" ("+r(u.connections.length)+`)
        `,1)])),[[b,{name:u.type,size:"60",default:"policy"}]])]),"accordion-content":a(()=>[p("div",me,[i(R(Q),{class:"policy-type-table",data:u.connections,headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":N,"hide-pagination":"","is-clickable":""},{sourceTags:a(({row:o})=>[o.sourceTags.length>0?(e(),f(Y,{key:0,class:"tag-list","should-truncate":"",tags:o.sourceTags},null,8,["tags"])):(e(),s(l,{key:1},[n(`
                —
              `)],64))]),destinationTags:a(({row:o})=>[o.destinationTags.length>0?(e(),f(Y,{key:0,class:"tag-list","should-truncate":"",tags:o.destinationTags},null,8,["tags"])):(e(),s(l,{key:1},[n(`
                —
              `)],64))]),name:a(({row:o})=>[o.name!==null?(e(),s(l,{key:0},[n(r(o.name),1)],64)):(e(),s(l,{key:1},[n(`
                —
              `)],64))]),origins:a(({row:o})=>[o.origins.length>0?(e(),s("ul",ce,[(e(!0),s(l,null,y(o.origins,(_,v)=>(e(),s("li",{key:`${k}-${v}`},[i(X,{to:{name:"policy-detail-view",params:{mesh:_.mesh,policyPath:C.types[_.type]?.path??"",policy:_.name}}},{default:a(()=>[n(r(_.name),1)]),_:2},1032,["to"])]))),128))])):(e(),s(l,{key:1},[n(`
                —
              `)],64))]),config:a(({row:o})=>[o.config?(e(),f(d,{key:0,code:R(H).stringify(o.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(l,{key:1},[n(`
                —
              `)],64))]),_:2},1032,["data"])])]),_:2},1024))),128))]),_:1})}}}),_e=T(ye,[["__scopeId","data-v-57aafe9b"]]),fe={class:"policy-type-heading"},ge={key:0,class:"matcher"},ke={key:1},he={key:0},be=z({__name:"RuleList",props:{rules:{},types:{}},setup(w){const{t:C}=U(),N=w;return(t,L)=>{const X=g("XAction"),d=g("XCodeBlock"),b=q("icon-start");return e(),f(M,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(l,null,y([N.rules.reduce((u,k)=>(typeof u[k.type]>"u"&&(u[k.type]=[]),u[k.type].push(k),u),{})],u=>(e(),s(l,{key:u},[(e(!0),s(l,null,y(u,(k,o)=>(e(),f(G,{key:o},{"accordion-header":a(()=>[K((e(),s("h3",fe,[n(r(o),1)])),[[b,{name:o,size:"60",default:"policy"}]])]),"accordion-content":a(()=>[(e(!0),s(l,null,y([k.some(_=>_.matchers.length>0)],_=>(e(),s("div",{key:_,class:"policy-list"},[i(Z,{class:W(["policy-type-table",{"has-matchers":_}]),items:k,headers:[..._?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:a(({row:v})=>[v.matchers.length>0?(e(),s("span",ge,[i(se,{items:v.matchers},null,8,["items"])])):(e(),s("i",ke,r(R(C)("data-planes.routes.item.matches_everything")),1))]),origins:a(({row:v})=>[v.origins.length>0?(e(),s("ul",he,[(e(!0),s(l,null,y(v.origins,(x,I)=>(e(),s("li",{key:`${o}-${I}`},[i(X,{to:{name:"data-plane-policy-summary-view",params:{mesh:x.mesh,policyPath:N.types[x.type]?.path??"",policy:x.name}}},{default:a(()=>[n(r(x.name),1)]),_:2},1032,["to"])]))),128))])):(e(),s(l,{key:1},[n(r(R(C)("common.collection.none")),1)],64))]),config:a(({row:v})=>[Object.keys(v.raw).length>0?(e(),f(d,{key:0,code:R(H).stringify(v.raw),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(l,{key:1},[n(r(R(C)("common.collection.none")),1)],64))]),_:2},1032,["class","items","headers"])]))),128))]),_:2},1024))),128))],64))),128))]),_:1})}}}),F=T(be,[["__scopeId","data-v-c377cad1"]]),ve={class:"mb-2"},$e={class:"mb-2"},we={key:0},Pe=z({__name:"DataPlanePoliciesView",props:{data:{}},setup(w){const C=w;return(N,t)=>{const L=g("RouteTitle"),X=g("XCard"),d=g("DataCollection"),b=g("DataLoader"),u=g("XDrawer"),k=g("RouterView"),o=g("DataSource"),_=g("AppView"),v=g("RouteView");return e(),f(v,{name:"data-plane-policies-view",params:{mesh:"",proxy:""}},{default:a(({uri:x,can:I,route:A,t:P})=>[i(L,{render:!1,title:P("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"]),t[11]||(t[11]=n()),i(_,null,{default:a(()=>[i(o,{src:x(R(E),"/policy-types",{})},{default:a(({data:O,error:S})=>[(e(!0),s(l,null,y([(O?.policyTypes??[]).reduce(($,h)=>Object.assign($,{[h.name]:h}),{})],$=>(e(),s(l,{key:typeof $},[i(b,{src:x(R(ee),"/meshes/:mesh/rules/for/:dataplane",{mesh:A.params.mesh,dataplane:A.params.proxy}),data:[O],errors:[S]},{default:a(({data:h})=>[i(d,{items:h.rules},{default:a(()=>[(e(),s(l,null,y(["proxy","to"],m=>i(d,{key:m,items:h.rules,predicate:c=>c.ruleType===m,comparator:(c,B)=>c.type.localeCompare(B.type),empty:!1},{default:a(({items:c})=>[i(X,null,{default:a(()=>[p("h3",null,r(P(`data-planes.routes.item.rules.${m}`)),1),t[0]||(t[0]=n()),i(F,{class:"mt-2",rules:c,types:$,"data-testid":`${m}-rule-list`},null,8,["rules","types","data-testid"])]),_:2},1024)]),_:2},1032,["items","predicate","comparator"])),64)),t[5]||(t[5]=n()),i(d,{items:h.rules,predicate:m=>m.ruleType==="from"&&!$[m.type]?.policy.isFromAsRules,comparator:(m,c)=>m.type.localeCompare(c.type),empty:!1},{default:a(({items:m})=>[i(X,null,{default:a(()=>[p("h3",ve,r(P("data-planes.routes.item.rules.from")),1),t[2]||(t[2]=n()),(e(!0),s(l,null,y([Object.groupBy(m,c=>c.inbound.port)],c=>(e(),s(l,{key:c},[(e(!0),s(l,null,y(Object.entries(c).sort(([B],[V])=>Number(V)-Number(B)),([B,V],j)=>(e(),s("div",{key:j},[p("h4",null,r(P("data-planes.routes.item.port",{port:B})),1),t[1]||(t[1]=n()),i(F,{class:"mt-2",rules:V,types:$,"data-testid":`from-rule-list-${j}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","predicate","comparator"]),t[6]||(t[6]=n()),i(d,{items:h.inboundRules,comparator:(m,c)=>m.type.localeCompare(c.type),empty:!1},{default:a(({items:m})=>[i(X,null,{default:a(()=>[p("h3",$e,r(P("data-planes.routes.item.rules.inbound")),1),t[4]||(t[4]=n()),(e(!0),s(l,null,y([Object.groupBy(m,c=>c.inbound.port)],c=>(e(),s(l,{key:c},[(e(!0),s(l,null,y(Object.entries(c).sort(([B],[V])=>Number(V)-Number(B)),([B,V],j)=>(e(),s("div",{key:j},[p("h4",null,r(P("data-planes.routes.item.port",{port:B})),1),t[3]||(t[3]=n()),i(F,{class:"mt-2",rules:V,types:$,"data-testid":`inbound-rule-list-${j}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","comparator"])]),_:2},1032,["items"])]),_:2},1032,["src","data","errors"]),t[9]||(t[9]=n()),I("use zones")?D("",!0):(e(),s("div",we,[C.data.dataplaneType==="builtin"?(e(),f(b,{key:0,src:`/meshes/${A.params.mesh}/dataplanes/${A.params.proxy}/gateway-dataplane-policies`,data:[O],errors:[S]},{default:a(({data:h})=>[h?(e(),f(d,{key:0,items:h.routePolicies,empty:!1},{default:a(()=>[p("h3",null,r(P("data-planes.routes.item.legacy_policies")),1),t[7]||(t[7]=n()),i(X,{class:"mt-4"},{default:a(()=>[i(pe,{types:$,"gateway-dataplane":h,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["types","gateway-dataplane"])]),_:2},1024)]),_:2},1032,["items"])):D("",!0)]),_:2},1032,["src","data","errors"])):(e(),f(b,{key:1,src:`/meshes/${A.params.mesh}/dataplanes/${A.params.proxy}/sidecar-dataplane-policies`,data:[O],errors:[S]},{default:a(({data:h})=>[i(d,{empty:!1,items:h.policyTypeEntries,predicate:m=>$[m.type]?.policy.isTargetRef===!1},{default:a(({items:m})=>[p("h3",null,r(P("data-planes.routes.item.legacy_policies")),1),t[8]||(t[8]=n()),i(X,{class:"mt-4"},{default:a(()=>[i(_e,{items:m,types:$,"data-testid":"sidecar-dataplane-policies"},null,8,["items","types"])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1032,["src","data","errors"]))]))],64))),128)),t[10]||(t[10]=n()),i(k,null,{default:a(({Component:$})=>[A.child()&&O?(e(),f(u,{key:0,onClose:h=>A.replace({name:"data-plane-policies-view",params:{mesh:A.params.mesh,proxy:A.params.proxy}})},{default:a(()=>[(e(),f(te($),{"policy-types":O.policyTypes},null,8,["policy-types"]))]),_:2},1032,["onClose"])):D("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1024)]),_:1})}}});export{Pe as default};
