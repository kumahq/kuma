import{d as A,o as e,c as b,w as l,j as a,n as D,cl as j,J,l as t,F as _,t as o,a as h,b as P,z as T,u as v,K as le,cK as oe,R as Z,cm as W,i as X,D as x,B as Q,C as ee,r as L,g as K,k as E,q as z,f as I,cA as ie,cz as H,cC as re,x as ce,cL as ue,A as de,M as pe,y as me,ck as he,cH as _e,cI as ye,cM as ve,cJ as fe,cv as ge,p as Pe}from"./index.c8163df9.js";import{_ as ae}from"./EmptyBlock.vue_vue_type_script_setup_true_lang.045a908b.js";import{E as te}from"./ErrorBlock.5027dcb1.js";import{_ as se}from"./LoadingBlock.vue_vue_type_script_setup_true_lang.c066d224.js";import{S as ke,E as V}from"./EnvoyData.2e55bbd9.js";import{_ as Y}from"./LabelList.vue_vue_type_style_index_0_lang.17654be9.js";import{T as we}from"./TabsWidget.33f56719.js";import{Y as De}from"./YamlView.67836ee1.js";import{a as be,S as $e}from"./SubscriptionHeader.64a00821.js";import{W as Le}from"./WarningsWidget.fee34c93.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.14084b4c.js";import"./_commonjsHelpers.f037b798.js";import"./index.58caa11d.js";const Se={class:"dataplane-policy-header"},Ce={class:"dataplane-policy-subtitle"},Ie={key:0,class:"badge-list"},Te={class:"policy-wrapper"},Me={class:"policy-type"},Oe={key:0},Ne=A({__name:"SidecarDataplanePolicyList",props:{sidecarDataplanePolicies:{type:Array,required:!0}},setup(u){const i=u,S={inbound:"Policies applied on incoming connection on address",outbound:"Policies applied on outgoing connection to the address",service:"Policies applied on outgoing connections to service",dataplane:"Policies applied on all incoming and outgoing connections to the selected data plane proxy"};return(k,f)=>{const m=X("router-link");return e(),b(W,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),a(_,null,D(i.sidecarDataplanePolicies,(s,p)=>(e(),b(j,{key:p},J({"accordion-header":l(()=>[t("div",Se,[t("div",null,[t("p",null,[s.type==="dataplane"?(e(),a(_,{key:0},[P(" Dataplane ")],64)):(e(),a(_,{key:1},[P(o(s.service),1)],64))]),t("p",Ce,[s.type==="inbound"||s.type==="outbound"?(e(),a(_,{key:0},[P(o(s.type)+" "+o(s.name),1)],64)):s.type==="service"||s.type==="dataplane"?(e(),a(_,{key:1},[P(o(s.type),1)],64)):T("",!0),h(v(oe),{width:"300",placement:"right",trigger:"hover"},{content:l(()=>[P(o(S[s.type]),1)]),default:l(()=>[h(v(le),{icon:"help",size:"16",class:"ml-1"})]),_:2},1024)])]),s.matchedPolicies.length>0?(e(),a("div",Ie,[(e(!0),a(_,null,D(s.matchedPolicies,(g,y)=>(e(),b(v(Z),{key:`${p}-${y}`},{default:l(()=>[P(o(g.name),1)]),_:2},1024))),128))])):T("",!0)])]),_:2},[s.matchedPolicies.length>0?{name:"accordion-content",fn:l(()=>[t("div",Te,[(e(!0),a(_,null,D(s.matchedPolicies,(g,y)=>(e(),a("div",{key:`${p}-${y}`},[t("p",Me,o(g.pluralName),1),g.policies.length>0?(e(),a("ul",Oe,[(e(!0),a(_,null,D(g.policies,(w,O)=>(e(),a("li",{key:`${p}-${y}-${O}`,"data-testid":"policy-name"},[h(m,{to:w.route},{default:l(()=>[P(o(w.name),1)]),_:2},1032,["to"])]))),128))])):T("",!0)]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:1})}}});const Ae=x(Ne,[["__scopeId","data-v-84de6b02"]]),N=u=>(Q("data-v-5d6a081d"),u=u(),ee(),u),Ge={class:"mesh-gateway-policy-list"},Ee=N(()=>t("h3",null,"Gateway policies",-1)),xe={key:0,class:"policy-list"},Be=N(()=>t("h3",{class:"mt-6"}," Listeners ",-1)),qe=N(()=>t("b",null,"Host",-1)),Re=N(()=>t("h4",{class:"mt-2"}," Routes ",-1)),Ve={class:"dataplane-policy-header"},Ke=N(()=>t("b",null,"Route",-1)),je=N(()=>t("b",null,"Service",-1)),We={key:0,class:"badge-list"},ze={class:"policy-list mt-1"},Fe=A({__name:"MeshGatewayDataplanePolicyList",props:{meshGatewayDataplane:{type:Object,required:!0},meshGatewayListenerEntries:{type:Array,required:!0},meshGatewayRoutePolicies:{type:Array,required:!0}},setup(u){const i=u;return(S,k)=>{const f=X("router-link");return e(),a("div",Ge,[Ee,u.meshGatewayRoutePolicies.length>0?(e(),a("ul",xe,[(e(!0),a(_,null,D(u.meshGatewayRoutePolicies,(m,s)=>(e(),a("li",{key:s},[t("span",null,o(m.type),1),P(": "),h(f,{to:m.route},{default:l(()=>[P(o(m.name),1)]),_:2},1032,["to"])]))),128))])):T("",!0),Be,t("div",null,[(e(!0),a(_,null,D(i.meshGatewayListenerEntries,(m,s)=>(e(),a("div",{key:s},[t("div",null,[t("div",null,[qe,P(": "+o(m.hostName)+":"+o(m.port)+" ("+o(m.protocol)+") ",1)]),m.routeEntries.length>0?(e(),a(_,{key:0},[Re,h(W,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),a(_,null,D(m.routeEntries,(p,g)=>(e(),b(j,{key:g},J({"accordion-header":l(()=>[t("div",Ve,[t("div",null,[t("div",null,[Ke,P(": "),h(f,{to:p.route},{default:l(()=>[P(o(p.routeName),1)]),_:2},1032,["to"])]),t("div",null,[je,P(": "+o(p.service),1)])]),p.policies.length>0?(e(),a("div",We,[(e(!0),a(_,null,D(p.policies,(y,w)=>(e(),b(v(Z),{key:`${s}-${w}`},{default:l(()=>[P(o(y.type),1)]),_:2},1024))),128))])):T("",!0)])]),_:2},[p.policies.length>0?{name:"accordion-content",fn:l(()=>[t("ul",ze,[(e(!0),a(_,null,D(p.policies,(y,w)=>(e(),a("li",{key:`${s}-${w}`},[P(o(y.type)+": ",1),h(f,{to:y.route},{default:l(()=>[P(o(y.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):T("",!0)])]))),128))])])}}});const Ue=x(Fe,[["__scopeId","data-v-5d6a081d"]]),He={key:2,class:"policies-list"},Ye={key:3,class:"policies-list"},Je=A({__name:"DataplanePolicies",props:{dataPlane:{type:Object,required:!0}},setup(u){const i=u,S=z(),k=L(null),f=L([]),m=L([]),s=L([]),p=L(!0),g=L(null);K(()=>i.dataPlane.name,function(){y()}),y();async function y(){var $,c;g.value=null,p.value=!0,f.value=[],m.value=[],s.value=[];try{if(((c=($=i.dataPlane.networking.gateway)==null?void 0:$.type)==null?void 0:c.toUpperCase())==="BUILTIN")k.value=await E.getMeshGatewayDataplane({mesh:i.dataPlane.mesh,name:i.dataPlane.name}),m.value=w(k.value),s.value=O(k.value.policies);else{const{items:n}=await E.getSidecarDataplanePolicies({mesh:i.dataPlane.mesh,name:i.dataPlane.name});f.value=B(n)}}catch(r){r instanceof Error?g.value=r:console.error(r)}finally{p.value=!1}}function w($){const c=[];for(const r of $.listeners)for(const n of r.hosts)for(const d of n.routes){const M=[];for(const C of d.destinations){const G=O(C.policies),q={routeName:d.route,route:{name:"meshgatewayroutes",params:{mesh:$.gateway.mesh},query:{ns:d.route}},service:C.tags["kuma.io/service"],policies:G};M.push(q)}c.push({protocol:r.protocol,port:r.port,hostName:n.hostName,routeEntries:M})}return c}function O($){if($===void 0)return[];const c=[];for(const r of Object.values($)){const n=S.state.policiesByType[r.type];c.push({type:r.type,name:r.name,route:{name:n.path,params:{mesh:r.mesh},query:{ns:r.name}}})}return c}function B($){const c=[];for(const r of $){const n=[];for(const[G,q]of Object.entries(r.matchedPolicies)){const F=S.state.policiesByType[G],U=[];for(const R of q)U.push({name:R.name,route:{name:F.path,query:{ns:R.name},params:{mesh:R.mesh}}});n.push({name:G,pluralName:F.pluralDisplayName,policies:U})}const{name:d,type:M,service:C}=r;c.push({name:d,type:M,service:C,matchedPolicies:n})}return c}return($,c)=>p.value?(e(),b(se,{key:0})):g.value!==null?(e(),b(te,{key:1,error:g.value},null,8,["error"])):f.value.length>0?(e(),a("div",He,[h(Ae,{"sidecar-dataplane-policies":f.value},null,8,["sidecar-dataplane-policies"])])):m.value.length>0&&k.value!==null?(e(),a("div",Ye,[h(Ue,{"mesh-gateway-dataplane":k.value,"mesh-gateway-listener-entries":m.value,"mesh-gateway-route-policies":s.value},null,8,["mesh-gateway-dataplane","mesh-gateway-listener-entries","mesh-gateway-route-policies"])])):(e(),b(ae,{key:4}))}});const Ze=x(Je,[["__scopeId","data-v-34268377"]]),ne=u=>(Q("data-v-ec63e4f6"),u=u(),ee(),u),Xe={key:0},Qe={key:1},ea=ne(()=>t("h4",null,"Tags",-1)),aa=ne(()=>t("h4",null,"Versions",-1)),ta={class:"config-wrapper"},sa={key:0},na=["href"],la=A({__name:"DataPlaneDetails",props:{dataPlane:{type:Object,required:!0},dataPlaneOverview:{type:Object,required:!0}},setup(u){const i=u,S=z(),k=[{hash:"#overview",title:"Overview"},{hash:"#insights",title:"DPP Insights"},{hash:"#dpp-policies",title:"Policies"},{hash:"#xds-configuration",title:"XDS Configuration"},{hash:"#envoy-stats",title:"Stats"},{hash:"#envoy-clusters",title:"Clusters"},{hash:"#mtls",title:"Certificate Insights"},{hash:"#warnings",title:"Warnings"}],f=L([]),m=I(()=>{const{type:c,name:r,mesh:n}=i.dataPlane,d=ie(i.dataPlane,i.dataPlaneOverview.dataplaneInsight);return{type:c,name:r,mesh:n,status:d}}),s=I(()=>H(i.dataPlane)),p=I(()=>re(i.dataPlaneOverview.dataplaneInsight)),g=I(()=>ce(i.dataPlane)),y=I(()=>ue(i.dataPlaneOverview)),w=I(()=>{const c=Array.from(i.dataPlaneOverview.dataplaneInsight.subscriptions);return c.reverse(),c}),O=I(()=>{const c=S.getters["config/getKumaDocsVersion"];return c!==null?c:"latest"}),B=I(()=>f.value.length===0?k.filter(c=>c.hash!=="#warnings"):k);function $(){const c=i.dataPlaneOverview.dataplaneInsight.subscriptions;if(c.length===0||!("version"in c[0]))return;const r=c[0].version;if(r&&r.kumaDp&&r.envoy){const d=_e(r);d.kind!==ye&&d.kind!==ve&&f.value.push(d)}S.getters["config/getMulticlusterStatus"]&&r&&H(i.dataPlane).find(C=>C.label===fe)&&typeof r.kumaDp.kumaCpCompatible=="boolean"&&!r.kumaDp.kumaCpCompatible&&f.value.push({kind:ge,payload:{kumaDp:r.kumaDp.version}})}return $(),(c,r)=>(e(),b(we,{tabs:v(B),"initial-tab-override":"overview"},{tabHeader:l(()=>[t("div",null,[t("h3",null," DPP: "+o(u.dataPlane.name),1)])]),overview:l(()=>[h(Y,null,{default:l(()=>[t("div",null,[t("ul",null,[(e(!0),a(_,null,D(v(m),(n,d)=>(e(),a("li",{key:d},[t("h4",null,o(d),1),d==="status"&&typeof n!="string"?(e(),a("div",Xe,[t("div",{class:de(["entity-status",{"is-offline":n.status.toLowerCase()==="offline","is-online":n.status.toLowerCase()==="online","is-degraded":n.status.toLowerCase()==="partially degraded","is-not-available":n.status.toLowerCase()==="not available"}])},[t("span",null,o(n.status),1)],2),(e(!0),a(_,null,D(n.reason,(M,C)=>(e(),a("div",{key:C,class:"reason"},o(M),1))),128))])):(e(),a("div",Qe,o(n),1))]))),128))])]),t("div",null,[v(s).length>0?(e(),a(_,{key:0},[ea,t("p",null,[(e(!0),a(_,null,D(v(s),(n,d)=>(e(),a("span",{key:d,class:"tag-cols"},[t("span",null,o(n.label)+": ",1),t("span",null,o(n.value),1)]))),128))])],64)):T("",!0),v(p)?(e(),a(_,{key:1},[aa,t("p",null,[(e(!0),a(_,null,D(v(p),(n,d)=>(e(),a("span",{key:d,class:"tag-cols"},[t("span",null,o(d)+": ",1),t("span",null,o(n),1)]))),128))])],64)):T("",!0)])]),_:1}),t("div",ta,[h(De,{id:"code-block-data-plane",content:v(g),"is-searchable":""},null,8,["content"])])]),insights:l(()=>[h(ke,{"is-empty":v(w).length===0},{default:l(()=>[h(v(pe),{"border-variant":"noBorder"},{body:l(()=>[h(W,{"initially-open":0},{default:l(()=>[(e(!0),a(_,null,D(v(w),(n,d)=>(e(),b(j,{key:d},{"accordion-header":l(()=>[h(be,{details:n},null,8,["details"])]),"accordion-content":l(()=>[h($e,{details:n,"is-discovery-subscription":""},null,8,["details"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["is-empty"])]),"dpp-policies":l(()=>[h(Ze,{"data-plane":u.dataPlane},null,8,["data-plane"])]),"xds-configuration":l(()=>[h(V,{"data-path":"xds",mesh:u.dataPlane.mesh,"dpp-name":u.dataPlane.name,"query-key":"envoy-data-data-plane"},null,8,["mesh","dpp-name"])]),"envoy-stats":l(()=>[h(V,{"data-path":"stats",mesh:u.dataPlane.mesh,"dpp-name":u.dataPlane.name,"query-key":"envoy-data-data-plane"},null,8,["mesh","dpp-name"])]),"envoy-clusters":l(()=>[h(V,{"data-path":"clusters",mesh:u.dataPlane.mesh,"dpp-name":u.dataPlane.name,"query-key":"envoy-data-data-plane"},null,8,["mesh","dpp-name"])]),mtls:l(()=>[h(Y,null,{default:l(()=>[v(y)!==null?(e(),a("ul",sa,[(e(!0),a(_,null,D(v(y),(n,d)=>(e(),a("li",{key:d},[t("h4",null,o(n.label),1),t("p",null,o(n.value),1)]))),128))])):(e(),b(v(me),{key:1,appearance:"danger"},{alertMessage:l(()=>[P(" This data plane proxy does not yet have mTLS configured \u2014 "),t("a",{href:`https://kuma.io/docs/${v(O)}/policies/mutual-tls/`,class:"external-link",target:"_blank"}," Learn About Certificates in "+o(v(he)),9,na)]),_:1}))]),_:1})]),warnings:l(()=>[h(Le,{warnings:f.value},null,8,["warnings"])]),_:1},8,["tabs"]))}});const oa=x(la,[["__scopeId","data-v-ec63e4f6"]]),ia={class:"component-frame"},ka=A({__name:"DataPlaneDetailView",setup(u){const i=Pe(),S=z(),k=L(null),f=L(null),m=L(!0),s=L(null);async function p(){s.value=null,m.value=!0;const g=i.params.mesh,y=i.params.dataPlane;try{k.value=await E.getDataplaneFromMesh({mesh:g,name:y}),f.value=await E.getDataplaneOverviewFromMesh({mesh:g,name:y})}catch(w){k.value=null,w instanceof Error?s.value=w:console.error(w)}finally{m.value=!1}}return K(()=>i.params.mesh,function(){i.name==="data-plane-detail-view"&&p()}),K(()=>i.params.dataPlane,function(){i.name==="data-plane-detail-view"&&p()}),p(),S.dispatch("updatePageTitle",i.params.dataPlane),(g,y)=>(e(),a("div",ia,[m.value?(e(),b(se,{key:0})):s.value!==null?(e(),b(te,{key:1,error:s.value},null,8,["error"])):k.value===null||f.value===null?(e(),b(ae,{key:2})):(e(),b(oa,{key:3,"data-plane":k.value,"data-plane-overview":f.value},null,8,["data-plane","data-plane-overview"]))]))}});export{ka as default};
