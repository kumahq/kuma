import{a as D,A as G}from"./AccordionList-BWQdXgNH.js";import{d as x,r as b,c as s,o as e,l as i,e as l,q as S,N as o,L as _,b as n,t as r,w as a,p as k,M as H,_ as M,m as R,Y,ae as K,k as J,n as Q,K as U,F as W,a9 as Z,y as E}from"./index-CHUyLuna.js";import{S as ee}from"./SummaryView-B_VTmqHS.js";import{P as q}from"./PolicyTypeTag-DxTN8QRp.js";import{T as z}from"./TagList-m8GBpf7x.js";import{R as te}from"./RuleMatchers-CfJQ3LKb.js";const se={class:"policies-list"},ae={class:"mesh-gateway-policy-list"},le={key:0},ne={class:"dataplane-policy-header"},oe={key:0,class:"badge-list"},ie={class:"mt-1"},re=x({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},types:{}},setup(X){const $=X;return(P,t)=>{const L=b("XAction"),w=b("XBadge");return e(),s("div",se,[i("div",ae,[t[11]||(t[11]=i("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),t[12]||(t[12]=l()),P.gatewayDataplane.routePolicies.length>0?(e(),s("ul",le,[(e(!0),s(o,null,_(P.gatewayDataplane.routePolicies,(u,d)=>(e(),s("li",{key:d},[i("span",null,r(u.type),1),t[0]||(t[0]=l(`:

          `,-1)),n(L,{to:{name:"policy-detail-view",params:{mesh:u.mesh,policyPath:$.types[u.type]?.path??"",policy:u.name}}},{default:a(()=>[l(r(u.name),1)]),_:2},1032,["to"])]))),128))])):S("",!0),t[13]||(t[13]=l()),t[14]||(t[14]=i("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),t[15]||(t[15]=l()),i("div",null,[(e(!0),s(o,null,_(P.gatewayDataplane.listenerEntries,(u,d)=>(e(),s("div",{key:d},[i("div",null,[i("div",null,[t[1]||(t[1]=i("b",null,"Host",-1)),l(": "+r(u.hostName)+":"+r(u.port)+" ("+r(u.protocol)+`)
            `,1)]),t[10]||(t[10]=l()),u.routeEntries.length>0?(e(),s(o,{key:0},[t[8]||(t[8]=i("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),t[9]||(t[9]=l()),n(G,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(o,null,_(u.routeEntries,(m,p)=>(e(),k(D,{key:p},H({"accordion-header":a(()=>[i("div",ne,[i("div",null,[i("div",null,[t[2]||(t[2]=i("b",null,"Route",-1)),t[3]||(t[3]=l(": ",-1)),n(L,{to:{name:"policy-detail-view",params:{mesh:m.route.mesh,policyPath:$.types[m.route.type]?.path??"",policy:m.route.name}}},{default:a(()=>[l(r(m.route.name),1)]),_:2},1032,["to"])]),t[5]||(t[5]=l()),i("div",null,[t[4]||(t[4]=i("b",null,"Service",-1)),l(": "+r(m.service),1)])]),t[6]||(t[6]=l()),m.origins.length>0?(e(),s("div",oe,[(e(!0),s(o,null,_(m.origins,(c,g)=>(e(),k(w,{key:`${d}-${g}`},{default:a(()=>[l(r(c.type),1)]),_:2},1024))),128))])):S("",!0)])]),_:2},[m.origins.length>0?{name:"accordion-content",fn:a(()=>[i("ul",ie,[(e(!0),s(o,null,_(m.origins,(c,g)=>(e(),s("li",{key:`${d}-${g}`},[l(r(c.type)+`:

                        `,1),n(L,{to:{name:"policy-detail-view",params:{mesh:c.mesh,policyPath:$.types[c.type]?.path??"",policy:c.name}}},{default:a(()=>[l(r(c.name),1)]),_:2},1032,["to"])]))),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):S("",!0)])]))),128))])])])}}}),pe=M(re,[["__scopeId","data-v-a5c76432"]]),ue={class:"policy-type-heading"},de={class:"policy-list"},me={key:0},ce=x({__name:"PolicyTypeEntryList",props:{items:{},types:{}},setup(X){const $=X;function P({headerKey:t}){return{class:`cell-${t}`}}return(t,L)=>{const w=b("XAction"),u=b("XCodeBlock");return e(),k(G,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(o,null,_(t.items,(d,m)=>(e(),k(D,{key:m},{"accordion-header":a(()=>[i("h3",ue,[n(q,{"policy-type":d.type},{default:a(()=>[l(r(d.type)+" ("+r(d.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[i("div",de,[n(R(K),{class:"policy-type-table",data:d.connections,headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":P,"hide-pagination":"","is-clickable":""},{sourceTags:a(({row:p})=>[p.sourceTags.length>0?(e(),k(z,{key:0,class:"tag-list","should-truncate":"",tags:p.sourceTags},null,8,["tags"])):(e(),s(o,{key:1},[l(`
                —
              `)],64))]),destinationTags:a(({row:p})=>[p.destinationTags.length>0?(e(),k(z,{key:0,class:"tag-list","should-truncate":"",tags:p.destinationTags},null,8,["tags"])):(e(),s(o,{key:1},[l(`
                —
              `)],64))]),name:a(({row:p})=>[p.name!==null?(e(),s(o,{key:0},[l(r(p.name),1)],64)):(e(),s(o,{key:1},[l(`
                —
              `)],64))]),origins:a(({row:p})=>[p.origins.length>0?(e(),s("ul",me,[(e(!0),s(o,null,_(p.origins,(c,g)=>(e(),s("li",{key:`${m}-${g}`},[n(w,{to:{name:"policy-detail-view",params:{mesh:c.mesh,policyPath:$.types[c.type]?.path??"",policy:c.name}}},{default:a(()=>[l(r(c.name),1)]),_:2},1032,["to"])]))),128))])):(e(),s(o,{key:1},[l(`
                —
              `)],64))]),config:a(({row:p})=>[p.config?(e(),k(u,{key:0,code:R(Y).stringify(p.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(o,{key:1},[l(`
                —
              `)],64))]),_:2},1032,["data"])])]),_:2},1024))),128))]),_:1})}}}),ye=M(ce,[["__scopeId","data-v-87cbbf3b"]]),fe={class:"policy-type-heading"},_e={key:0,class:"matcher"},ge={key:1},ke={key:0},he=x({__name:"RuleList",props:{rules:{},types:{}},setup(X){const{t:$}=J(),P=X;return(t,L)=>{const w=b("XAction"),u=b("XCodeBlock");return e(),k(G,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(o,null,_([P.rules.reduce((d,m)=>(typeof d[m.type]>"u"&&(d[m.type]=[]),d[m.type].push(m),d),{})],d=>(e(),s(o,{key:d},[(e(!0),s(o,null,_(d,(m,p)=>(e(),k(D,{key:p},{"accordion-header":a(()=>[i("h3",fe,[n(q,{"policy-type":p},{default:a(()=>[l(r(p),1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[(e(!0),s(o,null,_([m.some(c=>c.matchers.length>0)],c=>(e(),s("div",{key:c,class:"policy-list"},[n(U,{class:Q(["policy-type-table",{"has-matchers":c}]),items:m,headers:[...c?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:a(({row:g})=>[g.matchers.length>0?(e(),s("span",_e,[n(te,{items:g.matchers},null,8,["items"])])):(e(),s("i",ge,r(R($)("data-planes.routes.item.matches_everything")),1))]),origins:a(({row:g})=>[g.origins.length>0?(e(),s("ul",ke,[(e(!0),s(o,null,_(g.origins,(V,I)=>(e(),s("li",{key:`${p}-${I}`},[n(w,{to:{name:"data-plane-policy-summary-view",params:{mesh:V.mesh,policyPath:P.types[V.type]?.path??"",policy:V.name}}},{default:a(()=>[l(r(V.name),1)]),_:2},1032,["to"])]))),128))])):(e(),s(o,{key:1},[l(r(R($)("common.collection.none")),1)],64))]),config:a(({row:g})=>[Object.keys(g.raw).length>0?(e(),k(u,{key:0,code:R(Y).stringify(g.raw),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(o,{key:1},[l(r(R($)("common.collection.none")),1)],64))]),_:2},1032,["class","items","headers"])]))),128))]),_:2},1024))),128))],64))),128))]),_:1})}}}),T=M(he,[["__scopeId","data-v-8b58b2bd"]]),be={class:"mb-2"},ve={class:"mb-2"},$e={key:0},Xe=x({__name:"DataPlanePoliciesView",props:{data:{}},setup(X){const $=X;return(P,t)=>{const L=b("RouteTitle"),w=b("XCard"),u=b("DataCollection"),d=b("DataLoader"),m=b("RouterView"),p=b("DataSource"),c=b("AppView"),g=b("RouteView");return e(),k(g,{name:"data-plane-policies-view",params:{mesh:"",proxy:""}},{default:a(({uri:V,can:I,route:C,t:B})=>[n(L,{render:!1,title:B("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"]),t[11]||(t[11]=l()),n(c,null,{default:a(()=>[n(p,{src:V(R(W),"/policy-types",{})},{default:a(({data:O,error:F})=>[(e(!0),s(o,null,_([(O?.policyTypes??[]).reduce((v,h)=>Object.assign(v,{[h.name]:h}),{})],v=>(e(),s(o,{key:typeof v},[n(d,{src:V(R(Z),"/meshes/:mesh/rules/for/:dataplane",{mesh:C.params.mesh,dataplane:C.params.proxy}),data:[O],errors:[F]},{default:a(({data:h})=>[n(u,{items:h.rules},{default:a(()=>[(e(),s(o,null,_(["proxy","to"],y=>n(u,{key:y,items:h.rules,predicate:f=>f.ruleType===y,comparator:(f,A)=>f.type.localeCompare(A.type),empty:!1},{default:a(({items:f})=>[n(w,null,{default:a(()=>[i("h3",null,r(B(`data-planes.routes.item.rules.${y}`)),1),t[0]||(t[0]=l()),n(T,{class:"mt-2",rules:f,types:v,"data-testid":`${y}-rule-list`},null,8,["rules","types","data-testid"])]),_:2},1024)]),_:2},1032,["items","predicate","comparator"])),64)),t[5]||(t[5]=l()),n(u,{items:h.rules,predicate:y=>y.ruleType==="from"&&!v[y.type]?.policy.isFromAsRules,comparator:(y,f)=>y.type.localeCompare(f.type),empty:!1},{default:a(({items:y})=>[n(w,null,{default:a(()=>[i("h3",be,r(B("data-planes.routes.item.rules.from")),1),t[2]||(t[2]=l()),(e(!0),s(o,null,_([Object.groupBy(y,f=>f.inbound.port)],f=>(e(),s(o,{key:f},[(e(!0),s(o,null,_(Object.entries(f).sort(([A],[N])=>Number(N)-Number(A)),([A,N],j)=>(e(),s("div",{key:j},[i("h4",null,r(B("data-planes.routes.item.port",{port:A})),1),t[1]||(t[1]=l()),n(T,{class:"mt-2",rules:N,types:v,"data-testid":`from-rule-list-${j}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","predicate","comparator"]),t[6]||(t[6]=l()),n(u,{items:h.inboundRules,comparator:(y,f)=>y.type.localeCompare(f.type),empty:!1},{default:a(({items:y})=>[n(w,null,{default:a(()=>[i("h3",ve,r(B("data-planes.routes.item.rules.inbound")),1),t[4]||(t[4]=l()),(e(!0),s(o,null,_([Object.groupBy(y,f=>f.inbound.port)],f=>(e(),s(o,{key:f},[(e(!0),s(o,null,_(Object.entries(f).sort(([A],[N])=>Number(N)-Number(A)),([A,N],j)=>(e(),s("div",{key:j},[i("h4",null,r(B("data-planes.routes.item.port",{port:A})),1),t[3]||(t[3]=l()),n(T,{class:"mt-2",rules:N,types:v,"data-testid":`inbound-rule-list-${j}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","comparator"])]),_:2},1032,["items"])]),_:2},1032,["src","data","errors"]),t[9]||(t[9]=l()),I("use zones")?S("",!0):(e(),s("div",$e,[$.data.dataplaneType==="builtin"?(e(),k(d,{key:0,src:`/meshes/${C.params.mesh}/dataplanes/${C.params.proxy}/gateway-dataplane-policies`,data:[O],errors:[F]},{default:a(({data:h})=>[h?(e(),k(u,{key:0,items:h.routePolicies,empty:!1},{default:a(()=>[i("h3",null,r(B("data-planes.routes.item.legacy_policies")),1),t[7]||(t[7]=l()),n(w,{class:"mt-4"},{default:a(()=>[n(pe,{types:v,"gateway-dataplane":h,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["types","gateway-dataplane"])]),_:2},1024)]),_:2},1032,["items"])):S("",!0)]),_:2},1032,["src","data","errors"])):(e(),k(d,{key:1,src:`/meshes/${C.params.mesh}/dataplanes/${C.params.proxy}/sidecar-dataplane-policies`,data:[O],errors:[F]},{default:a(({data:h})=>[n(u,{empty:!1,items:h.policyTypeEntries,predicate:y=>v[y.type]?.policy.isTargetRef===!1},{default:a(({items:y})=>[i("h3",null,r(B("data-planes.routes.item.legacy_policies")),1),t[8]||(t[8]=l()),n(w,{class:"mt-4"},{default:a(()=>[n(ye,{items:y,types:v,"data-testid":"sidecar-dataplane-policies"},null,8,["items","types"])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1032,["src","data","errors"]))]))],64))),128)),t[10]||(t[10]=l()),n(m,null,{default:a(({Component:v})=>[C.child()&&O?(e(),k(ee,{key:0,onClose:h=>C.replace({name:"data-plane-policies-view",params:{mesh:C.params.mesh,proxy:C.params.proxy}})},{default:a(()=>[(e(),k(E(v),{"policy-types":O.policyTypes},null,8,["policy-types"]))]),_:2},1032,["onClose"])):S("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1024)]),_:1})}}});export{Xe as default};
