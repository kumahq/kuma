import{d as x,r as M,o as t,a as d,w as a,e as i,F as y,v as O,i as $,h as u,g as l,t as v,b as N,B as w,f as q,c as I,k as Q}from"./index-8422fc56.js";import{A as Y,a as z}from"./AccordionList-0d929a26.js";import{_ as G}from"./CodeBlock.vue_vue_type_style_index_0_lang-471ad284.js";import{P as J}from"./PolicyTypeTag-41698e02.js";import{T as j}from"./TagList-84bd2a30.js";import{d as K,e as U,A as W,g as S,E as D,f as X,_ as Z}from"./RouteView.vue_vue_type_script_setup_true_lang-90043e39.js";import{t as H}from"./toYaml-4e00099e.js";import{_ as V}from"./RouteTitle.vue_vue_type_script_setup_true_lang-2207a44e.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-0fd32299.js";const ee={class:"policy-type-heading"},te={class:"policy-list"},se={key:0},ne=x({__name:"PolicyTypeEntryList",props:{id:{type:String,required:!1,default:"entry-list"},policyTypeEntries:{type:Object,required:!0}},setup(E){const _=E,C=[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}];function T({headerKey:m}){return{class:`cell-${m}`}}return(m,P)=>{const b=M("router-link");return t(),d(z,{"initially-open":[],"multiple-open":""},{default:a(()=>[(t(!0),i(y,null,O(_.policyTypeEntries,(r,n)=>(t(),d(Y,{key:n},{"accordion-header":a(()=>[$("h3",ee,[u(J,{"policy-type":r.type},{default:a(()=>[l(v(r.type)+" ("+v(r.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[$("div",te,[u(N(w),{class:"policy-type-table",fetcher:()=>({data:r.connections,total:r.connections.length}),headers:C,"cell-attrs":T,"disable-pagination":"","is-clickable":""},{sourceTags:a(({rowValue:e})=>[e.length>0?(t(),d(j,{key:0,class:"tag-list",tags:e},null,8,["tags"])):(t(),i(y,{key:1},[l(`
                —
              `)],64))]),destinationTags:a(({rowValue:e})=>[e.length>0?(t(),d(j,{key:0,class:"tag-list",tags:e},null,8,["tags"])):(t(),i(y,{key:1},[l(`
                —
              `)],64))]),name:a(({rowValue:e})=>[e!==null?(t(),i(y,{key:0},[l(v(e),1)],64)):(t(),i(y,{key:1},[l(`
                —
              `)],64))]),origins:a(({rowValue:e})=>[e.length>0?(t(),i("ul",se,[(t(!0),i(y,null,O(e,(o,s)=>(t(),i("li",{key:`${n}-${s}`},[u(b,{to:o.route},{default:a(()=>[l(v(o.name),1)]),_:2},1032,["to"])]))),128))])):(t(),i(y,{key:1},[l(`
                —
              `)],64))]),config:a(({rowValue:e,rowKey:o})=>[e!==null?(t(),d(G,{key:0,id:`${_.id}-${n}-${o}-code-block`,code:e,language:"yaml","show-copy-button":!1},null,8,["id","code"])):(t(),i(y,{key:1},[l(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}});const oe=K(ne,[["__scopeId","data-v-9a1971d5"]]),ie={class:"policy-type-heading"},ae={class:"policy-list"},le={key:1,class:"tag-list-wrapper"},ce={key:0},re={key:1},pe={key:0},ye={key:0},ue=x({__name:"RuleEntryList",props:{id:{type:String,required:!1,default:"entry-list"},ruleEntries:{type:Object,required:!0}},setup(E){const _=E,C=[{label:"Type",key:"type"},{label:"Addresses",key:"addresses"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}];function T({headerKey:m}){return{class:`cell-${m}`}}return(m,P)=>{const b=M("router-link");return t(),d(z,{"initially-open":[],"multiple-open":""},{default:a(()=>[(t(!0),i(y,null,O(_.ruleEntries,(r,n)=>(t(),d(Y,{key:n},{"accordion-header":a(()=>[$("h3",ie,[u(J,{"policy-type":r.type},{default:a(()=>[l(v(r.type)+" ("+v(r.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[$("div",ae,[u(N(w),{class:"policy-type-table",fetcher:()=>({data:r.connections,total:r.connections.length}),headers:C,"cell-attrs":T,"disable-pagination":"","is-clickable":""},{type:a(({rowValue:e})=>[e.sourceTags.length===0&&e.destinationTags.length===0?(t(),i(y,{key:0},[l(`
                —
              `)],64)):(t(),i("div",le,[e.sourceTags.length>0?(t(),i("div",ce,[l(`
                  From

                  `),u(j,{class:"tag-list",tags:e.sourceTags},null,8,["tags"])])):q("",!0),l(),e.destinationTags.length>0?(t(),i("div",re,[l(`
                  To

                  `),u(j,{class:"tag-list",tags:e.destinationTags},null,8,["tags"])])):q("",!0)]))]),addresses:a(({rowValue:e})=>[e.length>0?(t(),i("ul",pe,[(t(!0),i(y,null,O(e,(o,s)=>(t(),i("li",{key:`${n}-${s}`},v(o),1))),128))])):(t(),i(y,{key:1},[l(`
                —
              `)],64))]),origins:a(({rowValue:e})=>[e.length>0?(t(),i("ul",ye,[(t(!0),i(y,null,O(e,(o,s)=>(t(),i("li",{key:`${n}-${s}`},[u(b,{to:o.route},{default:a(()=>[l(v(o.name),1)]),_:2},1032,["to"])]))),128))])):(t(),i(y,{key:1},[l(`
                —
              `)],64))]),config:a(({rowValue:e,rowKey:o})=>[e!==null?(t(),d(G,{key:0,id:`${_.id}-${n}-${o}-code-block`,code:e,language:"yaml","show-copy-button":!1},null,8,["id","code"])):(t(),i(y,{key:1},[l(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}});const de=K(ue,[["__scopeId","data-v-3e59037c"]]),_e=$("h2",{class:"visually-hidden"},`
    Policies
  `,-1),me={key:0,class:"mt-2"},ge=$("h2",{class:"mb-2"},`
      Rules
    `,-1),fe=x({__name:"SidecarDataplanePolicyList",props:{sidecarDataplanes:{},rules:{},policyTypesByName:{}},setup(E){const _=E,C=I(()=>m(_.sidecarDataplanes)),T=I(()=>b(_.rules));function m(n){const e=new Map;for(const s of n){const{type:c,service:g}=s,f=typeof g=="string"&&g!==""?[{label:"kuma.io/service",value:g}]:[],h=c==="inbound"||c==="outbound"?s.name:null;for(const[p,A]of Object.entries(s.matchedPolicies)){e.has(p)||e.set(p,{type:p,connections:[]});const L=e.get(p),B=_.policyTypesByName[p];for(const F of A){const k=P(F,B,s,f,h);L.connections.push(...k)}}}const o=Array.from(e.values());return o.sort((s,c)=>s.type.localeCompare(c.type)),o}function P(n,e,o,s,c){const g=n.conf&&Object.keys(n.conf).length>0?H(n.conf):null,h=[{name:n.name,route:{name:"policy-detail-view",params:{mesh:n.mesh,policyPath:e.path,policy:n.name}}}],p=[];if(o.type==="inbound"&&Array.isArray(n.sources))for(const{match:A}of n.sources){const B={sourceTags:[{label:"kuma.io/service",value:A["kuma.io/service"]}],destinationTags:s,name:c,config:g,origins:h};p.push(B)}else{const L={sourceTags:[],destinationTags:s,name:c,config:g,origins:h};p.push(L)}return p}function b(n){const e=new Map;for(const s of n){e.has(s.policyType)||e.set(s.policyType,{type:s.policyType,connections:[]});const c=e.get(s.policyType),g=_.policyTypesByName[s.policyType],f=r(s,g);c.connections.push(...f)}const o=Array.from(e.values());return o.sort((s,c)=>s.type.localeCompare(c.type)),o}function r(n,e){const{type:o,service:s,subset:c,conf:g}=n,f=c?Object.entries(c):[];let h,p;o==="ClientSubset"?f.length>0?h=f.map(([k,R])=>({label:k,value:R})):h=[{label:"kuma.io/service",value:"*"}]:h=[],o==="DestinationSubset"?f.length>0?p=f.map(([k,R])=>({label:k,value:R})):typeof s=="string"&&s!==""?p=[{label:"kuma.io/service",value:s}]:p=[{label:"kuma.io/service",value:"*"}]:o==="ClientSubset"&&typeof s=="string"&&s!==""?p=[{label:"kuma.io/service",value:s}]:p=[];const A=n.addresses??[],L=g&&Object.keys(g).length>0?H(g):null,B=[];for(const k of n.origins)B.push({name:k.name,route:{name:"policy-detail-view",params:{mesh:k.mesh,policyPath:e.path,policy:k.name}}});return[{type:{sourceTags:h,destinationTags:p},addresses:A,config:L,origins:B}]}return(n,e)=>(t(),i(y,null,[_e,l(),u(oe,{id:"policies","policy-type-entries":C.value,"data-testid":"policy-list"},null,8,["policy-type-entries"]),l(),T.value.length>0?(t(),i("div",me,[ge,l(),u(de,{id:"rules","rule-entries":T.value,"data-testid":"rule-list"},null,8,["rule-entries"])])):q("",!0)],64))}}),Ae=x({__name:"DataPlanePoliciesView",setup(E){const{t:_}=U();return(C,T)=>(t(),d(Z,{name:"data-plane-policies-view","data-testid":"data-plane-policies-view"},{default:a(({route:m})=>[u(W,null,{title:a(()=>[$("h2",null,[u(V,{title:N(_)("data-planes.routes.item.navigation.data-plane-policies-view"),render:!0},null,8,["title"])])]),default:a(()=>[l(),u(N(Q),null,{body:a(()=>[u(S,{src:"/*/policy-types"},{default:a(({data:P,error:b})=>[u(S,{src:`/meshes/${m.params.mesh}/dataplanes/${m.params.name}/sidecar-dataplanes-policies`},{default:a(({data:r,error:n})=>[u(S,{src:`/meshes/${m.params.mesh}/dataplanes/${m.params.name}/rules`},{default:a(({data:e,error:o})=>[b?(t(),d(D,{key:0,error:b},null,8,["error"])):n?(t(),d(D,{key:1,error:n},null,8,["error"])):o?(t(),d(D,{key:2,error:o},null,8,["error"])):P===void 0||r===void 0||e===void 0?(t(),d(X,{key:3})):(t(),d(fe,{key:4,"policy-types-by-name":P.policies.reduce((s,c)=>Object.assign(s,{[c.name]:c}),{}),"sidecar-dataplanes":r.items,rules:e.items},null,8,["policy-types-by-name","sidecar-dataplanes","rules"]))]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}))}});export{Ae as default};
