import{a as K,A as T}from"./AccordionList-CUuGiheb.js";import{d as F,r as k,o as e,c as s,s as u,e as l,F as i,v as f,t as p,b as o,w as a,q as j,m as _,T as M,_ as z,p as S,a2 as D,k as Y,C as J,n as Q,ag as U,a0 as W,a1 as Z,K as E}from"./index-BU2LhWMU.js";import{S as ee}from"./SummaryView-CdpJfPUp.js";import{P as H}from"./PolicyTypeTag-CEUy_BJY.js";import{T as q}from"./TagList-DfDZdvNf.js";import{R as te}from"./RuleMatchers-H7oz8flZ.js";const se={class:"policies-list"},ae={class:"mesh-gateway-policy-list"},le={key:0},ne={class:"dataplane-policy-header"},oe={key:0,class:"badge-list"},ie={class:"mt-1"},re=F({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},types:{}},setup(V){const v=V;return(B,t)=>{const L=k("XAction"),$=k("XBadge");return e(),s("div",se,[u("div",ae,[t[11]||(t[11]=u("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),t[12]||(t[12]=l()),B.gatewayDataplane.routePolicies.length>0?(e(),s("ul",le,[(e(!0),s(i,null,f(B.gatewayDataplane.routePolicies,(r,c)=>{var d;return e(),s("li",{key:c},[u("span",null,p(r.type),1),t[0]||(t[0]=l(`:

          `)),o(L,{to:{name:"policy-detail-view",params:{mesh:r.mesh,policyPath:((d=v.types[r.type])==null?void 0:d.path)??"",policy:r.name}}},{default:a(()=>[l(p(r.name),1)]),_:2},1032,["to"])])}),128))])):j("",!0),t[13]||(t[13]=l()),t[14]||(t[14]=u("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),t[15]||(t[15]=l()),u("div",null,[(e(!0),s(i,null,f(B.gatewayDataplane.listenerEntries,(r,c)=>(e(),s("div",{key:c},[u("div",null,[u("div",null,[t[1]||(t[1]=u("b",null,"Host",-1)),l(": "+p(r.hostName)+":"+p(r.port)+" ("+p(r.protocol)+`)
            `,1)]),t[10]||(t[10]=l()),r.routeEntries.length>0?(e(),s(i,{key:0},[t[8]||(t[8]=u("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),t[9]||(t[9]=l()),o(T,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(i,null,f(r.routeEntries,(d,b)=>(e(),_(K,{key:b},M({"accordion-header":a(()=>{var n;return[u("div",ne,[u("div",null,[u("div",null,[t[2]||(t[2]=u("b",null,"Route",-1)),t[3]||(t[3]=l(": ")),o(L,{to:{name:"policy-detail-view",params:{mesh:d.route.mesh,policyPath:((n=v.types[d.route.type])==null?void 0:n.path)??"",policy:d.route.name}}},{default:a(()=>[l(p(d.route.name),1)]),_:2},1032,["to"])]),t[5]||(t[5]=l()),u("div",null,[t[4]||(t[4]=u("b",null,"Service",-1)),l(": "+p(d.service),1)])]),t[6]||(t[6]=l()),d.origins.length>0?(e(),s("div",oe,[(e(!0),s(i,null,f(d.origins,(g,w)=>(e(),_($,{key:`${c}-${w}`},{default:a(()=>[l(p(g.type),1)]),_:2},1024))),128))])):j("",!0)])]}),_:2},[d.origins.length>0?{name:"accordion-content",fn:a(()=>[u("ul",ie,[(e(!0),s(i,null,f(d.origins,(n,g)=>{var w;return e(),s("li",{key:`${c}-${g}`},[l(p(n.type)+`:

                        `,1),o(L,{to:{name:"policy-detail-view",params:{mesh:n.mesh,policyPath:((w=v.types[n.type])==null?void 0:w.path)??"",policy:n.name}}},{default:a(()=>[l(p(n.name),1)]),_:2},1032,["to"])])}),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):j("",!0)])]))),128))])])])}}}),ue=z(re,[["__scopeId","data-v-a5c76432"]]),pe={class:"policy-type-heading"},de={class:"policy-list"},me={key:0},ce=F({__name:"PolicyTypeEntryList",props:{items:{},types:{}},setup(V){const v=V;function B({headerKey:t}){return{class:`cell-${t}`}}return(t,L)=>{const $=k("XAction"),r=k("XCodeBlock"),c=k("KTable");return e(),_(T,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(i,null,f(t.items,(d,b)=>(e(),_(K,{key:b},{"accordion-header":a(()=>[u("h3",pe,[o(H,{"policy-type":d.type},{default:a(()=>[l(p(d.type)+" ("+p(d.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[u("div",de,[o(c,{class:"policy-type-table",fetcher:()=>({data:d.connections,total:d.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":B,"disable-pagination":"","is-clickable":""},{sourceTags:a(({row:n})=>[n.sourceTags.length>0?(e(),_(q,{key:0,class:"tag-list","should-truncate":"",tags:n.sourceTags},null,8,["tags"])):(e(),s(i,{key:1},[l(`
                —
              `)],64))]),destinationTags:a(({row:n})=>[n.destinationTags.length>0?(e(),_(q,{key:0,class:"tag-list","should-truncate":"",tags:n.destinationTags},null,8,["tags"])):(e(),s(i,{key:1},[l(`
                —
              `)],64))]),name:a(({row:n})=>[n.name!==null?(e(),s(i,{key:0},[l(p(n.name),1)],64)):(e(),s(i,{key:1},[l(`
                —
              `)],64))]),origins:a(({row:n})=>[n.origins.length>0?(e(),s("ul",me,[(e(!0),s(i,null,f(n.origins,(g,w)=>{var N;return e(),s("li",{key:`${b}-${w}`},[o($,{to:{name:"policy-detail-view",params:{mesh:g.mesh,policyPath:((N=v.types[g.type])==null?void 0:N.path)??"",policy:g.name}}},{default:a(()=>[l(p(g.name),1)]),_:2},1032,["to"])])}),128))])):(e(),s(i,{key:1},[l(`
                —
              `)],64))]),config:a(({row:n})=>[n.config?(e(),_(r,{key:0,code:S(D).stringify(n.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(i,{key:1},[l(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}}),ye=z(ce,[["__scopeId","data-v-3dd03e37"]]),fe={class:"policy-type-heading"},_e={key:0,class:"matcher"},ge={key:1},ke={key:0},he=F({__name:"RuleList",props:{rules:{},types:{}},setup(V){const{t:v}=Y(),B=V;return(t,L)=>{const $=k("XCodeBlock");return e(),_(T,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(i,null,f([B.rules.reduce((r,c)=>(typeof r[c.type]>"u"&&(r[c.type]=[]),r[c.type].push(c),r),{})],r=>(e(),s(i,{key:r},[(e(!0),s(i,null,f(r,(c,d)=>(e(),_(K,{key:d},{"accordion-header":a(()=>[u("h3",fe,[o(H,{"policy-type":d},{default:a(()=>[l(p(d),1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[(e(!0),s(i,null,f([c.some(b=>b.matchers.length>0)],b=>(e(),s("div",{key:b,class:"policy-list"},[o(J,{class:Q(["policy-type-table",{"has-matchers":b}]),items:c,headers:[...b?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:a(({row:n})=>[n.matchers.length>0?(e(),s("span",_e,[o(te,{items:n.matchers},null,8,["items"])])):(e(),s("i",ge,p(S(v)("data-planes.routes.item.matches_everything")),1))]),origins:a(({row:n})=>[n.origins.length>0?(e(),s("ul",ke,[(e(!0),s(i,null,f(n.origins,(g,w)=>{var N;return e(),s("li",{key:`${d}-${w}`},[o(U,{to:{name:"data-plane-policy-summary-view",params:{mesh:g.mesh,policyPath:((N=B.types[g.type])==null?void 0:N.path)??"",policy:g.name}}},{default:a(()=>[l(p(g.name),1)]),_:2},1032,["to"])])}),128))])):(e(),s(i,{key:1},[l(p(S(v)("common.collection.none")),1)],64))]),config:a(({row:n})=>[Object.keys(n.raw).length>0?(e(),_($,{key:0,code:S(D).stringify(n.raw),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(i,{key:1},[l(p(S(v)("common.collection.none")),1)],64))]),_:2},1032,["class","items","headers"])]))),128))]),_:2},1024))),128))],64))),128))]),_:1})}}}),G=z(he,[["__scopeId","data-v-6fd276d7"]]),be={class:"stack"},ve={class:"mb-2"},$e={class:"mb-2"},we={key:0},Ve=F({__name:"DataPlanePoliciesView",props:{data:{}},setup(V){const v=V;return(B,t)=>{const L=k("RouteTitle"),$=k("XCard"),r=k("DataCollection"),c=k("DataLoader"),d=k("DataSource"),b=k("RouterView"),n=k("AppView"),g=k("RouteView");return e(),_(g,{name:"data-plane-policies-view",params:{mesh:"",proxy:""}},{default:a(({uri:w,can:N,route:C,t:A})=>[o(L,{render:!1,title:A("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"]),t[11]||(t[11]=l()),o(n,null,{default:a(()=>[u("div",be,[o(d,{src:w(S(W),"/policy-types",{})},{default:a(({data:X,error:I})=>[(e(!0),s(i,null,f([((X==null?void 0:X.policyTypes)??[]).reduce((P,h)=>Object.assign(P,{[h.name]:h}),{})],P=>(e(),s(i,{key:typeof P},[o(c,{src:w(S(Z),"/meshes/:mesh/rules/for/:dataplane",{mesh:C.params.mesh,dataplane:C.params.proxy}),data:[X],errors:[I]},{default:a(({data:h})=>[o(r,{items:h.rules},{default:a(()=>[(e(),s(i,null,f(["proxy","to"],y=>o(r,{key:y,items:h.rules,predicate:m=>m.ruleType===y,comparator:(m,R)=>m.type.localeCompare(R.type),empty:!1},{default:a(({items:m})=>[o($,null,{default:a(()=>[u("h3",null,p(A(`data-planes.routes.item.rules.${y}`)),1),t[0]||(t[0]=l()),o(G,{class:"mt-2",rules:m,types:P,"data-testid":`${y}-rule-list`},null,8,["rules","types","data-testid"])]),_:2},1024)]),_:2},1032,["items","predicate","comparator"])),64)),t[5]||(t[5]=l()),o(r,{items:h.rules,predicate:y=>{var m;return y.ruleType==="from"&&!((m=P[y.type])!=null&&m.policy.isFromAsRules)},comparator:(y,m)=>y.type.localeCompare(m.type),empty:!1},{default:a(({items:y})=>[o($,null,{default:a(()=>[u("h3",ve,p(A("data-planes.routes.item.rules.from")),1),t[2]||(t[2]=l()),(e(!0),s(i,null,f([Object.groupBy(y,m=>m.inbound.port)],m=>(e(),s(i,{key:m},[(e(!0),s(i,null,f(Object.entries(m).sort(([R],[O])=>Number(O)-Number(R)),([R,O],x)=>(e(),s("div",{key:x},[u("h4",null,p(A("data-planes.routes.item.port",{port:R})),1),t[1]||(t[1]=l()),o(G,{class:"mt-2",rules:O,types:P,"data-testid":`from-rule-list-${x}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","predicate","comparator"]),t[6]||(t[6]=l()),o(r,{items:h.inboundRules,comparator:(y,m)=>y.type.localeCompare(m.type),empty:!1},{default:a(({items:y})=>[o($,null,{default:a(()=>[u("h3",$e,p(A("data-planes.routes.item.rules.inbound")),1),t[4]||(t[4]=l()),(e(!0),s(i,null,f([Object.groupBy(y,m=>m.inbound.port)],m=>(e(),s(i,{key:m},[(e(!0),s(i,null,f(Object.entries(m).sort(([R],[O])=>Number(O)-Number(R)),([R,O],x)=>(e(),s("div",{key:x},[u("h4",null,p(A("data-planes.routes.item.port",{port:R})),1),t[3]||(t[3]=l()),o(G,{class:"mt-2",rules:O,types:P,"data-testid":`inbound-rule-list-${x}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","comparator"])]),_:2},1032,["items"])]),_:2},1032,["src","data","errors"]),t[9]||(t[9]=l()),N("use zones")?j("",!0):(e(),s("div",we,[v.data.dataplaneType==="builtin"?(e(),_(c,{key:0,src:`/meshes/${C.params.mesh}/dataplanes/${C.params.proxy}/gateway-dataplane-policies`,data:[X],errors:[I]},{default:a(({data:h})=>[h?(e(),_(r,{key:0,items:h.routePolicies,empty:!1},{default:a(()=>[u("h3",null,p(A("data-planes.routes.item.legacy_policies")),1),t[7]||(t[7]=l()),o($,{class:"mt-4"},{default:a(()=>[o(ue,{types:P,"gateway-dataplane":h,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["types","gateway-dataplane"])]),_:2},1024)]),_:2},1032,["items"])):j("",!0)]),_:2},1032,["src","data","errors"])):(e(),_(c,{key:1,src:`/meshes/${C.params.mesh}/dataplanes/${C.params.proxy}/sidecar-dataplane-policies`,data:[X],errors:[I]},{default:a(({data:h})=>[o(r,{predicate:y=>{var m;return((m=P[y.type])==null?void 0:m.policy.isTargetRef)===!1},items:h.policyTypeEntries,empty:!1},{default:a(({items:y})=>[u("h3",null,p(A("data-planes.routes.item.legacy_policies")),1),t[8]||(t[8]=l()),o($,{class:"mt-4"},{default:a(()=>[o(ye,{items:y,types:P,"data-testid":"sidecar-dataplane-policies"},null,8,["items","types"])]),_:2},1024)]),_:2},1032,["predicate","items"])]),_:2},1032,["src","data","errors"]))]))],64))),128))]),_:2},1032,["src"])]),t[10]||(t[10]=l()),o(b,null,{default:a(({Component:X})=>[C.child()?(e(),_(ee,{key:0,onClose:I=>C.replace({name:"data-plane-policies-view",params:{mesh:C.params.mesh,proxy:C.params.proxy}})},{default:a(()=>[(e(),_(E(X)))]),_:2},1032,["onClose"])):j("",!0)]),_:2},1024)]),_:2},1024)]),_:1})}}});export{Ve as default};
