import{_ as Y,U as F,V as R,H as U,G,y as J,Q as Z,m as Q,K as B,o as e,b as v,w as l,d,f as i,j as f,h as s,n as x,t as c,F as _,e as K,r as D,J as j,cH as O,O as I,p as X,L as p,cD as ee,cE as ae,cI as te,cx as M,cF as se,a4 as ne,C as oe,D as le,S as q,cy as ie,cz as re,s as ce,cJ as de,cK as ue,a3 as pe,T as H,cL as me,cM as V}from"./index.b4c50a9a.js";import{S as z,E as A}from"./EnvoyData.f353a56a.js";import{E as he}from"./EntityURLControl.cf60ee76.js";import{L as W}from"./LabelList.2e2a2df8.js";import{a as _e,S as ye}from"./SubscriptionHeader.b4efae60.js";import{T as fe}from"./TabsWidget.a658e878.js";import{W as ve}from"./WarningsWidget.f18ade49.js";import{Y as ge}from"./YamlView.fd70f1b8.js";import{E as Pe,_ as be}from"./ErrorBlock.63ee7be4.js";import{_ as we}from"./CodeBlock.250aca45.js";import"./index.58caa11d.js";const De={inbound:"Policies applied on incoming connection on address",outbound:"Policies applied on outgoing connection to the address",service:"Policies applied on outgoing connections to service",dataplane:"Policies applied on all incoming and outgoing connections to the selected data plane proxy"},Ie={name:"DataplanePolicies",components:{StatusInfo:z,AccordionList:F,AccordionItem:R,KCard:U,KPop:G,KIcon:J,KBadge:Z},props:{mesh:{type:String,required:!0},dppName:{type:String,required:!0}},data(){return{items:[],hasItems:!1,isLoading:!0,error:null,searchInput:"",POLICY_TYPE_SUBTITLE:De}},computed:{...Q({policiesByType:n=>n.policiesByType})},watch:{dppName(){this.fetchPolicies()}},mounted(){this.fetchPolicies()},methods:{async fetchPolicies(){this.error=null,this.isLoading=!0;try{const{items:n,total:o,kind:m}=await B.getDataplanePolicies({mesh:this.mesh,dppName:this.dppName});(m===void 0||m==="SidecarDataplane")&&(this.processItems(n),this.items=n,this.hasItems=o>0)}catch(n){this.error=n}finally{this.isLoading=!1}},processItems(n){for(const o of n){o.policyTypes={};for(const m in o.matchedPolicies){const h=this.policiesByType[m],u={pluralDisplayName:h.pluralDisplayName,policies:o.matchedPolicies[m]};for(const y of u.policies)y.route={name:h.path,query:{ns:y.name},params:{mesh:y.mesh}};o.policyTypes[m]=u}}}}},ke={class:"flex items-center justify-between"},Se={key:0,class:"text-lg"},Le={key:1,class:"text-lg"},Te={class:"subtitle"},Ce={key:0},Oe={key:1},xe={class:"flex flex-wrap justify-end"},Ke={class:"policy-wrapper"},Ee={class:"policy-type"};function $e(n,o,m,h,u,y){const g=D("KIcon"),L=D("KPop"),k=D("KBadge"),P=D("router-link"),b=D("AccordionItem"),T=D("AccordionList"),S=D("KCard"),E=D("StatusInfo");return e(),v(E,{"has-error":u.error!==null,"is-loading":u.isLoading,error:u.error,"is-empty":!u.hasItems},{default:l(()=>[d(S,{"border-variant":"noBorder"},{body:l(()=>[d(T,{"initially-open":[],"multiple-open":""},{default:l(()=>[(e(!0),i(_,null,f(u.items,(a,w)=>(e(),v(b,{key:w},{"accordion-header":l(()=>[s("div",ke,[s("div",null,[a.type==="dataplane"?(e(),i("p",Se," Dataplane ")):x("",!0),a.type!=="dataplane"?(e(),i("p",Le,c(a.service),1)):x("",!0),s("p",Te,[a.type==="inbound"||a.type==="outbound"?(e(),i("span",Ce,c(a.type)+" "+c(a.name),1)):a.type==="service"||a.type==="dataplane"?(e(),i("span",Oe,c(a.type),1)):x("",!0),d(L,{width:"300",placement:"right",trigger:"hover"},{content:l(()=>[s("div",null,c(u.POLICY_TYPE_SUBTITLE[a.type]),1)]),default:l(()=>[d(g,{icon:"help",size:"16",class:"ml-1"})]),_:2},1024)])]),s("div",xe,[(e(!0),i(_,null,f(a.matchedPolicies,(t,r)=>(e(),v(k,{key:`${w}-${r}`,class:"mr-2 mb-2"},{default:l(()=>[K(c(r),1)]),_:2},1024))),128))])])]),"accordion-content":l(()=>[s("div",Ke,[(e(!0),i(_,null,f(a.policyTypes,(t,r)=>(e(),i("div",{key:`${w}-${r}`,class:"policy-item"},[s("h4",Ee,c(t.pluralDisplayName),1),s("ul",null,[(e(!0),i(_,null,f(t.policies,(C,$)=>(e(),i("li",{key:`${w}-${r}-${$}`,class:"my-1","data-testid":"policy-name"},[d(P,{to:C.route},{default:l(()=>[K(c(C.name),1)]),_:2},1032,["to"])]))),128))])]))),128))])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["has-error","is-loading","error","is-empty"])}const Ae=Y(Ie,[["render",$e],["__scopeId","data-v-7223f9a8"]]),N=n=>(oe("data-v-8eb75baf"),n=n(),le(),n),Be={key:0},Ne={class:"entity-status__label"},Me=N(()=>s("span",{class:"entity-status__dot"},null,-1)),Ve={key:1},We=N(()=>s("h4",null,"Tags",-1)),Ye=N(()=>s("h4",null,"Versions",-1)),Fe={key:0},Re=K(" This data plane proxy does not yet have mTLS configured \u2014 "),Ue=["href"],je=j({__name:"DataPlaneDetails",props:{dataPlane:{type:Object,required:!0},dataPlaneOverview:{type:Object,required:!0}},setup(n){const o=n,m=q(H),h=[{hash:"#overview",title:"Overview"},{hash:"#insights",title:"DPP Insights"},{hash:"#dpp-policies",title:"Policies"},{hash:"#xds-configuration",title:"XDS Configuration"},{hash:"#envoy-stats",title:"Stats"},{hash:"#envoy-clusters",title:"Clusters"},{hash:"#mtls",title:"Certificate Insights"},{hash:"#yaml",title:"YAML"},{hash:"#warnings",title:"Warnings"}],u=O([]),y=I(()=>{const{type:a,name:w,mesh:t}=o.dataPlane,r=ie(o.dataPlane,o.dataPlaneOverview.dataplaneInsight);return{type:a,name:w,mesh:t,status:r}}),g=I(()=>M(o.dataPlane)),L=I(()=>re(o.dataPlaneOverview.dataplaneInsight)),k=I(()=>ce(o.dataPlane)),P=I(()=>de(o.dataPlaneOverview)),b=I(()=>{const a=Array.from(o.dataPlaneOverview.dataplaneInsight.subscriptions);return a.reverse(),a}),T=I(()=>{const a=m.getters.getKumaDocsVersion;return a!==null?a:"latest"}),S=I(()=>u.value.length===0?h.filter(a=>a.hash!=="#warnings"):h);async function E(){if(o.dataPlaneOverview.dataplaneInsight.subscriptions.length===0)return;const a=o.dataPlaneOverview.dataplaneInsight.subscriptions[0].version;if(a.kumaDp&&a.envoy){const t=ee(a);t.kind!==ae&&t.kind!==te&&u.value.push(t)}if(m.getters["config/getMulticlusterStatus"]){const t=M(o.dataPlane),{compatible:r,payload:C}=await se(t,a.kumaDp.version);r||u.value.push({kind:ne,payload:C})}}return E(),(a,w)=>(e(),v(fe,{tabs:p(S),"initial-tab-override":"overview"},{tabHeader:l(()=>[s("div",null,[s("h3",null," DPP: "+c(n.dataPlane.name),1)]),s("div",null,[d(he,{name:n.dataPlane.name,mesh:n.dataPlane.mesh},null,8,["name","mesh"])])]),overview:l(()=>[d(W,null,{default:l(()=>[s("div",null,[s("ul",null,[(e(!0),i(_,null,f(p(y),(t,r)=>(e(),i("li",{key:r},[s("h4",null,c(r),1),r==="status"&&typeof t!="string"?(e(),i("div",Be,[s("div",{class:X(["entity-status",{"is-offline":t.status.toString().toLowerCase()==="offline","is-degraded":t.status.toString().toLowerCase()==="partially degraded"}])},[s("span",Ne,c(t.status),1)],2),(e(!0),i(_,null,f(t.reason,(C,$)=>(e(),i("div",{key:$,class:"reason"},[Me,K(" "+c(C),1)]))),128))])):(e(),i("div",Ve,c(t),1))]))),128))])]),s("div",null,[We,s("p",null,[(e(!0),i(_,null,f(p(g),(t,r)=>(e(),i("span",{key:r,class:"tag-cols"},[s("span",null,c(t.label)+": ",1),s("span",null,c(t.value),1)]))),128))]),p(L)?(e(),i(_,{key:0},[Ye,s("p",null,[(e(!0),i(_,null,f(p(L),(t,r)=>(e(),i("span",{key:r,class:"tag-cols"},[s("span",null,c(r)+": ",1),s("span",null,c(t),1)]))),128))])],64)):x("",!0)])]),_:1})]),insights:l(()=>[d(z,{"is-empty":p(b).length===0},{default:l(()=>[d(p(U),{"border-variant":"noBorder"},{body:l(()=>[d(F,{"initially-open":0},{default:l(()=>[(e(!0),i(_,null,f(p(b),(t,r)=>(e(),v(R,{key:r},{"accordion-header":l(()=>[d(_e,{details:t},null,8,["details"])]),"accordion-content":l(()=>[d(ye,{details:t,"is-discovery-subscription":""},null,8,["details"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["is-empty"])]),"dpp-policies":l(()=>[d(Ae,{mesh:n.dataPlane.mesh,"dpp-name":n.dataPlane.name},null,8,["mesh","dpp-name"])]),"xds-configuration":l(()=>[d(A,{"data-path":"xds",mesh:n.dataPlane.mesh,"dpp-name":n.dataPlane.name},null,8,["mesh","dpp-name"])]),"envoy-stats":l(()=>[d(A,{"data-path":"stats",mesh:n.dataPlane.mesh,"dpp-name":n.dataPlane.name},null,8,["mesh","dpp-name"])]),"envoy-clusters":l(()=>[d(A,{"data-path":"clusters",mesh:n.dataPlane.mesh,"dpp-name":n.dataPlane.name},null,8,["mesh","dpp-name"])]),mtls:l(()=>[d(W,null,{default:l(()=>[p(P)!==null?(e(),i("ul",Fe,[(e(!0),i(_,null,f(p(P),(t,r)=>(e(),i("li",{key:r},[s("h4",null,c(t.label),1),s("p",null,c(t.value),1)]))),128))])):(e(),v(p(ue),{key:1,appearance:"danger"},{alertMessage:l(()=>[Re,s("a",{href:`https://kuma.io/docs/${p(T)}/documentation/security/#certificates`,class:"external-link",target:"_blank"}," Learn About Certificates in "+c(p(pe)),9,Ue)]),_:1}))]),_:1})]),yaml:l(()=>[d(ge,{content:p(k)},null,8,["content"])]),warnings:l(()=>[d(ve,{warnings:u.value},null,8,["warnings"])]),_:1},8,["tabs"]))}});const qe=Y(je,[["__scopeId","data-v-8eb75baf"]]),He={class:"component-frame"},oa=j({__name:"DataPlaneDetailView",setup(n){const o=me(),m=q(H),h=O(null),u=O(null),y=O(!0),g=O(null),L={};async function k(){g.value=null,y.value=!0;const P=o.params.mesh,b=o.params.dataPlane,T=L;try{h.value=await B.getDataplaneFromMesh({mesh:P,name:b},T),u.value=await B.getDataplaneOverviewFromMesh({mesh:P,name:b},T)}catch(S){h.value=null,S instanceof Error?g.value=S:console.error(S)}finally{y.value=!1}}return V(()=>o.params.mesh,function(){o.name==="data-plane-detail-view"&&k()}),V(()=>o.params.dataPlane,function(){o.name==="data-plane-detail-view"&&k()}),k(),m.dispatch("updatePageTitle",o.params.dataPlane),(P,b)=>(e(),i("div",He,[y.value?(e(),v(we,{key:0})):g.value!==null?(e(),v(Pe,{key:1,error:g.value},null,8,["error"])):h.value===null||u.value===null?(e(),v(be,{key:2})):(e(),v(qe,{key:3,"data-plane":h.value,"data-plane-overview":u.value},null,8,["data-plane","data-plane-overview"]))]))}});export{oa as default};
