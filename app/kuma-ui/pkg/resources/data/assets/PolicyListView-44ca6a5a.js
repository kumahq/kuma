import{l as Z,S as F,U as W,Z as j,h as G}from"./kongponents.es-8a32a5dc.js";import{d as I,o as _,a as P,w as l,h as r,b as t,g as c,u as H,D as Y,q as d,c as g,s as J,e as X,k as y,f as x,P as L,H as U,t as ee,p as ae,m as te}from"./index-89f68547.js";import{_ as se}from"./PolicyDetails.vue_vue_type_script_setup_true_lang-bb9aeeb0.js";import{l as le,j as oe,f as ne,k as ie,g as re,_ as ce,h as pe}from"./RouteView.vue_vue_type_script_setup_true_lang-9d97c07b.js";import{_ as ue}from"./RouteTitle.vue_vue_type_script_setup_true_lang-a3524fac.js";import{D as me}from"./DataOverview-02bc3a27.js";import{Q as $}from"./QueryParameter-70743f73.js";import"./StatusInfo.vue_vue_type_script_setup_true_lang-35246334.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-5da7628f.js";import"./ErrorBlock-0115ac4c.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-f2c88c43.js";import"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-aabb8464.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-50de6279.js";import"./TextWithCopyButton-198e58f9.js";import"./toYaml-4e00099e.js";import"./TabsWidget-aa33fe8a.js";import"./TagList-20a7c70f.js";import"./StatusBadge-1ff8f67a.js";const de=I({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(o){const a=o;return(k,N)=>(_(),P(t(F),{class:"docs-link",appearance:"outline",target:"_blank",to:a.href},{default:l(()=>[r(t(Z),{icon:"externalLink",color:"currentColor",size:"16","hide-title":""}),c(`

    Documentation
  `)]),_:1},8,["to"]))}}),ye=o=>(ae("data-v-32be22cb"),o=o(),te(),o),he={class:"kcard-stack"},fe={class:"kcard-border"},_e=ye(()=>y("p",null,[y("strong",null,"Warning"),c(` This policy is experimental. If you encountered any problem please open an
                      `),y("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),ve=I({__name:"PolicyListView",props:{selectedPolicyName:{type:[String,null],required:!1,default:null},policyPath:{type:String,required:!0},offset:{type:Number,required:!1,default:0}},setup(o){const a=o,k=le(),N=oe(),n=H(),V=Y(),i=ne(),{t:B}=ie(),T=d(!0),w=d(null),D=d(null),A=d(a.offset),v=d(a.selectedPolicyName),h=d({headers:[{label:"Name",key:"entity"},{label:"Type",key:"type"}],data:[]}),C=g(()=>n.params.mesh),s=g(()=>i.state.policyTypesByPath[a.policyPath]),M=g(()=>i.state.policyTypes.map(e=>({label:e.name,value:e.path,selected:e.path===a.policyPath}))),q=g(()=>i.state.policyTypes.filter(e=>(i.state.sidebar.insights.mesh.policies[e.name]??0)===0).map(e=>e.name));J(()=>n.params.mesh,function(){n.name===a.policyPath&&S(0)}),R();async function R(){const e=i.state.policyTypesByPath[a.policyPath];e!==void 0&&(await i.dispatch("updatePageTitle",""),await i.dispatch("updatePageTitle",e.name)),S(a.offset)}async function S(e){var b;A.value=e,$.set("offset",e>0?e:null),T.value=!0,w.value=null;const p=n.params.mesh,u=n.params.policyPath,m=L;try{const{items:f,next:Q}=await N.getAllPolicyEntitiesFromMesh({mesh:p,path:u},{size:m,offset:e});D.value=Q,h.value.data=z(f??[]),E({name:a.selectedPolicyName??((b=h.value.data[0])==null?void 0:b.entity.name)})}catch(f){h.value.data=[],f instanceof Error?w.value=f:console.error(f)}finally{T.value=!1}}function z(e){return e.map(p=>{const{type:u,name:m}=p,b={name:"policy-detail-view",params:{mesh:p.mesh,policyPath:n.params.policyPath,policy:m}};return{entity:p,detailViewRoute:b,type:u}})}function K(e){E({name:e.name})}function E({name:e}){v.value=e??null,$.set("policy",e??null)}function O(e){V.push({name:"policies-list-view",params:{...n.params,policyPath:e.value}})}return(e,p)=>(_(),P(ce,{module:"policies"},{default:l(()=>{var u;return[r(ue,{title:t(B)("policies.routes.items.title",{name:(u=s.value)==null?void 0:u.name})},null,8,["title"]),c(),r(re,null,{default:l(()=>[s.value?(_(),X("div",{key:0,class:U(["relative",s.value.path])},[y("div",he,[y("div",fe,[s.value.isExperimental?(_(),P(t(W),{key:0,"border-variant":"noBorder",class:"mb-4"},{body:l(()=>[r(t(j),{appearance:"warning"},{alertMessage:l(()=>[_e]),_:1})]),_:1})):x("",!0),c(),r(me,{"selected-entity-name":v.value??void 0,"page-size":t(L),error:w.value,"is-loading":T.value,"empty-state":{title:"No Data",message:`There are no ${s.value.name} policies present.`},"table-data":h.value,"table-data-is-empty":h.value.data.length===0,next:D.value,"page-offset":A.value,onTableAction:K,onLoadData:S},{additionalControls:l(()=>[r(t(G),{label:"Policies",items:M.value,"label-attributes":{class:"visually-hidden"},appearance:"select","enable-filtering":!0,onSelected:O},{"item-template":l(({item:m})=>[y("span",{class:U({"policy-type-empty":q.value.includes(m.label)})},ee(m.label),3)]),_:1},8,["items"]),c(),r(de,{href:`${t(k)("KUMA_DOCS_URL")}/policies/${s.value.path}/?${t(k)("KUMA_UTM_QUERY_PARAMS")}`,"data-testid":"policy-documentation-link"},null,8,["href"])]),default:l(()=>[c(`
              >
              `)]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next","page-offset"])]),c(),v.value!==null?(_(),P(se,{key:0,name:v.value,mesh:C.value,path:s.value.path,type:s.value.name},null,8,["name","mesh","path","type"])):x("",!0)])],2)):x("",!0)]),_:1})]}),_:1}))}});const Ce=pe(ve,[["__scopeId","data-v-32be22cb"]]);export{Ce as default};
