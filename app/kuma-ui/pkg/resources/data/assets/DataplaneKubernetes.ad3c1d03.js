import{D as B,y as E,e as M,M as K,ck as V,cn as F,cT as U,k as T,o as r,j as c,l as e,a as i,w as a,t as h,m as d,cD as P,F as q,n as z,b as f,cU as _,c as b,v as S,z as v,i as p,B as A,C as j}from"./index.c8163df9.js";import{_ as W}from"./CodeBlock.vue_vue_type_style_index_0_lang.14084b4c.js";import{f as O}from"./formatForCLI.199be697.js";import{F as G,S as Y,E as L}from"./EntityScanner.d03b923c.js";import{E as R}from"./EnvironmentSwitcher.d400a664.js";import"./_commonjsHelpers.f037b798.js";import"./index.58caa11d.js";const H={apiVersion:"v1",kind:"Namespace",metadata:{name:null,namespace:null,annotations:{"kuma.io/sidecar-injection":"enabled","kuma.io/mesh":null}}};const J={name:"DataplaneWizardKubernetes",components:{CodeBlock:W,FormFragment:G,StepSkeleton:Y,EnvironmentSwitcher:R,EntityScanner:L,KAlert:E,KButton:M,KCard:K},data(){return{productName:V,schema:H,steps:[{label:"General",slug:"general"},{label:"Scope Settings",slug:"scope-settings"},{label:"Install",slug:"complete"}],tabs:[{hash:"#kubernetes",title:"Kubernetes"}],sidebarContent:[{name:"dataplane"},{name:"example"},{name:"switch"}],startScanner:!1,scanFound:!1,hideScannerSiblings:!1,scanError:!1,isComplete:!1,validate:{meshName:"",k8sDataplaneType:"dataplane-type-service",k8sServices:"all-services",k8sNamespace:"",k8sNamespaceSelection:"",k8sServiceDeployment:"",k8sServiceDeploymentSelection:"",k8sIngressDeployment:"",k8sIngressDeploymentSelection:"",k8sIngressType:"",k8sIngressBrand:"kong-ingress",k8sIngressSelection:""}}},computed:{...F({title:"config/getTagline",version:"config/getVersion",environment:"config/getEnvironment",meshes:"getMeshList"}),codeOutput(){const o=Object.assign({},this.schema),s=this.validate.k8sNamespaceSelection;if(!s)return;o.metadata.name=s,o.metadata.namespace=s,o.metadata.annotations["kuma.io/mesh"]=this.validate.meshName;const y=`" | kubectl apply -f - && kubectl delete pod --all -n ${s}`;return O(o,y)},nextDisabled(){const{k8sNamespaceSelection:o,meshName:s}=this.validate;return s.length?this.$route.query.step==="1"?!o:!1:!0}},watch:{"validate.k8sNamespaceSelection"(o){this.validate.k8sNamespaceSelection=U(o)},$route(){this.$route.query.step===1&&(this.validate.k8sNamespaceSelection?this.nextDisabled=!1:this.nextDisabled=!0)}},methods:{hideSiblings(){this.hideScannerSiblings=!0},scanForEntity(){const s=this.validate.meshName,y=this.validate.k8sNamespaceSelection;this.scanComplete=!1,this.scanError=!1,!(!s||!y)&&T.getDataplaneFromMesh({mesh:s,name:y}).then(k=>{k&&k.name.length>0?(this.isRunning=!0,this.scanFound=!0):this.scanError=!0}).catch(k=>{this.scanError=!0,console.error(k)}).finally(()=>{this.scanComplete=!0})},compeleteDataPlaneSetup(){this.$store.dispatch("updateSelectedMesh",this.validate.meshName),this.$router.push({name:"data-plane-list-view",params:{mesh:this.validate.meshName}})}}},n=o=>(A("data-v-47575659"),o=o(),j(),o),Q={class:"wizard"},X={class:"wizard__content"},Z=n(()=>e("h3",null," Create Kubernetes Dataplane ",-1)),$=n(()=>e("h3",null," To get started, please select on what Mesh you would like to add the Dataplane: ",-1)),ee=n(()=>e("p",null," If you've got an existing Mesh that you would like to associate with your Dataplane, you can select it below, or create a new one using our Mesh Wizard. ",-1)),te=n(()=>e("small",null,"Would you like to see instructions for Universal? Use sidebar to change wizard!",-1)),se=n(()=>e("option",{disabled:"",value:""}," Select an existing Mesh\u2026 ",-1)),ae=["value"],ne=n(()=>e("label",{class:"k-input-label mr-4"}," or ",-1)),le=n(()=>e("h3",null," Setup Dataplane Mode ",-1)),oe=n(()=>e("p",null," You can create a data plane for a service or a data plane for a Gateway. ",-1)),ie={for:"service-dataplane"},re=n(()=>e("span",null," Service Dataplane ",-1)),de={for:"ingress-dataplane"},ce=n(()=>e("span",null," Ingress Dataplane ",-1)),pe={key:0},ue=n(()=>e("p",null," Should the data plane be added for an entire Namespace and all of its services, or for specific individual services in any namespace? ",-1)),me={for:"k8s-services-all"},he=n(()=>e("span",null," All Services in Namespace ",-1)),ke={for:"k8s-services-individual"},_e=n(()=>e("span",null," Individual Services ",-1)),ve={key:1},ye={for:"k8s-ingress-kong"},ge=n(()=>e("span",null," Kong Ingress ",-1)),fe={for:"k8s-ingress-other"},be=n(()=>e("span",null," Other Ingress ",-1)),Se=n(()=>e("p",null,' Please go ahead and deploy the Ingress first, then restart this wizard and select "Existing Ingress". ',-1)),we={key:0},De={key:0},Ne=n(()=>e("h3",null," Auto-Inject DPP ",-1)),Ie=n(()=>e("p",null," You can now execute the following commands to automatically inject the sidecar proxy in every Pod, and by doing so creating the Dataplane. ",-1)),xe=n(()=>e("h4",null,"Kubernetes",-1)),Ce=n(()=>e("h3",null,"Searching\u2026",-1)),Be=n(()=>e("p",null,"We are looking for your dataplane.",-1)),Ee=n(()=>e("h3",null,"Done!",-1)),Me={key:0},Ke=n(()=>e("p",null," Proceed to the next step where we will show you your new Dataplane. ",-1)),Ve=n(()=>e("h3",null,"Mesh not found",-1)),Fe=n(()=>e("p",null,"We were unable to find your mesh.",-1)),Ue=n(()=>e("p",null," Please return to the first step and make sure to select an existing Mesh, or create a new one. ",-1)),Te=n(()=>e("h3",null,"Dataplane",-1)),Pe=n(()=>e("h3",null,"Example",-1)),qe=n(()=>e("p",null," Below is an example of a Dataplane resource output: ",-1)),ze=n(()=>e("code",{class:"block"},[e("pre",null,`apiVersion: 'kuma.io/v1alpha1'
kind: Dataplane
mesh: default
metadata:
  name: dp-echo-1
  annotations:
    kuma.io/sidecar-injection: enabled
    kuma.io/mesh: default
networking:
  address: 10.0.0.1
  inbound:
  - port: 10000
    servicePort: 9000
    tags:
      kuma.io/service: echo`)],-1));function Ae(o,s,y,k,t,g){const w=p("KButton"),u=p("FormFragment"),m=p("KCard"),D=p("KAlert"),N=p("CodeBlock"),I=p("EntityScanner"),x=p("EnvironmentSwitcher"),C=p("StepSkeleton");return r(),c("div",Q,[e("div",X,[i(C,{steps:t.steps,"sidebar-content":t.sidebarContent,"footer-enabled":t.hideScannerSiblings===!1,"next-disabled":g.nextDisabled},{general:a(()=>[Z,e("p",null," Welcome to the wizard to create a new Dataplane resource in "+h(o.title)+". We will be providing you with a few steps that will get you started. ",1),e("p",null," As you know, the "+h(t.productName)+" GUI is read-only. ",1),$,ee,te,i(m,{class:"my-6","has-shadow":""},{body:a(()=>[i(u,{title:"Choose a Mesh","for-attr":"dp-mesh","all-inline":""},{default:a(()=>[e("div",null,[d(e("select",{id:"dp-mesh","onUpdate:modelValue":s[0]||(s[0]=l=>t.validate.meshName=l),class:"k-input w-100"},[se,(r(!0),c(q,null,z(o.meshes.items,l=>(r(),c("option",{key:l.name,value:l.name},h(l.name),9,ae))),128))],512),[[P,t.validate.meshName]])]),e("div",null,[ne,i(w,{to:{name:"create-mesh"},appearance:"outline"},{default:a(()=>[f(" Create a new Mesh ")]),_:1})])]),_:1})]),_:1})]),"scope-settings":a(()=>[le,oe,i(m,{class:"my-6","has-shadow":""},{body:a(()=>[i(u,{"all-inline":"","equal-cols":"","hide-label-col":""},{default:a(()=>[e("label",ie,[d(e("input",{id:"service-dataplane","onUpdate:modelValue":s[1]||(s[1]=l=>t.validate.k8sDataplaneType=l),class:"k-input",type:"radio",name:"dataplane-type",value:"dataplane-type-service",checked:""},null,512),[[_,t.validate.k8sDataplaneType]]),re]),e("label",de,[d(e("input",{id:"ingress-dataplane","onUpdate:modelValue":s[2]||(s[2]=l=>t.validate.k8sDataplaneType=l),class:"k-input",type:"radio",name:"dataplane-type",value:"dataplane-type-ingress",disabled:""},null,512),[[_,t.validate.k8sDataplaneType]]),ce])]),_:1})]),_:1}),t.validate.k8sDataplaneType==="dataplane-type-service"?(r(),c("div",pe,[ue,i(m,{class:"my-6","has-shadow":""},{body:a(()=>[i(u,{"all-inline":"","equal-cols":"","hide-label-col":""},{default:a(()=>[e("label",me,[d(e("input",{id:"k8s-services-all","onUpdate:modelValue":s[3]||(s[3]=l=>t.validate.k8sServices=l),class:"k-input",type:"radio",name:"k8s-services",value:"all-services",checked:""},null,512),[[_,t.validate.k8sServices]]),he]),e("label",ke,[d(e("input",{id:"k8s-services-individual","onUpdate:modelValue":s[4]||(s[4]=l=>t.validate.k8sServices=l),class:"k-input",type:"radio",name:"k8s-services",value:"individual-services",disabled:""},null,512),[[_,t.validate.k8sServices]]),_e])]),_:1})]),_:1}),t.validate.k8sServices==="individual-services"?(r(),b(m,{key:0,class:"my-6","has-shadow":""},{body:a(()=>[i(u,{title:"Deployments","for-attr":"k8s-deployment-selection"},{default:a(()=>[d(e("input",{id:"k8s-service-deployment-new","onUpdate:modelValue":s[5]||(s[5]=l=>t.validate.k8sServiceDeploymentSelection=l),type:"text",class:"k-input w-100",placeholder:"your-new-deployment",required:""},null,512),[[S,t.validate.k8sServiceDeploymentSelection]])]),_:1})]),_:1})):v("",!0),i(m,{class:"my-6","has-shadow":""},{body:a(()=>[i(u,{title:"Namespace","for-attr":"k8s-namespace-selection"},{default:a(()=>[d(e("input",{id:"k8s-namespace-new","onUpdate:modelValue":s[6]||(s[6]=l=>t.validate.k8sNamespaceSelection=l),type:"text",class:"k-input w-100",placeholder:"your-namespace",required:""},null,512),[[S,t.validate.k8sNamespaceSelection]])]),_:1})]),_:1})])):v("",!0),t.validate.k8sDataplaneType==="dataplane-type-ingress"?(r(),c("div",ve,[e("p",null,h(o.title)+" natively supports the Kong Ingress. Do you want to deploy Kong or another Ingress? ",1),i(m,{class:"my-6","has-shadow":""},{body:a(()=>[i(u,{"all-inline":"","equal-cols":"","hide-label-col":""},{default:a(()=>[e("label",ye,[d(e("input",{id:"k8s-ingress-kong","onUpdate:modelValue":s[7]||(s[7]=l=>t.validate.k8sIngressBrand=l),class:"k-input",type:"radio",name:"k8s-ingress-brand",value:"kong-ingress",checked:""},null,512),[[_,t.validate.k8sIngressBrand]]),ge]),e("label",fe,[d(e("input",{id:"k8s-ingress-other","onUpdate:modelValue":s[8]||(s[8]=l=>t.validate.k8sIngressBrand=l),class:"k-input",type:"radio",name:"k8s-ingress-brand",value:"other-ingress"},null,512),[[_,t.validate.k8sIngressBrand]]),be])]),_:1})]),_:1}),i(m,{class:"my-6","has-shadow":""},{body:a(()=>[i(u,{title:"Deployments","for-attr":"k8s-deployment-selection"},{default:a(()=>[d(e("input",{id:"k8s-ingress-deployment-new","onUpdate:modelValue":s[9]||(s[9]=l=>t.validate.k8sIngressDeployment=l),type:"text",class:"k-input w-100",placeholder:"your-deployment",required:""},null,512),[[S,t.validate.k8sIngressDeployment]])]),_:1})]),_:1}),t.validate.k8sIngressBrand==="other-ingress"?(r(),b(D,{key:0,appearance:"info"},{alertMessage:a(()=>[Se]),_:1})):v("",!0)])):v("",!0)]),complete:a(()=>[t.validate.meshName?(r(),c("div",we,[t.hideScannerSiblings===!1?(r(),c("div",De,[Ne,Ie,xe,i(N,{id:"code-block-kubernetes-command",language:"bash",code:g.codeOutput},null,8,["code"])])):v("",!0),i(I,{"loader-function":g.scanForEntity,"should-start":!0,"has-error":t.scanError,"can-complete":t.scanFound,onHideSiblings:g.hideSiblings},{"loading-title":a(()=>[Ce]),"loading-content":a(()=>[Be]),"complete-title":a(()=>[Ee]),"complete-content":a(()=>[e("p",null,[f(" Your Dataplane "),t.validate.k8sNamespaceSelection?(r(),c("strong",Me,h(t.validate.k8sNamespaceSelection),1)):v("",!0),f(" was found! ")]),Ke,e("p",null,[i(w,{appearance:"primary",onClick:g.compeleteDataPlaneSetup},{default:a(()=>[f(" View Your Dataplane ")]),_:1},8,["onClick"])])]),"error-title":a(()=>[Ve]),"error-content":a(()=>[Fe]),_:1},8,["loader-function","has-error","can-complete","onHideSiblings"])])):(r(),b(D,{key:1,appearance:"danger"},{alertMessage:a(()=>[Ue]),_:1}))]),dataplane:a(()=>[Te,e("p",null," In "+h(o.title)+", a Dataplane resource represents a data plane proxy running alongside one of your services. Data plane proxies can be added in any Mesh that you may have created, and in Kubernetes, they will be auto-injected by "+h(o.title)+". ",1)]),example:a(()=>[Pe,qe,ze]),switch:a(()=>[i(x)]),_:1},8,["steps","sidebar-content","footer-enabled","next-disabled"])])])}const He=B(J,[["render",Ae],["__scopeId","data-v-47575659"]]);export{He as default};
