import{z as x,O as T}from"./kongponents.es-0486183b.js";import{d as S,u as A,c as m,v as R,o as n,j as d,g as o,h as l,r as w,G as H,O as E,x as J,w as r,e as b,b as h,i as N,F as v,q as B,t as f,f as V}from"./index-389a0ddf.js";import{D as M}from"./DoughnutChart-878864a6.js";import{u as z}from"./store-b7a9ef0c.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import{D as P,a as I}from"./DefinitionListItem-2729f1cb.js";import{M as Q}from"./MeshResources-0467d9eb.js";import{_ as U}from"./StatusInfo.vue_vue_type_script_setup_true_lang-9f43de26.js";import{_ as W}from"./YamlView.vue_vue_type_script_setup_true_lang-7ba4429c.js";import{u as X}from"./index-8c223fc5.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-49465137.js";import"./ErrorBlock-d37185d2.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-1e9eaa23.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-e0fdc5bd.js";import"./toYaml-4e00099e.js";const Y={class:"chart-box-list"},Z=S({__name:"MeshCharts",setup(K){const D=A(),u=z(),p=m(()=>u.getters.getChart("services",{title:"Services",showTotal:!0})),g=m(()=>u.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),y=m(()=>u.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),a=m(()=>u.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));R(()=>D.params.mesh,function(c){typeof c=="string"&&k(c)},{immediate:!0});function k(c){u.dispatch("fetchMeshInsights",c),u.dispatch("fetchServices",c)}return(c,$)=>(n(),d("div",Y,[o(M,{data:p.value},null,8,["data"]),l(),o(M,{data:g.value},null,8,["data"]),l(),o(M,{data:y.value},null,8,["data"]),l(),o(M,{data:a.value},null,8,["data"])]))}});const ee=F(Z,[["__scopeId","data-v-5ab6d374"]]),te={class:"kcard-stack"},ae={class:"columns"},se={key:0},ne=S({__name:"MeshOverviewView",setup(K){const D=X(),u=A(),p=z(),g=w(!0),y=w(!1),a=w(null),k=w(null),c=m(()=>a.value!==null?H(a.value):null),$=m(()=>{if(a.value===null)return null;const{name:t,type:s,creationTime:_,modificationTime:e}=a.value;return{name:t,type:s,created:E(_),modified:E(e),"Data Plane Proxies":p.state.meshInsight.dataplanes.total}}),j=m(()=>{var O;if(a.value===null)return null;const t=C(a.value,"mtls"),s=C(a.value,"logging"),_=C(a.value,"metrics"),e=C(a.value,"tracing"),i=!!((O=a.value.routing)!=null&&O.localityAwareLoadBalancing);return{mtls:t,logging:s,metrics:_,tracing:e,localityAwareLoadBalancing:i}}),q=m(()=>p.state.sidebar.insights.mesh.policies.total),G=m(()=>p.state.policyTypes.map(t=>{var s;return{...t,length:((s=p.state.meshInsight.policies[t.name])==null?void 0:s.total)??0}}));R(()=>u.params.mesh,function(){u.name==="single-mesh-overview"&&L()}),L();async function L(){g.value=!0,y.value=!1;const t=u.params.mesh;try{a.value=await D.getMesh({name:t}),k.value=await D.getMeshInsights({name:t})}catch(s){y.value=!0,a.value=null,k.value=null,console.error(s)}finally{g.value=!1}}function C(t,s){if(t===null||t[s]===void 0)return!1;const _=t[s].enabledBackend??t[s].defaultBackend??t[s].backends[0].name,e=t[s].backends.find(i=>i.name===_);return`${e.type} / ${e.name}`}return(t,s)=>{const _=J("router-link");return n(),d("div",te,[o(b(x),null,{body:r(()=>[o(ee)]),_:1}),l(),a.value!==null?(n(),h(b(x),{key:0},{body:r(()=>[N("div",ae,[o(U,{"is-loading":g.value,"has-error":y.value,"is-empty":a.value===null||k.value===null},{default:r(()=>[o(P,null,{default:r(()=>[(n(!0),d(v,null,B($.value,(e,i)=>(n(),h(I,{key:i,term:i},{default:r(()=>[typeof e=="boolean"?(n(),h(b(T),{key:0,appearance:e?"success":"danger"},{default:r(()=>[l(f(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(n(),d(v,{key:1},[l(f(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1})]),_:1},8,["is-loading","has-error","is-empty"]),l(),o(P,null,{default:r(()=>[(n(!0),d(v,null,B(j.value,(e,i)=>(n(),h(I,{key:i,term:i},{default:r(()=>[typeof e=="boolean"?(n(),h(b(T),{key:0,appearance:e?"success":"danger"},{default:r(()=>[l(f(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(n(),d(v,{key:1},[l(f(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),l(),o(P,null,{default:r(()=>[o(I,{term:`Policies (${q.value})`},{default:r(()=>[N("ul",null,[(n(!0),d(v,null,B(G.value,(e,i)=>(n(),d(v,{key:i},[e.length!==0?(n(),d("li",se,[o(_,{to:{name:"policies-list-view",params:{policyPath:e.path}}},{default:r(()=>[l(f(e.name)+": "+f(e.length),1)]),_:2},1032,["to"])])):V("",!0)],64))),128))])]),_:1},8,["term"])]),_:1})])]),_:1})):V("",!0),l(),c.value!==null?(n(),h(b(x),{key:1},{body:r(()=>[o(W,{id:"code-block-mesh",content:c.value},null,8,["content"])]),_:1})):V("",!0),l(),o(Q)])}}});const ke=F(ne,[["__scopeId","data-v-72681139"]]);export{ke as default};
