import{d as tt,Q as et,T as at,r as y,o as s,m as c,w as t,b as o,p as V,U as nt,c as u,F as f,v,e as a,s as C,t as d,q as _,M as w,S as ot,L as O,K as st,C as it,_ as dt}from"./index-DIs9RbIP.js";import{S as rt}from"./SummaryView-C9C-0a0T.js";import{T as lt}from"./TagList-BlgWe3pi.js";import{C as L,a as B,b as A}from"./ConnectionTraffic-D-GMFehT.js";const pt={"data-testid":"dataplane-mtls"},ut={class:"columns"},mt={key:0,"data-testid":"dataplane-subscriptions"},yt=tt({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(j){const N=et(),i=j,M=at(()=>i.data.warnings.concat(...i.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[],...i.data.dataplaneInsight.mTLS?[]:[{kind:"DPP_NO_MTLS"}]));return(ct,e)=>{const E=y("XI18n"),z=y("XNotification"),D=y("XIcon"),S=y("DataCollection"),X=y("XLayout"),$=y("XAction"),h=y("XBadge"),F=y("XCopyButton"),G=y("XAboutCard"),P=y("XEmptyState"),K=y("XInputSwitch"),Q=y("XProgress"),R=y("XCard"),U=y("RouterView"),H=y("AppView"),J=y("DataSource"),W=y("RouteView");return s(),c(W,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:t(({route:g,t:p,can:q,me:x,uri:Y})=>[o(J,{src:Y(V(nt),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[g.params.proxyType]??"dataplane",name:g.params.proxy,mesh:g.params.mesh||"*",socketAddress:i.data.dataplane.networking.inboundAddress})},{default:t(({data:b,error:T,refresh:Z})=>[o(H,{notifications:!0},{default:t(()=>[(s(!0),u(f,null,v(M.value,n=>(s(),c(z,{key:n.kind,"data-testid":`warning-${n.kind}`,uri:`${n.kind}.${i.data.id}`},{default:t(()=>[o(E,{path:`common.warnings.${n.kind}`,params:n.payload},null,8,["path","params"])]),_:2},1032,["data-testid","uri"]))),128)),e[48]||(e[48]=a()),T?(s(),c(z,{key:0,uri:`warning-stats-loading.${i.data.id}`},{default:t(()=>[e[0]||(e[0]=a(`
          The below view is not enhanced with runtime stats (Error loading stats: `)),C("strong",null,d(T.toString()),1),e[1]||(e[1]=a(`)
        `))]),_:2},1032,["uri"])):_("",!0),e[49]||(e[49]=a()),o(X,{type:"stack","data-testid":"dataplane-details"},{default:t(()=>[o(G,{title:p("data-planes.routes.item.about.title"),created:i.data.creationTime,modified:i.data.modificationTime},{default:t(()=>[o(w,{layout:"horizontal"},{title:t(()=>[a(d(p("http.api.property.status")),1)]),body:t(()=>[o(X,{type:"separated"},{default:t(()=>[o(ot,{status:i.data.status},null,8,["status"]),e[2]||(e[2]=a()),i.data.dataplaneType==="standard"?(s(),c(S,{key:0,items:i.data.dataplane.networking.inbounds,predicate:n=>n.state!=="Ready",empty:!1},{default:t(({items:n})=>[o(D,{name:"info"},{default:t(()=>[C("ul",null,[(s(!0),u(f,null,v(n,r=>(s(),u("li",{key:`${r.service}:${r.port}`},d(p("data-planes.routes.item.unhealthy_inbound",{service:r.service,port:r.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):_("",!0)]),_:2},1024)]),_:2},1024),e[9]||(e[9]=a()),q("use zones")&&i.data.zone?(s(),c(w,{key:0,layout:"horizontal"},{title:t(()=>[a(d(p("http.api.property.zone")),1)]),body:t(()=>[o(h,{appearance:"decorative"},{default:t(()=>[o($,{to:{name:"zone-cp-detail-view",params:{zone:i.data.zone}}},{default:t(()=>[a(d(i.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2},1024)):_("",!0),e[10]||(e[10]=a()),o(w,{layout:"horizontal"},{title:t(()=>[a(d(p("http.api.proptery.type")),1)]),body:t(()=>[o(h,{appearance:"decorative"},{default:t(()=>[a(d(p(`data-planes.type.${i.data.dataplaneType}`)),1)]),_:2},1024)]),_:2},1024),e[11]||(e[11]=a()),i.data.namespace.length>0?(s(),c(w,{key:1,layout:"horizontal"},{title:t(()=>[a(d(p("http.api.property.namespace")),1)]),body:t(()=>[o(h,{appearance:"decorative"},{default:t(()=>[a(d(i.data.namespace),1)]),_:1})]),_:2},1024)):_("",!0),e[12]||(e[12]=a()),o(w,{layout:"horizontal"},{title:t(()=>[a(d(p("http.api.property.address")),1)]),body:t(()=>[o(F,{variant:"badge",format:"default",text:`${i.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024),e[13]||(e[13]=a()),i.data.dataplane.networking.gateway?(s(),c(w,{key:2,layout:"horizontal"},{title:t(()=>[a(d(p("http.api.property.tags")),1)]),body:t(()=>[o(lt,{tags:i.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024)):_("",!0)]),_:2},1032,["title","created","modified"]),e[44]||(e[44]=a()),o(R,{class:"traffic","data-testid":"dataplane-traffic"},{default:t(()=>[o(X,{type:"columns"},{default:t(()=>[o(L,null,{title:t(()=>[o(X,{type:"separated"},{default:t(()=>[o(D,{name:"inbound"}),e[14]||(e[14]=a()),e[15]||(e[15]=C("span",null,"Inbounds",-1))]),_:1})]),default:t(()=>[e[17]||(e[17]=a()),(s(!0),u(f,null,v([i.data.dataplane.networking.type==="gateway"?Object.entries((b==null?void 0:b.inbounds)??{}).reduce((n,[r,l])=>{var k;const m=r.split("_").at(-1);return m===(((k=i.data.dataplane.networking.admin)==null?void 0:k.port)??"9901")?n:n.concat([{...i.data.dataplane.networking.inbounds[0],name:r,port:Number(m),protocol:["http","tcp"].find(I=>typeof l[I]<"u")??"tcp",addressPort:`${i.data.dataplane.networking.inbounds[0].address}:${m}`}])},[]):i.data.dataplane.networking.inbounds],n=>(s(),c(B,{key:n,type:"inbound","data-testid":"dataplane-inbounds"},{default:t(()=>[o(S,{type:"inbounds",items:n,predicate:r=>r.port!==49151},O({default:t(({items:r})=>[o(X,{type:"stack",size:"small"},{default:t(()=>[(s(!0),u(f,null,v(r,l=>(s(),u(f,{key:`${l.name}`},[(s(!0),u(f,null,v([b==null?void 0:b.inbounds[l.name]],m=>(s(),c(A,{key:m,"data-testid":"dataplane-inbound",protocol:l.protocol,service:q("use service-insights",i.mesh)?l.tags["kuma.io/service"]:"","port-name":l.portName,traffic:typeof T>"u"?m:{name:"",protocol:l.protocol,port:`${l.port}`}},{default:t(()=>[o($,{"data-action":"",to:{name:(k=>k.includes("bound")?k.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(V(N).name)),params:{connection:l.name},query:{inactive:g.params.inactive}}},{default:t(()=>[a(d(l.name.replace("localhost","").replace("_",":")),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","service","port-name","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},[i.data.dataplaneType==="delegated"?{name:"empty",fn:t(()=>[o(P,null,{default:t(()=>[C("p",null,`
                            This proxy is a delegated gateway therefore `+d(p("common.product.name"))+` does not have any visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),e[28]||(e[28]=a()),o(L,null,O({title:t(()=>[o(X,{type:"separated"},{default:t(()=>[o(D,{name:"outbound"}),e[21]||(e[21]=a()),e[22]||(e[22]=C("span",null,"Outbounds",-1))]),_:1})]),default:t(()=>[e[26]||(e[26]=a()),e[27]||(e[27]=a()),typeof T>"u"?(s(),u(f,{key:0},[typeof b>"u"?(s(),c(Q,{key:0})):(s(),u(f,{key:1},[o(B,{type:"passthrough"},{default:t(()=>[o(A,{protocol:"passthrough",traffic:b.passthrough},{default:t(()=>e[23]||(e[23]=[a(`
                        Non mesh traffic
                      `)])),_:2},1032,["traffic"])]),_:2},1024),e[25]||(e[25]=a()),(s(),u(f,null,v(["upstream"],n=>(s(),u(f,{key:n},[Object.values(b.outbounds).find(r=>{var l,m;return(typeof r.tcp<"u"?(l=r.tcp)==null?void 0:l[`${n}_cx_rx_bytes_total`]:(m=r.http)==null?void 0:m[`${n}_rq_total`])??!1})?(s(),c(z,{key:0,variant:"info",uri:`data-planes.notifications.recommend-reachable-services:${i.data.id}`},{default:t(()=>[o(E,{path:"data-planes.notifications.recommend-reachable-services"})]),_:1},8,["uri"])):_("",!0),e[24]||(e[24]=a()),o(S,{type:"outbounds",predicate:g.params.inactive?void 0:([r,l])=>{var m,k;return((typeof l.tcp<"u"?(m=l.tcp)==null?void 0:m[`${n}_cx_rx_bytes_total`]:(k=l.http)==null?void 0:k[`${n}_rq_total`])??0)>0},items:Object.entries(b.outbounds)},{default:t(({items:r})=>[r.length>0?(s(),c(B,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:t(()=>[(s(),u(f,null,v([/-([a-f0-9]){16}$/],l=>o(X,{key:l,type:"stack",size:"small"},{default:t(()=>[(s(!0),u(f,null,v(r,([m,k])=>(s(),c(A,{key:`${m}`,"data-testid":"dataplane-outbound",protocol:["grpc","http","tcp"].find(I=>typeof k[I]<"u")??"tcp",traffic:k,service:k.$resourceMeta.type===""?m.replace(l,""):void 0,direction:n},{default:t(()=>[o($,{"data-action":"",to:{name:(I=>I.includes("bound")?I.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(V(N).name)),params:{connection:m},query:{inactive:g.params.inactive}}},{default:t(()=>[a(d(m),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","service","direction"]))),128))]),_:2},1024)),64))]),_:2},1024)):_("",!0)]),_:2},1032,["predicate","items"])],64))),64))],64))],64)):(s(),c(P,{key:1}))]),_:2},[b?{name:"actions",fn:t(()=>[o(K,{checked:g.params.inactive,"data-testid":"dataplane-outbounds-inactive-toggle",onChange:n=>g.update({inactive:n})},{label:t(()=>e[18]||(e[18]=[a(`
                      Show inactive
                    `)])),_:2},1032,["checked","onChange"]),e[20]||(e[20]=a()),o($,{action:"refresh",appearance:"primary",onClick:Z},{default:t(()=>e[19]||(e[19]=[a(`
                    Refresh
                  `)])),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024),e[45]||(e[45]=a()),o(U,null,{default:t(n=>[n.route.name!==g.name?(s(),c(rt,{key:0,width:"670px",onClose:function(){g.replace({name:"data-plane-detail-view",params:{mesh:g.params.mesh,proxy:g.params.proxy},query:{inactive:g.params.inactive?null:void 0}})}},{default:t(()=>[(s(),c(st(n.Component),{data:g.params.subscription.length>0?i.data.dataplaneInsight.subscriptions:n.route.name.includes("-inbound-")?i.data.dataplane.networking.inbounds:(b==null?void 0:b.outbounds)||{},networking:i.data.dataplane.networking},null,8,["data","networking"]))]),_:2},1032,["onClose"])):_("",!0)]),_:2},1024),e[46]||(e[46]=a()),C("div",pt,[i.data.dataplaneInsight.mTLS?(s(!0),u(f,{key:0},v([i.data.dataplaneInsight.mTLS],n=>(s(),c(R,{key:n},{title:t(()=>[C("h2",null,d(p("data-planes.routes.item.mtls.title")),1)]),default:t(()=>[e[38]||(e[38]=a()),C("div",ut,[o(w,null,{title:t(()=>[a(d(p("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:t(()=>[a(d(p("common.formats.datetime",{value:Date.parse(n.certificateExpirationTime)})),1)]),_:2},1024),e[34]||(e[34]=a()),o(w,null,{title:t(()=>[a(d(p("data-planes.routes.item.mtls.generation_time.title")),1)]),body:t(()=>[a(d(p("common.formats.datetime",{value:Date.parse(n.lastCertificateRegeneration)})),1)]),_:2},1024),e[35]||(e[35]=a()),o(w,null,{title:t(()=>[a(d(p("data-planes.routes.item.mtls.regenerations.title")),1)]),body:t(()=>[a(d(p("common.formats.integer",{value:n.certificateRegenerations})),1)]),_:2},1024),e[36]||(e[36]=a()),o(w,null,{title:t(()=>[a(d(p("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:t(()=>[a(d(n.issuedBackend),1)]),_:2},1024),e[37]||(e[37]=a()),o(w,null,{title:t(()=>[a(d(p("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:t(()=>[C("ul",null,[(s(!0),u(f,null,v(n.supportedBackends,r=>(s(),u("li",{key:r},d(r),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):_("",!0)]),e[47]||(e[47]=a()),i.data.dataplaneInsight.subscriptions.length>0?(s(),u("div",mt,[o(R,null,{title:t(()=>[C("h2",null,d(p("data-planes.routes.item.subscriptions.title")),1)]),default:t(()=>[e[43]||(e[43]=a()),o(it,{headers:[{...x.get("headers.instanceId"),label:p("http.api.property.instanceId"),key:"instanceId"},{...x.get("headers.version"),label:p("http.api.property.version"),key:"version"},{...x.get("headers.connected"),label:p("http.api.property.connected"),key:"connected"},{...x.get("headers.disconnected"),label:p("http.api.property.disconnected"),key:"disconnected"},{...x.get("headers.responses"),label:p("http.api.property.responses"),key:"responses"}],"is-selected-row":n=>n.id===g.params.subscription,items:i.data.dataplaneInsight.subscriptions.map((n,r,l)=>l[l.length-(r+1)]),onResize:x.set},{instanceId:t(({row:n})=>[o($,{"data-action":"",to:{name:"data-plane-subscription-summary-view",params:{subscription:n.id}}},{default:t(()=>[a(d(n.controlPlaneInstanceId),1)]),_:2},1032,["to"])]),version:t(({row:n})=>{var r,l;return[a(d(((l=(r=n.version)==null?void 0:r.kumaDp)==null?void 0:l.version)??"-"),1)]}),connected:t(({row:n})=>[a(d(p("common.formats.datetime",{value:Date.parse(n.connectTime??"")})),1)]),disconnected:t(({row:n})=>[n.disconnectTime?(s(),u(f,{key:0},[a(d(p("common.formats.datetime",{value:Date.parse(n.disconnectTime)})),1)],64)):_("",!0)]),responses:t(({row:n})=>{var r;return[(s(!0),u(f,null,v([((r=n.status)==null?void 0:r.total)??{}],l=>(s(),u(f,null,[a(d(l.responsesSent)+"/"+d(l.responsesAcknowledged),1)],64))),256))]}),_:2},1032,["headers","is-selected-row","items","onResize"])]),_:2},1024)])):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),vt=dt(yt,[["__scopeId","data-v-3ca162e7"]]);export{vt as default};
