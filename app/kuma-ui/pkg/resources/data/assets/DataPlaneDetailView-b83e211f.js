import{a as Y,K as D}from"./index-fce48c05.js";import{_ as K,a as g,o as r,b as f,w as e,p as o,r as $,f as t,d as q,c as _,e as l,l as L,t as n,q as a,s as w,n as J,M as Q,Y as tt,Z as h,a0 as et,F as v,a1 as at,I as k,a2 as st,a3 as ot,y as nt,z as lt}from"./index-0b6c94ac.js";import{E as rt}from"./ErrorBlock-079b6579.js";import{_ as dt}from"./LoadingBlock.vue_vue_type_script_setup_true_lang-9a881b0c.js";import{S as it}from"./StatusBadge-db918b29.js";import{T as A}from"./TagList-d45612b3.js";import{T as B}from"./TextWithCopyButton-3bc20558.js";import{_ as ct}from"./SubscriptionList.vue_vue_type_script_setup_true_lang-b39d5d5e.js";import"./WarningIcon.vue_vue_type_script_setup_true_lang-be89ecbe.js";import"./CopyButton-ca8a8ca0.js";import"./AccordionList-00194334.js";const ut={},_t={class:"card"},pt={class:"title"},ft={class:"body"};function mt(m,s){const p=g("KCard");return r(),f(p,{class:"data-card"},{default:e(()=>[o("dl",null,[o("div",_t,[o("dt",pt,[$(m.$slots,"title",{},void 0,!0)]),t(),o("dd",ft,[$(m.$slots,"default",{},void 0,!0)])])])]),_:3})}const O=K(ut,[["render",mt],["__scopeId","data-v-65e18720"]]),ht={class:"service-traffic"},vt={class:"actions"},yt=q({__name:"DataPlaneTraffic",setup(m){return(s,p)=>(r(),_("div",ht,[o("div",vt,[$(s.$slots,"actions",{},void 0,!0)]),t(),l(O,{class:"header"},{title:e(()=>[$(s.$slots,"title",{},void 0,!0)]),_:3}),t(),$(s.$slots,"default",{},void 0,!0)]))}});const N=K(yt,[["__scopeId","data-v-500eaf28"]]),gt={class:"title"},bt={key:0},kt=q({__name:"ServiceTrafficCard",props:{protocol:{},requests:{default:void 0},rx:{default:0},tx:{default:0}},setup(m){const{t:s}=L(),p=m;return(c,C)=>{const V=g("KBadge");return r(),f(O,{class:"service-traffic-card"},{title:e(()=>[l(V,{appearance:p.protocol==="unknown"?"success":"info"},{default:e(()=>[t(n(a(s)(`data-planes.components.service_traffic_card.protocol.${p.protocol}`,{},{defaultMessage:a(s)(`http.api.value.${p.protocol}`)})),1)]),_:1},8,["appearance"]),t(),o("span",gt,[$(c.$slots,"default",{},void 0,!0)])]),default:e(()=>[t(),o("dl",null,[o("div",null,[o("dt",null,n(a(s)("data-planes.components.service_traffic_card.tx")),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:p.tx})),1)]),t(),o("div",null,[o("dt",null,n(a(s)("data-planes.components.service_traffic_card.rx")),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:p.rx})),1)]),t(),typeof p.requests<"u"?(r(),_("div",bt,[o("dt",null,n(a(s)("data-planes.components.service_traffic_card.requests")),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:p.requests})),1)])):w("",!0)])]),_:3})}}});const M=K(kt,[["__scopeId","data-v-19bc134f"]]),xt={class:"body"},$t=q({__name:"ServiceTrafficGroup",props:{type:{}},setup(m){const s=m;return(p,c)=>{const C=g("KCard");return r(),f(C,{class:J(["service-traffic-group",`type-${s.type}`])},{default:e(()=>[o("div",xt,[$(p.$slots,"default",{},void 0,!0)])]),_:3},8,["class"])}}});const P=K($t,[["__scopeId","data-v-baf4abf7"]]),wt=m=>(nt("data-v-b1de0e01"),m=m(),lt(),m),Ct={"data-testid":"dataplane-warnings"},It=["data-testid","innerHTML"],Tt={class:"stack","data-testid":"dataplane-details"},Kt={class:"columns"},Dt={class:"status-with-reason"},Bt={class:"columns"},qt=wt(()=>o("span",null,"Outbounds",-1)),St={class:"passthrough"},Rt={class:"outbounds"},Mt={key:1,"data-testid":"dataplane-inbounds"},Pt={class:"inbound-list"},Vt={class:"mt-4 columns"},zt={"data-testid":"dataplane-mtls"},Et={class:"columns"},At=["innerHTML"],Nt={key:2,"data-testid":"dataplane-subscriptions"},Lt=q({__name:"DataPlaneDetailView",props:{data:{}},setup(m){const{t:s,formatIsoDate:p}=L(),c=m,C=Q(()=>c.data.warnings.concat(...c.data.isCertExpired?[{kind:"CERT_EXPIRED"}]:[]));return(V,Ot)=>{const G=g("KTooltip"),I=g("KCard"),H=g("KButton"),U=g("DataSource"),z=g("KBadge"),F=g("KAlert"),Z=g("AppView"),j=g("RouteView");return r(),f(j,{params:{mesh:"",dataPlane:""},name:"data-plane-detail-view"},{default:e(({can:W,route:E})=>[l(Z,null,tt({default:e(()=>[t(),o("div",Tt,[l(I,null,{default:e(()=>[o("div",Kt,[l(h,null,{title:e(()=>[t(n(a(s)("http.api.property.status")),1)]),body:e(()=>[o("div",Dt,[l(it,{status:c.data.status},null,8,["status"]),t(),c.data.unhealthyInbounds.length>0?(r(),f(G,{key:0,label:c.data.unhealthyInbounds.map(d=>a(s)("data-planes.routes.item.unhealthy_inbound",{service:d.service,port:d.port})).join(", "),class:"reason-tooltip"},{default:e(()=>[l(a(et),{color:a(Y),size:a(D),"hide-title":""},null,8,["color","size"])]),_:1},8,["label"])):w("",!0)])]),_:1}),t(),l(h,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.last_updated")),1)]),body:e(()=>[t(n(a(p)(c.data.modificationTime)),1)]),_:1}),t(),c.data.dataplane.networking.gateway?(r(),_(v,{key:0},[l(h,null,{title:e(()=>[t(n(a(s)("http.api.property.tags")),1)]),body:e(()=>[l(A,{tags:c.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:1}),t(),l(h,null,{title:e(()=>[t(n(a(s)("http.api.property.address")),1)]),body:e(()=>[l(B,{text:`${c.data.dataplane.networking.address}`},null,8,["text"])]),_:1})],64)):w("",!0)])]),_:1}),t(),W("read traffic")&&c.data.dataplaneType==="standard"?(r(),f(U,{key:0,src:`/meshes/${E.params.mesh}/dataplanes/${E.params.dataPlane}/traffic`},{default:e(({data:d,error:x,refresh:X})=>[x?(r(),f(rt,{key:0,error:x},null,8,["error"])):d===void 0?(r(),f(dt,{key:1})):(r(),f(I,{key:2,class:"traffic"},{default:e(()=>[o("div",Bt,[l(N,null,{title:e(()=>[l(a(at),{display:"inline-block",decorative:"",size:a(D)},null,8,["size"]),t(`
                  Inbounds
                `)]),data:e(()=>[o("dl",null,[o("div",null,[o("dt",null,n(a(s)("services.components.service_traffic.inbound",{},{defaultMessage:"Requests"})),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),l(P,{type:"inbound"},{default:e(()=>[(r(!0),_(v,null,k(d.inbounds,u=>(r(),_(v,{key:`${u.name}`},[(r(!0),_(v,null,k([{protocol:typeof u.http<"u"?"http":"tcp",direction:"downstream"}],i=>{var b,y;return r(),f(M,{key:i.protocol,protocol:i.protocol,rx:(b=u[i.protocol])==null?void 0:b[`${i.direction}_cx_tx_bytes_total`],tx:(y=u[i.protocol])==null?void 0:y[`${i.direction}_cx_rx_bytes_total`],requests:i.protocol==="http"?["http1_total","http2_total","http3_total"].reduce((S,R)=>{var T;return S+(((T=u.http)==null?void 0:T[`${i.direction}_rq_${R}`])??0)},0):void 0},{default:e(()=>[t(n(u.name),1)]),_:2},1032,["protocol","rx","tx","requests"])}),128))],64))),128))]),_:2},1024)]),_:2},1024),t(),l(N,null,{actions:e(()=>[l(H,{appearance:"primary",onClick:X},{default:e(()=>[l(a(st),{size:a(D)},null,8,["size"]),t(`

                    Refresh
                  `)]),_:2},1032,["onClick"])]),title:e(()=>[l(a(ot),{display:"inline-block",decorative:"",size:a(D)},null,8,["size"]),t(),qt]),data:e(()=>[o("dl",null,[o("div",null,[o("dt",St,n(a(s)("services.components.service_traffic.passthrough",{},{defaultMessage:"Passthrough Requests"})),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:1e3})),1)]),t(),o("div",null,[o("dt",Rt,n(a(s)("services.components.service_traffic.mesh",{},{defaultMessage:"Mesh Requests"})),1),t(),o("dd",null,n(a(s)("common.formats.integer",{value:1e3})),1)])])]),default:e(()=>[t(),t(),t(),l(P,{type:"passthrough"},{default:e(()=>[(r(),_(v,null,k([{protocol:"cluster",direction:"downstream"}],u=>l(M,{key:u.protocol,protocol:"unknown",rx:d.passthrough.reduce((i,b)=>{var y;return i+(((y=b[u.protocol])==null?void 0:y[`${u.direction}_cx_tx_bytes_total`])??0)},0),tx:d.passthrough.reduce((i,b)=>{var y;return i+(((y=b[u.protocol])==null?void 0:y[`${u.direction}_cx_rx_bytes_total`])??0)},0)},{default:e(()=>[t(`
                      Non mesh traffic
                    `)]),_:2},1032,["rx","tx"])),64))]),_:2},1024),t(),l(P,{type:"outbound"},{default:e(()=>[(r(!0),_(v,null,k(d.outbounds,u=>(r(),_(v,{key:`${u.name}`},[(r(!0),_(v,null,k([{protocol:typeof u.http<"u"?"http":"tcp",direction:"downstream"}],i=>{var b,y;return r(),f(M,{key:i.protocol,protocol:i.protocol,rx:(b=u[i.protocol])==null?void 0:b[`${i.direction}_cx_tx_bytes_total`],tx:(y=u[i.protocol])==null?void 0:y[`${i.direction}_cx_rx_bytes_total`],requests:i.protocol==="http"?["http1_total","http2_total","http3_total"].reduce((S,R)=>{var T;return S+(((T=u.http)==null?void 0:T[`${i.direction}_rq_${R}`])??0)},0):void 0},{default:e(()=>[t(n(u.name),1)]),_:2},1032,["protocol","rx","tx","requests"])}),128))],64))),128))]),_:2},1024)]),_:2},1024)])]),_:2},1024))]),_:2},1032,["src"])):w("",!0),t(),c.data.dataplane.networking.inbounds.length>0?(r(),_("div",Mt,[o("h2",null,n(a(s)("data-planes.routes.item.inbounds")),1),t(),l(I,{class:"mt-4"},{default:e(()=>[o("div",Pt,[(r(!0),_(v,null,k(c.data.dataplane.networking.inbounds,(d,x)=>(r(),_("div",{key:x,class:"inbound"},[o("h4",null,[l(B,{text:d.tags["kuma.io/service"]},{default:e(()=>[t(n(a(s)("data-planes.routes.item.inbound_name",{service:d.tags["kuma.io/service"]})),1)]),_:2},1032,["text"])]),t(),o("div",Vt,[l(h,null,{title:e(()=>[t(n(a(s)("http.api.property.status")),1)]),body:e(()=>[d.health.ready?(r(),f(z,{key:0,appearance:"success"},{default:e(()=>[t(n(a(s)("data-planes.routes.item.health.ready")),1)]),_:1})):(r(),f(z,{key:1,appearance:"danger"},{default:e(()=>[t(n(a(s)("data-planes.routes.item.health.not_ready")),1)]),_:1}))]),_:2},1024),t(),l(h,null,{title:e(()=>[t(n(a(s)("http.api.property.tags")),1)]),body:e(()=>[l(A,{tags:d.tags},null,8,["tags"])]),_:2},1024),t(),l(h,null,{title:e(()=>[t(n(a(s)("http.api.property.address")),1)]),body:e(()=>[l(B,{text:d.addressPort},null,8,["text"])]),_:2},1024),t(),l(h,null,{title:e(()=>[t(n(a(s)("http.api.property.serviceAddress")),1)]),body:e(()=>[l(B,{text:d.serviceAddressPort},null,8,["text"])]),_:2},1024)])]))),128))])]),_:1})])):w("",!0),t(),o("div",zt,[o("h2",null,n(a(s)("data-planes.routes.item.mtls.title")),1),t(),c.data.dataplaneInsight.mTLS?(r(!0),_(v,{key:0},k([c.data.dataplaneInsight.mTLS],d=>(r(),f(I,{key:d,class:"mt-4"},{default:e(()=>[o("div",Et,[l(h,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.expiration_time.title")),1)]),body:e(()=>[t(n(a(p)(d.certificateExpirationTime)),1)]),_:2},1024),t(),l(h,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.generation_time.title")),1)]),body:e(()=>[t(n(a(p)(d.lastCertificateRegeneration)),1)]),_:2},1024),t(),l(h,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.regenerations.title")),1)]),body:e(()=>[t(n(a(s)("common.formats.integer",{value:d.certificateRegenerations})),1)]),_:2},1024),t(),l(h,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:e(()=>[t(n(d.issuedBackend),1)]),_:2},1024),t(),l(h,null,{title:e(()=>[t(n(a(s)("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:e(()=>[o("ul",null,[(r(!0),_(v,null,k(d.supportedBackends,x=>(r(),_("li",{key:x},n(x),1))),128))])]),_:2},1024)])]),_:2},1024))),128)):(r(),f(F,{key:1,class:"mt-4",appearance:"warning"},{alertMessage:e(()=>[o("div",{innerHTML:a(s)("data-planes.routes.item.mtls.disabled")},null,8,At)]),_:1}))]),t(),c.data.dataplaneInsight.subscriptions.length>0?(r(),_("div",Nt,[o("h2",null,n(a(s)("data-planes.routes.item.subscriptions.title")),1),t(),l(I,{class:"mt-4"},{default:e(()=>[l(ct,{subscriptions:c.data.dataplaneInsight.subscriptions},null,8,["subscriptions"])]),_:1})])):w("",!0)])]),_:2},[C.value.length>0?{name:"notifications",fn:e(()=>[o("ul",Ct,[(r(!0),_(v,null,k(C.value,d=>(r(),_("li",{key:d.kind,"data-testid":`warning-${d.kind}`,innerHTML:a(s)(`common.warnings.${d.kind}`,d.payload)},null,8,It))),128)),t()])]),key:"0"}:void 0]),1024)]),_:1})}}});const te=K(Lt,[["__scopeId","data-v-b1de0e01"]]);export{te as default};
