import{d as nt,a2 as ot,v as st,r as y,p as u,o as s,w as e,b as n,m as D,a3 as it,c as p,e as a,L as m,M as C,q as k,l as o,t as d,T as dt,F as lt,$ as rt,a4 as j,a9 as Z,y as pt,_ as ut}from"./index-BI7Ox0LO.js";import{T as mt}from"./TagList-BZLeI2Ir.js";import{C as G,a as F,b as P}from"./ConnectionTraffic-CQS6rqo-.js";const ft={key:0},yt={key:1},vt={key:2},kt={key:0},gt={key:1},bt={key:2},xt={key:0},wt={key:1},Ct=nt({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(H){const K=ot(),i=H,_=st();return(ct,t)=>{const R=y("XI18n"),V=y("XNotification"),N=y("XIcon"),M=y("DataCollection"),g=y("XLayout"),z=y("XAction"),w=y("XBadge"),J=y("XCopyButton"),B=y("XDl"),T=y("DataSource"),U=y("DataLoader"),Q=y("XAboutCard"),W=y("XEmptyState"),Y=y("XCard"),L=y("XDrawer"),h=y("RouterView"),tt=y("AppView"),at=y("RouteView");return s(),u(at,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:""},name:"data-plane-detail-view"},{default:e(({route:f,t:r,can:E,uri:A})=>[n(T,{src:A(D(it),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[f.params.proxyType]??"dataplane",name:f.params.proxy,mesh:f.params.mesh||"*",socketAddress:"self_inbound"})},{default:e(({data:I,error:q,refresh:et})=>[n(tt,{notifications:!0},{default:e(()=>[(s(!0),p(m,null,C([{bool:i.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1,key:"dp-cp-incompatible",params:{kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:i.data.dataplaneInsight.version?.envoy?.kumaDpCompatible===!1,key:"envoy-dp-incompatible",params:{envoy:i.data.dataplaneInsight.version?.envoy.version??"",kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:!!(E("use zones")&&i.data.zone&&i.data.dataplaneInsight.version?.kumaDp?.kumaCpCompatible===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:i.data.dataplaneInsight.version?.kumaDp.version??""}},{bool:i.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:i.data.isCertExpired,key:"certificate-expired"},{bool:!i.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:i.data.dataplane.networking.gateway?.type!=="BUILTIN"&&!E("use transparent-proxying",i.data),key:"networking-transparent-proxying",variant:"info"}],({bool:l,key:b,params:O,variant:c})=>(s(),u(V,{key:b,notify:l,"data-testid":`warning-${b}`,uri:`data-planes.notifications.${b}.${i.data.id}`,variant:c},{default:e(()=>[n(R,{path:`data-planes.notifications.${b}`,params:Object.fromEntries(Object.entries(O??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),t[66]||(t[66]=a()),n(g,{type:"stack","data-testid":"dataplane-details"},{default:e(()=>[n(Q,{title:r("data-planes.routes.item.about.title"),created:i.data.creationTime,modified:i.data.modificationTime,class:"about-section"},{default:e(()=>[n(U,{data:[I]},{default:e(()=>[n(g,null,{default:e(()=>[n(B,{variant:"x-stack"},{default:e(()=>[o("div",null,[o("dt",null,d(r("http.api.property.status")),1),t[2]||(t[2]=a()),o("dd",null,[n(g,{type:"separated"},{default:e(()=>[n(dt,{status:i.data.status},null,8,["status"]),t[1]||(t[1]=a()),n(M,{items:i.data.dataplane.networking.inbounds,predicate:l=>l.state!=="Ready",empty:!1},{default:e(({items:l})=>[n(N,{name:"info"},{default:e(()=>[o("ul",null,[(s(!0),p(m,null,C(l,b=>(s(),p("li",{key:`${b.service}:${b.port}`},d(r("data-planes.routes.item.unhealthy_inbound",{port:b.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])]),_:2},1024)])]),t[8]||(t[8]=a()),E("use zones")&&i.data.zone?(s(),p("div",ft,[o("dt",null,d(r("http.api.property.zone")),1),t[3]||(t[3]=a()),o("dd",null,[n(w,{appearance:"decorative"},{default:e(()=>[n(z,{to:{name:"zone-cp-detail-view",params:{zone:i.data.zone}}},{default:e(()=>[a(d(i.data.zone),1)]),_:1},8,["to"])]),_:1})])])):k("",!0),t[9]||(t[9]=a()),o("div",null,[o("dt",null,d(r("http.api.property.type")),1),t[4]||(t[4]=a()),o("dd",null,[n(w,{appearance:"decorative"},{default:e(()=>[a(d(r(`data-planes.type.${i.data.dataplaneType}`)),1)]),_:2},1024)])]),t[10]||(t[10]=a()),i.data.namespace.length>0?(s(),p("div",yt,[o("dt",null,d(r("http.api.property.namespace")),1),t[5]||(t[5]=a()),o("dd",null,[n(w,{appearance:"decorative"},{default:e(()=>[a(d(i.data.namespace),1)]),_:1})])])):k("",!0),t[11]||(t[11]=a()),o("div",null,[o("dt",null,d(r("http.api.property.address")),1),t[6]||(t[6]=a()),o("dd",null,[n(J,{variant:"badge",format:"default",text:`${i.data.dataplane.networking.address}`},null,8,["text"])])]),t[12]||(t[12]=a()),i.data.dataplane.networking.gateway?(s(),p("div",vt,[o("dt",null,d(r("http.api.property.tags")),1),t[7]||(t[7]=a()),o("dd",null,[n(mt,{tags:i.data.dataplane.networking.gateway.tags},null,8,["tags"])])])):k("",!0)]),_:2},1024),t[33]||(t[33]=a()),i.data.dataplaneInsight.mTLS?(s(),u(g,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:e(()=>[o("h3",null,d(r("data-planes.routes.item.mtls.title")),1),t[24]||(t[24]=a()),n(g,{size:"small"},{default:e(()=>[(s(!0),p(m,null,C([i.data.dataplaneInsight.mTLS],l=>(s(),p(m,{key:typeof l},[typeof l.lastCertificateRegeneration<"u"&&typeof l.certificateExpirationTime<"u"&&typeof l.issuedBackend<"u"?(s(),u(B,{key:0,variant:"x-stack"},{default:e(()=>[o("div",null,[o("dt",null,d(r("data-planes.routes.item.mtls.generation_time.title")),1),t[13]||(t[13]=a()),o("dd",null,[n(w,{appearance:"neutral"},{default:e(()=>[a(d(r("common.formats.datetime",{value:Date.parse(l.lastCertificateRegeneration)})),1)]),_:2},1024)])]),t[15]||(t[15]=a()),o("div",null,[o("dt",null,d(r("data-planes.routes.item.mtls.expiration_time.title")),1),t[14]||(t[14]=a()),o("dd",null,[n(w,{appearance:"neutral"},{default:e(()=>[a(d(r("common.formats.datetime",{value:Date.parse(l.certificateExpirationTime)})),1)]),_:2},1024)])])]),_:2},1024)):(s(),p(m,{key:1},[n(R,{path:"data-planes.routes.item.mtls.managed_externally"}),t[17]||(t[17]=a()),typeof I?.$meta?.tls?.certificateExpirationTime<"u"?(s(),u(B,{key:0,variant:"x-stack"},{default:e(()=>[o("div",null,[o("dt",null,d(r("data-planes.routes.item.mtls.expiration_time.title")),1),t[16]||(t[16]=a()),o("dd",null,[n(w,{appearance:"neutral"},{default:e(()=>[a(d(r("common.formats.datetime",{value:I?.$meta?.tls?.certificateExpirationTime})),1)]),_:2},1024)])])]),_:2},1024)):k("",!0)],64)),t[23]||(t[23]=a()),n(B,{variant:"x-stack"},{default:e(()=>[typeof l.certificateRegenerations<"u"?(s(),p("div",kt,[o("dt",null,d(r("data-planes.routes.item.mtls.regenerations.title")),1),t[18]||(t[18]=a()),o("dd",null,[n(w,{appearance:"info"},{default:e(()=>[a(d(r("common.formats.integer",{value:l.certificateRegenerations})),1)]),_:2},1024)])])):k("",!0),t[21]||(t[21]=a()),typeof l.issuedBackend<"u"?(s(),p("div",gt,[o("dt",null,d(r("data-planes.routes.item.mtls.issued_backend.title")),1),t[19]||(t[19]=a()),o("dd",null,[n(w,{appearance:"decorative"},{default:e(()=>[a(d(l.issuedBackend),1)]),_:2},1024)])])):k("",!0),t[22]||(t[22]=a()),typeof l.supportedBackends<"u"?(s(),p("div",bt,[o("dt",null,d(r("data-planes.routes.item.mtls.supported_backends.title")),1),t[20]||(t[20]=a()),o("dd",null,[n(g,{type:"separated",truncate:""},{default:e(()=>[(s(!0),p(m,null,C(l.supportedBackends,b=>(s(),u(w,{key:b,appearance:b===l.issuedBackend?"decorative":"info"},{default:e(()=>[a(d(b),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)])])):k("",!0)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):k("",!0),t[34]||(t[34]=a()),i.data.dataplaneInsight.subscriptions.length>0?(s(),u(g,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:e(()=>[n(g,{type:"separated"},{default:e(()=>[o("h3",null,d(r("data-planes.routes.item.subscriptions.title")),1),t[25]||(t[25]=a()),n(z,{appearance:"anchor",to:{name:"data-plane-subscriptions-list-view",params:{mesh:f.params.mesh,proxy:f.params.proxy},query:{inactive:f.params.inactive}}},{default:e(()=>[a(`
                      (`+d(r("data-planes.routes.item.xds.show-details"))+`)
                    `,1)]),_:2},1032,["to"])]),_:2},1024),t[31]||(t[31]=a()),i.data.dataplaneInsight.connectedSubscription?(s(),u(B,{key:0,variant:"x-stack"},{default:e(()=>[o("div",null,[o("dt",null,d(r("data-planes.routes.item.xds.connected")),1),t[26]||(t[26]=a()),o("dd",null,[n(w,{appearance:"neutral"},{default:e(()=>[a(d(r("common.formats.datetime",{value:Date.parse(i.data.dataplaneInsight.connectedSubscription.connectTime??"")})),1)]),_:2},1024)])]),t[29]||(t[29]=a()),o("div",null,[o("dt",null,d(r("data-planes.routes.item.xds.instance")),1),t[27]||(t[27]=a()),o("dd",null,[n(w,null,{default:e(()=>[a(d(i.data.dataplaneInsight.connectedSubscription.controlPlaneInstanceId),1)]),_:1})])]),t[30]||(t[30]=a()),o("div",null,[o("dt",null,d(r("data-planes.routes.item.xds.version")),1),t[28]||(t[28]=a()),o("dd",null,[n(w,null,{default:e(()=>[a(d(i.data.dataplaneInsight.connectedSubscription.version?.kumaDp?.version??r("common.unknown")),1)]),_:2},1024)])])]),_:2},1024)):(s(),u(R,{key:1,path:"data-planes.routes.item.xds.disconnected"}))]),_:2},1024)):k("",!0),t[35]||(t[35]=a()),E("use unified-resource-naming",{mesh:i.mesh,dataplaneOverview:i.data})?(s(),u(T,{key:2,src:A(D(lt),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:f.params.mesh,name:f.params.proxy}),onChange:t[0]||(t[0]=l=>_.value=l)},{default:e(()=>[_.value?.policies.length?(s(),u(g,{key:0,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:e(()=>[o("h3",null,d(r("data-planes.routes.item.policies")),1),t[32]||(t[32]=a()),n(g,{type:"separated"},{default:e(()=>[(s(!0),p(m,null,C(_.value?.policies,l=>(s(),u(z,{key:l.kind,to:{name:"data-plane-policy-config-summary-view",params:{mesh:f.params.mesh,proxy:f.params.proxy,policy:l.kind.toLowerCase()}}},{default:e(()=>[n(w,null,{default:e(()=>[a(d(l.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2},1024)):k("",!0)]),_:2},1032,["src"])):k("",!0)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["title","created","modified"]),t[65]||(t[65]=a()),n(T,{src:A(D(rt),"/meshes/:mesh/dataplanes/:name/layout",{mesh:f.params.mesh,name:f.params.proxy})},{default:e(({data:l,refresh:b,error:O})=>[n(V,{notify:!!q,"data-testid":"warning-stats-not-enhanced",uri:`data-planes.notifications.stats-not-enhanced.${i.data.id}`},{default:e(()=>[n(R,{path:"data-planes.notifications.stats-not-enhanced",params:{error:q?.toString()??""}},null,8,["params"])]),_:2},1032,["notify","uri"]),t[63]||(t[63]=a()),n(Y,{class:"traffic","data-testid":"dataplane-traffic"},{default:e(()=>[n(U,{data:[l,I]},{default:e(()=>[n(g,{type:"columns"},{default:e(()=>[n(G,null,{title:e(()=>[n(g,{type:"separated"},{default:e(()=>[n(N,{name:"inbound"}),t[36]||(t[36]=a()),t[37]||(t[37]=o("span",null,"Inbounds",-1))]),_:1})]),default:e(()=>[t[40]||(t[40]=a()),(s(!0),p(m,null,C([Object.groupBy(i.data.dataplane.networking.inbounds,c=>c.port)],(c,x)=>(s(),p(m,{key:x},[(s(!0),p(m,null,C([l.inbounds],v=>(s(),u(F,{key:typeof v,type:"inbound","data-testid":"dataplane-inbounds"},{default:e(()=>[n(g,{type:"stack",size:"small"},{default:e(()=>[(s(!0),p(m,null,C(v,X=>(s(),p(m,{key:`${X.kri}`},[(s(!0),p(m,null,C([c[X.port]?.[0]],S=>(s(),u(P,{key:S?.port,"data-testid":"dataplane-inbound",protocol:X.protocol,"port-name":S?.portName,traffic:I?.inbounds[X.stat_prefix],"data-actionable":""},{state:e(()=>[S?.state!=="Ready"?(s(),u(N,{key:0,name:"danger",size:D(j),placement:"right"},{default:e(()=>[a(d(r("data-planes.routes.item.unhealthy_inbound",{port:S?.port})),1)]),_:2},1032,["size"])):(s(!0),p(m,{key:1},C([I?.inbounds[X.stat_prefix]?.$meta.alerts.reports??[]],$=>(s(),p(m,{key:typeof $},[n(V,{notify:$.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${i.data.id}`},{default:e(()=>[n(R,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[38]||(t[38]=a()),$.length?(s(),u(z,{key:0,"data-action":"",to:{name:"data-plane-connection-inbound-summary-stats-view",params:{connection:X.stat_prefix},query:{codeSearch:$.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:e(()=>[n(N,{name:"warning",size:D(j),placement:"right"},null,8,["size"])]),_:1},8,["to"])):k("",!0)],64))),128))]),default:e(()=>[t[39]||(t[39]=a()),n(z,{"data-action":"",to:{name:($=>$.includes("bound")?$.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(D(K).name)),params:{connection:X.proxyResourceName},query:{inactive:f.params.inactive}}},{default:e(()=>[a(`
                                    :`+d(X.port),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:2},1024),t[62]||(t[62]=a()),n(G,null,{actions:e(()=>[n(z,{action:"refresh",appearance:"primary",onClick:()=>{b(),et()}},{default:e(()=>[...t[41]||(t[41]=[a(`
                        Refresh
                      `,-1)])]),_:1},8,["onClick"])]),title:e(()=>[n(g,{type:"separated"},{default:e(()=>[n(N,{name:"outbound"}),t[42]||(t[42]=a()),t[43]||(t[43]=o("span",null,"Outbounds",-1))]),_:1})]),default:e(()=>[t[60]||(t[60]=a()),t[61]||(t[61]=a()),typeof O>"u"&&typeof q>"u"&&l?.outbounds.length?(s(),p(m,{key:0},[n(F,{type:"passthrough"},{default:e(()=>[n(P,{protocol:"passthrough",traffic:I?.passthrough},{default:e(()=>[...t[44]||(t[44]=[a(`
                          Non mesh traffic
                        `,-1)])]),_:1},8,["traffic"])]),_:2},1024),t[59]||(t[59]=a()),n(M,{type:"outbounds",items:l?.outbounds},{default:e(({items:c})=>[n(F,{type:"outbound","data-testid":"dataplane-outbounds"},{default:e(()=>[n(g,{type:"stack",size:"small"},{default:e(()=>[(s(!0),p(m,null,C(c,x=>(s(),u(P,{key:x.kri,"data-testid":"dataplane-outbound",protocol:x.protocol,traffic:I?.outbounds[x.kri],kri:x.kri,"data-actionable":""},{state:e(()=>[(s(!0),p(m,null,C([I?.outbounds[x.proxyResourceName]?.$meta.alerts.reports??[]],v=>(s(),p(m,{key:typeof v},[n(V,{notify:v.length>0,"data-testid":"warning-abnormal-traffic-stats",uri:`data-planes.notifications.abnormal-traffic-stats.${i.data.id}`},{default:e(()=>[n(R,{path:"data-planes.notifications.abnormal-traffic-stats"})]),_:1},8,["notify","uri"]),t[45]||(t[45]=a()),v.length?(s(),u(z,{key:0,"data-action":"",to:{name:"data-plane-connection-outbound-summary-stats-view",params:{connection:x.proxyResourceName},query:{codeSearch:v.join("|"),codeFilter:!0,codeRegExp:!0}}},{default:e(()=>[n(N,{name:"warning",size:D(j),placement:"right"},null,8,["size"])]),_:1},8,["to"])):k("",!0)],64))),128))]),body:e(()=>[(s(!0),p(m,null,C([D(Z).fromString(x.proxyResourceName)],v=>(s(),u(B,{key:typeof v},{default:e(()=>[o("div",null,[t[46]||(t[46]=o("dt",null,"Mesh",-1)),t[47]||(t[47]=a()),o("dd",null,d(v.mesh),1)]),t[54]||(t[54]=a()),v.zone.length>0?(s(),p("div",xt,[t[48]||(t[48]=o("dt",null,"Zone",-1)),t[49]||(t[49]=a()),o("dd",null,d(v.zone),1)])):k("",!0),t[55]||(t[55]=a()),v.namespace.length>0?(s(),p("div",wt,[t[50]||(t[50]=o("dt",null,"Namespace",-1)),t[51]||(t[51]=a()),o("dd",null,d(v.namespace),1)])):k("",!0),t[56]||(t[56]=a()),o("div",null,[t[52]||(t[52]=o("dt",null,"Port",-1)),t[53]||(t[53]=a()),o("dd",null,d(`${x.port}${x.portName?` (${x.portName})`:""}`),1)])]),_:2},1024))),128))]),default:e(()=>[t[57]||(t[57]=a()),n(z,{"data-action":"",to:{name:(v=>v.includes("bound")?v.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(D(K).name)),params:{connection:x.proxyResourceName},query:{inactive:f.params.inactive}}},{default:e(()=>[a(d(D(Z).fromString(x.proxyResourceName).name),1)]),_:2},1032,["to"]),t[58]||(t[58]=a())]),_:2},1032,["protocol","traffic","kri"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(s(),u(W,{key:1}))]),_:2},1024)]),_:2},1024)]),_:2},1032,["data"])]),_:2},1024),t[64]||(t[64]=a()),n(h,null,{default:e(c=>[c.route.name!==f.name?(s(),u(L,{key:0,width:"670px",onClose:()=>{f.replace({name:"data-plane-detail-view",params:{mesh:f.params.mesh,proxy:f.params.proxy},query:{inactive:f.params.inactive?null:void 0}})}},{default:e(()=>[(s(),u(pt(c.Component),{data:c.route.name.includes("-inbound-")?l?.inbounds:l?.outbounds,"data-plane-overview":i.data,networking:i.data.dataplane.networking,policies:_.value?.policies},null,8,["data","data-plane-overview","networking","policies"]))]),_:2},1032,["onClose"])):k("",!0)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),Xt=ut(Ct,[["__scopeId","data-v-eb8633a3"]]);export{Xt as default};
