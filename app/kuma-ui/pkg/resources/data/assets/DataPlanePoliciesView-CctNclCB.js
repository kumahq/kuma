import{a as j,A as F}from"./AccordionList-qOBdXsv5.js";import{d as I,r as k,o as e,c as a,s as u,e as n,F as r,v as f,t as d,b as o,w as s,q as N,m as c,T as M,_ as G,p as L,a2 as q,k as Y,C as J,n as Q,ag as U,a1 as W,a0 as Z,K as E}from"./index-CpZV_YPa.js";import{S as ee}from"./SummaryView-BiGq2bhz.js";import{P as H}from"./PolicyTypeTag-CEdhE0Da.js";import{T as z}from"./TagList-CfxheXaC.js";import{R as te}from"./RuleMatchers-CoqRt4Z1.js";const se={class:"policies-list"},ae={class:"mesh-gateway-policy-list"},ne={key:0},le={class:"dataplane-policy-header"},oe={key:0,class:"badge-list"},ie={class:"mt-1"},re=I({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},types:{}},setup(R){const v=R;return(P,t)=>{const X=k("XAction"),w=k("XBadge");return e(),a("div",se,[u("div",ae,[t[11]||(t[11]=u("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),t[12]||(t[12]=n()),P.gatewayDataplane.routePolicies.length>0?(e(),a("ul",ne,[(e(!0),a(r,null,f(P.gatewayDataplane.routePolicies,(i,m)=>{var p;return e(),a("li",{key:m},[u("span",null,d(i.type),1),t[0]||(t[0]=n(`:

          `)),o(X,{to:{name:"policy-detail-view",params:{mesh:i.mesh,policyPath:((p=v.types[i.type])==null?void 0:p.path)??"",policy:i.name}}},{default:s(()=>[n(d(i.name),1)]),_:2},1032,["to"])])}),128))])):N("",!0),t[13]||(t[13]=n()),t[14]||(t[14]=u("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),t[15]||(t[15]=n()),u("div",null,[(e(!0),a(r,null,f(P.gatewayDataplane.listenerEntries,(i,m)=>(e(),a("div",{key:m},[u("div",null,[u("div",null,[t[1]||(t[1]=u("b",null,"Host",-1)),n(": "+d(i.hostName)+":"+d(i.port)+" ("+d(i.protocol)+`)
            `,1)]),t[10]||(t[10]=n()),i.routeEntries.length>0?(e(),a(r,{key:0},[t[8]||(t[8]=u("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),t[9]||(t[9]=n()),o(F,{"initially-open":[],"multiple-open":""},{default:s(()=>[(e(!0),a(r,null,f(i.routeEntries,(p,h)=>(e(),c(j,{key:h},M({"accordion-header":s(()=>{var l;return[u("div",le,[u("div",null,[u("div",null,[t[2]||(t[2]=u("b",null,"Route",-1)),t[3]||(t[3]=n(": ")),o(X,{to:{name:"policy-detail-view",params:{mesh:p.route.mesh,policyPath:((l=v.types[p.route.type])==null?void 0:l.path)??"",policy:p.route.name}}},{default:s(()=>[n(d(p.route.name),1)]),_:2},1032,["to"])]),t[5]||(t[5]=n()),u("div",null,[t[4]||(t[4]=u("b",null,"Service",-1)),n(": "+d(p.service),1)])]),t[6]||(t[6]=n()),p.origins.length>0?(e(),a("div",oe,[(e(!0),a(r,null,f(p.origins,(y,$)=>(e(),c(w,{key:`${m}-${$}`},{default:s(()=>[n(d(y.type),1)]),_:2},1024))),128))])):N("",!0)])]}),_:2},[p.origins.length>0?{name:"accordion-content",fn:s(()=>[u("ul",ie,[(e(!0),a(r,null,f(p.origins,(l,y)=>{var $;return e(),a("li",{key:`${m}-${y}`},[n(d(l.type)+`:

                        `,1),o(X,{to:{name:"policy-detail-view",params:{mesh:l.mesh,policyPath:(($=v.types[l.type])==null?void 0:$.path)??"",policy:l.name}}},{default:s(()=>[n(d(l.name),1)]),_:2},1032,["to"])])}),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):N("",!0)])]))),128))])])])}}}),pe=G(re,[["__scopeId","data-v-a5c76432"]]),ue={class:"policy-type-heading"},de={class:"policy-list"},me={key:0},ce=I({__name:"PolicyTypeEntryList",props:{items:{},types:{}},setup(R){const v=R;function P({headerKey:t}){return{class:`cell-${t}`}}return(t,X)=>{const w=k("XAction"),i=k("XCodeBlock"),m=k("KTable");return e(),c(F,{"initially-open":[],"multiple-open":""},{default:s(()=>[(e(!0),a(r,null,f(t.items,(p,h)=>(e(),c(j,{key:h},{"accordion-header":s(()=>[u("h3",ue,[o(H,{"policy-type":p.type},{default:s(()=>[n(d(p.type)+" ("+d(p.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":s(()=>[u("div",de,[o(m,{class:"policy-type-table",fetcher:()=>({data:p.connections,total:p.connections.length}),headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":P,"disable-pagination":"","is-clickable":""},{sourceTags:s(({row:l})=>[l.sourceTags.length>0?(e(),c(z,{key:0,class:"tag-list","should-truncate":"",tags:l.sourceTags},null,8,["tags"])):(e(),a(r,{key:1},[n(`
                —
              `)],64))]),destinationTags:s(({row:l})=>[l.destinationTags.length>0?(e(),c(z,{key:0,class:"tag-list","should-truncate":"",tags:l.destinationTags},null,8,["tags"])):(e(),a(r,{key:1},[n(`
                —
              `)],64))]),name:s(({row:l})=>[l.name!==null?(e(),a(r,{key:0},[n(d(l.name),1)],64)):(e(),a(r,{key:1},[n(`
                —
              `)],64))]),origins:s(({row:l})=>[l.origins.length>0?(e(),a("ul",me,[(e(!0),a(r,null,f(l.origins,(y,$)=>{var V;return e(),a("li",{key:`${h}-${$}`},[o(w,{to:{name:"policy-detail-view",params:{mesh:y.mesh,policyPath:((V=v.types[y.type])==null?void 0:V.path)??"",policy:y.name}}},{default:s(()=>[n(d(y.name),1)]),_:2},1032,["to"])])}),128))])):(e(),a(r,{key:1},[n(`
                —
              `)],64))]),config:s(({row:l})=>[l.config?(e(),c(i,{key:0,code:L(q).stringify(l.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),a(r,{key:1},[n(`
                —
              `)],64))]),_:2},1032,["fetcher"])])]),_:2},1024))),128))]),_:1})}}}),ye=G(ce,[["__scopeId","data-v-3dd03e37"]]),_e={class:"policy-type-heading"},fe={key:0,class:"matcher"},ge={key:1},ke={key:0},he=I({__name:"RuleList",props:{rules:{},types:{}},setup(R){const{t:v}=Y(),P=R;return(t,X)=>{const w=k("XCodeBlock");return e(),c(F,{"initially-open":[],"multiple-open":""},{default:s(()=>[(e(!0),a(r,null,f([P.rules.reduce((i,m)=>(typeof i[m.type]>"u"&&(i[m.type]=[]),i[m.type].push(m),i),{})],i=>(e(),a(r,{key:i},[(e(!0),a(r,null,f(i,(m,p)=>(e(),c(j,{key:p},{"accordion-header":s(()=>[u("h3",_e,[o(H,{"policy-type":p},{default:s(()=>[n(d(p),1)]),_:2},1032,["policy-type"])])]),"accordion-content":s(()=>[(e(!0),a(r,null,f([m.some(h=>h.matchers.length>0)],h=>(e(),a("div",{key:h,class:"policy-list"},[o(J,{class:Q(["policy-type-table",{"has-matchers":h}]),items:m,headers:[...h?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:s(({row:l})=>[l.matchers.length>0?(e(),a("span",fe,[o(te,{items:l.matchers},null,8,["items"])])):(e(),a("i",ge,d(L(v)("data-planes.routes.item.matches_everything")),1))]),origins:s(({row:l})=>[l.origins.length>0?(e(),a("ul",ke,[(e(!0),a(r,null,f(l.origins,(y,$)=>{var V;return e(),a("li",{key:`${p}-${$}`},[o(U,{to:{name:"data-plane-policy-summary-view",params:{mesh:y.mesh,policyPath:((V=P.types[y.type])==null?void 0:V.path)??"",policy:y.name}}},{default:s(()=>[n(d(y.name),1)]),_:2},1032,["to"])])}),128))])):(e(),a(r,{key:1},[n(d(L(v)("common.collection.none")),1)],64))]),config:s(({row:l})=>[Object.keys(l.raw).length>0?(e(),c(w,{key:0,code:L(q).stringify(l.raw),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),a(r,{key:1},[n(d(L(v)("common.collection.none")),1)],64))]),_:2},1032,["class","items","headers"])]))),128))]),_:2},1024))),128))],64))),128))]),_:1})}}}),D=G(he,[["__scopeId","data-v-83106823"]]),be={class:"stack"},ve={class:"mb-2"},$e={key:0},Xe=I({__name:"DataPlanePoliciesView",props:{data:{}},setup(R){const v=R;return(P,t)=>{const X=k("RouteTitle"),w=k("XCard"),i=k("DataCollection"),m=k("DataLoader"),p=k("DataSource"),h=k("RouterView"),l=k("AppView"),y=k("RouteView");return e(),c(y,{name:"data-plane-policies-view",params:{mesh:"",proxy:""}},{default:s(({uri:$,can:V,route:C,t:x})=>[o(X,{render:!1,title:x("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"]),t[8]||(t[8]=n()),o(l,null,{default:s(()=>[u("div",be,[o(p,{src:$(L(W),"/policy-types",{})},{default:s(({data:A,error:S})=>[(e(!0),a(r,null,f([((A==null?void 0:A.policyTypes)??[]).reduce((B,b)=>Object.assign(B,{[b.name]:b}),{})],B=>(e(),a(r,{key:typeof B},[o(m,{src:$(L(Z),"/meshes/:mesh/rules/for/:dataplane",{mesh:C.params.mesh,dataplane:C.params.proxy}),data:[A],errors:[S]},{default:s(({data:b})=>[o(i,{items:b.rules},{default:s(()=>[(e(),a(r,null,f(["proxy","to"],g=>o(i,{key:g,items:b.rules,predicate:_=>_.ruleType===g,comparator:(_,O)=>_.type.localeCompare(O.type),empty:!1},{default:s(({items:_})=>[o(w,null,{default:s(()=>[u("h3",null,d(x(`data-planes.routes.item.rules.${g}`)),1),t[0]||(t[0]=n()),o(D,{class:"mt-2",rules:_,types:B,"data-testid":`${g}-rule-list`},null,8,["rules","types","data-testid"])]),_:2},1024)]),_:2},1032,["items","predicate","comparator"])),64)),t[3]||(t[3]=n()),o(i,{items:b.rules,predicate:g=>g.ruleType==="from",comparator:(g,_)=>g.type.localeCompare(_.type),empty:!1},{default:s(({items:g})=>[o(w,null,{default:s(()=>[u("h3",ve,d(x("data-planes.routes.item.rules.from")),1),t[2]||(t[2]=n()),(e(!0),a(r,null,f([Object.groupBy(g,_=>_.inbound.port)],_=>(e(),a(r,{key:_},[(e(!0),a(r,null,f(Object.entries(_).sort(([O],[T])=>Number(T)-Number(O)),([O,T],K)=>(e(),a("div",{key:K},[u("h4",null,d(x("data-planes.routes.item.port",{port:O})),1),t[1]||(t[1]=n()),o(D,{class:"mt-2",rules:T,types:B,"data-testid":`from-rule-list-${K}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2},1024)]),_:2},1032,["items","predicate","comparator"])]),_:2},1032,["items"])]),_:2},1032,["src","data","errors"]),t[6]||(t[6]=n()),V("use zones")?N("",!0):(e(),a("div",$e,[v.data.dataplaneType==="builtin"?(e(),c(m,{key:0,src:`/meshes/${C.params.mesh}/dataplanes/${C.params.proxy}/gateway-dataplane-policies`,data:[A],errors:[S]},{default:s(({data:b})=>[b?(e(),c(i,{key:0,items:b.routePolicies,empty:!1},{default:s(()=>[u("h3",null,d(x("data-planes.routes.item.legacy_policies")),1),t[4]||(t[4]=n()),o(w,{class:"mt-4"},{default:s(()=>[o(pe,{types:B,"gateway-dataplane":b,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["types","gateway-dataplane"])]),_:2},1024)]),_:2},1032,["items"])):N("",!0)]),_:2},1032,["src","data","errors"])):(e(),c(m,{key:1,src:`/meshes/${C.params.mesh}/dataplanes/${C.params.proxy}/sidecar-dataplane-policies`,data:[A],errors:[S]},{default:s(({data:b})=>[o(i,{predicate:g=>{var _;return((_=B[g.type])==null?void 0:_.policy.isTargetRef)===!1},items:b.policyTypeEntries,empty:!1},{default:s(({items:g})=>[u("h3",null,d(x("data-planes.routes.item.legacy_policies")),1),t[5]||(t[5]=n()),o(w,{class:"mt-4"},{default:s(()=>[o(ye,{items:g,types:B,"data-testid":"sidecar-dataplane-policies"},null,8,["items","types"])]),_:2},1024)]),_:2},1032,["predicate","items"])]),_:2},1032,["src","data","errors"]))]))],64))),128))]),_:2},1032,["src"])]),t[7]||(t[7]=n()),o(h,null,{default:s(({Component:A})=>[C.child()?(e(),c(ee,{key:0,onClose:S=>C.replace({name:"data-plane-policies-view",params:{mesh:C.params.mesh,proxy:C.params.proxy}})},{default:s(()=>[(e(),c(E(A)))]),_:2},1032,["onClose"])):N("",!0)]),_:2},1024)]),_:2},1024)]),_:1})}}});export{Xe as default};
