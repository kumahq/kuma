import{d as re,Q as le,r as c,p as f,o as d,w as e,b as a,m as V,T as ue,c as u,e as n,L as m,J as _,q as h,M as w,S as me,l as D,t as r,K as U,y as ye,B as ce,_ as fe}from"./index-Bcju0_hO.js";import{S as be}from"./SummaryView-DXx4WhyD.js";import{T as ge}from"./TagList-drtbP2Sv.js";import{C as W,a as A,b as R}from"./ConnectionTraffic-P7mwdL6b.js";const ke={key:0,"data-testid":"dataplane-subscriptions"},ve=re({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(Y){const N=le(),s=Y;return(_e,t)=>{const X=c("XI18n"),E=c("XNotification"),T=c("XIcon"),S=c("DataCollection"),b=c("XLayout"),$=c("XAction"),C=c("XBadge"),Z=c("XCopyButton"),ee=c("XAboutCard"),q=c("XEmptyState"),te=c("XInputSwitch"),ae=c("XProgress"),O=c("XCard"),ne=c("RouterView"),oe=c("AppView"),se=c("DataSource"),ie=c("RouteView");return d(),f(ie,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:e(({route:g,t:l,can:B,me:z,uri:de})=>[a(se,{src:de(V(ue),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[g.params.proxyType]??"dataplane",name:g.params.proxy,mesh:g.params.mesh||"*",socketAddress:s.data.dataplane.networking.inboundAddress})},{default:e(({data:k,error:x,refresh:pe})=>[a(oe,{notifications:!0},{default:e(()=>{var P,j,L,M,F,G,J,K,Q,H;return[(d(!0),u(m,null,_([{bool:((j=(P=s.data.dataplaneInsight.version)==null?void 0:P.kumaDp)==null?void 0:j.kumaCpCompatible)===!1,key:"dp-cp-incompatible",params:{kumaDp:((L=s.data.dataplaneInsight.version)==null?void 0:L.kumaDp.version)??""}},{bool:((F=(M=s.data.dataplaneInsight.version)==null?void 0:M.envoy)==null?void 0:F.kumaDpCompatible)===!1,key:"envoy-dp-incompatible",params:{envoy:((G=s.data.dataplaneInsight.version)==null?void 0:G.envoy.version)??"",kumaDp:((J=s.data.dataplaneInsight.version)==null?void 0:J.kumaDp.version)??""}},{bool:!!(B("use zones")&&s.data.zone&&((Q=(K=s.data.dataplaneInsight.version)==null?void 0:K.kumaDp)==null?void 0:Q.kumaCpCompatible)===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:((H=s.data.dataplaneInsight.version)==null?void 0:H.kumaDp.version)??""}},{bool:s.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:s.data.isCertExpired,key:"certificate-expired"},{bool:!s.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!!x,key:"stats-not-enhanced",params:{error:(x==null?void 0:x.toString())??""}}],({bool:o,key:i,params:p})=>(d(),f(E,{key:i,notify:o,"data-testid":`warning-${i}`,uri:`data-planes.notifications.${i}.${s.data.id}`},{default:e(()=>[a(X,{path:`data-planes.notifications.${i}`,params:Object.fromEntries(Object.entries(p??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri"]))),128)),t[48]||(t[48]=n()),a(b,{type:"stack","data-testid":"dataplane-details"},{default:e(()=>[a(ee,{title:l("data-planes.routes.item.about.title"),created:s.data.creationTime,modified:s.data.modificationTime,class:"about-section"},{default:e(()=>[a(b,null,{default:e(()=>[a(b,{type:"separated"},{default:e(()=>[a(w,{layout:"horizontal"},{title:e(()=>[n(r(l("http.api.property.status")),1)]),body:e(()=>[a(b,{type:"separated"},{default:e(()=>[a(me,{status:s.data.status},null,8,["status"]),t[0]||(t[0]=n()),s.data.dataplaneType==="standard"?(d(),f(S,{key:0,items:s.data.dataplane.networking.inbounds,predicate:o=>o.state!=="Ready",empty:!1},{default:e(({items:o})=>[a(T,{name:"info"},{default:e(()=>[D("ul",null,[(d(!0),u(m,null,_(o,i=>(d(),u("li",{key:`${i.service}:${i.port}`},r(l("data-planes.routes.item.unhealthy_inbound",{service:i.service,port:i.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):h("",!0)]),_:2},1024)]),_:2},1024),t[7]||(t[7]=n()),B("use zones")&&s.data.zone?(d(),f(w,{key:0,layout:"horizontal"},{title:e(()=>[n(r(l("http.api.property.zone")),1)]),body:e(()=>[a(C,{appearance:"decorative"},{default:e(()=>[a($,{to:{name:"zone-cp-detail-view",params:{zone:s.data.zone}}},{default:e(()=>[n(r(s.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2},1024)):h("",!0),t[8]||(t[8]=n()),a(w,{layout:"horizontal"},{title:e(()=>[n(r(l("http.api.proptery.type")),1)]),body:e(()=>[a(C,{appearance:"decorative"},{default:e(()=>[n(r(l(`data-planes.type.${s.data.dataplaneType}`)),1)]),_:2},1024)]),_:2},1024),t[9]||(t[9]=n()),s.data.namespace.length>0?(d(),f(w,{key:1,layout:"horizontal"},{title:e(()=>[n(r(l("http.api.property.namespace")),1)]),body:e(()=>[a(C,{appearance:"decorative"},{default:e(()=>[n(r(s.data.namespace),1)]),_:1})]),_:2},1024)):h("",!0),t[10]||(t[10]=n()),a(w,{layout:"horizontal"},{title:e(()=>[n(r(l("http.api.property.address")),1)]),body:e(()=>[a(Z,{variant:"badge",format:"default",text:`${s.data.dataplane.networking.address}`},null,8,["text"])]),_:2},1024),t[11]||(t[11]=n()),s.data.dataplane.networking.gateway?(d(),f(w,{key:2,layout:"horizontal"},{title:e(()=>[n(r(l("http.api.property.tags")),1)]),body:e(()=>[a(ge,{tags:s.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2},1024)):h("",!0)]),_:2},1024),t[22]||(t[22]=n()),s.data.dataplaneInsight.mTLS?(d(),f(b,{key:0,"data-testid":"dataplane-mtls",class:"dataplane-mtls",size:"small"},{default:e(()=>[D("h3",null,r(l("data-planes.routes.item.mtls.title")),1),t[21]||(t[21]=n()),a(b,{size:"small"},{default:e(()=>[(d(!0),u(m,null,_([s.data.dataplaneInsight.mTLS],o=>(d(),u(m,{key:o},[a(b,{type:"separated"},{default:e(()=>[a(w,{layout:"horizontal"},{title:e(()=>[a(X,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:e(()=>[a(C,{appearance:"neutral"},{default:e(()=>[n(r(l("common.formats.datetime",{value:Date.parse(o.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2},1024),t[14]||(t[14]=n()),a(w,{layout:"horizontal"},{title:e(()=>[a(X,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:e(()=>[a(C,{appearance:"neutral"},{default:e(()=>[n(r(l("common.formats.datetime",{value:Date.parse(o.certificateExpirationTime)})),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t[20]||(t[20]=n()),a(b,{type:"separated"},{default:e(()=>[a(w,{layout:"horizontal"},{title:e(()=>[n(r(l("data-planes.routes.item.mtls.regenerations.title")),1)]),body:e(()=>[a(C,{appearance:"info"},{default:e(()=>[n(r(l("common.formats.integer",{value:o.certificateRegenerations})),1)]),_:2},1024)]),_:2},1024),t[18]||(t[18]=n()),a(w,{layout:"horizontal"},{title:e(()=>[n(r(l("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:e(()=>[a(C,{appearance:"decorative"},{default:e(()=>[n(r(o.issuedBackend),1)]),_:2},1024)]),_:2},1024),t[19]||(t[19]=n()),a(w,{layout:"horizontal"},{title:e(()=>[n(r(l("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:e(()=>[a(b,{type:"separated",truncate:""},{default:e(()=>[(d(!0),u(m,null,_(o.supportedBackends,i=>(d(),f(C,{key:i,appearance:i===o.issuedBackend?"decorative":"info"},{default:e(()=>[n(r(i),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)],64))),128))]),_:2},1024)]),_:2},1024)):h("",!0)]),_:2},1024)]),_:2},1032,["title","created","modified"]),t[45]||(t[45]=n()),a(O,{class:"traffic","data-testid":"dataplane-traffic"},{default:e(()=>[a(b,{type:"columns"},{default:e(()=>[a(W,null,{title:e(()=>[a(b,{type:"separated"},{default:e(()=>[a(T,{name:"inbound"}),t[23]||(t[23]=n()),t[24]||(t[24]=D("span",null,"Inbounds",-1))]),_:1})]),default:e(()=>[t[26]||(t[26]=n()),(d(!0),u(m,null,_([s.data.dataplane.networking.type==="gateway"?Object.entries((k==null?void 0:k.inbounds)??{}).reduce((o,[i,p])=>{var v;const y=i.split("_").at(-1);return y===(((v=s.data.dataplane.networking.admin)==null?void 0:v.port)??"9901")?o:o.concat([{...s.data.dataplane.networking.inbounds[0],name:i,port:Number(y),protocol:["http","tcp"].find(I=>typeof p[I]<"u")??"tcp",addressPort:`${s.data.dataplane.networking.inbounds[0].address}:${y}`}])},[]):s.data.dataplane.networking.inbounds],o=>(d(),f(A,{key:o,type:"inbound","data-testid":"dataplane-inbounds"},{default:e(()=>[a(S,{type:"inbounds",items:o,predicate:i=>i.port!==49151},U({default:e(({items:i})=>[a(b,{type:"stack",size:"small"},{default:e(()=>[(d(!0),u(m,null,_(i,p=>(d(),u(m,{key:`${p.name}`},[(d(!0),u(m,null,_([k==null?void 0:k.inbounds[p.name]],y=>(d(),f(R,{key:y,"data-testid":"dataplane-inbound",protocol:p.protocol,service:B("use service-insights",s.mesh)?p.tags["kuma.io/service"]:"","port-name":p.portName,traffic:typeof x>"u"?y:{name:"",protocol:p.protocol,port:`${p.port}`}},{default:e(()=>[a($,{"data-action":"",to:{name:(v=>v.includes("bound")?v.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(V(N).name)),params:{connection:p.name},query:{inactive:g.params.inactive}}},{default:e(()=>[n(r(p.name.replace("localhost","").replace("_",":")),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","service","port-name","traffic"]))),128))],64))),128))]),_:2},1024)]),_:2},[s.data.dataplaneType==="delegated"?{name:"empty",fn:e(()=>[a(q,null,{default:e(()=>[D("p",null,`
                            This proxy is a delegated gateway therefore `+r(l("common.product.name"))+` does not have any
                            visibility into inbounds for this gateway.
                          `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2},1024),t[37]||(t[37]=n()),a(W,null,U({title:e(()=>[a(b,{type:"separated"},{default:e(()=>[a(T,{name:"outbound"}),t[30]||(t[30]=n()),t[31]||(t[31]=D("span",null,"Outbounds",-1))]),_:1})]),default:e(()=>[t[35]||(t[35]=n()),t[36]||(t[36]=n()),typeof x>"u"?(d(),u(m,{key:0},[typeof k>"u"?(d(),f(ae,{key:0})):(d(),u(m,{key:1},[a(A,{type:"passthrough"},{default:e(()=>[a(R,{protocol:"passthrough",traffic:k.passthrough},{default:e(()=>t[32]||(t[32]=[n(`
                        Non mesh traffic
                      `)])),_:2},1032,["traffic"])]),_:2},1024),t[34]||(t[34]=n()),(d(),u(m,null,_(["upstream"],o=>(d(),u(m,{key:o},[a(E,{notify:!!Object.values(k.outbounds).find(i=>{var p,y;return(typeof i.tcp<"u"?(p=i.tcp)==null?void 0:p[`${o}_cx_rx_bytes_total`]:(y=i.http)==null?void 0:y[`${o}_rq_total`])??!1}),variant:"info",uri:`data-planes.notifications.recommend-reachable-services:${s.data.id}`},{default:e(()=>[a(X,{path:"data-planes.notifications.recommend-reachable",params:{mode:s.mesh.meshServices.mode}},null,8,["params"])]),_:2},1032,["notify","uri"]),t[33]||(t[33]=n()),a(S,{type:"outbounds",predicate:g.params.inactive?void 0:([i,p])=>{var y,v;return((typeof p.tcp<"u"?(y=p.tcp)==null?void 0:y[`${o}_cx_rx_bytes_total`]:(v=p.http)==null?void 0:v[`${o}_rq_total`])??0)>0},items:Object.entries(k.outbounds)},{default:e(({items:i})=>[i.length>0?(d(),f(A,{key:0,type:"outbound","data-testid":"dataplane-outbounds"},{default:e(()=>[(d(),u(m,null,_([/-([a-f0-9]){16}$/],p=>a(b,{key:p,type:"stack",size:"small"},{default:e(()=>[(d(!0),u(m,null,_(i,([y,v])=>(d(),f(R,{key:`${y}`,"data-testid":"dataplane-outbound",protocol:["grpc","http","tcp"].find(I=>typeof v[I]<"u")??"tcp",traffic:v,service:v.$resourceMeta.type===""?y.replace(p,""):void 0,direction:o},{default:e(()=>[a($,{"data-action":"",to:{name:(I=>I.includes("bound")?I.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(V(N).name)),params:{connection:y},query:{inactive:g.params.inactive}}},{default:e(()=>[n(r(y),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","traffic","service","direction"]))),128))]),_:2},1024)),64))]),_:2},1024)):h("",!0)]),_:2},1032,["predicate","items"])],64))),64))],64))],64)):(d(),f(q,{key:1}))]),_:2},[k?{name:"actions",fn:e(()=>[a(te,{checked:g.params.inactive,"data-testid":"dataplane-outbounds-inactive-toggle",onChange:o=>g.update({inactive:o})},{label:e(()=>t[27]||(t[27]=[n(`
                      Show inactive
                    `)])),_:2},1032,["checked","onChange"]),t[29]||(t[29]=n()),a($,{action:"refresh",appearance:"primary",onClick:pe},{default:e(()=>t[28]||(t[28]=[n(`
                    Refresh
                  `)])),_:2},1032,["onClick"])]),key:"0"}:void 0]),1024)]),_:2},1024)]),_:2},1024),t[46]||(t[46]=n()),a(ne,null,{default:e(o=>[o.route.name!==g.name?(d(),f(be,{key:0,width:"670px",onClose:function(){g.replace({name:"data-plane-detail-view",params:{mesh:g.params.mesh,proxy:g.params.proxy},query:{inactive:g.params.inactive?null:void 0}})}},{default:e(()=>[(d(),f(ye(o.Component),{data:g.params.subscription.length>0?s.data.dataplaneInsight.subscriptions:o.route.name.includes("-inbound-")?s.data.dataplane.networking.inbounds:(k==null?void 0:k.outbounds)||{},networking:s.data.dataplane.networking},null,8,["data","networking"]))]),_:2},1032,["onClose"])):h("",!0)]),_:2},1024),t[47]||(t[47]=n()),s.data.dataplaneInsight.subscriptions.length>0?(d(),u("div",ke,[a(O,null,{title:e(()=>[D("h2",null,r(l("data-planes.routes.item.subscriptions.title")),1)]),default:e(()=>[t[44]||(t[44]=n()),a(b,null,{default:e(()=>[a(X,{path:"data-planes.routes.item.subscriptions.description"}),t[43]||(t[43]=n()),a(ce,{headers:[{...z.get("headers.connection"),label:" ",key:"connection"},{...z.get("headers.instanceId"),label:l("http.api.property.instanceId"),key:"instanceId"},{...z.get("headers.version"),label:l("http.api.property.version"),key:"version"},{...z.get("headers.connected"),label:l("http.api.property.connected"),key:"connected"},{...z.get("headers.disconnected"),label:l("http.api.property.disconnected"),key:"disconnected"},{...z.get("headers.responses"),label:l("http.api.property.responses"),key:"responses"}],"is-selected-row":o=>o.id===g.params.subscription,items:s.data.dataplaneInsight.subscriptions.map((o,i,p)=>p[p.length-(i+1)]),onResize:z.set},{connection:e(({row:o})=>[(d(!0),u(m,null,_([o.connectTime&&!o.disconnectTime?"healthy":"unhealthy"],i=>(d(),f(T,{key:`${i}`,name:i},{default:e(()=>[n(r(l(`common.connection.${i}`)),1)]),_:2},1032,["name"]))),128))]),instanceId:e(({row:o})=>[a($,{"data-action":"",to:{name:"data-plane-subscription-summary-view",params:{subscription:o.id}}},{default:e(()=>[n(r(o.controlPlaneInstanceId),1)]),_:2},1032,["to"])]),version:e(({row:o})=>{var i,p;return[n(r(((p=(i=o.version)==null?void 0:i.kumaDp)==null?void 0:p.version)??"-"),1)]}),connected:e(({row:o})=>[n(r(l("common.formats.datetime",{value:Date.parse(o.connectTime??"")})),1)]),disconnected:e(({row:o})=>[o.disconnectTime?(d(),u(m,{key:0},[n(r(l("common.formats.datetime",{value:Date.parse(o.disconnectTime)})),1)],64)):h("",!0)]),responses:e(({row:o})=>{var i;return[(d(!0),u(m,null,_([((i=o.status)==null?void 0:i.total)??{}],p=>(d(),u(m,null,[n(r(p.responsesSent)+"/"+r(p.responsesAcknowledged),1)],64))),256))]}),_:2},1032,["headers","is-selected-row","items","onResize"])]),_:2},1024)]),_:2},1024)])):h("",!0)]),_:2},1024)]}),_:2},1024)]),_:2},1032,["src"])]),_:1})}}}),xe=fe(ve,[["__scopeId","data-v-0c148c78"]]);export{xe as default};
