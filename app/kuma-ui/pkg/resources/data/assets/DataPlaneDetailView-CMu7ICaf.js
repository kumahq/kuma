import{d as ut,a7 as mt,a6 as yt,r as _,p as m,o as s,w as t,b as e,m as C,F as W,aq as _t,a8 as ft,c,e as n,N as b,L as w,q as z,O as v,T as ct,l as I,t as p,M as bt,y as vt,_ as gt}from"./index-BGEPHMsE.js";import{S as kt}from"./SummaryView-CPf9Hsni.js";import{T as xt}from"./TagList-CeVkWZ_E.js";import{C as Y,a as V,b as $}from"./ConnectionTraffic-UTSJqaoY.js";import{C as Z}from"./kri-D19gROKk.js";const wt=ut({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(P){const A=mt(),o=P;return yt("data-plane-overview",o.data),(Ct,a)=>{const D=_("XI18n"),L=_("XNotification"),R=_("XIcon"),S=_("DataCollection"),u=_("XLayout"),X=_("XAction"),g=_("XBadge"),tt=_("XCopyButton"),et=_("XAboutCard"),E=_("XEmptyState"),at=_("XCard"),nt=_("RouterView"),ot=_("AppView"),st=_("DataLoader"),T=_("DataSource"),rt=_("RouteView");return s(),m(rt,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:t(({route:l,t:d,can:B,uri:N})=>[e(T,{src:N(C(W),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:l.params.mesh,name:l.params.proxy})},{default:t(({data:k})=>[e(T,{src:N(C(_t),"/meshes/:mesh/dataplanes/:name/layout",{mesh:l.params.mesh,name:l.params.proxy})},{default:t(({data:y,refresh:it,error:pt})=>[e(T,{src:N(C(W),"/policy-types",{})},{default:t(({data:q})=>[e(T,{src:N(C(ft),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[l.params.proxyType]??"dataplane",name:l.params.proxy,mesh:l.params.mesh||"*",socketAddress:"self_inbound"})},{default:t(({data:x,error:dt,refresh:lt})=>[e(st,{data:[y,k,q,x]},{default:t(()=>[e(ot,{notifications:!0},{default:t(()=>{var O,j,F,G,K,M,H,J,Q,U;return[(s(!0),c(b,null,w([{bool:((j=(O=o.data.dataplaneInsight.version)==null?void 0:O.kumaDp)==null?void 0:j.kumaCpCompatible)===!1,key:"dp-cp-incompatible",params:{kumaDp:((F=o.data.dataplaneInsight.version)==null?void 0:F.kumaDp.version)??""}},{bool:((K=(G=o.data.dataplaneInsight.version)==null?void 0:G.envoy)==null?void 0:K.kumaDpCompatible)===!1,key:"envoy-dp-incompatible",params:{envoy:((M=o.data.dataplaneInsight.version)==null?void 0:M.envoy.version)??"",kumaDp:((H=o.data.dataplaneInsight.version)==null?void 0:H.kumaDp.version)??""}},{bool:!!(B("use zones")&&o.data.zone&&((Q=(J=o.data.dataplaneInsight.version)==null?void 0:J.kumaDp)==null?void 0:Q.kumaCpCompatible)===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:((U=o.data.dataplaneInsight.version)==null?void 0:U.kumaDp.version)??""}},{bool:o.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:o.data.isCertExpired,key:"certificate-expired"},{bool:!o.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!B("use transparent-proxying",o.data),key:"networking-transparent-proxying",variant:"info"}],({bool:i,key:r,params:f,variant:h})=>(s(),m(L,{key:r,notify:i,"data-testid":`warning-${r}`,uri:`data-planes.notifications.${r}.${o.data.id}`,variant:h},{default:t(()=>[e(D,{path:`data-planes.notifications.${r}`,params:Object.fromEntries(Object.entries(f??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),a[47]||(a[47]=n()),e(u,{type:"stack","data-testid":"dataplane-details"},{default:t(()=>[e(et,{title:d("data-planes.routes.item.about.title"),created:o.data.creationTime,modified:o.data.modificationTime,class:"about-section"},{default:t(()=>[e(u,null,{default:t(()=>[e(u,{type:"separated"},{default:t(()=>[e(v,{layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.status")),1)]),body:t(()=>[e(u,{type:"separated"},{default:t(()=>[e(ct,{status:o.data.status},null,8,["status"]),a[0]||(a[0]=n()),o.data.dataplaneType==="standard"?(s(),m(S,{key:0,items:o.data.dataplane.networking.inbounds,predicate:i=>i.state!=="Ready",empty:!1},{default:t(({items:i})=>[e(R,{name:"info"},{default:t(()=>[I("ul",null,[(s(!0),c(b,null,w(i,r=>(s(),c("li",{key:`${r.service}:${r.port}`},p(d("data-planes.routes.item.unhealthy_inbound",{service:r.service,port:r.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):z("",!0)]),_:2,__:[0]},1024)]),_:2,__:[1]},1024),a[7]||(a[7]=n()),B("use zones")&&o.data.zone?(s(),m(v,{key:0,layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.zone")),1)]),body:t(()=>[e(g,{appearance:"decorative"},{default:t(()=>[e(X,{to:{name:"zone-cp-detail-view",params:{zone:o.data.zone}}},{default:t(()=>[n(p(o.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2,__:[2]},1024)):z("",!0),a[8]||(a[8]=n()),e(v,{layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.type")),1)]),body:t(()=>[e(g,{appearance:"decorative"},{default:t(()=>[n(p(d(`data-planes.type.${o.data.dataplaneType}`)),1)]),_:2},1024)]),_:2,__:[3]},1024),a[9]||(a[9]=n()),o.data.namespace.length>0?(s(),m(v,{key:1,layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.namespace")),1)]),body:t(()=>[e(g,{appearance:"decorative"},{default:t(()=>[n(p(o.data.namespace),1)]),_:1})]),_:2,__:[4]},1024)):z("",!0),a[10]||(a[10]=n()),e(v,{layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.address")),1)]),body:t(()=>[e(tt,{variant:"badge",format:"default",text:`${o.data.dataplane.networking.address}`},null,8,["text"])]),_:2,__:[5]},1024),a[11]||(a[11]=n()),o.data.dataplane.networking.gateway?(s(),m(v,{key:2,layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.tags")),1)]),body:t(()=>[e(xt,{tags:o.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2,__:[6]},1024)):z("",!0)]),_:2,__:[7,8,9,10,11]},1024),a[30]||(a[30]=n()),o.data.dataplaneInsight.mTLS?(s(),m(u,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:t(()=>[I("h3",null,p(d("data-planes.routes.item.mtls.title")),1),a[21]||(a[21]=n()),e(u,{size:"small"},{default:t(()=>[(s(!0),c(b,null,w([o.data.dataplaneInsight.mTLS],i=>(s(),c(b,{key:i},[e(u,{type:"separated"},{default:t(()=>[e(v,{layout:"horizontal"},{title:t(()=>[e(D,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:t(()=>[e(g,{appearance:"neutral"},{default:t(()=>[n(p(d("common.formats.datetime",{value:Date.parse(i.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2,__:[12]},1024),a[14]||(a[14]=n()),e(v,{layout:"horizontal"},{title:t(()=>[e(D,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:t(()=>[e(g,{appearance:"neutral"},{default:t(()=>[n(p(d("common.formats.datetime",{value:Date.parse(i.certificateExpirationTime)})),1)]),_:2},1024)]),_:2,__:[13]},1024)]),_:2,__:[14]},1024),a[20]||(a[20]=n()),e(u,{type:"separated"},{default:t(()=>[e(v,{layout:"horizontal"},{title:t(()=>[n(p(d("data-planes.routes.item.mtls.regenerations.title")),1)]),body:t(()=>[e(g,{appearance:"info"},{default:t(()=>[n(p(d("common.formats.integer",{value:i.certificateRegenerations})),1)]),_:2},1024)]),_:2,__:[15]},1024),a[18]||(a[18]=n()),e(v,{layout:"horizontal"},{title:t(()=>[n(p(d("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:t(()=>[e(g,{appearance:"decorative"},{default:t(()=>[n(p(i.issuedBackend),1)]),_:2},1024)]),_:2,__:[16]},1024),a[19]||(a[19]=n()),e(v,{layout:"horizontal"},{title:t(()=>[n(p(d("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:t(()=>[e(u,{type:"separated",truncate:""},{default:t(()=>[(s(!0),c(b,null,w(i.supportedBackends,r=>(s(),m(g,{key:r,appearance:r===i.issuedBackend?"decorative":"info"},{default:t(()=>[n(p(r),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2,__:[17]},1024)]),_:2,__:[18,19]},1024)],64))),128))]),_:2},1024)]),_:2,__:[21]},1024)):z("",!0),a[31]||(a[31]=n()),o.data.dataplaneInsight.subscriptions.length>0?(s(),m(u,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:t(()=>[e(u,{type:"separated"},{default:t(()=>[I("h3",null,p(d("data-planes.routes.item.subscriptions.title")),1),a[22]||(a[22]=n()),e(X,{"data-action":"",appearance:"anchor",to:{name:"data-plane-subscriptions-summary-view",params:{mesh:l.params.mesh,proxy:l.params.proxy},query:{inactive:l.params.inactive}}},{default:t(()=>[n(`
                            (`+p(d("data-planes.routes.item.xds.show-details"))+`)
                          `,1)]),_:2},1032,["to"])]),_:2,__:[22]},1024),a[28]||(a[28]=n()),(s(!0),c(b,null,w([[...o.data.dataplaneInsight.subscriptions].reverse()],i=>(s(),m(u,{key:typeof i,type:"separated"},{default:t(()=>[(s(!0),c(b,null,w([i.find(r=>!r.disconnectTime)??i[0]],r=>(s(),c(b,{key:r.id},[!r.disconnectTime&&r.connectTime?(s(),c(b,{key:0},[e(v,{layout:"horizontal"},{title:t(()=>[e(D,{path:"data-planes.routes.item.xds.connected"})]),body:t(()=>[e(g,{appearance:"neutral"},{default:t(()=>[n(p(d("common.formats.datetime",{value:Date.parse(r.connectTime)})),1)]),_:2},1024)]),_:2,__:[23]},1024),a[26]||(a[26]=n()),e(v,{layout:"horizontal"},{title:t(()=>[e(D,{path:"data-planes.routes.item.xds.instance"})]),body:t(()=>[e(g,{appearance:"info"},{default:t(()=>[n(p(r.controlPlaneInstanceId),1)]),_:2},1024)]),_:2,__:[24]},1024),a[27]||(a[27]=n()),e(v,{layout:"horizontal"},{title:t(()=>[e(D,{path:"data-planes.routes.item.xds.version"})]),body:t(()=>[e(g,{appearance:"info"},{default:t(()=>{var f,h;return[n(p(((h=(f=r.version)==null?void 0:f.kumaDp)==null?void 0:h.version)??d("common.unknown")),1)]}),_:2},1024)]),_:2,__:[25]},1024)],64)):(s(),m(D,{key:1,path:"data-planes.routes.item.xds.disconnected"}))],64))),128))]),_:2},1024))),128))]),_:2,__:[28]},1024)):z("",!0),a[32]||(a[32]=n()),k!=null&&k.policies.length?(s(),m(u,{key:2,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:t(()=>[I("h3",null,p(d("data-planes.routes.item.policies")),1),a[29]||(a[29]=n()),e(u,{type:"separated"},{default:t(()=>[(s(!0),c(b,null,w(k==null?void 0:k.policies,i=>(s(),m(X,{key:i.kind,"data-action":"",appearance:"anchor",to:{name:"data-plane-policy-config-summary-view",params:{mesh:l.params.mesh,proxy:l.params.proxy,policy:i.kind.toLowerCase()}}},{default:t(()=>[e(g,null,{default:t(()=>[n(p(i.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2,__:[29]},1024)):z("",!0)]),_:2,__:[30,31,32]},1024)]),_:2},1032,["title","created","modified"]),a[45]||(a[45]=n()),e(at,{class:"traffic","data-testid":"dataplane-traffic"},{default:t(()=>[e(u,{type:"columns"},{default:t(()=>[e(Y,null,{title:t(()=>[e(u,{type:"separated"},{default:t(()=>[e(R,{name:"inbound"}),a[33]||(a[33]=n()),a[34]||(a[34]=I("span",null,"Inbounds",-1))]),_:1,__:[33,34]})]),default:t(()=>[a[36]||(a[36]=n()),(s(!0),c(b,null,w([(y==null?void 0:y.inbounds)??[]],i=>(s(),m(V,{key:typeof i,type:"inbound","data-testid":"dataplane-inbounds"},{default:t(()=>[e(S,{type:"inbounds",items:i,predicate:r=>r.port!==49151},bt({default:t(({items:r})=>[e(u,{type:"stack",size:"small"},{default:t(()=>[(s(!0),c(b,null,w(r,f=>(s(),m($,{key:`${f.kri}`,"data-testid":"dataplane-inbound",protocol:f.protocol,"port-name":f.port.toString(),traffic:x==null?void 0:x.inbounds[C(Z).toString({...C(Z).fromString(f.proxyResourceName),sectionName:f.port.toString()})]},{default:t(()=>[e(X,{"data-action":"",to:{name:(h=>h.includes("bound")?h.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(C(A).name)),params:{connection:f.proxyResourceName},query:{inactive:l.params.inactive}}},{default:t(()=>[n(p(f.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},[o.data.dataplaneType==="delegated"?{name:"empty",fn:t(()=>[e(E,null,{default:t(()=>[I("p",null,`
                                    This proxy is a delegated gateway therefore `+p(d("common.product.name"))+` does not have any
                                    visibility into inbounds for this gateway.
                                  `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2,__:[36]},1024),a[44]||(a[44]=n()),e(Y,null,{actions:t(()=>[e(X,{action:"refresh",appearance:"primary",onClick:()=>{it(),lt()}},{default:t(()=>a[37]||(a[37]=[n(`
                            Refresh
                          `,-1)])),_:2,__:[37]},1032,["onClick"])]),title:t(()=>[e(u,{type:"separated"},{default:t(()=>[e(R,{name:"outbound"}),a[38]||(a[38]=n()),a[39]||(a[39]=I("span",null,"Outbounds",-1))]),_:1,__:[38,39]})]),default:t(()=>[a[42]||(a[42]=n()),a[43]||(a[43]=n()),typeof pt>"u"&&typeof dt>"u"&&(y!=null&&y.outbounds.length)?(s(),c(b,{key:0},[e(V,{type:"passthrough"},{default:t(()=>[e($,{protocol:"passthrough",traffic:x==null?void 0:x.passthrough},{default:t(()=>a[40]||(a[40]=[n(`
                              Non mesh traffic
                            `,-1)])),_:2,__:[40]},1032,["traffic"])]),_:2},1024),a[41]||(a[41]=n()),e(S,{type:"outbounds",items:y==null?void 0:y.outbounds},{default:t(({items:i})=>[e(V,{type:"outbound","data-testid":"dataplane-outbounds"},{default:t(()=>[e(u,{type:"stack",size:"small"},{default:t(()=>[(s(!0),c(b,null,w(i,r=>(s(),m($,{key:r.kri,"data-testid":"dataplane-outbound",protocol:r.protocol,"port-name":r.port.toString(),traffic:x==null?void 0:x.outbounds[r.proxyResourceName]},{default:t(()=>[e(X,{"data-action":"",to:{name:(f=>f.includes("bound")?f.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(C(A).name)),params:{connection:r.proxyResourceName},query:{inactive:l.params.inactive}}},{default:t(()=>[n(p(r.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])],64)):(s(),m(E,{key:1}))]),_:2,__:[42,43]},1024)]),_:2,__:[44]},1024)]),_:2},1024),a[46]||(a[46]=n()),e(nt,null,{default:t(i=>[i.route.name!==l.name?(s(),m(kt,{key:0,width:i.route.name==="data-plane-subscriptions-summary-view"?"900px":"670px",onClose:function(){l.replace({name:"data-plane-detail-view",params:{mesh:l.params.mesh,proxy:l.params.proxy},query:{inactive:l.params.inactive?null:void 0}})}},{default:t(()=>[(s(),m(vt(i.Component),{data:l.params.subscription.length>0?o.data.dataplaneInsight.subscriptions:i.route.name.includes("-inbound-")?y==null?void 0:y.inbounds:y==null?void 0:y.outbounds,"data-plane-overview":o.data,networking:o.data.dataplane.networking,subscriptions:o.data.dataplaneInsight.subscriptions,policies:(k==null?void 0:k.policies)??[],"policy-types-data":q},null,8,["data","data-plane-overview","networking","subscriptions","policies","policy-types-data"]))]),_:2},1032,["width","onClose"])):z("",!0)]),_:2},1024)]),_:2,__:[45,46]},1024)]}),_:2,__:[47]},1024)]),_:2},1032,["data"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:1})}}}),Tt=gt(wt,[["__scopeId","data-v-51f600e1"]]);export{Tt as default};
