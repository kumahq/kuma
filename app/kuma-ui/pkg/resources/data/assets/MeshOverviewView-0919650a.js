import{x as w,P as $}from"./kongponents.es-5ca9e130.js";import{d as A,c as m,v as O,o as s,j as d,g as l,b as n,h as r,u as H,r as D,E as J,G as N,x as Q,w as c,e as v,f as x,i as S,F as g,q as B,t as y}from"./index-6ef061d4.js";import{D as M}from"./DoughnutChart-a3d097eb.js";import{u as R}from"./store-444aa12f.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import{D as P,a as V}from"./DefinitionListItem-97bb646e.js";import{M as U}from"./MeshResources-34569ea0.js";import{_ as W}from"./YamlView.vue_vue_type_script_setup_true_lang-f94f7cbc.js";import{u as X}from"./index-8eaa4fe5.js";import"./ErrorBlock-5ce00c3e.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-431ef500.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-cadc6770.js";import"./toYaml-4e00099e.js";const Y={class:"chart-box-list"},Z=A({__name:"MeshCharts",setup(K){const i=R(),k=m(()=>i.getters.getChart("services",{title:"Services",showTotal:!0})),p=m(()=>i.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),f=m(()=>i.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),b=m(()=>i.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));O(()=>i.state.selectedMesh,function(){h()}),h();function h(){i.dispatch("fetchMeshInsights",i.state.selectedMesh),i.dispatch("fetchServices",i.state.selectedMesh)}return(o,I)=>(s(),d("div",Y,[l(M,{data:n(k)},null,8,["data"]),r(),l(M,{data:n(p)},null,8,["data"]),r(),l(M,{data:n(f)},null,8,["data"]),r(),l(M,{data:n(b)},null,8,["data"])]))}});const ee=F(Z,[["__scopeId","data-v-7d682009"]]),te={class:"kcard-stack"},ae={class:"columns"},se={key:0},ne=A({__name:"MeshOverviewView",setup(K){const i=X(),k=H(),p=R(),f=D(!0),b=D(!1),h=D(!1),o=D(null),I=D(null),E=m(()=>o.value!==null?J(o.value):null),j=m(()=>{if(o.value===null)return null;const{name:t,type:a,creationTime:_,modificationTime:e}=o.value;return{name:t,type:a,created:N(_),modified:N(e),"Data Plane Proxies":p.state.meshInsight.dataplanes.total}}),q=m(()=>{var T;if(o.value===null)return null;const t=C(o.value,"mtls"),a=C(o.value,"logging"),_=C(o.value,"metrics"),e=C(o.value,"tracing"),u=!!((T=o.value.routing)!=null&&T.localityAwareLoadBalancing);return{mtls:t,logging:a,metrics:_,tracing:e,localityAwareLoadBalancing:u}}),G=m(()=>p.state.sidebar.insights.mesh.policies.total),z=m(()=>p.state.policyTypes.map(t=>{var a;return{...t,length:((a=p.state.meshInsight.policies[t.name])==null?void 0:a.total)??0}}));O(()=>k.params.mesh,function(){k.name==="single-mesh-overview"&&(f.value=!0,h.value=!1,b.value=!1,L())}),L();async function L(){f.value=!0,h.value=!1;const t=k.params.mesh;try{o.value=await i.getMesh({name:t}),I.value=await i.getMeshInsights({name:t})}catch(a){b.value=!0,h.value=!0,console.error(a)}finally{f.value=!1}}function C(t,a){if(t===null||t[a]===void 0)return!1;const _=t[a].enabledBackend??t[a].defaultBackend??t[a].backends[0].name,e=t[a].backends.find(u=>u.name===_);return`${e.type} / ${e.name}`}return(t,a)=>{const _=Q("router-link");return s(),d("div",te,[l(n(w),null,{body:c(()=>[l(ee)]),_:1}),r(),o.value!==null?(s(),v(n(w),{key:0},{body:c(()=>[S("div",ae,[l(V,{"has-error":b.value,"is-loading":f.value,"is-empty":h.value},{default:c(()=>[(s(!0),d(g,null,B(n(j),(e,u)=>(s(),v(P,{key:u,term:u},{default:c(()=>[typeof e=="boolean"?(s(),v(n($),{key:0,appearance:e?"success":"danger"},{default:c(()=>[r(y(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),d(g,{key:1},[r(y(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1},8,["has-error","is-loading","is-empty"]),r(),l(V,null,{default:c(()=>[(s(!0),d(g,null,B(n(q),(e,u)=>(s(),v(P,{key:u,term:u},{default:c(()=>[typeof e=="boolean"?(s(),v(n($),{key:0,appearance:e?"success":"danger"},{default:c(()=>[r(y(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),d(g,{key:1},[r(y(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),r(),l(V,null,{default:c(()=>[l(P,{term:`Policies (${n(G)})`},{default:c(()=>[S("ul",null,[(s(!0),d(g,null,B(n(z),(e,u)=>(s(),d(g,{key:u},[e.length!==0?(s(),d("li",se,[l(_,{to:{name:"policy",params:{policyPath:e.path}}},{default:c(()=>[r(y(e.name)+": "+y(e.length),1)]),_:2},1032,["to"])])):x("",!0)],64))),128))])]),_:1},8,["term"])]),_:1})])]),_:1})):x("",!0),r(),n(E)!==null?(s(),v(n(w),{key:1},{body:c(()=>[l(W,{id:"code-block-mesh",content:n(E)},null,8,["content"])]),_:1})):x("",!0),r(),l(U)])}}});const ge=F(ne,[["__scopeId","data-v-04be51ff"]]);export{ge as default};
