import{d as L,c as h,r as W,o as s,e as F,h as l,w as r,q as N,a as i,g as t,t as p,b as u,f,G as E,B as G,F as J,s as O,W as j}from"./index-9dae1b47.js";import{m as H,g as R,D as g,S as M,R as Q,A as U,o as $,q as z,E as V,r as A,_ as X,f as Y}from"./RouteView.vue_vue_type_script_setup_true_lang-f85d915a.js";import{_ as Z}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-85a34b5c.js";import{T as D}from"./TagList-ea500918.js";import{T as ee}from"./TextWithCopyButton-976bd7f2.js";import{_ as re}from"./RouteTitle.vue_vue_type_script_setup_true_lang-cc34925e.js";import{D as te,K as se}from"./KFilterBar-99cdcd79.js";import{T as ie}from"./TabsWidget-5339c8e6.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-f9ef060f.js";import"./CopyButton-551860fe.js";import"./AppCollection-92dcf551.js";import"./dataplane-30467516.js";import"./notEmpty-7f452b20.js";const ae={class:"stack"},le={class:"variable-columns"},ne=L({__name:"ServiceSummary",props:{service:{},externalService:{default:null}},setup(k){const e=k,y=H(),{t:m}=R(),S=h(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.networking.address:e.service.addressPort??null),T=h(()=>{var v;return e.service.serviceType==="external"&&e.externalService!==null?(v=e.externalService.networking.tls)!=null&&v.enabled?"Enabled":"Disabled":null}),a=h(()=>e.service.serviceType==="external"?null:e.service.dataplanes??null),n=h(()=>e.service.serviceType==="external"?null:e.service.status??null),x=h(()=>e.service.serviceType==="external"&&e.externalService!==null?e.externalService.tags:null);async function b(v){if(e.service.serviceType==="external"&&e.externalService!==null){const{mesh:_,name:d}=e.externalService;return await y.getExternalService({mesh:_,name:d},v)}else{const{mesh:_,name:d}=e.service;return await y.getServiceInsight({mesh:_,name:d},v)}}return(v,_)=>{const d=W("RouterLink");return s(),F("div",ae,[l(u(E),null,{body:r(()=>[N("div",le,[n.value!==null?(s(),i(g,{key:0},{title:r(()=>[t(p(u(m)("http.api.property.status")),1)]),body:r(()=>[l(M,{status:n.value},null,8,["status"])]),_:1})):f("",!0),t(),l(g,null,{title:r(()=>[t(p(u(m)("http.api.property.name")),1)]),body:r(()=>[l(ee,{text:e.service.name},{default:r(()=>[l(d,{to:{name:"service-detail-view",params:{service:e.service.name,mesh:e.service.mesh}}},{default:r(()=>[t(p(e.service.name),1)]),_:1},8,["to"])]),_:1},8,["text"])]),_:1}),t(),S.value!==null?(s(),i(g,{key:1},{title:r(()=>[t(p(u(m)("http.api.property.address")),1)]),body:r(()=>[t(p(S.value),1)]),_:1})):f("",!0),t(),T.value!==null?(s(),i(g,{key:2},{title:r(()=>[t(p(u(m)("http.api.property.tls")),1)]),body:r(()=>[t(p(T.value),1)]),_:1})):f("",!0),t(),a.value!==null?(s(),i(Q,{key:3,online:a.value.online??0,total:a.value.total??0},{title:r(()=>[t(p(u(m)("http.api.property.dataPlaneProxies")),1)]),_:1},8,["online","total"])):f("",!0),t(),x.value!==null?(s(),i(g,{key:4},{title:r(()=>[t(p(u(m)("http.api.property.tags")),1)]),body:r(()=>[l(D,{tags:x.value},null,8,["tags"])]),_:1})):f("",!0)])]),_:1}),t(),l(Z,{id:"code-block-service",resource:e.service,"resource-fetcher":b,"is-searchable":"","show-copy-as-kubernetes-button":e.service.serviceType==="external"&&e.externalService!==null,"code-max-height":"250px"},null,8,["resource","show-copy-as-kubernetes-button"])])}}}),oe=L({__name:"ServiceDetailView",props:{page:{},size:{},search:{},query:{},gatewayType:{},mesh:{},service:{}},setup(k){const e=k,{t:y}=R(),m=[{hash:"#overview",title:y("services.routes.item.tabs.overview")},{hash:"#dataPlaneProxies",title:y("services.routes.item.tabs.data_plane_proxies")}];return(S,T)=>(s(),i(X,{name:"service-detail-view","data-testid":"service-detail-view"},{default:r(({route:a})=>[l(U,{breadcrumbs:[{to:{name:"services-list-view",params:{mesh:a.params.mesh}},text:u(y)("services.routes.item.breadcrumbs")}]},{title:r(()=>[N("h2",null,[l(re,{title:u(y)("services.routes.item.title",{name:a.params.service}),render:!0},null,8,["title"])])]),default:r(()=>[t(),l($,{src:`/meshes/${a.params.mesh}/service-insights/${a.params.service}`},{default:r(({data:n,isLoading:x,error:b})=>[x?(s(),i(z,{key:0})):b?(s(),i(V,{key:1,error:b},null,8,["error"])):n===void 0?(s(),i(A,{key:2})):(s(),i($,{key:3,"should-make-request":n.serviceType==="external",src:`/meshes/${a.params.mesh}/external-services/${a.params.service}`},{default:r(({data:v,isLoading:_,error:d})=>[n.serviceType==="external"&&_?(s(),i(z,{key:0})):n.serviceType==="external"&&d?(s(),i(V,{key:1,error:d},null,8,["error"])):n.serviceType==="external"&&v===void 0?(s(),i(A,{key:2})):(s(),i(ie,{key:3,tabs:m.filter(c=>c.hash==="#overview"?!0:n.serviceType!=="external")},G({overview:r(()=>[l(ne,{service:n,"external-service":v},null,8,["service","external-service"])]),_:2},[(n==null?void 0:n.serviceType)!=="external"?{name:"dataPlaneProxies",fn:r(()=>[l($,{src:`/meshes/${a.params.mesh}/dataplanes/for/${a.params.service}/of/${e.gatewayType}?page=${e.page}&size=${e.size}&search=${e.search}`},{default:r(({data:c,error:I})=>{var q,B,C,P;return[(s(!0),F(J,null,O([typeof((P=(C=(B=(q=c==null?void 0:c.items)==null?void 0:q[0])==null?void 0:B.dataplane)==null?void 0:C.networking)==null?void 0:P.gateway)>"u"],w=>(s(),i(u(E),{key:w},{body:r(()=>[l(te,{"data-testid":"data-plane-collection",class:"data-plane-collection","page-number":e.page,"page-size":e.size,total:c==null?void 0:c.total,items:c==null?void 0:c.items,error:I,gateways:w,onChange:({page:o,size:K})=>{a.update({page:String(o),size:String(K)})}},{toolbar:r(()=>[l(se,{class:"data-plane-proxy-filter",placeholder:"tag: 'kuma.io/protocol: http'",query:e.query,fields:{name:{description:"filter by name or parts of a name"},protocol:{description:"filter by “kuma.io/protocol” value"},tag:{description:"filter by tags (e.g. “tag: version:2”)"},zone:{description:"filter by “kuma.io/zone” value"}},onFieldsChange:o=>a.update({query:o.query,s:o.query.length>0?JSON.stringify(o.fields):""})},null,8,["placeholder","query","fields","onFieldsChange"]),t(),w?(s(),i(u(j),{key:0,label:"Type","overlay-label":!0,items:[{label:"All",value:"all"},{label:"Builtin",value:"builtin"},{label:"Delegated",value:"delegated"}].map(o=>({...o,selected:o.value===e.gatewayType})),appearance:"select",onSelected:o=>a.update({gatewayType:String(o.value)})},{"item-template":r(({item:o})=>[t(p(o.label),1)]),_:2},1032,["items","onSelected"])):f("",!0)]),_:2},1032,["page-number","page-size","total","items","error","gateways","onChange"])]),_:2},1024))),128))]}),_:2},1032,["src"])]),key:"0"}:void 0]),1032,["tabs"]))]),_:2},1032,["should-make-request","src"]))]),_:2},1032,["src"])]),_:2},1032,["breadcrumbs"])]),_:1}))}});const ke=Y(oe,[["__scopeId","data-v-9fd98cea"]]);export{ke as default};
