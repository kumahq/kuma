import{u as j}from"./vue-router-bad15e32.js";import{_ as I}from"./kongponents.es-3b2cea74.js";import{C as q}from"./ContentWrapper-21076344.js";import{u as N,k as E,p as z,l as T}from"./store-f75d4e4e.js";import{D as M,M as G}from"./MeshResources-b51a45a0.js";import{d as S,c as p,y as L,o as n,h as r,e as d,u as c,f as o,r as y,l as H,w as k,b as D,F as b,g as u,v as x,t as m,a as $}from"./runtime-dom.esm-bundler-0b57de24.js";import{_ as A}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as J}from"./LabelList.vue_vue_type_style_index_0_lang-cc1bd635.js";import{_ as Q}from"./YamlView.vue_vue_type_script_setup_true_lang-bceec76c.js";import"./vuex.esm-bundler-845b9d37.js";import"./constants-31fdaf55.js";import"./index-a95aab69.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-f135467f.js";import"./ErrorBlock-97f580ba.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-038681a0.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-7137c594.js";import"./_commonjsHelpers-edff4021.js";import"./toYaml-4e00099e.js";const U={class:"chart-box-list"},X=S({__name:"MeshCharts",setup(O){const l=N(),_=p(()=>l.getters.getChart("services",{title:"Services",showTotal:!0})),v=p(()=>l.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),g=p(()=>l.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),f=p(()=>l.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));L(()=>l.state.selectedMesh,function(){a()}),a();function a(){l.dispatch("fetchMeshInsights",l.state.selectedMesh),l.dispatch("fetchServices",l.state.selectedMesh)}return(B,w)=>(n(),r("div",U,[d(M,{data:c(_)},null,8,["data"]),o(),d(M,{data:c(v)},null,8,["data"]),o(),d(M,{data:c(g)},null,8,["data"]),o(),d(M,{data:c(f)},null,8,["data"])]))}});const Y=A(X,[["__scopeId","data-v-62ff2edc"]]),Z={key:0},ee={key:1},te={key:1},ae={class:"policy-counts"},se={key:0},ne={key:0,class:"mt-4"},oe=S({__name:"MeshOverviewView",setup(O){const l=j(),_=N(),v=y(!0),g=y(!1),f=y(!1),a=y(null),B=y(null),w=p(()=>a.value!==null?z(a.value):null),R=p(()=>{if(a.value===null)return null;const{name:t,type:s,creationTime:h,modificationTime:e}=a.value;return{name:t,type:s,created:T(h),modified:T(e),"Data Plane Proxies":_.state.meshInsight.dataplanes.total}}),F=p(()=>{var P;if(a.value===null)return null;const t=C(a.value,"mtls"),s=C(a.value,"logging"),h=C(a.value,"metrics"),e=C(a.value,"tracing"),i=Boolean((P=a.value.routing)==null?void 0:P.localityAwareLoadBalancing);return{mtls:t,logging:s,metrics:h,tracing:e,localityAwareLoadBalancing:i}}),K=p(()=>_.state.sidebar.insights.mesh.policies.total),W=p(()=>_.state.policyTypes.map(t=>{var s;return{...t,length:((s=_.state.meshInsight.policies[t.name])==null?void 0:s.total)??0}}));L(()=>l.params.mesh,function(){l.name==="single-mesh-overview"&&(v.value=!0,f.value=!1,g.value=!1,V())}),V();async function V(){v.value=!0,f.value=!1;const t=l.params.mesh;try{a.value=await E.getMesh({name:t}),B.value=await E.getMeshInsights({name:t})}catch(s){g.value=!0,f.value=!0,console.error(s)}finally{v.value=!1}}function C(t,s){if(t===null||t[s]===void 0)return!1;const h=t[s].enabledBackend??t[s].defaultBackend??t[s].backends[0].name,e=t[s].backends.find(i=>i.name===h);return`${e.type} / ${e.name}`}return(t,s)=>{const h=H("router-link");return n(),r(b,null,[d(Y,{class:"mt-24"}),o(),d(q,{class:"mt-8"},{content:k(()=>[a.value!==null?(n(),r("div",Z,[d(J,{"has-error":g.value,"is-loading":v.value,"is-empty":f.value},{default:k(()=>[u("div",null,[u("ul",null,[(n(!0),r(b,null,x(c(R),(e,i)=>(n(),r("li",{key:i},[u("h4",null,m(i),1),o(),typeof e=="boolean"?(n(),$(c(I),{key:0,appearance:e?"success":"danger"},{default:k(()=>[o(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(n(),r("p",ee,m(e),1))]))),128))])]),o(),u("div",null,[u("ul",null,[(n(!0),r(b,null,x(c(F),(e,i)=>(n(),r("li",{key:i},[u("h4",null,m(i),1),o(),typeof e=="boolean"?(n(),$(c(I),{key:0,appearance:e?"success":"danger"},{default:k(()=>[o(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(n(),r("p",te,m(e),1))]))),128))])]),o(),u("div",null,[u("ul",ae,[u("li",null,[u("h4",null,`
                  Policies (`+m(c(K))+`)
                `,1),o(),u("ul",null,[(n(!0),r(b,null,x(c(W),(e,i)=>(n(),r(b,{key:i},[e.length!==0?(n(),r("li",se,[d(h,{to:{name:"policy",params:{policyPath:e.path}}},{default:k(()=>[o(m(e.name)+": "+m(e.length),1)]),_:2},1032,["to"])])):D("",!0)],64))),128))])])])])]),_:1},8,["has-error","is-loading","is-empty"])])):D("",!0)]),_:1}),o(),c(w)!==null?(n(),r("div",ne,[d(Q,{id:"code-block-mesh",content:c(w)},null,8,["content"])])):D("",!0),o(),d(G,{class:"mt-6"})],64)}}});const we=A(oe,[["__scopeId","data-v-1ccb92a3"]]);export{we as default};
