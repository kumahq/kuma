import{a as z,A as M}from"./AccordionList-BGhcMQ3j.js";import{d as x,r as v,c as s,o as e,l as i,e as l,q as S,N as o,L as f,b as n,t as r,w as a,p as k,M as D,_ as Y,m as L,Y as H,ad as J,k as Q,n as T,K as U,F as W,a4 as Z,y as E}from"./index-CIntnFRJ.js";import{S as ee}from"./SummaryView-BF7jbE4k.js";import{P as K}from"./PolicyTypeTag-BQhrUmyj.js";import{T as q}from"./TagList-5GQAgehy.js";import{R as te}from"./RuleMatchers-BQvTn0qo.js";const se={class:"policies-list"},ae={class:"mesh-gateway-policy-list"},le={key:0},ne={class:"dataplane-policy-header"},oe={key:0,class:"badge-list"},ie={class:"mt-1"},re=x({__name:"BuiltinGatewayPolicies",props:{gatewayDataplane:{},types:{}},setup(V){const C=V;return(A,t)=>{const N=v("XAction"),P=v("XBadge");return e(),s("div",se,[i("div",ae,[t[11]||(t[11]=i("h3",{class:"mb-2"},`
        Gateway policies
      `,-1)),t[12]||(t[12]=l()),A.gatewayDataplane.routePolicies.length>0?(e(),s("ul",le,[(e(!0),s(o,null,f(A.gatewayDataplane.routePolicies,(m,c)=>{var u;return e(),s("li",{key:c},[i("span",null,r(m.type),1),t[0]||(t[0]=l(`:

          `,-1)),n(N,{to:{name:"policy-detail-view",params:{mesh:m.mesh,policyPath:((u=C.types[m.type])==null?void 0:u.path)??"",policy:m.name}}},{default:a(()=>[l(r(m.name),1)]),_:2},1032,["to"])])}),128))])):S("",!0),t[13]||(t[13]=l()),t[14]||(t[14]=i("h3",{class:"mt-6 mb-2"},`
        Listeners
      `,-1)),t[15]||(t[15]=l()),i("div",null,[(e(!0),s(o,null,f(A.gatewayDataplane.listenerEntries,(m,c)=>(e(),s("div",{key:c},[i("div",null,[i("div",null,[t[1]||(t[1]=i("b",null,"Host",-1)),l(": "+r(m.hostName)+":"+r(m.port)+" ("+r(m.protocol)+`)
            `,1)]),t[10]||(t[10]=l()),m.routeEntries.length>0?(e(),s(o,{key:0},[t[8]||(t[8]=i("h4",{class:"mt-2 mb-2"},`
                Routes
              `,-1)),t[9]||(t[9]=l()),n(M,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(o,null,f(m.routeEntries,(u,d)=>(e(),k(z,{key:d},D({"accordion-header":a(()=>{var y;return[i("div",ne,[i("div",null,[i("div",null,[t[2]||(t[2]=i("b",null,"Route",-1)),t[3]||(t[3]=l(": ",-1)),n(N,{to:{name:"policy-detail-view",params:{mesh:u.route.mesh,policyPath:((y=C.types[u.route.type])==null?void 0:y.path)??"",policy:u.route.name}}},{default:a(()=>[l(r(u.route.name),1)]),_:2},1032,["to"])]),t[5]||(t[5]=l()),i("div",null,[t[4]||(t[4]=i("b",null,"Service",-1)),l(": "+r(u.service),1)])]),t[6]||(t[6]=l()),u.origins.length>0?(e(),s("div",oe,[(e(!0),s(o,null,f(u.origins,(g,h)=>(e(),k(P,{key:`${c}-${h}`},{default:a(()=>[l(r(g.type),1)]),_:2},1024))),128))])):S("",!0)])]}),_:2},[u.origins.length>0?{name:"accordion-content",fn:a(()=>[i("ul",ie,[(e(!0),s(o,null,f(u.origins,(y,g)=>{var h;return e(),s("li",{key:`${c}-${g}`},[l(r(y.type)+`:

                        `,1),n(N,{to:{name:"policy-detail-view",params:{mesh:y.mesh,policyPath:((h=C.types[y.type])==null?void 0:h.path)??"",policy:y.name}}},{default:a(()=>[l(r(y.name),1)]),_:2},1032,["to"])])}),128))])]),key:"0"}:void 0]),1024))),128))]),_:2},1024)],64)):S("",!0)])]))),128))])])])}}}),ue=Y(re,[["__scopeId","data-v-40854b5f"]]),pe={class:"policy-type-heading"},de={class:"policy-list"},me={key:0},ce=x({__name:"PolicyTypeEntryList",props:{items:{},types:{}},setup(V){const C=V;function A({headerKey:t}){return{class:`cell-${t}`}}return(t,N)=>{const P=v("XAction"),m=v("XCodeBlock");return e(),k(M,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(o,null,f(t.items,(c,u)=>(e(),k(z,{key:u},{"accordion-header":a(()=>[i("h3",pe,[n(K,{"policy-type":c.type},{default:a(()=>[l(r(c.type)+" ("+r(c.connections.length)+`)
          `,1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[i("div",de,[n(L(J),{class:"policy-type-table",data:c.connections,headers:[{label:"From",key:"sourceTags"},{label:"To",key:"destinationTags"},{label:"On",key:"name"},{label:"Conf",key:"config"},{label:"Origin policies",key:"origins"}],"cell-attrs":A,"hide-pagination":"","is-clickable":""},{sourceTags:a(({row:d})=>[d.sourceTags.length>0?(e(),k(q,{key:0,class:"tag-list","should-truncate":"",tags:d.sourceTags},null,8,["tags"])):(e(),s(o,{key:1},[l(`
                —
              `)],64))]),destinationTags:a(({row:d})=>[d.destinationTags.length>0?(e(),k(q,{key:0,class:"tag-list","should-truncate":"",tags:d.destinationTags},null,8,["tags"])):(e(),s(o,{key:1},[l(`
                —
              `)],64))]),name:a(({row:d})=>[d.name!==null?(e(),s(o,{key:0},[l(r(d.name),1)],64)):(e(),s(o,{key:1},[l(`
                —
              `)],64))]),origins:a(({row:d})=>[d.origins.length>0?(e(),s("ul",me,[(e(!0),s(o,null,f(d.origins,(y,g)=>{var h;return e(),s("li",{key:`${u}-${g}`},[n(P,{to:{name:"policy-detail-view",params:{mesh:y.mesh,policyPath:((h=C.types[y.type])==null?void 0:h.path)??"",policy:y.name}}},{default:a(()=>[l(r(y.name),1)]),_:2},1032,["to"])])}),128))])):(e(),s(o,{key:1},[l(`
                —
              `)],64))]),config:a(({row:d})=>[d.config?(e(),k(m,{key:0,code:L(H).stringify(d.config),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(o,{key:1},[l(`
                —
              `)],64))]),_:2,__:[0,1,2,3]},1032,["data"])])]),_:2,__:[4]},1024))),128))]),_:1})}}}),ye=Y(ce,[["__scopeId","data-v-87cbbf3b"]]),_e={class:"policy-type-heading"},fe={key:0,class:"matcher"},ge={key:1},ke={key:0},he=x({__name:"RuleList",props:{rules:{},types:{}},setup(V){const{t:C}=Q(),A=V;return(t,N)=>{const P=v("XAction"),m=v("XCodeBlock");return e(),k(M,{"initially-open":[],"multiple-open":""},{default:a(()=>[(e(!0),s(o,null,f([A.rules.reduce((c,u)=>(typeof c[u.type]>"u"&&(c[u.type]=[]),c[u.type].push(u),c),{})],c=>(e(),s(o,{key:c},[(e(!0),s(o,null,f(c,(u,d)=>(e(),k(z,{key:d},{"accordion-header":a(()=>[i("h3",_e,[n(K,{"policy-type":d},{default:a(()=>[l(r(d),1)]),_:2},1032,["policy-type"])])]),"accordion-content":a(()=>[(e(!0),s(o,null,f([u.some(y=>y.matchers.length>0)],y=>(e(),s("div",{key:y,class:"policy-list"},[n(U,{class:T(["policy-type-table",{"has-matchers":y}]),items:u,headers:[...y?[{label:"Matchers",key:"matchers"}]:[],{label:"Origin policies",key:"origins"},{label:"Conf",key:"config"}]},{matchers:a(({row:g})=>[g.matchers.length>0?(e(),s("span",fe,[n(te,{items:g.matchers},null,8,["items"])])):(e(),s("i",ge,r(L(C)("data-planes.routes.item.matches_everything")),1))]),origins:a(({row:g})=>[g.origins.length>0?(e(),s("ul",ke,[(e(!0),s(o,null,f(g.origins,(h,I)=>{var $;return e(),s("li",{key:`${d}-${I}`},[n(P,{to:{name:"data-plane-policy-summary-view",params:{mesh:h.mesh,policyPath:(($=A.types[h.type])==null?void 0:$.path)??"",policy:h.name}}},{default:a(()=>[l(r(h.name),1)]),_:2},1032,["to"])])}),128))])):(e(),s(o,{key:1},[l(r(L(C)("common.collection.none")),1)],64))]),config:a(({row:g})=>[Object.keys(g.raw).length>0?(e(),k(m,{key:0,code:L(H).stringify(g.raw),language:"yaml","show-copy-button":!1},null,8,["code"])):(e(),s(o,{key:1},[l(r(L(C)("common.collection.none")),1)],64))]),_:2,__:[0,1]},1032,["class","items","headers"])]))),128))]),_:2,__:[2]},1024))),128))],64))),128))]),_:1})}}}),G=Y(he,[["__scopeId","data-v-8b58b2bd"]]),be={class:"mb-2"},ve={class:"mb-2"},$e={key:0},Xe=x({__name:"DataPlanePoliciesView",props:{data:{}},setup(V){const C=V;return(A,t)=>{const N=v("RouteTitle"),P=v("XCard"),m=v("DataCollection"),c=v("DataLoader"),u=v("RouterView"),d=v("DataSource"),y=v("AppView"),g=v("RouteView");return e(),k(g,{name:"data-plane-policies-view",params:{mesh:"",proxy:""}},{default:a(({uri:h,can:I,route:$,t:R})=>[n(N,{render:!1,title:R("data-planes.routes.item.navigation.data-plane-policies-view")},null,8,["title"]),t[11]||(t[11]=l()),n(y,null,{default:a(()=>[n(d,{src:h(L(W),"/policy-types",{})},{default:a(({data:X,error:F})=>[(e(!0),s(o,null,f([((X==null?void 0:X.policyTypes)??[]).reduce((w,b)=>Object.assign(w,{[b.name]:b}),{})],w=>(e(),s(o,{key:typeof w},[n(c,{src:h(L(Z),"/meshes/:mesh/rules/for/:dataplane",{mesh:$.params.mesh,dataplane:$.params.proxy}),data:[X],errors:[F]},{default:a(({data:b})=>[n(m,{items:b.rules},{default:a(()=>[(e(),s(o,null,f(["proxy","to"],_=>n(m,{key:_,items:b.rules,predicate:p=>p.ruleType===_,comparator:(p,B)=>p.type.localeCompare(B.type),empty:!1},{default:a(({items:p})=>[n(P,null,{default:a(()=>[i("h3",null,r(R(`data-planes.routes.item.rules.${_}`)),1),t[0]||(t[0]=l()),n(G,{class:"mt-2",rules:p,types:w,"data-testid":`${_}-rule-list`},null,8,["rules","types","data-testid"])]),_:2,__:[0]},1024)]),_:2},1032,["items","predicate","comparator"])),64)),t[5]||(t[5]=l()),n(m,{items:b.rules,predicate:_=>{var p;return _.ruleType==="from"&&!((p=w[_.type])!=null&&p.policy.isFromAsRules)},comparator:(_,p)=>_.type.localeCompare(p.type),empty:!1},{default:a(({items:_})=>[n(P,null,{default:a(()=>[i("h3",be,r(R("data-planes.routes.item.rules.from")),1),t[2]||(t[2]=l()),(e(!0),s(o,null,f([Object.groupBy(_,p=>p.inbound.port)],p=>(e(),s(o,{key:p},[(e(!0),s(o,null,f(Object.entries(p).sort(([B],[O])=>Number(O)-Number(B)),([B,O],j)=>(e(),s("div",{key:j},[i("h4",null,r(R("data-planes.routes.item.port",{port:B})),1),t[1]||(t[1]=l()),n(G,{class:"mt-2",rules:O,types:w,"data-testid":`from-rule-list-${j}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2,__:[2]},1024)]),_:2},1032,["items","predicate","comparator"]),t[6]||(t[6]=l()),n(m,{items:b.inboundRules,comparator:(_,p)=>_.type.localeCompare(p.type),empty:!1},{default:a(({items:_})=>[n(P,null,{default:a(()=>[i("h3",ve,r(R("data-planes.routes.item.rules.inbound")),1),t[4]||(t[4]=l()),(e(!0),s(o,null,f([Object.groupBy(_,p=>p.inbound.port)],p=>(e(),s(o,{key:p},[(e(!0),s(o,null,f(Object.entries(p).sort(([B],[O])=>Number(O)-Number(B)),([B,O],j)=>(e(),s("div",{key:j},[i("h4",null,r(R("data-planes.routes.item.port",{port:B})),1),t[3]||(t[3]=l()),n(G,{class:"mt-2",rules:O,types:w,"data-testid":`inbound-rule-list-${j}`},null,8,["rules","types","data-testid"])]))),128))],64))),128))]),_:2,__:[4]},1024)]),_:2},1032,["items","comparator"])]),_:2,__:[5,6]},1032,["items"])]),_:2},1032,["src","data","errors"]),t[9]||(t[9]=l()),I("use zones")?S("",!0):(e(),s("div",$e,[C.data.dataplaneType==="builtin"?(e(),k(c,{key:0,src:`/meshes/${$.params.mesh}/dataplanes/${$.params.proxy}/gateway-dataplane-policies`,data:[X],errors:[F]},{default:a(({data:b})=>[b?(e(),k(m,{key:0,items:b.routePolicies,empty:!1},{default:a(()=>[i("h3",null,r(R("data-planes.routes.item.legacy_policies")),1),t[7]||(t[7]=l()),n(P,{class:"mt-4"},{default:a(()=>[n(ue,{types:w,"gateway-dataplane":b,"data-testid":"builtin-gateway-dataplane-policies"},null,8,["types","gateway-dataplane"])]),_:2},1024)]),_:2,__:[7]},1032,["items"])):S("",!0)]),_:2},1032,["src","data","errors"])):(e(),k(c,{key:1,src:`/meshes/${$.params.mesh}/dataplanes/${$.params.proxy}/sidecar-dataplane-policies`,data:[X],errors:[F]},{default:a(({data:b})=>[n(m,{empty:!1,items:b.policyTypeEntries,predicate:_=>{var p;return((p=w[_.type])==null?void 0:p.policy.isTargetRef)===!1}},{default:a(({items:_})=>[i("h3",null,r(R("data-planes.routes.item.legacy_policies")),1),t[8]||(t[8]=l()),n(P,{class:"mt-4"},{default:a(()=>[n(ye,{items:_,types:w,"data-testid":"sidecar-dataplane-policies"},null,8,["items","types"])]),_:2},1024)]),_:2,__:[8]},1032,["items","predicate"])]),_:2},1032,["src","data","errors"]))]))],64))),128)),t[10]||(t[10]=l()),n(u,null,{default:a(({Component:w})=>[$.child()&&X?(e(),k(ee,{key:0,onClose:b=>$.replace({name:"data-plane-policies-view",params:{mesh:$.params.mesh,proxy:$.params.proxy}})},{default:a(()=>[(e(),k(E(w),{"policy-types":X.policyTypes},null,8,["policy-types"]))]),_:2},1032,["onClose"])):S("",!0)]),_:2},1024)]),_:2,__:[10]},1032,["src"])]),_:2},1024)]),_:1,__:[11]})}}});export{Xe as default};
