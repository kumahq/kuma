import{d as N,i as S,j as p,n as A,o as s,c as u,a as d,u as o,G as w,e as n,H as K,l as G,m as H,r as b,J,K as T,L as W,w as v,k as D,g as i,F as C,z as x,y as h,_ as $,x as B,M as L}from"./index-e096fb01.js";import{C as q}from"./ContentWrapper-17a24af8.js";import{_ as Q}from"./LabelList.vue_vue_type_style_index_0_lang-4dec2f30.js";import{M as U}from"./MeshResources-3c8a1f10.js";import{_ as X}from"./YamlView.vue_vue_type_script_setup_true_lang-8340ad04.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-467e5ff3.js";import"./ErrorBlock-e347ad5a.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-7adf9901.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-25903ab0.js";import"./toYaml-4e00099e.js";const Y={class:"chart-box-list"},Z=N({__name:"MeshCharts",setup(O){const r=S(),y=p(()=>r.getters.getChart("services",{title:"Services",showTotal:!0})),g=p(()=>r.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),f=p(()=>r.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),k=p(()=>r.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));A(()=>r.state.selectedMesh,function(){_()}),_();function _(){r.dispatch("fetchMeshInsights",r.state.selectedMesh),r.dispatch("fetchServices",r.state.selectedMesh)}return(l,V)=>(s(),u("div",Y,[d(w,{data:o(y)},null,8,["data"]),n(),d(w,{data:o(g)},null,8,["data"]),n(),d(w,{data:o(f)},null,8,["data"]),n(),d(w,{data:o(k)},null,8,["data"])]))}});const ee=K(Z,[["__scopeId","data-v-0f054518"]]),te={key:1},ae={key:1},se={class:"policy-counts"},ne={key:0},oe=N({__name:"MeshOverviewView",setup(O){const r=G(),y=H(),g=S(),f=b(!0),k=b(!1),_=b(!1),l=b(null),V=b(null),P=p(()=>l.value!==null?J(l.value):null),R=p(()=>{if(l.value===null)return null;const{name:t,type:a,creationTime:m,modificationTime:e}=l.value;return{name:t,type:a,created:T(m),modified:T(e),"Data Plane Proxies":g.state.meshInsight.dataplanes.total}}),F=p(()=>{var E;if(l.value===null)return null;const t=M(l.value,"mtls"),a=M(l.value,"logging"),m=M(l.value,"metrics"),e=M(l.value,"tracing"),c=!!((E=l.value.routing)!=null&&E.localityAwareLoadBalancing);return{mtls:t,logging:a,metrics:m,tracing:e,localityAwareLoadBalancing:c}}),j=p(()=>g.state.sidebar.insights.mesh.policies.total),z=p(()=>g.state.policyTypes.map(t=>{var a;return{...t,length:((a=g.state.meshInsight.policies[t.name])==null?void 0:a.total)??0}}));A(()=>y.params.mesh,function(){y.name==="single-mesh-overview"&&(f.value=!0,_.value=!1,k.value=!1,I())}),I();async function I(){f.value=!0,_.value=!1;const t=y.params.mesh;try{l.value=await r.getMesh({name:t}),V.value=await r.getMeshInsights({name:t})}catch(a){k.value=!0,_.value=!0,console.error(a)}finally{f.value=!1}}function M(t,a){if(t===null||t[a]===void 0)return!1;const m=t[a].enabledBackend??t[a].defaultBackend??t[a].backends[0].name,e=t[a].backends.find(c=>c.name===m);return`${e.type} / ${e.name}`}return(t,a)=>{const m=W("router-link");return s(),u(C,null,[d(ee,{class:"mt-24"}),n(),d(q,{class:"mt-8"},{content:v(()=>[l.value!==null?(s(),D(o(L),{key:0,"border-variant":"noBorder"},{body:v(()=>[d(Q,{"has-error":k.value,"is-loading":f.value,"is-empty":_.value},{default:v(()=>[i("div",null,[i("ul",null,[(s(!0),u(C,null,x(o(R),(e,c)=>(s(),u("li",{key:c},[i("h4",null,h(c),1),n(),typeof e=="boolean"?(s(),D(o($),{key:0,appearance:e?"success":"danger"},{default:v(()=>[n(h(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),u("p",te,h(e),1))]))),128))])]),n(),i("div",null,[i("ul",null,[(s(!0),u(C,null,x(o(F),(e,c)=>(s(),u("li",{key:c},[i("h4",null,h(c),1),n(),typeof e=="boolean"?(s(),D(o($),{key:0,appearance:e?"success":"danger"},{default:v(()=>[n(h(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),u("p",ae,h(e),1))]))),128))])]),n(),i("div",null,[i("ul",se,[i("li",null,[i("h4",null,`
                    Policies (`+h(o(j))+`)
                  `,1),n(),i("ul",null,[(s(!0),u(C,null,x(o(z),(e,c)=>(s(),u(C,{key:c},[e.length!==0?(s(),u("li",ne,[d(m,{to:{name:"policy",params:{policyPath:e.path}}},{default:v(()=>[n(h(e.name)+": "+h(e.length),1)]),_:2},1032,["to"])])):B("",!0)],64))),128))])])])])]),_:1},8,["has-error","is-loading","is-empty"])]),_:1})):B("",!0)]),_:1}),n(),o(P)!==null?(s(),D(o(L),{key:0,class:"mt-4"},{body:v(()=>[d(X,{id:"code-block-mesh",content:o(P)},null,8,["content"])]),_:1})):B("",!0),n(),d(U,{class:"mt-6"})],64)}}});const ve=K(oe,[["__scopeId","data-v-27ece000"]]);export{ve as default};
