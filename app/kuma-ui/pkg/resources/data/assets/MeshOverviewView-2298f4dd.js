import{z as M,O}from"./kongponents.es-414449e8.js";import{d as S,u as A,c as m,v as R,o as s,j as d,g as o,h as r,r as w,G as W,O as E,x as H,w as l,e as b,b as p,i as N,F as f,q as B,t as v,f as V}from"./index-7c362181.js";import{D as x}from"./DoughnutChart-a0974e14.js";import{u as z}from"./store-72ab29d4.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import{D as P,a as I,T as J}from"./TextWithCopyButton-28c506a3.js";import{M as Q}from"./MeshResources-f408824e.js";import{_ as U}from"./StatusInfo.vue_vue_type_script_setup_true_lang-6ef0b459.js";import{_ as X}from"./YamlView.vue_vue_type_script_setup_true_lang-50a2869f.js";import{u as Y}from"./index-efbce9eb.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-6507ce20.js";import"./ErrorBlock-41d3ccd4.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-b7beddaa.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-c645bc0d.js";import"./toYaml-4e00099e.js";const Z={class:"chart-box-list"},ee=S({__name:"MeshCharts",setup(K){const C=A(),u=z(),h=m(()=>u.getters.getChart("services",{title:"Services",showTotal:!0})),g=m(()=>u.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),y=m(()=>u.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),a=m(()=>u.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));R(()=>C.params.mesh,function(c){typeof c=="string"&&k(c)},{immediate:!0});function k(c){u.dispatch("fetchMeshInsights",c),u.dispatch("fetchServices",c)}return(c,T)=>(s(),d("div",Z,[o(x,{data:h.value},null,8,["data"]),r(),o(x,{data:g.value},null,8,["data"]),r(),o(x,{data:y.value},null,8,["data"]),r(),o(x,{data:a.value},null,8,["data"])]))}});const te=F(ee,[["__scopeId","data-v-5ab6d374"]]),ae={class:"kcard-stack"},se={class:"columns"},ne={key:0},oe=S({__name:"MeshOverviewView",setup(K){const C=Y(),u=A(),h=z(),g=w(!0),y=w(!1),a=w(null),k=w(null),c=m(()=>a.value!==null?W(a.value):null),T=m(()=>{if(a.value===null)return null;const{name:t,type:n,creationTime:_,modificationTime:e}=a.value;return{name:t,type:n,created:E(_),modified:E(e),"Data Plane Proxies":h.state.meshInsight.dataplanes.total}}),j=m(()=>{var L;if(a.value===null)return null;const t=D(a.value,"mtls"),n=D(a.value,"logging"),_=D(a.value,"metrics"),e=D(a.value,"tracing"),i=!!((L=a.value.routing)!=null&&L.localityAwareLoadBalancing);return{mtls:t,logging:n,metrics:_,tracing:e,localityAwareLoadBalancing:i}}),q=m(()=>h.state.sidebar.insights.mesh.policies.total),G=m(()=>h.state.policyTypes.map(t=>{var n;return{...t,length:((n=h.state.meshInsight.policies[t.name])==null?void 0:n.total)??0}}));R(()=>u.params.mesh,function(){u.name==="single-mesh-overview"&&$()}),$();async function $(){g.value=!0,y.value=!1;const t=u.params.mesh;try{a.value=await C.getMesh({name:t}),k.value=await C.getMeshInsights({name:t})}catch(n){y.value=!0,a.value=null,k.value=null,console.error(n)}finally{g.value=!1}}function D(t,n){if(t===null||t[n]===void 0)return!1;const _=t[n].enabledBackend??t[n].defaultBackend??t[n].backends[0].name,e=t[n].backends.find(i=>i.name===_);return`${e.type} / ${e.name}`}return(t,n)=>{const _=H("router-link");return s(),d("div",ae,[o(b(M),null,{body:l(()=>[o(te)]),_:1}),r(),a.value!==null?(s(),p(b(M),{key:0},{body:l(()=>[N("div",se,[o(U,{"is-loading":g.value,"has-error":y.value,"is-empty":a.value===null||k.value===null},{default:l(()=>[o(P,null,{default:l(()=>[(s(!0),d(f,null,B(T.value,(e,i)=>(s(),p(I,{key:i,term:i},{default:l(()=>[typeof e=="boolean"?(s(),p(b(O),{key:0,appearance:e?"success":"danger"},{default:l(()=>[r(v(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):i==="name"&&typeof e=="string"?(s(),p(J,{key:1,text:e},null,8,["text"])):(s(),d(f,{key:2},[r(v(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1})]),_:1},8,["is-loading","has-error","is-empty"]),r(),o(P,null,{default:l(()=>[(s(!0),d(f,null,B(j.value,(e,i)=>(s(),p(I,{key:i,term:i},{default:l(()=>[typeof e=="boolean"?(s(),p(b(O),{key:0,appearance:e?"success":"danger"},{default:l(()=>[r(v(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(s(),d(f,{key:1},[r(v(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),r(),o(P,null,{default:l(()=>[o(I,{term:`Policies (${q.value})`},{default:l(()=>[N("ul",null,[(s(!0),d(f,null,B(G.value,(e,i)=>(s(),d(f,{key:i},[e.length!==0?(s(),d("li",ne,[o(_,{to:{name:"policies-list-view",params:{policyPath:e.path}}},{default:l(()=>[r(v(e.name)+": "+v(e.length),1)]),_:2},1032,["to"])])):V("",!0)],64))),128))])]),_:1},8,["term"])]),_:1})])]),_:1})):V("",!0),r(),c.value!==null?(s(),p(b(M),{key:1},{body:l(()=>[o(X,{id:"code-block-mesh",content:c.value},null,8,["content"])]),_:1})):V("",!0),r(),o(Q)])}}});const be=F(oe,[["__scopeId","data-v-a657c70f"]]);export{be as default};
