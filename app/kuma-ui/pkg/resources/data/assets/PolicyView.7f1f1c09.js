import{d as B,o as r,c as C,w as s,a as w,u as t,K as G,b as V,e as M,r as e,f as $,g as R,h as Z,k as L,i as J,j as b,l as a,m as Q,v as X,F as U,n as H,t as T,p as ee,q as ae,P as K,s as te,x as se,y as le,z as E,A as ne,B as oe,C as re,D as ie}from"./index.09f51eb8.js";import{D as ue}from"./DataOverview.75cd0a9e.js";import{F as ce}from"./FrameSkeleton.fcef0e24.js";import{_ as O}from"./LabelList.vue_vue_type_style_index_0_lang.6ccc9977.js";import{T as pe}from"./TabsWidget.55b438d0.js";import{Y as me}from"./YamlView.e892619a.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.264304d3.js";import"./ErrorBlock.6cb5eaea.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.f2b15057.js";import"./TagList.c6e1c385.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.f4101bd8.js";import"./_commonjsHelpers.f037b798.js";const de=B({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(m){const d=m;return(S,v)=>(r(),C(t(M),{class:"docs-link",appearance:"outline",target:"_blank",to:d.href},{icon:s(()=>[w(t(G),{icon:"externalLink"})]),default:s(()=>[V(" Documentation ")]),_:1},8,["to"]))}}),ve=a("h4",null,"Dataplanes",-1),ye=B({__name:"PolicyConnections",props:{mesh:{type:String,required:!0},policyType:{type:String,required:!0},policyName:{type:String,required:!0}},setup(m){const d=m,S=e(!1),v=e(!0),D=e(!1),_=e([]),y=e(""),g=$(()=>{const i=y.value.toLowerCase();return _.value.filter(({dataplane:l})=>l.name.toLowerCase().includes(i))});R(()=>d.policyName,function(){h()}),Z(function(){h()});async function h(){D.value=!1,v.value=!0;try{const{items:i,total:l}=await L.getPolicyConnections({mesh:d.mesh,policyType:d.policyType,policyName:d.policyName});S.value=l>0,_.value=i}catch{D.value=!0}finally{v.value=!1}}return(i,l)=>{const P=J("router-link");return r(),b("div",null,[w(O,{"has-error":D.value,"is-loading":v.value,"is-empty":!S.value},{default:s(()=>[a("ul",null,[a("li",null,[ve,Q(a("input",{id:"dataplane-search","onUpdate:modelValue":l[0]||(l[0]=u=>y.value=u),type:"text",class:"k-input mb-4",placeholder:"Filter by name",required:"","data-testid":"dataplane-search-input"},null,512),[[X,y.value]]),(r(!0),b(U,null,H(t(g),(u,k)=>(r(),b("p",{key:k,class:"my-1","data-testid":"dataplane-name"},[w(P,{to:{name:"data-plane-detail-view",params:{mesh:u.dataplane.mesh,dataPlane:u.dataplane.name}}},{default:s(()=>[V(T(u.dataplane.name),1)]),_:2},1032,["to"])]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])])}}}),W=m=>(oe("data-v-4eaa60dc"),m=m(),re(),m),he={key:0,class:"mb-4"},fe=W(()=>a("p",null,[a("strong",null,"Warning"),V(" This policy is experimental. If you encountered any problem please open an "),a("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),_e=W(()=>a("span",{class:"custom-control-icon"}," \u2190 ",-1)),ge={"data-testid":"policy-single-entity"},ke={"data-testid":"policy-overview-tab"},we={class:"config-wrapper"},be=B({__name:"PolicyView",props:{policyPath:{type:String,required:!0}},setup(m){const d=m,S=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],v=ee(),D=ae(),_=e(!0),y=e(!1),g=e(null),h=e(!0),i=e(!1),l=e(!1),P=e(!1),u=e({}),k=e(null),N=e(null),q=e({headers:[{label:"Actions",key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Mesh",key:"mesh"},{label:"Type",key:"type"}],data:[]}),c=$(()=>D.state.policiesByPath[d.policyPath]),Y=$(()=>`https://kuma.io/docs/${D.getters["config/getKumaDocsVersion"]}/policies/${c.value.path}/`);R(()=>v.params.mesh,function(){v.name===d.policyPath&&(_.value=!0,y.value=!1,h.value=!0,i.value=!1,l.value=!1,P.value=!1,g.value=null,A())}),A();async function A(n=0){_.value=!0,g.value=null;const o=v.query.ns||null,f=v.params.mesh,x=c.value.path;try{let p;if(f!==null&&o!==null)p=[await L.getSinglePolicyEntity({mesh:f,path:x,name:o})],N.value=null;else{const I={size:K,offset:n},z=await L.getAllPolicyEntitiesFromMesh({mesh:f,path:x},I);p=z.items,N.value=z.next}p.length>0?(q.value.data=p.map(I=>j(I)),P.value=!1,y.value=!1,await F({mesh:p[0].mesh,name:p[0].name,path:x})):(q.value.data=[],P.value=!0,y.value=!0,i.value=!0)}catch(p){p instanceof Error?g.value=p:console.error(p),y.value=!0}finally{_.value=!1,h.value=!1}}function j(n){if(!n.mesh)return n;const o=n,f={name:"mesh-detail-view",params:{mesh:n.mesh}};return o.meshRoute=f,o}async function F(n){l.value=!1,h.value=!0,i.value=!1;try{const o=await L.getSinglePolicyEntity({mesh:n.mesh,path:c.value.path,name:n.name});if(o){const f=["type","name","mesh"];u.value=te(o,f),k.value=se(o)}else u.value={},i.value=!0}catch(o){l.value=!0,console.error(o)}finally{h.value=!1}}return(n,o)=>t(c)?(r(),b("div",{key:0,class:ne(["relative",t(c).path])},[t(c).isExperimental?(r(),b("div",he,[w(t(le),{appearance:"warning"},{alertMessage:s(()=>[fe]),_:1})])):E("",!0),w(ce,null,{default:s(()=>[w(ue,{"selected-entity-name":u.value.name,"page-size":t(K),error:g.value,"is-loading":_.value,"empty-state":{title:"No Data",message:`There are no ${t(c).pluralDisplayName} present.`},"table-data":q.value,"table-data-is-empty":P.value,next:N.value,onTableAction:F,onLoadData:A},{additionalControls:s(()=>[w(de,{href:t(Y),"data-testid":"policy-documentation-link"},null,8,["href"]),n.$route.query.ns?(r(),C(t(M),{key:0,class:"back-button",appearance:"primary",to:{name:t(c).path}},{default:s(()=>[_e,V(" View All ")]),_:1},8,["to"])):E("",!0)]),default:s(()=>[V(" > ")]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next"]),y.value===!1?(r(),C(pe,{key:0,"has-error":g.value!==null,error:g.value,"is-loading":_.value,tabs:S,"initial-tab-override":"overview"},{tabHeader:s(()=>[a("div",null,[a("h3",ge,T(t(c).singularDisplayName)+": "+T(u.value.name),1)])]),overview:s(()=>[w(O,{"has-error":l.value,"is-loading":h.value,"is-empty":i.value},{default:s(()=>[a("div",ke,[a("ul",null,[(r(!0),b(U,null,H(u.value,(f,x)=>(r(),b("li",{key:x},[a("h4",null,T(x),1),a("p",null,T(f),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"]),a("div",we,[k.value!==null?(r(),C(me,{key:0,id:"code-block-policy","has-error":l.value,"is-loading":h.value,"is-empty":i.value,content:k.value,"is-searchable":""},null,8,["has-error","is-loading","is-empty","content"])):E("",!0)])]),"affected-dpps":s(()=>[k.value!==null?(r(),C(ye,{key:0,mesh:k.value.mesh,"policy-name":k.value.name,"policy-type":t(c).path},null,8,["mesh","policy-name","policy-type"])):E("",!0)]),_:1},8,["has-error","error","is-loading"])):E("",!0)]),_:1})],2)):E("",!0)}});const $e=ie(be,[["__scopeId","data-v-4eaa60dc"]]);export{$e as default};
