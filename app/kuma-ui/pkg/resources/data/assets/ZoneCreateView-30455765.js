import{d as q,t as m,v as se,W as ae,o as v,j as Z,m as t,h as i,w as l,g as y,i as e,H as K,aw as re,at as U,aA as le,aB as ie,l as n,V as w,a1 as ce,L as x,e as G,f as C,D as o,z as H,B as W,q as j,R as ue,a8 as de,aC as T,r as me,A as pe,C as ve,$ as S,aD as fe,aE as _e,E as be,X as ze,k as F,F as P,N as X,aF as M,aG as ge,_ as he}from"./index-d72699a0.js";import{_ as E}from"./CodeBlock.vue_vue_type_style_index_0_lang-69055c4f.js";import{u as J}from"./store-0b207c01.js";import{g as ke}from"./dataplane-30467516.js";const ye=["data-test-state"],Ee={class:"scanner-content"},Ce={class:"mr-1"},Ie=q({__name:"EntityScanner",props:{interval:{type:Number,required:!1,default:1e3},retries:{type:Number,required:!1,default:3600},hasError:{type:Boolean,default:!1},loaderFunction:{type:Function,required:!0},canComplete:{type:Boolean,default:!1}},emits:["hide-siblings"],setup(u,{emit:s}){const a=u,k=m(0),b=m(!1),p=m(!1),z=m(null);se(function(){f()}),ae(function(){d()});function f(){b.value=!0,p.value=!1,d(),z.value=window.setInterval(async()=>{k.value++,await a.loaderFunction(),(k.value===a.retries||a.canComplete===!0)&&(d(),b.value=!1,p.value=!0,s("hide-siblings",!0))},a.interval)}function d(){z.value!==null&&window.clearInterval(z.value)}return(g,$)=>(v(),Z("div",{class:"scanner","data-test-state":b.value?"waiting":u.hasError?"error":"success"},[t("div",Ee,[i(e(ce),{"cta-is-hidden":""},{title:l(()=>[t("span",Ce,[b.value?(v(),y(e(K),{key:0,icon:"spinner",color:e(re),size:e(U)},null,8,["color","size"])):u.hasError?(v(),y(e(K),{key:1,icon:"errorFilled",color:e(le),size:e(U)},null,8,["color","size"])):(v(),y(e(K),{key:2,icon:"circleCheck",color:e(ie),size:e(U)},null,8,["color","size"]))]),n(),b.value?w(g.$slots,"loading-title",{key:0}):u.hasError?w(g.$slots,"error-title",{key:1}):w(g.$slots,"complete-title",{key:2})]),message:l(()=>[b.value?w(g.$slots,"loading-content",{key:0}):u.hasError?w(g.$slots,"error-content",{key:1}):w(g.$slots,"complete-content",{key:2})]),_:3})])],8,ye))}}),V=u=>(H("data-v-977229c4"),u=u(),W(),u),we=V(()=>t("span",{class:"step-number"},"1",-1)),$e={href:"https://helm.sh/docs/intro/install/"},Ne=V(()=>t("span",{class:"step-number"},"2",-1)),Se=V(()=>t("p",null,"On your local machine, create a namespace in your Kubernetes cluster and pull down the kong Helm repo.",-1)),Ze=V(()=>t("span",{class:"step-number"},"3",-1)),Ve=V(()=>t("span",{class:"step-number"},"4",-1)),Te={class:"k-input-label mt-4"},qe={class:"mt-4"},Ae=q({__name:"ZoneCreateKubernetesInstructions",props:{zoneName:{type:String,required:!0},zoneIngressEnabled:{type:Boolean,required:!0},zoneEgressEnabled:{type:Boolean,required:!0},token:{type:String,required:!0},base64EncodedToken:{type:String,required:!0}},setup(u){const s=u,a=x(),k=G(),b=J(),p=C(()=>a.t("zones.form.kubernetes.secret.createSecretCommand",{token:s.base64EncodedToken}).trim()),z=C(()=>{const f={zoneName:s.zoneName,globalKdsAddress:b.state.globalKdsAddress,zoneIngressEnabled:String(s.zoneIngressEnabled),zoneEgressEnabled:String(s.zoneEgressEnabled)};return typeof k.params.virtualControlPlaneId=="string"&&(f.controlPlaneId=k.params.virtualControlPlaneId),a.t("zones.form.kubernetes.connectZone.config",f).trim()});return(f,d)=>(v(),Z("div",null,[t("h3",null,[we,n(" "+o(e(a).t("zones.form.kubernetes.prerequisites.title")),1)]),n(),t("ul",null,[t("li",null,[t("b",null,o(e(a).t("zones.form.kubernetes.prerequisites.step1Label"))+o(s.zoneIngressEnabled?" "+e(a).t("zones.form.kubernetes.prerequisites.step1LabelAddendum"):""),1),n(`:
        `+o(e(a).t("zones.form.kubernetes.prerequisites.step1Description",{productName:e(a).t("common.product.name")})),1)]),n(),t("li",null,[t("b",null,o(e(a).t("zones.form.kubernetes.prerequisites.step2Label")),1),n(`:
        `+o(e(a).t("zones.form.kubernetes.prerequisites.step2Description")),1)]),n(),t("li",null,[t("a",$e,o(e(a).t("zones.form.kubernetes.prerequisites.step3LinkTitle")),1),n(" "+o(e(a).t("zones.form.kubernetes.prerequisites.step3Tail")),1)])]),n(),t("h3",null,[Ne,n(" "+o(e(a).t("zones.form.kubernetes.helm.title")),1)]),n(),Se,n(),t("ol",null,[t("li",null,[n(o(e(a).t("zones.form.kubernetes.helm.step1Description"))+" ",1),i(E,{id:"zone-kubernetes-create-namespace",class:"mt-4",code:e(a).t("zones.form.kubernetes.helm.step1Command"),language:"bash"},null,8,["code"])]),n(),t("li",null,[n(o(e(a).t("zones.form.kubernetes.helm.step2Description"))+" ",1),i(E,{id:"zone-kubernetes-add-charts-repo",class:"mt-4",code:e(a).t("zones.form.kubernetes.helm.step2Command"),language:"bash"},null,8,["code"])]),n(),t("li",null,[n(o(e(a).t("zones.form.kubernetes.helm.step3Description"))+" ",1),i(E,{id:"zone-kubernetes-repo-update",class:"mt-4",code:e(a).t("zones.form.kubernetes.helm.step3Command"),language:"bash"},null,8,["code"])])]),n(),t("h3",null,[Ze,n(" "+o(e(a).t("zones.form.kubernetes.secret.title")),1)]),n(),t("p",null,o(e(a).t("zones.form.kubernetes.secret.createSecretDescription")),1),n(),i(E,{id:"zone-kubernetes-create-secret",class:"mt-4",code:p.value,language:"bash"},null,8,["code"]),n(),t("h3",null,[Ve,n(" "+o(e(a).t("zones.form.kubernetes.connectZone.title")),1)]),n(),t("p",null,o(e(a).t("zones.form.kubernetes.connectZone.configDescription")),1),n(),t("span",Te,o(e(a).t("zones.form.kubernetes.connectZone.configFileName")),1),n(),i(E,{id:"zone-kubernetes-config-code-block",code:z.value,language:"yaml"},null,8,["code"]),n(),t("p",qe,o(e(a).t("zones.form.kubernetes.connectZone.connectDescription")),1),n(),i(E,{id:"zone-kubernetes-command-code-block",class:"mt-4",code:e(a).t("zones.form.kubernetes.connectZone.connectCommand").trim(),language:"bash"},null,8,["code"])]))}});const De=j(Ae,[["__scopeId","data-v-977229c4"]]),Q=u=>(H("data-v-499fdb93"),u=u(),W(),u),Le=Q(()=>t("span",{class:"step-number"},"1",-1)),Be=Q(()=>t("span",{class:"step-number"},"2",-1)),Ke={class:"k-input-label mt-4"},Ue={class:"mt-4"},Fe=q({__name:"ZoneCreateUniversalInstructions",props:{zoneName:{type:String,required:!0},token:{type:String,required:!0}},setup(u){const s=u,a=x(),k=G(),b=J(),p=C(()=>a.t("zones.form.universal.saveToken.saveTokenCommand",{token:s.token}).trim()),z=C(()=>{const f={zoneName:s.zoneName,globalKdsAddress:b.state.globalKdsAddress};return typeof k.params.virtualControlPlaneId=="string"&&(f.controlPlaneId=k.params.virtualControlPlaneId),a.t("zones.form.universal.connectZone.config",f).trim()});return(f,d)=>(v(),Z("div",null,[t("h3",null,[Le,n(" "+o(e(a).t("zones.form.universal.saveToken.title")),1)]),n(),t("p",null,o(e(a).t("zones.form.universal.saveToken.saveTokenDescription")),1),n(),i(E,{id:"zone-kubernetes-token",class:"mt-4",code:p.value,language:"bash"},null,8,["code"]),n(),t("h3",null,[Be,n(" "+o(e(a).t("zones.form.universal.connectZone.title")),1)]),n(),t("p",null,o(e(a).t("zones.form.universal.connectZone.configDescription")),1),n(),t("span",Ke,o(e(a).t("zones.form.universal.connectZone.configFileName")),1),n(),i(E,{id:"zone-universal-config-code-block",class:"mt-4",code:z.value,language:"yaml"},null,8,["code"]),n(),t("p",Ue,o(e(a).t("zones.form.universal.connectZone.connectDescription")),1),n(),i(E,{id:"zone-universal-connect-command-code-block",class:"mt-4",code:e(a).t("zones.form.universal.connectZone.connectCommand").trim(),language:"bash"},null,8,["code"])]))}});const xe=j(Fe,[["__scopeId","data-v-499fdb93"]]),Oe={class:"form-wrapper"},Re={class:"form"},Pe={class:"form-title"},Xe={class:"form-section"},Me={class:"form-section__header"},Ge={class:"form-section-title"},He={class:"form-section__content"},We={class:"form-section","data-testid":"connect-zone-instructions"},je={class:"form-section__header"},Je={class:"form-section-title"},Qe={class:"form-section__content"},Ye={class:"k-input-label"},en={class:"radio-button-group"},nn={class:"mt-4"},tn={class:"k-input-label"},on={class:"radio-button-group"},sn={class:"mt-4"},an={class:"k-input-label"},rn={class:"radio-button-group"},ln={class:"form-section"},cn={class:"form-section__header"},un={class:"form-section-title"},dn={class:"form-section__content"},mn={class:"form-section"},pn={class:"form-section__header"},vn={class:"form-section-title"},fn={class:"form-section__content"},_n={class:"mt-2"},kn=q({__name:"ZoneCreateView",setup(u){const{t:s}=x(),a=ue(),k=de(),b=/^(?![-0-9])[a-z0-9-]{1,63}$/,p=m(null),z=m(!1),f=m(!1),d=m({error:null,title:null,icon:"warning",badgeAppearance:"warning"}),g=m(null),$=m(!1),A=m(null),_=m(""),I=m("kubernetes"),D=m(!0),L=m(!0),N=C(()=>p.value!==null&&p.value.token?p.value.token:""),Y=C(()=>N.value!==""?window.btoa(N.value):""),ee=C(()=>_.value===""||z.value||p.value!==null),B=C(()=>{if(g.value!==null)return g.value;if(d.value.error instanceof T){const r=d.value.error.invalidParameters.find(c=>c.field==="name");if(r!==void 0)return r.reason}return null});async function ne(){z.value=!0,d.value={error:null,title:null,icon:"warning",badgeAppearance:"warning"};try{if(!O(_.value))return;p.value=await a.createZone({name:_.value})}catch(r){r instanceof T&&[409,500].includes(r.status)?d.value={error:r,title:s(`zones.create.statusError.${r.status}.title`,{zoneName:_.value}),description:s(`zones.create.statusError.${r.status}.description`).trim(),icon:r.status===500?"warning":"errorFilled",badgeAppearance:r.status===500?"warning":"danger"}:r instanceof Error?d.value={error:r,title:r instanceof T?r.title:s("zones.create.generalError.title"),description:r instanceof T&&r.detail?r.detail:void 0,icon:"errorFilled",badgeAppearance:"danger"}:console.error(r)}finally{z.value=!1}}function O(r){const c=b.test(r);return c?g.value=null:g.value=s("zones.create.invalidNameError"),c}async function te(){$.value=!1,A.value=null;try{const r=await a.getZoneOverview({name:_.value}),c=ke(r.zoneInsight);$.value=c==="online"}catch(r){r instanceof Error?A.value=r:console.error(r)}}function R(){f.value=!f.value}return(r,c)=>{const oe=me("KCard");return v(),y(he,{attrs:{class:"is-fullscreen"}},{default:l(()=>[i(pe,{fullscreen:!0,breadcrumbs:[]},{title:l(()=>[t("h1",null,[i(ve,{title:e(s)("zones.routes.create.title"),render:!0},null,8,["title"])])]),actions:l(()=>[N.value===""||$.value?(v(),y(e(S),{key:0,appearance:"outline","data-testid":"exit-button",to:{name:"zone-cp-list-view"}},{default:l(()=>[n(o(e(s)("zones.form.exit")),1)]),_:1})):(v(),y(e(S),{key:1,appearance:"outline","data-testid":"exit-button",onClick:R},{default:l(()=>[n(o(e(s)("zones.form.exit")),1)]),_:1}))]),default:l(()=>[n(),n(),t("div",Oe,[i(oe,null,{body:l(()=>[t("div",Re,[t("div",null,[t("h1",Pe,o(e(s)("zones.routes.create.title")),1)]),n(),t("div",Xe,[t("div",Me,[t("h2",Ge,o(e(s)("zones.form.section.name.title")),1)]),n(),t("div",He,[t("div",null,[i(e(fe),{for:"zone-name",required:"","tooltip-attributes":{placement:"right"}},{tooltip:l(()=>[n(o(e(s)("zones.form.name_tooltip")),1)]),default:l(()=>[n(o(e(s)("zones.form.nameLabel"))+" ",1)]),_:1}),n(),i(e(_e),{id:"zone-name",modelValue:_.value,"onUpdate:modelValue":c[0]||(c[0]=h=>_.value=h),type:"text",name:"zone-name","data-testid":"name-input","data-test-error-type":B.value!==null?"invalid-dns-name":void 0,"has-error":B.value!==null,"error-message":B.value??void 0,disabled:p.value!==null,onBlur:c[1]||(c[1]=h=>O(_.value))},null,8,["modelValue","data-test-error-type","has-error","error-message","disabled"])]),n(),i(e(S),{appearance:"primary",class:"mt-4",icon:z.value?"spinner":"plus",disabled:ee.value,"data-testid":"create-zone-button",onClick:ne},{default:l(()=>[n(o(e(s)("zones.form.createZoneButtonLabel")),1)]),_:1},8,["icon","disabled"]),n(),d.value.error!==null?(v(),y(be,{key:0,class:"mt-4",error:d.value.error,"badge-appearance":d.value.badgeAppearance,icon:d.value.icon,"data-testid":"create-zone-error"},ze({default:l(()=>[t("p",null,o(d.value.title),1),n()]),_:2},[d.value.description?{name:"message",fn:l(()=>[t("p",null,o(d.value.description),1)]),key:"0"}:void 0]),1032,["error","badge-appearance","icon"])):F("",!0)])]),n(),p.value!==null?(v(),Z(P,{key:0},[t("div",We,[t("div",je,[t("h2",Je,o(e(s)("zones.form.section.configuration.title")),1)]),n(),t("div",Qe,[t("div",null,[t("span",Ye,o(e(s)("zones.form.environmentLabel"))+` *
                      `,1),n(),t("div",en,[i(e(X),{id:"zone-environment-universal",modelValue:I.value,"onUpdate:modelValue":c[2]||(c[2]=h=>I.value=h),"selected-value":"universal",name:"zone-environment","data-testid":"environment-universal-radio-button"},{default:l(()=>[n(o(e(s)("zones.form.universalLabel")),1)]),_:1},8,["modelValue"]),n(),i(e(X),{id:"zone-environment-kubernetes",modelValue:I.value,"onUpdate:modelValue":c[3]||(c[3]=h=>I.value=h),"selected-value":"kubernetes",name:"zone-environment","data-testid":"environment-kubernetes-radio-button"},{default:l(()=>[n(o(e(s)("zones.form.kubernetesLabel")),1)]),_:1},8,["modelValue"])])]),n(),I.value==="kubernetes"?(v(),Z(P,{key:0},[t("div",nn,[t("span",tn,o(e(s)("zones.form.zoneIngressLabel"))+` *
                        `,1),n(),t("div",on,[i(e(M),{id:"zone-ingress-enabled",modelValue:D.value,"onUpdate:modelValue":c[4]||(c[4]=h=>D.value=h),"data-testid":"ingress-input-switch"},{label:l(()=>[n(o(e(s)("zones.form.zoneIngressEnabledLabel")),1)]),_:1},8,["modelValue"])])]),n(),t("div",sn,[t("span",an,o(e(s)("zones.form.zoneEgressLabel"))+` *
                        `,1),n(),t("div",rn,[i(e(M),{id:"zone-egress-enabled",modelValue:L.value,"onUpdate:modelValue":c[5]||(c[5]=h=>L.value=h),"data-testid":"egress-input-switch"},{label:l(()=>[n(o(e(s)("zones.form.zoneEgressEnabledLabel")),1)]),_:1},8,["modelValue"])])])],64)):F("",!0)])]),n(),t("div",ln,[t("div",cn,[t("h2",un,o(e(s)("zones.form.section.connect_zone.title")),1)]),n(),t("div",dn,[I.value==="universal"?(v(),y(xe,{key:0,"zone-name":_.value,token:N.value},null,8,["zone-name","token"])):(v(),y(De,{key:1,"zone-name":_.value,"zone-ingress-enabled":D.value,"zone-egress-enabled":L.value,token:N.value,"base64-encoded-token":Y.value},null,8,["zone-name","zone-ingress-enabled","zone-egress-enabled","token","base64-encoded-token"]))])]),n(),t("div",mn,[t("div",pn,[t("h2",vn,o(e(s)("zones.form.section.scanner.title")),1)]),n(),t("div",fn,[i(Ie,{"loader-function":te,"has-error":A.value!==null,"can-complete":$.value,"data-testid":"zone-connected-scanner"},{"loading-title":l(()=>[n(o(e(s)("zones.form.scan.waitTitle")),1)]),"complete-title":l(()=>[n(o(e(s)("zones.form.scan.completeTitle")),1)]),"complete-content":l(()=>[t("p",null,o(e(s)("zones.form.scan.completeDescription",{name:_.value})),1),n(),t("p",_n,[i(e(S),{appearance:"primary",to:{name:"zone-cp-detail-view",params:{zone:_.value}}},{default:l(()=>[n(o(e(s)("zones.form.scan.completeButtonLabel",{name:_.value})),1)]),_:1},8,["to"])])]),"error-title":l(()=>[t("h3",null,o(e(s)("zones.form.scan.errorTitle")),1)]),"error-content":l(()=>[t("p",null,o(e(s)("zones.form.scan.errorDescription")),1)]),_:1},8,["has-error","can-complete"])])])],64)):F("",!0)])]),_:1})]),n(),i(e(ge),{"is-visible":f.value,title:e(s)("zones.form.confirm_modal.title"),"data-testid":"confirm-exit-modal",onCanceled:R,onProceed:c[6]||(c[6]=h=>e(k).push({name:"zone-cp-list-view"}))},{"header-content":l(()=>[n(o(e(s)("zones.form.confirm_modal.title")),1)]),"body-content":l(()=>[n(o(e(s)("zones.form.confirm_modal.body")),1)]),"action-buttons":l(()=>[i(e(S),{appearance:"primary",to:{name:"zone-cp-list-view"},"data-testid":"confirm-exit-button"},{default:l(()=>[n(o(e(s)("zones.form.confirm_modal.action_button")),1)]),_:1})]),_:1},8,["is-visible","title"])]),_:1})]),_:1})}}});export{kn as default};
