import{z as x,O as T}from"./kongponents.es-53a4347c.js";import{d as O,c as d,v as S,o as n,j as c,g as o,h as r,u as G,r as C,K as H,L as E,x as J,w as l,e as k,b as h,f as B,i as N,F as p,q as V,t as v}from"./index-fa1a400c.js";import{D as w}from"./DoughnutChart-ed9df5ef.js";import{u as A}from"./store-22740457.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import{a as P,D as I}from"./DefinitionListItem-23ac0034.js";import{M as Q}from"./MeshResources-a64bf0ca.js";import{_ as U}from"./StatusInfo.vue_vue_type_script_setup_true_lang-ff20f7d8.js";import{_ as W}from"./YamlView.vue_vue_type_script_setup_true_lang-67ae7284.js";import{u as X}from"./index-db71a729.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-cb6548a2.js";import"./ErrorBlock-edd2692f.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-8987be1d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-53c4f049.js";import"./toYaml-4e00099e.js";const Y={class:"chart-box-list"},Z=O({__name:"MeshCharts",setup(R){const i=A(),f=d(()=>i.getters.getChart("services",{title:"Services",showTotal:!0})),_=d(()=>i.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),g=d(()=>i.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),y=d(()=>i.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));S(()=>i.state.selectedMesh,function(){t()}),t();function t(){i.dispatch("fetchMeshInsights",i.state.selectedMesh),i.dispatch("fetchServices",i.state.selectedMesh)}return(b,M)=>(n(),c("div",Y,[o(w,{data:f.value},null,8,["data"]),r(),o(w,{data:_.value},null,8,["data"]),r(),o(w,{data:g.value},null,8,["data"]),r(),o(w,{data:y.value},null,8,["data"])]))}});const ee=K(Z,[["__scopeId","data-v-7d682009"]]),te={class:"kcard-stack"},ae={class:"columns"},se={key:0},ne=O({__name:"MeshOverviewView",setup(R){const i=X(),f=G(),_=A(),g=C(!0),y=C(!1),t=C(null),b=C(null),M=d(()=>t.value!==null?H(t.value):null),z=d(()=>{if(t.value===null)return null;const{name:a,type:s,creationTime:m,modificationTime:e}=t.value;return{name:a,type:s,created:E(m),modified:E(e),"Data Plane Proxies":_.state.meshInsight.dataplanes.total}}),F=d(()=>{var $;if(t.value===null)return null;const a=D(t.value,"mtls"),s=D(t.value,"logging"),m=D(t.value,"metrics"),e=D(t.value,"tracing"),u=!!(($=t.value.routing)!=null&&$.localityAwareLoadBalancing);return{mtls:a,logging:s,metrics:m,tracing:e,localityAwareLoadBalancing:u}}),j=d(()=>_.state.sidebar.insights.mesh.policies.total),q=d(()=>_.state.policyTypes.map(a=>{var s;return{...a,length:((s=_.state.meshInsight.policies[a.name])==null?void 0:s.total)??0}}));S(()=>f.params.mesh,function(){f.name==="single-mesh-overview"&&L()}),L();async function L(){g.value=!0,y.value=!1;const a=f.params.mesh;try{t.value=await i.getMesh({name:a}),b.value=await i.getMeshInsights({name:a})}catch(s){y.value=!0,t.value=null,b.value=null,console.error(s)}finally{g.value=!1}}function D(a,s){if(a===null||a[s]===void 0)return!1;const m=a[s].enabledBackend??a[s].defaultBackend??a[s].backends[0].name,e=a[s].backends.find(u=>u.name===m);return`${e.type} / ${e.name}`}return(a,s)=>{const m=J("router-link");return n(),c("div",te,[o(k(x),null,{body:l(()=>[o(ee)]),_:1}),r(),t.value!==null?(n(),h(k(x),{key:0},{body:l(()=>[N("div",ae,[o(U,{"is-loading":g.value,"has-error":y.value,"is-empty":t.value===null||b.value===null},{default:l(()=>[o(P,null,{default:l(()=>[(n(!0),c(p,null,V(z.value,(e,u)=>(n(),h(I,{key:u,term:u},{default:l(()=>[typeof e=="boolean"?(n(),h(k(T),{key:0,appearance:e?"success":"danger"},{default:l(()=>[r(v(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(n(),c(p,{key:1},[r(v(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1})]),_:1},8,["is-loading","has-error","is-empty"]),r(),o(P,null,{default:l(()=>[(n(!0),c(p,null,V(F.value,(e,u)=>(n(),h(I,{key:u,term:u},{default:l(()=>[typeof e=="boolean"?(n(),h(k(T),{key:0,appearance:e?"success":"danger"},{default:l(()=>[r(v(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(n(),c(p,{key:1},[r(v(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),r(),o(P,null,{default:l(()=>[o(I,{term:`Policies (${j.value})`},{default:l(()=>[N("ul",null,[(n(!0),c(p,null,V(q.value,(e,u)=>(n(),c(p,{key:u},[e.length!==0?(n(),c("li",se,[o(m,{to:{name:"policy-list-view",params:{policyPath:e.path}}},{default:l(()=>[r(v(e.name)+": "+v(e.length),1)]),_:2},1032,["to"])])):B("",!0)],64))),128))])]),_:1},8,["term"])]),_:1})])]),_:1})):B("",!0),r(),M.value!==null?(n(),h(k(x),{key:1},{body:l(()=>[o(W,{id:"code-block-mesh",content:M.value},null,8,["content"])]),_:1})):B("",!0),r(),o(Q)])}}});const ke=K(ne,[["__scopeId","data-v-4d430812"]]);export{ke as default};
