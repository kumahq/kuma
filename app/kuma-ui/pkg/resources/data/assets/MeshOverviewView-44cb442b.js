import{z as x,O}from"./kongponents.es-530aee3b.js";import{d as N,c as d,v as S,o as n,j as c,g as o,h as r,u as G,r as C,G as H,O as T,x as J,w as l,e as k,b as h,i as E,F as p,q as B,t as v,f as V}from"./index-55dfb012.js";import{D as w}from"./DoughnutChart-da6fb9aa.js";import{u as A}from"./store-6dad65ea.js";import{_ as R}from"./_plugin-vue_export-helper-c27b6911.js";import{D as P,a as I}from"./DefinitionListItem-60570771.js";import{M as Q}from"./MeshResources-78fe5f7a.js";import{_ as U}from"./StatusInfo.vue_vue_type_script_setup_true_lang-8681ebe5.js";import{_ as W}from"./YamlView.vue_vue_type_script_setup_true_lang-94c7ae8c.js";import{u as X}from"./index-c456a9ae.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-4748827a.js";import"./ErrorBlock-4c3026f3.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-6f8d6e1a.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-38a90cfd.js";import"./toYaml-4e00099e.js";const Y={class:"chart-box-list"},Z=N({__name:"MeshCharts",setup(z){const i=A(),f=d(()=>i.getters.getChart("services",{title:"Services",showTotal:!0})),_=d(()=>i.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),g=d(()=>i.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),y=d(()=>i.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));S(()=>i.state.selectedMesh,function(){t()}),t();function t(){i.dispatch("fetchMeshInsights",i.state.selectedMesh),i.dispatch("fetchServices",i.state.selectedMesh)}return(b,M)=>(n(),c("div",Y,[o(w,{data:f.value},null,8,["data"]),r(),o(w,{data:_.value},null,8,["data"]),r(),o(w,{data:g.value},null,8,["data"]),r(),o(w,{data:y.value},null,8,["data"])]))}});const ee=R(Z,[["__scopeId","data-v-64d72032"]]),te={class:"kcard-stack"},ae={class:"columns"},se={key:0},ne=N({__name:"MeshOverviewView",setup(z){const i=X(),f=G(),_=A(),g=C(!0),y=C(!1),t=C(null),b=C(null),M=d(()=>t.value!==null?H(t.value):null),F=d(()=>{if(t.value===null)return null;const{name:a,type:s,creationTime:m,modificationTime:e}=t.value;return{name:a,type:s,created:T(m),modified:T(e),"Data Plane Proxies":_.state.meshInsight.dataplanes.total}}),K=d(()=>{var L;if(t.value===null)return null;const a=D(t.value,"mtls"),s=D(t.value,"logging"),m=D(t.value,"metrics"),e=D(t.value,"tracing"),u=!!((L=t.value.routing)!=null&&L.localityAwareLoadBalancing);return{mtls:a,logging:s,metrics:m,tracing:e,localityAwareLoadBalancing:u}}),j=d(()=>_.state.sidebar.insights.mesh.policies.total),q=d(()=>_.state.policyTypes.map(a=>{var s;return{...a,length:((s=_.state.meshInsight.policies[a.name])==null?void 0:s.total)??0}}));S(()=>f.params.mesh,function(){f.name==="single-mesh-overview"&&$()}),$();async function $(){g.value=!0,y.value=!1;const a=f.params.mesh;try{t.value=await i.getMesh({name:a}),b.value=await i.getMeshInsights({name:a})}catch(s){y.value=!0,t.value=null,b.value=null,console.error(s)}finally{g.value=!1}}function D(a,s){if(a===null||a[s]===void 0)return!1;const m=a[s].enabledBackend??a[s].defaultBackend??a[s].backends[0].name,e=a[s].backends.find(u=>u.name===m);return`${e.type} / ${e.name}`}return(a,s)=>{const m=J("router-link");return n(),c("div",te,[o(k(x),null,{body:l(()=>[o(ee)]),_:1}),r(),t.value!==null?(n(),h(k(x),{key:0},{body:l(()=>[E("div",ae,[o(U,{"is-loading":g.value,"has-error":y.value,"is-empty":t.value===null||b.value===null},{default:l(()=>[o(P,null,{default:l(()=>[(n(!0),c(p,null,B(F.value,(e,u)=>(n(),h(I,{key:u,term:u},{default:l(()=>[typeof e=="boolean"?(n(),h(k(O),{key:0,appearance:e?"success":"danger"},{default:l(()=>[r(v(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(n(),c(p,{key:1},[r(v(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1})]),_:1},8,["is-loading","has-error","is-empty"]),r(),o(P,null,{default:l(()=>[(n(!0),c(p,null,B(K.value,(e,u)=>(n(),h(I,{key:u,term:u},{default:l(()=>[typeof e=="boolean"?(n(),h(k(O),{key:0,appearance:e?"success":"danger"},{default:l(()=>[r(v(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(n(),c(p,{key:1},[r(v(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),r(),o(P,null,{default:l(()=>[o(I,{term:`Policies (${j.value})`},{default:l(()=>[E("ul",null,[(n(!0),c(p,null,B(q.value,(e,u)=>(n(),c(p,{key:u},[e.length!==0?(n(),c("li",se,[o(m,{to:{name:"policies-list-view",params:{policyPath:e.path}}},{default:l(()=>[r(v(e.name)+": "+v(e.length),1)]),_:2},1032,["to"])])):V("",!0)],64))),128))])]),_:1},8,["term"])]),_:1})])]),_:1})):V("",!0),r(),M.value!==null?(n(),h(k(x),{key:1},{body:l(()=>[o(W,{id:"code-block-mesh",content:M.value},null,8,["content"])]),_:1})):V("",!0),r(),o(Q)])}}});const ke=R(ne,[["__scopeId","data-v-72681139"]]);export{ke as default};
