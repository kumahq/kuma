import{Z as X,t as ee,_ as te}from"./kongponents.es-af129dfe.js";import{d as K,r as n,o as u,b as k,w as g,A as $,h as v,e as a,f as R,u as ae,v as ne,a3 as oe,a4 as U,R as se,j as A,i as D,g as M,z as re,M as Y,t as O}from"./index-a4fb3e6d.js";import{_ as le}from"./MultizoneInfo.vue_vue_type_script_setup_true_lang-5a44e9f2.js";import{_ as ie}from"./ZoneDetails.vue_vue_type_script_setup_true_lang-7a6b8f4e.js";import{D as ue}from"./DataOverview-7d1ed9da.js";import{u as ce}from"./store-a62ac939.js";import{a as de,b as me,u as pe}from"./index-7848fac5.js";import{Q as V}from"./QueryParameter-70743f73.js";import"./AccordionList-afe49a57.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-ef11f61a.js";import"./DefinitionListItem-cc432e9e.js";import"./SubscriptionHeader.vue_vue_type_script_setup_true_lang-1cc853a4.js";import"./TabsWidget-d501eaef.js";import"./ErrorBlock-984fd14e.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-aae7801c.js";import"./datadogLogEvents-302eea7b.js";import"./TextWithCopyButton-f986f099.js";import"./WarningsWidget.vue_vue_type_script_setup_true_lang-449091f8.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-ea440da3.js";import"./TagList-f3ae04ef.js";import"./StatusBadge-2f069eb3.js";const fe=K({__name:"DeleteResourceModal",props:{actionButtonText:{type:String,required:!1,default:"Yes, delete"},confirmationText:{type:String,required:!1,default:""},deleteFunction:{type:Function,required:!0},isVisible:{type:Boolean,required:!0},modalId:{type:String,required:!0},title:{type:String,required:!1,default:"Delete"}},emits:["cancel","delete"],setup(x,{emit:c}){const s=x,r=n(!1);async function l(){r.value=!1;try{await s.deleteFunction(),c("delete")}catch(d){console.error(d),r.value=!0}}return(d,b)=>(u(),k(a(ee),{"action-button-text":s.actionButtonText,"confirmation-text":s.confirmationText,"is-visible":s.isVisible,"modal-id":s.modalId,title:s.title,type:"danger",onCanceled:b[0]||(b[0]=S=>c("cancel")),onProceed:l},{"body-content":g(()=>[$(d.$slots,"body-content"),v(),r.value?(u(),k(a(X),{key:0,class:"mt-4",appearance:"danger","is-dismissible":""},{alertMessage:g(()=>[$(d.$slots,"error")]),_:3})):R("",!0)]),_:3},8,["action-button-text","confirmation-text","is-visible","modal-id","title"]))}}),ve={class:"zones"},ge={key:1,class:"kcard-stack"},be={class:"kcard-border"},ye={key:0,class:"kcard-border"},Fe=K({__name:"ZoneListView",props:{selectedZoneName:{type:[String,null],required:!1,default:null},offset:{type:Number,required:!1,default:0}},setup(x){const c=x,s=de(),r=me(),l=pe(),d={title:"No Data",message:"There are no Zones present."},b=ae(),S=ce(),E=n(!0),y=n(!1),T=n(""),C=n(null),m=n({headers:[{label:"Status",key:"status"},{label:"Name",key:"entity"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Storage type",key:"storeType"},{label:"Ingress",key:"hasIngress"},{label:"Egress",key:"hasEgress"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Actions",key:"actions",hideLabel:!0}],data:[]}),p=n(null),q=n(null),B=n(c.offset),N=n(new Set),Z=n(new Set);ne(()=>b.params.mesh,function(){b.name==="zone-list-view"&&L(0)}),oe(function(){L(c.offset)});function L(e){S.getters["config/getMulticlusterStatus"]&&F(e)}async function F(e){var o;B.value=e,V.set("offset",e>0?e:null),E.value=!0,C.value=null;const t=Y;try{const[{items:i,next:_},{items:h},{items:z}]=await Promise.all([l.getAllZoneOverviews({size:t,offset:e}),U(l.getAllZoneIngressOverviews.bind(l)),U(l.getAllZoneEgressOverviews.bind(l))]);q.value=_,m.value.data=G(i??[]),N.value=new Set(h.map(w=>w.zoneIngress.zone)),Z.value=new Set(z.map(w=>w.zoneEgress.zone)),await P({name:c.selectedZoneName??((o=m.value.data[0])==null?void 0:o.entity.name)})}catch(i){m.value.data=[],p.value=null,N.value=new Set,Z.value=new Set,i instanceof Error?C.value=i:console.error(i)}finally{E.value=!1}}function G(e){return e.map(t=>{var W;const{name:o}=t,i={name:"zone-detail-view",params:{zone:o}};let _="-",h="",z=!0;(((W=t.zoneInsight)==null?void 0:W.subscriptions)??[]).forEach(f=>{if(f.version&&f.version.kumaCp){_=f.version.kumaCp.version;const{kumaCpGlobalCompatible:H=!0}=f.version.kumaCp;z=H,f.config&&(h=JSON.parse(f.config).store.type)}});const J=se(t.zoneInsight);return{entity:t,detailViewRoute:i,status:J,zoneCpVersion:_,storeType:h,hasIngress:N.value.has(t.name)?"Yes":"No",hasEgress:Z.value.has(t.name)?"Yes":"No",withWarnings:!z}})}async function P({name:e}){if(e===void 0){p.value=null,V.set("zone",null);return}try{p.value=await l.getZoneOverview({name:e}),V.set("zone",e)}catch(t){console.error(t)}}async function Q(){await l.deleteZone({name:T.value})}function I(e){var o;const t=((o=e==null?void 0:e.entity)==null?void 0:o.name)??(e==null?void 0:e.name)??"";y.value=!y.value,T.value=t}function j(){I()}return(e,t)=>{var o;return u(),A("div",ve,[a(S).getters["config/getMulticlusterStatus"]===!1?(u(),k(le,{key:0})):(u(),A("div",ge,[D("div",be,[M(ue,{"selected-entity-name":(o=p.value)==null?void 0:o.name,"page-size":a(Y),"is-loading":E.value,error:C.value,"empty-state":d,"table-data":m.value,"table-data-is-empty":m.value.data.length===0,"show-warnings":m.value.data.some(i=>i.withWarnings),next:q.value,"page-offset":B.value,"show-delete-action":a(s)("KUMA_ZONE_CREATION_FLOW")==="enabled",onDeleteResource:I,onTableAction:P,onLoadData:F},re({_:2},[a(s)("KUMA_ZONE_CREATION_FLOW")==="enabled"?{name:"additionalControls",fn:g(()=>[M(a(te),{appearance:"creation",icon:"plus",to:{name:"zone-create-view"}},{default:g(()=>[v(`
              Create Zone
            `)]),_:1})]),key:"0"}:void 0]),1032,["selected-entity-name","page-size","is-loading","error","table-data","table-data-is-empty","show-warnings","next","page-offset","show-delete-action"])]),v(),p.value!==null?(u(),A("div",ye,[M(ie,{"zone-overview":p.value},null,8,["zone-overview"])])):R("",!0)])),v(),y.value?(u(),k(fe,{key:2,"confirmation-text":T.value,"delete-function":Q,"is-visible":y.value,"modal-id":"delete-zone-modal","action-button-text":a(r).t("zones.delete.confirmModal.proceedText"),title:a(r).t("zones.delete.confirmModal.title"),onCancel:I,onDelete:j},{"body-content":g(()=>[D("p",null,O(a(r).t("zones.delete.confirmModal.text1")),1),v(),D("p",null,O(a(r).t("zones.delete.confirmModal.text2")),1)]),error:g(()=>[v(O(a(r).t("zones.delete.confirmModal.errorText")),1)]),_:1},8,["confirmation-text","is-visible","action-button-text","title"])):R("",!0)])}}});export{Fe as default};
