import{d as lt,a3 as ut,a8 as mt,r as _,p as u,o as s,w as t,b as e,m as w,F as Q,aq as yt,a4 as _t,c,e as n,N as v,L as x,q as C,O as b,T as ft,l as h,t as p,M as ct,y as bt,_ as vt}from"./index-GFWvH1vH.js";import{S as kt}from"./SummaryView-IpLItP5N.js";import{T as gt}from"./TagList-CQ7OYedf.js";import{C as U,a as W,b as Y}from"./ConnectionTraffic--36wr69E.js";import{C as Z}from"./kri-D19gROKk.js";const xt=lt({__name:"DataPlaneDetailView",props:{data:{},mesh:{}},setup(P){const V=ut(),o=P;return mt("data-plane-overview",o.data),(wt,a)=>{const z=_("XI18n"),L=_("XNotification"),N=_("XIcon"),S=_("DataCollection"),m=_("XLayout"),X=_("XAction"),k=_("XBadge"),tt=_("XCopyButton"),et=_("XAboutCard"),$=_("XEmptyState"),at=_("XCard"),nt=_("RouterView"),ot=_("AppView"),st=_("DataLoader"),T=_("DataSource"),rt=_("RouteView");return s(),u(rt,{params:{inactive:Boolean,mesh:"",proxy:"",proxyType:"",subscription:""},name:"data-plane-detail-view"},{default:t(({route:l,t:d,can:B,uri:R})=>[e(T,{src:R(w(Q),"/meshes/:mesh/dataplanes/:name/policies/for/proxy",{mesh:l.params.mesh,name:l.params.proxy})},{default:t(({data:g})=>[e(T,{src:R(w(yt),"/meshes/:mesh/dataplanes/:name/layout",{mesh:l.params.mesh,name:l.params.proxy})},{default:t(({data:y,refresh:it,error:pt})=>[e(T,{src:R(w(Q),"/policy-types",{})},{default:t(({data:A})=>[e(T,{src:R(w(_t),"/connections/stats/for/:proxyType/:name/:mesh/:socketAddress",{proxyType:{ingresses:"zone-ingress",egresses:"zone-egress"}[l.params.proxyType]??"dataplane",name:l.params.proxy,mesh:l.params.mesh||"*",socketAddress:"self_inbound"})},{default:t(({data:D,refresh:dt})=>[e(st,{data:[y,g,A,D]},{default:t(()=>[e(ot,{notifications:!0},{default:t(()=>{var E,q,O,j,F,G,K,M,H,J;return[(s(!0),c(v,null,x([{bool:((q=(E=o.data.dataplaneInsight.version)==null?void 0:E.kumaDp)==null?void 0:q.kumaCpCompatible)===!1,key:"dp-cp-incompatible",params:{kumaDp:((O=o.data.dataplaneInsight.version)==null?void 0:O.kumaDp.version)??""}},{bool:((F=(j=o.data.dataplaneInsight.version)==null?void 0:j.envoy)==null?void 0:F.kumaDpCompatible)===!1,key:"envoy-dp-incompatible",params:{envoy:((G=o.data.dataplaneInsight.version)==null?void 0:G.envoy.version)??"",kumaDp:((K=o.data.dataplaneInsight.version)==null?void 0:K.kumaDp.version)??""}},{bool:!!(B("use zones")&&o.data.zone&&((H=(M=o.data.dataplaneInsight.version)==null?void 0:M.kumaDp)==null?void 0:H.kumaCpCompatible)===!1),key:"dp-zone-cp-incompatible",params:{kumaDp:((J=o.data.dataplaneInsight.version)==null?void 0:J.kumaDp.version)??""}},{bool:o.data.isCertExpiresSoon,key:"certificate-expires-soon"},{bool:o.data.isCertExpired,key:"certificate-expired"},{bool:!o.data.dataplaneInsight.mTLS,key:"no-mtls"},{bool:!B("use transparent-proxying",o.data),key:"networking-transparent-proxying",variant:"info"}],({bool:i,key:r,params:f,variant:I})=>(s(),u(L,{key:r,notify:i,"data-testid":`warning-${r}`,uri:`data-planes.notifications.${r}.${o.data.id}`,variant:I},{default:t(()=>[e(z,{path:`data-planes.notifications.${r}`,params:Object.fromEntries(Object.entries(f??{}))},null,8,["path","params"])]),_:2},1032,["notify","data-testid","uri","variant"]))),128)),a[45]||(a[45]=n()),e(m,{type:"stack","data-testid":"dataplane-details"},{default:t(()=>[e(et,{title:d("data-planes.routes.item.about.title"),created:o.data.creationTime,modified:o.data.modificationTime,class:"about-section"},{default:t(()=>[e(m,null,{default:t(()=>[e(m,{type:"separated"},{default:t(()=>[e(b,{layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.status")),1)]),body:t(()=>[e(m,{type:"separated"},{default:t(()=>[e(ft,{status:o.data.status},null,8,["status"]),a[0]||(a[0]=n()),o.data.dataplaneType==="standard"?(s(),u(S,{key:0,items:o.data.dataplane.networking.inbounds,predicate:i=>i.state!=="Ready",empty:!1},{default:t(({items:i})=>[e(N,{name:"info"},{default:t(()=>[h("ul",null,[(s(!0),c(v,null,x(i,r=>(s(),c("li",{key:`${r.service}:${r.port}`},p(d("data-planes.routes.item.unhealthy_inbound",{service:r.service,port:r.port})),1))),128))])]),_:2},1024)]),_:2},1032,["items","predicate"])):C("",!0)]),_:2,__:[0]},1024)]),_:2,__:[1]},1024),a[7]||(a[7]=n()),B("use zones")&&o.data.zone?(s(),u(b,{key:0,layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.zone")),1)]),body:t(()=>[e(k,{appearance:"decorative"},{default:t(()=>[e(X,{to:{name:"zone-cp-detail-view",params:{zone:o.data.zone}}},{default:t(()=>[n(p(o.data.zone),1)]),_:1},8,["to"])]),_:1})]),_:2,__:[2]},1024)):C("",!0),a[8]||(a[8]=n()),e(b,{layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.type")),1)]),body:t(()=>[e(k,{appearance:"decorative"},{default:t(()=>[n(p(d(`data-planes.type.${o.data.dataplaneType}`)),1)]),_:2},1024)]),_:2,__:[3]},1024),a[9]||(a[9]=n()),o.data.namespace.length>0?(s(),u(b,{key:1,layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.namespace")),1)]),body:t(()=>[e(k,{appearance:"decorative"},{default:t(()=>[n(p(o.data.namespace),1)]),_:1})]),_:2,__:[4]},1024)):C("",!0),a[10]||(a[10]=n()),e(b,{layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.address")),1)]),body:t(()=>[e(tt,{variant:"badge",format:"default",text:`${o.data.dataplane.networking.address}`},null,8,["text"])]),_:2,__:[5]},1024),a[11]||(a[11]=n()),o.data.dataplane.networking.gateway?(s(),u(b,{key:2,layout:"horizontal"},{title:t(()=>[n(p(d("http.api.property.tags")),1)]),body:t(()=>[e(gt,{tags:o.data.dataplane.networking.gateway.tags},null,8,["tags"])]),_:2,__:[6]},1024)):C("",!0)]),_:2,__:[7,8,9,10,11]},1024),a[30]||(a[30]=n()),o.data.dataplaneInsight.mTLS?(s(),u(m,{key:0,"data-testid":"dataplane-mtls",class:"about-subsection",size:"small"},{default:t(()=>[h("h3",null,p(d("data-planes.routes.item.mtls.title")),1),a[21]||(a[21]=n()),e(m,{size:"small"},{default:t(()=>[(s(!0),c(v,null,x([o.data.dataplaneInsight.mTLS],i=>(s(),c(v,{key:i},[e(m,{type:"separated"},{default:t(()=>[e(b,{layout:"horizontal"},{title:t(()=>[e(z,{path:"data-planes.routes.item.mtls.generation_time.title"})]),body:t(()=>[e(k,{appearance:"neutral"},{default:t(()=>[n(p(d("common.formats.datetime",{value:Date.parse(i.lastCertificateRegeneration)})),1)]),_:2},1024)]),_:2,__:[12]},1024),a[14]||(a[14]=n()),e(b,{layout:"horizontal"},{title:t(()=>[e(z,{path:"data-planes.routes.item.mtls.expiration_time.title"})]),body:t(()=>[e(k,{appearance:"neutral"},{default:t(()=>[n(p(d("common.formats.datetime",{value:Date.parse(i.certificateExpirationTime)})),1)]),_:2},1024)]),_:2,__:[13]},1024)]),_:2,__:[14]},1024),a[20]||(a[20]=n()),e(m,{type:"separated"},{default:t(()=>[e(b,{layout:"horizontal"},{title:t(()=>[n(p(d("data-planes.routes.item.mtls.regenerations.title")),1)]),body:t(()=>[e(k,{appearance:"info"},{default:t(()=>[n(p(d("common.formats.integer",{value:i.certificateRegenerations})),1)]),_:2},1024)]),_:2,__:[15]},1024),a[18]||(a[18]=n()),e(b,{layout:"horizontal"},{title:t(()=>[n(p(d("data-planes.routes.item.mtls.issued_backend.title")),1)]),body:t(()=>[e(k,{appearance:"decorative"},{default:t(()=>[n(p(i.issuedBackend),1)]),_:2},1024)]),_:2,__:[16]},1024),a[19]||(a[19]=n()),e(b,{layout:"horizontal"},{title:t(()=>[n(p(d("data-planes.routes.item.mtls.supported_backends.title")),1)]),body:t(()=>[e(m,{type:"separated",truncate:""},{default:t(()=>[(s(!0),c(v,null,x(i.supportedBackends,r=>(s(),u(k,{key:r,appearance:r===i.issuedBackend?"decorative":"info"},{default:t(()=>[n(p(r),1)]),_:2},1032,["appearance"]))),128))]),_:2},1024)]),_:2,__:[17]},1024)]),_:2,__:[18,19]},1024)],64))),128))]),_:2},1024)]),_:2,__:[21]},1024)):C("",!0),a[31]||(a[31]=n()),o.data.dataplaneInsight.subscriptions.length>0?(s(),u(m,{key:1,"data-testid":"about-dataplane-subscriptions",class:"about-subsection"},{default:t(()=>[e(m,{type:"separated"},{default:t(()=>[h("h3",null,p(d("data-planes.routes.item.subscriptions.title")),1),a[22]||(a[22]=n()),e(X,{"data-action":"",appearance:"anchor",to:{name:"data-plane-subscriptions-summary-view",params:{mesh:l.params.mesh,proxy:l.params.proxy},query:{inactive:l.params.inactive}}},{default:t(()=>[n(`
                            (`+p(d("data-planes.routes.item.xds.show-details"))+`)
                          `,1)]),_:2},1032,["to"])]),_:2,__:[22]},1024),a[28]||(a[28]=n()),(s(!0),c(v,null,x([[...o.data.dataplaneInsight.subscriptions].reverse()],i=>(s(),u(m,{key:typeof i,type:"separated"},{default:t(()=>[(s(!0),c(v,null,x([i.find(r=>!r.disconnectTime)??i[0]],r=>(s(),c(v,{key:r.id},[!r.disconnectTime&&r.connectTime?(s(),c(v,{key:0},[e(b,{layout:"horizontal"},{title:t(()=>[e(z,{path:"data-planes.routes.item.xds.connected"})]),body:t(()=>[e(k,{appearance:"neutral"},{default:t(()=>[n(p(d("common.formats.datetime",{value:Date.parse(r.connectTime)})),1)]),_:2},1024)]),_:2,__:[23]},1024),a[26]||(a[26]=n()),e(b,{layout:"horizontal"},{title:t(()=>[e(z,{path:"data-planes.routes.item.xds.instance"})]),body:t(()=>[e(k,{appearance:"info"},{default:t(()=>[n(p(r.controlPlaneInstanceId),1)]),_:2},1024)]),_:2,__:[24]},1024),a[27]||(a[27]=n()),e(b,{layout:"horizontal"},{title:t(()=>[e(z,{path:"data-planes.routes.item.xds.version"})]),body:t(()=>[e(k,{appearance:"info"},{default:t(()=>{var f,I;return[n(p(((I=(f=r.version)==null?void 0:f.kumaDp)==null?void 0:I.version)??d("common.unknown")),1)]}),_:2},1024)]),_:2,__:[25]},1024)],64)):(s(),u(z,{key:1,path:"data-planes.routes.item.xds.disconnected"}))],64))),128))]),_:2},1024))),128))]),_:2,__:[28]},1024)):C("",!0),a[32]||(a[32]=n()),g!=null&&g.policies.length?(s(),u(m,{key:2,"data-testid":"about-dataplane-policies",class:"about-subsection"},{default:t(()=>[h("h3",null,p(d("data-planes.routes.item.policies")),1),a[29]||(a[29]=n()),e(m,{type:"separated"},{default:t(()=>[(s(!0),c(v,null,x(g==null?void 0:g.policies,i=>(s(),u(X,{key:i.kind,"data-action":"",appearance:"anchor",to:{name:"data-plane-policy-config-summary-view",params:{mesh:l.params.mesh,proxy:l.params.proxy,policy:i.kind.toLowerCase()}}},{default:t(()=>[e(k,null,{default:t(()=>[n(p(i.kind),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2,__:[29]},1024)):C("",!0)]),_:2,__:[30,31,32]},1024)]),_:2},1032,["title","created","modified"]),a[43]||(a[43]=n()),e(at,{class:"traffic","data-testid":"dataplane-traffic"},{default:t(()=>[e(m,{type:"columns"},{default:t(()=>[e(U,null,{title:t(()=>[e(m,{type:"separated"},{default:t(()=>[e(N,{name:"inbound"}),a[33]||(a[33]=n()),a[34]||(a[34]=h("span",null,"Inbounds",-1))]),_:1,__:[33,34]})]),default:t(()=>[a[36]||(a[36]=n()),(s(!0),c(v,null,x([(y==null?void 0:y.inbounds)??[]],i=>(s(),u(W,{key:typeof i,type:"inbound","data-testid":"dataplane-inbounds"},{default:t(()=>[e(S,{type:"inbounds",items:i,predicate:r=>r.port!==49151},ct({default:t(({items:r})=>[e(m,{type:"stack",size:"small"},{default:t(()=>[(s(!0),c(v,null,x(r,f=>(s(),u(Y,{key:`${f.kri}`,"data-testid":"dataplane-inbound",protocol:f.protocol,"port-name":f.port.toString(),traffic:D==null?void 0:D.inbounds[w(Z).toString({...w(Z).fromString(f.proxyResourceName),sectionName:f.port.toString()})]},{default:t(()=>[e(X,{"data-action":"",to:{name:(I=>I.includes("bound")?I.replace("-outbound-","-inbound-"):"data-plane-connection-inbound-summary-overview-view")(String(w(V).name)),params:{connection:f.proxyResourceName},query:{inactive:l.params.inactive}}},{default:t(()=>[n(p(f.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},[o.data.dataplaneType==="delegated"?{name:"empty",fn:t(()=>[e($,null,{default:t(()=>[h("p",null,`
                                    This proxy is a delegated gateway therefore `+p(d("common.product.name"))+` does not have any
                                    visibility into inbounds for this gateway.
                                  `,1)]),_:2},1024)]),key:"0"}:void 0]),1032,["items","predicate"])]),_:2},1024))),128))]),_:2,__:[36]},1024),a[42]||(a[42]=n()),e(U,null,{actions:t(()=>[e(X,{action:"refresh",appearance:"primary",onClick:()=>{it(),dt()}},{default:t(()=>a[37]||(a[37]=[n(`
                            Refresh
                          `,-1)])),_:2,__:[37]},1032,["onClick"])]),title:t(()=>[e(m,{type:"separated"},{default:t(()=>[e(N,{name:"outbound"}),a[38]||(a[38]=n()),a[39]||(a[39]=h("span",null,"Outbounds",-1))]),_:1,__:[38,39]})]),default:t(()=>[a[40]||(a[40]=n()),a[41]||(a[41]=n()),typeof pt>"u"&&(y!=null&&y.outbounds.length)?(s(),u(S,{key:0,type:"outbounds",items:y==null?void 0:y.outbounds},{default:t(({items:i})=>[e(W,{type:"outbound","data-testid":"dataplane-outbounds"},{default:t(()=>[e(m,{type:"stack",size:"small"},{default:t(()=>[(s(!0),c(v,null,x(i,r=>(s(),u(Y,{key:r.kri,"data-testid":"dataplane-outbound",protocol:r.protocol,"port-name":r.port.toString(),traffic:D==null?void 0:D.outbounds[r.proxyResourceName]},{default:t(()=>[e(X,{"data-action":"",to:{name:(f=>f.includes("bound")?f.replace("-inbound-","-outbound-"):"data-plane-connection-outbound-summary-overview-view")(String(w(V).name)),params:{connection:r.proxyResourceName},query:{inactive:l.params.inactive}}},{default:t(()=>[n(p(r.proxyResourceName),1)]),_:2},1032,["to"])]),_:2},1032,["protocol","port-name","traffic"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["items"])):(s(),u($,{key:1}))]),_:2,__:[40,41]},1024)]),_:2,__:[42]},1024)]),_:2},1024),a[44]||(a[44]=n()),e(nt,null,{default:t(i=>[i.route.name!==l.name?(s(),u(kt,{key:0,width:i.route.name==="data-plane-subscriptions-summary-view"?"900px":"670px",onClose:function(){l.replace({name:"data-plane-detail-view",params:{mesh:l.params.mesh,proxy:l.params.proxy},query:{inactive:l.params.inactive?null:void 0}})}},{default:t(()=>[(s(),u(bt(i.Component),{data:l.params.subscription.length>0?o.data.dataplaneInsight.subscriptions:i.route.name.includes("-inbound-")?y==null?void 0:y.inbounds:y==null?void 0:y.outbounds,"data-plane-overview":o.data,networking:o.data.dataplane.networking,subscriptions:o.data.dataplaneInsight.subscriptions,policies:(g==null?void 0:g.policies)??[],"policy-types-data":A},null,8,["data","data-plane-overview","networking","subscriptions","policies","policy-types-data"]))]),_:2},1032,["width","onClose"])):C("",!0)]),_:2},1024)]),_:2,__:[43,44]},1024)]}),_:2,__:[45]},1024)]),_:2},1032,["data"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:2},1032,["src"])]),_:1})}}}),Xt=vt(xt,[["__scopeId","data-v-ef23454c"]]);export{Xt as default};
