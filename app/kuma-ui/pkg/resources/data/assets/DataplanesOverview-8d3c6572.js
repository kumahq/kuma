import{z as O}from"./kongponents.es-7ead79da.js";import{P as x}from"./constants-31fdaf55.js";import{e as w}from"./production-8efaeab1.js";import{k as h}from"./kumaApi-08f7fc23.js";import{L as P}from"./LoadingBox-96c35686.js";import{S as k}from"./StatusBadge-760d0ebe.js";import{O as B}from"./OnboardingNavigation-14ec4750.js";import{O as N,a as A}from"./OnboardingPage-ce1119d2.js";import{_ as S}from"./_plugin-vue_export-helper-c27b6911.js";import{i as e,a as _,w as i,o,e as l,h as m,g as p,t as T,f,F}from"./runtime-dom.esm-bundler-fd3ecc5a.js";import"./vuex.esm-bundler-4e6e06ec.js";const H={name:"DataplanesOverview",components:{OnboardingNavigation:B,OnboardingHeading:N,OnboardingPage:A,LoadingBox:P,StatusBadge:k,KTable:O},metaInfo(){return{title:this.title}},data(){return{productName:x,tableHeaders:[{label:"Mesh",key:"mesh"},{label:"Name",key:"name"},{label:"Status",key:"status"}],tableData:{total:0,data:[]},timeout:null}},computed:{title(){return this.tableData.data.length?"Success":"Waiting for DPPs"},description(){return this.tableData.data.length?"The following data plane proxies (DPPs) are connected to the control plane:":null}},created(){this.getAllDataplanes()},beforeUnmount(){clearTimeout(this.timeout)},methods:{async getAllDataplanes(){let r=!1;const c=[];try{const{items:a}=await h.getAllDataplanes({size:10});if(Array.isArray(a))for(const g of a){const{name:t,mesh:n}=g,d=await h.getDataplaneOverviewFromMesh({mesh:n,name:t}),s=w(d.dataplaneInsight);s==="offline"&&(r=!0),c.push({status:s,name:t,mesh:n})}}catch(a){console.error(a)}this.tableData.data=c,this.tableData.total=this.tableData.data.length,r&&(this.timeout=setTimeout(()=>{this.getAllDataplanes()},1e3))}}},I={key:0,class:"justify-center flex my-4"},L={key:1},z={class:"flex justify-center mt-10 mb-16 pb-16"},C={class:"w-full sm:w-3/5 p-4"},K={class:"font-bold mb-4"};function M(r,c,a,g,t,n){const d=e("OnboardingHeading"),s=e("LoadingBox"),b=e("StatusBadge"),v=e("KTable"),D=e("OnboardingNavigation"),y=e("OnboardingPage");return o(),_(y,null,{header:i(()=>[l(d,{title:n.title,description:n.description},null,8,["title","description"])]),content:i(()=>[t.tableData.data.length?(o(),m("div",L,[p("div",z,[p("div",C,[p("p",K,`
              Found `+T(t.tableData.data.length)+` DPPs:
            `,1),f(),l(v,{class:"onboarding-dataplane-table",fetcher:()=>t.tableData,headers:t.tableHeaders,"disable-pagination":"","is-small":""},{status:i(({rowValue:u})=>[u?(o(),_(b,{key:0,status:u},null,8,["status"])):(o(),m(F,{key:1},[f(`
                  â€”
                `)],64))]),_:1},8,["fetcher","headers"])])])])):(o(),m("div",I,[l(s)]))]),navigation:i(()=>[l(D,{"next-step":"onboarding-completed","previous-step":"onboarding-add-services-code","should-allow-next":t.tableData.data.length>0},null,8,["should-allow-next"])]),_:1})}const Y=S(H,[["render",M]]);export{Y as default};
