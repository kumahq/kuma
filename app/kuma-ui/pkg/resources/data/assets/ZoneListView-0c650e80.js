import{d as j,N as F,t as D,r as k,o,g as c,w as e,h as r,a4 as G,m as V,l as a,i,a5 as J,E as M,Y as P,C as m,S as q,j as g,F as h,a7 as W,D as X,k as x,V as Y,K as L,am as H,U as T,a2 as Q,Z as ee,an as E,ax as te,q as oe}from"./index-622cbb72.js";import{_ as ne}from"./MultizoneInfo.vue_vue_type_script_setup_true_lang-1765d7aa.js";import{_ as ae}from"./DeleteResourceModal.vue_vue_type_script_setup_true_lang-ef324a9f.js";const se=["data-testid"],ie=j({__name:"ZoneListView",setup(le){const B=F(),Z=D(!1),I=D(!1),z=D("");function $(p){return p.map(v=>{var l;const{name:b}=v,S={name:"zone-cp-detail-view",params:{zone:b}};let y="",C="kubernetes",w=!1,f=!0;(((l=v.zoneInsight)==null?void 0:l.subscriptions)??[]).forEach(s=>{if(s.version&&s.version.kumaCp){y=s.version.kumaCp.version;const{kumaCpGlobalCompatible:u=!0}=s.version.kumaCp;f=u}if(s.config){const u=JSON.parse(s.config);C=u.environment,w=u.store.type==="memory"}});const t=te(v);return{detailViewRoute:S,name:b,status:t,zoneCpVersion:y,type:C,warnings:{version_mismatch:!f,store_memory:w}}})}async function A(){await B.deleteZone({name:z.value})}function R(){Z.value=!Z.value}function K(p){R(),z.value=p}function O(p){I.value=(p==null?void 0:p.items.length)>0}return(p,v)=>{const b=k("RouteTitle"),S=k("RouterLink"),y=k("DataSource"),C=k("AppView"),w=k("RouteView");return o(),c(y,{src:"/me"},{default:e(({data:f})=>[f?(o(),c(w,{key:0,name:"zone-cp-list-view",params:{page:1,size:f.pageSize}},{default:e(({route:d,t,can:l})=>[r(C,null,G({title:e(()=>[V("h1",null,[r(b,{title:t("zone-cps.routes.items.title"),render:!0},null,8,["title"])])]),default:e(()=>[a(),a(),l("use zones")?(o(),c(y,{key:1,src:`/zone-cps?page=${d.params.page}&size=${d.params.size}`,onChange:O},{default:e(({data:s,error:u,refresh:U})=>[r(i(J),null,{body:e(()=>[u!==void 0?(o(),c(M,{key:0,error:u},null,8,["error"])):(o(),c(P,{key:1,class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{label:"Name",key:"name"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Type",key:"type"},{label:"Status",key:"status"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Actions",key:"actions",hideLabel:!0}],"page-number":parseInt(d.params.page),"page-size":parseInt(d.params.size),total:s==null?void 0:s.total,items:s?$(s.items):void 0,error:u,"empty-state-title":l("create zones")?t("zone-cps.empty_state.title"):void 0,"empty-state-message":l("create zones")?t("zone-cps.empty_state.message"):void 0,"empty-state-cta-to":l("create zones")?{name:"zone-create-view"}:void 0,"empty-state-cta-text":l("create zones")?t("zones.index.create"):void 0,onChange:d.update},{name:e(({row:n,rowValue:_})=>[r(S,{to:n.detailViewRoute,"data-testid":"detail-view-link"},{default:e(()=>[a(m(_),1)]),_:2},1032,["to"])]),zoneCpVersion:e(({rowValue:n})=>[a(m(n||t("common.collection.none")),1)]),type:e(({rowValue:n})=>[a(m(n||t("common.collection.none")),1)]),status:e(({rowValue:n})=>[n?(o(),c(q,{key:0,status:n},null,8,["status"])):(o(),g(h,{key:1},[a(m(t("common.collection.none")),1)],64))]),warnings:e(({row:n})=>[Object.values(n.warnings).some(_=>_)?(o(),c(i(W),{key:0},{content:e(()=>[V("ul",null,[(o(!0),g(h,null,X(n.warnings,(_,N)=>(o(),g(h,{key:N},[_?(o(),g("li",{key:0,"data-testid":`warning-${N}`},m(t(`zone-cps.list.${N}`)),9,se)):x("",!0)],64))),128))])]),default:e(()=>[a(),r(Y,{"data-testid":"warning",class:"mr-1",size:i(L),"hide-title":""},null,8,["size"])]),_:2},1024)):(o(),g(h,{key:1},[a(m(t("common.collection.none")),1)],64))]),actions:e(({row:n})=>[r(i(H),{class:"actions-dropdown","data-testid":"actions-dropdown","kpop-attributes":{placement:"bottomEnd",popoverClasses:"mt-5 more-actions-popover"},width:"150"},{default:e(()=>[r(i(T),{class:"non-visual-button",appearance:"secondary",size:"small"},{icon:e(()=>[r(i(Q),{color:i(ee),icon:"more",size:i(L)},null,8,["color","size"])]),_:1})]),items:e(()=>[r(i(E),{item:{to:n.detailViewRoute,label:t("common.collection.actions.view")}},null,8,["item"]),a(),l("create zones")?(o(),c(i(E),{key:0,"has-divider":"","is-dangerous":"","data-testid":"dropdown-delete-item",onClick:_=>K(n.name)},{default:e(()=>[a(m(t("common.collection.actions.delete")),1)]),_:2},1032,["onClick"])):x("",!0)]),_:2},1024)]),_:2},1032,["page-number","page-size","total","items","error","empty-state-title","empty-state-message","empty-state-cta-to","empty-state-cta-text","onChange"]))]),_:2},1024),a(),Z.value?(o(),c(ae,{key:0,"confirmation-text":z.value,"delete-function":A,"is-visible":"","action-button-text":t("common.delete_modal.proceed_button"),title:t("common.delete_modal.title",{type:"Zone"}),"data-testid":"delete-zone-modal",onCancel:R,onDelete:()=>{R(),U()}},{"body-content":e(()=>[V("p",null,m(t("common.delete_modal.text1",{type:"Zone",name:z.value})),1),a(),V("p",null,m(t("common.delete_modal.text2")),1)]),_:2},1032,["confirmation-text","action-button-text","title","onDelete"])):x("",!0)]),_:2},1032,["src"])):(o(),c(ne,{key:0}))]),_:2},[l("create zones")&&I.value?{name:"actions",fn:e(()=>[r(i(T),{appearance:"primary",icon:"plus",to:{name:"zone-create-view"},"data-testid":"create-zone-link"},{default:e(()=>[a(m(t("zones.index.create")),1)]),_:2},1024)]),key:"0"}:void 0]),1024)]),_:2},1032,["params"])):x("",!0)]),_:1})}}});const pe=oe(ie,[["__scopeId","data-v-2c080560"]]);export{pe as default};
