import{d as F,o as i,c as T,w as s,a as g,u as r,K as Q,b as I,e as X,r as e,f as $,g as U,h as ee,k as N,i as K,j as D,l as a,m as ae,v as te,F as H,n as O,t as V,p as se,q as le,P as z,s as M,x as R,y as x,z as ne,A as oe,B as re,C as ie}from"./index.438e3d4b.js";import{D as ue}from"./DataOverview.d3cf1e01.js";import{_ as ce}from"./EntityURLControl.vue_vue_type_script_setup_true_lang.9cb692f4.js";import{F as pe}from"./FrameSkeleton.a9fcc7af.js";import{_ as W}from"./LabelList.vue_vue_type_style_index_0_lang.f87328a0.js";import{T as me}from"./TabsWidget.d3a9fdeb.js";import{Y as de}from"./YamlView.5dc1bbe6.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.5a7a3b48.js";import"./ErrorBlock.aea25275.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.5397142f.js";import"./TagList.9c7242fd.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.b3ce259f.js";import"./_commonjsHelpers.f037b798.js";const ve=F({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(m){const d=m;return(S,v)=>(i(),T(r(X),{class:"docs-link",appearance:"outline",target:"_blank",to:d.href},{icon:s(()=>[g(r(Q),{icon:"externalLink"})]),default:s(()=>[I(" Documentation ")]),_:1},8,["to"]))}}),ye=a("h4",null,"Dataplanes",-1),he=F({__name:"PolicyConnections",props:{mesh:{type:String,required:!0},policyType:{type:String,required:!0},policyName:{type:String,required:!0}},setup(m){const d=m,S=e(!1),v=e(!0),E=e(!1),k=e([]),y=e(""),b=$(()=>{const u=y.value.toLowerCase();return k.value.filter(({dataplane:l})=>l.name.toLowerCase().includes(u))});U(()=>d.policyName,function(){h()}),ee(function(){h()});async function h(){E.value=!1,v.value=!0;try{const{items:u,total:l}=await N.getPolicyConnections({mesh:d.mesh,policyType:d.policyType,policyName:d.policyName});S.value=l>0,k.value=u}catch{E.value=!0}finally{v.value=!1}}return(u,l)=>{const P=K("router-link");return i(),D("div",null,[g(W,{"has-error":E.value,"is-loading":v.value,"is-empty":!S.value},{default:s(()=>[a("ul",null,[a("li",null,[ye,ae(a("input",{id:"dataplane-search","onUpdate:modelValue":l[0]||(l[0]=t=>y.value=t),type:"text",class:"k-input mb-4",placeholder:"Filter by name",required:""},null,512),[[te,y.value]]),(i(!0),D(H,null,O(r(b),(t,f)=>(i(),D("p",{key:f,class:"my-1","data-testid":"dataplane-name"},[g(P,{to:{name:"data-plane-detail-view",params:{mesh:t.dataplane.mesh,dataPlane:t.dataplane.name}}},{default:s(()=>[I(V(t.dataplane.name),1)]),_:2},1032,["to"])]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])])}}}),Y=m=>(oe("data-v-1d237689"),m=m(),re(),m),fe={key:0,class:"mb-4"},_e=Y(()=>a("p",null,[a("strong",null,"Warning"),I(" This policy is experimental. If you encountered any problem please open an "),a("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),ge=Y(()=>a("span",{class:"custom-control-icon"}," \u2190 ",-1)),ke={"data-testid":"policy-single-entity"},be={"data-testid":"policy-overview-tab"},we={class:"config-wrapper"},De=F({__name:"PolicyView",props:{policyPath:{type:String,required:!0}},setup(m){const d=m,S=[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],v=se(),E=le(),k=e(!0),y=e(!1),b=e(null),h=e(!0),u=e(!1),l=e(!1),P=e(!1),t=e({}),f=e(null),A=e(null),q=e({headers:[{label:"Actions",key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Mesh",key:"mesh"},{label:"Type",key:"type"}],data:[]}),p=$(()=>E.state.policiesByPath[d.policyPath]),j=$(()=>`https://kuma.io/docs/${E.getters["config/getKumaDocsVersion"]}/policies/${p.value.path}/`);U(()=>v.params.mesh,function(){v.name===d.policyPath&&(k.value=!0,y.value=!1,h.value=!0,u.value=!1,l.value=!1,P.value=!1,b.value=null,B())}),B();async function B(n=0){k.value=!0,b.value=null;const o=v.query.ns||null,_=v.params.mesh,L=p.value.path;try{let c;if(_!==null&&o!==null)c=[await N.getSinglePolicyEntity({mesh:_,path:L,name:o})],A.value=null;else{const w={size:z,offset:n},C=await N.getAllPolicyEntitiesFromMesh({mesh:_,path:L},w);c=C.items,A.value=C.next}if(c.length>0){q.value.data=c.map(J=>G(J)),P.value=!1,y.value=!1;const w=["type","name","mesh"],C=c[0];t.value=M(C,w),f.value=R(C)}else q.value.data=[],P.value=!0,y.value=!0,u.value=!0}catch(c){c instanceof Error?b.value=c:console.error(c),y.value=!0}finally{k.value=!1,h.value=!1}}function G(n){if(!n.mesh)return n;const o=n,_={name:"mesh-detail-view",params:{mesh:n.mesh}};return o.meshRoute=_,o}async function Z(n){l.value=!1,h.value=!0,u.value=!1;try{const o=await N.getSinglePolicyEntity({mesh:n.mesh,path:p.value.path,name:n.name});if(o){const _=["type","name","mesh"];t.value=M(o,_),f.value=R(o)}else t.value={},u.value=!0}catch(o){l.value=!0,console.error(o)}finally{h.value=!1}}return(n,o)=>{const _=K("KAlert"),L=K("KButton");return r(p)?(i(),D("div",{key:0,class:ne(["relative",r(p).path])},[r(p).isExperimental?(i(),D("div",fe,[g(_,{appearance:"warning"},{alertMessage:s(()=>[_e]),_:1})])):x("",!0),g(pe,null,{default:s(()=>[g(ue,{"selected-entity-name":t.value.name,"page-size":r(z),error:b.value,"is-loading":k.value,"empty-state":{title:"No Data",message:`There are no ${r(p).pluralDisplayName} present.`},"table-data":q.value,"table-data-is-empty":P.value,next:A.value,onTableAction:Z,onLoadData:B},{additionalControls:s(()=>[g(ve,{href:r(j),"data-testid":"policy-documentation-link"},null,8,["href"]),n.$route.query.ns?(i(),T(L,{key:0,class:"back-button",appearance:"primary",to:{name:r(p).path}},{default:s(()=>[ge,I(" View All ")]),_:1},8,["to"])):x("",!0)]),default:s(()=>[I(" > ")]),_:1},8,["selected-entity-name","page-size","error","is-loading","empty-state","table-data","table-data-is-empty","next"]),y.value===!1?(i(),T(me,{key:0,"has-error":b.value!==null,error:b.value,"is-loading":k.value,tabs:S,"initial-tab-override":"overview"},{tabHeader:s(()=>[a("div",null,[a("h3",ke,V(r(p).singularDisplayName)+": "+V(t.value.name),1)]),a("div",null,[g(ce,{name:t.value.name,mesh:t.value.mesh},null,8,["name","mesh"])])]),overview:s(()=>[g(W,{"has-error":l.value,"is-loading":h.value,"is-empty":u.value},{default:s(()=>[a("div",be,[a("ul",null,[(i(!0),D(H,null,O(t.value,(c,w)=>(i(),D("li",{key:w},[a("h4",null,V(w),1),a("p",null,V(c),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"]),a("div",we,[f.value!==null?(i(),T(de,{key:0,id:"code-block-policy","has-error":l.value,"is-loading":h.value,"is-empty":u.value,content:f.value,"is-searchable":""},null,8,["has-error","is-loading","is-empty","content"])):x("",!0)])]),"affected-dpps":s(()=>[f.value!==null?(i(),T(he,{key:0,mesh:f.value.mesh,"policy-name":f.value.name,"policy-type":r(p).path},null,8,["mesh","policy-name","policy-type"])):x("",!0)]),_:1},8,["has-error","error","is-loading"])):x("",!0)]),_:1})],2)):x("",!0)}}});const Ke=ie(De,[["__scopeId","data-v-1d237689"]]);export{Ke as default};
