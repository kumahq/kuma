import{cj as q,ck as W,L as j,J as G,D as H,Q as J,cJ as Z,K as B,e as R,r as D,o as e,c as g,w as i,a as d,f as n,F as _,i as v,g as a,p as x,t as c,b as N,d as U,j as S,k as I,cy as Q,cx as $,cA as X,s as ee,cK as ae,n as m,x as Y,cC as te,cD as se,cL as ne,cE as oe,ct as le,q as ie,cM as re,ci as ce,y as de,z as ue,u as pe,l as M}from"./index.d0c2efa7.js";import{S as z,E as K}from"./EnvoyData.c359b2ec.js";import{E as me}from"./EntityURLControl.b14a7a6c.js";import{L as V}from"./LabelList.84abaca0.js";import{a as he,S as _e}from"./SubscriptionHeader.81bb3179.js";import{T as ye}from"./TabsWidget.d742b9a7.js";import{W as fe}from"./WarningsWidget.9ca0e50f.js";import{Y as ve}from"./YamlView.2cfc9d9d.js";import{_ as ge}from"./EmptyBlock.vue_vue_type_script_setup_true_lang.37c6fb15.js";import{E as Pe}from"./ErrorBlock.0c813134.js";import{_ as be}from"./LoadingBlock.vue_vue_type_script_setup_true_lang.d2d6c4b6.js";import"./CodeBlock.22897d3f.js";import"./_commonjsHelpers.f037b798.js";import"./index.58caa11d.js";const ke={inbound:"Policies applied on incoming connection on address",outbound:"Policies applied on outgoing connection to the address",service:"Policies applied on outgoing connections to service",dataplane:"Policies applied on all incoming and outgoing connections to the selected data plane proxy"},we={name:"DataplanePolicies",components:{StatusInfo:z,AccordionList:q,AccordionItem:W,KCard:j,KPop:G,KIcon:H,KBadge:J},props:{mesh:{type:String,required:!0},dppName:{type:String,required:!0}},data(){return{items:[],hasItems:!1,isLoading:!0,error:null,searchInput:"",POLICY_TYPE_SUBTITLE:ke}},computed:{...Z({policiesByType:s=>s.policiesByType})},watch:{dppName(){this.fetchPolicies()}},mounted(){this.fetchPolicies()},methods:{async fetchPolicies(){this.error=null,this.isLoading=!0;try{const{items:s,total:o,kind:h}=await B.getDataplanePolicies({mesh:this.mesh,dppName:this.dppName});(h===void 0||h==="SidecarDataplane")&&(this.processItems(s),this.items=s,this.hasItems=o>0)}catch(s){this.error=s}finally{this.isLoading=!1}},processItems(s){for(const o of s){o.policyTypes={};for(const h in o.matchedPolicies){const y=this.policiesByType[h],u={pluralDisplayName:y.pluralDisplayName,policies:o.matchedPolicies[h]};for(const f of u.policies)f.route={name:y.path,query:{ns:f.name},params:{mesh:f.mesh}};o.policyTypes[h]=u}}}}},De={class:"flex items-center justify-between"},Ie={key:0,class:"text-lg"},Te={key:1,class:"text-lg"},Ce={class:"subtitle"},Le={key:0},Se={key:1},xe={class:"flex flex-wrap justify-end"},Ee={class:"policy-wrapper"},Oe={class:"policy-type"};function Ae(s,o,h,y,u,f){const P=D("KIcon"),b=D("KPop"),T=D("KBadge"),k=D("router-link"),w=D("AccordionItem"),E=D("AccordionList"),O=D("KCard"),A=D("StatusInfo");return e(),g(A,{"has-error":u.error!==null,"is-loading":u.isLoading,error:u.error,"is-empty":!u.hasItems},{default:i(()=>[d(O,{"border-variant":"noBorder"},{body:i(()=>[d(E,{"initially-open":[],"multiple-open":""},{default:i(()=>[(e(!0),n(_,null,v(u.items,(t,p)=>(e(),g(w,{key:p},{"accordion-header":i(()=>[a("div",De,[a("div",null,[t.type==="dataplane"?(e(),n("p",Ie," Dataplane ")):x("",!0),t.type!=="dataplane"?(e(),n("p",Te,c(t.service),1)):x("",!0),a("p",Ce,[t.type==="inbound"||t.type==="outbound"?(e(),n("span",Le,c(t.type)+" "+c(t.name),1)):t.type==="service"||t.type==="dataplane"?(e(),n("span",Se,c(t.type),1)):x("",!0),d(b,{width:"300",placement:"right",trigger:"hover"},{content:i(()=>[a("div",null,c(u.POLICY_TYPE_SUBTITLE[t.type]),1)]),default:i(()=>[d(P,{icon:"help",size:"16",class:"ml-1"})]),_:2},1024)])]),a("div",xe,[(e(!0),n(_,null,v(t.matchedPolicies,(l,r)=>(e(),g(T,{key:`${p}-${r}`,class:"mr-2 mb-2"},{default:i(()=>[N(c(r),1)]),_:2},1024))),128))])])]),"accordion-content":i(()=>[a("div",Ee,[(e(!0),n(_,null,v(t.policyTypes,(l,r)=>(e(),n("div",{key:`${p}-${r}`,class:"policy-item"},[a("h4",Oe,c(l.pluralDisplayName),1),a("ul",null,[(e(!0),n(_,null,v(l.policies,(C,L)=>(e(),n("li",{key:`${p}-${r}-${L}`,class:"my-1","data-testid":"policy-name"},[d(k,{to:C.route},{default:i(()=>[N(c(C.name),1)]),_:2},1032,["to"])]))),128))])]))),128))])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["has-error","is-loading","error","is-empty"])}const Ke=R(we,[["render",Ae],["__scopeId","data-v-7223f9a8"]]),F=s=>(de("data-v-225efb15"),s=s(),ue(),s),Be={key:0},Ne={key:1},$e=F(()=>a("h4",null,"Tags",-1)),Me=F(()=>a("h4",null,"Versions",-1)),Ve={class:"config-wrapper"},qe={key:0},We=["href"],je=U({__name:"DataPlaneDetails",props:{dataPlane:{type:Object,required:!0},dataPlaneOverview:{type:Object,required:!0}},setup(s){const o=s,h=Y(),y=[{hash:"#overview",title:"Overview"},{hash:"#insights",title:"DPP Insights"},{hash:"#dpp-policies",title:"Policies"},{hash:"#xds-configuration",title:"XDS Configuration"},{hash:"#envoy-stats",title:"Stats"},{hash:"#envoy-clusters",title:"Clusters"},{hash:"#mtls",title:"Certificate Insights"},{hash:"#warnings",title:"Warnings"}],u=S([]),f=I(()=>{const{type:t,name:p,mesh:l}=o.dataPlane,r=Q(o.dataPlane,o.dataPlaneOverview.dataplaneInsight);return{type:t,name:p,mesh:l,status:r}}),P=I(()=>$(o.dataPlane)),b=I(()=>X(o.dataPlaneOverview.dataplaneInsight)),T=I(()=>ee(o.dataPlane)),k=I(()=>ae(o.dataPlaneOverview)),w=I(()=>{const t=Array.from(o.dataPlaneOverview.dataplaneInsight.subscriptions);return t.reverse(),t}),E=I(()=>{const t=h.getters.getKumaDocsVersion;return t!==null?t:"latest"}),O=I(()=>u.value.length===0?y.filter(t=>t.hash!=="#warnings"):y);function A(){const t=o.dataPlaneOverview.dataplaneInsight.subscriptions;if(t.length===0||!("version"in t[0]))return;const p=t[0].version;if(p&&p.kumaDp&&p.envoy){const r=te(p);r.kind!==se&&r.kind!==ne&&u.value.push(r)}h.getters["config/getMulticlusterStatus"]&&p&&$(o.dataPlane).find(L=>L.label===oe)&&typeof p.kumaDp.kumaCpCompatible=="boolean"&&!p.kumaDp.kumaCpCompatible&&u.value.push({kind:le,payload:{kumaDp:p.kumaDp.version}})}return A(),(t,p)=>(e(),g(ye,{tabs:m(O),"initial-tab-override":"overview"},{tabHeader:i(()=>[a("div",null,[a("h3",null," DPP: "+c(s.dataPlane.name),1)]),a("div",null,[d(me,{name:s.dataPlane.name,mesh:s.dataPlane.mesh},null,8,["name","mesh"])])]),overview:i(()=>[d(V,null,{default:i(()=>[a("div",null,[a("ul",null,[(e(!0),n(_,null,v(m(f),(l,r)=>(e(),n("li",{key:r},[a("h4",null,c(r),1),r==="status"&&typeof l!="string"?(e(),n("div",Be,[a("div",{class:ie(["entity-status",{"is-offline":l.status.toLowerCase()==="offline","is-online":l.status.toLowerCase()==="online","is-degraded":l.status.toLowerCase()==="partially degraded","is-not-available":l.status.toLowerCase()==="not available"}])},[a("span",null,c(l.status),1)],2),(e(!0),n(_,null,v(l.reason,(C,L)=>(e(),n("div",{key:L,class:"reason"},c(C),1))),128))])):(e(),n("div",Ne,c(l),1))]))),128))])]),a("div",null,[m(P).length>0?(e(),n(_,{key:0},[$e,a("p",null,[(e(!0),n(_,null,v(m(P),(l,r)=>(e(),n("span",{key:r,class:"tag-cols"},[a("span",null,c(l.label)+": ",1),a("span",null,c(l.value),1)]))),128))])],64)):x("",!0),m(b)?(e(),n(_,{key:1},[Me,a("p",null,[(e(!0),n(_,null,v(m(b),(l,r)=>(e(),n("span",{key:r,class:"tag-cols"},[a("span",null,c(r)+": ",1),a("span",null,c(l),1)]))),128))])],64)):x("",!0)])]),_:1}),a("div",Ve,[d(ve,{id:"code-block-data-plane",content:m(T),"is-searchable":""},null,8,["content"])])]),insights:i(()=>[d(z,{"is-empty":m(w).length===0},{default:i(()=>[d(m(j),{"border-variant":"noBorder"},{body:i(()=>[d(q,{"initially-open":0},{default:i(()=>[(e(!0),n(_,null,v(m(w),(l,r)=>(e(),g(W,{key:r},{"accordion-header":i(()=>[d(he,{details:l},null,8,["details"])]),"accordion-content":i(()=>[d(_e,{details:l,"is-discovery-subscription":""},null,8,["details"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["is-empty"])]),"dpp-policies":i(()=>[d(Ke,{mesh:s.dataPlane.mesh,"dpp-name":s.dataPlane.name},null,8,["mesh","dpp-name"])]),"xds-configuration":i(()=>[d(K,{"data-path":"xds",mesh:s.dataPlane.mesh,"dpp-name":s.dataPlane.name,"query-key":"envoy-data-data-plane"},null,8,["mesh","dpp-name"])]),"envoy-stats":i(()=>[d(K,{"data-path":"stats",mesh:s.dataPlane.mesh,"dpp-name":s.dataPlane.name,"query-key":"envoy-data-data-plane"},null,8,["mesh","dpp-name"])]),"envoy-clusters":i(()=>[d(K,{"data-path":"clusters",mesh:s.dataPlane.mesh,"dpp-name":s.dataPlane.name,"query-key":"envoy-data-data-plane"},null,8,["mesh","dpp-name"])]),mtls:i(()=>[d(V,null,{default:i(()=>[m(k)!==null?(e(),n("ul",qe,[(e(!0),n(_,null,v(m(k),(l,r)=>(e(),n("li",{key:r},[a("h4",null,c(l.label),1),a("p",null,c(l.value),1)]))),128))])):(e(),g(m(re),{key:1,appearance:"danger"},{alertMessage:i(()=>[N(" This data plane proxy does not yet have mTLS configured \u2014 "),a("a",{href:`https://kuma.io/docs/${m(E)}/documentation/security/#certificates`,class:"external-link",target:"_blank"}," Learn About Certificates in "+c(m(ce)),9,We)]),_:1}))]),_:1})]),warnings:i(()=>[d(fe,{warnings:u.value},null,8,["warnings"])]),_:1},8,["tabs"]))}});const Re=R(je,[["__scopeId","data-v-225efb15"]]),Ue={class:"component-frame"},oa=U({__name:"DataPlaneDetailView",setup(s){const o=pe(),h=Y(),y=S(null),u=S(null),f=S(!0),P=S(null);async function b(){P.value=null,f.value=!0;const T=o.params.mesh,k=o.params.dataPlane;try{y.value=await B.getDataplaneFromMesh({mesh:T,name:k}),u.value=await B.getDataplaneOverviewFromMesh({mesh:T,name:k})}catch(w){y.value=null,w instanceof Error?P.value=w:console.error(w)}finally{f.value=!1}}return M(()=>o.params.mesh,function(){o.name==="data-plane-detail-view"&&b()}),M(()=>o.params.dataPlane,function(){o.name==="data-plane-detail-view"&&b()}),b(),h.dispatch("updatePageTitle",o.params.dataPlane),(T,k)=>(e(),n("div",Ue,[f.value?(e(),g(be,{key:0})):P.value!==null?(e(),g(Pe,{key:1,error:P.value},null,8,["error"])):y.value===null||u.value===null?(e(),g(ge,{key:2})):(e(),g(Re,{key:3,"data-plane":y.value,"data-plane-overview":u.value},null,8,["data-plane","data-plane-overview"]))]))}});export{oa as default};
