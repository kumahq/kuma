import{q as T,L as A}from"./kongponents.es-be132aa8.js";import{d as R,u as F,q as p,c as f,o as u,e as y,h as l,g as c,r as z,a as _,w as i,b as m,k as O,j as S,t as k,F as w,f as G}from"./index-7be782ba.js";import{i as H,g as J,H as K,J as Q,K as M,f as W,e as U,E as q,A as X,_ as Y}from"./RouteView.vue_vue_type_script_setup_true_lang-751dcd09.js";import{_ as Z}from"./RouteTitle.vue_vue_type_script_setup_true_lang-a53060e8.js";import{D as E,a as N}from"./DefinitionListItem-d941d68a.js";import{_ as ee}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-de78a6f2.js";import{_ as te}from"./StatusInfo.vue_vue_type_script_setup_true_lang-d0f743d2.js";import{T as ae}from"./TextWithCopyButton-f0934e92.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-a8091abf.js";import"./ErrorBlock-50e1d8c4.js";const ne={class:"chart-box-list"},se=R({__name:"MeshCharts",setup(D){const o=H(),b=J(),x=F(),C=p(!1),h=p({total:0,online:0,partiallyDegraded:0,offline:0}),v=p({total:0,internal:0,external:0}),s=p({kumaDp:{},envoy:{}}),d=f(()=>{const e=[],{internal:t,external:a}=v.value;return t&&e.push({title:o.t("common.charts.services.internalLabel"),data:t}),a&&e.push({title:o.t("common.charts.services.externalLabel"),data:a}),{title:o.t("common.charts.services.title"),showTotal:!0,dataPoints:e}}),V=f(()=>{const e=[],{total:t,online:a,partiallyDegraded:n}=h.value;if(t>0){e.push({title:o.t("http.api.value.online"),statusKeyword:"online",data:a}),n>0&&e.push({title:o.t("http.api.value.partially_degraded"),statusKeyword:"partially_degraded",data:n});const r=t-n-a;r>0&&e.push({title:o.t("http.api.value.offline"),statusKeyword:"offline",data:r})}return{title:o.t("common.charts.dataPlaneProxies.title"),showTotal:!0,dataPoints:e}}),B=f(()=>{const e=Object.entries(s.value.kumaDp).map(([t,a])=>({title:t,data:a.total??0}));return e.sort((t,a)=>t.title==="unknown"?1:a.title==="unknown"?-1:K(t.title,a.title)),{title:o.t("common.charts.kumaDp.title"),subtitle:o.t("common.charts.kumaDp.subtitle"),dataPoints:e}}),P=f(()=>{const e=Object.entries(s.value.envoy).map(([t,a])=>({title:t,data:a.total??0}));return e.sort((t,a)=>t.title==="unknown"?1:a.title==="unknown"?-1:K(t.title,a.title)),{title:o.t("common.charts.envoy.title"),subtitle:o.t("common.charts.envoy.subtitle"),dataPoints:e}});L();async function L(){C.value=!0;const e=x.params.mesh;try{const t=await b.getMeshInsights({name:e}),a=Q([t]);$(a),g(a),I(a)}catch{h.value={total:0,online:0,partiallyDegraded:0,offline:0},v.value={total:0,internal:0,external:0},s.value={kumaDp:{},envoy:{}}}finally{C.value=!1}}function $(e){const{total:t,online:a,partiallyDegraded:n}=e.dataplanes;h.value={total:t,online:a,partiallyDegraded:n,offline:t-a-n}}function g(e){const{total:t,internal:a,external:n}=e.services;v.value={total:t,internal:a,external:n}}function I(e){s.value=e.dpVersions}return(e,t)=>(u(),y("div",ne,[l(M,{data:d.value},null,8,["data"]),c(),l(M,{data:V.value},null,8,["data"]),c(),l(M,{data:B.value},null,8,["data"]),c(),l(M,{data:P.value},null,8,["data"])]))}});const le=W(se,[["__scopeId","data-v-375c50a1"]]);function oe(D){return D!=null}const re={class:"stack"},ie={class:"columns"},ue=R({__name:"MeshOverviewView",setup(D){const{t:o}=H(),b=J(),x=F(),C=U(),h=p(!0),v=p(!1),s=p(null),d=p(null),V=f(()=>{if(s.value===null||d.value===null)return null;const{name:e,creationTime:t,modificationTime:a}=s.value;return{name:e,created:q(t),modified:q(a),"Data Plane Proxies":d.value.dataplanes.total}}),B=f(()=>{var j;if(s.value===null)return null;const e=g(s.value,"mtls"),t=g(s.value,"logging"),a=g(s.value,"metrics"),n=g(s.value,"tracing"),r=!!((j=s.value.routing)!=null&&j.localityAwareLoadBalancing);return{mtls:e,logging:t,metrics:a,tracing:n,localityAwareLoadBalancing:r}}),P=f(()=>d.value===null?0:Object.values(d.value.policies).reduce((e,t)=>e+t.total,0)),L=f(()=>d.value===null?[]:Object.entries(d.value.policies).map(([e,t])=>{const a=C.state.policyTypesByName[e];return a&&t.total!==0?{name:a.name,path:a.path,total:t.total}:null}).filter(oe));$();async function $(){h.value=!0,v.value=!1;const e=x.params.mesh;try{s.value=await b.getMesh({name:e}),d.value=await b.getMeshInsights({name:e})}catch(t){v.value=!0,s.value=null,d.value=null,console.error(t)}finally{h.value=!1}}function g(e,t){if(e===null||e[t]===void 0)return!1;const a=e[t].enabledBackend??e[t].defaultBackend??e[t].backends[0].name,n=e[t].backends.find(r=>r.name===a);return`${n.type} / ${n.name}`}async function I(e){const t=x.params.mesh;return await b.getMesh({name:t},e)}return(e,t)=>{const a=z("router-link");return u(),_(Y,null,{default:i(()=>[l(Z,{title:m(o)("meshes.routes.overview.title")},null,8,["title"]),c(),l(X,null,{default:i(()=>[O("div",re,[l(m(T),null,{body:i(()=>[l(le)]),_:1}),c(),s.value!==null?(u(),_(m(T),{key:0},{body:i(()=>[O("div",ie,[l(te,{"is-loading":h.value,"has-error":v.value,"is-empty":s.value===null||d.value===null},{default:i(()=>[l(E,null,{default:i(()=>[(u(!0),y(w,null,S(V.value,(n,r)=>(u(),_(N,{key:r,term:m(o)(`http.api.property.${r}`)},{default:i(()=>[typeof n=="boolean"?(u(),_(m(A),{key:0,appearance:n?"success":"danger"},{default:i(()=>[c(k(n?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):r==="name"&&typeof n=="string"?(u(),_(ae,{key:1,text:n},null,8,["text"])):(u(),y(w,{key:2},[c(k(n),1)],64))]),_:2},1032,["term"]))),128))]),_:1})]),_:1},8,["is-loading","has-error","is-empty"]),c(),l(E,null,{default:i(()=>[(u(!0),y(w,null,S(B.value,(n,r)=>(u(),_(N,{key:r,term:m(o)(`http.api.property.${r}`)},{default:i(()=>[typeof n=="boolean"?(u(),_(m(A),{key:0,appearance:n?"success":"danger"},{default:i(()=>[c(k(n?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(u(),y(w,{key:1},[c(k(n),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),c(),l(E,null,{default:i(()=>[l(N,{term:`Policies (${P.value})`},{default:i(()=>[O("ul",null,[(u(!0),y(w,null,S(L.value,(n,r)=>(u(),y("li",{key:r},[l(a,{to:{name:"policies-list-view",params:{policyPath:n.path}}},{default:i(()=>[c(k(n.name)+": "+k(n.total),1)]),_:2},1032,["to"])]))),128))])]),_:1},8,["term"])]),_:1})])]),_:1})):G("",!0),c(),l(m(T),null,{body:i(()=>{var n;return[l(ee,{id:"code-block-mesh","resource-fetcher":I,"resource-fetcher-watch-key":((n=s.value)==null?void 0:n.name)||null},null,8,["resource-fetcher-watch-key"])]}),_:1})])]),_:1})]),_:1})}}});const ke=W(ue,[["__scopeId","data-v-f6843524"]]);export{ke as default};
