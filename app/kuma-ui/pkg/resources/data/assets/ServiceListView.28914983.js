import{d as C,cv as L,bP as r,h as R,c8 as S,o as P,i as T,w as k,a as V,j as q}from"./index.bd548025.js";import{Q as _,D as z}from"./DataOverview.c2f3fb00.js";import{C as M}from"./ContentWrapper.92bb9d03.js";import{S as O}from"./ServiceSummary.d2ab49ab.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.0d00632b.js";import"./ErrorBlock.ee0cc1df.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.f0102383.js";import"./StatusBadge.fafdc81c.js";import"./TagList.4378af73.js";import"./YamlView.vue_vue_type_script_setup_true_lang.bc9d3e4b.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.867fc141.js";import"./_commonjsHelpers.f037b798.js";const X=C({__name:"ServiceListView",props:{selectedServiceName:{type:String,required:!1,default:null},offset:{type:Number,required:!1,default:0}},setup(A){const m=A,D=[{label:"Service",key:"name"},{label:"Type",key:"serviceType"},{label:"Address",key:"addressPort"},{label:"Status",key:"status"},{label:"DP proxies (online / total)",key:"dpProxiesStatus"}],x=50,N={title:"No Data",message:"There are no service insights present."},p=L(),v=r(!0),d=r(null),b=r(null),h=r(m.offset),l=r(null),w=r(null),i=r({headers:D,data:[]});R(()=>p.params.mesh,function(){p.name==="service-list-view"&&f(0)}),f(m.offset);async function f(e){var o;h.value=e,_.set("offset",e>0?e:null),v.value=!0,d.value=null;const t=p.params.mesh,s=x;try{const{items:a,next:y}=await S.getAllServiceInsightsFromMesh({mesh:t},{size:s,offset:e});if(b.value=y,Array.isArray(a)&&a.length>0){a.sort((n,u)=>n.name>u.name?1:n.name<u.name?-1:0),i.value.data=a.map(n=>E(n));const c=(o=m.selectedServiceName)!=null?o:a[0].name;await g({name:c,mesh:t})}else i.value.data=[]}catch(a){a instanceof Error?d.value=a:console.error(a)}finally{v.value=!1}}function E(e){var c;const t={name:"service-detail-view",params:{mesh:e.mesh,service:e.name}},s={name:"mesh-detail-view",params:{mesh:e.mesh}};let o="\u2014";if(e.dataplanes){const{online:n=0,total:u=0}=e.dataplanes;o=`${n} / ${u}`}const a=e.addressPort,y=(c=e.serviceType)!=null?c:"internal";return{...e,serviceType:y,nameRoute:t,meshRoute:s,dpProxiesStatus:o,addressPort:a}}async function g({mesh:e,name:t}){l.value=await S.getServiceInsight({mesh:e,name:t}),l.value.serviceType==="external"&&(w.value=await S.getExternalService({mesh:e,name:t})),_.set("service",t)}return(e,t)=>(P(),T(M,null,{content:k(()=>{var s;return[V(z,{"selected-entity-name":(s=l.value)==null?void 0:s.name,"page-size":x,error:d.value,"is-loading":v.value,"empty-state":N,"table-data":i.value,"table-data-is-empty":i.value.data.length===0,next:b.value,"page-offset":h.value,onTableAction:g,onLoadData:f},null,8,["selected-entity-name","error","is-loading","table-data","table-data-is-empty","next","page-offset"])]}),sidebar:k(()=>[l.value!==null?(P(),T(O,{key:0,service:l.value,"external-service":w.value},null,8,["service","external-service"])):q("",!0)]),_:1}))}});export{X as default};
