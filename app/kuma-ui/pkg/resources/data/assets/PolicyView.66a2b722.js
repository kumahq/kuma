import{d as B,o as c,c as L,w as o,a as l,b as g,r as n,_ as v,K as p,e as m,f as i,g as F,v as K,F as I,h as P,t as f,P as z,m as H,i as R,j as w,s as k,k as E,n as U,p as M,l as O}from"./index.dbfc69fe.js";import{g as W}from"./tableDataUtils.76735c08.js";import{D as Y}from"./DataOverview.e98f79d2.js";import{E as G}from"./EntityURLControl.79d97268.js";import{F as j}from"./FrameSkeleton.525fa295.js";import{L as S}from"./LabelList.9e6f9cac.js";import{T as Z}from"./TabsWidget.ad5c32a1.js";import{Y as J}from"./YamlView.aa325bb9.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.5dc5cc90.js";import"./ErrorBlock.f52010c3.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.f2781028.js";import"./index.58caa11d.js";import"./CodeBlock.83ca39be.js";import"./_commonjsHelpers.712cc82f.js";const Q=B({__name:"DocumentationLink",props:{href:{type:String,required:!0}},setup(t){return(s,h)=>{const u=n("KIcon"),e=n("KButton");return c(),L(e,{class:"docs-link",appearance:"outline",target:"_blank",to:t.href},{icon:o(()=>[l(u,{icon:"externalLink"})]),default:o(()=>[g(" Documentation ")]),_:1},8,["to"])}}}),X={name:"PolicyConnections",components:{LabelList:S},props:{mesh:{type:String,required:!0},policyType:{type:String,required:!0},policyName:{type:String,required:!0}},data(){return{hasDataplanes:!1,isLoading:!0,hasError:!1,dataplanes:[],searchInput:""}},computed:{filteredDataplanes(){const t=this.searchInput.toLowerCase();return this.dataplanes.filter(({dataplane:{name:s}})=>s.toLowerCase().includes(t))}},watch:{policyName(){this.fetchPolicyConntections()}},mounted(){this.fetchPolicyConntections()},methods:{async fetchPolicyConntections(){this.hasError=!1,this.isLoading=!0;try{const{items:t,total:s}=await p.getPolicyConnections({mesh:this.mesh,policyType:this.policyType,policyName:this.policyName});this.hasDataplanes=s>0,this.dataplanes=t}catch{this.hasError=!0}finally{this.isLoading=!1}}}},$=i("h4",null,"Dataplanes",-1);function ee(t,s,h,u,e,a){const d=n("router-link"),y=n("LabelList");return c(),m("div",null,[l(y,{"has-error":e.hasError,"is-loading":e.isLoading,"is-empty":!e.hasDataplanes},{default:o(()=>[i("ul",null,[i("li",null,[$,F(i("input",{id:"dataplane-search","onUpdate:modelValue":s[0]||(s[0]=r=>e.searchInput=r),type:"text",class:"k-input mb-4",placeholder:"Filter by name",required:""},null,512),[[K,e.searchInput]]),(c(!0),m(I,null,P(a.filteredDataplanes,(r,_)=>(c(),m("p",{key:_,class:"my-1","data-testid":"dataplane-name"},[l(d,{to:{name:"data-plane-list-view",query:{ns:r.dataplane.name},params:{mesh:r.dataplane.mesh}}},{default:o(()=>[g(f(r.dataplane.name),1)]),_:2},1032,["to"])]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"])])}const te=v(X,[["render",ee]]);const se={name:"PolicyView",components:{DataOverview:Y,DocumentationLink:Q,EntityURLControl:G,FrameSkeleton:j,LabelList:S,PolicyConnections:te,TabsWidget:Z,YamlView:J},props:{policyPath:{type:String,required:!0}},data(){return{isLoading:!0,isEmpty:!1,error:null,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Mesh",key:"mesh"},{label:"Type",key:"type"}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"}],entity:{},rawEntity:{},pageSize:z,next:null}},computed:{...H({policiesByPath:t=>t.policiesByPath}),...R({kumaDocsVersion:"config/getKumaDocsVersion"}),policy(){return this.policiesByPath[this.policyPath]},docsURL(){return`https://kuma.io/docs/${this.kumaDocsVersion}/policies/${this.policy.path}/`}},watch:{$route(){this.isLoading=!0,this.isEmpty=!1,this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,this.tableDataIsEmpty=!1,this.error=null,this.loadData()}},beforeMount(){this.loadData()},methods:{async loadData(t="0"){this.isLoading=!0,this.error=null;const s=this.$route.query.ns||null,h=this.$route.params.mesh||null,u=this.policy.path;try{const{data:e,next:a}=await W({getSingleEntity:p.getSinglePolicyEntity.bind(p),getAllEntitiesFromPath:p.getAllPolicyEntities.bind(p),getAllEntitiesFromMesh:p.getAllPolicyEntitiesFromMesh.bind(p),path:u,mesh:h,query:s,size:this.pageSize,offset:t});if(this.next=a,e.length){for(const r of e){if(!r.mesh)continue;const _={name:"mesh-child",params:{mesh:r.mesh}};r.meshRoute=_}this.tableData.data=e,this.tableDataIsEmpty=!1,this.isEmpty=!1;const d=["type","name","mesh"],y=e[0];this.entity=w(y,d),this.rawEntity=k(y)}else this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.entityIsEmpty=!0}catch(e){this.error=e,this.isEmpty=!0}finally{this.isLoading=!1,this.entityIsLoading=!1}},getEntity(t){if(this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,t)return p.getSinglePolicyEntity({mesh:t.mesh,path:this.policy.path,name:t.name}).then(s=>{if(s){const h=["type","name","mesh"];this.entity=w(s,h),this.rawEntity=k(s)}else this.entity={},this.entityIsEmpty=!0}).catch(s=>{this.entityHasError=!0,console.error(s)}).finally(()=>{setTimeout(()=>{this.entityIsLoading=!1},"500")});setTimeout(()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1},"500")}}},C=t=>(M("data-v-e62af2ec"),t=t(),O(),t),ie={key:0,class:"mb-4"},ae=C(()=>i("p",null,[i("strong",null,"Warning"),g(" This policy is experimental. If you encountered any problem please open an "),i("a",{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"},"issue")],-1)),ne=C(()=>i("span",{class:"custom-control-icon"}," \u2190 ",-1)),oe={"data-testid":"policy-single-entity"},re={"data-testid":"policy-overview-tab"},le={class:"config-wrapper"};function ce(t,s,h,u,e,a){const d=n("KAlert"),y=n("DocumentationLink"),r=n("KButton"),_=n("DataOverview"),T=n("EntityURLControl"),x=n("LabelList"),V=n("YamlView"),A=n("PolicyConnections"),N=n("TabsWidget"),q=n("FrameSkeleton");return a.policy?(c(),m("div",{key:0,class:U(["relative",a.policy.path])},[a.policy.isExperimental?(c(),m("div",ie,[l(d,{appearance:"warning"},{alertMessage:o(()=>[ae]),_:1})])):E("",!0),l(q,null,{default:o(()=>[l(_,{"page-size":e.pageSize,"has-error":e.error!==null,error:e.error,"is-loading":e.isLoading,"empty-state":{title:"No Data",message:`There are no ${a.policy.pluralDisplayName} present.`},"table-data":e.tableData,"table-data-is-empty":e.tableDataIsEmpty,next:e.next,onTableAction:a.getEntity,onLoadData:s[0]||(s[0]=b=>a.loadData(b))},{additionalControls:o(()=>[l(y,{href:a.docsURL,"data-testid":"policy-documentation-link"},null,8,["href"]),t.$route.query.ns?(c(),L(r,{key:0,class:"back-button",appearance:"primary",to:{name:a.policy.path}},{default:o(()=>[ne,g(" View All ")]),_:1},8,["to"])):E("",!0)]),default:o(()=>[g(" > ")]),_:1},8,["page-size","has-error","error","is-loading","empty-state","table-data","table-data-is-empty","next","onTableAction"]),e.isEmpty===!1?(c(),L(N,{key:0,"has-error":e.error!==null,error:e.error,"is-loading":e.isLoading,tabs:e.tabs,"initial-tab-override":"overview"},{tabHeader:o(()=>[i("div",null,[i("h3",oe,f(a.policy.singularDisplayName)+": "+f(e.entity.name),1)]),i("div",null,[l(T,{name:e.entity.name,mesh:e.entity.mesh},null,8,["name","mesh"])])]),overview:o(()=>[l(x,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty},{default:o(()=>[i("div",re,[i("ul",null,[(c(!0),m(I,null,P(e.entity,(b,D)=>(c(),m("li",{key:D},[i("h4",null,f(D),1),i("p",null,f(b),1)]))),128))])])]),_:1},8,["has-error","is-loading","is-empty"]),i("div",le,[l(V,{"has-error":e.entityHasError,"is-loading":e.entityIsLoading,"is-empty":e.entityIsEmpty,content:e.rawEntity},null,8,["has-error","is-loading","is-empty","content"])])]),"affected-dpps":o(()=>[l(A,{mesh:e.rawEntity.mesh,"policy-name":e.rawEntity.name,"policy-type":a.policy.path},null,8,["mesh","policy-name","policy-type"])]),_:1},8,["has-error","error","is-loading","tabs"])):E("",!0)]),_:1})],2)):E("",!0)}const ke=v(se,[["render",ce],["__scopeId","data-v-e62af2ec"]]);export{ke as default};
