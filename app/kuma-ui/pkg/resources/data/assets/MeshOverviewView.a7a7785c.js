import{d as F,e as d,f as T,o as l,i,a as h,u as a,b as o,s as Y,G as X,q,r as M,y as G,ct as O,k as R,h as K,w as k,A as V,F as I,j as u,n as E,t as m,c as $,S as N,D as U,E as W}from"./index.5ff69d99.js";import{C as z}from"./ContentWrapper.1c550e69.js";import{_ as B,a as A,M as H}from"./MeshResources.e3541fee.js";import{_ as J}from"./LabelList.vue_vue_type_style_index_0_lang.6b9707d9.js";import{_ as Q}from"./YamlView.vue_vue_type_script_setup_true_lang.7ae7a12d.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang.815effe0.js";import"./ErrorBlock.9183b6a0.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang.5eb6ebf0.js";import"./index.58caa11d.js";import"./CodeBlock.vue_vue_type_style_index_0_lang.21ca60cf.js";import"./_commonjsHelpers.f037b798.js";const Z={class:"chart-container mt-24"},ee=F({__name:"MeshCharts",setup(v){const t=Y(),f=d(()=>t.getters.getServiceResourcesFetching),_=d(()=>t.getters.getMeshInsightsFetching),y=d(()=>t.getters.getChart("services")),g=d(()=>t.getters.getChart("dataplanes")),r=d(()=>t.getters.getChart("policies")),S=d(()=>t.getters.getChart("kumaDPVersions")),w=d(()=>t.getters.getChart("envoyVersions"));T(()=>t.state.selectedMesh,function(){b()}),b();function b(){t.dispatch("fetchMeshInsights",t.state.selectedMesh),t.dispatch("fetchServices",t.state.selectedMesh)}return(P,x)=>(l(),i("div",Z,[h(B,{class:"chart",title:{singular:"SERVICE",plural:"SERVICES"},data:a(y).data,"is-loading":a(f),"save-chart":""},null,8,["data","is-loading"]),o(),h(B,{class:"chart",title:{singular:"DP PROXY",plural:"DP PROXIES"},data:a(g).data,url:{name:"data-plane-list-view",params:{mesh:a(t).state.selectedMesh}},"is-loading":a(_)},null,8,["data","url","is-loading"]),o(),h(B,{class:"chart",title:{singular:"POLICY",plural:"POLICIES"},data:a(r).data,url:{name:"policies",params:{mesh:a(t).state.selectedMesh}},"is-loading":a(_)},null,8,["data","url","is-loading"]),o(),h(A,{class:"chart",title:"KUMA DP",data:a(S).data,"is-loading":a(_)},null,8,["data","is-loading"]),o(),h(A,{class:"chart",title:"ENVOY",data:a(w).data,"is-loading":a(_),"display-am-charts-logo":""},null,8,["data","is-loading"])]))}});const ae=X(ee,[["__scopeId","data-v-2a02347c"]]),te=v=>(U("data-v-35629297"),v=v(),W(),v),se={key:0},ne={key:1},le={key:1},oe={class:"policy-counts"},re=te(()=>u("h4",null,`
                  Policies
                `,-1)),ie={key:0},ce={key:0,class:"mt-4"},ue=F({__name:"MeshOverviewView",setup(v){const t=q(),f=Y(),_=M(!0),y=M(!1),g=M(!1),r=M(null),S=M(null),w=d(()=>r.value!==null?G(r.value):null),b=d(()=>{if(r.value===null)return null;const{name:s,type:n,creationTime:p,modificationTime:e}=r.value;return{name:s,type:n,created:O(p),modified:O(e),"Data Plane Proxies":f.state.meshInsight.dataplanes.total}}),P=d(()=>{var C;if(r.value===null)return null;const s=D(r.value,"mtls"),n=D(r.value,"logging"),p=D(r.value,"metrics"),e=D(r.value,"tracing"),c=Boolean((C=r.value.routing)==null?void 0:C.localityAwareLoadBalancing);return{mtls:s,logging:n,metrics:p,tracing:e,localityAwareLoadBalancing:c}}),x=d(()=>f.state.policies.map(s=>{var n,p;return{...s,length:(p=(n=f.state.meshInsight.policies[s.name])==null?void 0:n.total)!=null?p:0}}));T(()=>t.params.mesh,function(){t.name==="single-mesh-overview"&&(_.value=!0,g.value=!1,y.value=!1,L())}),L();async function L(){_.value=!0,g.value=!1;const s=t.params.mesh;try{r.value=await R.getMesh({name:s}),S.value=await R.getMeshInsights({name:s})}catch(n){y.value=!0,g.value=!0,console.error(n)}finally{_.value=!1}}function D(s,n){var c,C;if(s===null||s[n]===void 0)return!1;const p=(C=(c=s[n].enabledBackend)!=null?c:s[n].defaultBackend)!=null?C:s[n].backends[0].name,e=s[n].backends.find(j=>j.name===p);return`${e.type} / ${e.name}`}return(s,n)=>{const p=K("router-link");return l(),i(I,null,[h(ae),o(),h(z,{class:"mt-8"},{content:k(()=>[r.value!==null?(l(),i("div",se,[h(J,{"has-error":y.value,"is-loading":_.value,"is-empty":g.value},{default:k(()=>[u("div",null,[u("ul",null,[(l(!0),i(I,null,E(a(b),(e,c)=>(l(),i("li",{key:c},[u("h4",null,m(c),1),o(),typeof e=="boolean"?(l(),$(a(N),{key:0,appearance:e?"success":"danger"},{default:k(()=>[o(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),i("p",ne,m(e),1))]))),128))])]),o(),u("div",null,[u("ul",null,[(l(!0),i(I,null,E(a(P),(e,c)=>(l(),i("li",{key:c},[u("h4",null,m(c),1),o(),typeof e=="boolean"?(l(),$(a(N),{key:0,appearance:e?"success":"danger"},{default:k(()=>[o(m(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(l(),i("p",le,m(e),1))]))),128))])]),o(),u("div",null,[u("ul",oe,[u("li",null,[re,o(),u("ul",null,[(l(!0),i(I,null,E(a(x),(e,c)=>(l(),i(I,{key:c},[e.length!==0?(l(),i("li",ie,[h(p,{to:{name:e.path}},{default:k(()=>[o(m(e.pluralDisplayName)+": "+m(e.length),1)]),_:2},1032,["to"])])):V("",!0)],64))),128))])])])])]),_:1},8,["has-error","is-loading","is-empty"])])):V("",!0)]),_:1}),o(),a(w)!==null?(l(),i("div",ce,[h(Q,{id:"code-block-mesh",content:a(w)},null,8,["content"])])):V("",!0),o(),h(H,{class:"mt-6"})],64)}}});const ke=X(ue,[["__scopeId","data-v-35629297"]]);export{ke as default};
