import{d as j,v as $,S as H,p as h,o as l,w as n,b as i,r,e as p,q as X,m as k,l as V,I as J,K as O,t as g,c as f,L as v,N as z,T as Q,U as Y,y as ee,G as ne,_ as oe}from"./index-y0jRV0qi.js";import{S as se}from"./SummaryView-DU_tu2nI.js";const te=["data-testid"],ae=j({__name:"ZoneListView",setup(le){const S=$({}),L=$({}),A=H(),B=b=>{const s="zoneIngress";S.value=b.items.reduce((c,m)=>{var _;const u=(_=m[s])==null?void 0:_.zone;if(typeof u<"u"){typeof c[u]>"u"&&(c[u]={online:[],offline:[]});const w=typeof m[`${s}Insight`].connectedSubscription<"u"?"online":"offline";c[u][w].push(m)}return c},{})},Z=b=>{const s="zoneEgress";L.value=b.items.reduce((c,m)=>{var _;const u=(_=m[s])==null?void 0:_.zone;if(typeof u<"u"){typeof c[u]>"u"&&(c[u]={online:[],offline:[]});const w=typeof m[`${s}Insight`].connectedSubscription<"u"?"online":"offline";c[u][w].push(m)}return c},{})};return(b,s)=>{const c=r("RouteTitle"),m=r("DataSource"),u=r("XI18n"),_=r("XTeleportTemplate"),w=r("XSearch"),D=r("XIcon"),R=r("XAction"),E=r("DataCollection"),G=r("DataLoader"),q=r("XLayout"),x=r("XCard"),F=r("RouterView"),K=r("AppView"),M=r("RouteView");return l(),h(M,{name:"zone-cp-list-view",params:{page:1,size:Number,zone:"",s:""}},{default:n(({route:t,t:y,uri:P,me:d})=>[i(m,{src:P(k(ne),"/zone-cps",{},{page:t.params.page,size:t.params.size,search:t.params.s})},{default:n(({data:o,error:U,refresh:W})=>{var T;return[i(K,{docs:o&&((T=o==null?void 0:o.items)!=null&&T.length)?y("zones.href.docs.cta"):""},{title:n(()=>[V("h1",null,[i(c,{title:y("zone-cps.routes.items.title")},null,8,["title"])])]),default:n(()=>[s[9]||(s[9]=p()),i(m,{src:"/zone-ingress-overviews?page=1&size=100",onChange:B}),s[10]||(s[10]=p()),i(m,{src:"/zone-egress-overviews?page=1&size=100",onChange:Z}),s[11]||(s[11]=p()),o!=null&&o.items.length?(l(),h(u,{key:0,path:"zone-cps.routes.items.intro","default-path":"common.i18n.ignore-error"})):X("",!0),s[12]||(s[12]=p()),((o==null?void 0:o.items)??[]).length>0?(l(),h(_,{key:1,to:{name:"zone-cp-list-view-actions"}},{default:n(()=>[i(k(A))]),_:1})):X("",!0),s[13]||(s[13]=p()),i(x,null,{default:n(()=>[i(q,null,{default:n(()=>[V("search",null,[V("form",{onSubmit:s[0]||(s[0]=J(()=>{},["prevent"]))},[i(w,{class:"search-field",keys:["name"],value:t.params.s,onChange:e=>t.update({page:1,s:e})},null,8,["value","onChange"])],32)]),s[8]||(s[8]=p()),i(G,{data:[o],errors:[U],variant:"list"},{default:n(()=>[i(E,{type:"zone-cps",items:(o==null?void 0:o.items)??[void 0],page:t.params.page,"page-size":t.params.size,total:o==null?void 0:o.total,onChange:t.update},{default:n(()=>[i(O,{class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{...d.get("headers.type"),label:"Â ",key:"type"},{...d.get("headers.name"),label:"Name",key:"name"},{...d.get("headers.zoneCpVersion"),label:"Zone leader CP version",key:"zoneCpVersion"},{...d.get("headers.ingress"),label:"Ingresses (online / total)",key:"ingress"},{...d.get("headers.egress"),label:"Egresses (online / total)",key:"egress"},{...d.get("headers.state"),label:"Status",key:"state"},{...d.get("headers.warnings"),label:"Warnings",key:"warnings",hideLabel:!0},{...d.get("headers.actions"),label:"Actions",key:"actions",hideLabel:!0}],items:o==null?void 0:o.items,"is-selected-row":e=>e.name===t.params.zone,onResize:d.set},{type:n(({row:e})=>[(l(!0),f(z,null,v([["kubernetes","universal"].find(a=>a===e.zoneInsight.environment)??"kubernetes"],a=>(l(),h(D,{key:a,name:a},{default:n(()=>[p(g(y(`common.product.environment.${a}`)),1)]),_:2},1032,["name"]))),128))]),name:n(({row:e})=>[i(R,{"data-action":"",to:{name:"zone-cp-detail-view",params:{zone:e.name},query:{page:t.params.page,size:t.params.size,s:t.params.s}}},{default:n(()=>[p(g(e.name),1)]),_:2},1032,["to"])]),zoneCpVersion:n(({row:e})=>[p(g(k(Y)(e.zoneInsight,"version.kumaCp.version",y("common.collection.none"))),1)]),ingress:n(({row:e})=>[(l(!0),f(z,null,v([S.value[e.name]||{online:[],offline:[]}],a=>(l(),f(z,null,[p(g(a.online.length)+" / "+g(a.online.length+a.offline.length),1)],64))),256))]),egress:n(({row:e})=>[(l(!0),f(z,null,v([L.value[e.name]||{online:[],offline:[]}],a=>(l(),f(z,null,[p(g(a.online.length)+" / "+g(a.online.length+a.offline.length),1)],64))),256))]),state:n(({row:e})=>[i(Q,{status:e.state},null,8,["status"])]),warnings:n(({row:e})=>{var a,N;return[(l(!0),f(z,null,v([[{bool:e.zoneInsight.store==="memory",key:"store-memory"},{bool:!((N=(a=e.zoneInsight.version)==null?void 0:a.kumaCp)!=null&&N.kumaCpGlobalCompatible),key:"global-cp-incompatible"}].filter(({bool:C})=>C)],C=>(l(),f(z,{key:typeof C},[C.length>0?(l(),h(D,{key:0,name:"warning","data-testid":"warning"},{default:n(()=>[V("ul",null,[(l(!0),f(z,null,v(C,({key:I})=>(l(),f("li",{key:I,"data-testid":`warning-${I}`},g(y(`zone-cps.list.warnings.${I}`)),9,te))),128))])]),_:2},1024)):(l(),f(z,{key:1},[p(g(y("common.collection.none")),1)],64))],64))),128))]}),actions:n(({row:e})=>[i(k(A),{item:e,onChange:W},{default:n(()=>[i(R,{to:{name:"zone-cp-detail-view",params:{zone:e.name}}},{default:n(()=>[p(g(y("common.collection.actions.view")),1)]),_:2},1032,["to"])]),_:2},1032,["item","onChange"])]),_:2,__:[1,2,3,4,5,6,7]},1032,["headers","items","is-selected-row","onResize"])]),_:2},1032,["items","page","page-size","total","onChange"])]),_:2},1032,["data","errors"])]),_:2,__:[8]},1024)]),_:2},1024),s[14]||(s[14]=p()),t.params.zone?(l(),h(F,{key:2},{default:n(e=>[i(se,{onClose:a=>t.replace({name:"zone-cp-list-view",query:{page:t.params.page,size:t.params.size,s:t.params.s}})},{default:n(()=>[(l(),h(ee(e.Component),{name:t.params.zone,"zone-overview":o==null?void 0:o.items.find(a=>a.name===t.params.zone)},null,8,["name","zone-overview"]))]),_:2},1032,["onClose"])]),_:2},1024)):X("",!0)]),_:2,__:[9,10,11,12,13,14]},1032,["docs"])]}),_:2},1032,["src"])]),_:1})}}}),pe=oe(ae,[["__scopeId","data-v-886ac0bb"]]);export{pe as default};
