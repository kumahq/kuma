import{z as M,I as L}from"./kongponents.es-af129dfe.js";import{d as A,u as O,c as m,v as R,o as n,j as d,g as o,h as l,r as w,N,x as H,w as r,e as p,b as v,i as E,F as g,q as B,t as y,f as S}from"./index-a4fb3e6d.js";import{D as x}from"./DoughnutChart-64a4c3f1.js";import{u as z}from"./store-a62ac939.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import{D as I,a as V}from"./DefinitionListItem-cc432e9e.js";import{M as J}from"./MeshResources-0ea05961.js";import{_ as Q}from"./ResourceCodeBlock.vue_vue_type_script_setup_true_lang-17fd4305.js";import{_ as U}from"./StatusInfo.vue_vue_type_script_setup_true_lang-036f6f0b.js";import{T as X}from"./TextWithCopyButton-f986f099.js";import{b as Y,u as Z}from"./index-7848fac5.js";import"./CodeBlock.vue_vue_type_style_index_0_lang-ef11f61a.js";import"./toYaml-4e00099e.js";import"./EmptyBlock.vue_vue_type_script_setup_true_lang-ea440da3.js";import"./ErrorBlock-984fd14e.js";import"./LoadingBlock.vue_vue_type_script_setup_true_lang-aae7801c.js";const ee={class:"chart-box-list"},te=A({__name:"MeshCharts",setup(K){const C=O(),c=z(),_=m(()=>c.getters.getChart("services",{title:"Services",showTotal:!0})),f=m(()=>c.getters.getChart("dataplanes",{title:"DP Proxies",showTotal:!0,isStatusChart:!0})),k=m(()=>c.getters.getChart("kumaDPVersions",{title:"Kuma DP",subtitle:"versions"})),b=m(()=>c.getters.getChart("envoyVersions",{title:"Envoy",subtitle:"versions"}));R(()=>C.params.mesh,function(u){typeof u=="string"&&s(u)},{immediate:!0});function s(u){c.dispatch("fetchMeshInsights",u),c.dispatch("fetchServices",u)}return(u,P)=>(n(),d("div",ee,[o(x,{data:_.value},null,8,["data"]),l(),o(x,{data:f.value},null,8,["data"]),l(),o(x,{data:k.value},null,8,["data"]),l(),o(x,{data:b.value},null,8,["data"])]))}});const ae=F(te,[["__scopeId","data-v-5ab6d374"]]),se={class:"kcard-stack"},ne={class:"columns"},oe={key:0},re=A({__name:"MeshOverviewView",setup(K){const{t:C}=Y(),c=Z(),_=O(),f=z(),k=w(!0),b=w(!1),s=w(null),u=w(null),P=m(()=>{if(s.value===null)return null;const{name:t,type:a,creationTime:h,modificationTime:e}=s.value;return{name:t,type:a,created:N(h),modified:N(e),"Data Plane Proxies":f.state.meshInsight.dataplanes.total}}),j=m(()=>{var T;if(s.value===null)return null;const t=D(s.value,"mtls"),a=D(s.value,"logging"),h=D(s.value,"metrics"),e=D(s.value,"tracing"),i=!!((T=s.value.routing)!=null&&T.localityAwareLoadBalancing);return{mtls:t,logging:a,metrics:h,tracing:e,localityAwareLoadBalancing:i}}),q=m(()=>f.state.sidebar.insights.mesh.policies.total),W=m(()=>f.state.policyTypes.map(t=>{var a;return{...t,length:((a=f.state.meshInsight.policies[t.name])==null?void 0:a.total)??0}}));R(()=>_.params.mesh,function(){_.name==="single-mesh-overview"&&$()}),$();async function $(){k.value=!0,b.value=!1;const t=_.params.mesh;try{s.value=await c.getMesh({name:t}),u.value=await c.getMeshInsights({name:t})}catch(a){b.value=!0,s.value=null,u.value=null,console.error(a)}finally{k.value=!1}}function D(t,a){if(t===null||t[a]===void 0)return!1;const h=t[a].enabledBackend??t[a].defaultBackend??t[a].backends[0].name,e=t[a].backends.find(i=>i.name===h);return`${e.type} / ${e.name}`}async function G(t){const a=_.params.mesh;return await c.getMesh({name:a},t)}return(t,a)=>{const h=H("router-link");return n(),d("div",se,[o(p(M),null,{body:r(()=>[o(ae)]),_:1}),l(),s.value!==null?(n(),v(p(M),{key:0},{body:r(()=>[E("div",ne,[o(U,{"is-loading":k.value,"has-error":b.value,"is-empty":s.value===null||u.value===null},{default:r(()=>[o(I,null,{default:r(()=>[(n(!0),d(g,null,B(P.value,(e,i)=>(n(),v(V,{key:i,term:p(C)(`http.api.property.${i}`)},{default:r(()=>[typeof e=="boolean"?(n(),v(p(L),{key:0,appearance:e?"success":"danger"},{default:r(()=>[l(y(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):i==="name"&&typeof e=="string"?(n(),v(X,{key:1,text:e},null,8,["text"])):(n(),d(g,{key:2},[l(y(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1})]),_:1},8,["is-loading","has-error","is-empty"]),l(),o(I,null,{default:r(()=>[(n(!0),d(g,null,B(j.value,(e,i)=>(n(),v(V,{key:i,term:p(C)(`http.api.property.${i}`)},{default:r(()=>[typeof e=="boolean"?(n(),v(p(L),{key:0,appearance:e?"success":"danger"},{default:r(()=>[l(y(e?"Enabled":"Disabled"),1)]),_:2},1032,["appearance"])):(n(),d(g,{key:1},[l(y(e),1)],64))]),_:2},1032,["term"]))),128))]),_:1}),l(),o(I,null,{default:r(()=>[o(V,{term:`Policies (${q.value})`},{default:r(()=>[E("ul",null,[(n(!0),d(g,null,B(W.value,(e,i)=>(n(),d(g,{key:i},[e.length!==0?(n(),d("li",oe,[o(h,{to:{name:"policies-list-view",params:{policyPath:e.path}}},{default:r(()=>[l(y(e.name)+": "+y(e.length),1)]),_:2},1032,["to"])])):S("",!0)],64))),128))])]),_:1},8,["term"])]),_:1})])]),_:1})):S("",!0),l(),o(p(M),null,{body:r(()=>{var e;return[o(Q,{id:"code-block-mesh","resource-fetcher":G,"resource-fetcher-watch-key":((e=s.value)==null?void 0:e.name)||null},null,8,["resource-fetcher-watch-key"])]}),_:1}),l(),o(J)])}}});const De=F(re,[["__scopeId","data-v-55c5d4bf"]]);export{De as default};
