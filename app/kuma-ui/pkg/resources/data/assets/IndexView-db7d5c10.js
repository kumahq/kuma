import{d as W,R as H,y as C,r as I,o,i as k,w as e,j as p,a8 as X,p as x,n as s,k as f,$ as Y,E as q,a0 as Q,H as m,l as z,F as h,I as T,W as ee,aa as te,m as S,v as ne,K as A,a1 as oe,Y as L,aI as se,aJ as ae,a3 as K,aK as le,t as ie}from"./index-cde24e60.js";import{_ as ce}from"./DeleteResourceModal.vue_vue_type_script_setup_true_lang-70f633f6.js";const re=["data-testid"],ue=W({__name:"IndexView",setup(me){const O=H(),R=C(!1),Z=C(!1),V=C(""),D=C({}),$=C({}),B=a=>{let i="offline";return a.length>0&&(i="online",typeof a[a.length-1].disconnectTime<"u"&&(i="offline")),i},U=a=>{const i="zoneIngress";D.value=a.items.reduce((l,c)=>{var _;const r=(_=c[i])==null?void 0:_.zone;if(typeof r<"u"){typeof l[r]>"u"&&(l[r]={online:[],offline:[]});const b=c[`${i}Insight`].subscriptions||[],g=B(b);l[r][g].push(c)}return l},{})},j=a=>{const i="zoneEgress";$.value=a.items.reduce((l,c)=>{var _;const r=(_=c[i])==null?void 0:_.zone;if(typeof r<"u"){typeof l[r]>"u"&&(l[r]={online:[],offline:[]});const b=c[`${i}Insight`].subscriptions||[],g=B(b);l[r][g].push(c)}return l},{})};function F(a){return a.map(i=>{var y;const{name:l}=i,c={name:"zone-cp-detail-view",params:{zone:l}};let r="",_="kubernetes",b=!1,g=!0;(((y=i.zoneInsight)==null?void 0:y.subscriptions)??[]).forEach(d=>{if(d.version&&d.version.kumaCp){r=d.version.kumaCp.version;const{kumaCpGlobalCompatible:v=!0}=d.version.kumaCp;g=v}if(d.config){const v=JSON.parse(d.config);_=v.environment,b=v.store.type==="memory"}});const t=le(i);return{detailViewRoute:c,name:l,status:t,zoneCpVersion:r,type:_,warnings:{version_mismatch:!g,store_memory:b}}})}async function G(){await O.deleteZone({name:V.value})}function E(){R.value=!R.value}function J(a){E(),V.value=a}function M(a){Z.value=(a==null?void 0:a.items.length)>0}return(a,i)=>{const l=I("RouteTitle"),c=I("DataSource"),r=I("RouterLink"),_=I("AppView"),b=I("RouteView");return o(),k(c,{src:"/me"},{default:e(({data:g})=>[g?(o(),k(b,{key:0,name:"zone-cp-list-view",params:{page:1,size:g.pageSize}},{default:e(({route:w,t,can:y})=>[p(_,null,X({title:e(()=>[x("h1",null,[p(l,{title:t("zone-cps.routes.items.title"),render:!0},null,8,["title"])])]),default:e(()=>[s(),s(),p(c,{src:`/zone-cps?page=${w.params.page}&size=${w.params.size}`,onChange:M},{default:e(({data:d,error:v,refresh:P})=>[p(c,{src:"/zone-ingress-overviews?page=1&size=100",onChange:U}),s(),p(c,{src:"/zone-egress-overviews?page=1&size=100",onChange:j}),s(),p(f(Y),null,{body:e(()=>[v!==void 0?(o(),k(q,{key:0,error:v},null,8,["error"])):(o(),k(Q,{key:1,class:"zone-cp-collection","data-testid":"zone-cp-collection",headers:[{label:"Name",key:"name"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Type",key:"type"},{label:"Ingresses (online / total)",key:"ingress"},{label:"Egresses (online / total)",key:"egress"},{label:"Status",key:"status"},{label:"Warnings",key:"warnings",hideLabel:!0},{label:"Actions",key:"actions",hideLabel:!0}],"page-number":parseInt(w.params.page),"page-size":parseInt(w.params.size),total:d==null?void 0:d.total,items:d?F(d.items):void 0,error:v,"empty-state-title":y("create zones")?t("zone-cps.empty_state.title"):void 0,"empty-state-message":y("create zones")?t("zone-cps.empty_state.message"):void 0,"empty-state-cta-to":y("create zones")?{name:"zone-create-view"}:void 0,"empty-state-cta-text":y("create zones")?t("zones.index.create"):void 0,onChange:w.update},{name:e(({row:n,rowValue:u})=>[p(r,{to:n.detailViewRoute,"data-testid":"detail-view-link"},{default:e(()=>[s(m(u),1)]),_:2},1032,["to"])]),zoneCpVersion:e(({rowValue:n})=>[s(m(n||t("common.collection.none")),1)]),type:e(({rowValue:n})=>[s(m(n||t("common.collection.none")),1)]),ingress:e(({row:n})=>[(o(!0),z(h,null,T([D.value[n.name]||{online:[],offline:[]}],u=>(o(),z(h,null,[s(m(u.online.length)+" / "+m(u.online.length+u.offline.length),1)],64))),256))]),egress:e(({row:n})=>[(o(!0),z(h,null,T([$.value[n.name]||{online:[],offline:[]}],u=>(o(),z(h,null,[s(m(u.online.length)+" / "+m(u.online.length+u.offline.length),1)],64))),256))]),status:e(({rowValue:n})=>[n?(o(),k(ee,{key:0,status:n},null,8,["status"])):(o(),z(h,{key:1},[s(m(t("common.collection.none")),1)],64))]),warnings:e(({row:n})=>[Object.values(n.warnings).some(u=>u)?(o(),k(f(te),{key:0},{content:e(()=>[x("ul",null,[(o(!0),z(h,null,T(n.warnings,(u,N)=>(o(),z(h,{key:N},[u?(o(),z("li",{key:0,"data-testid":`warning-${N}`},m(t(`zone-cps.list.${N}`)),9,re)):S("",!0)],64))),128))])]),default:e(()=>[s(),p(ne,{"data-testid":"warning",class:"mr-1",size:f(A),"hide-title":""},null,8,["size"])]),_:2},1024)):(o(),z(h,{key:1},[s(m(t("common.collection.none")),1)],64))]),actions:e(({row:n})=>[p(f(oe),{class:"actions-dropdown","data-testid":"actions-dropdown","kpop-attributes":{placement:"bottomEnd",popoverClasses:"mt-5 more-actions-popover"},width:"150"},{default:e(()=>[p(f(L),{class:"non-visual-button",appearance:"secondary",size:"small"},{icon:e(()=>[p(f(se),{color:f(ae),icon:"more",size:f(A)},null,8,["color","size"])]),_:1})]),items:e(()=>[p(f(K),{item:{to:n.detailViewRoute,label:t("common.collection.actions.view")}},null,8,["item"]),s(),y("create zones")?(o(),k(f(K),{key:0,"has-divider":"","is-dangerous":"","data-testid":"dropdown-delete-item",onClick:u=>J(n.name)},{default:e(()=>[s(m(t("common.collection.actions.delete")),1)]),_:2},1032,["onClick"])):S("",!0)]),_:2},1024)]),_:2},1032,["headers","page-number","page-size","total","items","error","empty-state-title","empty-state-message","empty-state-cta-to","empty-state-cta-text","onChange"]))]),_:2},1024),s(),R.value?(o(),k(ce,{key:0,"confirmation-text":V.value,"delete-function":G,"is-visible":"","action-button-text":t("common.delete_modal.proceed_button"),title:t("common.delete_modal.title",{type:"Zone"}),"data-testid":"delete-zone-modal",onCancel:E,onDelete:()=>{E(),P()}},{"body-content":e(()=>[x("p",null,m(t("common.delete_modal.text1",{type:"Zone",name:V.value})),1),s(),x("p",null,m(t("common.delete_modal.text2")),1)]),_:2},1032,["confirmation-text","action-button-text","title","onDelete"])):S("",!0)]),_:2},1032,["src"])]),_:2},[y("create zones")&&Z.value?{name:"actions",fn:e(()=>[p(f(L),{appearance:"primary",icon:"plus",to:{name:"zone-create-view"},"data-testid":"create-zone-link"},{default:e(()=>[s(m(t("zones.index.create")),1)]),_:2},1024)]),key:"0"}:void 0]),1024)]),_:2},1032,["params"])):S("",!0)]),_:1})}}});const fe=ie(ue,[["__scopeId","data-v-fd46e4b6"]]);export{fe as default};
