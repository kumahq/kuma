"use strict";(self["webpackChunkkuma_gui"]=self["webpackChunkkuma_gui"]||[]).push([[684],{87673:function(t,e,a){a.d(e,{Z:function(){return p}});var i=function(){var t=this,e=t._self._c;return e("div",{attrs:{"data-testid":"entity-url-control"}},[e("KClipboardProvider",{scopedSlots:t._u([{key:"default",fn:function({copyToClipboard:a}){return[e("KPop",{attrs:{placement:"bottom"},scopedSlots:t._u([{key:"content",fn:function(){return[e("div",[e("p",[t._v(t._s(t.confirmationText))])])]},proxy:!0}],null,!0)},[e("KButton",{attrs:{appearance:"secondary",size:"small"},on:{click:()=>{a(t.shareUrl)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("KIcon",{attrs:{"view-box":"0 0 16 16",icon:"externalLink"}})]},proxy:!0}],null,!0)},[t._v(" "+t._s(t.copyButtonText)+" ")])],1)]}}])})],1)},n=[],s={name:"EntityURLControl",props:{name:{type:String,default:""},copyButtonText:{type:String,default:"Copy URL"},confirmationText:{type:String,default:"URL copied to clipboard!"},mesh:{type:String,default:""}},computed:{shareUrl(){const t=`${window.location.href.replace(window.location.hash,"")}#`,{fullPath:e}=this.$router.resolve({name:this.$route.name,params:{mesh:this.mesh},query:{ns:this.name}}).resolved;return`${t}${e}`}}},o=s,r=a(1001),l=(0,r.Z)(o,i,n,!1,null,null,null),p=l.exports},43534:function(t,e,a){a.r(e),a.d(e,{default:function(){return T}});var i=function(){var t=this,e=t._self._c;return t.policy?e("div",{staticClass:"relative",class:t.policy.path},[e("DocumentationLink",{attrs:{href:t.docsURL,"data-testid":"policy-documentation-link"}}),t.policy.isExperimental?e("div",{staticClass:"mb-4"},[e("KAlert",{attrs:{appearance:"warning"},scopedSlots:t._u([{key:"alertMessage",fn:function(){return[e("p",[e("strong",[t._v("Warning")]),t._v(" This policy is experimental. If you encountered any problem please open an "),e("a",{attrs:{href:"https://github.com/kumahq/kuma/issues/new/choose",target:"_blank",rel:"noopener noreferrer"}},[t._v("issue")])])]},proxy:!0}],null,!1,152247830)})],1):t._e(),e("FrameSkeleton",[e("DataOverview",{attrs:{"page-size":t.pageSize,"has-error":t.hasError,"is-loading":t.isLoading,"empty-state":{title:"No Data",message:`There are no ${t.policy.pluralDisplayName} present.`},"table-data":t.tableData,"table-data-is-empty":t.tableDataIsEmpty,next:t.next},on:{tableAction:t.getEntity,loadData:function(e){return t.loadData(e)}},scopedSlots:t._u([{key:"additionalControls",fn:function(){return[t.$route.query.ns?e("KButton",{staticClass:"back-button",attrs:{appearance:"primary",size:"small",to:{name:t.policy.path}}},[e("span",{staticClass:"custom-control-icon"},[t._v(" ← ")]),t._v(" View All ")]):t._e()]},proxy:!0}],null,!1,1981560610)},[t._v(" > ")]),!1===t.isEmpty?e("TabsWidget",{attrs:{"has-error":t.hasError,"is-loading":t.isLoading,tabs:t.tabs,"initial-tab-override":"overview"},scopedSlots:t._u([{key:"tabHeader",fn:function(){return[e("div",[e("h3",{attrs:{"data-testid":"policy-single-entity"}},[t._v(" "+t._s(t.policy.singularDisplayName)+": "+t._s(t.entity.name)+" ")])]),e("div",[e("EntityURLControl",{attrs:{name:t.entity.name,mesh:t.entity.mesh}})],1)]},proxy:!0},{key:"overview",fn:function(){return[e("LabelList",{attrs:{"has-error":t.entityHasError,"is-loading":t.entityIsLoading,"is-empty":t.entityIsEmpty}},[e("div",{attrs:{"data-testid":"policy-overview-tab"}},[e("ul",t._l(t.entity,(function(a,i){return e("li",{key:i},[e("h4",[t._v(t._s(i))]),e("p",[t._v(" "+t._s(a)+" ")])])})),0)])])]},proxy:!0},{key:"affected-dpps",fn:function(){return[e("PolicyConnections",{attrs:{mesh:t.rawEntity.mesh,"policy-name":t.rawEntity.name,"policy-type":t.policy.path}})]},proxy:!0},{key:"yaml",fn:function(){return[e("YamlView",{attrs:{lang:"yaml","has-error":t.entityHasError,"is-loading":t.entityIsLoading,"is-empty":t.entityIsEmpty,content:t.rawEntity}})]},proxy:!0}],null,!1,2613848130)}):t._e()],1)],1):t._e()},n=[],s=a(20629),o=a(53419),r=a(70172),l=a(45689),p=a(56882),c=function(){var t=this,e=t._self._c;return e("KButton",{staticClass:"docs-link",attrs:{appearance:"secondary",size:"small",target:"_blank",to:t.href},scopedSlots:t._u([{key:"icon",fn:function(){return[e("KIcon",{attrs:{"view-box":"0 0 14 14",icon:"externalLink"}})]},proxy:!0}])},[t._v(" Documentation ")])},y=[],h={name:"DocumentationLink",props:{href:{type:String,required:!0}}},u=h,m=a(1001),d=(0,m.Z)(u,c,y,!1,null,"63ee3f6d",null),f=d.exports,g=a(87673),v=a(84855),b=a(17463),E=a(33561),_=function(){var t=this,e=t._self._c;return e("div",[e("LabelList",{attrs:{"has-error":t.hasError,"is-loading":t.isLoading,"is-empty":!t.hasDataplanes}},[e("ul",[e("li",[e("h4",[t._v("Dataplanes")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchInput,expression:"searchInput"}],staticClass:"k-input mb-4",attrs:{id:"dataplane-search",type:"text",placeholder:"Filter by name",required:""},domProps:{value:t.searchInput},on:{input:function(e){e.target.composing||(t.searchInput=e.target.value)}}}),t._l(t.filteredDataplanes,(function(a,i){return e("p",{key:i,staticClass:"my-1",attrs:{"data-testid":"dataplane-name"}},[e("router-link",{attrs:{to:{name:"dataplanes",query:{ns:a.dataplane.name},params:{mesh:a.dataplane.mesh}}}},[t._v(" "+t._s(a.dataplane.name)+" ")])],1)}))],2)])])],1)},k=[],L={name:"PolicyConnections",components:{LabelList:E.Z},props:{mesh:{type:String,required:!0},policyType:{type:String,required:!0},policyName:{type:String,required:!0}},data(){return{hasDataplanes:!1,isLoading:!0,hasError:!1,dataplanes:[],searchInput:""}},computed:{filteredDataplanes(){const t=this.searchInput.toLowerCase();return this.dataplanes.filter((({dataplane:{name:e}})=>e.toLowerCase().includes(t)))}},watch:{policyName(){this.fetchPolicyConntections()}},mounted(){this.fetchPolicyConntections()},methods:{async fetchPolicyConntections(){this.hasError=!1,this.isLoading=!0;try{const{items:t,total:e}=await b.Z.getPolicyConnections({mesh:this.mesh,policyType:this.policyType,policyName:this.policyName});this.hasDataplanes=e>0,this.dataplanes=t}catch(t){this.hasError=!0}finally{this.isLoading=!1}}}},w=L,D=(0,m.Z)(w,_,k,!1,null,null,null),x=D.exports,I=a(7001),C=a(59316),S={name:"PolicyView",metaInfo:{title:"Policy View"},components:{DataOverview:p.Z,DocumentationLink:f,EntityURLControl:g.Z,FrameSkeleton:v.Z,LabelList:E.Z,PolicyConnections:x,TabsWidget:I.Z,YamlView:C.Z},props:{policyPath:{type:String,required:!0}},data(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Name",key:"name"},{label:"Mesh",key:"mesh"},{label:"Type",key:"type"}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#affected-dpps",title:"Affected DPPs"},{hash:"#yaml",title:"YAML"}],entity:{},rawEntity:{},pageSize:l.NR,next:null}},computed:{...(0,s.rn)({policiesByPath:t=>t.policiesByPath}),...(0,s.Se)({kumaDocsVersion:"config/getKumaDocsVersion"}),policy(){return this.policiesByPath[this.policyPath]},docsURL(){return`https://kuma.io/docs/${this.kumaDocsVersion}/policies/${this.policy.path}/`}},watch:{$route(){this.loadData()}},mounted(){this.$options.metaInfo.title=this.policy.pluralDisplayName},beforeMount(){this.loadData()},methods:{async loadData(t="0"){this.isLoading=!0;const e=this.$route.query.ns||null,a=this.$route.params.mesh||null,i=this.policy.path;try{const{data:n,next:s}=await(0,r.W)({getSingleEntity:b.Z.getSinglePolicyEntity.bind(b.Z),getAllEntities:b.Z.getAllPolicyEntities.bind(b.Z),getAllEntitiesFromMesh:b.Z.getAllPolicyEntitiesFromMesh.bind(b.Z),path:i,mesh:a,query:e,size:this.pageSize,offset:t});if(this.next=s,n.length){this.tableData.data=n,this.tableDataIsEmpty=!1,this.isEmpty=!1;const t=["type","name","mesh"],e=n[0];this.entity=(0,o.wy)(e,t),this.rawEntity=(0,o.RV)(e)}else this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.entityIsEmpty=!0}catch(n){this.hasError=!0,this.isEmpty=!0,console.error(n)}finally{this.isLoading=!1,this.entityIsLoading=!1}},getEntity(t){if(this.entityIsLoading=!0,this.entityIsEmpty=!1,this.entityHasError=!1,t)return b.Z.getSinglePolicyEntity({mesh:t.mesh,path:this.policy.path,name:t.name}).then((t=>{if(t){const e=["type","name","mesh"];this.entity=(0,o.wy)(t,e),this.rawEntity=(0,o.RV)(t)}else this.entity={},this.entityIsEmpty=!0})).catch((t=>{this.entityHasError=!0,console.error(t)})).finally((()=>{setTimeout((()=>{this.entityIsLoading=!1}),"500")}));setTimeout((()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1}),"500")}}},P=S,Z=(0,m.Z)(P,i,n,!1,null,null,null),T=Z.exports}}]);