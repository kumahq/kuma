"use strict";(self["webpackChunkkuma_gui"]=self["webpackChunkkuma_gui"]||[]).push([[798],{49718:function(t,e,n){n.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("li",{class:t.accordionItemClasses},[e("button",{staticClass:"accordion-item-header",attrs:{"aria-expanded":t.visible},on:{click:t.open}},[t._t("accordion-header")],2),e("transition",{attrs:{name:"accordion"},on:{enter:t.start,"after-enter":t.end,"before-leave":t.start}},[t.visible?e("div",{staticClass:"px-4"},[t._t("accordion-content")],2):t._e()])],1)},i=[],a={name:"AccordionItem",inject:["parentAccordion"],data(){return{index:null}},computed:{visible(){return this.parentAccordion.multipleOpen?this.parentAccordion.active.includes(this.index):this.index===this.parentAccordion.active},accordionItemClasses(){return["relative border-b py-2",{active:this.visible}]}},created(){this.index=this.parentAccordion.count++},methods:{hideItem(){this.parentAccordion.multipleOpen?this.parentAccordion.active.splice(this.parentAccordion.active.indexOf(this.index),1):this.parentAccordion.active=null},showItem(){this.parentAccordion.multipleOpen?this.parentAccordion.active.push(this.index):this.parentAccordion.active=this.index},open(){this.visible?this.hideItem():this.showItem()},start(t){t.style.height=`${t.scrollHeight}px`},end(t){t.style.height="auto"}}},r=a,o=n(1001),l=(0,o.Z)(r,s,i,!1,null,"6f89660e",null),c=l.exports},74473:function(t,e,n){n.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("ul",{staticClass:"accordion"},[t._t("default")],2)},i=[],a={name:"AccordionList",provide(){return{parentAccordion:this.parentAccordion}},props:{initiallyOpen:{type:[Number,Array],default:null},multipleOpen:{type:Boolean,default:!1}},data(){let t;return t=null!==this.initiallyOpen?this.initiallyOpen:this.multipleOpen?[]:null,{parentAccordion:{count:0,active:t,multipleOpen:this.multipleOpen}}}},r=a,o=n(1001),l=(0,o.Z)(r,s,i,!1,null,"5d773d24",null),c=l.exports},84855:function(t,e,n){n.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"component-frame"},[t._t("default")],2)},i=[],a={name:"FrameSkeleton"},r=a,o=n(1001),l=(0,o.Z)(r,s,i,!1,null,"666bca0e",null),c=l.exports},87673:function(t,e,n){n.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("div",{attrs:{"data-testid":"entity-url-control"}},[e("KClipboardProvider",{scopedSlots:t._u([{key:"default",fn:function({copyToClipboard:n}){return[e("KPop",{attrs:{placement:"bottom"},scopedSlots:t._u([{key:"content",fn:function(){return[e("div",[e("p",[t._v(t._s(t.confirmationText))])])]},proxy:!0}],null,!0)},[e("KButton",{attrs:{appearance:"secondary",size:"small"},on:{click:()=>{n(t.shareUrl)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("KIcon",{attrs:{"view-box":"0 0 16 16",icon:"externalLink"}})]},proxy:!0}],null,!0)},[t._v(" "+t._s(t.copyButtonText)+" ")])],1)]}}])})],1)},i=[],a={name:"EntityURLControl",props:{name:{type:String,default:""},copyButtonText:{type:String,default:"Copy URL"},confirmationText:{type:String,default:"URL copied to clipboard!"},mesh:{type:String,default:""}},computed:{shareUrl(){const t=`${window.location.href.replace(window.location.hash,"")}#`,{fullPath:e}=this.$router.resolve({name:this.$route.name,params:{mesh:this.mesh},query:{ns:this.name}}).resolved;return`${t}${e}`}}},r=a,o=n(1001),l=(0,o.Z)(r,s,i,!1,null,null,null),c=l.exports},61217:function(t,e,n){n.r(e),n.d(e,{default:function(){return A}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"zones"},[!1===t.multicluster?e("MultizoneInfo"):e("FrameSkeleton",[e("DataOverview",{attrs:{"page-size":t.pageSize,"has-error":t.hasError,"is-loading":t.isLoading,"empty-state":t.empty_state,"table-data":t.tableData,"table-data-is-empty":t.tableDataIsEmpty,"show-warnings":t.tableData.data.some((t=>t.withWarnings)),next:t.next},on:{tableAction:t.tableAction,loadData:function(e){return t.loadData(e)}},scopedSlots:t._u([{key:"additionalControls",fn:function(){return[t.$route.query.ns?e("KButton",{staticClass:"back-button",attrs:{appearance:"primary",size:"small",to:{name:"zones"}}},[e("span",{staticClass:"custom-control-icon"},[t._v(" ← ")]),t._v(" View All ")]):t._e()]},proxy:!0}])}),!1===t.isEmpty?e("TabsWidget",{attrs:{"has-error":t.hasError,"is-loading":t.isLoading,tabs:t.filterTabs(),"initial-tab-override":"overview"},scopedSlots:t._u([{key:"tabHeader",fn:function(){return[e("div",[e("h3",[t._v(" Zone: "+t._s(t.entity.name))])]),e("div",[e("EntityURLControl",{attrs:{name:t.entity.name}})],1)]},proxy:!0},{key:"overview",fn:function(){return[e("LabelList",{attrs:{"has-error":t.entityHasError,"is-loading":t.entityIsLoading,"is-empty":t.entityIsEmpty}},[e("div",[e("ul",t._l(t.entity,(function(n,s){return e("li",{key:s},[n?e("h4",[t._v(" "+t._s(s)+" ")]):t._e(),"status"===s?e("p",[e("KBadge",{attrs:{appearance:"Offline"===n?"danger":"success"}},[t._v(" "+t._s(n)+" ")])],1):e("p",[t._v(" "+t._s(n)+" ")])])})),0)])])]},proxy:!0},{key:"insights",fn:function(){return[e("KCard",{attrs:{"border-variant":"noBorder"},scopedSlots:t._u([{key:"body",fn:function(){return[e("AccordionList",{attrs:{"initially-open":0}},t._l(t.subscriptionsReversed,(function(n,s){return e("AccordionItem",{key:s,scopedSlots:t._u([{key:"accordion-header",fn:function(){return[e("SubscriptionHeader",{attrs:{details:n}})]},proxy:!0},{key:"accordion-content",fn:function(){return[e("SubscriptionDetails",{attrs:{details:n}})]},proxy:!0}],null,!0)})})),1)]},proxy:!0}],null,!1,260092193)})]},proxy:!0},{key:"config",fn:function(){return[t.codeOutput?e("KCard",{attrs:{"border-variant":"noBorder"},scopedSlots:t._u([{key:"body",fn:function(){return[e("Prism",{attrs:{language:"json",code:t.codeOutput}})]},proxy:!0},{key:"actions",fn:function(){return[t.codeOutput?e("KClipboardProvider",{scopedSlots:t._u([{key:"default",fn:function({copyToClipboard:n}){return[e("KPop",{attrs:{placement:"bottom"},scopedSlots:t._u([{key:"content",fn:function(){return[e("div",[e("p",[t._v("Config copied to clipboard!")])])]},proxy:!0}],null,!0)},[e("KButton",{attrs:{appearance:"primary"},on:{click:()=>{n(t.codeOutput)}}},[t._v(" Copy config to clipboard ")])],1)]}}],null,!1,539602587)}):t._e()]},proxy:!0}],null,!1,1808382372)}):t._e()]},proxy:!0},{key:"warnings",fn:function(){return[e("WarningsWidget",{attrs:{warnings:t.warnings}})]},proxy:!0}],null,!1,2671532567)}):t._e()],1)],1)},i=[],a=n(20629),r=n(27361),o=n.n(r),l=n(90236),c=n.n(l),u=n(99716),p=n(4104),d=n(58641),h=n(53419),y=n(17463),m=n(70172),f=n(65404),v=n(84855),g=n(56882),_=n(7001),b=n(74473),k=n(49718),I=n(87673),C=n(33561),Z=n(18299),x=n(45689),w={name:"ZonesView",components:{AccordionList:b.Z,AccordionItem:k.Z,FrameSkeleton:v.Z,DataOverview:g.Z,TabsWidget:_.Z,LabelList:C.Z,WarningsWidget:Z.Z,Prism:c(),SubscriptionDetails:u.Z,SubscriptionHeader:p.Z,MultizoneInfo:d.Z,EntityURLControl:I.Z},metaInfo:{title:"Zones"},data(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,empty_state:{title:"No Data",message:"There are no Zones present."},tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Status",key:"status"},{label:"Name",key:"name"},{label:"Zone CP Version",key:"zoneCpVersion"},{label:"Backend",key:"backend"},{label:"Ingress",key:"hasIngress"},{label:"Egress",key:"hasEgress"},{key:"warnings",hideLabel:!0}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#insights",title:"Zone Insights"},{hash:"#config",title:"Config"},{hash:"#warnings",title:"Warnings"}],entity:{},pageSize:x.NR,next:null,warnings:[],subscriptionsReversed:[],codeOutput:null,zonesWithIngress:new Set}},computed:{...(0,a.Se)({multicluster:"config/getMulticlusterStatus",globalCpVersion:"config/getVersion"})},watch:{$route(){this.init()}},beforeMount(){this.init()},methods:{init(){this.multicluster&&this.loadData()},filterTabs(){return this.warnings.length?this.tabs:this.tabs.filter((t=>"#warnings"!==t.hash))},tableAction(t){const e=t;this.getEntity(e)},parseData(t){const{zoneInsight:e={},name:n}=t;let s="-",i="",a=!0;return e.subscriptions&&e.subscriptions.length&&e.subscriptions.forEach(((t,e)=>{if(t.version&&t.version.kumaCp){s=t.version.kumaCp.version;const{kumaCpGlobalCompatible:e=!0}=t.version.kumaCp;a=e,t.config&&(i=JSON.parse(t.config).store.type)}})),{...t,status:(0,f._I)(e).status,zoneCpVersion:s,backend:i,hasIngress:this.zonesWithIngress.has(n)?"Yes":"No",hasEgress:this.zonesWithEgress.has(n)?"Yes":"No",withWarnings:!a}},calculateZonesWithIngress(t){const e=new Set;t.forEach((({zoneIngress:{zone:t}})=>{e.add(t)})),this.zonesWithIngress=e},calculateZonesWithEgress(t){const e=new Set;t.forEach((({zoneEgress:{zone:t}})=>{e.add(t)})),this.zonesWithEgress=e},async loadData(t="0"){this.isLoading=!0,this.isEmpty=!1;const e=this.$route.query.ns||null;try{const[{data:n,next:s},{items:i},{items:a}]=await Promise.all([(0,m.W)({getSingleEntity:y.Z.getZoneOverview.bind(y.Z),getAllEntities:y.Z.getAllZoneOverviews.bind(y.Z),size:this.pageSize,offset:t,query:e}),(0,h.A1)({callEndpoint:y.Z.getAllZoneIngressOverviews.bind(y.Z)}),(0,h.A1)({callEndpoint:y.Z.getAllZoneEgressOverviews.bind(y.Z)})]);this.next=s,n.length?(this.calculateZonesWithIngress(i),this.calculateZonesWithEgress(a),this.tableData.data=n.map(this.parseData),this.tableDataIsEmpty=!1,this.isEmpty=!1,this.getEntity({name:n[0].name})):(this.tableData.data=[],this.tableDataIsEmpty=!0,this.isEmpty=!0,this.entityIsEmpty=!0)}catch(n){this.hasError=!0,this.isEmpty=!0,console.error(n)}finally{this.isLoading=!1}},async getEntity(t){this.entityIsLoading=!0,this.entityIsEmpty=!0;const e=["type","name"],n=setTimeout((()=>{this.entityIsEmpty=!0,this.entityIsLoading=!1}),"500");if(t){this.entityIsEmpty=!1,this.warnings=[];try{const s=await y.Z.getZoneOverview({name:t.name}),i=o()(s,"zoneInsight.subscriptions",[]);if(this.entity={...(0,h.wy)(s,e),"Authentication Type":(0,h.be)(s)},this.subscriptionsReversed=Array.from(i).reverse(),i.length){const{version:t={}}=i[i.length-1],{kumaCp:e={}}=t,n=e.version||"-",{kumaCpGlobalCompatible:s=!0}=e;s||this.warnings.push({kind:f.s9,payload:{zoneCpVersion:n,globalCpVersion:this.globalCpVersion}}),i[i.length-1].config&&(this.codeOutput=JSON.stringify(JSON.parse(i[i.length-1].config),null,2))}}catch(s){console.error(s),this.entity={},this.entityHasError=!0,this.entityIsEmpty=!0}finally{clearTimeout(n)}}this.entityIsLoading=!1}}},E=w,S=n(1001),D=(0,S.Z)(E,s,i,!1,null,null,null),A=D.exports},58641:function(t,e,n){n.d(e,{Z:function(){return p}});var s=function(){var t=this,e=t._self._c;return e("KEmptyState",{scopedSlots:t._u([{key:"title",fn:function(){return[e("KIcon",{staticClass:"kong-icon--centered",attrs:{icon:"dangerCircle",size:"42"}}),t._v(" "+t._s(t.productName)+" is running in Standalone mode. ")]},proxy:!0},{key:"message",fn:function(){return[e("p",[t._v(" To access this page, you must be running in "),e("strong",[t._v("Multi-Zone")]),t._v(" mode. ")])]},proxy:!0},{key:"cta",fn:function(){return[e("KButton",{attrs:{to:`https://kuma.io/docs/${t.kumaDocsVersion}/documentation/deployments/`,target:"_blank",appearance:"primary"}},[t._v(" Learn More ")])]},proxy:!0}])})},i=[],a=n(20629),r=n(45689),o={name:"MultizoneInfo",data(){return{productName:r.sG}},computed:{...(0,a.Se)({kumaDocsVersion:"config/getKumaDocsVersion"})}},l=o,c=n(1001),u=(0,c.Z)(l,s,i,!1,null,null,null),p=u.exports},99716:function(t,e,n){n.d(e,{Z:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("div",[t.details.globalInstanceId||t.details.connectTime||t.details.disconnectTime?e("div",[e("h5",{staticClass:"overview-tertiary-title"},[t._v(" General Information: ")]),e("ul",[t.details.globalInstanceId?e("li",[e("strong",[t._v("Global Instance ID:")]),t._v("  "),e("span",{staticClass:"mono"},[t._v(t._s(t.details.globalInstanceId))])]):t._e(),t.details.controlPlaneInstanceId?e("li",[e("strong",[t._v("Control Plane Instance ID:")]),t._v("  "),e("span",{staticClass:"mono"},[t._v(t._s(t.details.controlPlaneInstanceId))])]):t._e(),t.details.connectTime?e("li",[e("strong",[t._v("Last Connected:")]),t._v("  "+t._s(t._f("readableDate")(t.details.connectTime))+" ")]):t._e(),t.details.disconnectTime?e("li",[e("strong",[t._v("Last Disconnected:")]),t._v("  "+t._s(t._f("readableDate")(t.details.disconnectTime))+" ")]):t._e()])]):t._e(),t.detailsIterator?e("div",[e("ul",{staticClass:"overview-stat-grid"},t._l(t.detailsIterator,(function(n,s){return e("li",{key:s},[e("h6",{staticClass:"overview-tertiary-title"},[t._v(" "+t._s(t._f("humanReadable")(s))+": ")]),e("ul",t._l(n,(function(n,s){return e("li",{key:s},[e("strong",[t._v(t._s(t._f("humanReadable")(s))+":")]),t._v("  "),e("span",{staticClass:"mono"},[t._v(t._s(t._f("formatError")(t._f("formatValue")(n))))])])})),0)])})),0)]):e("KAlert",{staticClass:"mt-4",attrs:{appearance:"info"},scopedSlots:t._u([{key:"alertIcon",fn:function(){return[e("KIcon",{attrs:{icon:"portal"}})]},proxy:!0},{key:"alertMessage",fn:function(){return[t._v(" There are no subscription statistics for "),e("strong",[t._v(t._s(t.details.id))])]},proxy:!0}])})],1)},i=[],a=n(53419),r={name:"SubscriptionDetails",filters:{formatValue(t){return t?parseInt(t,10).toLocaleString("en").toString():0},readableDate(t){return(0,a.tV)(t)},humanReadable(t){return(0,a.l9)(t)},formatError(t){return"--"===t?"error calculating":t}},props:{details:{type:Object,required:!0},isDiscoverySubscription:{type:Boolean,default:!1}},computed:{detailsIterator(){if(this.isDiscoverySubscription){const{lastUpdateTime:t,total:e,...n}=this.details.status;return n}return this.details.status?.stat}}},o=r,l=n(1001),c=(0,l.Z)(o,s,i,!1,null,"cf5e171a",null),u=c.exports},4104:function(t,e,n){n.d(e,{Z:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("h4",{staticClass:"text-lg font-medium"},[e("span",{staticClass:"color-green-400"},[t._v(" Connect time: "+t._s(t._f("rawReadableDateFilter")(t.details.connectTime))+" ")]),t.details.disconnectTime?e("span",{staticClass:"ml-4 color-red-400"},[t._v(" Disconnect time: "+t._s(t._f("rawReadableDateFilter")(t.details.disconnectTime))+" ")]):t._e()])},i=[],a=n(53419),r={name:"SubscriptionHeader",filters:{rawReadableDateFilter(t){return(0,a.Jx)(t)}},props:{details:{type:Object,required:!0}}},o=r,l=n(1001),c=(0,l.Z)(o,s,i,!1,null,null,null),u=c.exports},18299:function(t,e,n){n.d(e,{Z:function(){return q}});var s=function(){var t=this,e=t._self._c;return e("KCard",{attrs:{"border-variant":"noBorder"},scopedSlots:t._u([{key:"body",fn:function(){return[e("ul",t._l(t.warnings,(function({kind:n,payload:s,index:i}){return e("li",{key:`${n}/${i}`,staticClass:"mb-1"},[e("KAlert",{attrs:{appearance:"warning"},scopedSlots:t._u([{key:"alertMessage",fn:function(){return[e(t.getWarningComponent(n),{tag:"component",attrs:{payload:s}})]},proxy:!0}],null,!0)})],1)})),0)]},proxy:!0}])})},i=[],a=function(){var t=this,e=t._self._c;return e("span",[t._v(" "+t._s(t.payload)+" ")])},r=[],o={name:"WarningDefault",props:{payload:{type:[String,Object],required:!0}}},l=o,c=n(1001),u=(0,c.Z)(l,a,r,!1,null,null,null),p=u.exports,d=function(){var t=this,e=t._self._c;return e("span",[t._v(" Envoy ("),e("strong",[t._v(t._s(t.payload.envoy))]),t._v(") is unsupported by the current version of Kuma DP ("),e("strong",[t._v(t._s(t.payload.kumaDp))]),t._v(") [Requirements: "),e("strong",[t._v(" "+t._s(t.payload.requirements))]),t._v("] ")])},h=[],y={name:"WarningEnvoyIncompatible",props:{payload:{type:Object,required:!0}}},m=y,f=(0,c.Z)(m,d,h,!1,null,null,null),v=f.exports,g=function(){var t=this,e=t._self._c;return e("span",[t._v(" There is mismatch between versions of Kuma DP ("),e("strong",[t._v(t._s(t.payload.kumaDpVersion))]),t._v(") and the Zone CP ("),e("strong",[t._v(t._s(t.payload.zoneVersion))]),t._v(") ")])},_=[],b={name:"WarningZoneAndKumaDPVersionsIncompatible",props:{payload:{type:Object,required:!0}}},k=b,I=(0,c.Z)(k,g,_,!1,null,null,null),C=I.exports,Z=function(){var t=this,e=t._self._c;return e("span",[t._v(" Unsupported version of Kuma DP ("),e("strong",[t._v(t._s(t.payload.kumaDpVersion))]),t._v(") ")])},x=[],w={name:"WarningUnsupportedKumaDPVersion",props:{payload:{type:Object,required:!0}}},E=w,S=(0,c.Z)(E,Z,x,!1,null,null,null),D=S.exports,A=function(){var t=this,e=t._self._c;return e("span",[t._v(" There is mismatch between versions of Zone CP ("),e("strong",[t._v(t._s(t.payload.zoneCpVersion))]),t._v(") and the Global CP ("),e("strong",[t._v(t._s(t.payload.globalCpVersion))]),t._v(") ")])},O=[],z={name:"WarningZoneAndGlobalCPSVersionsIncompatible",props:{payload:{type:Object,required:!0}}},L=z,T=(0,c.Z)(L,A,O,!1,null,null,null),W=T.exports,K=n(65404),V={name:"WarningsWidget",props:{warnings:{type:Array,required:!0}},methods:{getWarningComponent(t=""){switch(t){case K.Bd:return v;case K.ZM:return D;case K.pC:return C;case K.s9:return W;default:return p}}}},P=V,R=(0,c.Z)(P,s,i,!1,null,null,null),q=R.exports}}]);