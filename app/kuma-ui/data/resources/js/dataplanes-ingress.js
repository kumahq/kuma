(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["dataplanes-ingress"],{6663:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"entity-url-control"},[t.shouldDisplay?a("KClipboardProvider",{scopedSlots:t._u([{key:"default",fn:function(e){var n=e.copyToClipboard;return[a("KPop",{attrs:{placement:"bottom"}},[a("KButton",{attrs:{appearance:"secondary",size:"small"},on:{click:function(){n(t.url)}}},[a("KIcon",{attrs:{slot:"icon",icon:"externalLink"},slot:"icon"}),t._v(" "+t._s(t.copyButtonText)+" ")],1),a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[t._v(t._s(t.confirmationText))])])],1)]}}],null,!1,1603401634)}):t._e()],1)},s=[],i={name:"EntityURLControl",props:{url:{type:String,required:!0},copyButtonText:{type:String,default:"Copy URL"},confirmationText:{type:String,default:"URL copied to clipboard!"}},computed:{shouldDisplay:function(){var t=this.$route.params.mesh||null;return!(!t||"all"===t)}}},r=i,o=a("2877"),l=Object(o["a"])(r,n,s,!1,null,null,null);e["a"]=l.exports},"748e":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ingress-dataplanes"},[a("FrameSkeleton",[a("DataOverview",{attrs:{"page-size":t.pageSize,"has-error":t.hasError,"is-loading":t.isLoading,"empty-state":t.empty_state,"display-data-table":!0,"table-data":t.tableData,"table-data-is-empty":t.tableDataIsEmpty,"table-data-function-text":"View","table-data-row":"name"},on:{tableAction:t.tableAction,reloadData:t.loadData}},[a("template",{slot:"additionalControls"},[a("KButton",{staticClass:"add-dp-button",attrs:{appearance:"primary",size:"small",to:t.dataplaneWizardRoute}},[a("span",{staticClass:"custom-control-icon"},[t._v(" + ")]),t._v(" Create Dataplane Proxy ")]),this.$route.query.ns?a("KButton",{staticClass:"back-button",attrs:{appearance:"primary",size:"small",to:{name:"ingress-dataplanes"}}},[a("span",{staticClass:"custom-control-icon"},[t._v(" ← ")]),t._v(" View All ")]):t._e()],1),a("template",{slot:"pagination"},[a("Pagination",{attrs:{"has-previous":t.previous.length>0,"has-next":t.hasNext},on:{next:t.goToNextPage,previous:t.goToPreviousPage}})],1)],2),!1===t.isEmpty?a("Tabs",{attrs:{"has-error":t.hasError,"is-loading":t.isLoading,tabs:t.tabs,"initial-tab-override":"overview"}},[a("template",{slot:"tabHeader"},[a("div",[a("h3",[t._v(t._s(t.tabGroupTitle))])]),a("div",[a("EntityURLControl",{attrs:{url:t.shareUrl}})],1)]),a("template",{slot:"overview"},[a("LabelList",{attrs:{"has-error":t.entityHasError,"is-loading":t.entityIsLoading,"is-empty":t.entityIsEmpty}},[a("div",[a("ul",t._l(t.entity.basicData,(function(e,n){return a("li",{key:n},[a("div","status"===n?[a("h4",[t._v(t._s(n))]),a("div",{staticClass:"entity-status",class:{"is-offline":"offline"===e.status.toString().toLowerCase()||!1===e.status,"is-degraded":"partially degraded"===e.status.toString().toLowerCase()||!1===e.status}},[a("span",{staticClass:"entity-status__label"},[t._v(t._s(e.status))])]),a("div",{staticClass:"reason-list"},[a("ul",t._l(e.reason,(function(e){return a("li",{key:e},[a("span",{staticClass:"entity-status__dot"}),t._v(" "+t._s(e)+" ")])})),0)])]:[a("h4",[t._v(t._s(n))]),t._v(" "+t._s(e)+" ")])])})),0)]),a("div",[a("h4",[t._v("Tags")]),a("p",t._l(t.entity.tags,(function(e,n){return a("span",{key:n,staticClass:"tag-cols"},[a("span",[t._v(" "+t._s(e.label)+": ")]),a("span",[t._v(" "+t._s(e.value)+" ")])])})),0)])])],1),a("template",{slot:"yaml"},[a("YamlView",{attrs:{title:t.entityOverviewTitle,"has-error":t.entityHasError,"is-loading":t.entityIsLoading,"is-empty":t.entityIsEmpty,content:t.rawEntity}})],1)],2):t._e()],1)],1)},s=[],i=(a("99af"),a("4160"),a("13d5"),a("b0c0"),a("d3b7"),a("159b"),a("96cf"),a("c964")),r=a("f3f3"),o=a("2f62"),l=a("d7c2"),u=a("4a34"),c=a("6663"),p=a("8218"),d=a("1d10"),h=a("1799"),v=a("2778"),y=a("251b"),b=a("ff9d"),m=a("0ada"),f={name:"IngressDataplanes",metaInfo:{title:"Ingress data plane proxies"},components:{EntityURLControl:c["a"],FrameSkeleton:d["a"],Pagination:h["a"],DataOverview:v["a"],Tabs:y["a"],YamlView:b["a"],LabelList:m["a"]},mixins:[p["a"]],data:function(){return{isLoading:!0,isEmpty:!1,hasError:!1,entityIsLoading:!0,entityIsEmpty:!1,entityHasError:!1,tableDataIsEmpty:!1,empty_state:{title:"No Data",message:"There are no Ingress data plane proxies present."},tableData:{headers:[{key:"actions",hideLabel:!0},{label:"Status",key:"status"},{label:"Name",key:"name"},{label:"Type",key:"type"},{label:"Tags",key:"tags"},{label:"Public address",key:"publicAddress"},{label:"Public port",key:"publicPort"},{label:"Last Connected",key:"lastConnected"},{label:"Last Updated",key:"lastUpdated"},{label:"Total Updates",key:"totalUpdates"},{label:"Kuma DP version",key:"dpVersion"},{label:"Envoy version",key:"envoyVersion"}],data:[]},tabs:[{hash:"#overview",title:"Overview"},{hash:"#yaml",title:"YAML"}],entity:[],rawEntity:null,firstEntity:null,pageSize:this.$pageSize,pageOffset:null,next:null,hasNext:!1,previous:[],tabGroupTitle:null,entityNamespace:null,entityOverviewTitle:null,showmTLSTab:!1}},computed:Object(r["a"])(Object(r["a"])({},Object(o["b"])({environment:"getEnvironment",queryNamespace:"getItemQueryNamespace"})),{},{dataplaneWizardRoute:function(){return"universal"===this.environment?{name:"universal-dataplane"}:{name:"kubernetes-dataplane"}},version:function(){var t=this.$store.getters.getVersion;return null!==t?t:"latest"},shareUrl:function(){var t=this,e="".concat(window.location.origin,"#"),a=this.entity,n=function(){return a.basicData?t.$route.query.ns?t.$route.fullPath:"".concat(e).concat(t.$route.fullPath,"?ns=").concat(a.basicData.name):null};return n()}}),watch:{$route:function(t,e){this.loadData()}},beforeMount:function(){this.loadData()},methods:{init:function(){this.loadData()},goToPreviousPage:function(){this.pageOffset=this.previous.pop(),this.next=null,this.loadData()},goToNextPage:function(){this.previous.push(this.pageOffset),this.pageOffset=this.next,this.next=null,this.loadData()},tableAction:function(t){var e=t;this.$store.dispatch("updateSelectedTab",this.tabs[0].hash),this.$store.dispatch("updateSelectedTableRow",e.name),this.getEntity(e)},loadData:function(){var t=this;this.isLoading=!0;var e=this.$route.params.mesh||null,a=this.$route.query.ns||null,n={size:this.pageSize,offset:this.pageOffset,ingress:!0},s=function(){return"all"===e?t.$api.getAllDataplaneOverviews(n):a&&a.length&&"all"!==e?t.$api.getDataplaneOverviewFromMesh(e,a):t.$api.getAllDataplaneOverviewsFromMesh(e,n)},i=function(e,a,n){t.$api.getDataplaneOverviewFromMesh(e,a).then((function(e){var a,s,i="n/a",r=[],o=[],c=[],p="",d="",h=[],v=[],y=(e.dataplane.networking.ingress,"Ingress");r=Object(u["a"])(e.dataplane);var b=Object(u["d"])(e.dataplane,e.dataplaneInsight),m=b.status;if(e.dataplaneInsight.subscriptions&&e.dataplaneInsight.subscriptions.length){e.dataplaneInsight.subscriptions.forEach((function(t){var e=t.status.total.responsesSent||0,a=t.status.total.responsesRejected||0,n=t.connectTime||i,s=t.status.lastUpdateTime||i;o.push(parseInt(e)),c.push(parseInt(a)),h.push(n),v.push(s),t.version&&t.version.kumaDp&&(p=t.version.kumaDp.version,d=t.version.envoy.version)})),o=o.reduce((function(t,e){return t+e})),c=c.reduce((function(t,e){return t+e}));var f=h.reduce((function(t,e){return t&&e?t.MeasureDate>e.MeasureDate?t:e:null})),g=v.reduce((function(t,e){return t&&e?t.MeasureDate>e.MeasureDate?t:e:null})),w=new Date(f),E=new Date(g);a=f&&!isNaN(w)?Object(l["e"])(w):"never",s=g&&!isNaN(E)?Object(l["e"])(E):"never"}else a="never",s="never",o=0,c=0,p="-",d="-";return n.push({name:e.name,mesh:e.mesh,tags:r,status:m,lastConnected:a,lastUpdated:s,totalUpdates:o,totalRejectedUpdates:c,publicAddress:e.dataplane.networking.ingress.publicAddress||null,publicPort:e.dataplane.networking.ingress.publicPort||null,dpVersion:p,envoyVersion:d,type:y}),t.sortEntities(n),n})).catch((function(t){console.error(t)}))},r=function(){return s().then((function(n){var s=function(){var e=n;return"total"in e?0!==e.total&&e.items&&e.items.length>0?t.sortEntities(e.items):null:e};if(s()){n.next?(t.next=Object(l["c"])(n.next),t.hasNext=!0):t.hasNext=!1;var r=[],o=a?s():s()[0];t.firstEntity=o.name,t.getEntity(o),t.$store.dispatch("updateSelectedTableRow",t.firstEntity),a&&a.length&&e&&e.length?i(e,a,r):s().forEach((function(t){i(t.mesh,t.name,r)})),t.tableData.data=r,t.tableDataIsEmpty=!1,t.isEmpty=!1}else t.tableData.data=[],t.tableDataIsEmpty=!0,t.isEmpty=!0,t.getEntity(null)})).catch((function(e){t.hasError=!0,t.isEmpty=!0,console.error(e)})).finally((function(){setTimeout((function(){t.isLoading=!1}),"500")}))};r()},getEntity:function(t){var e=this;this.entityIsLoading=!0,this.entityIsEmpty=!1;var a=this.$route.params.mesh;if(t&&null!==t){var n="all"===a?t.mesh:a;return this.$api.getDataplaneOverviewFromMesh(n,t.name).then((function(t){if(Object(u["b"])(t)){var a=["type","name","mesh"],n=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",Object(u["d"])(Object(u["b"])(t),Object(u["c"])(t)));case 4:e.prev=4,e.t0=e["catch"](0),console.error(e.t0);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(){return e.apply(this,arguments)}}(),s=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=r["a"],e.t1=Object(r["a"])({},Object(l["d"])(Object(u["b"])(t),a)),e.t2={},e.next=5,n();case 5:return e.t3=e.sent,e.t4={status:e.t3},e.t5=(0,e.t0)(e.t1,e.t2,e.t4),e.t6=Object(u["a"])(Object(u["b"])(t)),e.abrupt("return",{basicData:e.t5,tags:e.t6});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();s().then((function(t){e.entity=t,e.entityNamespace=t.basicData.name,e.tabGroupTitle="Mesh: ".concat(t.basicData.name),e.entityOverviewTitle="Entity Overview for ".concat(t.basicData.name)})),e.rawEntity=Object(l["i"])(Object(u["b"])(t))}else e.entity=null,e.entityIsEmpty=!0})).catch((function(t){e.entityHasError=!0,console.error(t)})).finally((function(){setTimeout((function(){e.entityIsLoading=!1}),"500")}))}setTimeout((function(){e.entityIsEmpty=!0,e.entityIsLoading=!1}),"500")}}},g=f,w=(a("9dd2"),a("2877")),E=Object(w["a"])(g,n,s,!1,null,"77dc2b84",null);e["default"]=E.exports},"9dd2":function(t,e,a){"use strict";var n=a("bec2"),s=a.n(n);s.a},bec2:function(t,e,a){}}]);